function OpenSeadragon(options){return new OpenSeadragon.Viewer(options)}!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){"use strict";function p(a,b){var c=(b=b||d).createElement("script");c.text=a,b.head.appendChild(c).parentNode.removeChild(c)}function w(a){var b=!!a&&"length"in a&&a.length,c=r.type(a);return"function"!==c&&!r.isWindow(a)&&("array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a)}function B(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()}function E(a,b,c){return r.isFunction(b)?r.grep(a,function(a,d){return!!b.call(a,d,a)!==c}):b.nodeType?r.grep(a,function(a){return a===b!==c}):"string"!=typeof b?r.grep(a,function(a){return i.call(b,a)>-1!==c}):D.test(b)?r.filter(b,a,c):(b=r.filter(b,a),r.grep(a,function(a){return i.call(b,a)>-1!==c&&1===a.nodeType}))}function K(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function N(a){return a}function O(a){throw a}function P(a,b,c,d){var e;try{a&&r.isFunction(e=a.promise)?e.call(a).done(b).fail(c):a&&r.isFunction(e=a.then)?e.call(a,b,c):b.apply(void 0,[a].slice(d))}catch(a){c.apply(void 0,[a])}}function S(){d.removeEventListener("DOMContentLoaded",S),a.removeEventListener("load",S),r.ready()}function V(){this.expando=r.expando+V.uid++}function _(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(Z,"-$&").toLowerCase(),"string"==typeof(c=a.getAttribute(d))){try{c=function(a){return"true"===a||"false"!==a&&("null"===a?null:a===+a+""?+a:Y.test(a)?JSON.parse(a):a)}(c)}catch(e){}X.set(a,b,c)}else c=void 0;return c}function fa(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return r.css(a,b,"")},i=h(),j=c&&c[3]||(r.cssNumber[b]?"":"px"),k=(r.cssNumber[b]||"px"!==j&&+i)&&ba.exec(r.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do{f=f||".5",k/=f,r.style(a,b,k+j)}while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}function ha(a){var b,c=a.ownerDocument,d=a.nodeName,e=ga[d];return e||(b=c.body.appendChild(c.createElement(d)),e=r.css(b,"display"),b.parentNode.removeChild(b),"none"===e&&(e="block"),ga[d]=e,e)}function ia(a,b){for(var c,d,e=[],f=0,g=a.length;f<g;f++)(d=a[f]).style&&(c=d.style.display,b?("none"===c&&(e[f]=W.get(d,"display")||null,e[f]||(d.style.display="")),""===d.style.display&&da(d)&&(e[f]=ha(d))):"none"!==c&&(e[f]="none",W.set(d,"display",c)));for(f=0;f<g;f++)null!=e[f]&&(a[f].style.display=e[f]);return a}function na(a,b){var c;return c=void 0!==a.getElementsByTagName?a.getElementsByTagName(b||"*"):void 0!==a.querySelectorAll?a.querySelectorAll(b||"*"):[],void 0===b||b&&B(a,b)?r.merge([a],c):c}function oa(a,b){for(var c=0,d=a.length;c<d;c++)W.set(a[c],"globalEval",!b||W.get(b[c],"globalEval"))}function qa(a,b,c,d,e){for(var f,g,h,i,j,k,l=b.createDocumentFragment(),m=[],n=0,o=a.length;n<o;n++)if((f=a[n])||0===f)if("object"===r.type(f))r.merge(m,f.nodeType?[f]:f);else if(pa.test(f)){for(g=g||l.appendChild(b.createElement("div")),h=(ka.exec(f)||["",""])[1].toLowerCase(),i=ma[h]||ma._default,g.innerHTML=i[1]+r.htmlPrefilter(f)+i[2],k=i[0];k--;)g=g.lastChild;r.merge(m,g.childNodes),(g=l.firstChild).textContent=""}else m.push(b.createTextNode(f));for(l.textContent="",n=0;f=m[n++];)if(d&&r.inArray(f,d)>-1)e&&e.push(f);else if(j=r.contains(f.ownerDocument,f),g=na(l.appendChild(f),"script"),j&&oa(g),c)for(k=0;f=g[k++];)la.test(f.type||"")&&c.push(f);return l}function va(){return!0}function wa(){return!1}function xa(){try{return d.activeElement}catch(a){}}function ya(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)ya(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),!1===e)e=wa;else if(!e)return a;return 1===f&&(g=e,e=function(a){return r().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=r.guid++)),a.each(function(){r.event.add(this,b,e,d,c)})}function Ea(a,b){return B(a,"table")&&B(11!==b.nodeType?b:b.firstChild,"tr")?r(">tbody",a)[0]||a:a}function Fa(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function Ga(a){var b=Ca.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Ha(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(W.hasData(a)&&(f=W.access(a),g=W.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;c<d;c++)r.event.add(b,e,j[e][c])}X.hasData(a)&&(h=X.access(a),i=r.extend({},h),X.set(b,i))}}function Ia(a,b){var c=b.nodeName.toLowerCase();"input"===c&&ja.test(a.type)?b.checked=a.checked:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}function Ja(a,b,c,d){b=g.apply([],b);var e,f,h,i,j,k,l=0,m=a.length,n=m-1,q=b[0],s=r.isFunction(q);if(s||m>1&&"string"==typeof q&&!o.checkClone&&Ba.test(q))return a.each(function(e){var f=a.eq(e);s&&(b[0]=q.call(this,e,f.html())),Ja(f,b,c,d)});if(m&&(e=qa(b,a[0].ownerDocument,!1,a,d),f=e.firstChild,1===e.childNodes.length&&(e=f),f||d)){for(i=(h=r.map(na(e,"script"),Fa)).length;l<m;l++)j=e,l!==n&&(j=r.clone(j,!0,!0),i&&r.merge(h,na(j,"script"))),c.call(a[l],j,l);if(i)for(k=h[h.length-1].ownerDocument,r.map(h,Ga),l=0;l<i;l++)j=h[l],la.test(j.type||"")&&!W.access(j,"globalEval")&&r.contains(k,j)&&(j.src?r._evalUrl&&r._evalUrl(j.src):p(j.textContent.replace(Da,""),k))}return a}function Ka(a,b,c){for(var d,e=b?r.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||r.cleanData(na(d)),d.parentNode&&(c&&r.contains(d.ownerDocument,d)&&oa(na(d,"script")),d.parentNode.removeChild(d));return a}function Oa(a,b,c){var d,e,f,g,h=a.style;return(c=c||Na(a))&&(""!==(g=c.getPropertyValue(b)||c[b])||r.contains(a.ownerDocument,a)||(g=r.style(a,b)),!o.pixelMarginRight()&&Ma.test(g)&&La.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function Pa(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}function Xa(a){var b=r.cssProps[a];return b||(b=r.cssProps[a]=function(a){if(a in Va)return a;for(var b=a[0].toUpperCase()+a.slice(1),c=Ua.length;c--;)if((a=Ua[c]+b)in Va)return a}(a)||a),b}function Ya(a,b,c){var d=ba.exec(b);return d?Math.max(0,d[2]-(c||0))+(d[3]||"px"):b}function Za(a,b,c,d,e){var f,g=0;for(f=c===(d?"border":"content")?4:"width"===b?1:0;f<4;f+=2)"margin"===c&&(g+=r.css(a,c+ca[f],!0,e)),d?("content"===c&&(g-=r.css(a,"padding"+ca[f],!0,e)),"margin"!==c&&(g-=r.css(a,"border"+ca[f]+"Width",!0,e))):(g+=r.css(a,"padding"+ca[f],!0,e),"padding"!==c&&(g+=r.css(a,"border"+ca[f]+"Width",!0,e)));return g}function $a(a,b,c){var d,e=Na(a),f=Oa(a,b,e),g="border-box"===r.css(a,"boxSizing",!1,e);return Ma.test(f)?f:(d=g&&(o.boxSizingReliable()||f===a.style[b]),"auto"===f&&(f=a["offset"+b[0].toUpperCase()+b.slice(1)]),(f=parseFloat(f)||0)+Za(a,b,c||(g?"border":"content"),d,e)+"px")}function _a(a,b,c,d,e){return new _a.prototype.init(a,b,c,d,e)}function eb(){bb&&(!1===d.hidden&&a.requestAnimationFrame?a.requestAnimationFrame(eb):a.setTimeout(eb,r.fx.interval),r.fx.tick())}function fb(){return a.setTimeout(function(){ab=void 0}),ab=r.now()}function gb(a,b){var c,d=0,e={height:a};for(b=b?1:0;d<4;d+=2-b)c=ca[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function hb(a,b,c){for(var d,e=(kb.tweeners[b]||[]).concat(kb.tweeners["*"]),f=0,g=e.length;f<g;f++)if(d=e[f].call(c,b,a))return d}function kb(a,b,c){var d,e,f=0,g=kb.prefilters.length,h=r.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=ab||fb(),c=Math.max(0,j.startTime+j.duration-b),f=1-(c/j.duration||0),g=0,i=j.tweens.length;g<i;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),f<1&&i?c:(i||h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:r.extend({},b),opts:r.extend(!0,{specialEasing:{},easing:r.easing._default},c),originalProperties:b,originalOptions:c,startTime:ab||fb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=r.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;c<d;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(function(a,b){var c,d,e,f,g;for(c in a)if(d=r.camelCase(c),e=b[d],f=a[c],Array.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),(g=r.cssHooks[d])&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}(k,j.opts.specialEasing);f<g;f++)if(d=kb.prefilters[f].call(j,a,k,j.opts))return r.isFunction(d.stop)&&(r._queueHooks(j.elem,j.opts.queue).stop=r.proxy(d.stop,d)),d;return r.map(k,hb,j),r.isFunction(j.opts.start)&&j.opts.start.call(a,j),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always),r.fx.timer(r.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j}function pb(a){return(a.match(L)||[]).join(" ")}function qb(a){return a.getAttribute&&a.getAttribute("class")||""}function Ab(a,b,c,d){var e;if(Array.isArray(b))r.each(b,function(b,e){c||wb.test(a)?d(a,e):Ab(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==r.type(b))d(a,b);else for(e in b)Ab(a+"["+e+"]",b[e],c,d)}function Mb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(L)||[];if(r.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Nb(a,b,c,d){function g(h){var i;return e[h]=!0,r.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}var e={},f=a===Jb;return g(b.dataTypes[0])||!e["*"]&&g("*")}function Ob(a,b){var c,d,e=r.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&r.extend(!0,a,d),a}var c=[],d=a.document,e=Object.getPrototypeOf,f=c.slice,g=c.concat,h=c.push,i=c.indexOf,j={},k=j.toString,l=j.hasOwnProperty,m=l.toString,n=m.call(Object),o={},q="3.2.1",r=function(a,b){return new r.fn.init(a,b)},s=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,t=/^-ms-/,u=/-([a-z])/g,v=function(a,b){return b.toUpperCase()};r.fn=r.prototype={jquery:q,constructor:r,length:0,toArray:function(){return f.call(this)},get:function(a){return null==a?f.call(this):a<0?this[a+this.length]:this[a]},pushStack:function(a){var b=r.merge(this.constructor(),a);return b.prevObject=this,b},each:function(a){return r.each(this,a)},map:function(a){return this.pushStack(r.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(f.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(a<0?b:0);return this.pushStack(c>=0&&c<b?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:h,sort:c.sort,splice:c.splice},r.extend=r.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||r.isFunction(g)||(g={}),h===i&&(g=this,h--);h<i;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(r.isPlainObject(d)||(e=Array.isArray(d)))?(e?(e=!1,f=c&&Array.isArray(c)?c:[]):f=c&&r.isPlainObject(c)?c:{},g[b]=r.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},r.extend({expando:"jQuery"+(q+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===r.type(a)},isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){var b=r.type(a);return("number"===b||"string"===b)&&!isNaN(a-parseFloat(a))},isPlainObject:function(a){var b,c;return!(!a||"[object Object]"!==k.call(a)||(b=e(a))&&("function"!=typeof(c=l.call(b,"constructor")&&b.constructor)||m.call(c)!==n))},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?j[k.call(a)]||"object":typeof a},globalEval:function(a){p(a)},camelCase:function(a){return a.replace(t,"ms-").replace(u,v)},each:function(a,b){var c,d=0;if(w(a))for(c=a.length;d<c&&!1!==b.call(a[d],d,a[d]);d++);else for(d in a)if(!1===b.call(a[d],d,a[d]))break;return a},trim:function(a){return null==a?"":(a+"").replace(s,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(w(Object(a))?r.merge(c,"string"==typeof a?[a]:a):h.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:i.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;d<c;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var e=[],f=0,g=a.length,h=!c;f<g;f++)!b(a[f],f)!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,f=0,h=[];if(w(a))for(d=a.length;f<d;f++)null!=(e=b(a[f],f,c))&&h.push(e);else for(f in a)null!=(e=b(a[f],f,c))&&h.push(e);return g.apply([],h)},guid:1,proxy:function(a,b){var c,d,e;if("string"==typeof b&&(c=a[b],b=a,a=c),r.isFunction(a))return d=f.call(arguments,2),e=function(){return a.apply(b||this,d.concat(f.call(arguments)))},e.guid=a.guid=a.guid||r.guid++,e},now:Date.now,support:o}),"function"==typeof Symbol&&(r.fn[Symbol.iterator]=c[Symbol.iterator]),r.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){j["[object "+b+"]"]=b.toLowerCase()});var x=function(a){function ga(a,b,d,e){var f,h,j,k,l,o,r,s=b&&b.ownerDocument,w=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==w&&9!==w&&11!==w)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==w&&(l=Z.exec(a)))if(f=l[1]){if(9===w){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(s&&(j=s.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(l[2])return G.apply(d,b.getElementsByTagName(a)),d;if((f=l[3])&&c.getElementsByClassName&&b.getElementsByClassName)return G.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==w)s=b,r=a;else if("object"!==b.nodeName.toLowerCase()){for((k=b.getAttribute("id"))?k=k.replace(ba,ca):b.setAttribute("id",k=u),h=(o=g(a)).length;h--;)o[h]="#"+k+" "+sa(o[h]);r=o.join(","),s=$.test(a)&&qa(b.parentNode)||b}if(r)try{return G.apply(d,s.querySelectorAll(r)),d}catch(x){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(P,"$1"),b,d,e)}function ha(){function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}var a=[];return b}function ia(a){return a[u]=!0,a}function ja(a){var b=n.createElement("fieldset");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ka(a,b){for(var c=a.split("|"),e=c.length;e--;)d.attrHandle[c[e]]=b}function la(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function ma(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}}function na(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function oa(a){return function(b){return"form"in b?b.parentNode&&!1===b.disabled?"label"in b?"label"in b.parentNode?b.parentNode.disabled===a:b.disabled===a:b.isDisabled===a||b.isDisabled!==!a&&ea(b)===a:b.disabled===a:"label"in b&&b.disabled===a}}function pa(a){return ia(function(b){return b=+b,ia(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function qa(a){return a&&void 0!==a.getElementsByTagName&&a}function ra(){}function sa(a){for(var b=0,c=a.length,d="";b<c;b++)d+=a[b].value;return d}function ta(a,b,c){var d=b.dir,e=b.next,f=e||d,g=c&&"parentNode"===f,h=x++;return b.first?function(b,c,e){for(;b=b[d];)if(1===b.nodeType||g)return a(b,c,e);return!1}:function(b,c,i){var j,k,l,m=[w,h];if(i){for(;b=b[d];)if((1===b.nodeType||g)&&a(b,c,i))return!0}else for(;b=b[d];)if(1===b.nodeType||g)if(l=b[u]||(b[u]={}),k=l[b.uniqueID]||(l[b.uniqueID]={}),e&&e===b.nodeName.toLowerCase())b=b[d]||b;else{if((j=k[f])&&j[0]===w&&j[1]===h)return m[2]=j[2];if(k[f]=m,m[2]=a(b,c,i))return!0}return!1}}function ua(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function wa(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;h<i;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function xa(a,b,c,d,e,f){return d&&!d[u]&&(d=xa(d)),e&&!e[u]&&(e=xa(e,f)),ia(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||function(a,b,c){for(var d=0,e=b.length;d<e;d++)ga(a,b[d],c);return c}(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:wa(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d)for(j=wa(r,n),d(j,[],h,i),k=j.length;k--;)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l));if(f){if(e||a){if(e){for(j=[],k=r.length;k--;)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}for(k=r.length;k--;)(l=r[k])&&(j=e?I(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=wa(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):G.apply(g,r)})}function ya(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ta(function(a){return a===b},h,!0),l=ta(function(a){return I(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];i<f;i++)if(c=d.relative[a[i].type])m=[ta(ua(m),c)];else{if((c=d.filter[a[i].type].apply(null,a[i].matches))[u]){for(e=++i;e<f&&!d.relative[a[e].type];e++);return xa(i>1&&ua(m),i>1&&sa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(P,"$1"),c,i<e&&ya(a.slice(i,e)),e<f&&ya(a=a.slice(e)),e<f&&sa(a))}m.push(c)}return ua(m)}function za(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){for(o=0,g||l.ownerDocument===n||(m(l),h=!p);q=a[o++];)if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){for(o=0;q=b[o++];)q(t,u,g,h);if(f){if(r>0)for(;s--;)t[s]||u[s]||(u[s]=E.call(i));u=wa(u)}G.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&ga.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ia(f):f}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ha(),z=ha(),A=ha(),B=function(a,b){return a===b&&(l=!0),0},C={}.hasOwnProperty,D=[],E=D.pop,F=D.push,G=D.push,H=D.slice,I=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},J="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",K="[\\x20\\t\\r\\n\\f]",L="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",M="\\["+K+"*("+L+")(?:"+K+"*([*^$|!~]?=)"+K+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+L+"))|)"+K+"*\\]",N=":("+L+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+M+")*)|.*)\\)|)",O=new RegExp(K+"+","g"),P=new RegExp("^"+K+"+|((?:^|[^\\\\])(?:\\\\.)*)"+K+"+$","g"),Q=new RegExp("^"+K+"*,"+K+"*"),R=new RegExp("^"+K+"*([>+~]|"+K+")"+K+"*"),S=new RegExp("="+K+"*([^\\]'\"]*?)"+K+"*\\]","g"),T=new RegExp(N),U=new RegExp("^"+L+"$"),V={ID:new RegExp("^#("+L+")"),CLASS:new RegExp("^\\.("+L+")"),TAG:new RegExp("^("+L+"|[*])"),ATTR:new RegExp("^"+M),PSEUDO:new RegExp("^"+N),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+K+"*(even|odd|(([+-]|)(\\d*)n|)"+K+"*(?:([+-]|)"+K+"*(\\d+)|))"+K+"*\\)|)","i"),bool:new RegExp("^(?:"+J+")$","i"),needsContext:new RegExp("^"+K+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+K+"*((?:-\\d)?\\d*)"+K+"*\\)|)(?=[^-]|$)","i")},W=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,_=new RegExp("\\\\([\\da-f]{1,6}"+K+"?|("+K+")|.)","ig"),aa=function(a,b,c){var d="0x"+b-65536;return d!=d||c?b:d<0?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},ba=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ca=function(a,b){return b?"\0"===a?"�":a.slice(0,-1)+"\\"+a.charCodeAt(a.length-1).toString(16)+" ":"\\"+a},da=function(){m()},ea=ta(function(a){return!0===a.disabled&&("form"in a||"label"in a)},{dir:"parentNode",next:"legend"});try{G.apply(D=H.call(v.childNodes),v.childNodes),D[v.childNodes.length].nodeType}catch(fa){G={apply:D.length?function(a,b){F.apply(a,H.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}c=ga.support={},f=ga.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return!!b&&"HTML"!==b.nodeName},m=ga.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),v!==n&&(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ja(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ja(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Y.test(n.getElementsByClassName),c.getById=ja(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.filter.ID=function(a){var b=a.replace(_,aa);return function(a){return a.getAttribute("id")===b}},d.find.ID=function(a,b){if(void 0!==b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}}):(d.filter.ID=function(a){var b=a.replace(_,aa);return function(a){var c=void 0!==a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}},d.find.ID=function(a,b){if(void 0!==b.getElementById&&p){var c,d,e,f=b.getElementById(a);if(f){if((c=f.getAttributeNode("id"))&&c.value===a)return[f];for(e=b.getElementsByName(a),d=0;f=e[d++];)if((c=f.getAttributeNode("id"))&&c.value===a)return[f]}return[]}}),d.find.TAG=c.getElementsByTagName?function(a,b){return void 0!==b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){if(void 0!==b.getElementsByClassName&&p)return b.getElementsByClassName(a)},r=[],q=[],(c.qsa=Y.test(n.querySelectorAll))&&(ja(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+K+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+K+"*(?:value|"+J+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ja(function(a){a.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+K+"*[*^$|!~]?="),2!==a.querySelectorAll(":enabled").length&&q.push(":enabled",":disabled"),o.appendChild(a).disabled=!0,2!==a.querySelectorAll(":disabled").length&&q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Y.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ja(function(a){c.disconnectedMatch=s.call(a,"*"),s.call(a,"[s!='']:x"),r.push("!=",N)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Y.test(o.compareDocumentPosition),t=b||Y.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d||(1&(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?I(k,a)-I(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?I(k,a)-I(k,b):0;if(e===f)return la(a,b);for(c=a;c=c.parentNode;)g.unshift(c);for(c=b;c=c.parentNode;)h.unshift(c);for(;g[d]===h[d];)d++;return d?la(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},ga.matches=function(a,b){return ga(a,null,null,b)},ga.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(S,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return ga(b,n,null,[a]).length>0},ga.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},ga.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&C.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},ga.escape=function(a){return(a+"").replace(ba,ca)},ga.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},ga.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){for(;b=a[f++];)b===a[f]&&(e=d.push(f));for(;e--;)a.splice(d[e],1)}return k=null,a},e=ga.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else for(;b=a[d++];)c+=e(b);return c},(d=ga.selectors={cacheLength:50,createPseudo:ia,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(_,aa),a[3]=(a[3]||a[4]||a[5]||"").replace(_,aa),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||ga.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&ga.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return V.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&T.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(_,aa).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+K+")"+a+"("+K+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||void 0!==a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=ga.attr(d,a);return null==e?"!="===b:!b||(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(O," ")+" ").indexOf(c)>-1:"|="===b&&(e===c||e.slice(0,c.length+1)===c+"-"))}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){for(;p;){for(m=b;m=m[p];)if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(t=(n=(j=(k=(l=(m=q)[u]||(m[u]={}))[m.uniqueID]||(l[m.uniqueID]={}))[a]||[])[0]===w&&j[1])&&j[2],m=n&&q.childNodes[n];m=++n&&m&&m[p]||(t=n=0)||o.pop();)if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),!1===t)for(;(m=++n&&m&&m[p]||(t=n=0)||o.pop())&&((h?m.nodeName.toLowerCase()!==r:1!==m.nodeType)||!++t||(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m!==b)););return(t-=e)===d||t%d==0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||ga.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ia(function(a,c){for(var d,f=e(a,b),g=f.length;g--;)d=I(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ia(function(a){var b=[],c=[],d=h(a.replace(P,"$1"));return d[u]?ia(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ia(function(a){return function(b){return ga(a,b).length>0}}),contains:ia(function(a){return a=a.replace(_,aa),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ia(function(a){return U.test(a||"")||ga.error("unsupported lang: "+a),a=a.replace(_,aa).toLowerCase(),function(b){var c;do{if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return(c=c.toLowerCase())===a||0===c.indexOf(a+"-")}while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:oa(!1),disabled:oa(!0),checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,!0===a.selected},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return X.test(a.nodeName)},input:function(a){return W.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:pa(function(){return[0]}),last:pa(function(a,b){return[b-1]}),eq:pa(function(a,b,c){return[c<0?c+b:c]}),even:pa(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:pa(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:pa(function(a,b,c){for(var d=c<0?c+b:c;--d>=0;)a.push(d);return a}),gt:pa(function(a,b,c){for(var d=c<0?c+b:c;++d<b;)a.push(d);return a})}}).pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=ma(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=na(b);return ra.prototype=d.filters=d.pseudos,d.setFilters=new ra,g=ga.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);for(h=a,i=[],j=d.preFilter;h;){c&&!(e=Q.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=R.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(P," ")}),h=h.slice(c.length));for(g in d.filter)!(e=V[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?ga.error(a):z(a,i).slice(0)},h=ga.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){for(b||(b=g(a)),c=b.length;c--;)(f=ya(b[c]))[u]?d.push(f):e.push(f);(f=A(a,za(e,d))).selector=a}return f},i=ga.select=function(a,b,c,e){var f,i,j,k,l,m="function"==typeof a&&a,n=!e&&g(a=m.selector||a);if(c=c||[],1===n.length){if((i=n[0]=n[0].slice(0)).length>2&&"ID"===(j=i[0]).type&&9===b.nodeType&&p&&d.relative[i[1].type]){if(!(b=(d.find.ID(j.matches[0].replace(_,aa),b)||[])[0]))return c;m&&(b=b.parentNode),a=a.slice(i.shift().value.length)}for(f=V.needsContext.test(a)?0:i.length;f--&&(j=i[f],!d.relative[k=j.type]);)if((l=d.find[k])&&(e=l(j.matches[0].replace(_,aa),$.test(i[0].type)&&qa(b.parentNode)||b))){if(i.splice(f,1),!(a=e.length&&sa(i)))return G.apply(c,e),c;break}}return(m||h(a,n))(e,b,!p,c,!b||$.test(a)&&qa(b.parentNode)||b),c},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ja(function(a){return 1&a.compareDocumentPosition(n.createElement("fieldset"))}),ja(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ka("type|href|height|width",function(a,b,c){if(!c)return a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ja(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ka("value",function(a,b,c){if(!c&&"input"===a.nodeName.toLowerCase())return a.defaultValue}),ja(function(a){return null==a.getAttribute("disabled")})||ka(J,function(a,b,c){var d;if(!c)return!0===a[b]?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),ga}(a);r.find=x,r.expr=x.selectors,r.expr[":"]=r.expr.pseudos,r.uniqueSort=r.unique=x.uniqueSort,r.text=x.getText,r.isXMLDoc=x.isXML,r.contains=x.contains,r.escapeSelector=x.escape;var y=function(a,b,c){for(var d=[],e=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(e&&r(a).is(c))break;d.push(a)}return d},z=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},A=r.expr.match.needsContext,C=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,D=/^.[^:#\[\.,]*$/;r.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?r.find.matchesSelector(d,a)?[d]:[]:r.find.matches(a,r.grep(b,function(a){return 1===a.nodeType}))},r.fn.extend({find:function(a){var b,c,d=this.length,e=this;if("string"!=typeof a)return this.pushStack(r(a).filter(function(){for(b=0;b<d;b++)if(r.contains(e[b],this))return!0}));for(c=this.pushStack([]),b=0;b<d;b++)r.find(a,e[b],c);return d>1?r.uniqueSort(c):c},filter:function(a){return this.pushStack(E(this,a||[],!1))},not:function(a){return this.pushStack(E(this,a||[],!0))},is:function(a){return!!E(this,"string"==typeof a&&A.test(a)?r(a):a||[],!1).length}});var F,G=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(r.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||F,"string"==typeof a){if(!(e="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:G.exec(a))||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof r?b[0]:b,r.merge(this,r.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),C.test(e[1])&&r.isPlainObject(b))for(e in b)r.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}return(f=d.getElementById(e[2]))&&(this[0]=f,this.length=1),this}return a.nodeType?(this[0]=a,this.length=1,this):r.isFunction(a)?void 0!==c.ready?c.ready(a):a(r):r.makeArray(a,this)}).prototype=r.fn,F=r(d);var I=/^(?:parents|prev(?:Until|All))/,J={children:!0,contents:!0,next:!0,prev:!0};r.fn.extend({has:function(a){var b=r(a,this),c=b.length;return this.filter(function(){for(var a=0;a<c;a++)if(r.contains(this,b[a]))return!0})},closest:function(a,b){var c,d=0,e=this.length,f=[],g="string"!=typeof a&&r(a);if(!A.test(a))for(;d<e;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&r.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?r.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?i.call(r(a),this[0]):i.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(r.uniqueSort(r.merge(this.get(),r(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),r.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return y(a,"parentNode")},parentsUntil:function(a,b,c){return y(a,"parentNode",c)},next:function(a){return K(a,"nextSibling")},prev:function(a){return K(a,"previousSibling")},nextAll:function(a){return y(a,"nextSibling")},prevAll:function(a){return y(a,"previousSibling")},nextUntil:function(a,b,c){return y(a,"nextSibling",c)},prevUntil:function(a,b,c){return y(a,"previousSibling",c)},siblings:function(a){return z((a.parentNode||{}).firstChild,a)},children:function(a){return z(a.firstChild)},contents:function(a){return B(a,"iframe")?a.contentDocument:(B(a,"template")&&(a=a.content||a),r.merge([],a.childNodes))}},function(a,b){r.fn[a]=function(c,d){var e=r.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=r.filter(d,e)),this.length>1&&(J[a]||r.uniqueSort(e),I.test(a)&&e.reverse()),this.pushStack(e)}});var L=/[^\x20\t\r\n\f]+/g;r.Callbacks=function(a){a="string"==typeof a?function(a){var b={};return r.each(a.match(L)||[],function(a,c){b[c]=!0}),b}(a):r.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=e||a.once,d=b=!0;g.length;h=-1)for(c=g.shift();++h<f.length;)!1===f[h].apply(c[0],c[1])&&a.stopOnFalse&&(h=f.length,c=!1);a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){r.each(b,function(b,c){r.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==r.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return r.each(arguments,function(a,b){for(var c;(c=r.inArray(b,f,c))>-1;)f.splice(c,1),c<=h&&h--}),this},has:function(a){return a?r.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=g=[],c||b||(f=c=""),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j},r.extend({Deferred:function(b){var c=[["notify","progress",r.Callbacks("memory"),r.Callbacks("memory"),2],["resolve","done",r.Callbacks("once memory"),r.Callbacks("once memory"),0,"resolved"],["reject","fail",r.Callbacks("once memory"),r.Callbacks("once memory"),1,"rejected"]],d="pending",e={state:function(){return d},always:function(){return f.done(arguments).fail(arguments),this},catch:function(a){return e.then(null,a)},pipe:function(){var a=arguments;return r.Deferred(function(b){r.each(c,function(c,d){var e=r.isFunction(a[d[4]])&&a[d[4]];f[d[1]](function(){var a=e&&e.apply(this,arguments);a&&r.isFunction(a.promise)?a.promise().progress(b.notify).done(b.resolve).fail(b.reject):b[d[0]+"With"](this,e?[a]:arguments)})}),a=null}).promise()},then:function(b,d,e){function g(b,c,d,e){return function(){var h=this,i=arguments,j=function(){var a,j;if(!(b<f)){if((a=d.apply(h,i))===c.promise())throw new TypeError("Thenable self-resolution");j=a&&("object"==typeof a||"function"==typeof a)&&a.then,r.isFunction(j)?e?j.call(a,g(f,c,N,e),g(f,c,O,e)):(f++,j.call(a,g(f,c,N,e),g(f,c,O,e),g(f,c,N,c.notifyWith))):(d!==N&&(h=void 0,i=[a]),(e||c.resolveWith)(h,i))}},k=e?j:function(){try{j()}catch(a){r.Deferred.exceptionHook&&r.Deferred.exceptionHook(a,k.stackTrace),b+1>=f&&(d!==O&&(h=void 0,i=[a]),c.rejectWith(h,i))}};b?k():(r.Deferred.getStackHook&&(k.stackTrace=r.Deferred.getStackHook()),a.setTimeout(k))}}var f=0;return r.Deferred(function(a){c[0][3].add(g(0,a,r.isFunction(e)?e:N,a.notifyWith)),c[1][3].add(g(0,a,r.isFunction(b)?b:N)),c[2][3].add(g(0,a,r.isFunction(d)?d:O))}).promise()},promise:function(a){return null!=a?r.extend(a,e):e}},f={};return r.each(c,function(a,b){var g=b[2],h=b[5];e[b[1]]=g.add,h&&g.add(function(){d=h},c[3-a][2].disable,c[0][2].lock),g.add(b[3].fire),f[b[0]]=function(){return f[b[0]+"With"](this===f?void 0:this,arguments),this},f[b[0]+"With"]=g.fireWith}),e.promise(f),b&&b.call(f,f),f},when:function(a){var b=arguments.length,c=b,d=Array(c),e=f.call(arguments),g=r.Deferred(),h=function(a){return function(c){d[a]=this,e[a]=arguments.length>1?f.call(arguments):c,--b||g.resolveWith(d,e)}};if(b<=1&&(P(a,g.done(h(c)).resolve,g.reject,!b),"pending"===g.state()||r.isFunction(e[c]&&e[c].then)))return g.then();for(;c--;)P(e[c],h(c),g.reject);return g.promise()}});var Q=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;r.Deferred.exceptionHook=function(b,c){a.console&&a.console.warn&&b&&Q.test(b.name)&&a.console.warn("jQuery.Deferred exception: "+b.message,b.stack,c)},r.readyException=function(b){a.setTimeout(function(){throw b})};var R=r.Deferred();r.fn.ready=function(a){return R.then(a).catch(function(a){r.readyException(a)}),this},r.extend({isReady:!1,readyWait:1,ready:function(a){(!0===a?--r.readyWait:r.isReady)||(r.isReady=!0,!0!==a&&--r.readyWait>0||R.resolveWith(d,[r]))}}),r.ready.then=R.then,"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll?a.setTimeout(r.ready):(d.addEventListener("DOMContentLoaded",S),a.addEventListener("load",S));var T=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===r.type(c)){e=!0;for(h in c)T(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,r.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(r(a),c)})),b))for(;h<i;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},U=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};V.uid=1,V.prototype={cache:function(a){var b=a[this.expando];return b||(b={},U(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var d,e=this.cache(a);if("string"==typeof b)e[r.camelCase(b)]=c;else for(d in b)e[r.camelCase(d)]=b[d];return e},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][r.camelCase(b)]},access:function(a,b,c){return void 0===b||b&&"string"==typeof b&&void 0===c?this.get(a,b):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d=a[this.expando];if(void 0!==d){if(void 0!==b){Array.isArray(b)?b=b.map(r.camelCase):(b=r.camelCase(b),b=b in d?[b]:b.match(L)||[]),c=b.length;for(;c--;)delete d[b[c]]}(void 0===b||r.isEmptyObject(d))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var b=a[this.expando];return void 0!==b&&!r.isEmptyObject(b)}};var W=new V,X=new V,Y=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Z=/[A-Z]/g;r.extend({hasData:function(a){return X.hasData(a)||W.hasData(a)},data:function(a,b,c){return X.access(a,b,c)},removeData:function(a,b){X.remove(a,b)},_data:function(a,b,c){return W.access(a,b,c)},_removeData:function(a,b){W.remove(a,b)}}),r.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=X.get(f),1===f.nodeType&&!W.get(f,"hasDataAttrs"))){for(c=g.length;c--;)g[c]&&0===(d=g[c].name).indexOf("data-")&&(d=r.camelCase(d.slice(5)),_(f,d,e[d]));W.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){X.set(this,a)}):T(this,function(b){var c;if(f&&void 0===b){if(void 0!==(c=X.get(f,a)))return c;if(void 0!==(c=_(f,a)))return c}else this.each(function(){X.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){X.remove(this,a)})}}),r.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=W.get(a,b),c&&(!d||Array.isArray(c)?d=W.access(a,b,r.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=r.queue(a,b),d=c.length,e=c.shift(),f=r._queueHooks(a,b);"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,function(){r.dequeue(a,b)},f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return W.get(a,c)||W.access(a,c,{empty:r.Callbacks("once memory").add(function(){W.remove(a,[b+"queue",c])})})}}),r.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?r.queue(this[0],a):void 0===b?this:this.each(function(){var c=r.queue(this,a,b);r._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&r.dequeue(this,a)})},dequeue:function(a){return this.each(function(){r.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=r.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)(c=W.get(f[g],a+"queueHooks"))&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var aa=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ba=new RegExp("^(?:([+-])=|)("+aa+")([a-z%]*)$","i"),ca=["Top","Right","Bottom","Left"],da=function(a,b){return"none"===(a=b||a).style.display||""===a.style.display&&r.contains(a.ownerDocument,a)&&"none"===r.css(a,"display")},ea=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e},ga={};r.fn.extend({show:function(){return ia(this,!0)},hide:function(){return ia(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){da(this)?r(this).show():r(this).hide()})}});var ja=/^(?:checkbox|radio)$/i,ka=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,la=/^$|\/(?:java|ecma)script/i,ma={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ma.optgroup=ma.option,ma.tbody=ma.tfoot=ma.colgroup=ma.caption=ma.thead,ma.th=ma.td;var pa=/<|&#?\w+;/;!function(){var b=d.createDocumentFragment().appendChild(d.createElement("div")),c=d.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),o.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",o.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var ra=d.documentElement,sa=/^key/,ta=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ua=/^([^.]*)(?:\.(.+)|)/;r.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=W.get(a);if(q)for(c.handler&&(f=c,c=f.handler,e=f.selector),e&&r.find.matchesSelector(ra,e),c.guid||(c.guid=r.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return void 0!==r&&r.event.triggered!==b.type?r.event.dispatch.apply(a,arguments):void 0}),j=(b=(b||"").match(L)||[""]).length;j--;)h=ua.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=r.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=r.event.special[n]||{},k=r.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&r.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&!1!==l.setup.call(a,d,o,g)||a.addEventListener&&a.addEventListener(n,g)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),r.event.global[n]=!0)},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=W.hasData(a)&&W.get(a);if(q&&(i=q.events)){for(j=(b=(b||"").match(L)||[""]).length;j--;)if(h=ua.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=r.event.special[n]||{},m=i[n=(d?l.delegateType:l.bindType)||n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&!1!==l.teardown.call(a,o,q.handle)||r.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)r.event.remove(a,n+b[j],c,d,!0);r.isEmptyObject(i)&&W.remove(a,"handle events")}},dispatch:function(a){var c,d,e,f,g,h,b=r.event.fix(a),i=new Array(arguments.length),j=(W.get(this,"events")||{})[b.type]||[],k=r.event.special[b.type]||{};for(i[0]=b,c=1;c<arguments.length;c++)i[c]=arguments[c];if(b.delegateTarget=this,!k.preDispatch||!1!==k.preDispatch.call(this,b)){for(h=r.event.handlers.call(this,b,j),c=0;(f=h[c++])&&!b.isPropagationStopped();)for(b.currentTarget=f.elem,d=0;(g=f.handlers[d++])&&!b.isImmediatePropagationStopped();)b.rnamespace&&!b.rnamespace.test(g.namespace)||(b.handleObj=g,b.data=g.data,void 0!==(e=((r.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i))&&!1===(b.result=e)&&(b.preventDefault(),b.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,b),b.result}},handlers:function(a,b){var c,d,e,f,g,h=[],i=b.delegateCount,j=a.target;if(i&&j.nodeType&&!("click"===a.type&&a.button>=1))for(;j!==this;j=j.parentNode||this)if(1===j.nodeType&&("click"!==a.type||!0!==j.disabled)){for(f=[],g={},c=0;c<i;c++)d=b[c],e=d.selector+" ",void 0===g[e]&&(g[e]=d.needsContext?r(e,this).index(j)>-1:r.find(e,this,null,[j]).length),g[e]&&f.push(d);f.length&&h.push({elem:j,handlers:f})}return j=this,i<b.length&&h.push({elem:j,handlers:b.slice(i)}),h},addProp:function(a,b){Object.defineProperty(r.Event.prototype,a,{enumerable:!0,configurable:!0,get:r.isFunction(b)?function(){if(this.originalEvent)return b(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[a]},set:function(b){Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:b})}})},fix:function(a){return a[r.expando]?a:new r.Event(a)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==xa()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===xa()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&B(this,"input"))return this.click(),!1},_default:function(a){return B(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},r.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)},r.Event=function(a,b){return this instanceof r.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?va:wa,this.target=a.target&&3===a.target.nodeType?a.target.parentNode:a.target,this.currentTarget=a.currentTarget,this.relatedTarget=a.relatedTarget):this.type=a,b&&r.extend(this,b),this.timeStamp=a&&a.timeStamp||r.now(),void(this[r.expando]=!0)):new r.Event(a,b)},r.Event.prototype={constructor:r.Event,isDefaultPrevented:wa,isPropagationStopped:wa,isImmediatePropagationStopped:wa,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=va,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=va,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=va,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},r.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(a){var b=a.button;return null==a.which&&sa.test(a.type)?null!=a.charCode?a.charCode:a.keyCode:!a.which&&void 0!==b&&ta.test(a.type)?1&b?1:2&b?3:4&b?2:0:a.which}},r.event.addProp),r.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){r.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,e=a.relatedTarget,f=a.handleObj;return e&&(e===this||r.contains(this,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),r.fn.extend({on:function(a,b,c,d){return ya(this,a,b,c,d)},one:function(a,b,c,d){return ya(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,r(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return!1!==b&&"function"!=typeof b||(c=b,b=void 0),!1===c&&(c=wa),this.each(function(){r.event.remove(this,a,c,b)})}});var za=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Aa=/<script|<style|<link/i,Ba=/checked\s*(?:[^=]|=\s*.checked.)/i,Ca=/^true\/(.*)/,Da=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;r.extend({htmlPrefilter:function(a){return a.replace(za,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=r.contains(a.ownerDocument,a);if(!(o.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||r.isXMLDoc(a)))for(g=na(h),f=na(a),d=0,e=f.length;d<e;d++)Ia(f[d],g[d]);if(b)if(c)for(f=f||na(a),g=g||na(h),d=0,e=f.length;d<e;d++)Ha(f[d],g[d]);else Ha(a,h);return(g=na(h,"script")).length>0&&oa(g,!i&&na(a,"script")),h},cleanData:function(a){for(var b,c,d,e=r.event.special,f=0;void 0!==(c=a[f]);f++)if(U(c)){if(b=c[W.expando]){if(b.events)for(d in b.events)e[d]?r.event.remove(c,d):r.removeEvent(c,d,b.handle);c[W.expando]=void 0}c[X.expando]&&(c[X.expando]=void 0)}}}),r.fn.extend({detach:function(a){return Ka(this,a,!0)},remove:function(a){return Ka(this,a)},text:function(a){return T(this,function(a){return void 0===a?r.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return Ja(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){Ea(this,a).appendChild(a)}})},prepend:function(){return Ja(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ea(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return Ja(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return Ja(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(r.cleanData(na(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return r.clone(this,a,b)})},html:function(a){return T(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!Aa.test(a)&&!ma[(ka.exec(a)||["",""])[1].toLowerCase()]){a=r.htmlPrefilter(a);try{for(;c<d;c++)1===(b=this[c]||{}).nodeType&&(r.cleanData(na(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return Ja(this,arguments,function(b){var c=this.parentNode;r.inArray(this,a)<0&&(r.cleanData(na(this)),c&&c.replaceChild(b,this))},a)}}),r.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){r.fn[a]=function(a){for(var c,d=[],e=r(a),f=e.length-1,g=0;g<=f;g++)c=g===f?this:this.clone(!0),r(e[g])[b](c),h.apply(d,c.get());return this.pushStack(d)}});var La=/^margin/,Ma=new RegExp("^("+aa+")(?!px)[a-z%]+$","i"),Na=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)};!function(){function b(){if(i){i.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",i.innerHTML="",ra.appendChild(h);var b=a.getComputedStyle(i);c="1%"!==b.top,g="2px"===b.marginLeft,e="4px"===b.width,i.style.marginRight="50%",f="4px"===b.marginRight,ra.removeChild(h),i=null}}var c,e,f,g,h=d.createElement("div"),i=d.createElement("div");i.style&&(i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",o.clearCloneStyle="content-box"===i.style.backgroundClip,h.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",h.appendChild(i),r.extend(o,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return b(),e},pixelMarginRight:function(){return b(),f},reliableMarginLeft:function(){return b(),g}}))}();var Qa=/^(none|table(?!-c[ea]).+)/,Ra=/^--/,Sa={position:"absolute",visibility:"hidden",display:"block"},Ta={letterSpacing:"0",fontWeight:"400"},Ua=["Webkit","Moz","ms"],Va=d.createElement("div").style;r.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Oa(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=r.camelCase(b),i=Ra.test(b),j=a.style;return i||(b=Xa(h)),g=r.cssHooks[b]||r.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:j[b]:("string"===(f=typeof c)&&(e=ba.exec(c))&&e[1]&&(c=fa(a,b,e),f="number"),void(null!=c&&c==c&&("number"===f&&(c+=e&&e[3]||(r.cssNumber[h]?"":"px")),o.clearCloneStyle||""!==c||0!==b.indexOf("background")||(j[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i?j.setProperty(b,c):j[b]=c))))}},css:function(a,b,c,d){var e,f,g,h=r.camelCase(b);return Ra.test(b)||(b=Xa(h)),(g=r.cssHooks[b]||r.cssHooks[h])&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=Oa(a,b,d)),"normal"===e&&b in Ta&&(e=Ta[b]),""===c||c?(f=parseFloat(e),!0===c||isFinite(f)?f||0:e):e}}),r.each(["height","width"],function(a,b){r.cssHooks[b]={get:function(a,c,d){if(c)return!Qa.test(r.css(a,"display"))||a.getClientRects().length&&a.getBoundingClientRect().width?$a(a,b,d):ea(a,Sa,function(){return $a(a,b,d)})},set:function(a,c,d){var e,f=d&&Na(a),g=d&&Za(a,b,d,"border-box"===r.css(a,"boxSizing",!1,f),f);return g&&(e=ba.exec(c))&&"px"!==(e[3]||"px")&&(a.style[b]=c,c=r.css(a,b)),Ya(0,c,g)}}}),r.cssHooks.marginLeft=Pa(o.reliableMarginLeft,function(a,b){if(b)return(parseFloat(Oa(a,"marginLeft"))||a.getBoundingClientRect().left-ea(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px"}),r.each({margin:"",padding:"",border:"Width"},function(a,b){r.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];d<4;d++)e[a+ca[d]+b]=f[d]||f[d-2]||f[0];return e}},La.test(a)||(r.cssHooks[a+b].set=Ya)}),r.fn.extend({css:function(a,b){return T(this,function(a,b,c){var d,e,f={},g=0;if(Array.isArray(b)){for(d=Na(a),e=b.length;g<e;g++)f[b[g]]=r.css(a,b[g],!1,d);return f}return void 0!==c?r.style(a,b,c):r.css(a,b)},a,b,arguments.length>1)}}),r.Tween=_a,(_a.prototype={constructor:_a,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||r.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(r.cssNumber[c]?"":"px")},cur:function(){var a=_a.propHooks[this.prop];return a&&a.get?a.get(this):_a.propHooks._default.get(this)},run:function(a){var b,c=_a.propHooks[this.prop];return this.options.duration?this.pos=b=r.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):_a.propHooks._default.set(this),this}}).init.prototype=_a.prototype,(_a.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=r.css(a.elem,a.prop,""))&&"auto"!==b?b:0},set:function(a){r.fx.step[a.prop]?r.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[r.cssProps[a.prop]]&&!r.cssHooks[a.prop]?a.elem[a.prop]=a.now:r.style(a.elem,a.prop,a.now+a.unit)}}}).scrollTop=_a.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},r.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},r.fx=_a.prototype.init,r.fx.step={};var ab,bb,cb=/^(?:toggle|show|hide)$/,db=/queueHooks$/;r.Animation=r.extend(kb,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return fa(c.elem,a,ba.exec(b),c),c}]},tweener:function(a,b){r.isFunction(a)?(b=a,a=["*"]):a=a.match(L);for(var c,d=0,e=a.length;d<e;d++)c=a[d],kb.tweeners[c]=kb.tweeners[c]||[],kb.tweeners[c].unshift(b)},prefilters:[function(a,b,c){var d,e,f,g,h,i,j,k,l="width"in b||"height"in b,m=this,n={},o=a.style,p=a.nodeType&&da(a),q=W.get(a,"fxshow");c.queue||(null==(g=r._queueHooks(a,"fx")).unqueued&&(g.unqueued=0,h=g.empty.fire,g.empty.fire=function(){g.unqueued||h()}),g.unqueued++,m.always(function(){m.always(function(){g.unqueued--,r.queue(a,"fx").length||g.empty.fire()})}));for(d in b)if(e=b[d],cb.test(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}n[d]=q&&q[d]||r.style(a,d)}if((i=!r.isEmptyObject(b))||!r.isEmptyObject(n)){l&&1===a.nodeType&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],null==(j=q&&q.display)&&(j=W.get(a,"display")),"none"===(k=r.css(a,"display"))&&(j?k=j:(ia([a],!0),j=a.style.display||j,k=r.css(a,"display"),ia([a]))),("inline"===k||"inline-block"===k&&null!=j)&&"none"===r.css(a,"float")&&(i||(m.done(function(){o.display=j}),null==j&&(k=o.display,j="none"===k?"":k)),o.display="inline-block")),c.overflow&&(o.overflow="hidden",m.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]})),i=!1;for(d in n)i||(q?"hidden"in q&&(p=q.hidden):q=W.access(a,"fxshow",{display:j}),f&&(q.hidden=!p),p&&ia([a],!0),m.done(function(){p||ia([a]),W.remove(a,"fxshow");for(d in n)r.style(a,d,n[d])})),i=hb(p?q[d]:0,d,m),d in q||(q[d]=i.start,p&&(i.end=i.start,i.start=0))}}],prefilter:function(a,b){b?kb.prefilters.unshift(a):kb.prefilters.push(a)}}),r.speed=function(a,b,c){var d=a&&"object"==typeof a?r.extend({},a):{complete:c||!c&&b||r.isFunction(a)&&a,duration:a,easing:c&&b||b&&!r.isFunction(b)&&b};return r.fx.off?d.duration=0:"number"!=typeof d.duration&&(d.duration in r.fx.speeds?d.duration=r.fx.speeds[d.duration]:d.duration=r.fx.speeds._default),null!=d.queue&&!0!==d.queue||(d.queue="fx"),d.old=d.complete,d.complete=function(){r.isFunction(d.old)&&d.old.call(this),d.queue&&r.dequeue(this,d.queue)},d},r.fn.extend({fadeTo:function(a,b,c,d){return this.filter(da).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=r.isEmptyObject(a),f=r.speed(b,c,d),g=function(){var b=kb(this,r.extend({},a),f);(e||W.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||!1===f.queue?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&!1!==a&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=r.timers,g=W.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&db.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||r.dequeue(this,a)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var b,c=W.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=r.timers,g=d?d.length:0;for(c.finish=!0,r.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;b<g;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),r.each(["toggle","show","hide"],function(a,b){var c=r.fn[b];r.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(gb(b,!0),a,d,e)}}),r.each({slideDown:gb("show"),slideUp:gb("hide"),slideToggle:gb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){r.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),r.timers=[],r.fx.tick=function(){var a,b=0,c=r.timers;for(ab=r.now();b<c.length;b++)(a=c[b])()||c[b]!==a||c.splice(b--,1);c.length||r.fx.stop(),ab=void 0},r.fx.timer=function(a){r.timers.push(a),r.fx.start()},r.fx.interval=13,r.fx.start=function(){bb||(bb=!0,eb())},r.fx.stop=function(){bb=null},r.fx.speeds={slow:600,fast:200,_default:400},r.fn.delay=function(b,c){return b=r.fx?r.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a=d.createElement("input"),c=d.createElement("select").appendChild(d.createElement("option"));a.type="checkbox",o.checkOn=""!==a.value,o.optSelected=c.selected,(a=d.createElement("input")).value="t",a.type="radio",o.radioValue="t"===a.value}();var lb,mb=r.expr.attrHandle;r.fn.extend({attr:function(a,b){return T(this,r.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){r.removeAttr(this,a)})}}),r.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return void 0===a.getAttribute?r.prop(a,b,c):(1===f&&r.isXMLDoc(a)||(e=r.attrHooks[b.toLowerCase()]||(r.expr.match.bool.test(b)?lb:void 0)),void 0!==c?null===c?void r.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:null==(d=r.find.attr(a,b))?void 0:d)},attrHooks:{type:{set:function(a,b){if(!o.radioValue&&"radio"===b&&B(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d=0,e=b&&b.match(L);if(e&&1===a.nodeType)for(;c=e[d++];)a.removeAttribute(c)}}),lb={set:function(a,b,c){return!1===b?r.removeAttr(a,c):a.setAttribute(c,c),c}},r.each(r.expr.match.bool.source.match(/\w+/g),function(a,b){var c=mb[b]||r.find.attr;mb[b]=function(a,b,d){var e,f,g=b.toLowerCase();return d||(f=mb[g],mb[g]=e,e=null!=c(a,b,d)?g:null,mb[g]=f),e}});var nb=/^(?:input|select|textarea|button)$/i,ob=/^(?:a|area)$/i;r.fn.extend({prop:function(a,b){return T(this,r.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[r.propFix[a]||a]})}}),r.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&r.isXMLDoc(a)||(b=r.propFix[b]||b,e=r.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=r.find.attr(a,"tabindex");return b?parseInt(b,10):nb.test(a.nodeName)||ob.test(a.nodeName)&&a.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),o.optSelected||(r.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),r.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){r.propFix[this.toLowerCase()]=this}),r.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(r.isFunction(a))return this.each(function(b){r(this).addClass(a.call(this,b,qb(this)))});if("string"==typeof a&&a)for(b=a.match(L)||[];c=this[i++];)if(e=qb(c),d=1===c.nodeType&&" "+pb(e)+" "){for(g=0;f=b[g++];)d.indexOf(" "+f+" ")<0&&(d+=f+" ");e!==(h=pb(d))&&c.setAttribute("class",h)}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(r.isFunction(a))return this.each(function(b){r(this).removeClass(a.call(this,b,qb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a)for(b=a.match(L)||[];c=this[i++];)if(e=qb(c),d=1===c.nodeType&&" "+pb(e)+" "){for(g=0;f=b[g++];)for(;d.indexOf(" "+f+" ")>-1;)d=d.replace(" "+f+" "," ");e!==(h=pb(d))&&c.setAttribute("class",h)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):r.isFunction(a)?this.each(function(c){r(this).toggleClass(a.call(this,c,qb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c)for(d=0,e=r(this),f=a.match(L)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else void 0!==a&&"boolean"!==c||((b=qb(this))&&W.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||!1===a?"":W.get(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;for(b=" "+a+" ";c=this[d++];)if(1===c.nodeType&&(" "+pb(qb(c))+" ").indexOf(b)>-1)return!0;return!1}});var rb=/\r/g;r.fn.extend({val:function(a){var b,c,d,e=this[0];return arguments.length?(d=r.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(null==(e=d?a.call(this,c,r(this).val()):a)?e="":"number"==typeof e?e+="":Array.isArray(e)&&(e=r.map(e,function(a){return null==a?"":a+""})),(b=r.valHooks[this.type]||r.valHooks[this.nodeName.toLowerCase()])&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))})):e?(b=r.valHooks[e.type]||r.valHooks[e.nodeName.toLowerCase()])&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:"string"==typeof(c=e.value)?c.replace(rb,""):null==c?"":c:void 0}}),r.extend({valHooks:{option:{get:function(a){var b=r.find.attr(a,"value");return null!=b?b:pb(r.text(a))}},select:{get:function(a){var b,c,d,e=a.options,f=a.selectedIndex,g="select-one"===a.type,h=g?null:[],i=g?f+1:e.length;for(d=f<0?i:g?f:0;d<i;d++)if(((c=e[d]).selected||d===f)&&!c.disabled&&(!c.parentNode.disabled||!B(c.parentNode,"optgroup"))){if(b=r(c).val(),g)return b;h.push(b)}return h},set:function(a,b){for(var c,d,e=a.options,f=r.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=r.inArray(r.valHooks.option.get(d),f)>-1)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),r.each(["radio","checkbox"],function(){r.valHooks[this]={set:function(a,b){if(Array.isArray(b))return a.checked=r.inArray(r(a).val(),b)>-1}},o.checkOn||(r.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var sb=/^(?:focusinfocus|focusoutblur)$/;r.extend(r.event,{trigger:function(b,c,e,f){var g,h,i,j,k,m,n,o=[e||d],p=l.call(b,"type")?b.type:b,q=l.call(b,"namespace")?b.namespace.split("."):[];if(h=i=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!sb.test(p+r.event.triggered)&&(p.indexOf(".")>-1&&(q=p.split("."),p=q.shift(),q.sort()),k=p.indexOf(":")<0&&"on"+p,b=b[r.expando]?b:new r.Event(p,"object"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=q.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:r.makeArray(c,[b]),n=r.event.special[p]||{},f||!n.trigger||!1!==n.trigger.apply(e,c))){if(!f&&!n.noBubble&&!r.isWindow(e)){for(j=n.delegateType||p,sb.test(j+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),i=h;i===(e.ownerDocument||d)&&o.push(i.defaultView||i.parentWindow||a)}for(g=0;(h=o[g++])&&!b.isPropagationStopped();)b.type=g>1?j:n.bindType||p,(m=(W.get(h,"events")||{})[b.type]&&W.get(h,"handle"))&&m.apply(h,c),(m=k&&h[k])&&m.apply&&U(h)&&(b.result=m.apply(h,c),!1===b.result&&b.preventDefault());return b.type=p,f||b.isDefaultPrevented()||n._default&&!1!==n._default.apply(o.pop(),c)||!U(e)||k&&r.isFunction(e[p])&&!r.isWindow(e)&&((i=e[k])&&(e[k]=null),r.event.triggered=p,e[p](),r.event.triggered=void 0,i&&(e[k]=i)),b.result}},simulate:function(a,b,c){var d=r.extend(new r.Event,c,{type:a,isSimulated:!0});r.event.trigger(d,null,b)}}),r.fn.extend({trigger:function(a,b){return this.each(function(){r.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];if(c)return r.event.trigger(a,b,c,!0)}}),r.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(a,b){r.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),r.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),o.focusin="onfocusin"in a,o.focusin||r.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){r.event.simulate(b,a.target,r.event.fix(a))};r.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=W.access(d,b);e||d.addEventListener(a,c,!0),W.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=W.access(d,b)-1;e?W.access(d,b,e):(d.removeEventListener(a,c,!0),W.remove(d,b))}}});var tb=a.location,ub=r.now(),vb=/\?/;r.parseXML=function(b){var c;if(!b||"string"!=typeof b)return null;try{c=(new a.DOMParser).parseFromString(b,"text/xml")}catch(d){c=void 0}return c&&!c.getElementsByTagName("parsererror").length||r.error("Invalid XML: "+b),c};var wb=/\[\]$/,xb=/\r?\n/g,yb=/^(?:submit|button|image|reset|file)$/i,zb=/^(?:input|select|textarea|keygen)/i;r.param=function(a,b){var c,d=[],e=function(a,b){var c=r.isFunction(b)?b():b;d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(null==c?"":c)};if(Array.isArray(a)||a.jquery&&!r.isPlainObject(a))r.each(a,function(){e(this.name,this.value)});else for(c in a)Ab(c,a[c],b,e);return d.join("&")},r.fn.extend({serialize:function(){return r.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=r.prop(this,"elements");return a?r.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!r(this).is(":disabled")&&zb.test(this.nodeName)&&!yb.test(a)&&(this.checked||!ja.test(a))}).map(function(a,b){var c=r(this).val();return null==c?null:Array.isArray(c)?r.map(c,function(a){return{name:b.name,value:a.replace(xb,"\r\n")}}):{name:b.name,value:c.replace(xb,"\r\n")}}).get()}});var Bb=/%20/g,Cb=/#.*$/,Db=/([?&])_=[^&]*/,Eb=/^(.*?):[ \t]*([^\r\n]*)$/gm,Gb=/^(?:GET|HEAD)$/,Hb=/^\/\//,Ib={},Jb={},Kb="*/".concat("*"),Lb=d.createElement("a");Lb.href=tb.href,r.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:tb.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(tb.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Kb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":r.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Ob(Ob(a,r.ajaxSettings),b):Ob(r.ajaxSettings,a)},ajaxPrefilter:Mb(Ib),ajaxTransport:Mb(Jb),ajax:function(b,c){function A(b,c,d,h){var j,m,n,v,w,x=c;k||(k=!0,i&&a.clearTimeout(i),e=void 0,g=h||"",y.readyState=b>0?4:0,j=b>=200&&b<300||304===b,d&&(v=function(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}if(f)return f!==i[0]&&i.unshift(f),c[f]}(o,y,d)),v=function(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(!(g=j[i+" "+f]||j["* "+f]))for(e in j)if((h=e.split(" "))[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){!0===g?g=j[e]:!0!==j[e]&&(f=h[0],k.unshift(h[1]));break}if(!0!==g)if(g&&a.throws)b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}(o,v,y,j),j?(o.ifModified&&((w=y.getResponseHeader("Last-Modified"))&&(r.lastModified[f]=w),(w=y.getResponseHeader("etag"))&&(r.etag[f]=w)),204===b||"HEAD"===o.type?x="nocontent":304===b?x="notmodified":(x=v.state,m=v.data,n=v.error,j=!n)):(n=x,!b&&x||(x="error",b<0&&(b=0))),y.status=b,y.statusText=(c||x)+"",j?s.resolveWith(p,[m,x,y]):s.rejectWith(p,[y,x,n]),y.statusCode(u),u=void 0,l&&q.trigger(j?"ajaxSuccess":"ajaxError",[y,o,j?m:n]),t.fireWith(p,[y,x]),l&&(q.trigger("ajaxComplete",[y,o]),--r.active||r.event.trigger("ajaxStop")))}"object"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m,n,o=r.ajaxSetup({},c),p=o.context||o,q=o.context&&(p.nodeType||p.jquery)?r(p):r.event,s=r.Deferred(),t=r.Callbacks("once memory"),u=o.statusCode||{},v={},w={},x="canceled",y={readyState:0,getResponseHeader:function(a){var b;if(k){if(!h)for(h={};b=Eb.exec(g);)h[b[1].toLowerCase()]=b[2];b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return k?g:null},setRequestHeader:function(a,b){return null==k&&(a=w[a.toLowerCase()]=w[a.toLowerCase()]||a,v[a]=b),this},overrideMimeType:function(a){return null==k&&(o.mimeType=a),this},statusCode:function(a){var b;if(a)if(k)y.always(a[y.status]);else for(b in a)u[b]=[u[b],a[b]];return this},abort:function(a){var b=a||x;return e&&e.abort(b),A(0,b),this}};if(s.promise(y),o.url=((b||o.url||tb.href)+"").replace(Hb,tb.protocol+"//"),o.type=c.method||c.type||o.method||o.type,o.dataTypes=(o.dataType||"*").toLowerCase().match(L)||[""],null==o.crossDomain){j=d.createElement("a");try{j.href=o.url,j.href=j.href,o.crossDomain=Lb.protocol+"//"+Lb.host!=j.protocol+"//"+j.host}catch(z){o.crossDomain=!0}}if(o.data&&o.processData&&"string"!=typeof o.data&&(o.data=r.param(o.data,o.traditional)),Nb(Ib,o,c,y),k)return y;(l=r.event&&o.global)&&0==r.active++&&r.event.trigger("ajaxStart"),o.type=o.type.toUpperCase(),o.hasContent=!Gb.test(o.type),f=o.url.replace(Cb,""),o.hasContent?o.data&&o.processData&&0===(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&(o.data=o.data.replace(Bb,"+")):(n=o.url.slice(f.length),o.data&&(f+=(vb.test(f)?"&":"?")+o.data,delete o.data),!1===o.cache&&(f=f.replace(Db,"$1"),n=(vb.test(f)?"&":"?")+"_="+ub+++n),o.url=f+n),o.ifModified&&(r.lastModified[f]&&y.setRequestHeader("If-Modified-Since",r.lastModified[f]),r.etag[f]&&y.setRequestHeader("If-None-Match",r.etag[f])),(o.data&&o.hasContent&&!1!==o.contentType||c.contentType)&&y.setRequestHeader("Content-Type",o.contentType),y.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+("*"!==o.dataTypes[0]?", "+Kb+"; q=0.01":""):o.accepts["*"]);for(m in o.headers)y.setRequestHeader(m,o.headers[m]);if(o.beforeSend&&(!1===o.beforeSend.call(p,y,o)||k))return y.abort();if(x="abort",t.add(o.complete),y.done(o.success),y.fail(o.error),e=Nb(Jb,o,c,y)){if(y.readyState=1,l&&q.trigger("ajaxSend",[y,o]),k)return y;o.async&&o.timeout>0&&(i=a.setTimeout(function(){y.abort("timeout")},o.timeout));try{k=!1,e.send(v,A)}catch(z){if(k)throw z;A(-1,z)}}else A(-1,"No Transport");return y},getJSON:function(a,b,c){return r.get(a,b,c,"json")},getScript:function(a,b){return r.get(a,void 0,b,"script")}}),r.each(["get","post"],function(a,b){r[b]=function(a,c,d,e){return r.isFunction(c)&&(e=e||d,d=c,c=void 0),r.ajax(r.extend({url:a,type:b,dataType:e,data:c,success:d},r.isPlainObject(a)&&a))}}),r._evalUrl=function(a){return r.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},r.fn.extend({wrapAll:function(a){var b;return this[0]&&(r.isFunction(a)&&(a=a.call(this[0])),b=r(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(a){return r.isFunction(a)?this.each(function(b){r(this).wrapInner(a.call(this,b))}):this.each(function(){var b=r(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=r.isFunction(a);return this.each(function(c){r(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(a){return this.parent(a).not("body").each(function(){r(this).replaceWith(this.childNodes)}),this}}),r.expr.pseudos.hidden=function(a){return!r.expr.pseudos.visible(a)},r.expr.pseudos.visible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)},r.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(b){}};var Rb={0:200,1223:204},Sb=r.ajaxSettings.xhr();o.cors=!!Sb&&"withCredentials"in Sb,o.ajax=Sb=!!Sb,r.ajaxTransport(function(b){var c,d;if(o.cors||Sb&&!b.crossDomain)return{send:function(e,f){var g,h=b.xhr();if(h.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType),b.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");for(g in e)h.setRequestHeader(g,e[g]);c=function(a){return function(){c&&(c=d=h.onload=h.onerror=h.onabort=h.onreadystatechange=null,"abort"===a?h.abort():"error"===a?"number"!=typeof h.status?f(0,"error"):f(h.status,h.statusText):f(Rb[h.status]||h.status,h.statusText,"text"!==(h.responseType||"text")||"string"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=c(),d=h.onerror=c("error"),void 0!==h.onabort?h.onabort=d:h.onreadystatechange=function(){4===h.readyState&&a.setTimeout(function(){c&&d()})},c=c("abort");try{h.send(b.hasContent&&b.data||null)}catch(i){if(c)throw i}},abort:function(){c&&c()}}}),r.ajaxPrefilter(function(a){a.crossDomain&&(a.contents.script=!1)}),r.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return r.globalEval(a),a}}}),r.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),r.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(e,f){b=r("<script>").prop({charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&f("error"===a.type?404:200,a.type)}),d.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Tb=[],Ub=/(=)\?(?=&|$)|\?\?/;r.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Tb.pop()||r.expando+"_"+ub++;return this[a]=!0,a}}),r.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=!1!==b.jsonp&&(Ub.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ub.test(b.data)&&"data");if(h||"jsonp"===b.dataTypes[0])return e=b.jsonpCallback=r.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Ub,"$1"+e):!1!==b.jsonp&&(b.url+=(vb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||r.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?r(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Tb.push(e)),g&&r.isFunction(f)&&f(g[0]),g=f=void 0}),"script"}),o.createHTMLDocument=function(){var a=d.implementation.createHTMLDocument("").body;return a.innerHTML="<form></form><form></form>",2===a.childNodes.length}(),r.parseHTML=function(a,b,c){if("string"!=typeof a)return[];"boolean"==typeof b&&(c=b,b=!1);var e,f,g;return b||(o.createHTMLDocument?(b=d.implementation.createHTMLDocument(""),e=b.createElement("base"),e.href=d.location.href,b.head.appendChild(e)):b=d),f=C.exec(a),g=!c&&[],f?[b.createElement(f[1])]:(f=qa([a],b,g),g&&g.length&&r(g).remove(),r.merge([],f.childNodes))},r.fn.load=function(a,b,c){var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=pb(a.slice(h)),a=a.slice(0,h)),r.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&r.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?r("<div>").append(r.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},r.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){r.fn[b]=function(a){return this.on(b,a)}}),r.expr.pseudos.animated=function(a){return r.grep(r.timers,function(b){return a===b.elem}).length},r.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,k=r.css(a,"position"),l=r(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=r.css(a,"top"),i=r.css(a,"left"),("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),r.isFunction(b)&&(b=b.call(a,c,r.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},r.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){r.offset.setOffset(this,a,b)});var b,c,d,e,f=this[0];return f?f.getClientRects().length?(d=f.getBoundingClientRect(),b=f.ownerDocument,c=b.documentElement,e=b.defaultView,{top:d.top+e.pageYOffset-c.clientTop,left:d.left+e.pageXOffset-c.clientLeft}):{top:0,left:0}:void 0},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===r.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),B(a[0],"html")||(d=a.offset()),d={top:d.top+r.css(a[0],"borderTopWidth",!0),left:d.left+r.css(a[0],"borderLeftWidth",!0)}),{top:b.top-d.top-r.css(c,"marginTop",!0),left:b.left-d.left-r.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent;a&&"static"===r.css(a,"position");)a=a.offsetParent;return a||ra})}}),r.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c="pageYOffset"===b;r.fn[a]=function(d){return T(this,function(a,d,e){var f;return r.isWindow(a)?f=a:9===a.nodeType&&(f=a.defaultView),void 0===e?f?f[b]:a[d]:void(f?f.scrollTo(c?f.pageXOffset:e,c?e:f.pageYOffset):a[d]=e)},a,d,arguments.length)}}),r.each(["top","left"],function(a,b){r.cssHooks[b]=Pa(o.pixelPosition,function(a,c){if(c)return c=Oa(a,b),Ma.test(c)?r(a).position()[b]+"px":c})}),r.each({Height:"height",Width:"width"},function(a,b){r.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){r.fn[d]=function(e,f){var g=arguments.length&&(c||"boolean"!=typeof e),h=c||(!0===e||!0===f?"margin":"border");return T(this,function(b,c,e){var f;return r.isWindow(b)?0===d.indexOf("outer")?b["inner"+a]:b.document.documentElement["client"+a]:9===b.nodeType?(f=b.documentElement,Math.max(b.body["scroll"+a],f["scroll"+a],b.body["offset"+a],f["offset"+a],f["client"+a])):void 0===e?r.css(b,c,h):r.style(b,c,e,h)},b,g?e:void 0,g)}})}),r.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),r.holdReady=function(a){a?r.readyWait++:r.ready(!0)},r.isArray=Array.isArray,r.parseJSON=JSON.parse,r.nodeName=B,"function"==typeof define&&define.amd&&define("jquery",[],function(){return r});var Vb=a.jQuery,Wb=a.$;return r.noConflict=function(b){return a.$===r&&(a.$=Wb),b&&a.jQuery===r&&(a.jQuery=Vb),r},b||(a.jQuery=a.$=r),r}),void 0===jQuery.migrateMute&&(jQuery.migrateMute=!0),function(e){"function"==typeof define&&define.amd?define(["jquery"],window,e):"object"==typeof module&&module.exports?module.exports=e(require("jquery"),window):e(jQuery,window)}(function(e,t){"use strict";function r(r){var n=t.console;o[r]||(o[r]=!0,e.migrateWarnings.push(r),n&&n.warn&&!e.migrateMute&&(n.warn("JQMIGRATE: "+r),e.migrateTrace&&n.trace&&n.trace()))}function n(e,t,n,a){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return r(a),n},set:function(e){r(a),n=e}})}function a(e,t,n,a){e[t]=function(){return r(a),n.apply(this,arguments)}}e.migrateVersion="3.0.1",t.console&&t.console.log&&(e&&!/^[12]\./.test(e.fn.jquery)||t.console.log("JQMIGRATE: jQuery 3.0.0+ REQUIRED"),e.migrateWarnings&&t.console.log("JQMIGRATE: Migrate plugin loaded multiple times"),t.console.log("JQMIGRATE: Migrate is installed"+(e.migrateMute?"":" with logging active")+", version "+e.migrateVersion));var o={};e.migrateWarnings=[],void 0===e.migrateTrace&&(e.migrateTrace=!0),e.migrateReset=function(){o={},e.migrateWarnings.length=0},"BackCompat"===t.document.compatMode&&r("jQuery is not compatible with Quirks Mode");var i=e.fn.init,s=e.isNumeric,u=e.find,c=/\[(\s*[-\w]+\s*)([~|^$*]?=)\s*([-\w#]*?#[-\w#]*)\s*\]/,l=/\[(\s*[-\w]+\s*)([~|^$*]?=)\s*([-\w#]*?#[-\w#]*)\s*\]/g;e.fn.init=function(e){var t=Array.prototype.slice.call(arguments);return"string"==typeof e&&"#"===e&&(r("jQuery( '#' ) is not a valid selector"),t[0]=[]),i.apply(this,t)},e.fn.init.prototype=e.fn,e.find=function(e){var n=Array.prototype.slice.call(arguments);if("string"==typeof e&&c.test(e))try{t.document.querySelector(e)}catch(a){e=e.replace(l,function(e,t,r,n){return"["+t+r+'"'+n+'"]'});try{t.document.querySelector(e),r("Attribute selector with '#' must be quoted: "+n[0]),n[0]=e}catch(e){r("Attribute selector with '#' was not fixed: "+n[0])}}return u.apply(this,n)};var d;for(d in u)Object.prototype.hasOwnProperty.call(u,d)&&(e.find[d]=u[d]);e.fn.size=function(){return r("jQuery.fn.size() is deprecated and removed; use the .length property"),this.length},e.parseJSON=function(){return r("jQuery.parseJSON is deprecated; use JSON.parse"),JSON.parse.apply(null,arguments)},e.isNumeric=function(t){var n=s(t),a=function(t){var r=t&&t.toString();return!e.isArray(t)&&r-parseFloat(r)+1>=0}(t);return n!==a&&r("jQuery.isNumeric() should not be called on constructed objects"),a},a(e,"holdReady",e.holdReady,"jQuery.holdReady is deprecated"),a(e,"unique",e.uniqueSort,"jQuery.unique is deprecated; use jQuery.uniqueSort"),n(e.expr,"filters",e.expr.pseudos,"jQuery.expr.filters is deprecated; use jQuery.expr.pseudos"),n(e.expr,":",e.expr.pseudos,"jQuery.expr[':'] is deprecated; use jQuery.expr.pseudos");var p=e.ajax;e.ajax=function(){var e=p.apply(this,arguments);return e.promise&&(a(e,"success",e.done,"jQXHR.success is deprecated and removed"),a(e,"error",e.fail,"jQXHR.error is deprecated and removed"),a(e,"complete",e.always,"jQXHR.complete is deprecated and removed")),e};var f=e.fn.removeAttr,y=e.fn.toggleClass,m=/\S+/g;e.fn.removeAttr=function(t){var n=this;return e.each(t.match(m),function(t,a){e.expr.match.bool.test(a)&&(r("jQuery.fn.removeAttr no longer sets boolean properties: "+a),n.prop(a,!1))}),f.apply(this,arguments)},e.fn.toggleClass=function(t){return void 0!==t&&"boolean"!=typeof t?y.apply(this,arguments):(r("jQuery.fn.toggleClass( boolean ) is deprecated"),this.each(function(){var r=this.getAttribute&&this.getAttribute("class")||"";r&&e.data(this,"__className__",r),this.setAttribute&&this.setAttribute("class",r||!1===t?"":e.data(this,"__className__")||"")}))};var h=!1;e.swap&&e.each(["height","width","reliableMarginRight"],function(t,r){var n=e.cssHooks[r]&&e.cssHooks[r].get;n&&(e.cssHooks[r].get=function(){var e;return h=!0,e=n.apply(this,arguments),h=!1,e})}),e.swap=function(e,t,n,a){var o,i,s={};h||r("jQuery.swap() is undocumented and deprecated");for(i in t)s[i]=e.style[i],e.style[i]=t[i];o=n.apply(e,a||[]);for(i in t)e.style[i]=s[i];return o};var g=e.data;e.data=function(t,n,a){var o;if(n&&"object"==typeof n&&2===arguments.length){o=e.hasData(t)&&g.call(this,t);var i={};for(var s in n)s!==e.camelCase(s)?(r("jQuery.data() always sets/gets camelCased names: "+s),o[s]=n[s]):i[s]=n[s];return g.call(this,t,i),n}return n&&"string"==typeof n&&n!==e.camelCase(n)&&(o=e.hasData(t)&&g.call(this,t))&&n in o?(r("jQuery.data() always sets/gets camelCased names: "+n),arguments.length>2&&(o[n]=a),o[n]):g.apply(this,arguments)};var v=e.Tween.prototype.run,j=function(e){return e};e.Tween.prototype.run=function(){e.easing[this.easing].length>1&&(r("'jQuery.easing."+this.easing.toString()+"' should use only one argument"),e.easing[this.easing]=j),v.apply(this,arguments)},e.fx.interval=e.fx.interval||13,t.requestAnimationFrame&&n(e.fx,"interval",e.fx.interval,"jQuery.fx.interval is deprecated");var Q=e.fn.load,b=e.event.add,w=e.event.fix;e.event.props=[],e.event.fixHooks={},n(e.event.props,"concat",e.event.props.concat,"jQuery.event.props.concat() is deprecated and removed"),e.event.fix=function(t){var n,a=t.type,o=this.fixHooks[a],i=e.event.props;if(i.length)for(r("jQuery.event.props are deprecated and removed: "+i.join());i.length;)e.event.addProp(i.pop());if(o&&!o._migrated_&&(o._migrated_=!0,r("jQuery.event.fixHooks are deprecated and removed: "+a),(i=o.props)&&i.length))for(;i.length;)e.event.addProp(i.pop());return n=w.call(this,t),o&&o.filter?o.filter(n,t):n},e.event.add=function(e,n){return e===t&&"load"===n&&"complete"===t.document.readyState&&r("jQuery(window).on('load'...) called after load event occurred"),b.apply(this,arguments)},e.each(["load","unload","error"],function(t,n){e.fn[n]=function(){var e=Array.prototype.slice.call(arguments,0);return"load"===n&&"string"==typeof e[0]?Q.apply(this,e):(r("jQuery.fn."+n+"() is deprecated"),e.splice(0,0,n),arguments.length?this.on.apply(this,e):(this.triggerHandler.apply(this,e),this))}}),e.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(t,n){e.fn[n]=function(e,t){return r("jQuery.fn."+n+"() event shorthand is deprecated"),arguments.length>0?this.on(n,null,e,t):this.trigger(n)}}),e(function(){e(t.document).triggerHandler("ready")}),e.event.special.ready={setup:function(){this===t.document&&r("'ready' event is deprecated")}},e.fn.extend({bind:function(e,t,n){return r("jQuery.fn.bind() is deprecated"),this.on(e,null,t,n)},unbind:function(e,t){return r("jQuery.fn.unbind() is deprecated"),this.off(e,null,t)},delegate:function(e,t,n,a){return r("jQuery.fn.delegate() is deprecated"),this.on(t,e,n,a)},undelegate:function(e,t,n){return r("jQuery.fn.undelegate() is deprecated"),1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return r("jQuery.fn.hover() is deprecated"),this.on("mouseenter",e).on("mouseleave",t||e)}});var x=e.fn.offset;e.fn.offset=function(){var n,a=this[0],o={top:0,left:0};return a&&a.nodeType?(n=(a.ownerDocument||t.document).documentElement,e.contains(n,a)?x.apply(this,arguments):(r("jQuery.fn.offset() requires an element connected to a document"),o)):(r("jQuery.fn.offset() requires a valid DOM element"),o)};var k=e.param;e.param=function(t,n){var a=e.ajaxSettings&&e.ajaxSettings.traditional;return void 0===n&&a&&(r("jQuery.param() no longer uses jQuery.ajaxSettings.traditional"),n=a),k.call(this,t,n)};var A=e.fn.andSelf||e.fn.addBack;e.fn.andSelf=function(){return r("jQuery.fn.andSelf() is deprecated and removed, use jQuery.fn.addBack()"),A.apply(this,arguments)};var S=e.Deferred,q=[["resolve","done",e.Callbacks("once memory"),e.Callbacks("once memory"),"resolved"],["reject","fail",e.Callbacks("once memory"),e.Callbacks("once memory"),"rejected"],["notify","progress",e.Callbacks("memory"),e.Callbacks("memory")]];return e.Deferred=function(t){var n=S(),a=n.promise();return n.pipe=a.pipe=function(){var t=arguments;return r("deferred.pipe() is deprecated"),e.Deferred(function(r){e.each(q,function(o,i){var s=e.isFunction(t[o])&&t[o];n[i[1]](function(){var t=s&&s.apply(this,arguments);t&&e.isFunction(t.promise)?t.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[i[0]+"With"](this===a?r.promise():this,s?[t]:arguments)})}),t=null}).promise()},t&&t.call(n,n),n},e.Deferred.exceptionHook=S.exceptionHook,e}),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function s(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=n(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.on("mouseout",i,function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",i,o)}function o(){t.datepicker._isDisabledDatepicker(m.inline?m.dpDiv.parent()[0]:m.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function a(e,i){t.extend(e,i);for(var s in i)null==i[s]&&(e[s]=i[s]);return e}function r(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{},t.ui.version="1.12.1";var h=0,l=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{(s=t._data(n,"events"))&&s.remove&&t(n).triggerHandler("remove")}catch(a){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r={},h=e.split(".")[0],l=h+"-"+(e=e.split(".")[1]);return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][l.toLowerCase()]=function(e){return!!t.data(e,l)},t[h]=t[h]||{},n=t[h][e],o=t[h][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new o(t,e)},t.extend(o,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?void(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}()):void(r[e]=s)}),o.prototype=t.widget.extend(a,{widgetEventPrefix:n?a.widgetEventPrefix||e:e},r,{constructor:o,namespace:h,widgetName:e,widgetFullName:l}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var i,s,n=l.call(arguments,1),o=0,a=n.length;a>o;o++)for(i in n[o])s=n[o][i],n[o].hasOwnProperty(i)&&void 0!==s&&(e[i]=t.isPlainObject(s)?t.isPlainObject(e[i])?t.widget.extend({},e[i],s):t.widget.extend({},s):s);return e},t.widget.bridge=function(e,i){var s=i.prototype.widgetFullName||e;t.fn[e]=function(n){var o="string"==typeof n,a=l.call(arguments,1),r=this;return o?this.length||"instance"!==n?this.each(function(){var i,o=t.data(this,s);return"instance"===n?(r=o,!1):o?t.isFunction(o[n])&&"_"!==n.charAt(0)?(i=o[n].apply(o,a))!==o&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0:t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+n+"'")}):r=void 0:(a.length&&(n=t.widget.extend.apply(null,[n].concat(a))),this.each(function(){var e=t.data(this,s);e?(e.option(n||{}),e._init&&e._init()):t.data(this,s,new i(n,this))})),r}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=h++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,o,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},s=e.split("."),e=s.shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,s,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,o){var a,r;for(r=0;i.length>r;r++)a=n.classesElementLookup[i[r]]||t(),a=t(e.add?t.unique(a.get().concat(e.element.get())):a.not(e.element).get()),n.classesElementLookup[i[r]]=a,s.push(i[r]),o&&e.classes[i[r]]&&s.push(e.classes[i[r]])}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(s,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[s]=t(n.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,s){s="boolean"==typeof s?s:i;var n="string"==typeof t||null===t,o={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:s};return o.element.toggleClass(this._classes(o),s),this},_on:function(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,a){function r(){return e||!0!==o.options.disabled&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+o.eventNamespace,c=h[2];c?n.on(l,c,r):i.on(l,r)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){var s=this;return setTimeout(function(){return("string"==typeof t?s[t]:t).apply(s,arguments)},e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&!1===a.apply(this.element[0],[i].concat(s))||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?!0===n||"number"==typeof n?i:n.effect||i:e;"number"==typeof(n=n||{})&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(u.test(t[0])?e/100:1),parseFloat(t[1])*(u.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}var n,o=Math.max,a=Math.abs,r=/left|center|right/,h=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,u=/%$/,d=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==n)return n;var e,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return t("body").append(s),e=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,e===i&&(i=s[0].clientWidth),s.remove(),n=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth;return{width:"scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:!s&&!n?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var u,p,f,g,m,_,v=t(n.of),b=t.position.getWithinInfo(n.within),y=t.position.getScrollInfo(b),w=(n.collision||"flip").split(" "),k={};return _=function(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}(v),v[0].preventDefault&&(n.at="left top"),p=_.width,f=_.height,g=_.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):h.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=h.test(i[1])?i[1]:"center",t=l.exec(i[0]),e=l.exec(i[1]),k[this]=[t?t[0]:0,e?e[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),u=e(k.at,p,f),m.left+=u[0],m.top+=u[1],this.each(function(){var s,r,h=t(this),l=h.outerWidth(),c=h.outerHeight(),d=i(this,"marginLeft"),_=i(this,"marginTop"),x=l+d+i(this,"marginRight")+y.width,C=c+_+i(this,"marginBottom")+y.height,D=t.extend({},m),I=e(k.my,h.outerWidth(),h.outerHeight());"right"===n.my[0]?D.left-=l:"center"===n.my[0]&&(D.left-=l/2),"bottom"===n.my[1]?D.top-=c:"center"===n.my[1]&&(D.top-=c/2),D.left+=I[0],D.top+=I[1],s={marginLeft:d,marginTop:_},t.each(["left","top"],function(e,i){t.ui.position[w[e]]&&t.ui.position[w[e]][i](D,{targetWidth:p,targetHeight:f,elemWidth:l,elemHeight:c,collisionPosition:s,collisionWidth:x,collisionHeight:C,offset:[u[0]+I[0],u[1]+I[1]],my:n.my,at:n.at,within:b,elem:h})}),n.using&&(r=function(t){var e=g.left-D.left,i=e+p-l,s=g.top-D.top,r=s+f-c,u={target:{element:v,left:g.left,top:g.top,width:p,height:f},element:{element:h,left:D.left,top:D.top,width:l,height:c},horizontal:0>i?"left":e>0?"right":"center",vertical:0>r?"top":s>0?"bottom":"middle"};l>p&&p>a(e+i)&&(u.horizontal="center"),c>f&&f>a(s+r)&&(u.vertical="middle"),u.important=o(a(e),a(i))>o(a(s),a(r))?"horizontal":"vertical",n.using.call(this,t,u)}),h.offset(t.extend(D,{using:r}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=t.left-e.collisionPosition.marginLeft,h=n-r,l=r+e.collisionWidth-a-n;e.collisionWidth>a?h>0&&0>=l?(i=t.left+h+e.collisionWidth-a-n,t.left+=h-i):t.left=l>0&&0>=h?n:h>l?n+a-e.collisionWidth:n:h>0?t.left+=h:l>0?t.left-=l:t.left=o(t.left-r,t.left)},top:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,h=n-r,l=r+e.collisionHeight-a-n;e.collisionHeight>a?h>0&&0>=l?(i=t.top+h+e.collisionHeight-a-n,t.top+=h-i):t.top=l>0&&0>=h?n:h>l?n+a-e.collisionHeight:n:h>0?t.top+=h:l>0?t.top-=l:t.top=o(t.top-r,t.top)}},flip:{left:function(t,e){var i,s,n=e.within,o=n.offset.left+n.scrollLeft,r=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=t.left-e.collisionPosition.marginLeft,c=l-h,u=l+e.collisionWidth-r-h,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(0>(i=t.left+d+p+f+e.collisionWidth-r-o)||a(c)>i)&&(t.left+=d+p+f):u>0&&((s=t.left-e.collisionPosition.marginLeft+d+p+f-h)>0||u>a(s))&&(t.left+=d+p+f)},top:function(t,e){var i,s,n=e.within,o=n.offset.top+n.scrollTop,r=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=t.top-e.collisionPosition.marginTop,c=l-h,u=l+e.collisionHeight-r-h,p="top"===e.my[1]?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(0>(s=t.top+p+f+g+e.collisionHeight-r-o)||a(c)>s)&&(t.top+=p+f+g):u>0&&((i=t.top-e.collisionPosition.marginTop+p+f+g-h)>0||u>a(i))&&(t.top+=p+f+g)}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}});var c="ui-effects-",u="ui-effects-style",d="ui-effects-animated",p=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var s=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:t>s.max?s.max:t)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(t,o){var a,r=o.re.exec(i),h=r&&o.parse(r),l=o.space||"rgba";return h?(a=s[l](h),s[c[l].cache]=a[c[l].cache],n=s._rgba=a._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),s):o[i]}function n(t,e,i){return 1>6*(i=(i+1)%1)?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var o,r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],l=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=l.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),l.fn=t.extend(l.prototype,{parse:function(n,a,r,h){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(a),a=e);var u=this,d=t.type(n),p=this._rgba=[];return a!==e&&(n=[n,a,r,h],d="array"),"string"===d?this.parse(s(n)||o._default):"array"===d?(f(c.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(n instanceof l?f(c,function(t,e){n[e.cache]&&(u[e.cache]=n[e.cache].slice())}):f(c,function(e,s){var o=s.cache;f(s.props,function(t,e){if(!u[o]&&s.to){if("alpha"===t||null==n[t])return;u[o]=s.to(u._rgba)}u[o][e.idx]=i(n[t],e,!0)}),u[o]&&0>t.inArray(null,u[o].slice(0,3))&&(u[o][3]=1,s.from&&(u._rgba=s.from(u[o])))}),this):e},is:function(t){var i=l(t),s=!0,n=this;return f(c,function(t,o){var a,r=i[o.cache];return r&&(a=n[o.cache]||o.to&&o.to(n._rgba)||[],f(o.props,function(t,i){return null!=r[i.idx]?s=r[i.idx]===a[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return f(c,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=l(t),n=s._space(),o=c[n],a=0===this.alpha()?l("transparent"):this,r=a[o.cache]||o.to(a._rgba),h=r.slice();return s=s[o.cache],f(o.props,function(t,n){var o=n.idx,a=r[o],l=s[o],c=u[n.type]||{};null!==l&&(null===a?h[o]=l:(c.mod&&(l-a>c.mod/2?a+=c.mod:a-l>c.mod/2&&(a-=c.mod)),h[o]=i((l-a)*e+a,n)))}),this[n](h)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(e)._rgba;return l(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return 1===(t=(t||0).toString(16)).length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,c.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,s=t[0]/255,n=t[1]/255,o=t[2]/255,a=t[3],r=Math.max(s,n,o),h=Math.min(s,n,o),l=r-h,c=r+h,u=.5*c;return e=h===r?0:s===r?60*(n-o)/l+360:n===r?60*(o-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=u?l/c:l/(2-c),[Math.round(e)%360,i,u,null==a?1:a]},c.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],o=t[3],a=.5>=s?s*(1+i):s+i-s*i,r=2*s-a;return[Math.round(255*n(r,a,e+1/3)),Math.round(255*n(r,a,e)),Math.round(255*n(r,a,e-1/3)),o]},f(c,function(s,n){var o=n.props,a=n.cache,h=n.to,c=n.from;l.fn[s]=function(s){if(h&&!this[a]&&(this[a]=h(this._rgba)),s===e)return this[a].slice();var n,r=t.type(s),u="array"===r||"object"===r?s:arguments,d=this[a].slice();return f(o,function(t,e){var s=u["object"===r?t:e.idx];null==s&&(s=d[e.idx]),d[e.idx]=i(s,e)}),c?(n=l(c(d)),n[a]=d,n):l(d)},f(o,function(e,i){l.fn[e]||(l.fn[e]=function(n){var o,a=t.type(n),h="alpha"===e?this._hsla?"hsla":"rgba":s,l=this[h](),c=l[i.idx];return"undefined"===a?c:("function"===a&&(n=n.call(this,c),a=t.type(n)),null==n&&i.empty?this:("string"===a&&(o=r.exec(n))&&(n=c+parseFloat(o[2])*("+"===o[1]?1:-1)),l[i.idx]=n,this[h](l)))})})}),l.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var o,a,r="";if("transparent"!==n&&("string"!==t.type(n)||(o=s(n)))){if(n=l(o||n),!d.rgba&&1!==n._rgba[3]){for(a="backgroundColor"===i?e.parentNode:e;(""===r||"transparent"===r)&&a&&a.style;)try{r=t.css(a,"backgroundColor"),a=a.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(h){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=l(e.elem,i),e.end=l(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},l.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(p),function(){function e(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(o[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function i(e,i){var s,o,a={};for(s in i)o=i[s],e[s]!==o&&(n[s]||(t.fx.step[s]||!isNaN(parseFloat(o)))&&(a[s]=o));return a}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(p.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(n,o,a,r){var h=t.speed(o,a,r);return this.queue(function(){var o,a=t(this),r=a.attr("class")||"",l=h.children?a.find("*").addBack():a;l=l.map(function(){return{el:t(this),start:e(this)}}),(o=function(){t.each(s,function(t,e){n[e]&&a[e+"Class"](n[e])})})(),l=l.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),a.attr("class",r),l=l.map(function(){var e=this,i=t.Deferred(),s=t.extend({},h,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,l.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),h.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,o){return s?t.effects.animateClass.call(this,{add:i},s,n,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,n,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,s,n,o,a){return"boolean"==typeof s||void 0===s?n?t.effects.animateClass.call(this,s?{add:i}:{remove:i},n,o,a):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},s,n,o)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,o){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,o)}})}(),function(){function e(e,i,s,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function i(e){return!(e&&"number"!=typeof e&&!t.fx.speeds[e])||("string"==typeof e&&!t.effects.effect[e]||(!!t.isFunction(e)||"object"==typeof e&&!e.effect))}function s(t,e){var i=e.outerWidth(),s=e.outerHeight(),o=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/.exec(t)||["",0,i,s,0];return{top:parseFloat(o[1])||0,right:"auto"===o[2]?i:parseFloat(o[2]),bottom:"auto"===o[3]?s:parseFloat(o[3]),left:parseFloat(o[4])||0}}t.expr&&t.expr.filters&&t.expr.filters.animated&&(t.expr.filters.animated=function(e){return function(i){return!!t(i).data(d)||e(i)}}(t.expr.filters.animated)),!1!==t.uiBackCompat&&t.extend(t.effects,{save:function(t,e){for(var i=0,s=e.length;s>i;i++)null!==e[i]&&t.data(c+e[i],t[0].style[e[i]])},restore:function(t,e){for(var i,s=0,n=e.length;n>s;s++)null!==e[s]&&(i=t.data(c+e[s]),t.css(e[s],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),float:e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(a){o=document.body}return e.wrap(s),(e[0]===o||t.contains(e[0],o))&&t(o).trigger("focus"),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).trigger("focus")),e}}),t.extend(t.effects,{version:"1.12.1",define:function(e,i,s){return s||(s=i,i="effect"),t.effects.effect[e]=s,t.effects.effect[e].mode=i,s},scaledDimensions:function(t,e,i){if(0===e)return{height:0,width:0,outerHeight:0,outerWidth:0};var s="horizontal"!==i?(e||100)/100:1,n="vertical"!==i?(e||100)/100:1;return{height:t.height()*n,width:t.width()*s,outerHeight:t.outerHeight()*n,outerWidth:t.outerWidth()*s}},clipToBox:function(t){return{width:t.clip.right-t.clip.left,height:t.clip.bottom-t.clip.top,left:t.clip.left,top:t.clip.top}},unshift:function(t,e,i){var s=t.queue();e>1&&s.splice.apply(s,[1,0].concat(s.splice(e,i))),t.dequeue()},saveStyle:function(t){t.data(u,t[0].style.cssText)},restoreStyle:function(t){t[0].style.cssText=t.data(u)||"",t.removeData(u)},mode:function(t,e){var i=t.is(":hidden");return"toggle"===e&&(e=i?"show":"hide"),(i?"hide"===e:"show"===e)&&(e="none"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createPlaceholder:function(e){var i,s=e.css("position"),n=e.position();return e.css({marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()),/^(static|relative)/.test(s)&&(s="absolute",i=t("<"+e[0].nodeName+">").insertAfter(e).css({display:/^(inline|ruby)/.test(e.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight"),float:e.css("float")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).addClass("ui-effects-placeholder"),e.data(c+"placeholder",i)),e.css({position:s,left:n.left,top:n.top}),i},removePlaceholder:function(t){var e=c+"placeholder",i=t.data(e);i&&(i.remove(),t.removeData(e))},cleanUp:function(e){t.effects.restoreStyle(e),t.effects.removePlaceholder(e)},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var o=e.cssUnit(i);o[0]>0&&(n[i]=o[0]*s+o[1])}),n}}),t.fn.extend({effect:function(){function i(e){function a(){t.isFunction(h)&&h.call(r[0]),t.isFunction(e)&&e()}var r=t(this);s.mode=c.shift(),!1===t.uiBackCompat||o?"none"===s.mode?(r[l](),a()):n.call(r[0],s,function(){r.removeData(d),t.effects.cleanUp(r),"hide"===s.mode&&r.hide(),a()}):(r.is(":hidden")?"hide"===l:"show"===l)?(r[l](),a()):n.call(r[0],s,a)}var s=e.apply(this,arguments),n=t.effects.effect[s.effect],o=n.mode,a=s.queue,r=a||"fx",h=s.complete,l=s.mode,c=[],u=function(e){var i=t(this),s=t.effects.mode(i,l)||o;i.data(d,!0),c.push(s),o&&("show"===s||s===o&&"hide"===s)&&i.show(),o&&"none"===s||t.effects.saveStyle(i),t.isFunction(e)&&e()};return t.fx.off||!n?l?this[l](s.duration,h):this.each(function(){h&&h.call(this)}):!1===a?this.each(u).each(i):this.queue(r,u).queue(r,i)},show:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(t.fn.show),hide:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(s){if(i(s)||"boolean"==typeof s)return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s},cssClip:function(t){return t?this.css("clip","rect("+t.top+"px "+t.right+"px "+t.bottom+"px "+t.left+"px)"):s(this.css("clip"),this)},transfer:function(e,i){var s=t(this),n=t(e.to),o="fixed"===n.css("position"),a=t("body"),r=o?a.scrollTop():0,h=o?a.scrollLeft():0,l=n.offset(),c={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},u=s.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(e.className).css({top:u.top-r,left:u.left-h,height:s.innerHeight(),width:s.innerWidth(),position:o?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){d.remove(),t.isFunction(i)&&i()})}}),t.fx.step.clip=function(e){e.clipInit||(e.start=t(e.elem).cssClip(),"string"==typeof e.end&&(e.end=s(e.end,e.elem)),e.clipInit=!0),t(e.elem).cssClip({top:e.pos*(e.end.top-e.start.top)+e.start.top,right:e.pos*(e.end.right-e.start.right)+e.start.right,bottom:e.pos*(e.end.bottom-e.start.bottom)+e.start.bottom,left:e.pos*(e.end.left-e.start.left)+e.start.left})}}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}();t.effects;t.effects.define("blind","hide",function(e,i){var s={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},n=t(this),o=e.direction||"up",a=n.cssClip(),r={clip:t.extend({},a)},h=t.effects.createPlaceholder(n);r.clip[s[o][0]]=r.clip[s[o][1]],"show"===e.mode&&(n.cssClip(r.clip),h&&h.css(t.effects.clipToBox(r)),r.clip=a),h&&h.animate(t.effects.clipToBox(r),e.duration,e.easing),n.animate(r,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("bounce",function(e,i){var s,n,o,a=t(this),r=e.mode,h="hide"===r,l="show"===r,c=e.direction||"up",u=e.distance,d=e.times||5,p=2*d+(l||h?1:0),f=e.duration/p,g=e.easing,m="up"===c||"down"===c?"top":"left",_="up"===c||"left"===c,v=0,b=a.queue().length;for(t.effects.createPlaceholder(a),o=a.css(m),u||(u=a["top"===m?"outerHeight":"outerWidth"]()/3),l&&(n={opacity:1},n[m]=o,a.css("opacity",0).css(m,_?2*-u:2*u).animate(n,f,g)),h&&(u/=Math.pow(2,d-1)),(n={})[m]=o;d>v;v++)s={},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g).animate(n,f,g),u=h?2*u:u/2;h&&(s={opacity:0},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g)),a.queue(i),t.effects.unshift(a,b,p+1)}),t.effects.define("clip","hide",function(e,i){var s,n={},o=t(this),a=e.direction||"vertical",r="both"===a,h=r||"horizontal"===a,l=r||"vertical"===a;s=o.cssClip(),n.clip={top:l?(s.bottom-s.top)/2:s.top,right:h?(s.right-s.left)/2:s.right,bottom:l?(s.bottom-s.top)/2:s.bottom,left:h?(s.right-s.left)/2:s.left},t.effects.createPlaceholder(o),"show"===e.mode&&(o.cssClip(n.clip),n.clip=s),o.animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("drop","hide",function(e,i){var s,n=t(this),a="show"===e.mode,r=e.direction||"left",h="up"===r||"down"===r?"top":"left",l="up"===r||"left"===r?"-=":"+=",c="+="===l?"-=":"+=",u={opacity:0};t.effects.createPlaceholder(n),s=e.distance||n["top"===h?"outerHeight":"outerWidth"](!0)/2,u[h]=l+s,a&&(n.css(u),u[h]=c+s,u.opacity=1),n.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("explode","hide",function(e,i){function s(){b.push(this),b.length===u*d&&(p.css({visibility:"visible"}),t(b).remove(),i())}var o,a,r,h,l,c,u=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=u,p=t(this),g="show"===e.mode,m=p.show().css("visibility","hidden").offset(),_=Math.ceil(p.outerWidth()/d),v=Math.ceil(p.outerHeight()/u),b=[];for(o=0;u>o;o++)for(h=m.top+o*v,c=o-(u-1)/2,a=0;d>a;a++)r=m.left+a*_,l=a-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-a*_,top:-o*v}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:_,height:v,left:r+(g?l*_:0),top:h+(g?c*v:0),opacity:g?0:1}).animate({left:r+(g?0:l*_),top:h+(g?0:c*v),opacity:g?1:0},e.duration||500,e.easing,s)}),t.effects.define("fade","toggle",function(e,i){var s="show"===e.mode;t(this).css("opacity",s?0:1).animate({opacity:s?1:0},{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("fold","hide",function(e,i){var s=t(this),n=e.mode,o="show"===n,a="hide"===n,r=e.size||15,h=/([0-9]+)%/.exec(r),c=!!e.horizFirst?["right","bottom"]:["bottom","right"],u=e.duration/2,d=t.effects.createPlaceholder(s),p=s.cssClip(),f={clip:t.extend({},p)},g={clip:t.extend({},p)},m=[p[c[0]],p[c[1]]],_=s.queue().length;h&&(r=parseInt(h[1],10)/100*m[a?0:1]),f.clip[c[0]]=r,g.clip[c[0]]=r,g.clip[c[1]]=0,o&&(s.cssClip(g.clip),d&&d.css(t.effects.clipToBox(g)),g.clip=p),s.queue(function(i){d&&d.animate(t.effects.clipToBox(f),u,e.easing).animate(t.effects.clipToBox(g),u,e.easing),i()}).animate(f,u,e.easing).animate(g,u,e.easing).queue(i),t.effects.unshift(s,_,4)}),t.effects.define("highlight","show",function(e,i){var s=t(this),n={backgroundColor:s.css("backgroundColor")};"hide"===e.mode&&(n.opacity=0),t.effects.saveStyle(s),s.css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("size",function(e,i){var s,n,o,a=t(this),r=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],l=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],c=e.mode,u="effect"!==c,d=e.scale||"both",p=e.origin||["middle","center"],f=a.css("position"),g=a.position(),m=t.effects.scaledDimensions(a),_=e.from||m,v=e.to||t.effects.scaledDimensions(a,0);t.effects.createPlaceholder(a),"show"===c&&(o=_,_=v,v=o),n={from:{y:_.height/m.height,x:_.width/m.width},to:{y:v.height/m.height,x:v.width/m.width}},("box"===d||"both"===d)&&(n.from.y!==n.to.y&&(_=t.effects.setTransition(a,h,n.from.y,_),v=t.effects.setTransition(a,h,n.to.y,v)),n.from.x!==n.to.x&&(_=t.effects.setTransition(a,l,n.from.x,_),v=t.effects.setTransition(a,l,n.to.x,v))),("content"===d||"both"===d)&&n.from.y!==n.to.y&&(_=t.effects.setTransition(a,r,n.from.y,_),v=t.effects.setTransition(a,r,n.to.y,v)),p&&(s=t.effects.getBaseline(p,m),_.top=(m.outerHeight-_.outerHeight)*s.y+g.top,_.left=(m.outerWidth-_.outerWidth)*s.x+g.left,v.top=(m.outerHeight-v.outerHeight)*s.y+g.top,v.left=(m.outerWidth-v.outerWidth)*s.x+g.left),a.css(_),("content"===d||"both"===d)&&(h=h.concat(["marginTop","marginBottom"]).concat(r),l=l.concat(["marginLeft","marginRight"]),a.find("*[width]").each(function(){var i=t(this),s=t.effects.scaledDimensions(i),o={height:s.height*n.from.y,width:s.width*n.from.x,outerHeight:s.outerHeight*n.from.y,outerWidth:s.outerWidth*n.from.x},a={height:s.height*n.to.y,width:s.width*n.to.x,outerHeight:s.height*n.to.y,outerWidth:s.width*n.to.x};n.from.y!==n.to.y&&(o=t.effects.setTransition(i,h,n.from.y,o),a=t.effects.setTransition(i,h,n.to.y,a)),n.from.x!==n.to.x&&(o=t.effects.setTransition(i,l,n.from.x,o),a=t.effects.setTransition(i,l,n.to.x,a)),u&&t.effects.saveStyle(i),i.css(o),i.animate(a,e.duration,e.easing,function(){u&&t.effects.restoreStyle(i)})})),a.animate(v,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){var e=a.offset();0===v.opacity&&a.css("opacity",_.opacity),u||(a.css("position","static"===f?"relative":f).offset(e),t.effects.saveStyle(a)),i()}})}),t.effects.define("scale",function(e,i){var s=t(this),n=e.mode,o=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"effect"!==n?0:100),a=t.extend(!0,{from:t.effects.scaledDimensions(s),to:t.effects.scaledDimensions(s,o,e.direction||"both"),origin:e.origin||["middle","center"]},e);e.fade&&(a.from.opacity=1,a.to.opacity=0),t.effects.effect.size.call(this,a,i)}),t.effects.define("puff","hide",function(e,i){var s=t.extend(!0,{},e,{fade:!0,percent:parseInt(e.percent,10)||150});t.effects.effect.scale.call(this,s,i)}),t.effects.define("pulsate","show",function(e,i){var s=t(this),n=e.mode,o="show"===n,r=o||"hide"===n,h=2*(e.times||5)+(r?1:0),l=e.duration/h,c=0,u=1,d=s.queue().length;for((o||!s.is(":visible"))&&(s.css("opacity",0).show(),c=1);h>u;u++)s.animate({opacity:c},l,e.easing),c=1-c;s.animate({opacity:c},l,e.easing),s.queue(i),t.effects.unshift(s,d,h+1)}),t.effects.define("shake",function(e,i){var s=1,n=t(this),o=e.direction||"left",a=e.distance||20,r=e.times||3,h=2*r+1,l=Math.round(e.duration/h),c="up"===o||"down"===o?"top":"left",u="up"===o||"left"===o,d={},p={},f={},g=n.queue().length;for(t.effects.createPlaceholder(n),d[c]=(u?"-=":"+=")+a,p[c]=(u?"+=":"-=")+2*a,f[c]=(u?"-=":"+=")+2*a,n.animate(d,l,e.easing);r>s;s++)n.animate(p,l,e.easing).animate(f,l,e.easing);n.animate(p,l,e.easing).animate(d,l/2,e.easing).queue(i),t.effects.unshift(n,g,h+1)}),t.effects.define("slide","show",function(e,i){var s,n,o=t(this),a={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},r=e.mode,h=e.direction||"left",l="up"===h||"down"===h?"top":"left",c="up"===h||"left"===h,u=e.distance||o["top"===l?"outerHeight":"outerWidth"](!0),d={};t.effects.createPlaceholder(o),s=o.cssClip(),n=o.position()[l],d[l]=(c?-1:1)*u+n,d.clip=o.cssClip(),d.clip[a[h][1]]=d.clip[a[h][0]],"show"===r&&(o.cssClip(d.clip),o.css(l,d[l]),d.clip=s,d[l]=n),o.animate(d,{queue:!1,duration:e.duration,easing:e.easing,complete:i})});!1!==t.uiBackCompat&&t.effects.define("transfer",function(e,i){t(this).transfer(e,i)}),t.ui.focusable=function(i,s){var n,o,a,r,h,l=i.nodeName.toLowerCase();return"area"===l?(n=i.parentNode,o=n.name,!(!i.href||!o||"map"!==n.nodeName.toLowerCase())&&((a=t("img[usemap='#"+o+"']")).length>0&&a.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(l)?(r=!i.disabled)&&(h=t(i).closest("fieldset")[0])&&(r=!h.disabled):r="a"===l?i.href||s:s,r&&t(i).is(":visible")&&function(t){for(var e=t.css("visibility");"inherit"===e;)t=t.parent(),e=t.css("visibility");return"hidden"!==e}(t(i)))},t.extend(t.expr[":"],{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if(this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===t.fn.jquery.substring(0,3)&&(t.each(["Width","Height"],function(e,i){function s(e,i,s,o){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?a["inner"+i].call(this):this.each(function(){t(this).css(o,s(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){t(this).css(o,s(this,e,!0,n)+"px")})}}),t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var e,i,s,n,o;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),(s=this.attr("id"))&&(e=this.eq(0).parents().last(),o=e.add(e.length?e.siblings():this.siblings()),i="label[for='"+t.ui.escapeSelector(s)+"']",n=n.add(o.find(i).addBack(i))),this.pushStack(n))},t.fn.scrollParent=function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return(!s||"static"!==e.css("position"))&&n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.extend(t.expr[":"],{tabbable:function(e){var i=t.attr(e,"tabindex"),s=null!=i;return(!s||i>=0)&&t.ui.focusable(e,s)}}),t.fn.extend({uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),e.collapsible||!1!==e.active&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t()}},_createIcons:function(){var e,i,s=this.options.icons;s&&(e=t("<span>"),this._addClass(e,"ui-accordion-header-icon","ui-icon "+s.header),e.prependTo(this.headers),i=this.active.children(".ui-accordion-header-icon"),this._removeClass(i,s.header)._addClass(i,null,s.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?void this._activate(e):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||!1!==this.options.active||this._activate(0),void("icons"===t&&(this._destroyIcons(),e&&this._createIcons())))},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!t)},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,s=this.headers.length,n=this.headers.index(e.target),o=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:o=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[s-1]}o&&(t(e.target).attr("tabIndex",-1),t(o).attr("tabIndex",0),t(o).trigger("focus"),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().trigger("focus")},refresh:function(){var e=this.options;this._processPanels(),!1===e.active&&!0===e.collapsible||!this.headers.length?(e.active=!1,this.active=t()):!1===e.active?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var t=this.headers,e=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),e&&(this._off(t.not(this.headers)),this._off(e.not(this.panels)))},_refresh:function(){var e,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var e=t(this),i=e.uniqueId().attr("id"),s=e.next(),n=s.uniqueId().attr("id");e.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(e=n.height(),this.element.siblings(":visible").each(function(){var i=t(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(e-=i.outerHeight(!0))}),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===s&&(e=0,this.headers.next().each(function(){var i=t(this).is(":visible");i||t(this).show(),e=Math.max(e,t(this).css("height","").height()),i||t(this).hide()}).height(e))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i,s,n=this.options,o=this.active,a=t(e.currentTarget),r=a[0]===o[0],h=r&&n.collapsible,l=h?t():a.next(),u={oldHeader:o,oldPanel:o.next(),newHeader:h?t():a,newPanel:l};e.preventDefault(),r&&!n.collapsible||!1===this._trigger("beforeActivate",e,u)||(n.active=!h&&this.headers.index(a),this.active=r?t():a,this._toggle(u),this._removeClass(o,"ui-accordion-header-active","ui-state-active"),n.icons&&(i=o.children(".ui-accordion-header-icon"),this._removeClass(i,null,n.icons.activeHeader)._addClass(i,null,n.icons.header)),r||(this._removeClass(a,"ui-accordion-header-collapsed")._addClass(a,"ui-accordion-header-active","ui-state-active"),n.icons&&(s=a.children(".ui-accordion-header-icon"),this._removeClass(s,null,n.icons.header)._addClass(s,null,n.icons.activeHeader)),this._addClass(a.next(),"ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,s=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,e):(s.hide(),i.show(),this._toggleComplete(e)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(t(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(t,e,i){var s,n,o,a=this,r=0,h=t.css("box-sizing"),l=t.length&&(!e.length||t.index()<e.index()),c=this.options.animate||{},u=l&&c.down||c,d=function(){a._toggleComplete(i)};return"number"==typeof u&&(o=u),"string"==typeof u&&(n=u),n=n||u.easing||c.easing,o=o||u.duration||c.duration,e.length?t.length?(s=t.show().outerHeight(),e.animate(this.hideProps,{duration:o,easing:n,step:function(t,e){e.now=Math.round(t)}}),void t.hide().animate(this.showProps,{duration:o,easing:n,complete:d,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?"content-box"===h&&(r+=i.now):"content"!==a.options.heightStyle&&(i.now=Math.round(s-e.outerHeight()-r),r=0)}})):e.animate(this.hideProps,o,n,d):t.animate(this.showProps,o,n,d)},_toggleComplete:function(t){var e=t.oldPanel,i=e.prev();this._removeClass(e,"ui-accordion-content-active"),this._removeClass(i,"ui-accordion-header-active")._addClass(i,"ui-accordion-header-collapsed"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}}),t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target),s=t(t.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&s.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){if(!this.previousFilter){var i=t(e.target).closest(".ui-menu-item"),s=t(e.currentTarget);i[0]===s[0]&&(this._removeClass(s.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(e,s))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){!t.contains(this.element[0],t.ui.safeActiveElement(this.document[0]))&&this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){var i=this.element.find(".ui-menu-item").removeAttr("role aria-disabled").children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),i.children().each(function(){var e=t(this);e.data("ui-menu-submenu-caret")&&e.remove()})},_keydown:function(e){var i,s,n,o,a=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:a=!1,s=this.previousFilter||"",o=!1,n=e.keyCode>=96&&105>=e.keyCode?""+(e.keyCode-96):String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),n===s?o=!0:n=s+n,i=this._filterMenuItems(n),(i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i).length||(n=String.fromCharCode(e.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(e,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}a&&e.preventDefault()},_activate:function(t){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var i,s,n,o,a=this,r=this.options.icons.submenu,h=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),s=h.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.prev(),s=t("<span>").data("ui-menu-submenu-caret",!0);a._addClass(s,"ui-menu-icon","ui-icon "+r),i.attr("aria-haspopup","true").prepend(s),e.attr("aria-labelledby",i.attr("id"))}),this._addClass(s,"ui-menu","ui-widget ui-widget-content ui-front"),(i=h.add(this.element).find(this.options.items)).not(".ui-menu-item").each(function(){var e=t(this);a._isDivider(e)&&a._addClass(e,"ui-menu-divider","ui-widget-content")}),o=(n=i.not(".ui-menu-item, .ui-menu-divider")).children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(o,"ui-menu-item-wrapper"),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){if("icons"===t){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,e.submenu)}this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t+""),this._toggleClass(null,"ui-state-disabled",!!t)},focus:function(t,e){var i,s,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),s=this.active.children(".ui-menu-item-wrapper"),this._addClass(s,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),n=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(n,null,"ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(i=e.children(".ui-menu")).length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,s,n,o,a,r;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-s,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=e.outerHeight(),0>n?this.activeMenu.scrollTop(o+n):n+r>a&&this.activeMenu.scrollTop(o+n-a+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",t,{item:this.active}),this.active=null)},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this._removeClass(s.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=s},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;this.active&&(s="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?void(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return 0>(i=t(this)).offset().top-s-n}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))):void this.next(e)},previousPage:function(e){var i,s,n;return this.active?void(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return(i=t(this)).offset().top-s+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first()))):void this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(e){var i=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(t.trim(t(this).children(".ui-menu-item-wrapper").text()))})}}),t.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,s,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,a="input"===n;this.isMultiLine=o||!a&&this._isContentEditable(this.element),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return e=!0,s=!0,void(i=!0);e=!1,s=!1,i=!1;var o=t.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case o.UP:e=!0,this._keyEvent("previous",n);break;case o.DOWN:e=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(e)return e=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault());if(!i){var n=t.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(t){return s?(s=!1,void t.preventDefault()):void this._searchTimeout(t)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(t),void this._change(t))}}),this._initSource(),this.menu=t("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==t.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(e,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),void this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)})):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:n})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(n.value),void((s=i.item.attr("aria-label")||n.value)&&t.trim(s).length&&(this.liveRegion.children().hide(),t("<div>").text(s).appendTo(this.liveRegion))))},menuselect:function(e,i){var s=i.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==t.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=s})),!1!==this._trigger("select",e,{item:s})&&this._value(s.value),this.term=this._value(),this.close(e),this.selectedItem=s}}),this.liveRegion=t("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(e){var i=this.menu.element[0];return e.target===this.element[0]||e.target===i||t.contains(i,e.target)},_closeOnClickOutside:function(t){this._isEventTargetInWidget(t)||this.close()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,s=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,s){s(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){s.xhr&&s.xhr.abort(),s.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),s=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;(!e||e&&!i&&!s)&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):!1!==this._trigger("search",e)?this._search(t):void 0},_search:function(t){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var s=this;t.each(i,function(t,i){s._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<div>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[t](e):void this.search(null,e)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())},_isContentEditable:function(t){if(!t.length)return!1;var e=t.prop("contentEditable");return"inherit"===e?this._isContentEditable(t.parent()):"true"===e}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var s=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return s.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete;var g=/ui-corner-([a-z]){2,6}/g;t.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,i=[];t.each(this.options.items,function(s,n){var o,a={};return n?"controlgroupLabel"===s?((o=e.element.find(n)).each(function(){var e=t(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),e._addClass(o,null,"ui-widget ui-widget-content ui-state-default"),void(i=i.concat(o.get()))):void(t.fn[s]&&(a=e["_"+s+"Options"]?e["_"+s+"Options"]("middle"):{classes:{}},e.element.find(n).each(function(){var n=t(this),o=n[s]("instance"),r=t.widget.extend({},a);if("button"!==s||!n.parent(".ui-spinner").length){o||(o=n[s]()[s]("instance")),o&&(r.classes=e._resolveClassesValues(r.classes,o)),n[s](r);var h=n[s]("widget");t.data(h[0],"ui-controlgroup-data",o||n[s]("instance")),i.push(h[0])}}))):void 0}),this.childWidgets=t(t.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each(function(){var s=t(this).data("ui-controlgroup-data");s&&s[e]&&s[e]()})},_updateCornerClass:function(t,e){var s=this._buildSimpleOptions(e,"label").classes.label;this._removeClass(t,null,"ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all"),this._addClass(t,null,s)},_buildSimpleOptions:function(t,e){var i="vertical"===this.options.direction,s={classes:{}};return s.classes[e]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[t],s},_spinnerOptions:function(t){var e=this._buildSimpleOptions(t,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:!!e&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[t]}},_resolveClassesValues:function(e,i){var s={};return t.each(e,function(n){var o=i.options.classes[n]||"";o=t.trim(o.replace(g,"")),s[n]=(o+" "+e[n]).replace(/\s+/g," ")}),s},_setOption:function(t,e){return"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"===t?void this._callChildMethod(e?"disable":"enable"):void this.refresh()},refresh:function(){var e,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,this.options.onlyVisible&&(e=e.filter(":visible")),e.length&&(t.each(["first","last"],function(t,s){var n=e[s]().data("ui-controlgroup-data");if(n&&i["_"+n.widgetName+"Options"]){var o=i["_"+n.widgetName+"Options"](1===e.length?"only":s);o.classes=i._resolveClassesValues(o.classes,n),n.element[n.widgetName](o)}else i._updateCornerClass(e[s](),s)}),this._callChildMethod("refresh"))}}),t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,i,s=this,n=this._super()||{};return this._readType(),i=this.element.labels(),this.label=t(i[i.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){s.originalLabel+=3===this.nodeType?t(this).text():this.outerHTML}),this.originalLabel&&(n.label=this.originalLabel),null!=(e=this.element[0].disabled)&&(n.disabled=e),n},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var i=this.element[0].name,s="input[name='"+t.ui.escapeSelector(i)+"']";return i?(this.form.length?t(this.form[0].elements).filter(s):t(s).filter(function(){return 0===t(this).form().length})).not(this.element):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){return"label"!==t||e?(this._super(t,e),"disabled"===t?(this._toggleClass(this.label,null,"ui-state-disabled",e),void(this.element[0].disabled=e)):void this.refresh()):void 0},_updateIcon:function(e){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var t=this.label.contents().not(this.element[0]);this.icon&&(t=t.not(this.icon[0])),this.iconSpace&&(t=t.not(this.iconSpace[0])),t.remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]),t.ui.checkboxradio,t.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),null!=(t=this.element[0].disabled)&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,i){var s="iconPosition"!==e,n=s?this.options.iconPosition:i,o="top"===n||"bottom"===n;this.icon?s&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),s&&this._addClass(this.icon,null,i),this._attachIcon(n),o?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(n))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=void 0===t.showLabel?this.options.showLabel:t.showLabel,i=void 0===t.icon?this.options.icon:t.icon;e||i||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),this.element[0].disabled=e,e&&this.element.blur())},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),!1!==t.uiBackCompat&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){return"text"===t?void this._super("showLabel",e):("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),void this._superApply(arguments))}}),t.fn.button=function(e){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?e.apply(this,arguments):(t.ui.checkboxradio||t.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(t.fn.button),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),t.ui.button,t.extend(t.ui,{datepicker:{version:"1.12.1"}});var m;t.extend(s.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return a(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var s,n,o;n="div"===(s=e.nodeName.toLowerCase())||"span"===s,e.id||(this.uuid+=1,e.id="dp"+this.uuid),(o=this._newInst(t(e),n)).settings=t.extend({},i||{}),"input"===s?this._connectDatepicker(e,o):n&&this._inlineDatepicker(e,o)},_newInst:function(e,i){return{id:e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var s=t(e);i.append=t([]),i.trigger=t([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var s,n,o,a=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),a&&(i.append=t("<span class='"+this._appendClass+"'>"+a+"</span>"),e[r?"before":"after"](i.append)),e.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),("focus"===(s=this._get(i,"showOn"))||"both"===s)&&e.on("focus",this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:n,title:n}):n)),e[r?"before":"after"](i.trigger),i.trigger.on("click",function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,s,n,o=new Date(2009,11,20),a=this._get(t,"dateFormat");a.match(/[DM]/)&&(e=function(t){for(i=0,s=0,n=0;t.length>n;n++)t[n].length>i&&(i=t[n].length,s=n);return s},o.setMonth(e(this._get(t,a.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,a.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length)}},_inlineDatepicker:function(e,i){var s=t(e);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,s,n,o){var r,h,l,c,u,d=this._dialogInst;return d||(this.uuid+=1,r="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+r+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),t("body").append(this._dialogInput),d=this._dialogInst=this._newInst(this._dialogInput,!1),d.settings={},t.data(this._dialogInput[0],"datepicker",d)),a(d.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+c,l/2-150+u]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(e){var i,s=t(e),n=t.data(e,"datepicker");s.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty(),m===n&&(m=null))},_enableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&("input"===(i=e.nodeName.toLowerCase())?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&((s=n.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&("input"===(i=e.nodeName.toLowerCase())?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&((s=n.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,i,s){var n,o,r,h,l=this._getInst(e);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):l?"all"===i?t.extend({},l.settings):this._get(l,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),void(l&&(this._curInst===l&&this._hideDatepicker(),o=this._getDateDatepicker(e,!0),r=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),a(l.settings,n),null!==r&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,r)),null!==h&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in n&&(n.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),l),this._autoSize(l),this._setDate(l,o),this._updateAlternate(l),this._updateDatepicker(l))))},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,s,n,o=t.datepicker._getInst(e.target),a=!0,r=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),a=!1;break;case 13:return(n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv))[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,n[0]),(i=t.datepicker._get(o,"onSelect"))?(s=t.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[s,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),a=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),a=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?1:-1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),a=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?-1:1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),a=e.ctrlKey||e.metaKey;break;default:a=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):a=!1;a&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,s,n=t.datepicker._getInst(e.target);return t.datepicker._get(n,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(e){var s=t.datepicker._getInst(e.target);if(s.input.val()!==s.lastVal)try{t.datepicker.parseDate(t.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,t.datepicker._getFormatConfig(s))&&(t.datepicker._setDateFromField(s),t.datepicker._updateAlternate(s),t.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(e){if("input"!==(e=e.target||e).nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var s,n,o,r,h,l,c;s=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==s&&(t.datepicker._curInst.dpDiv.stop(!0,!0),s&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),!1!==(o=(n=t.datepicker._get(s,"beforeShow"))?n.apply(e,[e,s]):{})&&(a(s.settings,o),s.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(s),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),r=!1,t(e).parents().each(function(){return!(r|="fixed"===t(this).css("position"))}),h={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,s.dpDiv.empty(),s.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(s),h=t.datepicker._checkOffset(s,h,r),s.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":r?"fixed":"absolute",display:"none",left:h.left+"px",top:h.top+"px"}),s.inline||(l=t.datepicker._get(s,"showAnim"),c=t.datepicker._get(s,"duration"),s.dpDiv.css("z-index",function(t){for(var e,i;t.length&&t[0]!==document;){if(("absolute"===(e=t.css("position"))||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}(t(e))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[l]?s.dpDiv.show(l,t.datepicker._get(s,"showOptions"),c):s.dpDiv[l||"show"](l?c:null),t.datepicker._shouldFocusInput(s)&&s.input.trigger("focus"),t.datepicker._curInst=s))}},_updateDatepicker:function(e){this.maxRows=4,m=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,s=this._getNumberOfMonths(e),n=s[1],r=e.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&o.apply(r.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",17*n+"em"),e.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.trigger("focus"),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,s){var n=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),a=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:t(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-a:0,i.left-=s&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=s&&i.top===e.input.offset().top+r?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+o>l&&l>o?Math.abs(o+r):0),i},_findPos:function(e){for(var i,s=this._getInst(e),n=this._get(s,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,s,n,o,a=this._curInst;!a||e&&a!==t.data(e,"datepicker")||this._datepickerShowing&&(i=this._get(a,"showAnim"),s=this._get(a,"duration"),n=function(){t.datepicker._tidyDialog(a)},t.effects&&(t.effects.effect[i]||t.effects[i])?a.dpDiv.hide(i,t.datepicker._get(a,"showOptions"),s,n):a.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,(o=this._get(a,"onClose"))&&o.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),s=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==s)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,s){var n=t(e),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===s?this._get(o,"showCurrentAtPos"):0),s),this._updateDatepicker(o))},_gotoToday:function(e){var i,s=t(e),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(e,i,s){var n=t(e),o=this._getInst(n[0]);o["selected"+("M"===s?"Month":"Year")]=o["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(e,i,s,n){var o,a=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(a[0])||(o=this._getInst(a[0]),o.selectedDay=o.currentDay=t("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=s,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var s,n=t(e),o=this._getInst(n[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),(s=this._get(o,"onSelect"))?s.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(e){var i,s,n,o=this._get(e,"altField");o&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),s=this._getDate(e),n=this.formatDate(i,s,this._getFormatConfig(e)),t(o).val(n))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,s){if(null==e||null==i)throw"Invalid arguments";if(""==(i="object"==typeof i?""+i:i+""))return null;var n,o,a,r,h=0,l=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),u=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,d=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,_=-1,v=-1,b=!1,y=function(t){var i=e.length>n+1&&e.charAt(n+1)===t;return i&&n++,i},w=function(t){var e=y(t),s="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n="y"===t?s:1,o=RegExp("^\\d{"+n+","+s+"}"),a=i.substring(h).match(o);if(!a)throw"Missing number at position "+h;return h+=a[0].length,parseInt(a[0],10)},k=function(e,s,n){var o=-1,a=t.map(y(e)?n:s,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(a,function(t,e){var s=e[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(o=e[0],h+=s.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+h},x=function(){if(i.charAt(h)!==e.charAt(n))throw"Unexpected literal at position "+h;h++};for(n=0;e.length>n;n++)if(b)"'"!==e.charAt(n)||y("'")?x():b=!1;else switch(e.charAt(n)){case"d":_=w("d");break;case"D":k("D",u,d);break;case"o":v=w("o");break;case"m":m=w("m");break;case"M":m=k("M",p,f);break;case"y":g=w("y");break;case"@":g=(r=new Date(w("@"))).getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"!":g=(r=new Date((w("!")-this._ticksTo1970)/1e4)).getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"'":y("'")?x():b=!0;break;default:x()}if(i.length>h&&(a=i.substr(h),!/^\s+/.test(a)))throw"Extra/unparsed characters found in date: "+a;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c>=g?0:-100)),v>-1)for(m=1,_=v;!((o=this._getDaysInMonth(g,m-1))>=_);)m++,_-=o;if((r=this._daylightSavingAdjust(new Date(g,m-1,_))).getFullYear()!==g||r.getMonth()+1!==m||r.getDate()!==_)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864e9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,a=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(e){var i=t.length>s+1&&t.charAt(s+1)===e;return i&&s++,i},l=function(t,e,i){var s=""+e;if(h(t))for(;i>s.length;)s="0"+s;return s},c=function(t,e,i,s){return h(t)?s[e]:i[e]},u="",d=!1;if(e)for(s=0;t.length>s;s++)if(d)"'"!==t.charAt(s)||h("'")?u+=t.charAt(s):d=!1;else switch(t.charAt(s)){case"d":u+=l("d",e.getDate(),2);break;case"D":u+=c("D",e.getDay(),n,o);break;case"o":u+=l("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=l("m",e.getMonth()+1,2);break;case"M":u+=c("M",e.getMonth(),a,r);break;case"y":u+=h("y")?e.getFullYear():(10>e.getFullYear()%100?"0":"")+e.getFullYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=1e4*e.getTime()+this._ticksTo1970;break;case"'":h("'")?u+="'":d=!0;break;default:u+=t.charAt(s)}return u},_possibleChars:function(t){var e,i="",s=!1,n=function(i){var s=t.length>e+1&&t.charAt(e+1)===i;return s&&e++,s};for(e=0;t.length>e;e++)if(s)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):s=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return void 0!==t.settings[e]?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),s=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),o=n,a=this._getFormatConfig(t);try{o=this.parseDate(i,s,a)||n}catch(r){s=e?"":s}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=s?o.getDate():0,t.currentMonth=s?o.getMonth():0,t.currentYear=s?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,s){var a=null==i||""===i?s:"string"==typeof i?function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,o=n.getFullYear(),a=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":a+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a));break;case"y":case"Y":o+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a))}l=h.exec(i)}return new Date(o,a,r)}(i):"number"==typeof i?isNaN(i)?s:function(t){var e=new Date;return e.setDate(e.getDate()+t),e}(i):new Date(i.getTime());return(a=a&&"Invalid Date"==""+a?s:a)&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var s=!e,n=t.selectedMonth,o=t.selectedYear,a=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=a.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=a.getMonth(),t.drawYear=t.selectedYear=t.currentYear=a.getFullYear(),n===t.selectedMonth&&o===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(s?"":this._formatDate(t))},_getDate:function(t){return!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay))},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),s="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(s,-i,"M")},next:function(){t.datepicker._adjustDate(s,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(s)},selectDay:function(){return t.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(s,this,"Y"),!1}};t(this).on(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,s,n,o,a,r,h,l,c,u,d,p,f,g,m,_,v,b,y,w,k,x,C,D,I,T,P,M,S,H,z,O,A,N,W,E,F,L,R=new Date,B=this._daylightSavingAdjust(new Date(R.getFullYear(),R.getMonth(),R.getDate())),Y=this._get(t,"isRTL"),j=this._get(t,"showButtonPanel"),q=this._get(t,"hideIfNoPrevNext"),K=this._get(t,"navigationAsDateFormat"),U=this._getNumberOfMonths(t),V=this._get(t,"showCurrentAtPos"),$=this._get(t,"stepMonths"),X=1!==U[0]||1!==U[1],G=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),Q=this._getMinMaxDate(t,"min"),J=this._getMinMaxDate(t,"max"),Z=t.drawMonth-V,te=t.drawYear;if(0>Z&&(Z+=12,te--),J)for(e=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-U[0]*U[1]+1,J.getDate())),e=Q&&Q>e?Q:e;this._daylightSavingAdjust(new Date(te,Z,1))>e;)0>--Z&&(Z=11,te--);for(t.drawMonth=Z,t.drawYear=te,i=this._get(t,"prevText"),i=K?this.formatDate(i,this._daylightSavingAdjust(new Date(te,Z-$,1)),this._getFormatConfig(t)):i,s=this._canAdjustMonth(t,-1,te,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":q?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=K?this.formatDate(n,this._daylightSavingAdjust(new Date(te,Z+$,1)),this._getFormatConfig(t)):n,o=this._canAdjustMonth(t,1,te,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":q?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",a=this._get(t,"currentText"),r=this._get(t,"gotoCurrent")&&t.currentDay?G:B,a=K?this.formatDate(a,r,this._getFormatConfig(t)):a,h=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",l=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(t,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+a+"</button>":"")+(Y?"":h)+"</div>":"",c=parseInt(this._get(t,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),_=this._get(t,"showOtherMonths"),v=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),y="",k=0;U[0]>k;k++){for(x="",this.maxRows=4,C=0;U[1]>C;C++){if(D=this._daylightSavingAdjust(new Date(te,Z,t.selectedDay)),I=" ui-corner-all",T="",X){if(T+="<div class='ui-datepicker-group",U[1]>1)switch(C){case 0:T+=" ui-datepicker-group-first",I=" ui-corner-"+(Y?"right":"left");break;case U[1]-1:T+=" ui-datepicker-group-last",I=" ui-corner-"+(Y?"left":"right");break;default:T+=" ui-datepicker-group-middle",I=""}T+="'>"}for(T+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+I+"'>"+(/all|left/.test(I)&&0===k?Y?o:s:"")+(/all|right/.test(I)&&0===k?Y?s:o:"")+this._generateMonthYearHeader(t,Z,te,Q,J,k>0||C>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead><tr>",P=u?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;7>w;w++)M=(w+c)%7,P+="<th scope='col'"+((w+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+d[M]+"'>"+p[M]+"</span></th>";for(T+=P+"</tr></thead><tbody>",S=this._getDaysInMonth(te,Z),te===t.selectedYear&&Z===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,S)),H=(this._getFirstDayOfMonth(te,Z)-c+7)%7,z=Math.ceil((H+S)/7),O=X&&this.maxRows>z?this.maxRows:z,this.maxRows=O,A=this._daylightSavingAdjust(new Date(te,Z,1-H)),N=0;O>N;N++){for(T+="<tr>",W=u?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(A)+"</td>":"",w=0;7>w;w++)E=m?m.apply(t.input?t.input[0]:null,[A]):[!0,""],F=A.getMonth()!==Z,L=F&&!v||!E[0]||Q&&Q>A||J&&A>J,W+="<td class='"+((w+c+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(A.getTime()===D.getTime()&&Z===t.selectedMonth&&t._keyEvent||b.getTime()===A.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(L?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!_?"":" "+E[1]+(A.getTime()===G.getTime()?" "+this._currentClass:"")+(A.getTime()===B.getTime()?" ui-datepicker-today":""))+"'"+(F&&!_||!E[2]?"":" title='"+E[2].replace(/'/g,"&#39;")+"'")+(L?"":" data-handler='selectDay' data-event='click' data-month='"+A.getMonth()+"' data-year='"+A.getFullYear()+"'")+">"+(F&&!_?"&#xa0;":L?"<span class='ui-state-default'>"+A.getDate()+"</span>":"<a class='ui-state-default"+(A.getTime()===B.getTime()?" ui-state-highlight":"")+(A.getTime()===G.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+A.getDate()+"</a>")+"</td>",A.setDate(A.getDate()+1),A=this._daylightSavingAdjust(A);T+=W+"</tr>"}++Z>11&&(Z=0,te++),x+=T+="</tbody></table>"+(X?"</div>"+(U[0]>0&&C===U[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}y+=x}return y+=l,t._keyEvent=!1,y},_generateMonthYearHeader:function(t,e,i,s,n,o,a,r){var h,l,c,u,d,p,f,g,m=this._get(t,"changeMonth"),_=this._get(t,"changeYear"),v=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",y="";if(o||!m)y+="<span class='ui-datepicker-month'>"+a[e]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,y+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;12>c;c++)(!h||c>=s.getMonth())&&(!l||n.getMonth()>=c)&&(y+="<option value='"+c+"'"+(c===e?" selected='selected'":"")+">"+r[c]+"</option>");y+="</select>"}if(v||(b+=y+(!o&&m&&_?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!_)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),f=(p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e})(u[0]),g=Math.max(f,p(u[1]||"")),f=s?Math.max(f,s.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),v&&(b+=(!o&&m&&_?"":"&#xa0;")+y),b+="</div>"},_adjustInstDate:function(t,e,i){var s=t.selectedYear+("Y"===i?e:0),n=t.selectedMonth+("M"===i?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(s,n))+("D"===i?e:0),a=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(s,n,o)));t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),s=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return s&&n>s?s:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,s){var n=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(i,s+(0>e?e:n[0]*n[1]),1));return 0>e&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var i,s,n=this._getMinMaxDate(t,"min"),o=this._getMinMaxDate(t,"max"),a=null,r=null,h=this._get(t,"yearRange");return h&&(i=h.split(":"),s=(new Date).getFullYear(),a=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(a+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||e.getTime()>=n.getTime())&&(!o||e.getTime()<=o.getTime())&&(!a||e.getFullYear()>=a)&&(!r||r>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,s){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(s,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).on("mousedown",t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new s,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.12.1",t.datepicker,t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var _=!1;t(document).on("mouseup",function(){_=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!_){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,n=!("string"!=typeof this.options.cancel||!e.target.nodeName)&&t(e.target).closest(this.options.cancel).length;return!(s&&!n&&this._mouseCapture(e))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(e),!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),_=!0,!0))}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,e),this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,_=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.ui.plugin={add:function(e,i,s){var n,o=t.ui[e].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(t,e,i,s){var n,o=t.plugins[e];if(o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)t.options[o[n][0]]&&o[n][1].apply(t.element,i)}},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(e){var i=this.options;return!(this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(e),!!this.handle&&(this._blurActiveElement(e),this._blockFrames(!0===i.iframeFix?"iframe":i.iframeFix),!0))},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=t.ui.safeActiveElement(this.document[0]);t(e.target).closest(i).length||t.ui.safeBlur(i)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),!1===this._trigger("start",e)?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(!1===this._trigger("drag",e,s))return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||!0===this.options.revert||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==i._trigger("stop",e)&&i._clear()}):!1!==this._trigger("stop",e)&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return!this.options.handle||!!t(e.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper),n=s?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===n.containment?void(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,(t(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):n.containment.constructor===Array?void(this.containment=n.containment):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),void((s=i[0])&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,s,n,o,a=this.options,r=this._isRootNode(this.scrollParent[0]),h=t.pageX,l=t.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,h=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o),"y"===a.axis&&(h=this.originalPageX),"x"===a.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,s){var n=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,s){var n=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function(e,i,s){t.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",e),s.dropped=o.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,s){var n=t("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(e,i,s){var n=s.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(e,i,s){var n=s.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-e.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:e.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-e.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:e.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(r).scrollTop()<n.scrollSensitivity?o=t(r).scrollTop(t(r).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(r).scrollTop())<n.scrollSensitivity&&(o=t(r).scrollTop(t(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(r).scrollLeft()<n.scrollSensitivity?o=t(r).scrollLeft(t(r).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(r).scrollLeft())<n.scrollSensitivity&&(o=t(r).scrollLeft(t(r).scrollLeft()+n.scrollSpeed)))),!1!==o&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,s){var n=s.options;s.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,s){var n,o,a,r,h,l,c,u,d,p,f=s.options,g=f.snapTolerance,m=i.offset.left,_=m+s.helperProportions.width,v=i.offset.top,b=v+s.helperProportions.height;for(d=s.snapElements.length-1;d>=0;d--)h=s.snapElements[d].left-s.margins.left,l=h+s.snapElements[d].width,c=s.snapElements[d].top-s.margins.top,u=c+s.snapElements[d].height,h-g>_||m>l+g||c-g>b||v>u+g||!t.contains(s.snapElements[d].item.ownerDocument,s.snapElements[d].item)?(s.snapElements[d].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(c-b),o=g>=Math.abs(u-v),a=g>=Math.abs(h-_),r=g>=Math.abs(l-m),n&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||o||a||r,"outer"!==f.snapMode&&(n=g>=Math.abs(c-v),o=g>=Math.abs(u-b),a=g>=Math.abs(h-m),r=g>=Math.abs(l-_),n&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[d].snapping&&(n||o||a||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=n||o||a||r||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,s){var n,o=s.options,a=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(t(a[0]).css("zIndex"),10)||0,t(a).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+a.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(e,i,s){var n=s.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[s]>0||(e[s]=1,n=e[s]>0,e[s]=0,n)},_create:function(){var e,i=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var e,i,s,n,o,a=this.options,r=this;if(this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++)e=t.trim(s[i]),n="ui-resizable-"+e,o=t("<div>"),this._addClass(o,"ui-resizable-handle "+n),o.css({zIndex:a.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(o);this._renderAxis=function(e){var i,s,n,o;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:r._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){r.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),r.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)((s=t(this.handles[i])[0])===e.target||t.contains(s,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var i,s,n,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,s+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,s,n=this.originalMousePosition,o=this.axis,a=e.pageX-n.left||0,r=e.pageY-n.top||0,h=this._change[o];return this._updatePrevProperties(),!!h&&(i=h.apply(this,[e,a,r]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1)},_mouseStop:function(e){this.resizing=!1;var i,s,n,o,a,r,h,l=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,o=s?0:c.sizeDiff.width,a={width:c.helper.width()-o,height:c.helper.height()-n},r=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,h=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,l.animate||this.element.css(t.extend(a,{top:h,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!l.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,s,n,o,a=this.options;o={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),s>o.minHeight&&(o.minHeight=s),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,a=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,r=this.originalPosition.left+this.originalSize.width,h=this.originalPosition.top+this.originalSize.height,l=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),a&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&l&&(t.left=r-e.minWidth),s&&l&&(t.left=r-e.maxWidth),a&&c&&(t.top=h-e.minHeight),n&&c&&(t.top=h-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseFloat(s[e])||0,i[e]+=parseFloat(n[e])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize;return{left:this.originalPosition.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize;return{top:this.originalPosition.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-a},l=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(h,c&&l?{top:c,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,s,n,o,a,r,h=t(this).resizable("instance"),l=h.options,c=h.element,u=l.containment,d=u instanceof t?u.get(0):/parent/.test(u)?c.parent().get(0):u;d&&(h.containerElement=t(d),/document/.test(u)||u===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=h._num(e.css("padding"+s))}),h.containerOffset=e.offset(),h.containerPosition=e.position(),h.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,o=h.containerSize.width,a=h._hasScroll(d,"left")?d.scrollWidth:o,r=h._hasScroll(d)?d.scrollHeight:n,h.parentData={element:d,left:s.left,top:s.top,width:a,height:r}))},resize:function(e){var i,s,n,o,a=t(this).resizable("instance"),r=a.options,h=a.containerOffset,l=a.position,c=a._aspectRatio||e.shiftKey,u={top:0,left:0},d=a.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=h),l.left<(a._helper?h.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-h.left:a.position.left-u.left),c&&(a.size.height=a.size.width/a.aspectRatio,p=!1),a.position.left=r.helper?h.left:0),l.top<(a._helper?h.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-h.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio,p=!1),a.position.top=a._helper?h.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-u.left:a.offset.left-h.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-u.top:a.offset.top-h.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,c&&(a.size.height=a.size.width/a.aspectRatio,p=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,c&&(a.size.width=a.size.height*a.aspectRatio,p=!1)),p||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),h=a.outerWidth()-e.sizeDiff.width,l=a.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var i=t(this).resizable("instance").options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var s=t(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};t(n.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(s[e]||0)+(r[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),!1!==t.uiBackCompat&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,c=h[1]||1,u=Math.round((n.width-o.width)/l)*l,d=Math.round((n.height-o.height)/c)*c,p=o.width+u,f=o.height+d,g=s.maxWidth&&p>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>f;s.grid=h,_&&(p+=l),v&&(f+=c),g&&(p-=l),m&&(f-=c),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=a.top-d):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=a.left-u):((0>=f-c||0>=p-l)&&(e=i._getPaddingPlusBorderDimensions(this)),f-c>0?(i.size.height=f,i.position.top=a.top-d):(f=c-e.height,i.size.height=f,i.position.top=a.top+o.height-f),p-l>0?(i.size.width=p,i.position.left=a.left-u):(p=l-e.width,i.size.width=p,i.position.left=a.left+o.width-p))}}),t.ui.resizable,t.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(t=e.parent.children().eq(e.index)).length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var i=this;this._isOpen&&!1!==this._trigger("beforeClose",e)&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||t.ui.safeBlur(t.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),o=Math.max.apply(null,n);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),s=!0),s&&!i&&this._trigger("focus",e),s},open:function(){var e=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=t(t.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).trigger("focus")},_keepFocus:function(e){function i(){var e=t.ui.safeActiveElement(this.document[0]);this.uiDialog[0]===e||t.contains(this.uiDialog[0],e)||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==s[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){n.trigger("focus")}),e.preventDefault()):(this._delay(function(){s.trigger("focus")}),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:t("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title?t.text(this.options.title):t.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?void this._removeClass(this.uiDialog,"ui-dialog-buttons"):(t.each(i,function(i,s){var n,o;s=t.isFunction(s)?{click:s,text:i}:s,s=t.extend({type:"button"},s),n=s.click,o={icon:s.icon,iconPosition:s.iconPosition,showLabel:s.showLabel,icons:s.icons,text:s.text},delete s.click,delete s.icon,delete s.iconPosition,delete s.showLabel,delete s.icons,"boolean"==typeof s.text&&delete s.text,t("<button></button>",s).button(o).appendTo(e.uiButtonSet).on("click",function(){n.apply(e.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){i._addClass(t(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,e(n))},drag:function(t,s){i._trigger("drag",t,e(s))},stop:function(n,o){var a=o.offset.left-i.document.scrollLeft(),r=o.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" top"+(r>=0?"+":"")+r,of:i.window},i._removeClass(t(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,s=this.options,n=s.resizable,o=this.uiDialog.css("position"),a="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:a,start:function(s,n){i._addClass(t(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,e(n))},resize:function(t,s){i._trigger("resize",t,e(s))},stop:function(n,o){var a=i.uiDialog.offset(),r=a.left-i.document.scrollLeft(),h=a.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" top"+(h>=0?"+":"")+h,of:i.window},i._removeClass(t(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,s=!1,n={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(s=!0),t in i.resizableRelatedOptions&&(n[t]=e)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,i){var s,n,o=this.uiDialog;"disabled"!==e&&(this._super(e,i),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:t("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&((s=o.is(":data(ui-draggable)"))&&!i&&o.draggable("destroy"),!s&&i&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&((n=o.is(":data(ui-resizable)"))&&!i&&o.resizable("destroy"),n&&"string"==typeof i&&o.resizable("option","handles",i),n||!1===i||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),t=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),e=Math.max(0,s.minHeight-t),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-t):"none","auto"===s.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return!!t(e.target).closest(".ui-dialog").length||!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),!1!==t.uiBackCompat&&t.widget("ui.dialog",t.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(t,e){"dialogClass"===t&&this.uiDialog.removeClass(this.options.dialogClass).addClass(e),this._superApply(arguments)}}),t.ui.dialog,t.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?void(e=arguments[0]):e||(e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight})},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var s=t.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,n=!1;return!(!s||(s.currentItem||s.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&v(s,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(n=!0,!1):void 0}),!n&&(!!this.accept.call(this.element[0],s.currentItem||s.element)&&(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",e,this.ui(s)),this.element)))},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var v=t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,s,n){if(!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,a=(e.positionAbs||e.position.absolute).top+e.margins.top,r=o+e.helperProportions.width,h=a+e.helperProportions.height,l=i.offset.left,c=i.offset.top,u=l+i.proportions().width,d=c+i.proportions().height;switch(s){case"fit":return o>=l&&u>=r&&a>=c&&d>=h;case"intersect":return o+e.helperProportions.width/2>l&&u>r-e.helperProportions.width/2&&a+e.helperProportions.height/2>c&&d>h-e.helperProportions.height/2;case"pointer":return t(n.pageY,c,i.proportions().height)&&t(n.pageX,l,i.proportions().width);case"touch":return(a>=c&&d>=a||h>=c&&d>=h||c>a&&h>d)&&(o>=l&&u>=o||r>=l&&u>=r||l>o&&r>u);default:return!1}}}();t.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(e,i){var s,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;o.length>s;s++)if(!(o[s].options.disabled||e&&!o[s].accept.call(o[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++)if(r[n]===o[s].element[0]){o[s].proportions().height=0;continue t}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&v(e,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,o,a=v(e,this,this.options.tolerance,i),r=!a&&this.isover?"isout":a&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,(o=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===n})).length&&(s=t(o[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},!1!==t.uiBackCompat&&t.widget("ui.droppable",t.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),t.ui.droppable,t.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=t("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(t){return void 0===t?this.options.value:(this.options.value=this._constrainedValue(t),void this._refreshValue())},_constrainedValue:function(t){return void 0===t&&(t=this.options.value),this.indeterminate=!1===t,"number"!=typeof t&&(t=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).width(i.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,e===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),s=i.offset(),n={left:s.left-e.elementPos.left,top:s.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(s.$element,"ui-selected"),s.selected=!1,i._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,s?"ui-unselecting":"ui-selected")._addClass(n.$element,s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,h=e.pageY;return o>r&&(i=r,r=o,o=i),a>h&&(i=h,h=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:h-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),l=!1,c={};i&&i.element!==s.element[0]&&(c.left=i.left+s.elementPos.left,c.right=i.right+s.elementPos.left,c.top=i.top+s.elementPos.top,c.bottom=i.bottom+s.elementPos.top,"touch"===n.tolerance?l=!(c.left>r||o>c.right||c.top>h||a>c.bottom):"fit"===n.tolerance&&(l=c.left>o&&r>c.right&&c.top>a&&h>c.bottom),l?(i.selected&&(s._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(s._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(s._addClass(i.$element,"ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,s._addClass(i.$element,"ui-selected"),i.selected=!0):(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(s._removeClass(i.$element,"ui-selected"),i.selected=!1,s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-selecting")._addClass(s.$element,"ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.selectmenu",[t.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=t()},_drawButton:function(){var e,i=this,s=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(t){this.button.focus(),t.preventDefault()}}),this.element.hide(),this.button=t("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),e=t("<span>").appendTo(this.button),this._addClass(e,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(s).appendTo(this.button),!1!==this.options.width&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){i._rendered||i._refreshMenu()})},_drawMenu:function(){var e=this;this.menu=t("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=t("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(t,i){t.preventDefault(),e._setSelection(),e._select(i.item.data("ui-selectmenu-item"),t)},focus:function(t,i){var s=i.item.data("ui-selectmenu-item");null!=e.focusIndex&&s.index!==e.focusIndex&&(e._trigger("focus",t,{item:s}),e.isOpen||e._select(s,t)),e.focusIndex=s.index,e.button.attr("aria-activedescendant",e.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var t,e=this.element.find("option");this.menu.empty(),this._parseOptions(e),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,e.length&&(t=this._getSelectedItem(),this.menuInstance.focus(null,t),this._setAria(t.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(t){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",t)))},_position:function(){this.menuWrap.position(t.extend({of:this.button},this.options.position))},close:function(t){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",t))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(e){var i=t("<span>");return this._setText(i,e.label),this._addClass(i,"ui-selectmenu-text"),i},_renderMenu:function(e,i){var s=this,n="";t.each(i,function(i,o){var a;o.optgroup!==n&&(a=t("<li>",{text:o.optgroup}),s._addClass(a,"ui-selectmenu-optgroup","ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),a.appendTo(e),n=o.optgroup),s._renderItemData(e,o)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-selectmenu-item",e)},_renderItem:function(e,i){var s=t("<li>"),n=t("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(s,null,"ui-state-disabled"),this._setText(n,i.label),s.append(n).appendTo(e)},_setText:function(t,e){e?t.text(e):t.html("&#160;")},_move:function(t,e){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),n+=":not(.ui-state-disabled)"),(s="first"===t||"last"===t?i["first"===t?"prevAll":"nextAll"](n).eq(-1):i[t+"All"](n).eq(0)).length&&this.menuInstance.focus(e,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(t){this[this.isOpen?"close":"open"](t)},_setSelection:function(){var t;this.range&&(window.getSelection?((t=window.getSelection()).removeAllRanges(),t.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(e){this.isOpen&&(t(e.target).closest(".ui-selectmenu-menu, #"+t.ui.escapeSelector(this.ids.button)).length||this.close(e))}},_buttonEvents:{mousedown:function(){var t;window.getSelection?(t=window.getSelection()).rangeCount&&(this.range=t.getRangeAt(0)):this.range=document.selection.createRange()},click:function(t){this._setSelection(),this._toggle(t)},keydown:function(e){var i=!0;switch(e.keyCode){case t.ui.keyCode.TAB:case t.ui.keyCode.ESCAPE:this.close(e),i=!1;break;case t.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case t.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case t.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case t.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case t.ui.keyCode.LEFT:this._move("prev",e);break;case t.ui.keyCode.RIGHT:this._move("next",e);break;case t.ui.keyCode.HOME:case t.ui.keyCode.PAGE_UP:this._move("first",e);break;case t.ui.keyCode.END:case t.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),i=!1}i&&e.preventDefault()}},_selectFocusedItem:function(t){var e=this.menuItems.eq(this.focusIndex).parent("li");e.hasClass("ui-state-disabled")||this._select(e.data("ui-selectmenu-item"),t)},_select:function(t,e){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=t.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(t)),this._setAria(t),this._trigger("select",e,{item:t}),t.index!==i&&this._trigger("change",e,{item:t}),this.close(e)},_setAria:function(t){var e=this.menuItems.eq(t.index).attr("id");this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(t,e){if("icons"===t){var i=this.button.find("span.ui-icon");this._removeClass(i,null,this.options.icons.button)._addClass(i,null,e.button)}this._super(t,e),"appendTo"===t&&this.menuWrap.appendTo(this._appendTo()),"width"===t&&this._resizeButton()},_setOptionDisabled:function(t){this._super(t),this.menuInstance.option("disabled",t),this.button.attr("aria-disabled",t),this._toggleClass(this.button,null,"ui-state-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var t=this.options.width;return!1===t?void this.button.css("width",""):(null===t&&(t=this.element.show().outerWidth(),this.element.hide()),void this.button.outerWidth(t))},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var t=this._super();return t.disabled=this.element.prop("disabled"),t},_parseOptions:function(e){var i=this,s=[];e.each(function(e,n){s.push(i._parseOption(t(n),e))}),this.items=s},_parseOption:function(t,e){var i=t.parent("optgroup");return{element:t,index:e,value:t.val(),label:t.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||t.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),t.widget("ui.slider",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,s=this.options,n=this.element.find(".ui-slider-handle"),a=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)a.push("<span tabindex='0'></span>");this.handles=n.add(t(a.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e).attr("tabIndex",0)})},_createRange:function(){var e=this.options;e.range?(!0===e.range&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=t("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),("min"===e.range||"max"===e.range)&&this._addClass(this.range,"ui-slider-range-"+e.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(e){var i,s,n,o,a,h,l,c=this,u=this.options;return!u.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-c.values(e));(n>i||n===i&&(e===c._lastChangedValue||c.values(e)===u.min))&&(n=i,o=t(this),a=e)}),!1!==this._start(e,a)&&(this._mouseSliding=!0,this._handleIndex=a,this._addClass(o,null,"ui-state-active"),o.trigger("focus"),h=o.offset(),l=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:e.pageX-h.left-o.width()/2,top:e.pageY-h.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,s,n,o;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),(s=i/e)>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),o=this._valueMin()+s*n,this._trimAlignValue(o)},_uiHash:function(t,e,i){var s={handle:this.handles[t],handleIndex:t,value:void 0!==e?e:this.value()};return this._hasMultipleValues()&&(s.value=void 0!==e?e:this.values(t),s.values=i||this.values()),s},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(t,e){return this._trigger("start",t,this._uiHash(e))},_slide:function(t,e,i){var n,o=this.value(),a=this.values();this._hasMultipleValues()&&(n=this.values(e?0:1),o=this.values(e),2===this.options.values.length&&!0===this.options.range&&(i=0===e?Math.min(n,i):Math.max(n,i)),a[e]=i),i!==o&&!1!==this._trigger("slide",t,this._uiHash(e,i,a))&&(this._hasMultipleValues()?this.values(e,i):this.value(i))},_stop:function(t,e){this._trigger("stop",t,this._uiHash(e))},_change:function(t,e){this._keySliding||this._mouseSliding||(this._lastChangedValue=e,this._trigger("change",t,this._uiHash(e)))},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,i){var s,n,o;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this._hasMultipleValues()?this._values(e):this.value();for(s=this.options.values,n=arguments[0],o=0;s.length>o;o+=1)s[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&!0===this.options.range&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),this._super(e,i),e){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=n-1;s>=0;s--)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(t){this._super(t),this._toggleClass(null,"ui-state-disabled",!!t)},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,s;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this._hasMultipleValues()){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,s=t-i;return 2*Math.abs(i)>=e&&(s+=i>0?e:-e),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step;(t=Math.round((t-e)/i)*i+e)>this.options.max&&(t-=i),this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(t){"vertical"===t&&this.range.css({width:"",left:""}),"horizontal"===t&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var e,i,s,n,o,a=this.options.range,r=this.options,h=this,l=!this._animateOff&&r.animate,c={};this._hasMultipleValues()?this.handles.each(function(s){i=(h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())*100,c["horizontal"===h.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[l?"animate":"css"](c,r.animate),!0===h.options.range&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?(s-n)/(o-n)*100:0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](c,r.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:100-i+"%"},r.animate),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:100-i+"%"},r.animate))},_handleEvents:{keydown:function(e){var s,n,o,a=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(t(e.target),null,"ui-state-active"),!1===this._start(e,a)))return}switch(o=this.options.step,s=n=this._hasMultipleValues()?this.values(a):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-o)}this._slide(e,a,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),this._removeClass(t(e.target),null,"ui-state-active"))}}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),!!s&&(!(this.options.handle&&!i&&(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),!n))&&(this.currentItem=s,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),!1!==r&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],(o=this._intersectsWithPointer(s))&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"!==this.options.type||!t.contains(this.element[0],n))){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,h=r+t.height,l=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+l>r&&h>s+l,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width);return!!(s&&n)&&(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1))},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],h=[],l=this._connectWith();if(l&&e)for(s=l.length-1;s>=0;s--)for(o=t(l[s],this.document[0]),n=o.length-1;n>=0;n--)(a=t.data(o[n],this.widgetFullName))&&a!==this&&!a.options.disabled&&h.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(h.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,h,l,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i],this.document[0]),s=n.length-1;s>=0;s--)(o=t.data(n[s],this.widgetFullName))&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(a=u[i][1],r=u[i][0],s=0,l=r.length;l>s;s++)(h=t(r[s])).data(this.widgetName+"-item",a),c.push({item:h,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)(s=this.items[i]).instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){var i,s=(e=e||this).options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,n,o,a,r,h,l,c,u,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,a=(c=d.floating||this._isFloating(this.currentItem))?"left":"top",r=c?"width":"height",u=c?"pageX":"pageY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[a],l=!1,e[u]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(e[u]-h)&&(n=Math.abs(e[u]-h),o=this.items[s],this.direction=l?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return void(this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1));o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===t.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e=this._super(),i=this.element;return t.each(["min","max","step"],function(t,s){var n=i.attr(s);null!=n&&n.length&&(e[s]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",t)))},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){this.element[0]===t.ui.safeActiveElement(this.document[0])||(this.element.trigger("focus"),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===t.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),!1!==this._start(e)&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?!1!==this._start(e)&&void this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e):void 0},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(e){var i=this.options,s=t.ui.keyCode;switch(e.keyCode){case s.UP:return this._repeat(null,1,e),!0;case s.DOWN:return this._repeat(null,-1,e),!0;case s.PAGE_UP:return this._repeat(null,i.page,e),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_start:function(t){return!(!this.spinning&&!1===this._trigger("start",t))&&(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",e,{value:i})||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,s=this.options;return e=null!==s.min?s.min:0,i=t-e,i=Math.round(i/s.step)*s.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==s.max&&t>s.max?s.max:null!==s.min&&s.min>t?s.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){var i,s,n;return"culture"===t||"numberFormat"===t?(i=this._parse(this.element.val()),this.options[t]=e,void this.element.val(this._format(i))):(("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(s=this.buttons.first().find(".ui-icon"),this._removeClass(s,null,this.options.icons.up),this._addClass(s,null,e.up),n=this.buttons.last().find(".ui-icon"),this._removeClass(n,null,this.options.icons.down),this._addClass(n,null,e.down)),void this._super(t,e))},_setOptionDisabled:function(t){this._super(t),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable")},_setOptions:r(function(t){this._super(t)}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null!==t&&t===this._adjustValue(t)},_value:function(t,e){var i;""!==t&&null!==(i=this._parse(t))&&(e||(i=this._adjustValue(i)),t=this._format(i)),this.element.val(t),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:r(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:r(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:r(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:r(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?void r(this._value).call(this,t):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),!1!==t.uiBackCompat&&t.widget("ui.spinner",t.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),t.ui.spinner,t.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var t=/#.*$/;return function(e){var i,s;i=e.href.replace(t,""),s=location.href.replace(t,"");try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return e.hash.length>1&&i===s}}(),_create:function(){var e=this,i=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,i.collapsible),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=!1!==this.options.active&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===e&&(s&&this.tabs.each(function(i,n){return t(n).attr("aria-controls")===s?(e=i,!1):void 0}),null===e&&(e=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===e||-1===e)&&(e=!!this.tabs.length&&0)),!1!==e&&-1===(e=this.tabs.index(this.tabs.eq(e)))&&(e=!i&&0),!i&&!1===e&&this.anchors.length&&(e=0),e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(t.ui.safeActiveElement(this.document[0])).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:s++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:n=!1,s--;break;case t.ui.keyCode.END:s=this.anchors.length-1;break;case t.ui.keyCode.HOME:s=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),void this._activate(s);case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),void this._activate(s!==this.options.active&&s);default:return}e.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),e.ctrlKey||e.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){function s(){return e>n&&(e=0),0>e&&(e=n),e}for(var n=this.tabs.length-1;-1!==t.inArray(s(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).trigger("focus"),t},_setOption:function(t,e){return"active"===t?void this._activate(e):(this._super(t,e),"collapsible"===t&&(this._toggleClass("ui-tabs-collapsible",null,e),e||!1!==this.options.active||this._activate(0)),"event"===t&&this._setupEvents(e),void("heightStyle"===t&&this._setupHeightStyle(e)))},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),!1!==e.active&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=t(),this.anchors.each(function(i,s){var n,o,a,r=t(s).uniqueId().attr("id"),h=t(s).closest("li"),l=h.attr("aria-controls");e._isLocal(s)?(n=s.hash,a=n.substring(1),o=e.element.find(e._sanitizeSelector(n))):(a=h.attr("aria-controls")||t({}).uniqueId()[0].id,n="#"+a,(o=e.element.find(n)).length||(o=e._createPanel(a)).insertAfter(e.panels[i-1]||e.tablist),o.attr("aria-live","polite")),o.length&&(e.panels=e.panels.add(o)),l&&h.data("ui-tabs-aria-controls",l),h.attr({"aria-controls":a,"aria-labelledby":r}),o.attr("aria-labelledby",r)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(e){var i,s,n;for(t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1),n=0;s=this.tabs[n];n++)i=t(s),!0===e||-1!==t.inArray(n,e)?(i.attr("aria-disabled","true"),this._addClass(i,null,"ui-state-disabled")):(i.removeAttr("aria-disabled"),this._removeClass(i,null,"ui-state-disabled"));this.options.disabled=e,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!0===e)},_setupEvents:function(e){var i={};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(t){t.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,s=this.element.parent();"fill"===e?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),s=e.css("position");"absolute"!==s&&"fixed"!==s&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,s=this.active,o=t(e.currentTarget).closest("li"),a=o[0]===s[0],r=a&&i.collapsible,h=r?t():this._getPanelForTab(o),l=s.length?this._getPanelForTab(s):t(),c={oldTab:s,oldPanel:l,newTab:r?t():o,newPanel:h};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||a&&!i.collapsible||!1===this._trigger("beforeActivate",e,c)||(i.active=!r&&this.tabs.index(o),this.active=a?t():o,this.xhr&&this.xhr.abort(),l.length||h.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),h.length&&this.load(this.tabs.index(o),e),this._toggle(e,c))},_toggle:function(e,i){function s(){o.running=!1,o._trigger("activate",e,i)}function n(){o._addClass(i.newTab.closest("li"),"ui-tabs-active","ui-state-active"),a.length&&o.options.show?o._show(a,o.options.show,s):(a.show(),s())}var o=this,a=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){o._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),n()}):(this._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),a.length&&r.length?i.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),a.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(e){var i,s=this._findActive(e);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return!1===e?t():this.tabs.eq(e)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+t.ui.escapeSelector(e)+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(e){var i=this.options.disabled;!1!==i&&(void 0===e?i=!1:(e=this._getIndex(e),i=t.isArray(i)?t.map(i,function(t){return t!==e?t:null}):t.map(this.tabs,function(t,i){return i!==e?i:null})),this._setOptionDisabled(i))},disable:function(e){var i=this.options.disabled;if(!0!==i){if(void 0===e)i=!0;else{if(e=this._getIndex(e),-1!==t.inArray(e,i))return;i=t.isArray(i)?t.merge([e],i).sort():[e]}this._setOptionDisabled(i)}},load:function(e,i){e=this._getIndex(e);var s=this,n=this.tabs.eq(e),o=n.find(".ui-tabs-anchor"),a=this._getPanelForTab(n),r={tab:n,panel:a},h=function(t,e){"abort"===e&&s.panels.stop(!1,!0),s._removeClass(n,"ui-tabs-loading"),a.removeAttr("aria-busy"),t===s.xhr&&delete s.xhr};this._isLocal(o[0])||(this.xhr=t.ajax(this._ajaxSettings(o,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(n,"ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.done(function(t,e,n){setTimeout(function(){a.html(t),s._trigger("load",i,r),h(n,e)},1)}).fail(function(t,e){setTimeout(function(){h(t,e)},1)})))},_ajaxSettings:function(e,i,s){var n=this;return{url:e.attr("href").replace(/#.*$/,""),beforeSend:function(e,o){return n._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:o},s))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),!1!==t.uiBackCompat&&t.widget("ui.tabs",t.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),t.ui.tabs,t.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var s=(e.attr("aria-describedby")||"").split(/\s+/);s.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(s.join(" ")))},_removeDescribedBy:function(e){var i=e.data("ui-tooltip-id"),s=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,s);-1!==n&&s.splice(n,1),e.removeData("ui-tooltip-id"),(s=t.trim(s.join(" ")))?e.attr("aria-describedby",s):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=t([])},_setOption:function(e,i){var s=this;this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){s._updateContent(e.element)})},_setOptionDisabled:function(t){this[t?"_disable":"_enable"]()},_disable:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s.element[0],e.close(n,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var e=t(this);return e.is("[title]")?e.data("ui-tooltip-title",e.attr("title")).removeAttr("title"):void 0}))},_enable:function(){this.disabledTitles.each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))}),this.disabledTitles=t([])},open:function(e){var i=this,s=t(e?e.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&s.parents().each(function(){var e,s=t(this);s.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(e,s),this._updateContent(s,e))},_updateContent:function(t,e){var i,s=this.options.content,n=this,o=e?e.type:null;return"string"==typeof s||s.nodeType||s.jquery?this._open(e,t,s):void((i=s.call(t[0],function(i){n._delay(function(){t.data("ui-tooltip-open")&&(e&&(e.type=o),this._open(e,t,i))})}))&&this._open(e,t,i))},_open:function(e,i,s){function n(t){l.of=t,a.is(":hidden")||a.position(l)}var o,a,r,h,l=t.extend({},this.options.position);if(s){if(o=this._find(i))return void o.tooltip.find(".ui-tooltip-content").html(s);i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),o=this._tooltip(i),a=o.tooltip,this._addDescribedBy(i,a.attr("id")),a.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),(h=t("<div>").html(a.find(".ui-tooltip-content").html())).removeAttr("name").find("[name]").removeAttr("name"),h.removeAttr("id").find("[id]").removeAttr("id"),h.appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:n}),n(e)):a.position(t.extend({of:i},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){a.is(":visible")&&(n(l.of),clearInterval(r))},t.fx.interval)),this._trigger("open",e,{tooltip:a})}},_registerCloseHandlers:function(e,i){var s={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var s=t.Event(e);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),e&&"mouseover"!==e.type||(s.mouseleave="close"),e&&"focusin"!==e.type||(s.focusout="close"),this._on(!0,i,s)},close:function(e){var i,s=this,n=t(e?e.currentTarget:this.element),o=this._find(n);return o?(i=o.tooltip,void(o.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete s.parents[e]}),o.closing=!0,this._trigger("close",e,{tooltip:i}),o.hiding||(o.closing=!1)))):void n.removeData("ui-tooltip-open")},_tooltip:function(e){var i=t("<div>").attr("role","tooltip"),s=t("<div>").appendTo(i),n=i.uniqueId().attr("id");return this._addClass(s,"ui-tooltip-content"),this._addClass(i,"ui-tooltip","ui-widget ui-widget-content"),i.appendTo(this._appendTo(e)),this.tooltips[n]={element:e,tooltip:i}},_find:function(t){var e=t.data("ui-tooltip-id");return e?this.tooltips[e]:null},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_appendTo:function(t){var e=t.closest(".ui-front, dialog");return e.length||(e=this.document[0].body),e},_destroy:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur"),o=s.element;n.target=n.currentTarget=o[0],e.close(n,!0),t("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),!1!==t.uiBackCompat&&t.widget("ui.tooltip",t.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var t=this._superApply(arguments);return this.options.tooltipClass&&t.tooltip.addClass(this.options.tooltipClass),t}}),t.ui.tooltip}),function($){"use strict";function Plugin(option,_relatedTarget){return this.each(function(){var $this=$(this),data=$this.data("bs.modal"),options=$.extend({},Modal.DEFAULTS,$this.data(),"object"==typeof option&&option);data||$this.data("bs.modal",data=new Modal(this,options)),"string"==typeof option?data[option](_relatedTarget):options.show&&data.show(_relatedTarget)})}var Modal=function(element,options){this.options=options,this.$body=$(document.body),this.$element=$(element),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,$.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};Modal.VERSION="3.3.7",Modal.TRANSITION_DURATION=300,Modal.BACKDROP_TRANSITION_DURATION=150,Modal.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},Modal.prototype.toggle=function(_relatedTarget){return this.isShown?this.hide():this.show(_relatedTarget)},Modal.prototype.show=function(_relatedTarget){var that=this,e=$.Event("show.bs.modal",{relatedTarget:_relatedTarget});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',$.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){that.$element.one("mouseup.dismiss.bs.modal",function(e){$(e.target).is(that.$element)&&(that.ignoreBackdropClick=!0)})}),this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass("fade");that.$element.parent().length||that.$element.appendTo(that.$body),that.$element.show().scrollTop(0),that.adjustDialog(),transition&&that.$element[0].offsetWidth,that.$element.addClass("in"),that.enforceFocus();var e=$.Event("shown.bs.modal",{relatedTarget:_relatedTarget});transition?that.$dialog.one("bsTransitionEnd",function(){that.$element.trigger("focus").trigger(e)}).emulateTransitionEnd(Modal.TRANSITION_DURATION):that.$element.trigger("focus").trigger(e)}))},Modal.prototype.hide=function(e){e&&e.preventDefault(),e=$.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),$(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),$.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",$.proxy(this.hideModal,this)).emulateTransitionEnd(Modal.TRANSITION_DURATION):this.hideModal())},Modal.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(e){document===e.target||this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},Modal.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",$.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},Modal.prototype.resize=function(){this.isShown?$(window).on("resize.bs.modal",$.proxy(this.handleUpdate,this)):$(window).off("resize.bs.modal")},Modal.prototype.hideModal=function(){var that=this;this.$element.hide(),this.backdrop(function(){that.$body.removeClass("modal-open"),that.resetAdjustments(),that.resetScrollbar(),that.$element.trigger("hidden.bs.modal")})},Modal.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},Modal.prototype.backdrop=function(callback){var that=this,animate=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;if(this.$backdrop=$(document.createElement("div")).addClass("modal-backdrop "+animate).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",$.proxy(function(e){this.ignoreBackdropClick?this.ignoreBackdropClick=!1:e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide())},this)),doAnimate&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!callback)return;doAnimate?this.$backdrop.one("bsTransitionEnd",callback).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var callbackRemove=function(){that.removeBackdrop(),callback&&callback()};$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",callbackRemove).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callbackRemove()}else callback&&callback()},Modal.prototype.handleUpdate=function(){this.adjustDialog()},Modal.prototype.adjustDialog=function(){var modalIsOverflowing=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&modalIsOverflowing?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!modalIsOverflowing?this.scrollbarWidth:""})},Modal.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},Modal.prototype.checkScrollbar=function(){var fullWindowWidth=window.innerWidth;if(!fullWindowWidth){var documentElementRect=document.documentElement.getBoundingClientRect();fullWindowWidth=documentElementRect.right-Math.abs(documentElementRect.left)}this.bodyIsOverflowing=document.body.clientWidth<fullWindowWidth,this.scrollbarWidth=this.measureScrollbar()},Modal.prototype.setScrollbar=function(){var bodyPad=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",bodyPad+this.scrollbarWidth)},Modal.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},Modal.prototype.measureScrollbar=function(){var scrollDiv=document.createElement("div");scrollDiv.className="modal-scrollbar-measure",this.$body.append(scrollDiv);var scrollbarWidth=scrollDiv.offsetWidth-scrollDiv.clientWidth;return this.$body[0].removeChild(scrollDiv),scrollbarWidth};var old=$.fn.modal;$.fn.modal=Plugin,$.fn.modal.Constructor=Modal,$.fn.modal.noConflict=function(){return $.fn.modal=old,this},$(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href=$this.attr("href"),$target=$($this.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("bs.modal")?"toggle":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());$this.is("a")&&e.preventDefault(),$target.one("show.bs.modal",function(showEvent){showEvent.isDefaultPrevented()||$target.one("hidden.bs.modal",function(){$this.is(":visible")&&$this.trigger("focus")})}),Plugin.call($target,option,this)})}(jQuery),function($){"use strict";$.fn.emulateTransitionEnd=function(duration){var called=!1,$el=this;$(this).one("bsTransitionEnd",function(){called=!0});return setTimeout(function(){called||$($el).trigger($.support.transition.end)},duration),this},$(function(){$.support.transition=function(){var el=document.createElement("bootstrap"),transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var name in transEndEventNames)if(void 0!==el.style[name])return{end:transEndEventNames[name]};return!1}(),$.support.transition&&($.event.special.bsTransitionEnd={bindType:$.support.transition.end,delegateType:$.support.transition.end,handle:function(e){if($(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}})})}(jQuery),function(root,factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports?module.exports=factory(require("jquery")):root.bootbox=factory(root.jQuery)}(this,function init($,undefined){"use strict";function _t(key){var locale=locales[defaults.locale];return locale?locale[key]:locales.en[key]}function processCallback(e,dialog,callback){e.stopPropagation(),e.preventDefault();$.isFunction(callback)&&!1===callback.call(dialog,e)||dialog.modal("hide")}function each(collection,iterator){var index=0;$.each(collection,function(key,value){iterator(key,value,index++)})}function mergeArguments(defaults,args,properties){return $.extend(!0,{},defaults,function(args,properties){var argn=args.length,options={};if(argn<1||argn>2)throw new Error("Invalid argument length");return 2===argn||"string"==typeof args[0]?(options[properties[0]]=args[0],options[properties[1]]=args[1]):options=args[0],options}(args,properties))}function mergeDialogOptions(className,labels,properties,args){return validateButtons(mergeArguments({className:"bootbox-"+className,buttons:createLabels.apply(null,labels)},args,properties),labels)}function createLabels(){for(var buttons={},i=0,j=arguments.length;i<j;i++){var argument=arguments[i],key=argument.toLowerCase(),value=argument.toUpperCase();buttons[key]={label:_t(value)}}return buttons}function validateButtons(options,buttons){var allowedButtons={};return each(buttons,function(key,value){allowedButtons[value]=!0}),each(options.buttons,function(key){if(allowedButtons[key]===undefined)throw new Error("button key "+key+" is not allowed (options are "+buttons.join("\n")+")")}),options}var templates_dialog="<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>",templates_header="<div class='modal-header'><h4 class='modal-title'></h4></div>",templates_footer="<div class='modal-footer'></div>",templates_closeButton="<button type='button' class='bootbox-close-button close' data-dismiss='modal' aria-hidden='true'>&times;</button>",templates_form="<form class='bootbox-form'></form>",templates_inputs={text:"<input class='bootbox-input bootbox-input-text form-control' autocomplete=off type=text />",textarea:"<textarea class='bootbox-input bootbox-input-textarea form-control'></textarea>",email:"<input class='bootbox-input bootbox-input-email form-control' autocomplete='off' type='email' />",select:"<select class='bootbox-input bootbox-input-select form-control'></select>",checkbox:"<div class='checkbox'><label><input class='bootbox-input bootbox-input-checkbox' type='checkbox' /></label></div>",date:"<input class='bootbox-input bootbox-input-date form-control' autocomplete=off type='date' />",time:"<input class='bootbox-input bootbox-input-time form-control' autocomplete=off type='time' />",number:"<input class='bootbox-input bootbox-input-number form-control' autocomplete=off type='number' />",password:"<input class='bootbox-input bootbox-input-password form-control' autocomplete='off' type='password' />"},defaults={locale:"en",backdrop:"static",animate:!0,className:null,closeButton:!0,show:!0,container:"body"},exports={};exports.alert=function(){var options;if((options=mergeDialogOptions("alert",["ok"],["message","callback"],arguments)).callback&&!$.isFunction(options.callback))throw new Error("alert requires callback property to be a function when provided");return options.buttons.ok.callback=options.onEscape=function(){return!$.isFunction(options.callback)||options.callback.call(this)},exports.dialog(options)},exports.confirm=function(){var options;if(options=mergeDialogOptions("confirm",["cancel","confirm"],["message","callback"],arguments),options.buttons.cancel.callback=options.onEscape=function(){return options.callback.call(this,!1)},options.buttons.confirm.callback=function(){return options.callback.call(this,!0)},!$.isFunction(options.callback))throw new Error("confirm requires a callback");return exports.dialog(options)},exports.prompt=function(){var options,defaults,dialog,form,input,shouldShow,inputOptions;if(form=$(templates_form),defaults={className:"bootbox-prompt",buttons:createLabels("cancel","confirm"),value:"",inputType:"text"},options=validateButtons(mergeArguments(defaults,arguments,["title","callback"]),["cancel","confirm"]),shouldShow=options.show===undefined||options.show,options.message=form,options.buttons.cancel.callback=options.onEscape=function(){return options.callback.call(this,null)},options.buttons.confirm.callback=function(){var value;switch(options.inputType){case"text":case"textarea":case"email":case"select":case"date":case"time":case"number":case"password":value=input.val();break;case"checkbox":var checkedItems=input.find("input:checked");value=[],each(checkedItems,function(_,item){value.push($(item).val())})}return options.callback.call(this,value)},options.show=!1,!options.title)throw new Error("prompt requires a title");if(!$.isFunction(options.callback))throw new Error("prompt requires a callback");if(!templates_inputs[options.inputType])throw new Error("invalid prompt type");switch(input=$(templates_inputs[options.inputType]),options.inputType){case"text":case"textarea":case"email":case"date":case"time":case"number":case"password":input.val(options.value);break;case"select":var groups={};if(inputOptions=options.inputOptions||[],!$.isArray(inputOptions))throw new Error("Please pass an array of input options");if(!inputOptions.length)throw new Error("prompt with select requires options");each(inputOptions,function(_,option){var elem=input;if(option.value===undefined||option.text===undefined)throw new Error("given options in wrong format");option.group&&(groups[option.group]||(groups[option.group]=$("<optgroup/>").attr("label",option.group)),elem=groups[option.group]),elem.append("<option value='"+option.value+"'>"+option.text+"</option>")}),each(groups,function(_,group){input.append(group)}),input.val(options.value);break;case"checkbox":var values=$.isArray(options.value)?options.value:[options.value];if(!(inputOptions=options.inputOptions||[]).length)throw new Error("prompt with checkbox requires options");if(!inputOptions[0].value||!inputOptions[0].text)throw new Error("given options in wrong format");input=$("<div/>"),each(inputOptions,function(_,option){var checkbox=$(templates_inputs[options.inputType]);checkbox.find("input").attr("value",option.value),checkbox.find("label").append(option.text),each(values,function(_,value){value===option.value&&checkbox.find("input").prop("checked",!0)}),input.append(checkbox)})}return options.placeholder&&input.attr("placeholder",options.placeholder),options.pattern&&input.attr("pattern",options.pattern),options.maxlength&&input.attr("maxlength",options.maxlength),form.append(input),form.on("submit",function(e){e.preventDefault(),e.stopPropagation(),dialog.find(".btn-primary").click()}),(dialog=exports.dialog(options)).off("shown.bs.modal"),dialog.on("shown.bs.modal",function(){input.focus()}),!0===shouldShow&&dialog.modal("show"),dialog},exports.dialog=function(options){options=function(options){var buttons,total;if("object"!=typeof options)throw new Error("Please supply an object of options");if(!options.message)throw new Error("Please specify a message");return(options=$.extend({},defaults,options)).buttons||(options.buttons={}),buttons=options.buttons,total=function(obj){var k,t=0;for(k in obj)t++;return t}(buttons),each(buttons,function(key,button,index){if($.isFunction(button)&&(button=buttons[key]={callback:button}),"object"!==$.type(button))throw new Error("button with key "+key+" must be an object");button.label||(button.label=key),button.className||(button.className=total<=2&&index===total-1?"btn-primary":"btn-default")}),options}(options);var dialog=$(templates_dialog),innerDialog=dialog.find(".modal-dialog"),body=dialog.find(".modal-body"),buttons=options.buttons,buttonStr="",callbacks={onEscape:options.onEscape};if($.fn.modal===undefined)throw new Error("$.fn.modal is not defined; please double check you have included the Bootstrap JavaScript library. See http://getbootstrap.com/javascript/ for more details.");if(each(buttons,function(key,button){buttonStr+="<button data-bb-handler='"+key+"' type='button' class='btn "+button.className+"'>"+button.label+"</button>",callbacks[key]=button.callback}),body.find(".bootbox-body").html(options.message),!0===options.animate&&dialog.addClass("fade"),options.className&&dialog.addClass(options.className),"large"===options.size?innerDialog.addClass("modal-lg"):"small"===options.size&&innerDialog.addClass("modal-sm"),options.title&&body.before(templates_header),options.closeButton){var closeButton=$(templates_closeButton);options.title?dialog.find(".modal-header").prepend(closeButton):closeButton.css("margin-top","-10px").prependTo(body)}return options.title&&dialog.find(".modal-title").html(options.title),buttonStr.length&&(body.after(templates_footer),dialog.find(".modal-footer").html(buttonStr)),dialog.on("hidden.bs.modal",function(e){e.target===this&&dialog.remove()}),dialog.on("shown.bs.modal",function(){dialog.find(".btn-primary:first").focus()}),"static"!==options.backdrop&&dialog.on("click.dismiss.bs.modal",function(e){dialog.children(".modal-backdrop").length&&(e.currentTarget=dialog.children(".modal-backdrop").get(0)),e.target===e.currentTarget&&dialog.trigger("escape.close.bb")}),dialog.on("escape.close.bb",function(e){callbacks.onEscape&&processCallback(e,dialog,callbacks.onEscape)}),dialog.on("click",".modal-footer button",function(e){var callbackKey=$(this).data("bb-handler");processCallback(e,dialog,callbacks[callbackKey])}),dialog.on("click",".bootbox-close-button",function(e){processCallback(e,dialog,callbacks.onEscape)}),dialog.on("keyup",function(e){27===e.which&&dialog.trigger("escape.close.bb")}),$(options.container).append(dialog),dialog.modal({backdrop:!!options.backdrop&&"static",keyboard:!1,show:!1}),options.show&&dialog.modal("show"),dialog},exports.setDefaults=function(){var values={};2===arguments.length?values[arguments[0]]=arguments[1]:values=arguments[0],$.extend(defaults,values)},exports.hideAll=function(){return $(".bootbox").modal("hide"),exports};var locales={bg_BG:{OK:"Ок",CANCEL:"Отказ",CONFIRM:"Потвърждавам"},br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},cs:{OK:"OK",CANCEL:"Zrušit",CONFIRM:"Potvrdit"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},el:{OK:"Εντάξει",CANCEL:"Ακύρωση",CONFIRM:"Επιβεβαίωση"},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},et:{OK:"OK",CANCEL:"Katkesta",CONFIRM:"OK"},fa:{OK:"قبول",CANCEL:"لغو",CONFIRM:"تایید"},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},he:{OK:"אישור",CANCEL:"ביטול",CONFIRM:"אישור"},hu:{OK:"OK",CANCEL:"Mégsem",CONFIRM:"Megerősít"},hr:{OK:"OK",CANCEL:"Odustani",CONFIRM:"Potvrdi"},id:{OK:"OK",CANCEL:"Batal",CONFIRM:"OK"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},ja:{OK:"OK",CANCEL:"キャンセル",CONFIRM:"確認"},lt:{OK:"Gerai",CANCEL:"Atšaukti",CONFIRM:"Patvirtinti"},lv:{OK:"Labi",CANCEL:"Atcelt",CONFIRM:"Apstiprināt"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},no:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"Potwierdź"},pt:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Confirmar"},ru:{OK:"OK",CANCEL:"Отмена",CONFIRM:"Применить"},sq:{OK:"OK",CANCEL:"Anulo",CONFIRM:"Prano"},sv:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},th:{OK:"ตกลง",CANCEL:"ยกเลิก",CONFIRM:"ยืนยัน"},tr:{OK:"Tamam",CANCEL:"İptal",CONFIRM:"Onayla"},zh_CN:{OK:"OK",CANCEL:"取消",CONFIRM:"确认"},zh_TW:{OK:"OK",CANCEL:"取消",CONFIRM:"確認"}};return exports.addLocale=function(name,values){return $.each(["OK","CANCEL","CONFIRM"],function(_,v){if(!values[v])throw new Error("Please supply a translation for '"+v+"'")}),locales[name]={OK:values.OK,CANCEL:values.CANCEL,CONFIRM:values.CONFIRM},exports},exports.removeLocale=function(name){return delete locales[name],exports},exports.setLocale=function(name){return exports.setDefaults("locale",name)},exports.init=function(_$){return init(_$||$)},exports}),function(k){"use strict";(typeof define==="function"&&define.amd?define:function(a,b){if(typeof module!=="undefined"&&module.exports){module.exports=b(require("jquery"))}else{b(jQuery)}})(["jquery"],function($){function both(a){return $.isFunction(a)||$.isPlainObject(a)?a:{top:a,left:a}}var j=$.scrollTo=function(a,b,c){return $(window).scrollTo(a,b,c)};return j.defaults={axis:"xy",duration:0,limit:!0},j.window=function(a){return $(window)._scrollable()},$.fn._scrollable=function(){return this.map(function(){var a=this;if(!(!a.nodeName||-1!=$.inArray(a.nodeName.toLowerCase(),["iframe","#document","html","body"])))return a;var b=(a.contentWindow||a).document||a.ownerDocument||a;return/webkit/i.test(navigator.userAgent)||"BackCompat"==b.compatMode?b.body:b.documentElement})},$.fn.scrollTo=function(f,g,h){return"object"==typeof g&&(h=g,g=0),"function"==typeof h&&(h={onAfter:h}),"max"==f&&(f=9e9),h=$.extend({},j.defaults,h),g=g||h.duration,h.queue=h.queue&&h.axis.length>1,h.queue&&(g/=2),h.offset=both(h.offset),h.over=both(h.over),this._scrollable().each(function(){function animate(a){$elem.animate(attr,g,h.easing,a&&function(){a.call(this,targ,h)})}if(null!=f){var toff,d=this,$elem=$(d),targ=f,attr={},win=$elem.is("html,body");switch(typeof targ){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break}if(!(targ=win?$(targ):$(targ,this)).length)return;case"object":(targ.is||targ.style)&&(toff=(targ=$(targ)).offset())}var e=$.isFunction(h.offset)&&h.offset(d,targ)||h.offset;$.each(h.axis.split(""),function(i,a){var b="x"==a?"Left":"Top",pos=b.toLowerCase(),key="scroll"+b,old=d[key],max=j.max(d,a);if(toff)attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]),h.margin&&(attr[key]-=parseInt(targ.css("margin"+b))||0,attr[key]-=parseInt(targ.css("border"+b+"Width"))||0),attr[key]+=e[pos]||0,h.over[pos]&&(attr[key]+=targ["x"==a?"width":"height"]()*h.over[pos]);else{var c=targ[pos];attr[key]=c.slice&&"%"==c.slice(-1)?parseFloat(c)/100*max:c}h.limit&&/^\d+$/.test(attr[key])&&(attr[key]=attr[key]<=0?0:Math.min(attr[key],max)),!i&&h.queue&&(old!=attr[key]&&animate(h.onAfterFirst),delete attr[key])}),animate(h.onAfter)}}).end()},j.max=function(a,b){var c="x"==b?"Width":"Height",scroll="scroll"+c;if(!$(a).is("html,body"))return a[scroll]-$(a)[c.toLowerCase()]();var d="client"+c,html=a.ownerDocument.documentElement,body=a.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[d],body[d])},j})}(),function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):"undefined"!=typeof module&&module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a,b){"use strict";if(!a.jstree){var c=0,d=!1,e=!1,f=!1,g=[],h=a("script:last").attr("src"),i=window.document;a.jstree={version:"3.3.4",defaults:{plugins:[]},plugins:{},path:h&&-1!==h.indexOf("/")?h.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},a.jstree.create=function(b,d){var e=new a.jstree.core(++c),f=d;return d=a.extend(!0,{},a.jstree.defaults,d),f&&f.plugins&&(d.plugins=f.plugins),a.each(d.plugins,function(a,b){"core"!==a&&(e=e.plugin(b,d[b]))}),a(b).data("jstree",e),e.init(b,d),e},a.jstree.destroy=function(){a(".jstree:jstree").jstree("destroy"),a(i).off(".jstree")},a.jstree.core=function(a){this._id=a,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1,ellipsis:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},a.jstree.reference=function(b){var c=null,d=null;if(!b||!b.id||b.tagName&&b.nodeType||(b=b.id),!d||!d.length)try{d=a(b)}catch(e){}if(!d||!d.length)try{d=a("#"+b.replace(a.jstree.idregex,"\\$&"))}catch(e){}return d&&d.length&&(d=d.closest(".jstree")).length&&(d=d.data("jstree"))?c=d:a(".jstree").each(function(){var d=a(this).data("jstree");return d&&d._model.data[b]?(c=d,!1):void 0}),c},a.fn.jstree=function(c){var d="string"==typeof c,e=Array.prototype.slice.call(arguments,1),f=null;return!(!0===c&&!this.length)&&(this.each(function(){var g=a.jstree.reference(this),h=d&&g?g[c]:null;return f=d&&h?h.apply(g,e):null,g||d||c!==b&&!a.isPlainObject(c)||a.jstree.create(this,c),(g&&!d||!0===c)&&(f=g||!1),(null===f||f===b)&&void 0}),null!==f&&f!==b?f:this)},a.expr.pseudos.jstree=a.expr.createPseudo(function(c){return function(c){return a(c).hasClass("jstree")&&a(c).data("jstree")!==b}}),a.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:a.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,ellipsis:!1,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},a.jstree.core.prototype={plugin:function(b,c){var d=a.jstree.plugins[b];return d?(this._data[b]={},d.prototype=this,new d(c,this)):this},init:function(b,c){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[a.jstree.root]={id:a.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=a(b).addClass("jstree jstree-"+this._id),this.settings=c,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().outerHeight()||24,this._data.core.node=this._create_prototype_node(),this.trigger("loading"),this.load_node(a.jstree.root)},destroy:function(a){if(this.trigger("destroy"),this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(b){}a||this.element.empty(),this.teardown()},_create_prototype_node:function(){var b,c,a=i.createElement("LI");return a.setAttribute("role","treeitem"),b=i.createElement("I"),b.className="jstree-icon jstree-ocl",b.setAttribute("role","presentation"),a.appendChild(b),b=i.createElement("A"),b.className="jstree-anchor",b.setAttribute("href","#"),b.setAttribute("tabindex","-1"),c=i.createElement("I"),c.className="jstree-icon jstree-themeicon",c.setAttribute("role","presentation"),b.appendChild(c),a.appendChild(b),b=c=null,a},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var b="",c=null,d=0;this.element.on("dblclick.jstree",function(a){if(a.target.tagName&&"input"===a.target.tagName.toLowerCase())return!0;if(i.selection&&i.selection.empty)i.selection.empty();else if(window.getSelection){var b=window.getSelection();try{b.removeAllRanges(),b.collapse()}catch(c){}}}).on("mousedown.jstree",a.proxy(function(a){a.target===this.element[0]&&(a.preventDefault(),d=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(a){a.preventDefault()}).on("click.jstree",".jstree-ocl",a.proxy(function(a){this.toggle_node(a.target)},this)).on("dblclick.jstree",".jstree-anchor",a.proxy(function(a){return!(!a.target.tagName||"input"!==a.target.tagName.toLowerCase())||void(this.settings.core.dblclick_toggle&&this.toggle_node(a.target))},this)).on("click.jstree",".jstree-anchor",a.proxy(function(b){b.preventDefault(),b.currentTarget!==i.activeElement&&a(b.currentTarget).focus(),this.activate_node(b.currentTarget,b)},this)).on("keydown.jstree",".jstree-anchor",a.proxy(function(b){if(b.target.tagName&&"input"===b.target.tagName.toLowerCase())return!0;if(32!==b.which&&13!==b.which&&(b.shiftKey||b.ctrlKey||b.altKey||b.metaKey))return!0;var c=null;switch(this._data.core.rtl&&(37===b.which?b.which=39:39===b.which&&(b.which=37)),b.which){case 32:b.ctrlKey&&(b.type="click",a(b.currentTarget).trigger(b));break;case 13:b.type="click",a(b.currentTarget).trigger(b);break;case 37:b.preventDefault(),this.is_open(b.currentTarget)?this.close_node(b.currentTarget):(c=this.get_parent(b.currentTarget))&&c.id!==a.jstree.root&&this.get_node(c,!0).children(".jstree-anchor").focus();break;case 38:b.preventDefault(),(c=this.get_prev_dom(b.currentTarget))&&c.length&&c.children(".jstree-anchor").focus();break;case 39:b.preventDefault(),this.is_closed(b.currentTarget)?this.open_node(b.currentTarget,function(a){this.get_node(a,!0).children(".jstree-anchor").focus()}):this.is_open(b.currentTarget)&&(c=this.get_node(b.currentTarget,!0).children(".jstree-children")[0])&&a(this._firstChild(c)).children(".jstree-anchor").focus();break;case 40:b.preventDefault(),(c=this.get_next_dom(b.currentTarget))&&c.length&&c.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:b.preventDefault(),(c=this._firstChild(this.get_container_ul()[0]))&&a(c).children(".jstree-anchor").filter(":visible").focus();break;case 35:b.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus();break;case 113:b.preventDefault(),this.edit(b.currentTarget)}},this)).on("load_node.jstree",a.proxy(function(b,c){c.status&&(c.node.id!==a.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(a.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var c,d,b=[];for(c=0,d=this._data.core.selected.length;d>c;c++)b=b.concat(this._model.data[this._data.core.selected[c]].parents);for(c=0,d=(b=a.vakata.array_unique(b)).length;d>c;c++)this.open_node(b[c],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",a.proxy(function(d){if(d.target.tagName&&"input"===d.target.tagName.toLowerCase())return!0;c&&clearTimeout(c),c=setTimeout(function(){b=""},500);var e=String.fromCharCode(d.which).toLowerCase(),f=this.element.find(".jstree-anchor").filter(":visible"),g=f.index(i.activeElement)||0,h=!1;if((b+=e).length>1){if(f.slice(g).each(a.proxy(function(c,d){return 0===a(d).text().toLowerCase().indexOf(b)?(a(d).focus(),h=!0,!1):void 0},this)),h)return;if(f.slice(0,g).each(a.proxy(function(c,d){return 0===a(d).text().toLowerCase().indexOf(b)?(a(d).focus(),h=!0,!1):void 0},this)),h)return}if(new RegExp("^"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(b)){if(f.slice(g+1).each(a.proxy(function(b,c){return a(c).text().toLowerCase().charAt(0)===e?(a(c).focus(),h=!0,!1):void 0},this)),h)return;if(f.slice(0,g+1).each(a.proxy(function(b,c){return a(c).text().toLowerCase().charAt(0)===e?(a(c).focus(),h=!0,!1):void 0},this)),h)return}},this)).on("init.jstree",a.proxy(function(){var a=this.settings.core.themes;this._data.core.themes.dots=a.dots,this._data.core.themes.stripes=a.stripes,this._data.core.themes.icons=a.icons,this._data.core.themes.ellipsis=a.ellipsis,this.set_theme(a.name||"default",a.url),this.set_theme_variant(a.variant)},this)).on("loading.jstree",a.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"](),this[this._data.core.themes.ellipsis?"show_ellipsis":"hide_ellipsis"]()},this)).on("blur.jstree",".jstree-anchor",a.proxy(function(b){this._data.core.focused=null,a(b.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",a.proxy(function(b){var c=this.get_node(b.currentTarget);c&&c.id&&(this._data.core.focused=c.id),this.element.find(".jstree-hovered").not(b.currentTarget).mouseleave(),a(b.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",a.proxy(function(){if(+new Date-d>500&&!this._data.core.focused){d=0;var a=this.get_node(this.element.attr("aria-activedescendant"),!0);a&&a.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",a.proxy(function(a){this.hover_node(a.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",a.proxy(function(a){this.dehover_node(a.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),a(i).off(".jstree-"+this._id)},trigger:function(a,b){b||(b={}),b.instance=this,this.element.triggerHandler(a.replace(".jstree","")+".jstree",b)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(b){var c=this.settings.core.strings;return a.isFunction(c)?c.call(this,b):c&&c[b]?c[b]:b},_firstChild:function(a){for(a=a?a.firstChild:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_nextSibling:function(a){for(a=a?a.nextSibling:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_previousSibling:function(a){for(a=a?a.previousSibling:null;null!==a&&1!==a.nodeType;)a=a.previousSibling;return a},get_node:function(b,c){b&&b.id&&(b=b.id);var d;try{if(this._model.data[b])b=this._model.data[b];else if("string"==typeof b&&this._model.data[b.replace(/^#/,"")])b=this._model.data[b.replace(/^#/,"")];else if("string"==typeof b&&(d=a("#"+b.replace(a.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[d.closest(".jstree-node").attr("id")])b=this._model.data[d.closest(".jstree-node").attr("id")];else if((d=a(b,this.element)).length&&this._model.data[d.closest(".jstree-node").attr("id")])b=this._model.data[d.closest(".jstree-node").attr("id")];else{if(!(d=a(b,this.element)).length||!d.hasClass("jstree"))return!1;b=this._model.data[a.jstree.root]}return c&&(b=b.id===a.jstree.root?this.element:a("#"+b.id.replace(a.jstree.idregex,"\\$&"),this.element)),b}catch(e){return!1}},get_path:function(b,c,d){if(!(b=b.parents?b:this.get_node(b))||b.id===a.jstree.root||!b.parents)return!1;var e,f,g=[];for(g.push(d?b.id:b.text),e=0,f=b.parents.length;f>e;e++)g.push(d?b.parents[e]:this.get_text(b.parents[e]));return g=g.reverse().slice(1),c?g.join(c):g},get_next_dom:function(b,c){var d;if((b=this.get_node(b,!0))[0]===this.element[0]){for(d=this._firstChild(this.get_container_ul()[0]);d&&0===d.offsetHeight;)d=this._nextSibling(d);return!!d&&a(d)}if(!b||!b.length)return!1;if(c){d=b[0];do{d=this._nextSibling(d)}while(d&&0===d.offsetHeight);return!!d&&a(d)}if(b.hasClass("jstree-open")){for(d=this._firstChild(b.children(".jstree-children")[0]);d&&0===d.offsetHeight;)d=this._nextSibling(d);if(null!==d)return a(d)}d=b[0];do{d=this._nextSibling(d)}while(d&&0===d.offsetHeight);return null!==d?a(d):b.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(b,c){var d;if((b=this.get_node(b,!0))[0]===this.element[0]){for(d=this.get_container_ul()[0].lastChild;d&&0===d.offsetHeight;)d=this._previousSibling(d);return!!d&&a(d)}if(!b||!b.length)return!1;if(c){d=b[0];do{d=this._previousSibling(d)}while(d&&0===d.offsetHeight);return!!d&&a(d)}d=b[0];do{d=this._previousSibling(d)}while(d&&0===d.offsetHeight);if(null!==d){for(b=a(d);b.hasClass("jstree-open");)b=b.children(".jstree-children").first().children(".jstree-node:visible:last");return b}return!(!(d=b[0].parentNode.parentNode)||!d.className||-1===d.className.indexOf("jstree-node"))&&a(d)},get_parent:function(b){return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&b.parent},get_children_dom:function(a){return(a=this.get_node(a,!0))[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!a||!a.length)&&a.children(".jstree-children").children(".jstree-node")},is_parent:function(a){return(a=this.get_node(a))&&(!1===a.state.loaded||a.children.length>0)},is_loaded:function(a){return(a=this.get_node(a))&&a.state.loaded},is_loading:function(a){return(a=this.get_node(a))&&a.state&&a.state.loading},is_open:function(a){return(a=this.get_node(a))&&a.state.opened},is_closed:function(a){return(a=this.get_node(a))&&this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},load_node:function(b,c){var d,e,f,g,h;if(a.isArray(b))return this._load_nodes(b.slice(),c),!0;if(!(b=this.get_node(b)))return c&&c.call(this,b,!1),!1;if(b.state.loaded){for(b.state.loaded=!1,f=0,g=b.parents.length;g>f;f++)this._model.data[b.parents[f]].children_d=a.vakata.array_filter(this._model.data[b.parents[f]].children_d,function(c){return-1===a.inArray(c,b.children_d)});for(d=0,e=b.children_d.length;e>d;d++)this._model.data[b.children_d[d]].state.selected&&(h=!0),delete this._model.data[b.children_d[d]];h&&(this._data.core.selected=a.vakata.array_filter(this._data.core.selected,function(c){return-1===a.inArray(c,b.children_d)})),b.children=[],b.children_d=[],h&&this.trigger("changed",{action:"load_node",node:b,selected:this._data.core.selected})}return b.state.failed=!1,b.state.loading=!0,this.get_node(b,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(b,a.proxy(function(a){(b=this._model.data[b.id]).state.loading=!1,b.state.loaded=a,b.state.failed=!b.state.loaded;var d=this.get_node(b,!0),e=0,f=0,g=this._model.data,h=!1;for(e=0,f=b.children.length;f>e;e++)if(g[b.children[e]]&&!g[b.children[e]].state.hidden){h=!0;break}b.state.loaded&&d&&d.length&&(d.removeClass("jstree-closed jstree-open jstree-leaf"),h?"#"!==b.id&&d.addClass(b.state.opened?"jstree-open":"jstree-closed"):d.addClass("jstree-leaf")),d.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:b,status:a}),c&&c.call(this,b,a)},this)),!0},_load_nodes:function(a,b,c,d){var h,i,e=!0,f=function(){this._load_nodes(a,b,!0)},g=this._model.data,j=[];for(h=0,i=a.length;i>h;h++)g[a[h]]&&(!g[a[h]].state.loaded&&!g[a[h]].state.failed||!c&&d)&&(this.is_loading(a[h])||this.load_node(a[h],f),e=!1);if(e){for(h=0,i=a.length;i>h;h++)g[a[h]]&&g[a[h]].state.loaded&&j.push(a[h]);b&&!b.done&&(b.call(this,j),b.done=!0)}},load_all:function(b,c){if(b||(b=a.jstree.root),!(b=this.get_node(b)))return!1;var g,h,d=[],e=this._model.data,f=e[b.id].children_d;for(b.state&&!b.state.loaded&&d.push(b.id),g=0,h=f.length;h>g;g++)e[f[g]]&&e[f[g]].state&&!e[f[g]].state.loaded&&d.push(f[g]);d.length?this._load_nodes(d,function(){this.load_all(b,c)}):(c&&c.call(this,b),this.trigger("load_all",{node:b}))},_load_node:function(b,c){var e,d=this.settings.core.data,f=function(){return 3!==this.nodeType&&8!==this.nodeType};return d?a.isFunction(d)?d.call(this,b,a.proxy(function(d){!1===d?c.call(this,!1):this["string"==typeof d?"_append_html_data":"_append_json_data"](b,"string"==typeof d?a(a.parseHTML(d)).filter(f):d,function(a){c.call(this,a)})},this)):"object"==typeof d?d.url?(d=a.extend(!0,{},d),a.isFunction(d.url)&&(d.url=d.url.call(this,b)),a.isFunction(d.data)&&(d.data=d.data.call(this,b)),a.ajax(d).done(a.proxy(function(d,e,g){var h=g.getResponseHeader("Content-Type");return h&&-1!==h.indexOf("json")||"object"==typeof d?this._append_json_data(b,d,function(a){c.call(this,a)}):h&&-1!==h.indexOf("html")||"string"==typeof d?this._append_html_data(b,a(a.parseHTML(d)).filter(f),function(a){c.call(this,a)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:b.id,xhr:g})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1))},this)).fail(a.proxy(function(a){this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:b.id,xhr:a})},c.call(this,!1),this.settings.core.error.call(this,this._data.core.last_error)},this))):(e=a.isArray(d)?a.extend(!0,[],d):a.isPlainObject(d)?a.extend(!0,{},d):d,b.id===a.jstree.root?this._append_json_data(b,e,function(a){c.call(this,a)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:b.id})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1))):"string"==typeof d?b.id===a.jstree.root?this._append_html_data(b,a(a.parseHTML(d)).filter(f),function(a){c.call(this,a)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:b.id})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1)):c.call(this,!1):b.id===a.jstree.root?this._append_html_data(b,this._data.core.original_container_html.clone(!0),function(a){c.call(this,a)}):c.call(this,!1)},_node_changed:function(a){(a=this.get_node(a))&&this._model.changed.push(a.id)},_append_html_data:function(b,c,d){(b=this.get_node(b)).children=[],b.children_d=[];var l,m,n,e=c.is("ul")?c.children():c,f=b.id,g=[],h=[],i=this._model.data,j=i[f],k=this._data.core.selected.length;for(e.each(a.proxy(function(b,c){(l=this._parse_model_from_html(a(c),f,j.parents.concat()))&&(g.push(l),h.push(l),i[l].children_d.length&&(h=h.concat(i[l].children_d)))},this)),j.children=g,j.children_d=h,m=0,n=j.parents.length;n>m;m++)i[j.parents[m]].children_d=i[j.parents[m]].children_d.concat(h);this.trigger("model",{nodes:h,parent:f}),f!==a.jstree.root?(this._node_changed(f),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==k&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),d.call(this,!0)},_append_json_data:function(b,c,d,e){if(null!==this.element){(b=this.get_node(b)).children=[],b.children_d=[],c.d&&"string"==typeof(c=c.d)&&(c=JSON.parse(c)),a.isArray(c)||(c=[c]);var f=null,g={df:this._model.default_state,dat:c,par:b.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},h=function(a,b){a.data&&(a=a.data);var n,o,p,q,c=a.dat,d=a.par,e=[],f=[],g=[],h=a.df,i=a.t_id,j=a.t_cnt,k=a.m,l=k[d],m=a.sel,r=function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var f,i,j,l,e=a.id.toString(),m={id:e,text:a.text||"",icon:a.icon===b||a.icon,parent:c,parents:d,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in h)h.hasOwnProperty(f)&&(m.state[f]=h[f]);if(a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(m.icon=a.data.jstree.icon),(m.icon===b||null===m.icon||""===m.icon)&&(m.icon=!0),a&&a.data&&(m.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(m.state[f]=a.data.jstree[f]);if(a&&"object"==typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(m.state[f]=a.state[f]);if(a&&"object"==typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(m.li_attr[f]=a.li_attr[f]);if(m.li_attr.id||(m.li_attr.id=e),a&&"object"==typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(m.a_attr[f]=a.a_attr[f]);for(a&&a.children&&!0===a.children&&(m.state.loaded=!1,m.children=[],m.children_d=[]),k[m.id]=m,f=0,i=m.children.length;i>f;f++)j=r(k[m.children[f]],m.id,d),l=k[j],m.children_d.push(j),l.children_d.length&&(m.children_d=m.children_d.concat(l.children_d));return delete a.data,delete a.children,k[m.id].original=a,m.state.selected&&g.push(m.id),m.id},s=function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var f,l,m,n,o,e=!1;do{e="j"+i+"_"+ ++j}while(k[e]);o={id:!1,text:"string"==typeof a?a:"",icon:"object"!=typeof a||a.icon===b||a.icon,parent:c,parents:d,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in h)h.hasOwnProperty(f)&&(o.state[f]=h[f]);if(a&&a.id&&(o.id=a.id.toString()),a&&a.text&&(o.text=a.text),a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(o.icon=a.data.jstree.icon),(o.icon===b||null===o.icon||""===o.icon)&&(o.icon=!0),a&&a.data&&(o.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(o.state[f]=a.data.jstree[f]);if(a&&"object"==typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(o.state[f]=a.state[f]);if(a&&"object"==typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(o.li_attr[f]=a.li_attr[f]);if(o.li_attr.id&&!o.id&&(o.id=o.li_attr.id.toString()),o.id||(o.id=e),o.li_attr.id||(o.li_attr.id=o.id),a&&"object"==typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(o.a_attr[f]=a.a_attr[f]);if(a&&a.children&&a.children.length){for(f=0,l=a.children.length;l>f;f++)m=s(a.children[f],o.id,d),n=k[m],o.children.push(m),n.children_d.length&&(o.children_d=o.children_d.concat(n.children_d));o.children_d=o.children_d.concat(o.children)}return a&&a.children&&!0===a.children&&(o.state.loaded=!1,o.children=[],o.children_d=[]),delete a.data,delete a.children,o.original=a,k[o.id]=o,o.state.selected&&g.push(o.id),o.id};if(c.length&&c[0].id!==b&&c[0].parent!==b){for(o=0,p=c.length;p>o;o++)c[o].children||(c[o].children=[]),k[c[o].id.toString()]=c[o];for(o=0,p=c.length;p>o;o++)k[c[o].parent.toString()].children.push(c[o].id.toString()),l.children_d.push(c[o].id.toString());for(o=0,p=l.children.length;p>o;o++)n=r(k[l.children[o]],d,l.parents.concat()),f.push(n),k[n].children_d.length&&(f=f.concat(k[n].children_d));for(o=0,p=l.parents.length;p>o;o++)k[l.parents[o]].children_d=k[l.parents[o]].children_d.concat(f);q={cnt:j,mod:k,sel:m,par:d,dpc:f,add:g}}else{for(o=0,p=c.length;p>o;o++)(n=s(c[o],d,l.parents.concat()))&&(e.push(n),f.push(n),k[n].children_d.length&&(f=f.concat(k[n].children_d)));for(l.children=e,l.children_d=f,o=0,p=l.parents.length;p>o;o++)k[l.parents[o]].children_d=k[l.parents[o]].children_d.concat(f);q={cnt:j,mod:k,sel:m,par:d,dpc:f,add:g}}return"undefined"!=typeof window&&void 0!==window.document?q:void postMessage(q)},i=function(b,c){if(null!==this.element){this._cnt=b.cnt;var e,f=this._model.data;for(e in f)f.hasOwnProperty(e)&&f[e].state&&f[e].state.loading&&b.mod[e]&&(b.mod[e].state.loading=!0);if(this._model.data=b.mod,c){var g,h=b.add,i=b.sel,j=this._data.core.selected.slice();if(f=this._model.data,i.length!==j.length||a.vakata.array_unique(i.concat(j)).length!==i.length){for(e=0,g=i.length;g>e;e++)-1===a.inArray(i[e],h)&&-1===a.inArray(i[e],j)&&(f[i[e]].state.selected=!1);for(e=0,g=j.length;g>e;e++)-1===a.inArray(j[e],i)&&(f[j[e]].state.selected=!0)}}b.add.length&&(this._data.core.selected=this._data.core.selected.concat(b.add)),this.trigger("model",{nodes:b.dpc,parent:b.par}),b.par!==a.jstree.root?(this._node_changed(b.par),this.redraw()):this.redraw(!0),b.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),d.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+h.toString()],{type:"text/javascript"}))),!this._data.core.working||e?(this._data.core.working=!0,f=new window.Worker(this._wrk),f.onmessage=a.proxy(function(a){i.call(this,a.data,!0);try{f.terminate(),f=null}catch(b){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),g.par?f.postMessage(g):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([b,c,d,!0])}catch(j){i.call(this,h(g),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else i.call(this,h(g),!1)}},_parse_model_from_html:function(c,d,e){e=e?[].concat(e):[],d&&e.unshift(d);var f,g,j,k,l,h=this._model.data,i={id:!1,text:!1,icon:!0,parent:d,parents:e,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(j in this._model.default_state)this._model.default_state.hasOwnProperty(j)&&(i.state[j]=this._model.default_state[j]);if(k=a.vakata.attributes(c,!0),a.each(k,function(b,c){return!(c=a.trim(c)).length||(i.li_attr[b]=c,void("id"===b&&(i.id=c.toString())))}),(k=c.children("a").first()).length&&(k=a.vakata.attributes(k,!0),a.each(k,function(b,c){(c=a.trim(c)).length&&(i.a_attr[b]=c)})),(k=c.children("a").first().length?c.children("a").first().clone():c.clone()).children("ins, i, ul").remove(),k=k.html(),k=a("<div />").html(k),i.text=this.settings.core.force_text?k.text():k.html(),k=c.data(),i.data=k?a.extend(!0,{},k):null,i.state.opened=c.hasClass("jstree-open"),i.state.selected=c.children("a").hasClass("jstree-clicked"),i.state.disabled=c.children("a").hasClass("jstree-disabled"),i.data&&i.data.jstree)for(j in i.data.jstree)i.data.jstree.hasOwnProperty(j)&&(i.state[j]=i.data.jstree[j]);(k=c.children("a").children(".jstree-themeicon")).length&&(i.icon=!k.hasClass("jstree-themeicon-hidden")&&k.attr("rel")),i.state.icon!==b&&(i.icon=i.state.icon),(i.icon===b||null===i.icon||""===i.icon)&&(i.icon=!0),k=c.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(h[l]);return i.id=i.li_attr.id?i.li_attr.id.toString():l,k.length?(k.each(a.proxy(function(b,c){f=this._parse_model_from_html(a(c),i.id,e),g=this._model.data[f],i.children.push(f),g.children_d.length&&(i.children_d=i.children_d.concat(g.children_d))},this)),i.children_d=i.children_d.concat(i.children)):c.hasClass("jstree-closed")&&(i.state.loaded=!1),i.li_attr.class&&(i.li_attr.class=i.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),i.a_attr.class&&(i.a_attr.class=i.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),h[i.id]=i,i.state.selected&&this._data.core.selected.push(i.id),i.id},_parse_model_from_flat_json:function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var h,i,j,k,e=a.id.toString(),f=this._model.data,g=this._model.default_state,l={id:e,text:a.text||"",icon:a.icon===b||a.icon,parent:c,parents:d,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(h in g)g.hasOwnProperty(h)&&(l.state[h]=g[h]);if(a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(l.icon=a.data.jstree.icon),(l.icon===b||null===l.icon||""===l.icon)&&(l.icon=!0),a&&a.data&&(l.data=a.data,a.data.jstree))for(h in a.data.jstree)a.data.jstree.hasOwnProperty(h)&&(l.state[h]=a.data.jstree[h]);if(a&&"object"==typeof a.state)for(h in a.state)a.state.hasOwnProperty(h)&&(l.state[h]=a.state[h]);if(a&&"object"==typeof a.li_attr)for(h in a.li_attr)a.li_attr.hasOwnProperty(h)&&(l.li_attr[h]=a.li_attr[h]);if(l.li_attr.id||(l.li_attr.id=e),a&&"object"==typeof a.a_attr)for(h in a.a_attr)a.a_attr.hasOwnProperty(h)&&(l.a_attr[h]=a.a_attr[h]);for(a&&a.children&&!0===a.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),f[l.id]=l,h=0,i=l.children.length;i>h;h++)j=this._parse_model_from_flat_json(f[l.children[h]],l.id,d),k=f[j],l.children_d.push(j),k.children_d.length&&(l.children_d=l.children_d.concat(k.children_d));return delete a.data,delete a.children,f[l.id].original=a,l.state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_json:function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var f,g,h,i,l,e=!1,j=this._model.data,k=this._model.default_state;do{e="j"+this._id+"_"+ ++this._cnt}while(j[e]);l={id:!1,text:"string"==typeof a?a:"",icon:"object"!=typeof a||a.icon===b||a.icon,parent:c,parents:d,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in k)k.hasOwnProperty(f)&&(l.state[f]=k[f]);if(a&&a.id&&(l.id=a.id.toString()),a&&a.text&&(l.text=a.text),a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(l.icon=a.data.jstree.icon),(l.icon===b||null===l.icon||""===l.icon)&&(l.icon=!0),a&&a.data&&(l.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(l.state[f]=a.data.jstree[f]);if(a&&"object"==typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(l.state[f]=a.state[f]);if(a&&"object"==typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(l.li_attr[f]=a.li_attr[f]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=e),l.li_attr.id||(l.li_attr.id=l.id),a&&"object"==typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(l.a_attr[f]=a.a_attr[f]);if(a&&a.children&&a.children.length){for(f=0,g=a.children.length;g>f;f++)h=this._parse_model_from_json(a.children[f],l.id,d),i=j[h],l.children.push(h),i.children_d.length&&(l.children_d=l.children_d.concat(i.children_d));l.children_d=l.children_d.concat(l.children)}return a&&a.children&&!0===a.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete a.data,delete a.children,l.original=a,j[l.id]=l,l.state.selected&&this._data.core.selected.push(l.id),l.id},_redraw:function(){var d,e,f,b=this._model.force_full_redraw?this._model.data[a.jstree.root].children.concat([]):this._model.changed.concat([]),c=i.createElement("UL"),g=this._data.core.focused;for(e=0,f=b.length;f>e;e++)(d=this.redraw_node(b[e],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&c.appendChild(d);this._model.force_full_redraw&&(c.className=this.get_container_ul()[0].className,c.setAttribute("role","group"),this.element.empty().append(c)),null!==g&&((d=this.get_node(g,!0))&&d.length&&d.children(".jstree-anchor")[0]!==i.activeElement?d.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:b})},redraw:function(a){a&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(b){var c=this.get_node(b),d=!1,e=!1,f=!1,g=i;if(!c)return!1;if(c.id===a.jstree.root)return this.redraw(!0);if(!(b=this.get_node(b,!0))||!b.length)return!1;if(b.children(".jstree-children").remove(),b=b[0],c.children.length&&c.state.loaded){for((f=g.createElement("UL")).setAttribute("role","group"),f.className="jstree-children",d=0,e=c.children.length;e>d;d++)f.appendChild(this.redraw_node(c.children[d],!0,!0));b.appendChild(f)}},redraw_node:function(b,c,d,e){var f=this.get_node(b),g=!1,h=!1,j=!1,k=!1,l=!1,m=!1,n="",o=i,p=this._model.data,q=!1,s=null,t=0,u=0,v=!1,w=!1;if(!f)return!1;if(f.id===a.jstree.root)return this.redraw(!0);if(c=c||0===f.children.length,b=i.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(f.id[0])?"\\3"+f.id[0]+" "+f.id.substr(1).replace(a.jstree.idregex,"\\$&"):f.id.replace(a.jstree.idregex,"\\$&"))):i.getElementById(f.id))b=a(b),d||((g=b.parent().parent()[0])===this.element[0]&&(g=null),h=b.index()),c||!f.children.length||b.children(".jstree-children").length||(c=!0),c||(j=b.children(".jstree-children")[0]),q=b.children(".jstree-anchor")[0]===i.activeElement,b.remove();else if(c=!0,!d){if(!(null===(g=f.parent!==a.jstree.root?a("#"+f.parent.replace(a.jstree.idregex,"\\$&"),this.element)[0]:null)||g&&p[f.parent].state.opened))return!1;h=a.inArray(f.id,null===g?p[a.jstree.root].children:p[f.parent].children)}b=this._data.core.node.cloneNode(!0),n="jstree-node ";for(k in f.li_attr)if(f.li_attr.hasOwnProperty(k)){if("id"===k)continue;"class"!==k?b.setAttribute(k,f.li_attr[k]):n+=f.li_attr[k]}for(f.a_attr.id||(f.a_attr.id=f.id+"_anchor"),b.setAttribute("aria-selected",!!f.state.selected),b.setAttribute("aria-level",f.parents.length),b.setAttribute("aria-labelledby",f.a_attr.id),f.state.disabled&&b.setAttribute("aria-disabled",!0),k=0,l=f.children.length;l>k;k++)if(!p[f.children[k]].state.hidden){v=!0;break}if(null!==f.parent&&p[f.parent]&&!f.state.hidden&&(k=a.inArray(f.id,p[f.parent].children),w=f.id,-1!==k))for(k++,l=p[f.parent].children.length;l>k&&(p[p[f.parent].children[k]].state.hidden||(w=p[f.parent].children[k]),w===f.id);k++);f.state.hidden&&(n+=" jstree-hidden"),f.state.loaded&&!v?n+=" jstree-leaf":(n+=f.state.opened&&f.state.loaded?" jstree-open":" jstree-closed",b.setAttribute("aria-expanded",f.state.opened&&f.state.loaded)),w===f.id&&(n+=" jstree-last"),b.id=f.id,b.className=n,n=(f.state.selected?" jstree-clicked":"")+(f.state.disabled?" jstree-disabled":"");for(l in f.a_attr)if(f.a_attr.hasOwnProperty(l)){if("href"===l&&"#"===f.a_attr[l])continue;"class"!==l?b.childNodes[1].setAttribute(l,f.a_attr[l]):n+=" "+f.a_attr[l]}if(n.length&&(b.childNodes[1].className="jstree-anchor "+n),(f.icon&&!0!==f.icon||!1===f.icon)&&(!1===f.icon?b.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===f.icon.indexOf("/")&&-1===f.icon.indexOf(".")?b.childNodes[1].childNodes[0].className+=" "+f.icon+" jstree-themeicon-custom":(b.childNodes[1].childNodes[0].style.backgroundImage='url("'+f.icon+'")',b.childNodes[1].childNodes[0].style.backgroundPosition="center center",b.childNodes[1].childNodes[0].style.backgroundSize="auto",b.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?b.childNodes[1].appendChild(o.createTextNode(f.text)):b.childNodes[1].innerHTML+=f.text,c&&f.children.length&&(f.state.opened||e)&&f.state.loaded){for((m=o.createElement("UL")).setAttribute("role","group"),m.className="jstree-children",k=0,l=f.children.length;l>k;k++)m.appendChild(this.redraw_node(f.children[k],c,!0));b.appendChild(m)}if(j&&b.appendChild(j),!d){for(g||(g=this.element[0]),k=0,l=g.childNodes.length;l>k;k++)if(g.childNodes[k]&&g.childNodes[k].className&&-1!==g.childNodes[k].className.indexOf("jstree-children")){s=g.childNodes[k];break}s||((s=o.createElement("UL")).setAttribute("role","group"),s.className="jstree-children",g.appendChild(s)),h<(g=s).childNodes.length?g.insertBefore(b,g.childNodes[h]):g.appendChild(b),q&&(t=this.element[0].scrollTop,u=this.element[0].scrollLeft,b.childNodes[1].focus(),this.element[0].scrollTop=t,this.element[0].scrollLeft=u)}return f.state.opened&&!f.state.loaded&&(f.state.opened=!1,setTimeout(a.proxy(function(){this.open_node(f.id,!1,0)},this),0)),b},open_node:function(c,d,e){var f,g,h,i;if(a.isArray(c)){for(f=0,g=(c=c.slice()).length;g>f;f++)this.open_node(c[f],d,e);return!0}return!(!(c=this.get_node(c))||c.id===a.jstree.root)&&(e=e===b?this.settings.core.animation:e,this.is_closed(c)?this.is_loaded(c)?(h=this.get_node(c,!0),i=this,h.length&&(e&&h.children(".jstree-children").length&&h.children(".jstree-children").stop(!0,!0),c.children.length&&!this._firstChild(h.children(".jstree-children")[0])&&this.draw_children(c),e?(this.trigger("before_open",{node:c}),h.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(e,function(){this.style.display="",i.element&&i.trigger("after_open",{node:c})})):(this.trigger("before_open",{node:c}),h[0].className=h[0].className.replace("jstree-closed","jstree-open"),h[0].setAttribute("aria-expanded",!0))),c.state.opened=!0,d&&d.call(this,c,!0),h.length||this.trigger("before_open",{node:c}),this.trigger("open_node",{node:c}),e&&h.length||this.trigger("after_open",{node:c}),!0):this.is_loading(c)?setTimeout(a.proxy(function(){this.open_node(c,d,e)},this),500):void this.load_node(c,function(a,b){return b?this.open_node(a,d,e):!!d&&d.call(this,a,!1)}):(d&&d.call(this,c,!1),!1))},_open_to:function(b){if(!(b=this.get_node(b))||b.id===a.jstree.root)return!1;var c,d,e=b.parents;for(c=0,d=e.length;d>c;c+=1)c!==a.jstree.root&&this.open_node(e[c],!1,0);return a("#"+b.id.replace(a.jstree.idregex,"\\$&"),this.element)},close_node:function(c,d){var e,f,g,h;if(a.isArray(c)){for(e=0,f=(c=c.slice()).length;f>e;e++)this.close_node(c[e],d);return!0}return!(!(c=this.get_node(c))||c.id===a.jstree.root)&&!this.is_closed(c)&&(d=d===b?this.settings.core.animation:d,g=this,h=this.get_node(c,!0),c.state.opened=!1,this.trigger("close_node",{node:c}),void(h.length?d?h.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(d,function(){this.style.display="",h.children(".jstree-children").remove(),g.element&&g.trigger("after_close",{node:c})}):(h[0].className=h[0].className.replace("jstree-open","jstree-closed"),h.attr("aria-expanded",!1).children(".jstree-children").remove(),this.trigger("after_close",{node:c})):this.trigger("after_close",{node:c})))},toggle_node:function(b){var c,d;if(a.isArray(b)){for(c=0,d=(b=b.slice()).length;d>c;c++)this.toggle_node(b[c]);return!0}return this.is_closed(b)?this.open_node(b):this.is_open(b)?this.close_node(b):void 0},open_all:function(b,c,d){if(b||(b=a.jstree.root),!(b=this.get_node(b)))return!1;var f,g,h,e=b.id===a.jstree.root?this.get_container_ul():this.get_node(b,!0);if(!e.length){for(f=0,g=b.children_d.length;g>f;f++)this.is_closed(this._model.data[b.children_d[f]])&&(this._model.data[b.children_d[f]].state.opened=!0);return this.trigger("open_all",{node:b})}d=d||e,h=this,(e=this.is_closed(b)?e.find(".jstree-closed").addBack():e.find(".jstree-closed")).each(function(){h.open_node(this,function(a,b){b&&this.is_parent(a)&&this.open_all(a,c,d)},c||0)}),0===d.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(d)})},close_all:function(b,c){if(b||(b=a.jstree.root),!(b=this.get_node(b)))return!1;var f,g,d=b.id===a.jstree.root?this.get_container_ul():this.get_node(b,!0),e=this;for(d.length&&(d=this.is_open(b)?d.find(".jstree-open").addBack():d.find(".jstree-open"),a(d.get().reverse()).each(function(){e.close_node(this,c||0)})),f=0,g=b.children_d.length;g>f;f++)this._model.data[b.children_d[f]].state.opened=!1;this.trigger("close_all",{node:b})},is_disabled:function(a){return(a=this.get_node(a))&&a.state&&a.state.disabled},enable_node:function(b){var c,d;if(a.isArray(b)){for(c=0,d=(b=b.slice()).length;d>c;c++)this.enable_node(b[c]);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(b.state.disabled=!1,this.get_node(b,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:b}))},disable_node:function(b){var c,d;if(a.isArray(b)){for(c=0,d=(b=b.slice()).length;d>c;c++)this.disable_node(b[c]);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(b.state.disabled=!0,this.get_node(b,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:b}))},is_hidden:function(a){return!0===(a=this.get_node(a)).state.hidden},hide_node:function(b,c){var d,e;if(a.isArray(b)){for(d=0,e=(b=b.slice()).length;e>d;d++)this.hide_node(b[d],!0);return c||this.redraw(),!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&void(b.state.hidden||(b.state.hidden=!0,this._node_changed(b.parent),c||this.redraw(),this.trigger("hide_node",{node:b})))},show_node:function(b,c){var d,e;if(a.isArray(b)){for(d=0,e=(b=b.slice()).length;e>d;d++)this.show_node(b[d],!0);return c||this.redraw(),!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&void(b.state.hidden&&(b.state.hidden=!1,this._node_changed(b.parent),c||this.redraw(),this.trigger("show_node",{node:b})))},hide_all:function(b){var c,d=this._model.data,e=[];for(c in d)d.hasOwnProperty(c)&&c!==a.jstree.root&&!d[c].state.hidden&&(d[c].state.hidden=!0,e.push(c));return this._model.force_full_redraw=!0,b||this.redraw(),this.trigger("hide_all",{nodes:e}),e},show_all:function(b){var c,d=this._model.data,e=[];for(c in d)d.hasOwnProperty(c)&&c!==a.jstree.root&&d[c].state.hidden&&(d[c].state.hidden=!1,e.push(c));return this._model.force_full_redraw=!0,b||this.redraw(),this.trigger("show_all",{nodes:e}),e},activate_node:function(a,c){if(this.is_disabled(a))return!1;if(c&&"object"==typeof c||(c={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==b?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(c.metaKey||c.ctrlKey||c.shiftKey)&&(!c.shiftKey||this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(c.shiftKey){var h,i,d=this.get_node(a).id,e=this._data.core.last_clicked.id,f=this.get_node(this._data.core.last_clicked.parent).children,g=!1;for(h=0,i=f.length;i>h;h+=1)f[h]===d&&(g=!g),f[h]===e&&(g=!g),this.is_disabled(f[h])||!g&&f[h]!==d&&f[h]!==e?this.deselect_node(f[h],!0,c):this.is_hidden(f[h])||this.select_node(f[h],!0,!1,c);this.trigger("changed",{action:"select_node",node:this.get_node(a),selected:this._data.core.selected,event:c})}else this.is_selected(a)?this.deselect_node(a,!1,c):this.select_node(a,!1,!1,c);else!this.settings.core.multiple&&(c.metaKey||c.ctrlKey||c.shiftKey)&&this.is_selected(a)?this.deselect_node(a,!1,c):(this.deselect_all(!0),this.select_node(a,!1,!1,c),this._data.core.last_clicked=this.get_node(a));this.trigger("activate_node",{node:this.get_node(a),event:c})},hover_node:function(a){if(!(a=this.get_node(a,!0))||!a.length||a.children(".jstree-hovered").length)return!1;var b=this.element.find(".jstree-hovered"),c=this.element;b&&b.length&&this.dehover_node(b),a.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(a)}),setTimeout(function(){c.attr("aria-activedescendant",a[0].id)},0)},dehover_node:function(a){return!!((a=this.get_node(a,!0))&&a.length&&a.children(".jstree-hovered").length)&&(a.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(a)}))},select_node:function(b,c,d,e){var f,g,h;if(a.isArray(b)){for(g=0,h=(b=b.slice()).length;h>g;g++)this.select_node(b[g],c,d,e);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(f=this.get_node(b,!0),void(b.state.selected||(b.state.selected=!0,this._data.core.selected.push(b.id),d||(f=this._open_to(b)),f&&f.length&&f.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:b,selected:this._data.core.selected,event:e}),c||this.trigger("changed",{action:"select_node",node:b,selected:this._data.core.selected,event:e}))))},deselect_node:function(b,c,d){var e,f,g;if(a.isArray(b)){for(e=0,f=(b=b.slice()).length;f>e;e++)this.deselect_node(b[e],c,d);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(g=this.get_node(b,!0),void(b.state.selected&&(b.state.selected=!1,this._data.core.selected=a.vakata.array_remove_item(this._data.core.selected,b.id),g.length&&g.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:b,selected:this._data.core.selected,event:d}),c||this.trigger("changed",{action:"deselect_node",node:b,selected:this._data.core.selected,event:d}))))},select_all:function(b){var d,e,c=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[a.jstree.root].children_d.concat(),d=0,e=this._data.core.selected.length;e>d;d++)this._model.data[this._data.core.selected[d]]&&(this._model.data[this._data.core.selected[d]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),b||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:c})},deselect_all:function(a){var c,d,b=this._data.core.selected.concat([]);for(c=0,d=this._data.core.selected.length;d>c;c++)this._model.data[this._data.core.selected[c]]&&(this._model.data[this._data.core.selected[c]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:b}),a||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:b})},is_selected:function(b){return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&b.state.selected},get_selected:function(b){return b?a.map(this._data.core.selected,a.proxy(function(a){return this.get_node(a)},this)):this._data.core.selected.slice()},get_top_selected:function(b){var e,f,g,h,c=this.get_selected(!0),d={};for(e=0,f=c.length;f>e;e++)d[c[e].id]=c[e];for(e=0,f=c.length;f>e;e++)for(g=0,h=c[e].children_d.length;h>g;g++)d[c[e].children_d[g]]&&delete d[c[e].children_d[g]];c=[];for(e in d)d.hasOwnProperty(e)&&c.push(e);return b?a.map(c,a.proxy(function(a){return this.get_node(a)},this)):c},get_bottom_selected:function(b){var e,f,c=this.get_selected(!0),d=[];for(e=0,f=c.length;f>e;e++)c[e].children.length||d.push(c[e].id);return b?a.map(d,a.proxy(function(a){return this.get_node(a)},this)):d},get_state:function(){var c,b={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(c in this._model.data)this._model.data.hasOwnProperty(c)&&c!==a.jstree.root&&(this._model.data[c].state.opened&&b.core.open.push(c),this._model.data[c].state.selected&&b.core.selected.push(c));return b},set_state:function(c,d){if(c){if(c.core&&c.core.selected&&c.core.initial_selection===b&&(c.core.initial_selection=this._data.core.selected.concat([]).sort().join(",")),c.core){var h,i;if(c.core.open)return a.isArray(c.core.open)&&c.core.open.length?this._load_nodes(c.core.open,function(a){this.open_node(a,!1,0),delete c.core.open,this.set_state(c,d)}):(delete c.core.open,this.set_state(c,d)),!1;if(c.core.scroll)return c.core.scroll&&c.core.scroll.left!==b&&this.element.scrollLeft(c.core.scroll.left),c.core.scroll&&c.core.scroll.top!==b&&this.element.scrollTop(c.core.scroll.top),delete c.core.scroll,this.set_state(c,d),!1;if(c.core.selected)return h=this,(c.core.initial_selection===b||c.core.initial_selection===this._data.core.selected.concat([]).sort().join(","))&&(this.deselect_all(),a.each(c.core.selected,function(a,b){h.select_node(b,!1,!0)})),delete c.core.initial_selection,delete c.core.selected,this.set_state(c,d),!1;for(i in c)c.hasOwnProperty(i)&&"core"!==i&&-1===a.inArray(i,this.settings.plugins)&&delete c[i];if(a.isEmptyObject(c.core))return delete c.core,this.set_state(c,d),!1}return!a.isEmptyObject(c)||(c=null,d&&d.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(b,c){this._data.core.state=!0===c?{}:this.get_state(),c&&a.isFunction(c)&&(this._data.core.state=c.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[a.jstree.root]={id:a.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var d=this.get_container_ul()[0].className;b||(this.element.html("<ul class='"+d+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(a.jstree.root,function(b,c){c&&(this.get_container_ul()[0].className=d,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(a.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(b){if(!(b=this.get_node(b))||b.id===a.jstree.root)return!1;var c=[],d=[],e=this._data.core.selected.concat([]);d.push(b.id),!0===b.state.opened&&c.push(b.id),this.get_node(b,!0).find(".jstree-open").each(function(){d.push(this.id),c.push(this.id)}),this._load_nodes(d,a.proxy(function(a){this.open_node(c,!1,0),this.select_node(e),this.trigger("refresh_node",{node:b,nodes:a})},this),!1,!0)},set_id:function(b,c){if(!(b=this.get_node(b))||b.id===a.jstree.root)return!1;var d,e,f=this._model.data,g=b.id;for(c=c.toString(),f[b.parent].children[a.inArray(b.id,f[b.parent].children)]=c,d=0,e=b.parents.length;e>d;d++)f[b.parents[d]].children_d[a.inArray(b.id,f[b.parents[d]].children_d)]=c;for(d=0,e=b.children.length;e>d;d++)f[b.children[d]].parent=c;for(d=0,e=b.children_d.length;e>d;d++)f[b.children_d[d]].parents[a.inArray(b.id,f[b.children_d[d]].parents)]=c;return-1!==(d=a.inArray(b.id,this._data.core.selected))&&(this._data.core.selected[d]=c),(d=this.get_node(b.id,!0))&&(d.attr("id",c),this.element.attr("aria-activedescendant")===b.id&&this.element.attr("aria-activedescendant",c)),delete f[b.id],b.id=c,b.li_attr.id=c,f[c]=b,this.trigger("set_id",{node:b,new:b.id,old:g}),!0},get_text:function(b){return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&b.text},set_text:function(b,c){var d,e;if(a.isArray(b)){for(d=0,e=(b=b.slice()).length;e>d;d++)this.set_text(b[d],c);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root||(b.text=c,this.get_node(b,!0).length&&this.redraw_node(b.id),this.trigger("set_text",{obj:b,text:c}),0))},get_json:function(b,c,d){if(!(b=this.get_node(b||a.jstree.root)))return!1;c&&c.flat&&!d&&(d=[]);var f,g,e={id:b.id,text:b.text,icon:this.get_icon(b),li_attr:a.extend(!0,{},b.li_attr),a_attr:a.extend(!0,{},b.a_attr),state:{},data:(!c||!c.no_data)&&a.extend(!0,a.isArray(b.data)?[]:{},b.data)};if(c&&c.flat?e.parent=b.parent:e.children=[],c&&c.no_state)delete e.state;else for(f in b.state)b.state.hasOwnProperty(f)&&(e.state[f]=b.state[f]);if(c&&c.no_li_attr&&delete e.li_attr,c&&c.no_a_attr&&delete e.a_attr,c&&c.no_id&&(delete e.id,e.li_attr&&e.li_attr.id&&delete e.li_attr.id,e.a_attr&&e.a_attr.id&&delete e.a_attr.id),c&&c.flat&&b.id!==a.jstree.root&&d.push(e),!c||!c.no_children)for(f=0,g=b.children.length;g>f;f++)c&&c.flat?this.get_json(b.children[f],c,d):e.children.push(this.get_json(b.children[f],c));return c&&c.flat?d:b.id===a.jstree.root?e.children:e},create_node:function(c,d,e,f,g){if(null===c&&(c=a.jstree.root),!(c=this.get_node(c)))return!1;if(!(e=e===b?"last":e).toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(c))return this.load_node(c,function(){this.create_node(c,d,e,f,!0)});d||(d={text:this.get_string("New node")}),(d="string"==typeof d?{text:d}:a.extend(!0,{},d)).text===b&&(d.text=this.get_string("New node"));var h,i,j,k;switch(c.id===a.jstree.root&&("before"===e&&(e="first"),"after"===e&&(e="last")),e){case"before":h=this.get_node(c.parent),e=a.inArray(c.id,h.children),c=h;break;case"after":h=this.get_node(c.parent),e=a.inArray(c.id,h.children)+1,c=h;break;case"inside":case"first":e=0;break;case"last":e=c.children.length;break;default:e||(e=0)}if(e>c.children.length&&(e=c.children.length),d.id||(d.id=!0),!this.check("create_node",d,c,e))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===d.id&&delete d.id,!(d=this._parse_model_from_json(d,c.id,c.parents.concat())))return!1;for(h=this.get_node(d),(i=[]).push(d),i=i.concat(h.children_d),this.trigger("model",{nodes:i,parent:c.id}),c.children_d=c.children_d.concat(i),j=0,k=c.parents.length;k>j;j++)this._model.data[c.parents[j]].children_d=this._model.data[c.parents[j]].children_d.concat(i);for(d=h,h=[],j=0,k=c.children.length;k>j;j++)h[j>=e?j+1:j]=c.children[j];return h[e]=d.id,c.children=h,this.redraw_node(c,!0),this.trigger("create_node",{node:this.get_node(d),parent:c.id,position:e}),f&&f.call(this,this.get_node(d)),d.id},rename_node:function(b,c){var d,e,f;if(a.isArray(b)){for(d=0,e=(b=b.slice()).length;e>d;d++)this.rename_node(b[d],c);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root||(f=b.text,this.check("rename_node",b,this.get_parent(b),c)?(this.set_text(b,c),this.trigger("rename_node",{node:b,text:c,old:f}),0):(this.settings.core.error.call(this,this._data.core.last_error),1)))},delete_node:function(b){var c,d,e,f,g,h,i,j,k,l,m,n;if(a.isArray(b)){for(c=0,d=(b=b.slice()).length;d>c;c++)this.delete_node(b[c]);return!0}if(!(b=this.get_node(b))||b.id===a.jstree.root)return!1;if(e=this.get_node(b.parent),f=a.inArray(b.id,e.children),l=!1,!this.check("delete_node",b,e,f))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==f&&(e.children=a.vakata.array_remove(e.children,f)),(g=b.children_d.concat([])).push(b.id),h=0,i=b.parents.length;i>h;h++)this._model.data[b.parents[h]].children_d=a.vakata.array_filter(this._model.data[b.parents[h]].children_d,function(b){return-1===a.inArray(b,g)});for(j=0,k=g.length;k>j;j++)if(this._model.data[g[j]].state.selected){l=!0;break}for(l&&(this._data.core.selected=a.vakata.array_filter(this._data.core.selected,function(b){return-1===a.inArray(b,g)})),this.trigger("delete_node",{node:b,parent:e.id}),l&&this.trigger("changed",{action:"delete_node",node:b,selected:this._data.core.selected,parent:e.id}),j=0,k=g.length;k>j;j++)delete this._model.data[g[j]];return-1!==a.inArray(this._data.core.focused,g)&&(this._data.core.focused=null,m=this.element[0].scrollTop,n=this.element[0].scrollLeft,e.id===a.jstree.root?this._model.data[a.jstree.root].children[0]&&this.get_node(this._model.data[a.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(e,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=m,this.element[0].scrollLeft=n),this.redraw_node(e,!0),!0},check:function(b,c,d,e,f){c=c&&c.id?c:this.get_node(c),d=d&&d.id?d:this.get_node(d);var g=b.match(/^move_node|copy_node|create_node$/i)?d:c,h=this.settings.core.check_callback;return"move_node"!==b&&"copy_node"!==b||f&&f.is_multi||c.id!==d.id&&("move_node"!==b||a.inArray(c.id,d.children)!==e)&&-1===a.inArray(d.id,c.children_d)?(g&&g.data&&(g=g.data),g&&g.functions&&(!1===g.functions[b]||!0===g.functions[b])?(!1===g.functions[b]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+b,data:JSON.stringify({chk:b,pos:e,obj:!(!c||!c.id)&&c.id,par:!(!d||!d.id)&&d.id})}),g.functions[b]):!(!1===h||a.isFunction(h)&&!1===h.call(this,b,c,d,e,f)||h&&!1===h[b])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+b,data:JSON.stringify({chk:b,pos:e,obj:!(!c||!c.id)&&c.id,par:!(!d||!d.id)&&d.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:b,pos:e,obj:!(!c||!c.id)&&c.id,par:!(!d||!d.id)&&d.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(d=this.get_node(d),e=e===b?0:e,!d)return!1;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(d))return this.load_node(d,function(){this.move_node(c,d,e,f,!0,!1,i)});if(a.isArray(c)){if(1!==c.length){for(j=0,k=c.length;k>j;j++)(r=this.move_node(c[j],d,e,f,g,!1,i))&&(d=r,e="after");return this.redraw(),!0}c=c[0]}if(!(c=c&&c.id?c:this.get_node(c))||c.id===a.jstree.root)return!1;if(l=(c.parent||a.jstree.root).toString(),n=e.toString().match(/^(before|after)$/)&&d.id!==a.jstree.root?this.get_node(d.parent):d,o=i||(this._model.data[c.id]?this:a.jstree.reference(c.id)),p=!o||!o._id||this._id!==o._id,m=o&&o._id&&l&&o._model.data[l]&&o._model.data[l].children?a.inArray(c.id,o._model.data[l].children):-1,o&&o._id&&(c=o._model.data[c.id]),p)return!!(r=this.copy_node(c,d,e,f,g,!1,i))&&(o&&o.delete_node(c),r);switch(d.id===a.jstree.root&&("before"===e&&(e="first"),"after"===e&&(e="last")),e){case"before":e=a.inArray(d.id,n.children);break;case"after":e=a.inArray(d.id,n.children)+1;break;case"inside":case"first":e=0;break;case"last":e=n.children.length;break;default:e||(e=0)}if(e>n.children.length&&(e=n.children.length),!this.check("move_node",c,n,e,{core:!0,origin:i,is_multi:o&&o._id&&o._id!==this._id,is_foreign:!o||!o._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(c.parent===n.id){for(q=n.children.concat(),-1!==(r=a.inArray(c.id,q))&&(q=a.vakata.array_remove(q,r),e>r&&e--),r=[],s=0,t=q.length;t>s;s++)r[s>=e?s+1:s]=q[s];r[e]=c.id,n.children=r,this._node_changed(n.id),this.redraw(n.id===a.jstree.root)}else{for((r=c.children_d.concat()).push(c.id),s=0,t=c.parents.length;t>s;s++){for(q=[],u=0,v=(w=o._model.data[c.parents[s]].children_d).length;v>u;u++)-1===a.inArray(w[u],r)&&q.push(w[u]);o._model.data[c.parents[s]].children_d=q}for(o._model.data[l].children=a.vakata.array_remove_item(o._model.data[l].children,c.id),s=0,t=n.parents.length;t>s;s++)this._model.data[n.parents[s]].children_d=this._model.data[n.parents[s]].children_d.concat(r);for(q=[],s=0,t=n.children.length;t>s;s++)q[s>=e?s+1:s]=n.children[s];for(q[e]=c.id,n.children=q,n.children_d.push(c.id),n.children_d=n.children_d.concat(c.children_d),c.parent=n.id,(r=n.parents.concat()).unshift(n.id),w=c.parents.length,c.parents=r,r=r.concat(),s=0,t=c.children_d.length;t>s;s++)this._model.data[c.children_d[s]].parents=this._model.data[c.children_d[s]].parents.slice(0,-1*w),Array.prototype.push.apply(this._model.data[c.children_d[s]].parents,r);(l===a.jstree.root||n.id===a.jstree.root)&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(l),this._node_changed(n.id)),h||this.redraw()}return f&&f.call(this,c,n,e),this.trigger("move_node",{node:c,parent:n.id,position:e,old_parent:l,old_position:m,is_multi:o&&o._id&&o._id!==this._id,is_foreign:!o||!o._id,old_instance:o,new_instance:this}),c.id},copy_node:function(c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s;if(d=this.get_node(d),e=e===b?0:e,!d)return!1;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(d))return this.load_node(d,function(){this.copy_node(c,d,e,f,!0,!1,i)});if(a.isArray(c)){if(1!==c.length){for(j=0,k=c.length;k>j;j++)(m=this.copy_node(c[j],d,e,f,g,!0,i))&&(d=m,e="after");return this.redraw(),!0}c=c[0]}if(!(c=c&&c.id?c:this.get_node(c))||c.id===a.jstree.root)return!1;switch(q=(c.parent||a.jstree.root).toString(),r=e.toString().match(/^(before|after)$/)&&d.id!==a.jstree.root?this.get_node(d.parent):d,s=i||(this._model.data[c.id]?this:a.jstree.reference(c.id)),!s||!s._id||this._id!==s._id,s&&s._id&&(c=s._model.data[c.id]),d.id===a.jstree.root&&("before"===e&&(e="first"),"after"===e&&(e="last")),e){case"before":e=a.inArray(d.id,r.children);break;case"after":e=a.inArray(d.id,r.children)+1;break;case"inside":case"first":e=0;break;case"last":e=r.children.length;break;default:e||(e=0)}if(e>r.children.length&&(e=r.children.length),!this.check("copy_node",c,r,e,{core:!0,origin:i,is_multi:s&&s._id&&s._id!==this._id,is_foreign:!s||!s._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(p=s?s.get_json(c,{no_id:!0,no_data:!0,no_state:!0}):c))return!1;if(!0===p.id&&delete p.id,!(p=this._parse_model_from_json(p,r.id,r.parents.concat())))return!1;for(m=this.get_node(p),c&&c.state&&!1===c.state.loaded&&(m.state.loaded=!1),(l=[]).push(p),l=l.concat(m.children_d),this.trigger("model",{nodes:l,parent:r.id}),n=0,o=r.parents.length;o>n;n++)this._model.data[r.parents[n]].children_d=this._model.data[r.parents[n]].children_d.concat(l);for(l=[],n=0,o=r.children.length;o>n;n++)l[n>=e?n+1:n]=r.children[n];return l[e]=m.id,r.children=l,r.children_d.push(m.id),r.children_d=r.children_d.concat(m.children_d),r.id===a.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(r.id),h||this.redraw(r.id===a.jstree.root),f&&f.call(this,m,r,e),this.trigger("copy_node",{node:m,original:c,parent:r.id,position:e,old_parent:q,old_position:s&&s._id&&q&&s._model.data[q]&&s._model.data[q].children?a.inArray(c.id,s._model.data[q].children):-1,is_multi:s&&s._id&&s._id!==this._id,is_foreign:!s||!s._id,old_instance:s,new_instance:this}),m.id},cut:function(b){if(b||(b=this._data.core.selected.concat()),a.isArray(b)||(b=[b]),!b.length)return!1;var g,h,i,c=[];for(h=0,i=b.length;i>h;h++)(g=this.get_node(b[h]))&&g.id&&g.id!==a.jstree.root&&c.push(g);return!!c.length&&(d=c,f=this,e="move_node",void this.trigger("cut",{node:b}))},copy:function(b){if(b||(b=this._data.core.selected.concat()),a.isArray(b)||(b=[b]),!b.length)return!1;var g,h,i,c=[];for(h=0,i=b.length;i>h;h++)(g=this.get_node(b[h]))&&g.id&&g.id!==a.jstree.root&&c.push(g);return!!c.length&&(d=c,f=this,e="copy_node",void this.trigger("copy",{node:b}))},get_buffer:function(){return{mode:e,node:d,inst:f}},can_paste:function(){return!1!==e&&!1!==d},paste:function(a,b){return!!((a=this.get_node(a))&&e&&e.match(/^(copy_node|move_node)$/)&&d)&&(this[e](d,a,b,!1,!1,!1,f)&&this.trigger("paste",{parent:a.id,node:d,mode:e}),d=!1,e=!1,void(f=!1))},clear_buffer:function(){d=!1,e=!1,f=!1,this.trigger("clear_buffer")},edit:function(b,c,d){var e,f,g,h,j,k,l,m,n,o=!1;return!!(b=this.get_node(b))&&(this.check("edit",b,this.get_parent(b))?(n=b,c="string"==typeof c?c:b.text,this.set_text(b,""),b=this._open_to(b),n.text=c,e=this._data.core.rtl,f=this.element.width(),this._data.core.focused=n.id,g=b.children(".jstree-anchor").focus(),h=a("<span>"),j=c,k=a("<div />",{css:{position:"absolute",top:"-200px",left:e?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),l=a("<input />",{value:j,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:a.proxy(function(c){c.stopImmediatePropagation(),c.preventDefault();var m,f=h.children(".jstree-rename-input").val(),i=this.settings.core.force_text;""===f&&(f=j),k.remove(),h.replaceWith(g),h.remove(),j=i?j:a("<div></div>").append(a.parseHTML(j)).html(),this.set_text(b,j),(m=!!this.rename_node(b,i?a("<div></div>").text(f).text():a("<div></div>").append(a.parseHTML(f)).html()))||this.set_text(b,j),this._data.core.focused=n.id,setTimeout(a.proxy(function(){var a=this.get_node(n.id,!0);a.length&&(this._data.core.focused=n.id,a.children(".jstree-anchor").focus())},this),0),d&&d.call(this,n,m,o),l=null},this),keydown:function(a){var b=a.which;27===b&&(o=!0,this.value=j),(27===b||13===b||37===b||38===b||39===b||40===b||32===b)&&a.stopImmediatePropagation(),(27===b||13===b)&&(a.preventDefault(),this.blur())},click:function(a){a.stopImmediatePropagation()},mousedown:function(a){a.stopImmediatePropagation()},keyup:function(a){l.width(Math.min(k.text("pW"+this.value).width(),f))},keypress:function(a){return 13!==a.which&&void 0}}),m={fontFamily:g.css("fontFamily")||"",fontSize:g.css("fontSize")||"",fontWeight:g.css("fontWeight")||"",fontStyle:g.css("fontStyle")||"",fontStretch:g.css("fontStretch")||"",fontVariant:g.css("fontVariant")||"",letterSpacing:g.css("letterSpacing")||"",wordSpacing:g.css("wordSpacing")||""},h.attr("class",g.attr("class")).append(g.contents().clone()).append(l),g.replaceWith(h),k.css(m),l.css(m).width(Math.min(k.text("pW"+l[0].value).width(),f))[0].select(),void a(i).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(b){l&&b.target!==l&&a(l).blur()})):(this.settings.core.error.call(this,this._data.core.last_error),!1))},set_theme:function(b,c){if(!b)return!1;if(!0===c){var d=this.settings.core.themes.dir;d||(d=a.jstree.path+"/themes"),c=d+"/"+b+"/style.css"}c&&-1===a.inArray(c,g)&&(a("head").append('<link rel="stylesheet" href="'+c+'" type="text/css" />'),g.push(c)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=b,this.element.addClass("jstree-"+b),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+b+"-responsive"),this.trigger("set_theme",{theme:b})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=a,a&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped"),this.trigger("show_stripes")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped"),this.trigger("hide_stripes")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots"),this.trigger("show_dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots"),this.trigger("hide_dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons"),this.trigger("show_icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons"),this.trigger("hide_icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},show_ellipsis:function(){this._data.core.themes.ellipsis=!0,this.get_container_ul().addClass("jstree-ellipsis"),this.trigger("show_ellipsis")},hide_ellipsis:function(){this._data.core.themes.ellipsis=!1,this.get_container_ul().removeClass("jstree-ellipsis"),this.trigger("hide_ellipsis")},toggle_ellipsis:function(){this._data.core.themes.ellipsis?this.hide_ellipsis():this.show_ellipsis()},set_icon:function(c,d){var e,f,g,h;if(a.isArray(c)){for(e=0,f=(c=c.slice()).length;f>e;e++)this.set_icon(c[e],d);return!0}return!(!(c=this.get_node(c))||c.id===a.jstree.root||(h=c.icon,c.icon=!0===d||null===d||d===b||""===d||d,g=this.get_node(c,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===d?this.hide_icon(c):!0===d||null===d||d===b||""===d?(g.removeClass("jstree-themeicon-custom "+h).css("background","").removeAttr("rel"),!1===h&&this.show_icon(c)):-1===d.indexOf("/")&&-1===d.indexOf(".")?(g.removeClass(h).css("background",""),g.addClass(d+" jstree-themeicon-custom").attr("rel",d),!1===h&&this.show_icon(c)):(g.removeClass(h).css("background",""),g.addClass("jstree-themeicon-custom").css("background","url('"+d+"') center center no-repeat").attr("rel",d),!1===h&&this.show_icon(c)),0))},get_icon:function(b){return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&b.icon},hide_icon:function(b){var c,d;if(a.isArray(b)){for(c=0,d=(b=b.slice()).length;d>c;c++)this.hide_icon(b[c]);return!0}return!(!(b=this.get_node(b))||b===a.jstree.root||(b.icon=!1,this.get_node(b,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),0))},show_icon:function(b){var c,d,e;if(a.isArray(b)){for(c=0,d=(b=b.slice()).length;d>c;c++)this.show_icon(b[c]);return!0}return!(!(b=this.get_node(b))||b===a.jstree.root||(e=this.get_node(b,!0),b.icon=!e.length||e.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),b.icon||(b.icon=!0),e.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),0))}},a.vakata={},a.vakata.attributes=function(b,c){b=a(b)[0];var d=c?{}:[];return b&&b.attributes&&a.each(b.attributes,function(b,e){-1===a.inArray(e.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==e.value&&""!==a.trim(e.value)&&(c?d[e.name]=e.value:d.push(e.name))}),d},a.vakata.array_unique=function(a){var d,f,c=[],g={};for(d=0,f=a.length;f>d;d++)g[a[d]]===b&&(c.push(a[d]),g[a[d]]=!0);return c},a.vakata.array_remove=function(a,b){return a.splice(b,1),a},a.vakata.array_remove_item=function(b,c){var d=a.inArray(c,b);return-1!==d?a.vakata.array_remove(b,d):b},a.vakata.array_filter=function(a,b,c,d,e){if(a.filter)return a.filter(b,c);d=[];for(e in a)~~e+""==e+""&&e>=0&&b.call(c,a[e],+e,a)&&d.push(a[e]);return d},a.jstree.plugins.changed=function(a,b){var c=[];this.trigger=function(a,d){var e,f;if(d||(d={}),"changed"===a.replace(".jstree","")){d.changed={selected:[],deselected:[]};var g={};for(e=0,f=c.length;f>e;e++)g[c[e]]=1;for(e=0,f=d.selected.length;f>e;e++)g[d.selected[e]]?g[d.selected[e]]=2:d.changed.selected.push(d.selected[e]);for(e=0,f=c.length;f>e;e++)1===g[c[e]]&&d.changed.deselected.push(c[e]);c=d.selected.slice()}b.trigger.call(this,a,d)},this.refresh=function(a,d){return c=[],b.refresh.apply(this,arguments)}};var j=i.createElement("I");j.className="jstree-icon jstree-checkbox",j.setAttribute("role","presentation"),a.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0,cascade_to_disabled:!0,cascade_to_hidden:!0},a.jstree.plugins.checkbox=function(c,d){this.bind=function(){d.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",a.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",a.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",a.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(a.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",a.proxy(function(a,b){var f,g,c=this._model.data,e=(c[b.parent],b.nodes);for(f=0,g=e.length;g>f;f++)c[e[f]].state.checked=c[e[f]].state.checked||c[e[f]].original&&c[e[f]].original.state&&c[e[f]].original.state.checked,c[e[f]].state.checked&&this._data.checkbox.selected.push(e[f])},this)),(-1!==this.settings.checkbox.cascade.indexOf("up")||-1!==this.settings.checkbox.cascade.indexOf("down"))&&this.element.on("model.jstree",a.proxy(function(b,c){var h,i,j,k,l,m,d=this._model.data,e=d[c.parent],f=c.nodes,g=[],n=this.settings.checkbox.cascade,o=this.settings.checkbox.tie_selection;if(-1!==n.indexOf("down"))if(e.state[o?"selected":"checked"]){for(i=0,j=f.length;j>i;i++)d[f[i]].state[o?"selected":"checked"]=!0;this._data[o?"core":"checkbox"].selected=this._data[o?"core":"checkbox"].selected.concat(f)}else for(i=0,j=f.length;j>i;i++)if(d[f[i]].state[o?"selected":"checked"]){for(k=0,l=d[f[i]].children_d.length;l>k;k++)d[d[f[i]].children_d[k]].state[o?"selected":"checked"]=!0;this._data[o?"core":"checkbox"].selected=this._data[o?"core":"checkbox"].selected.concat(d[f[i]].children_d)}if(-1!==n.indexOf("up")){for(i=0,j=e.children_d.length;j>i;i++)d[e.children_d[i]].children.length||g.push(d[e.children_d[i]].parent);for(k=0,l=(g=a.vakata.array_unique(g)).length;l>k;k++)for(e=d[g[k]];e&&e.id!==a.jstree.root;){for(h=0,i=0,j=e.children.length;j>i;i++)h+=d[e.children[i]].state[o?"selected":"checked"];if(h!==j)break;e.state[o?"selected":"checked"]=!0,this._data[o?"core":"checkbox"].selected.push(e.id),(m=this.get_node(e,!0))&&m.length&&m.attr("aria-selected",!0).children(".jstree-anchor").addClass(o?"jstree-clicked":"jstree-checked"),e=this.get_node(e.parent)}}this._data[o?"core":"checkbox"].selected=a.vakata.array_unique(this._data[o?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",a.proxy(function(b,c){var h,i,j,k,e=c.node,f=this._model.data,g=this.get_node(e.parent),l=this.settings.checkbox.cascade,m=this.settings.checkbox.tie_selection,n={},o=this._data[m?"core":"checkbox"].selected;for(h=0,i=o.length;i>h;h++)n[o[h]]=!0;if(-1!==l.indexOf("down")){var p=this._cascade_new_checked_state(e.id,!0);e.children_d.concat(e.id).forEach(function(a){p.indexOf(a)>-1?n[a]=!0:delete n[a]})}if(-1!==l.indexOf("up"))for(;g&&g.id!==a.jstree.root;){for(j=0,h=0,i=g.children.length;i>h;h++)j+=f[g.children[h]].state[m?"selected":"checked"];if(j!==i)break;g.state[m?"selected":"checked"]=!0,n[g.id]=!0,(k=this.get_node(g,!0))&&k.length&&k.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked"),g=this.get_node(g.parent)}o=[];for(h in n)n.hasOwnProperty(h)&&o.push(h);this._data[m?"core":"checkbox"].selected=o},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",a.proxy(function(b,c){var f,g,h,d=this.get_node(a.jstree.root),e=this._model.data;for(f=0,g=d.children_d.length;g>f;f++)(h=e[d.children_d[f]])&&h.original&&h.original.state&&h.original.state.undetermined&&(h.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",a.proxy(function(a,b){var f,g,h,d=b.node,i=(this.get_node(d,!0),this.settings.checkbox.cascade),j=this.settings.checkbox.tie_selection,k=this._data[j?"core":"checkbox"].selected,n=d.children_d.concat(d.id);if(-1!==i.indexOf("down")){var o=this._cascade_new_checked_state(d.id,!1);k=k.filter(function(a){return-1===n.indexOf(a)||o.indexOf(a)>-1})}if(-1!==i.indexOf("up")&&-1===k.indexOf(d.id)){for(f=0,g=d.parents.length;g>f;f++)h=this._model.data[d.parents[f]],h.state[j?"selected":"checked"]=!1,h&&h.original&&h.original.state&&h.original.state.undetermined&&(h.original.state.undetermined=!1),(h=this.get_node(d.parents[f],!0))&&h.length&&h.attr("aria-selected",!1).children(".jstree-anchor").removeClass(j?"jstree-clicked":"jstree-checked");k=k.filter(function(a){return-1===d.parents.indexOf(a)})}this._data[j?"core":"checkbox"].selected=k},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",a.proxy(function(b,c){for(var f,g,h,i,d=this.get_node(c.parent),e=this._model.data,j=this.settings.checkbox.tie_selection;d&&d.id!==a.jstree.root&&!d.state[j?"selected":"checked"];){for(h=0,f=0,g=d.children.length;g>f;f++)h+=e[d.children[f]].state[j?"selected":"checked"];if(!(g>0&&h===g))break;d.state[j?"selected":"checked"]=!0,this._data[j?"core":"checkbox"].selected.push(d.id),(i=this.get_node(d,!0))&&i.length&&i.attr("aria-selected",!0).children(".jstree-anchor").addClass(j?"jstree-clicked":"jstree-checked"),d=this.get_node(d.parent)}},this)).on("move_node.jstree",a.proxy(function(b,c){var h,i,j,k,l,d=c.is_multi,e=c.old_parent,f=this.get_node(c.parent),g=this._model.data,m=this.settings.checkbox.tie_selection;if(!d)for(h=this.get_node(e);h&&h.id!==a.jstree.root&&!h.state[m?"selected":"checked"];){for(i=0,j=0,k=h.children.length;k>j;j++)i+=g[h.children[j]].state[m?"selected":"checked"];if(!(k>0&&i===k))break;h.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(h.id),(l=this.get_node(h,!0))&&l.length&&l.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked"),h=this.get_node(h.parent)}for(h=f;h&&h.id!==a.jstree.root;){for(i=0,j=0,k=h.children.length;k>j;j++)i+=g[h.children[j]].state[m?"selected":"checked"];if(i===k)h.state[m?"selected":"checked"]||(h.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(h.id),(l=this.get_node(h,!0))&&l.length&&l.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked"));else{if(!h.state[m?"selected":"checked"])break;h.state[m?"selected":"checked"]=!1,this._data[m?"core":"checkbox"].selected=a.vakata.array_remove_item(this._data[m?"core":"checkbox"].selected,h.id),(l=this.get_node(h,!0))&&l.length&&l.attr("aria-selected",!1).children(".jstree-anchor").removeClass(m?"jstree-clicked":"jstree-checked")}h=this.get_node(h.parent)}},this))},this._undetermined=function(){if(null!==this.element){var c,d,e,f,g={},h=this._model.data,i=this.settings.checkbox.tie_selection,j=this._data[i?"core":"checkbox"].selected,k=[],l=this;for(c=0,d=j.length;d>c;c++)if(h[j[c]]&&h[j[c]].parents)for(e=0,f=h[j[c]].parents.length;f>e&&g[h[j[c]].parents[e]]===b;e++)h[j[c]].parents[e]!==a.jstree.root&&(g[h[j[c]].parents[e]]=!0,k.push(h[j[c]].parents[e]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var j,i=l.get_node(this);if(i)if(i.state.loaded){for(c=0,d=i.children_d.length;d>c;c++)if(!(j=h[i.children_d[c]]).state.loaded&&j.original&&j.original.state&&j.original.state.undetermined&&!0===j.original.state.undetermined)for(g[j.id]===b&&j.id!==a.jstree.root&&(g[j.id]=!0,k.push(j.id)),e=0,f=j.parents.length;f>e;e++)g[j.parents[e]]===b&&j.parents[e]!==a.jstree.root&&(g[j.parents[e]]=!0,k.push(j.parents[e]))}else if(i.original&&i.original.state&&i.original.state.undetermined&&!0===i.original.state.undetermined)for(g[i.id]===b&&i.id!==a.jstree.root&&(g[i.id]=!0,k.push(i.id)),e=0,f=i.parents.length;f>e;e++)g[i.parents[e]]===b&&i.parents[e]!==a.jstree.root&&(g[i.parents[e]]=!0,k.push(i.parents[e]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),c=0,d=k.length;d>c;c++)h[k[c]].state[i?"selected":"checked"]||(j=this.get_node(k[c],!0))&&j.length&&j.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(b,c,e,f){if(b=d.redraw_node.apply(this,arguments)){var g,h,i=null,k=null;for(g=0,h=b.childNodes.length;h>g;g++)if(b.childNodes[g]&&b.childNodes[g].className&&-1!==b.childNodes[g].className.indexOf("jstree-anchor")){i=b.childNodes[g];break}i&&(!this.settings.checkbox.tie_selection&&this._model.data[b.id].state.checked&&(i.className+=" jstree-checked"),k=j.cloneNode(!1),this._model.data[b.id].state.checkbox_disabled&&(k.className+=" jstree-checkbox-disabled"),i.insertBefore(k,i.childNodes[0]))}return e||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(a.proxy(this._undetermined,this),50)),b},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(b){b=this.get_node(b);var d,e,c=this.settings.checkbox.cascade,f=this.settings.checkbox.tie_selection,g=this._data[f?"core":"checkbox"].selected,h=this._model.data;if(!b||!0===b.state[f?"selected":"checked"]||-1===c.indexOf("undetermined")||-1===c.indexOf("down")&&-1===c.indexOf("up"))return!1;if(!b.state.loaded&&!0===b.original.state.undetermined)return!0;for(d=0,e=b.children_d.length;e>d;d++)if(-1!==a.inArray(b.children_d[d],g)||!h[b.children_d[d]].state.loaded&&h[b.children_d[d]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(b){var c,d,e;if(a.isArray(b)){for(c=0,d=(b=b.slice()).length;d>c;c++)this.disable_checkbox(b[c]);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(e=this.get_node(b,!0),void(b.state.checkbox_disabled||(b.state.checkbox_disabled=!0,e&&e.length&&e.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:b}))))},this.enable_checkbox=function(b){var c,d,e;if(a.isArray(b)){for(c=0,d=(b=b.slice()).length;d>c;c++)this.enable_checkbox(b[c]);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(e=this.get_node(b,!0),void(b.state.checkbox_disabled&&(b.state.checkbox_disabled=!1,e&&e.length&&e.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:b}))))},this.activate_node=function(b,c){return!a(c.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||a(c.target).hasClass("jstree-checkbox"))&&(c.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!a(c.target).hasClass("jstree-checkbox")?d.activate_node.call(this,b,c):!this.is_disabled(b)&&(this.is_checked(b)?this.uncheck_node(b,c):this.check_node(b,c),void this.trigger("activate_node",{node:this.get_node(b)})))},this._cascade_new_checked_state=function(a,b){var c=this,d=this.settings.checkbox.tie_selection,e=this._model.data[a],f=[],g=[];if(!this.settings.checkbox.cascade_to_disabled&&e.state.disabled||!this.settings.checkbox.cascade_to_hidden&&e.state.hidden){var h=this.get_checked_descendants(a);e.state[d?"selected":"checked"]&&h.push(e.id),f=f.concat(h)}else{e.children&&e.children.forEach(function(a){var d=c._cascade_new_checked_state(a,b);f=f.concat(d),d.indexOf(a)>-1&&g.push(a)});var i=c.get_node(e,!0),j=g.length>0&&g.length<e.children.length;e.original&&e.original.state&&e.original.state.undetermined&&(e.original.state.undetermined=j),j?(e.state[d?"selected":"checked"]=!1,i.attr("aria-selected",!1).children(".jstree-anchor").removeClass(d?"jstree-clicked":"jstree-checked")):b&&g.length===e.children.length?(e.state[d?"selected":"checked"]=b,f.push(e.id),i.attr("aria-selected",!0).children(".jstree-anchor").addClass(d?"jstree-clicked":"jstree-checked")):(e.state[d?"selected":"checked"]=!1,i.attr("aria-selected",!1).children(".jstree-anchor").removeClass(d?"jstree-clicked":"jstree-checked"))}return f},this.get_checked_descendants=function(a){var b=this,c=b.settings.checkbox.tie_selection;return b._model.data[a].children_d.filter(function(a){return b._model.data[a].state[c?"selected":"checked"]})},this.check_node=function(b,c){if(this.settings.checkbox.tie_selection)return this.select_node(b,!1,!0,c);var d,e,f;if(a.isArray(b)){for(e=0,f=(b=b.slice()).length;f>e;e++)this.check_node(b[e],c);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(d=this.get_node(b,!0),void(b.state.checked||(b.state.checked=!0,this._data.checkbox.selected.push(b.id),d&&d.length&&d.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:b,selected:this._data.checkbox.selected,event:c}))))},this.uncheck_node=function(b,c){if(this.settings.checkbox.tie_selection)return this.deselect_node(b,!1,c);var d,e,f;if(a.isArray(b)){for(d=0,e=(b=b.slice()).length;e>d;d++)this.uncheck_node(b[d],c);return!0}return!(!(b=this.get_node(b))||b.id===a.jstree.root)&&(f=this.get_node(b,!0),void(b.state.checked&&(b.state.checked=!1,this._data.checkbox.selected=a.vakata.array_remove_item(this._data.checkbox.selected,b.id),f.length&&f.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:b,selected:this._data.checkbox.selected,event:c}))))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var c,d;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[a.jstree.root].children_d.concat(),c=0,d=this._data.checkbox.selected.length;d>c;c++)this._model.data[this._data.checkbox.selected[c]]&&(this._model.data[this._data.checkbox.selected[c]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var b,c,a=this._data.checkbox.selected.concat([]);for(b=0,c=this._data.checkbox.selected.length;c>b;b++)this._model.data[this._data.checkbox.selected[b]]&&(this._model.data[this._data.checkbox.selected[b]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:a})},this.is_checked=function(b){return this.settings.checkbox.tie_selection?this.is_selected(b):!(!(b=this.get_node(b))||b.id===a.jstree.root)&&b.state.checked},this.get_checked=function(b){return this.settings.checkbox.tie_selection?this.get_selected(b):b?a.map(this._data.checkbox.selected,a.proxy(function(a){return this.get_node(a)},this)):this._data.checkbox.selected},this.get_top_checked=function(b){if(this.settings.checkbox.tie_selection)return this.get_top_selected(b);var e,f,g,h,c=this.get_checked(!0),d={};for(e=0,f=c.length;f>e;e++)d[c[e].id]=c[e];for(e=0,f=c.length;f>e;e++)for(g=0,h=c[e].children_d.length;h>g;g++)d[c[e].children_d[g]]&&delete d[c[e].children_d[g]];c=[];for(e in d)d.hasOwnProperty(e)&&c.push(e);return b?a.map(c,a.proxy(function(a){return this.get_node(a)},this)):c},this.get_bottom_checked=function(b){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(b);var e,f,c=this.get_checked(!0),d=[];for(e=0,f=c.length;f>e;e++)c[e].children.length||d.push(c[e].id);return b?a.map(d,a.proxy(function(a){return this.get_node(a)},this)):d},this.load_node=function(b,c){var e,f,j;if(!a.isArray(b)&&!this.settings.checkbox.tie_selection&&(j=this.get_node(b))&&j.state.loaded)for(e=0,f=j.children_d.length;f>e;e++)this._model.data[j.children_d[e]].state.checked&&(!0,this._data.checkbox.selected=a.vakata.array_remove_item(this._data.checkbox.selected,j.children_d[e]));return d.load_node.apply(this,arguments)},this.get_state=function(){var a=d.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?a:(a.checkbox=this._data.checkbox.selected.slice(),a)},this.set_state=function(b,c){var e=d.set_state.apply(this,arguments);if(e&&b.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var f=this;a.each(b.checkbox,function(a,b){f.check_node(b)})}return delete b.checkbox,this.set_state(b,c),!1}return e},this.refresh=function(a,b){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),d.refresh.apply(this,arguments)}},a.jstree.defaults.conditionalselect=function(){return!0},a.jstree.plugins.conditionalselect=function(a,b){this.activate_node=function(a,c){this.settings.conditionalselect.call(this,this.get_node(a),c)&&b.activate_node.call(this,a,c)}},a.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(b,c){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.create_node(d,{},"last",function(a){try{c.edit(a)}catch(b){setTimeout(function(){c.edit(a)},0)}})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.edit(d)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.is_selected(d)?c.delete_node(c.get_selected()):c.delete_node(d)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.is_selected(d)?c.cut(c.get_top_selected()):c.cut(d)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.is_selected(d)?c.copy(c.get_top_selected()):c.copy(d)}},paste:{separator_before:!1,icon:!1,_disabled:function(b){return!a.jstree.reference(b.reference).can_paste()},separator_after:!1,label:"Paste",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.paste(d)}}}}}}},a.jstree.plugins.contextmenu=function(c,d){this.bind=function(){d.bind.call(this);var e,f,b=0,c=null;this.element.on("init.jstree loading.jstree ready.jstree",a.proxy(function(){this.get_container_ul().addClass("jstree-contextmenu")},this)).on("contextmenu.jstree",".jstree-anchor",a.proxy(function(a,d){"input"!==a.target.tagName.toLowerCase()&&(a.preventDefault(),b=a.ctrlKey?+new Date:0,(d||c)&&(b=+new Date+1e4),c&&clearTimeout(c),this.is_loading(a.currentTarget)||this.show_contextmenu(a.currentTarget,a.pageX,a.pageY,a))},this)).on("click.jstree",".jstree-anchor",a.proxy(function(c){this._data.contextmenu.visible&&(!b||+new Date-b>250)&&a.vakata.context.hide(),b=0},this)).on("touchstart.jstree",".jstree-anchor",function(b){b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(e=b.originalEvent.changedTouches[0].clientX,f=b.originalEvent.changedTouches[0].clientY,c=setTimeout(function(){a(b.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(a){c&&a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]&&(Math.abs(e-a.originalEvent.changedTouches[0].clientX)>50||Math.abs(f-a.originalEvent.changedTouches[0].clientY)>50)&&clearTimeout(c)}).on("touchend.vakata.jstree",function(a){c&&clearTimeout(c)}),a(i).on("context_hide.vakata.jstree",a.proxy(function(b,c){this._data.contextmenu.visible=!1,a(c.reference).removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&a.vakata.context.hide(),d.teardown.call(this)},this.show_contextmenu=function(c,d,e,f){if(!(c=this.get_node(c))||c.id===a.jstree.root)return!1;var g=this.settings.contextmenu,i=this.get_node(c,!0).children(".jstree-anchor"),j=!1,k=!1;(g.show_at_node||d===b||e===b)&&(j=i.offset(),d=j.left,e=j.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(c)&&this.activate_node(c,f),k=g.items,a.isFunction(k)&&(k=k.call(this,c,a.proxy(function(a){this._show_contextmenu(c,d,e,a)},this))),a.isPlainObject(k)&&this._show_contextmenu(c,d,e,k)},this._show_contextmenu=function(b,c,d,e){var g=this.get_node(b,!0).children(".jstree-anchor");a(i).one("context_show.vakata.jstree",a.proxy(function(b,c){var d="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";a(c.element).addClass(d),g.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,a.vakata.context.show(g,{x:c,y:d},e),this.trigger("show_contextmenu",{node:b,x:c,y:d})}},function(a){var b=!1,c={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};a.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(b){a(i).triggerHandler("context_"+b+".vakata",{reference:c.reference,element:c.element,position:{x:c.position_x,y:c.position_y}})},_execute:function(b){return!(!(b=c.items[b])||b._disabled&&(!a.isFunction(b._disabled)||b._disabled({item:b,reference:c.reference,element:c.element}))||!b.action)&&b.action.call(null,{item:b,reference:c.reference,element:c.element,position:{x:c.position_x,y:c.position_y}})},_parse:function(b,d){if(!b)return!1;d||(c.html="",c.items=[]);var g,e="",f=!1;return d&&(e+="<ul>"),a.each(b,function(b,d){return!d||(c.items.push(d),!f&&d.separator_before&&(e+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),f=!1,e+="<li class='"+(d._class||"")+(!0===d._disabled||a.isFunction(d._disabled)&&d._disabled({item:d,reference:c.reference,element:c.element})?" vakata-contextmenu-disabled ":"")+"' "+(d.shortcut?" data-shortcut='"+d.shortcut+"' ":"")+">",e+="<a href='#' rel='"+(c.items.length-1)+"' "+(d.title?"title='"+d.title+"'":"")+">",a.vakata.context.settings.icons&&(e+="<i ",d.icon&&(e+=-1!==d.icon.indexOf("/")||-1!==d.icon.indexOf(".")?" style='background:url(\""+d.icon+"\") center center no-repeat' ":" class='"+d.icon+"' "),e+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),e+=(a.isFunction(d.label)?d.label({item:b,reference:c.reference,element:c.element}):d.label)+(d.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+d.shortcut+'">'+(d.shortcut_label||"")+"</span>":"")+"</a>",d.submenu&&(g=a.vakata.context._parse(d.submenu,!0))&&(e+=g),e+="</li>",void(d.separator_after&&(e+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",f=!0)))}),e=e.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),d&&(e+="</ul>"),d||(c.html=e,a.vakata.context._trigger("parse")),e.length>10&&e},_show_submenu:function(c){if((c=a(c)).length&&c.children("ul").length){var d=c.children("ul"),e=c.offset().left,f=e+c.outerWidth(),g=c.offset().top,h=d.width(),i=d.height(),j=a(window).width()+a(window).scrollLeft(),k=a(window).height()+a(window).scrollTop();b?c[f-(h+10+c.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):c[f+h>j&&e>j-f?"addClass":"removeClass"]("vakata-context-right"),g+i+10>k&&d.css("bottom","-1px"),c.hasClass("vakata-context-right")?h>e&&d.css("margin-right",e-h):h>j-f&&d.css("margin-left",j-f-h),d.show()}},show:function(d,e,f){var g,h,i,j,k,l,m,n;switch(c.element&&c.element.length&&c.element.width(""),!0){case!e&&!d:return!1;case!!e&&!!d:c.reference=d,c.position_x=e.x,c.position_y=e.y;break;case!e&&!!d:c.reference=d,g=d.offset(),c.position_x=g.left+d.outerHeight(),c.position_y=g.top;break;case!!e&&!d:c.position_x=e.x,c.position_y=e.y}d&&!f&&a(d).data("vakata_contextmenu")&&(f=a(d).data("vakata_contextmenu")),a.vakata.context._parse(f)&&c.element.html(c.html),c.items.length&&(c.element.appendTo("body"),h=c.element,i=c.position_x,j=c.position_y,k=h.width(),l=h.height(),m=a(window).width()+a(window).scrollLeft(),n=a(window).height()+a(window).scrollTop(),b&&(i-=h.outerWidth()-a(d).outerWidth())<a(window).scrollLeft()+20&&(i=a(window).scrollLeft()+20),i+k+20>m&&(i=m-(k+20)),j+l+20>n&&(j=n-(l+20)),c.element.css({left:i,top:j}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),c.is_visible=!0,a.vakata.context._trigger("show"))},hide:function(){c.is_visible&&(c.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),c.is_visible=!1,a.vakata.context._trigger("hide"))}},a(function(){b="rtl"===a("body").css("direction");var d=!1;c.element=a("<ul class='vakata-context'></ul>"),c.element.on("mouseenter","li",function(b){b.stopImmediatePropagation(),a.contains(this,b.relatedTarget)||(d&&clearTimeout(d),c.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),a(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),a.vakata.context._show_submenu(this))}).on("mouseleave","li",function(b){a.contains(this,b.relatedTarget)||a(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(b){a(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),a.vakata.context.settings.hide_onmouseleave&&(d=setTimeout(function(){a.vakata.context.hide()},a.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(b){b.preventDefault(),a(this).blur().parent().hasClass("vakata-context-disabled")||!1===a.vakata.context._execute(a(this).attr("rel"))||a.vakata.context.hide()}).on("keydown","a",function(b){var d=null;switch(b.which){case 13:case 32:b.type="click",b.preventDefault(),a(b.currentTarget).trigger(b);break;case 37:c.is_visible&&(c.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 38:c.is_visible&&((d=c.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first()).length||(d=c.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),d.addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 39:c.is_visible&&(c.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 40:c.is_visible&&((d=c.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first()).length||(d=c.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),d.addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 27:a.vakata.context.hide(),b.preventDefault()}}).on("keydown",function(a){a.preventDefault();var b=c.element.find(".vakata-contextmenu-shortcut-"+a.which).parent();b.parent().not(".vakata-context-disabled")&&b.click()}),a(i).on("mousedown.vakata.jstree",function(b){c.is_visible&&c.element[0]!==b.target&&!a.contains(c.element[0],b.target)&&a.vakata.context.hide()}).on("context_show.vakata.jstree",function(a,d){c.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),b&&c.element.addClass("vakata-context-rtl").css("direction","rtl"),c.element.find("ul").hide().end()})})}(a),a.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var k,l;a.jstree.plugins.dnd=function(b,c){this.init=function(a,b){c.init.call(this,a,b),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in i.createElement("span")},this.bind=function(){c.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",a.proxy(function(b){if(this.settings.dnd.large_drag_target&&a(b.target).closest(".jstree-node")[0]!==b.currentTarget)return!0;if("touchstart"===b.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!a(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var c=this.get_node(b.target),d=this.is_selected(c)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,e=d>1?d+" "+this.get_string("nodes"):this.get_text(b.currentTarget);if(this.settings.core.force_text&&(e=a.vakata.html.escape(e)),c&&c.id&&c.id!==a.jstree.root&&(1===b.which||"touchstart"===b.type||"dragstart"===b.type)&&(!0===this.settings.dnd.is_draggable||a.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,d>1?this.get_top_selected(!0):[c],b))){if(k={jstree:!0,origin:this,obj:this.get_node(c,!0),nodes:d>1?this.get_top_selected():[c.id]},l=b.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),a.vakata.dnd.start(b,k,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+e+'<ins class="jstree-copy" style="display:none;">+</ins></div>');a.vakata.dnd._trigger("start",b,{helper:a(),element:l,data:k})}},this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(b){return b.preventDefault(),a.vakata.dnd._trigger("move",b,{helper:a(),element:l,data:k}),!1}).on("drop.jstree",a.proxy(function(b){return b.preventDefault(),a.vakata.dnd._trigger("stop",b,{helper:a(),element:l,data:k}),!1},this))},this.redraw_node=function(a,b,d,e){if((a=c.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)a.setAttribute("draggable",!0);else{var f,g,h=null;for(f=0,g=a.childNodes.length;g>f;f++)if(a.childNodes[f]&&a.childNodes[f].className&&-1!==a.childNodes[f].className.indexOf("jstree-anchor")){h=a.childNodes[f];break}h&&h.setAttribute("draggable",!0)}return a}},a(function(){var c=!1,d=!1,e=!1,f=!1,g=a('<div id="jstree-marker">&#160;</div>').hide();a(i).on("dnd_start.vakata.jstree",function(a,b){c=!1,e=!1,b&&b.data&&b.data.jstree&&g.appendTo("body")}).on("dnd_move.vakata.jstree",function(h,i){var j=i.event.target!==e.target;if(f&&(!i.event||"dragover"!==i.event.type||j)&&clearTimeout(f),i&&i.data&&i.data.jstree&&(!i.event.target.id||"jstree-marker"!==i.event.target.id)){e=i.event;var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,k=a.jstree.reference(i.event.target),l=!1,m=!1,n=!1;if(k&&k._data&&k._data.dnd)if(g.attr("class","jstree-"+k.get_theme()+(k.settings.core.themes.responsive?" jstree-dnd-responsive":"")),D=i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey)),i.helper.children().attr("class","jstree-"+k.get_theme()+" jstree-"+k.get_theme()+"-"+k.get_theme_variant()+" "+(k.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[D?"show":"hide"](),i.event.target!==k.element[0]&&i.event.target!==k.get_container_ul()[0]||0!==k.get_container_ul().children().length){if((l=k.settings.dnd.large_drop_target?a(i.event.target).closest(".jstree-node").children(".jstree-anchor"):a(i.event.target).closest(".jstree-anchor"))&&l.length&&l.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(m=l.offset(),n=(i.event.pageY!==b?i.event.pageY:i.event.originalEvent.pageY)-m.top,r=l.outerHeight(),u=r/3>n?["b","i","a"]:n>r-r/3?["a","i","b"]:n>r/2?["i","a","b"]:["i","b","a"],a.each(u,function(b,e){switch(e){case"b":p=m.left-6,q=m.top,s=k.get_parent(l),t=l.parent().index();break;case"i":B=k.settings.dnd.inside_pos,C=k.get_node(l.parent()),p=m.left-2,q=m.top+r/2+1,s=C.id,t="first"===B?0:"last"===B?C.children.length:Math.min(B,C.children.length);break;case"a":p=m.left-6,q=m.top+r,s=k.get_parent(l),t=l.parent().index()+1}for(v=!0,w=0,x=i.data.nodes.length;x>w;w++)if(y=i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?"copy_node":"move_node",z=t,"move_node"===y&&"a"===e&&i.data.origin&&i.data.origin===k&&s===k.get_parent(i.data.nodes[w])&&(A=k.get_node(s),z>a.inArray(i.data.nodes[w],A.children)&&(z-=1)),!(v=v&&(k&&k.settings&&k.settings.dnd&&!1===k.settings.dnd.check_while_dragging||k.check(y,i.data.origin&&i.data.origin!==k?i.data.origin.get_node(i.data.nodes[w]):i.data.nodes[w],s,z,{dnd:!0,ref:k.get_node(l.parent()),pos:e,origin:i.data.origin,is_multi:i.data.origin&&i.data.origin!==k,is_foreign:!i.data.origin})))){k&&k.last_error&&(d=k.last_error());break}return"i"===e&&l.parent().is(".jstree-closed")&&k.settings.dnd.open_timeout&&(!i.event||"dragover"!==i.event.type||j)&&(f&&clearTimeout(f),f=setTimeout(function(a,b){return function(){a.open_node(b)}}(k,l),k.settings.dnd.open_timeout)),v?((E=k.get_node(s,!0)).hasClass(".jstree-dnd-parent")||(a(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),E.addClass("jstree-dnd-parent")),c={ins:k,par:s,pos:"i"!==e||"last"!==B||0!==t||k.is_loaded(C)?t:"last"},g.css({left:p+"px",top:q+"px"}).show(),i.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),i.event.originalEvent&&i.event.originalEvent.dataTransfer&&(i.event.originalEvent.dataTransfer.dropEffect=D?"copy":"move"),d={},u=!0,!1):void 0}),!0===u))return}else{for(v=!0,w=0,x=i.data.nodes.length;x>w&&(v=v&&k.check(i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?"copy_node":"move_node",i.data.origin&&i.data.origin!==k?i.data.origin.get_node(i.data.nodes[w]):i.data.nodes[w],a.jstree.root,"last",{dnd:!0,ref:k.get_node(a.jstree.root),pos:"i",origin:i.data.origin,is_multi:i.data.origin&&i.data.origin!==k,is_foreign:!i.data.origin}));w++);if(v)return c={ins:k,par:a.jstree.root,pos:"last"},g.hide(),i.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(i.event.originalEvent&&i.event.originalEvent.dataTransfer&&(i.event.originalEvent.dataTransfer.dropEffect=D?"copy":"move"))}a(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),c=!1,i.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),i.event.originalEvent&&i.event.originalEvent.dataTransfer&&(i.event.originalEvent.dataTransfer.dropEffect="none"),g.hide()}}).on("dnd_scroll.vakata.jstree",function(a,b){b&&b.data&&b.data.jstree&&(g.hide(),c=!1,e=!1,b.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(b,h){if(a(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),f&&clearTimeout(f),h&&h.data&&h.data.jstree){g.hide().detach();var i,j,k=[];if(c){for(i=0,j=h.data.nodes.length;j>i;i++)k[i]=h.data.origin?h.data.origin.get_node(h.data.nodes[i]):h.data.nodes[i];c.ins[h.data.origin&&(h.data.origin.settings.dnd.always_copy||h.data.origin.settings.dnd.copy&&(h.event.metaKey||h.event.ctrlKey))?"copy_node":"move_node"](k,c.par,c.pos,!1,!1,!1,h.data.origin)}else(i=a(h.event.target).closest(".jstree")).length&&d&&d.error&&"check"===d.error&&(i=i.jstree(!0))&&i.settings.core.error.call(this,d);e=!1,c=!1}}).on("keyup.jstree keydown.jstree",function(b,h){(h=a.vakata.dnd._get())&&h.data&&h.data.jstree&&("keyup"===b.type&&27===b.which?(f&&clearTimeout(f),c=!1,d=!1,e=!1,f=!1,g.hide().detach(),a.vakata.dnd._clean()):(h.helper.find(".jstree-copy").first()[h.data.origin&&(h.data.origin.settings.dnd.always_copy||h.data.origin.settings.dnd.copy&&(b.metaKey||b.ctrlKey))?"show":"hide"](),e&&(e.metaKey=b.metaKey,e.ctrlKey=b.ctrlKey,a.vakata.dnd._trigger("move",e))))})}),function(a){a.vakata.html={div:a("<div />"),escape:function(b){return a.vakata.html.div.text(b).html()},strip:function(b){return a.vakata.html.div.empty().append(a.parseHTML(b)).text()}};var c={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};a.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(c,d,e){e===b&&(e=a.vakata.dnd._get()),e.event=d,a(i).triggerHandler("dnd_"+c+".vakata",e)},_get:function(){return{data:c.data,element:c.element,helper:c.helper}},_clean:function(){c.helper&&c.helper.remove(),c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),c={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},a(i).off("mousemove.vakata.jstree touchmove.vakata.jstree",a.vakata.dnd.drag),a(i).off("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop)},_scroll:function(b){if(!c.scroll_e||!c.scroll_l&&!c.scroll_t)return c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),!1;if(!c.scroll_i)return c.scroll_i=setInterval(a.vakata.dnd._scroll,100),!1;if(!0===b)return!1;var d=c.scroll_e.scrollTop(),e=c.scroll_e.scrollLeft();c.scroll_e.scrollTop(d+c.scroll_t*a.vakata.dnd.settings.scroll_speed),c.scroll_e.scrollLeft(e+c.scroll_l*a.vakata.dnd.settings.scroll_speed),(d!==c.scroll_e.scrollTop()||e!==c.scroll_e.scrollLeft())&&a.vakata.dnd._trigger("scroll",c.scroll_e)},start:function(b,d,e){"touchstart"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=i.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_drag&&a.vakata.dnd.stop({});try{b.currentTarget.unselectable="on",b.currentTarget.onselectstart=function(){return!1},b.currentTarget.style&&(b.currentTarget.style.touchAction="none",b.currentTarget.style.msTouchAction="none",b.currentTarget.style.MozUserSelect="none")}catch(f){}return c.init_x=b.pageX,c.init_y=b.pageY,c.data=d,c.is_down=!0,c.element=b.currentTarget,c.target=b.target,c.is_touch="touchstart"===b.type,!1!==e&&(c.helper=a("<div id='vakata-dnd'></div>").html(e).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),a(i).on("mousemove.vakata.jstree touchmove.vakata.jstree",a.vakata.dnd.drag),a(i).on("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop),!1},drag:function(b){if("touchmove"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=i.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_down){if(!c.is_drag){if(!(Math.abs(b.pageX-c.init_x)>(c.is_touch?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)||Math.abs(b.pageY-c.init_y)>(c.is_touch?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)))return;c.helper&&(c.helper.appendTo("body"),c.helper_w=c.helper.outerWidth()),c.is_drag=!0,a(c.target).one("click.vakata",!1),a.vakata.dnd._trigger("start",b)}var d=!1,e=!1,f=!1,g=!1,h=!1,j=!1,k=!1,l=!1,m=!1,n=!1;return c.scroll_t=0,c.scroll_l=0,c.scroll_e=!1,a(a(b.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(a(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var d=a(this),e=d.offset();return this.scrollHeight>this.offsetHeight&&(e.top+d.height()-b.pageY<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),b.pageY-e.top<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(e.left+d.width()-b.pageX<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),b.pageX-e.left<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1)),c.scroll_t||c.scroll_l?(c.scroll_e=a(this),!1):void 0}),c.scroll_e||(d=a(i),e=a(window),f=d.height(),g=e.height(),h=d.width(),j=e.width(),k=d.scrollTop(),l=d.scrollLeft(),f>g&&b.pageY-k<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1),f>g&&g-(b.pageY-k)<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),h>j&&b.pageX-l<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1),h>j&&j-(b.pageX-l)<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),(c.scroll_t||c.scroll_l)&&(c.scroll_e=d)),c.scroll_e&&a.vakata.dnd._scroll(!0),c.helper&&(m=parseInt(b.pageY+a.vakata.dnd.settings.helper_top,10),n=parseInt(b.pageX+a.vakata.dnd.settings.helper_left,10),f&&m+25>f&&(m=f-50),h&&n+c.helper_w>h&&(n=h-(c.helper_w+2)),c.helper.css({left:n+"px",top:m+"px"})),a.vakata.dnd._trigger("move",b),!1}},stop:function(b){if("touchend"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=i.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_drag)b.target!==c.target&&a(c.target).off("click.vakata"),a.vakata.dnd._trigger("stop",b);else if("touchend"===b.type&&b.target===c.target){var d=setTimeout(function(){a(b.target).click()},100);a(b.target).one("click",function(){d&&clearTimeout(d)})}return a.vakata.dnd._clean(),!1}}}(a),a.jstree.defaults.massload=null,a.jstree.plugins.massload=function(b,c){this.init=function(a,b){this._data.massload={},c.init.call(this,a,b)},this._load_nodes=function(b,d,e,f){var k,l,m,g=this.settings.massload,i=(JSON.stringify(b),[]),j=this._model.data;if(!e){for(k=0,l=b.length;l>k;k++)(!j[b[k]]||!j[b[k]].state.loaded&&!j[b[k]].state.failed||f)&&(i.push(b[k]),(m=this.get_node(b[k],!0))&&m.length&&m.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},i.length){if(a.isFunction(g))return g.call(this,i,a.proxy(function(a){var g,h;if(a)for(g in a)a.hasOwnProperty(g)&&(this._data.massload[g]=a[g]);for(g=0,h=b.length;h>g;g++)(m=this.get_node(b[g],!0))&&m.length&&m.removeClass("jstree-loading").attr("aria-busy",!1);c._load_nodes.call(this,b,d,e,f)},this));if("object"==typeof g&&g&&g.url)return g=a.extend(!0,{},g),a.isFunction(g.url)&&(g.url=g.url.call(this,i)),a.isFunction(g.data)&&(g.data=g.data.call(this,i)),a.ajax(g).done(a.proxy(function(a,g,h){var i,j;if(a)for(i in a)a.hasOwnProperty(i)&&(this._data.massload[i]=a[i]);for(i=0,j=b.length;j>i;i++)(m=this.get_node(b[i],!0))&&m.length&&m.removeClass("jstree-loading").attr("aria-busy",!1);c._load_nodes.call(this,b,d,e,f)},this)).fail(a.proxy(function(a){c._load_nodes.call(this,b,d,e,f)},this))}}return c._load_nodes.call(this,b,d,e,f)},this._load_node=function(b,d){var g,e=this._data.massload[b.id],f=null;return e?(f=this["string"==typeof e?"_append_html_data":"_append_json_data"](b,"string"==typeof e?a(a.parseHTML(e)).filter(function(){return 3!==this.nodeType}):e,function(a){d.call(this,a)}),(g=this.get_node(b.id,!0))&&g.length&&g.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[b.id],f):c._load_node.call(this,b,d)}},a.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},a.jstree.plugins.search=function(c,d){this.bind=function(){d.bind.call(this),this._data.search.str="",this._data.search.dom=a(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",a.proxy(function(b,c){if(this._data.search.som&&c.res.length){var e,f,h,i,d=this._model.data,g=[];for(e=0,f=c.res.length;f>e;e++)if(d[c.res[e]]&&!d[c.res[e]].state.hidden&&(g.push(c.res[e]),g=g.concat(d[c.res[e]].parents),this._data.search.smc))for(h=0,i=d[c.res[e]].children_d.length;i>h;h++)d[d[c.res[e]].children_d[h]]&&!d[d[c.res[e]].children_d[h]].state.hidden&&g.push(d[c.res[e]].children_d[h]);g=a.vakata.array_remove_item(a.vakata.array_unique(g),a.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(g,!0),this.redraw(!0)}},this)).on("clear_search.jstree",a.proxy(function(a,b){this._data.search.som&&b.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))},this.search=function(c,d,e,f,g,h){if(!1===c||""===a.trim(c.toString()))return this.clear_search();f=(f=this.get_node(f))&&f.id?f.id:null,c=c.toString();var o,p,i=this.settings.search,j=!!i.ajax&&i.ajax,k=this._model.data,l=null,m=[],n=[];if(this._data.search.res.length&&!g&&this.clear_search(),e===b&&(e=i.show_only_matches),h===b&&(h=i.show_only_matches_children),!d&&!1!==j)return a.isFunction(j)?j.call(this,c,a.proxy(function(b){b&&b.d&&(b=b.d),this._load_nodes(a.isArray(b)?a.vakata.array_unique(b):[],function(){this.search(c,!0,e,f,g,h)})},this),f):((j=a.extend({},j)).data||(j.data={}),j.data.str=c,f&&(j.data.inside=f),this._data.search.lastRequest&&this._data.search.lastRequest.abort(),this._data.search.lastRequest=a.ajax(j).fail(a.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(j)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(a.proxy(function(b){b&&b.d&&(b=b.d),this._load_nodes(a.isArray(b)?a.vakata.array_unique(b):[],function(){this.search(c,!0,e,f,g,h)})},this)),this._data.search.lastRequest);if(g||(this._data.search.str=c,this._data.search.dom=a(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=e,this._data.search.smc=h),l=new a.vakata.search(c,!0,{caseSensitive:i.case_sensitive,fuzzy:i.fuzzy}),a.each(k[f||a.jstree.root].children_d,function(a,b){var d=k[b];d.text&&!d.state.hidden&&(!i.search_leaves_only||d.state.loaded&&0===d.children.length)&&(i.search_callback&&i.search_callback.call(this,c,d)||!i.search_callback&&l.search(d.text).isMatch)&&(m.push(b),n=n.concat(d.parents))}),m.length){for(o=0,p=(n=a.vakata.array_unique(n)).length;p>o;o++)n[o]!==a.jstree.root&&k[n[o]]&&!0===this.open_node(n[o],null,0)&&this._data.search.opn.push(n[o]);g?(this._data.search.dom=this._data.search.dom.add(a(this.element[0].querySelectorAll("#"+a.map(m,function(b){return-1!=="0123456789".indexOf(b[0])?"\\3"+b[0]+" "+b.substr(1).replace(a.jstree.idregex,"\\$&"):b.replace(a.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=a.vakata.array_unique(this._data.search.res.concat(m))):(this._data.search.dom=a(this.element[0].querySelectorAll("#"+a.map(m,function(b){return-1!=="0123456789".indexOf(b[0])?"\\3"+b[0]+" "+b.substr(1).replace(a.jstree.idregex,"\\$&"):b.replace(a.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=m),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:c,res:this._data.search.res,show_only_matches:e})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=a(this.element[0].querySelectorAll("#"+a.map(this._data.search.res,function(b){return-1!=="0123456789".indexOf(b[0])?"\\3"+b[0]+" "+b.substr(1).replace(a.jstree.idregex,"\\$&"):b.replace(a.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=a()},this.redraw_node=function(b,c,e,f){if((b=d.redraw_node.apply(this,arguments))&&-1!==a.inArray(b.id,this._data.search.res)){var g,h,i=null;for(g=0,h=b.childNodes.length;h>g;g++)if(b.childNodes[g]&&b.childNodes[g].className&&-1!==b.childNodes[g].className.indexOf("jstree-anchor")){i=b.childNodes[g];break}i&&(i.className+=" jstree-search")}return b}},function(a){a.vakata.search=function(b,c,d){d=d||{},!1!==(d=a.extend({},a.vakata.search.defaults,d)).fuzzy&&(d.fuzzy=!0),b=d.caseSensitive?b:b.toLowerCase();var i,j,k,l,e=d.location,f=d.distance,g=d.threshold,h=b.length;return h>32&&(d.fuzzy=!1),d.fuzzy&&(i=1<<h-1,j=function(){var a={},c=0;for(c=0;h>c;c++)a[b.charAt(c)]=0;for(c=0;h>c;c++)a[b.charAt(c)]|=1<<h-c-1;return a}(),k=function(a,b){var c=a/h,d=Math.abs(e-b);return f?c+d/f:d?1:c}),l=function(a){if(a=d.caseSensitive?a:a.toLowerCase(),b===a||-1!==a.indexOf(b))return{isMatch:!0,score:0};if(!d.fuzzy)return{isMatch:!1,score:1};var c,f,o,p,r,s,t,u,v,l=a.length,m=g,n=a.indexOf(b,e),q=h+l,w=1,x=[];for(-1!==n&&(m=Math.min(k(0,n),m),-1!==(n=a.lastIndexOf(b,e+h))&&(m=Math.min(k(0,n),m))),n=-1,c=0;h>c;c++){for(o=0,p=q;p>o;)k(c,e+p)<=m?o=p:q=p,p=Math.floor((q-o)/2+o);for(q=p,s=Math.max(1,e-p+1),t=Math.min(e+p,l)+h,(u=new Array(t+2))[t+1]=(1<<c)-1,f=t;f>=s;f--)if(v=j[a.charAt(f-1)],u[f]=0===c?(u[f+1]<<1|1)&v:(u[f+1]<<1|1)&v|(r[f+1]|r[f])<<1|1|r[f+1],u[f]&i&&(w=k(c,f-1),m>=w)){if(m=w,n=f-1,x.push(n),!(n>e))break;s=Math.max(1,2*e-n)}if(k(c+1,e)>m)break;r=u}return{isMatch:n>=0,score:w}},!0===c?{search:l}:l(c)},a.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(a),a.jstree.defaults.sort=function(a,b){return this.get_text(a)>this.get_text(b)?1:-1},a.jstree.plugins.sort=function(b,c){this.bind=function(){c.bind.call(this),this.element.on("model.jstree",a.proxy(function(a,b){this.sort(b.parent,!0)},this)).on("rename_node.jstree create_node.jstree",a.proxy(function(a,b){this.sort(b.parent||b.node.parent,!1),this.redraw_node(b.parent||b.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",a.proxy(function(a,b){this.sort(b.parent,!1),this.redraw_node(b.parent,!0)},this))},this.sort=function(b,c){var d,e;if((b=this.get_node(b))&&b.children&&b.children.length&&(b.children.sort(a.proxy(this.settings.sort,this)),c))for(d=0,e=b.children_d.length;e>d;d++)this.sort(b.children_d[d],!1)}};var m=!1;a.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},a.jstree.plugins.state=function(b,c){this.bind=function(){c.bind.call(this);var b=a.proxy(function(){this.element.on(this.settings.state.events,a.proxy(function(){m&&clearTimeout(m),m=setTimeout(a.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",a.proxy(function(a,c){this.element.one("restore_state.jstree",b),this.restore_state()||b()},this))},this.save_state=function(){var b={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};a.vakata.storage.set(this.settings.state.key,JSON.stringify(b))},this.restore_state=function(){var b=a.vakata.storage.get(this.settings.state.key);if(b)try{b=JSON.parse(b)}catch(c){return!1}return!(b&&b.ttl&&b.sec&&+new Date-b.sec>b.ttl)&&(b&&b.state&&(b=b.state),b&&a.isFunction(this.settings.state.filter)&&(b=this.settings.state.filter.call(this,b)),!!b&&(this.element.one("set_state.jstree",function(c,d){d.instance.trigger("restore_state",{state:a.extend(!0,{},b)})}),this.set_state(b),!0))},this.clear_state=function(){return a.vakata.storage.del(this.settings.state.key)}},function(a,b){a.vakata.storage={set:function(a,b){return window.localStorage.setItem(a,b)},get:function(a){return window.localStorage.getItem(a)},del:function(a){return window.localStorage.removeItem(a)}}}(a),a.jstree.defaults.types={default:{}},a.jstree.defaults.types[a.jstree.root]={},a.jstree.plugins.types=function(c,d){this.init=function(c,e){var f,g;if(e&&e.types&&e.types.default)for(f in e.types)if("default"!==f&&f!==a.jstree.root&&e.types.hasOwnProperty(f))for(g in e.types.default)e.types.default.hasOwnProperty(g)&&e.types[f][g]===b&&(e.types[f][g]=e.types.default[g]);d.init.call(this,c,e),this._model.data[a.jstree.root].type=a.jstree.root},this.refresh=function(b,c){d.refresh.call(this,b,c),this._model.data[a.jstree.root].type=a.jstree.root},this.bind=function(){this.element.on("model.jstree",a.proxy(function(c,d){var h,i,k,e=this._model.data,f=d.nodes,g=this.settings.types,j="default";for(h=0,i=f.length;i>h;h++){if(j="default",e[f[h]].original&&e[f[h]].original.type&&g[e[f[h]].original.type]&&(j=e[f[h]].original.type),e[f[h]].data&&e[f[h]].data.jstree&&e[f[h]].data.jstree.type&&g[e[f[h]].data.jstree.type]&&(j=e[f[h]].data.jstree.type),e[f[h]].type=j,!0===e[f[h]].icon&&g[j].icon!==b&&(e[f[h]].icon=g[j].icon),g[j].li_attr!==b&&"object"==typeof g[j].li_attr)for(k in g[j].li_attr)if(g[j].li_attr.hasOwnProperty(k)){if("id"===k)continue;e[f[h]].li_attr[k]===b?e[f[h]].li_attr[k]=g[j].li_attr[k]:"class"===k&&(e[f[h]].li_attr.class=g[j].li_attr.class+" "+e[f[h]].li_attr.class)}if(g[j].a_attr!==b&&"object"==typeof g[j].a_attr)for(k in g[j].a_attr)if(g[j].a_attr.hasOwnProperty(k)){if("id"===k)continue;e[f[h]].a_attr[k]===b?e[f[h]].a_attr[k]=g[j].a_attr[k]:"href"===k&&"#"===e[f[h]].a_attr[k]?e[f[h]].a_attr.href=g[j].a_attr.href:"class"===k&&(e[f[h]].a_attr.class=g[j].a_attr.class+" "+e[f[h]].a_attr.class)}}e[a.jstree.root].type=a.jstree.root},this)),d.bind.call(this)},this.get_json=function(b,c,e){var f,g,h=this._model.data,i=c?a.extend(!0,{},c,{no_id:!1}):{},j=d.get_json.call(this,b,i,e);if(!1===j)return!1;if(a.isArray(j))for(f=0,g=j.length;g>f;f++)j[f].type=j[f].id&&h[j[f].id]&&h[j[f].id].type?h[j[f].id].type:"default",c&&c.no_id&&(delete j[f].id,j[f].li_attr&&j[f].li_attr.id&&delete j[f].li_attr.id,j[f].a_attr&&j[f].a_attr.id&&delete j[f].a_attr.id);else j.type=j.id&&h[j.id]&&h[j.id].type?h[j.id].type:"default",c&&c.no_id&&(j=this._delete_ids(j));return j},this._delete_ids=function(b){if(a.isArray(b)){for(var c=0,d=b.length;d>c;c++)b[c]=this._delete_ids(b[c]);return b}return delete b.id,b.li_attr&&b.li_attr.id&&delete b.li_attr.id,b.a_attr&&b.a_attr.id&&delete b.a_attr.id,b.children&&a.isArray(b.children)&&(b.children=this._delete_ids(b.children)),b},this.check=function(c,e,f,g,h){if(!1===d.check.call(this,c,e,f,g,h))return!1;e=e&&e.id?e:this.get_node(e),f=f&&f.id?f:this.get_node(f);var j,k,l,m,i=e&&e.id?h&&h.origin?h.origin:a.jstree.reference(e.id):null;switch(i=i&&i._model&&i._model.data?i._model.data:null,c){case"create_node":case"move_node":case"copy_node":if("move_node"!==c||-1===a.inArray(e.id,f.children)){if((j=this.get_rules(f)).max_children!==b&&-1!==j.max_children&&j.max_children===f.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+c,data:JSON.stringify({chk:c,pos:g,obj:!(!e||!e.id)&&e.id,par:!(!f||!f.id)&&f.id})},!1;if(j.valid_children!==b&&-1!==j.valid_children&&-1===a.inArray(e.type||"default",j.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+c,data:JSON.stringify({chk:c,pos:g,obj:!(!e||!e.id)&&e.id,par:!(!f||!f.id)&&f.id})},!1;if(i&&e.children_d&&e.parents){for(k=0,l=0,m=e.children_d.length;m>l;l++)k=Math.max(k,i[e.children_d[l]].parents.length);k=k-e.parents.length+1}(0>=k||k===b)&&(k=1);do{if(j.max_depth!==b&&-1!==j.max_depth&&j.max_depth<k)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+c,data:JSON.stringify({chk:c,pos:g,obj:!(!e||!e.id)&&e.id,par:!(!f||!f.id)&&f.id})},!1;f=this.get_node(f.parent),j=this.get_rules(f),k++}while(f)}}return!0},this.get_rules=function(a){if(!(a=this.get_node(a)))return!1;var c=this.get_type(a,!0);return c.max_depth===b&&(c.max_depth=-1),c.max_children===b&&(c.max_children=-1),c.valid_children===b&&(c.valid_children=-1),c},this.get_type=function(b,c){return!!(b=this.get_node(b))&&(c?a.extend({type:b.type},this.settings.types[b.type]):b.type)},this.set_type=function(c,d){var f,g,h,i,j,k,l,m,e=this._model.data;if(a.isArray(c)){for(g=0,h=(c=c.slice()).length;h>g;g++)this.set_type(c[g],d);return!0}if(f=this.settings.types,c=this.get_node(c),!f[d]||!c)return!1;if((l=this.get_node(c,!0))&&l.length&&(m=l.children(".jstree-anchor")),i=c.type,j=this.get_icon(c),c.type=d,(!0===j||!f[i]||f[i].icon!==b&&j===f[i].icon)&&this.set_icon(c,f[d].icon===b||f[d].icon),f[i]&&f[i].li_attr!==b&&"object"==typeof f[i].li_attr)for(k in f[i].li_attr)if(f[i].li_attr.hasOwnProperty(k)){if("id"===k)continue;"class"===k?(e[c.id].li_attr.class=(e[c.id].li_attr.class||"").replace(f[i].li_attr[k],""),l&&l.removeClass(f[i].li_attr[k])):e[c.id].li_attr[k]===f[i].li_attr[k]&&(e[c.id].li_attr[k]=null,l&&l.removeAttr(k))}if(f[i]&&f[i].a_attr!==b&&"object"==typeof f[i].a_attr)for(k in f[i].a_attr)if(f[i].a_attr.hasOwnProperty(k)){if("id"===k)continue;"class"===k?(e[c.id].a_attr.class=(e[c.id].a_attr.class||"").replace(f[i].a_attr[k],""),m&&m.removeClass(f[i].a_attr[k])):e[c.id].a_attr[k]===f[i].a_attr[k]&&("href"===k?(e[c.id].a_attr[k]="#",m&&m.attr("href","#")):(delete e[c.id].a_attr[k],m&&m.removeAttr(k)))}if(f[d].li_attr!==b&&"object"==typeof f[d].li_attr)for(k in f[d].li_attr)if(f[d].li_attr.hasOwnProperty(k)){if("id"===k)continue;e[c.id].li_attr[k]===b?(e[c.id].li_attr[k]=f[d].li_attr[k],l&&("class"===k?l.addClass(f[d].li_attr[k]):l.attr(k,f[d].li_attr[k]))):"class"===k&&(e[c.id].li_attr.class=f[d].li_attr[k]+" "+e[c.id].li_attr.class,l&&l.addClass(f[d].li_attr[k]))}if(f[d].a_attr!==b&&"object"==typeof f[d].a_attr)for(k in f[d].a_attr)if(f[d].a_attr.hasOwnProperty(k)){if("id"===k)continue;e[c.id].a_attr[k]===b?(e[c.id].a_attr[k]=f[d].a_attr[k],m&&("class"===k?m.addClass(f[d].a_attr[k]):m.attr(k,f[d].a_attr[k]))):"href"===k&&"#"===e[c.id].a_attr[k]?(e[c.id].a_attr.href=f[d].a_attr.href,m&&m.attr("href",f[d].a_attr.href)):"class"===k&&(e[c.id].a_attr.class=f[d].a_attr.class+" "+e[c.id].a_attr.class,m&&m.addClass(f[d].a_attr[k]))}return!0}},a.jstree.defaults.unique={case_sensitive:!1,duplicate:function(a,b){return a+" ("+b+")"}},a.jstree.plugins.unique=function(c,d){this.check=function(b,c,e,f,g){if(!1===d.check.call(this,b,c,e,f,g))return!1;if(c=c&&c.id?c:this.get_node(c),!(e=e&&e.id?e:this.get_node(e))||!e.children)return!0;var l,m,h="rename_node"===b?f:c.text,i=[],j=this.settings.unique.case_sensitive,k=this._model.data;for(l=0,m=e.children.length;m>l;l++)i.push(j?k[e.children[l]].text:k[e.children[l]].text.toLowerCase());switch(j||(h=h.toLowerCase()),b){case"delete_node":return!0;case"rename_node":return(l=-1===a.inArray(h,i)||c.text&&c.text[j?"toString":"toLowerCase"]()===h)||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+h+" already exists. Preventing: "+b,data:JSON.stringify({chk:b,pos:f,obj:!(!c||!c.id)&&c.id,par:!(!e||!e.id)&&e.id})}),l;case"create_node":return(l=-1===a.inArray(h,i))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+h+" already exists. Preventing: "+b,data:JSON.stringify({chk:b,pos:f,obj:!(!c||!c.id)&&c.id,par:!(!e||!e.id)&&e.id})}),l;case"copy_node":return(l=-1===a.inArray(h,i))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+h+" already exists. Preventing: "+b,data:JSON.stringify({chk:b,pos:f,obj:!(!c||!c.id)&&c.id,par:!(!e||!e.id)&&e.id})}),l;case"move_node":return(l=c.parent===e.id&&(!g||!g.is_multi)||-1===a.inArray(h,i))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+h+" already exists. Preventing: "+b,data:JSON.stringify({chk:b,pos:f,obj:!(!c||!c.id)&&c.id,par:!(!e||!e.id)&&e.id})}),l}return!0},this.create_node=function(c,e,f,g,h){if(!e||e.text===b){if(null===c&&(c=a.jstree.root),!(c=this.get_node(c)))return d.create_node.call(this,c,e,f,g,h);if(!(f=f===b?"last":f).toString().match(/^(before|after)$/)&&!h&&!this.is_loaded(c))return d.create_node.call(this,c,e,f,g,h);e||(e={});var i,j,k,l,m,n=this._model.data,o=this.settings.unique.case_sensitive,p=this.settings.unique.duplicate;for(j=i=this.get_string("New node"),k=[],l=0,m=c.children.length;m>l;l++)k.push(o?n[c.children[l]].text:n[c.children[l]].text.toLowerCase());for(l=1;-1!==a.inArray(o?j:j.toLowerCase(),k);)j=p.call(this,i,++l).toString();e.text=j}return d.create_node.call(this,c,e,f,g,h)}};var n=i.createElement("DIV");if(n.setAttribute("unselectable","on"),n.setAttribute("role","presentation"),n.className="jstree-wholerow",n.innerHTML="&#160;",a.jstree.plugins.wholerow=function(b,c){this.bind=function(){c.bind.call(this),this.element.on("ready.jstree set_state.jstree",a.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",a.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",a.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",a.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var d,e,c=!1;for(d=0,e=b.selected.length;e>d;d++)(c=this.get_node(b.selected[d],!0))&&c.length&&c.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",a.proxy(function(a,b){this.get_node(b.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",a.proxy(function(a,b){"hover_node"===a.type&&this.is_disabled(b.node)||this.get_node(b.node,!0).children(".jstree-wholerow")["hover_node"===a.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",a.proxy(function(b){if(this._data.contextmenu){b.preventDefault();var c=a.Event("contextmenu",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey,pageX:b.pageX,pageY:b.pageY});a(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c)}},this)).on("click.jstree",".jstree-wholerow",function(b){b.stopImmediatePropagation();var c=a.Event("click",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});a(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c).focus()}).on("dblclick.jstree",".jstree-wholerow",function(b){b.stopImmediatePropagation();var c=a.Event("dblclick",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});a(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",a.proxy(function(b){b.stopImmediatePropagation();var c=a.Event("click",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});a(b.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(c).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",a.proxy(function(a){return a.stopImmediatePropagation(),this.is_disabled(a.currentTarget)||this.hover_node(a.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",a.proxy(function(a){this.dehover_node(a.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),c.teardown.call(this)},this.redraw_node=function(b,d,e,f){if(b=c.redraw_node.apply(this,arguments)){var g=n.cloneNode(!0);-1!==a.inArray(b.id,this._data.core.selected)&&(g.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===b.id&&(g.className+=" jstree-wholerow-hovered"),b.insertBefore(g,b.childNodes[0])}return b}},i.registerElement&&Object&&Object.create){var o=Object.create(HTMLElement.prototype);o.createdCallback=function(){var c,b={core:{},plugins:[]};for(c in a.jstree.plugins)a.jstree.plugins.hasOwnProperty(c)&&this.attributes[c]&&(b.plugins.push(c),this.getAttribute(c)&&JSON.parse(this.getAttribute(c))&&(b[c]=JSON.parse(this.getAttribute(c))));for(c in a.jstree.defaults.core)a.jstree.defaults.core.hasOwnProperty(c)&&this.attributes[c]&&(b.core[c]=JSON.parse(this.getAttribute(c))||this.getAttribute(c));a(this).jstree(b)};try{i.registerElement("vakata-jstree",{prototype:o})}catch(p){}}}}),function(a,b,c){!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):jQuery&&!jQuery.fn.qtip&&a(jQuery)}(function(d){"use strict";function e(a,b,c,e){this.id=c,this.target=a,this.tooltip=F,this.elements={target:a},this._id=S+"-"+c,this.timers={img:{}},this.options=b,this.plugins={},this.cache={event:{},target:d(),disabled:E,attr:e,onTooltip:E,lastClass:""},this.rendered=this.destroyed=this.disabled=this.waiting=this.hiddenDuringWait=this.positioning=this.triggering=E}function f(a){return a===F||"object"!==d.type(a)}function g(a){return!(d.isFunction(a)||a&&a.attr||a.length||"object"===d.type(a)&&(a.jquery||a.then))}function h(a){var b,c,e,h;return f(a)?E:(f(a.metadata)&&(a.metadata={type:a.metadata}),"content"in a&&(b=a.content,f(b)||b.jquery||b.done?(c=g(b)?E:b,b=a.content={text:c}):c=b.text,"ajax"in b&&(e=b.ajax,h=e&&e.once!==E,delete b.ajax,b.text=function(a,b){var f=c||d(this).attr(b.options.content.attr)||"Loading...",g=d.ajax(d.extend({},e,{context:b})).then(e.success,F,e.error).then(function(a){return a&&h&&b.set("content.text",a),a},function(a,c,d){b.destroyed||0===a.status||b.set("content.text",c+": "+d)});return h?f:(b.set("content.text",f),g)}),"title"in b&&(d.isPlainObject(b.title)&&(b.button=b.title.button,b.title=b.title.text),g(b.title||E)&&(b.title=E))),"position"in a&&f(a.position)&&(a.position={my:a.position,at:a.position}),"show"in a&&f(a.show)&&(a.show=a.show.jquery?{target:a.show}:a.show===D?{ready:D}:{event:a.show}),"hide"in a&&f(a.hide)&&(a.hide=a.hide.jquery?{target:a.hide}:{event:a.hide}),"style"in a&&f(a.style)&&(a.style={classes:a.style}),d.each(R,function(){this.sanitize&&this.sanitize(a)}),a)}function i(a,b){for(var c,d=0,e=a,f=b.split(".");e=e[f[d++]];)d<f.length&&(c=e);return[c||a,f.pop()]}function j(a,b){var c,d,e;for(c in this.checks)if(this.checks.hasOwnProperty(c))for(d in this.checks[c])this.checks[c].hasOwnProperty(d)&&(e=new RegExp(d,"i").exec(a))&&(b.push(e),("builtin"===c||this.plugins[c])&&this.checks[c][d].apply(this.plugins[c]||this,b))}function k(a){return V.concat("").join(a?"-"+a+" ":" ")}function l(a,b){return b>0?setTimeout(d.proxy(a,this),b):void a.call(this)}function m(a){this.tooltip.hasClass(aa)||(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this.timers.show=l.call(this,function(){this.toggle(D,a)},this.options.show.delay))}function n(a){if(!this.tooltip.hasClass(aa)&&!this.destroyed){var b=d(a.relatedTarget),c=b.closest(W)[0]===this.tooltip[0],e=b[0]===this.options.show.target[0];if(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this!==b[0]&&"mouse"===this.options.position.target&&c||this.options.hide.fixed&&/mouse(out|leave|move)/.test(a.type)&&(c||e))try{a.preventDefault(),a.stopImmediatePropagation()}catch(f){}else this.timers.hide=l.call(this,function(){this.toggle(E,a)},this.options.hide.delay,this)}}function o(a){!this.tooltip.hasClass(aa)&&this.options.hide.inactive&&(clearTimeout(this.timers.inactive),this.timers.inactive=l.call(this,function(){this.hide(a)},this.options.hide.inactive))}function p(a){this.rendered&&this.tooltip[0].offsetWidth>0&&this.reposition(a)}function q(a,c,e){d(b.body).delegate(a,(c.split?c:c.join("."+S+" "))+"."+S,function(){var a=y.api[d.attr(this,U)];a&&!a.disabled&&e.apply(a,arguments)})}function r(a,c,f){var g,i,j,k,l,m=d(b.body),n=a[0]===b?m:a,o=a.metadata?a.metadata(f.metadata):F,p="html5"===f.metadata.type&&o?o[f.metadata.name]:F,q=a.data(f.metadata.name||"qtipopts");try{q="string"==typeof q?d.parseJSON(q):q}catch(r){}if(k=d.extend(D,{},y.defaults,f,"object"==typeof q?h(q):F,h(p||o)),i=k.position,k.id=c,"boolean"==typeof k.content.text){if(j=a.attr(k.content.attr),k.content.attr===E||!j)return E;k.content.text=j}if(i.container.length||(i.container=m),i.target===E&&(i.target=n),k.show.target===E&&(k.show.target=n),k.show.solo===D&&(k.show.solo=i.container.closest("body")),k.hide.target===E&&(k.hide.target=n),k.position.viewport===D&&(k.position.viewport=i.container),i.container=i.container.eq(0),i.at=new A(i.at,D),i.my=new A(i.my),a.data(S))if(k.overwrite)a.qtip("destroy",!0);else if(k.overwrite===E)return E;return a.attr(T,c),k.suppress&&(l=a.attr("title"))&&a.removeAttr("title").attr(ca,l).attr("title",""),g=new e(a,k,c,!!j),a.data(S,g),g}function s(a){return a.charAt(0).toUpperCase()+a.slice(1)}function u(a,b){return Math.ceil(parseFloat(function(a,b){var d,e,f=b.charAt(0).toUpperCase()+b.slice(1),g=(b+" "+va.join(f+" ")+f).split(" "),h=0;if(ua[b])return a.css(ua[b]);for(;d=g[h++];)if((e=a.css(d))!==c)return ua[b]=d,e}(a,b)))}function v(a,b){this._ns="tip",this.options=b,this.offset=b.offset,this.size=[b.width,b.height],this.qtip=a,this.init(a)}function w(a,b){this.options=b,this._ns="-modal",this.qtip=a,this.init(a)}function x(a){this._ns="ie6",this.qtip=a,this.init(a)}var y,z,A,B,C,D=!0,E=!1,F=null,G="x",H="y",I="width",J="height",K="top",L="left",M="bottom",N="right",O="center",P="flipinvert",Q="shift",R={},S="qtip",T="data-hasqtip",U="data-qtip-id",V=["ui-widget","ui-tooltip"],W="."+S,X="click dblclick mousedown mouseup mousemove mouseleave mouseenter".split(" "),Y=S+"-fixed",Z=S+"-default",$=S+"-focus",_=S+"-hover",aa=S+"-disabled",ba="_replacedByqTip",ca="oldtitle",da_ie=function(){var a,c;for(a=4,c=b.createElement("div");(c.innerHTML="\x3c!--[if gt IE "+a+"]><i></i><![endif]--\x3e")&&c.getElementsByTagName("i")[0];a+=1);return a>4?a:NaN}(),da_iOS=parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||E;(z=e.prototype)._when=function(a){return d.when.apply(d,a)},z.render=function(a){if(this.rendered||this.destroyed)return this;var b=this,c=this.options,e=this.cache,f=this.elements,g=c.content.text,h=c.content.title,i=c.content.button,j=c.position,k=[];return d.attr(this.target[0],"aria-describedby",this._id),e.posClass=this._createPosClass((this.position={my:j.my,at:j.at}).my),this.tooltip=f.tooltip=d("<div/>",{id:this._id,class:[S,Z,c.style.classes,e.posClass].join(" "),width:c.style.width||"",height:c.style.height||"",tracking:"mouse"===j.target&&j.adjust.mouse,role:"alert","aria-live":"polite","aria-atomic":E,"aria-describedby":this._id+"-content","aria-hidden":D}).toggleClass(aa,this.disabled).attr(U,this.id).data(S,this).appendTo(j.container).append(f.content=d("<div />",{class:S+"-content",id:this._id+"-content","aria-atomic":D})),this.rendered=-1,this.positioning=D,h&&(this._createTitle(),d.isFunction(h)||k.push(this._updateTitle(h,E))),i&&this._createButton(),d.isFunction(g)||k.push(this._updateContent(g,E)),this.rendered=D,this._setWidget(),d.each(R,function(a){var c;"render"===this.initialize&&(c=this(b))&&(b.plugins[a]=c)}),this._unassignEvents(),this._assignEvents(),this._when(k).then(function(){b._trigger("render"),b.positioning=E,b.hiddenDuringWait||!c.show.ready&&!a||b.toggle(D,e.event,E),b.hiddenDuringWait=E}),y.api[this.id]=this,this},z.destroy=function(a){function b(){if(!this.destroyed){this.destroyed=D;var a,b=this.target,c=b.attr(ca);this.rendered&&this.tooltip.stop(1,0).find("*").remove().end().remove(),d.each(this.plugins,function(){this.destroy&&this.destroy()});for(a in this.timers)this.timers.hasOwnProperty(a)&&clearTimeout(this.timers[a]);b.removeData(S).removeAttr(U).removeAttr(T).removeAttr("aria-describedby"),this.options.suppress&&c&&b.attr("title",c).removeAttr(ca),this._unassignEvents(),this.options=this.elements=this.cache=this.timers=this.plugins=this.mouse=F,delete y.api[this.id]}}return this.destroyed?this.target:(a===D&&"hide"!==this.triggering||!this.rendered?b.call(this):(this.tooltip.one("tooltiphidden",d.proxy(b,this)),!this.triggering&&this.hide()),this.target)},B=z.checks={builtin:{"^id$":function(a,b,c,e){var f=c===D?y.nextid:c,g=S+"-"+f;f!==E&&f.length>0&&!d("#"+g).length?(this._id=g,this.rendered&&(this.tooltip[0].id=this._id,this.elements.content[0].id=this._id+"-content",this.elements.title[0].id=this._id+"-title")):a[b]=e},"^prerender":function(a,b,c){c&&!this.rendered&&this.render(this.options.show.ready)},"^content.text$":function(a,b,c){this._updateContent(c)},"^content.attr$":function(a,b,c,d){this.options.content.text===this.target.attr(d)&&this._updateContent(this.target.attr(c))},"^content.title$":function(a,b,c){return c?(c&&!this.elements.title&&this._createTitle(),void this._updateTitle(c)):this._removeTitle()},"^content.button$":function(a,b,c){this._updateButton(c)},"^content.title.(text|button)$":function(a,b,c){this.set("content."+b,c)},"^position.(my|at)$":function(a,b,c){"string"==typeof c&&(this.position[b]=a[b]=new A(c,"at"===b))},"^position.container$":function(a,b,c){this.rendered&&this.tooltip.appendTo(c)},"^show.ready$":function(a,b,c){c&&(!this.rendered&&this.render(D)||this.toggle(D))},"^style.classes$":function(a,b,c,d){this.rendered&&this.tooltip.removeClass(d).addClass(c)},"^style.(width|height)":function(a,b,c){this.rendered&&this.tooltip.css(b,c)},"^style.widget|content.title":function(){this.rendered&&this._setWidget()},"^style.def":function(a,b,c){this.rendered&&this.tooltip.toggleClass(Z,!!c)},"^events.(render|show|move|hide|focus|blur)$":function(a,b,c){this.rendered&&this.tooltip[(d.isFunction(c)?"":"un")+"bind"]("tooltip"+b,c)},"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)":function(){if(this.rendered){var a=this.options.position;this.tooltip.attr("tracking","mouse"===a.target&&a.adjust.mouse),this._unassignEvents(),this._assignEvents()}}}},z.get=function(a){if(this.destroyed)return this;var b=i(this.options,a.toLowerCase()),c=b[0][b[1]];return c.precedance?c.string():c};var ea=/^position\.(my|at|adjust|target|container|viewport)|style|content|show\.ready/i,fa=/^prerender|show\.ready/i;z.set=function(a,b){if(this.destroyed)return this;var c,e=this.rendered,f=E,g=this.options;return"string"==typeof a?(c=a,a={},a[c]=b):a=d.extend({},a),d.each(a,function(b,c){if(e&&fa.test(b))delete a[b];else{var h,j=i(g,b.toLowerCase());h=j[0][j[1]],j[0][j[1]]=c&&c.nodeType?d(c):c,f=ea.test(b)||f,a[b]=[j[0],j[1],c,h]}}),h(g),this.positioning=D,d.each(a,d.proxy(j,this)),this.positioning=E,this.rendered&&this.tooltip[0].offsetWidth>0&&f&&this.reposition("mouse"===g.position.target?F:this.cache.event),this},z._update=function(a,b){var c=this,e=this.cache;return this.rendered&&a?(d.isFunction(a)&&(a=a.call(this.elements.target,e.event,this)||""),d.isFunction(a.then)?(e.waiting=D,a.then(function(a){return e.waiting=E,c._update(a,b)},F,function(a){return c._update(a,b)})):a===E||!a&&""!==a?E:(a.jquery&&a.length>0?b.empty().append(a.css({display:"block",visibility:"visible"})):b.html(a),this._waitForContent(b).then(function(a){c.rendered&&c.tooltip[0].offsetWidth>0&&c.reposition(e.event,!a.length)}))):E},z._waitForContent=function(a){var b=this.cache;return b.waiting=D,(d.fn.imagesLoaded?a.imagesLoaded():(new d.Deferred).resolve([])).done(function(){b.waiting=E}).promise()},z._updateContent=function(a,b){this._update(a,this.elements.content,b)},z._updateTitle=function(a,b){this._update(a,this.elements.title,b)===E&&this._removeTitle(E)},z._createTitle=function(){var a=this.elements,b=this._id+"-title";a.titlebar&&this._removeTitle(),a.titlebar=d("<div />",{class:S+"-titlebar "+(this.options.style.widget?k("header"):"")}).append(a.title=d("<div />",{id:b,class:S+"-title","aria-atomic":D})).insertBefore(a.content).delegate(".qtip-close","mousedown keydown mouseup keyup mouseout",function(a){d(this).toggleClass("ui-state-active ui-state-focus","down"===a.type.substr(-4))}).delegate(".qtip-close","mouseover mouseout",function(a){d(this).toggleClass("ui-state-hover","mouseover"===a.type)}),this.options.content.button&&this._createButton()},z._removeTitle=function(a){var b=this.elements;b.title&&(b.titlebar.remove(),b.titlebar=b.title=b.button=F,a!==E&&this.reposition())},z._createPosClass=function(a){return S+"-pos-"+(a||this.options.position.my).abbrev()},z.reposition=function(c,e){if(!this.rendered||this.positioning||this.destroyed)return this;this.positioning=D;var f,g,h,i,j=this.cache,k=this.tooltip,l=this.options.position,m=l.target,n=l.my,o=l.at,p=l.viewport,q=l.container,r=l.adjust,s=r.method.split(" "),t=k.outerWidth(E),u=k.outerHeight(E),v=0,w=0,x=k.css("position"),y={left:0,top:0},z=k[0].offsetWidth>0,A=c&&"scroll"===c.type,B=d(a),C=q[0].ownerDocument,F=this.mouse;if(d.isArray(m)&&2===m.length)o={x:L,y:K},y={left:m[0],top:m[1]};else if("mouse"===m)o={x:L,y:K},(!r.mouse||this.options.hide.distance)&&j.origin&&j.origin.pageX?c=j.origin:!c||c&&("resize"===c.type||"scroll"===c.type)?c=j.event:F&&F.pageX&&(c=F),"static"!==x&&(y=q.offset()),C.body.offsetWidth!==(a.innerWidth||C.documentElement.clientWidth)&&(g=d(b.body).offset()),y={left:c.pageX-y.left+(g&&g.left||0),top:c.pageY-y.top+(g&&g.top||0)},r.mouse&&A&&F&&(y.left-=(F.scrollX||0)-B.scrollLeft(),y.top-=(F.scrollY||0)-B.scrollTop());else{if("event"===m?c&&c.target&&"scroll"!==c.type&&"resize"!==c.type?j.target=d(c.target):c.target||(j.target=this.elements.target):"event"!==m&&(j.target=d(m.jquery?m:this.elements.target)),m=j.target,0===(m=d(m).eq(0)).length)return this;m[0]===b||m[0]===a?(v=da_iOS?a.innerWidth:m.width(),w=da_iOS?a.innerHeight:m.height(),m[0]===a&&(y={top:(p||m).scrollTop(),left:(p||m).scrollLeft()})):R.imagemap&&m.is("area")?f=R.imagemap(this,m,o,R.viewport?s:E):R.svg&&m&&m[0].ownerSVGElement?f=R.svg(this,m,o,R.viewport?s:E):(v=m.outerWidth(E),w=m.outerHeight(E),y=m.offset()),f&&(v=f.width,w=f.height,g=f.offset,y=f.position),y=this.reposition.offset(m,y,q),(da_iOS>3.1&&da_iOS<4.1||da_iOS>=4.3&&da_iOS<4.33||!da_iOS&&"fixed"===x)&&(y.left-=B.scrollLeft(),y.top-=B.scrollTop()),(!f||f&&f.adjustable!==E)&&(y.left+=o.x===N?v:o.x===O?v/2:0,y.top+=o.y===M?w:o.y===O?w/2:0)}return y.left+=r.x+(n.x===N?-t:n.x===O?-t/2:0),y.top+=r.y+(n.y===M?-u:n.y===O?-u/2:0),R.viewport?(h=y.adjusted=R.viewport(this,y,l,v,w,t,u),g&&h.left&&(y.left+=g.left),g&&h.top&&(y.top+=g.top),h.my&&(this.position.my=h.my)):y.adjusted={left:0,top:0},j.posClass!==(i=this._createPosClass(this.position.my))&&(j.posClass=i,k.removeClass(j.posClass).addClass(i)),this._trigger("move",[y,p.elem||p],c)?(delete y.adjusted,e===E||!z||isNaN(y.left)||isNaN(y.top)||"mouse"===m||!d.isFunction(l.effect)?k.css(y):d.isFunction(l.effect)&&(l.effect.call(k,this,d.extend({},y)),k.queue(function(a){d(this).css({opacity:"",height:""}),da_ie&&this.style.removeAttribute("filter"),a()})),this.positioning=E,this):this},z.reposition.offset=function(a,c,e){function f(a,b){c.left+=b*a.scrollLeft(),c.top+=b*a.scrollTop()}if(!e[0])return c;var g,h,i,j,k=d(a[0].ownerDocument),l=!!da_ie&&"CSS1Compat"!==b.compatMode,m=e[0];do{"static"!==(h=d.css(m,"position"))&&("fixed"===h?(i=m.getBoundingClientRect(),f(k,-1)):(i=d(m).position(),i.left+=parseFloat(d.css(m,"borderLeftWidth"))||0,i.top+=parseFloat(d.css(m,"borderTopWidth"))||0),c.left-=i.left+(parseFloat(d.css(m,"marginLeft"))||0),c.top-=i.top+(parseFloat(d.css(m,"marginTop"))||0),g||"hidden"===(j=d.css(m,"overflow"))||"visible"===j||(g=d(m)))}while(m=m.offsetParent);return g&&(g[0]!==k[0]||l)&&f(g,1),c};var ga=(A=z.reposition.Corner=function(a,b){a=(""+a).replace(/([A-Z])/," $1").replace(/middle/gi,O).toLowerCase(),this.x=(a.match(/left|right/i)||a.match(/center/)||["inherit"])[0].toLowerCase(),this.y=(a.match(/top|bottom|center/i)||["inherit"])[0].toLowerCase(),this.forceY=!!b;var c=a.charAt(0);this.precedance="t"===c||"b"===c?H:G}).prototype;ga.invert=function(a,b){this[a]=this[a]===L?N:this[a]===N?L:b||this[a]},ga.string=function(a){var b=this.x,c=this.y,d=b!==c?"center"===b||"center"!==c&&(this.precedance===H||this.forceY)?[c,b]:[b,c]:[b];return!1!==a?d.join(" "):d},ga.abbrev=function(){var a=this.string(!1);return a[0].charAt(0)+(a[1]&&a[1].charAt(0)||"")},ga.clone=function(){return new A(this.string(),this.forceY)},z.toggle=function(a,c){var e=this.cache,f=this.options,g=this.tooltip;if(c){if(/over|enter/.test(c.type)&&e.event&&/out|leave/.test(e.event.type)&&f.show.target.add(c.target).length===f.show.target.length&&g.has(c.relatedTarget).length)return this;e.event=d.event.fix(c)}if(this.waiting&&!a&&(this.hiddenDuringWait=D),!this.rendered)return a?this.render(1):this;if(this.destroyed||this.disabled)return this;var h,i,j,k=a?"show":"hide",l=this.options[k],m=this.options.position,n=this.options.content,o=this.tooltip.css("width"),p=this.tooltip.is(":visible"),q=a||1===l.target.length,r=!c||l.target.length<2||e.target[0]===c.target;return(typeof a).search("boolean|number")&&(a=!p),h=!g.is(":animated")&&p===a&&r,i=h?F:!!this._trigger(k,[90]),this.destroyed?this:(i!==E&&a&&this.focus(c),!i||h?this:(d.attr(g[0],"aria-hidden",!a),a?(this.mouse&&(e.origin=d.event.fix(this.mouse)),d.isFunction(n.text)&&this._updateContent(n.text,E),d.isFunction(n.title)&&this._updateTitle(n.title,E),!C&&"mouse"===m.target&&m.adjust.mouse&&(d(b).bind("mousemove."+S,this._storeMouse),C=D),o||g.css("width",g.outerWidth(E)),this.reposition(c,arguments[2]),o||g.css("width",""),l.solo&&("string"==typeof l.solo?d(l.solo):d(W,l.solo)).not(g).not(l.target).qtip("hide",new d.Event("tooltipsolo"))):(clearTimeout(this.timers.show),delete e.origin,C&&!d(W+'[tracking="true"]:visible',l.solo).not(g).length&&(d(b).unbind("mousemove."+S),C=E),this.blur(c)),j=d.proxy(function(){a?(da_ie&&g[0].style.removeAttribute("filter"),g.css("overflow",""),"string"==typeof l.autofocus&&d(this.options.show.autofocus,g).focus(),this.options.show.target.trigger("qtip-"+this.id+"-inactive")):g.css({display:"",visibility:"",opacity:"",left:"",top:""}),this._trigger(a?"visible":"hidden")},this),l.effect===E||q===E?(g[k](),j()):d.isFunction(l.effect)?(g.stop(1,1),l.effect.call(g,this),g.queue("fx",function(a){j(),a()})):g.fadeTo(90,a?1:0,j),a&&l.target.trigger("qtip-"+this.id+"-inactive"),this))},z.show=function(a){return this.toggle(D,a)},z.hide=function(a){return this.toggle(E,a)},z.focus=function(a){if(!this.rendered||this.destroyed)return this;var b=d(W),c=this.tooltip,e=parseInt(c[0].style.zIndex,10),f=y.zindex+b.length;return c.hasClass($)||this._trigger("focus",[f],a)&&(e!==f&&(b.each(function(){this.style.zIndex>e&&(this.style.zIndex=this.style.zIndex-1)}),b.filter("."+$).qtip("blur",a)),c.addClass($)[0].style.zIndex=f),this},z.blur=function(a){return!this.rendered||this.destroyed?this:(this.tooltip.removeClass($),this._trigger("blur",[this.tooltip.css("zIndex")],a),this)},z.disable=function(a){return this.destroyed?this:("toggle"===a?a=!(this.rendered?this.tooltip.hasClass(aa):this.disabled):"boolean"!=typeof a&&(a=D),this.rendered&&this.tooltip.toggleClass(aa,a).attr("aria-disabled",a),this.disabled=!!a,this)},z.enable=function(){return this.disable(E)},z._createButton=function(){var a=this,b=this.elements,c=b.tooltip,e=this.options.content.button,g="string"==typeof e?e:"Close tooltip";b.button&&b.button.remove(),e.jquery?b.button=e:b.button=d("<a />",{class:"qtip-close "+(this.options.style.widget?"":S+"-icon"),title:g,"aria-label":g}).prepend(d("<span />",{class:"ui-icon ui-icon-close",html:"&times;"})),b.button.appendTo(b.titlebar||c).attr("role","button").click(function(b){return c.hasClass(aa)||a.hide(b),E})},z._updateButton=function(a){if(!this.rendered)return E;var b=this.elements.button;a?this._createButton():b.remove()},z._setWidget=function(){var a=this.options.style.widget,b=this.elements,c=b.tooltip,d=c.hasClass(aa);c.removeClass(aa),aa=a?"ui-state-disabled":"qtip-disabled",c.toggleClass(aa,d),c.toggleClass("ui-helper-reset "+k(),a).toggleClass(Z,this.options.style.def&&!a),b.content&&b.content.toggleClass(k("content"),a),b.titlebar&&b.titlebar.toggleClass(k("header"),a),b.button&&b.button.toggleClass(S+"-icon",!a)},z._storeMouse=function(a){return(this.mouse=d.event.fix(a)).type="mousemove",this},z._bind=function(a,b,c,e,f){if(a&&c&&b.length){var g="."+this._id+(e?"-"+e:"");return d(a).bind((b.split?b:b.join(g+" "))+g,d.proxy(c,f||this)),this}},z._unbind=function(a,b){return a&&d(a).unbind("."+this._id+(b?"-"+b:"")),this},z._trigger=function(a,b,c){var e=new d.Event("tooltip"+a);return e.originalEvent=c&&d.extend({},c)||this.cache.event||F,this.triggering=a,this.tooltip.trigger(e,[this].concat(b||[])),this.triggering=E,!e.isDefaultPrevented()},z._bindEvents=function(a,b,c,e,f,g){var h=c.filter(e).add(e.filter(c)),i=[];h.length&&(d.each(b,function(b,c){var e=d.inArray(c,a);e>-1&&i.push(a.splice(e,1)[0])}),i.length&&(this._bind(h,i,function(a){(!!this.rendered&&this.tooltip[0].offsetWidth>0?g:f).call(this,a)}),c=c.not(h),e=e.not(h))),this._bind(c,a,f),this._bind(e,b,g)},z._assignInitialEvents=function(a){function b(a){return this.disabled||this.destroyed?E:(this.cache.event=a&&d.event.fix(a),this.cache.target=a&&d(a.target),clearTimeout(this.timers.show),void(this.timers.show=l.call(this,function(){this.render("object"==typeof a||c.show.ready)},c.prerender?0:c.show.delay)))}var c=this.options,e=c.show.target,f=c.hide.target,g=c.show.event?d.trim(""+c.show.event).split(" "):[],h=c.hide.event?d.trim(""+c.hide.event).split(" "):[];this._bind(this.elements.target,["remove","removeqtip"],function(){this.destroy(!0)},"destroy"),/mouse(over|enter)/i.test(c.show.event)&&!/mouse(out|leave)/i.test(c.hide.event)&&h.push("mouseleave"),this._bind(e,"mousemove",function(a){this._storeMouse(a),this.cache.onTarget=D}),this._bindEvents(g,h,e,f,b,function(){return this.timers?void clearTimeout(this.timers.show):E}),(c.show.ready||c.prerender)&&b.call(this,a)},z._assignEvents=function(){var c=this,e=this.options,f=e.position,g=this.tooltip,h=e.show.target,i=e.hide.target,j=f.container,k=f.viewport,l=d(b),q=d(a),r=e.show.event?d.trim(""+e.show.event).split(" "):[],s=e.hide.event?d.trim(""+e.hide.event).split(" "):[];d.each(e.events,function(a,b){c._bind(g,"toggle"===a?["tooltipshow","tooltiphide"]:["tooltip"+a],b,null,g)}),/mouse(out|leave)/i.test(e.hide.event)&&"window"===e.hide.leave&&this._bind(l,["mouseout","blur"],function(a){/select|option/.test(a.target.nodeName)||a.relatedTarget||this.hide(a)}),e.hide.fixed?i=i.add(g.addClass(Y)):/mouse(over|enter)/i.test(e.show.event)&&this._bind(i,"mouseleave",function(){clearTimeout(this.timers.show)}),(""+e.hide.event).indexOf("unfocus")>-1&&this._bind(j.closest("html"),["mousedown","touchstart"],function(a){var b=d(a.target),c=this.rendered&&!this.tooltip.hasClass(aa)&&this.tooltip[0].offsetWidth>0,e=b.parents(W).filter(this.tooltip[0]).length>0;b[0]===this.target[0]||b[0]===this.tooltip[0]||e||this.target.has(b[0]).length||!c||this.hide(a)}),"number"==typeof e.hide.inactive&&(this._bind(h,"qtip-"+this.id+"-inactive",o,"inactive"),this._bind(i.add(g),y.inactiveEvents,o)),this._bindEvents(r,s,h,i,m,n),this._bind(h.add(g),"mousemove",function(a){if("number"==typeof e.hide.distance){var b=this.cache.origin||{},c=this.options.hide.distance,d=Math.abs;(d(a.pageX-b.pageX)>=c||d(a.pageY-b.pageY)>=c)&&this.hide(a)}this._storeMouse(a)}),"mouse"===f.target&&f.adjust.mouse&&(e.hide.event&&this._bind(h,["mouseenter","mouseleave"],function(a){return this.cache?void(this.cache.onTarget="mouseenter"===a.type):E}),this._bind(l,"mousemove",function(a){this.rendered&&this.cache.onTarget&&!this.tooltip.hasClass(aa)&&this.tooltip[0].offsetWidth>0&&this.reposition(a)})),(f.adjust.resize||k.length)&&this._bind(d.event.special.resize?k:q,"resize",p),f.adjust.scroll&&this._bind(q.add(f.container),"scroll",p)},z._unassignEvents=function(){var c=this.options,e=c.show.target,f=c.hide.target,g=d.grep([this.elements.target[0],this.rendered&&this.tooltip[0],c.position.container[0],c.position.viewport[0],c.position.container.closest("html")[0],a,b],function(a){return"object"==typeof a});e&&e.toArray&&(g=g.concat(e.toArray())),f&&f.toArray&&(g=g.concat(f.toArray())),this._unbind(g)._unbind(g,"destroy")._unbind(g,"inactive")},d(function(){q(W,["mouseenter","mouseleave"],function(a){var b="mouseenter"===a.type,c=d(a.currentTarget),e=d(a.relatedTarget||a.target),f=this.options;b?(this.focus(a),c.hasClass(Y)&&!c.hasClass(aa)&&clearTimeout(this.timers.hide)):"mouse"===f.position.target&&f.position.adjust.mouse&&f.hide.event&&f.show.target&&!e.closest(f.show.target[0]).length&&this.hide(a),c.toggleClass(_,b)}),q("["+U+"]",X,o)}),y=d.fn.qtip=function(a,b,e){var f=(""+a).toLowerCase(),g=F,i=d.makeArray(arguments).slice(1),j=i[i.length-1],k=this[0]?d.data(this[0],S):F;return!arguments.length&&k||"api"===f?k:"string"==typeof a?(this.each(function(){var a=d.data(this,S);if(!a)return D;if(j&&j.timeStamp&&(a.cache.event=j),!b||"option"!==f&&"options"!==f)a[f]&&a[f].apply(a,i);else{if(e===c&&!d.isPlainObject(b))return g=a.get(b),E;a.set(b,e)}}),g!==F?g:this):"object"!=typeof a&&arguments.length?void 0:(k=h(d.extend(D,{},a)),this.each(function(a){var b,c;return c=d.isArray(k.id)?k.id[a]:k.id,c=!c||c===E||c.length<1||y.api[c]?y.nextid++:c,(b=r(d(this),c,k))===E?D:(y.api[c]=b,d.each(R,function(){"initialize"===this.initialize&&this(b)}),void b._assignInitialEvents(j))}))},d.qtip=e,y.api={},d.each({attr:function(a,b){if(this.length){var c=this[0],e="title",f=d.data(c,"qtip");if(a===e&&f&&f.options&&"object"==typeof f&&"object"==typeof f.options&&f.options.suppress)return arguments.length<2?d.attr(c,ca):(f&&f.options.content.attr===e&&f.cache.attr&&f.set("content.text",b),this.attr(ca,b))}return d.fn["attr"+ba].apply(this,arguments)},clone:function(a){var b=d.fn["clone"+ba].apply(this,arguments);return a||b.filter("["+ca+"]").attr("title",function(){return d.attr(this,ca)}).removeAttr(ca),b}},function(a,b){if(!b||d.fn[a+ba])return D;var c=d.fn[a+ba]=d.fn[a];d.fn[a]=function(){return b.apply(this,arguments)||c.apply(this,arguments)}}),d.ui||(d["cleanData"+ba]=d.cleanData,d.cleanData=function(a){for(var b,c=0;(b=d(a[c])).length;c++)if(b.attr(T))try{b.triggerHandler("removeqtip")}catch(e){}d["cleanData"+ba].apply(this,arguments)}),y.version="3.0.3",y.nextid=0,y.inactiveEvents=X,y.zindex=15e3,y.defaults={prerender:E,id:E,overwrite:D,suppress:D,content:{text:D,attr:"title",title:E,button:E},position:{my:"top left",at:"bottom right",target:E,container:E,viewport:E,adjust:{x:0,y:0,mouse:D,scroll:D,resize:D,method:"flipinvert flipinvert"},effect:function(a,b){d(this).animate(b,{duration:200,queue:E})}},show:{target:E,event:"mouseenter",effect:D,delay:90,solo:E,ready:E,autofocus:E},hide:{target:E,event:"mouseleave",effect:D,delay:0,fixed:E,inactive:E,leave:"window",distance:E},style:{classes:"",widget:E,width:E,height:E,def:D},events:{render:F,move:F,show:F,hide:F,toggle:F,visible:F,hidden:F,focus:F,blur:F}};var ha,ia,ja,ka,la,ma="margin",na="border",oa="color",pa="background-color",qa="transparent",ra=" !important",sa=!!b.createElement("canvas").getContext,ta=/rgba?\(0, 0, 0(, 0)?\)|transparent|#123456/i,ua={},va=["Webkit","O","Moz","ms"];sa?(ka=a.devicePixelRatio||1,la=function(){var a=b.createElement("canvas").getContext("2d");return a.backingStorePixelRatio||a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||1}(),ja=ka/la):ia=function(a,b,c){return"<qtipvml:"+a+' xmlns="urn:schemas-microsoft.com:vml" class="qtip-vml" '+(b||"")+' style="behavior: url(#default#VML); '+(c||"")+'" />'},d.extend(v.prototype,{init:function(a){var b,c;c=this.element=a.elements.tip=d("<div />",{class:S+"-tip"}).prependTo(a.tooltip),sa?(b=d("<canvas />").appendTo(this.element)[0].getContext("2d"),b.lineJoin="miter",b.miterLimit=1e5,b.save()):(b=ia("shape",'coordorigin="0,0"',"position:absolute;"),this.element.html(b+b),a._bind(d("*",c).add(c),["click","mousedown"],function(a){a.stopPropagation()},this._ns)),a._bind(a.tooltip,"tooltipmove",this.reposition,this._ns,this),this.create()},_swapDimensions:function(){this.size[0]=this.options.height,this.size[1]=this.options.width},_resetDimensions:function(){this.size[0]=this.options.width,this.size[1]=this.options.height},_useTitle:function(a){var b=this.qtip.elements.titlebar;return b&&(a.y===K||a.y===O&&this.element.position().top+this.size[1]/2+this.options.offset<b.outerHeight(D))},_parseCorner:function(a){var b=this.qtip.options.position.my;return a===E||b===E?a=E:a===D?a=new A(b.string()):a.string||(a=new A(a),a.fixed=D),a},_parseWidth:function(a,b,c){var d=this.qtip.elements,e=na+s(b)+"Width";return(c?u(c,e):u(d.content,e)||u(this._useTitle(a)&&d.titlebar||d.content,e)||u(d.tooltip,e))||0},_parseRadius:function(a){var b=this.qtip.elements,c=na+s(a.y)+s(a.x)+"Radius";return da_ie<9?0:u(this._useTitle(a)&&b.titlebar||b.content,c)||u(b.tooltip,c)||0},_invalidColour:function(a,b,c){var d=a.css(b);return!d||c&&d===a.css(c)||ta.test(d)?E:d},_parseColours:function(a){var b=this.qtip.elements,c=this.element.css("cssText",""),e=na+s(a[a.precedance])+s(oa),f=this._useTitle(a)&&b.titlebar||b.content,g=this._invalidColour,h=[];return h[0]=g(c,pa)||g(f,pa)||g(b.content,pa)||g(b.tooltip,pa)||c.css(pa),h[1]=g(c,e,oa)||g(f,e,oa)||g(b.content,e,oa)||g(b.tooltip,e,oa)||b.tooltip.css(e),d("*",c).add(c).css("cssText",pa+":"+qa+ra+";"+na+":0"+ra+";"),h},_calculateSize:function(a){var b,c,d,e=a.precedance===H,f=this.options.width,g=this.options.height,h="c"===a.abbrev(),i=(e?f:g)*(h?.5:1),j=Math.pow,k=Math.round,l=Math.sqrt(j(i,2)+j(g,2)),m=[this.border/i*l,this.border/g*l];return m[2]=Math.sqrt(j(m[0],2)-j(this.border,2)),m[3]=Math.sqrt(j(m[1],2)-j(this.border,2)),b=l+m[2]+m[3]+(h?0:m[0]),c=b/l,d=[k(c*f),k(c*g)],e?d:d.reverse()},_calculateTip:function(a,b,c){c=c||1;var d=(b=b||this.size)[0]*c,e=b[1]*c,f=Math.ceil(d/2),g=Math.ceil(e/2),h={br:[0,0,d,e,d,0],bl:[0,0,d,0,0,e],tr:[0,e,d,0,d,e],tl:[0,0,0,e,d,e],tc:[0,e,f,0,d,e],bc:[0,0,d,0,f,e],rc:[0,0,d,g,0,e],lc:[d,0,d,e,0,g]};return h.lt=h.br,h.rt=h.bl,h.lb=h.tr,h.rb=h.tl,h[a.abbrev()]},_drawCoords:function(a,b){a.beginPath(),a.moveTo(b[0],b[1]),a.lineTo(b[2],b[3]),a.lineTo(b[4],b[5]),a.closePath()},create:function(){var a=this.corner=(sa||da_ie)&&this._parseCorner(this.options.corner);return this.enabled=!!this.corner&&"c"!==this.corner.abbrev(),this.enabled&&(this.qtip.cache.corner=a.clone(),this.update()),this.element.toggle(this.enabled),this.corner},update:function(b,c){if(!this.enabled)return this;var e,f,g,h,i,j,k,l,m=this.qtip.elements,n=this.element,o=n.children(),p=this.options,q=this.size,r=p.mimic,s=Math.round;b||(b=this.qtip.cache.corner||this.corner),r===E?r=b:(r=new A(r),r.precedance=b.precedance,"inherit"===r.x?r.x=b.x:"inherit"===r.y?r.y=b.y:r.x===r.y&&(r[b.precedance]=b[b.precedance])),f=r.precedance,b.precedance===G?this._swapDimensions():this._resetDimensions(),(e=this.color=this._parseColours(b))[1]!==qa?(l=this.border=this._parseWidth(b,b[b.precedance]),p.border&&1>l&&!ta.test(e[1])&&(e[0]=e[1]),this.border=l=p.border!==D?p.border:l):this.border=l=0,k=this.size=this._calculateSize(b),n.css({width:k[0],height:k[1],lineHeight:k[1]+"px"}),j=b.precedance===H?[s(r.x===L?l:r.x===N?k[0]-q[0]-l:(k[0]-q[0])/2),s(r.y===K?k[1]-q[1]:0)]:[s(r.x===L?k[0]-q[0]:0),s(r.y===K?l:r.y===M?k[1]-q[1]-l:(k[1]-q[1])/2)],sa?((g=o[0].getContext("2d")).restore(),g.save(),g.clearRect(0,0,6e3,6e3),h=this._calculateTip(r,q,ja),i=this._calculateTip(r,this.size,ja),o.attr(I,k[0]*ja).attr(J,k[1]*ja),o.css(I,k[0]).css(J,k[1]),this._drawCoords(g,i),g.fillStyle=e[1],g.fill(),g.translate(j[0]*ja,j[1]*ja),this._drawCoords(g,h),g.fillStyle=e[0],g.fill()):(h=this._calculateTip(r),h="m"+h[0]+","+h[1]+" l"+h[2]+","+h[3]+" "+h[4]+","+h[5]+" xe",j[2]=l&&/^(r|b)/i.test(b.string())?8===da_ie?2:1:0,o.css({coordsize:k[0]+l+" "+k[1]+l,antialias:""+(r.string().indexOf(O)>-1),left:j[0]-j[2]*Number(f===G),top:j[1]-j[2]*Number(f===H),width:k[0]+l,height:k[1]+l}).each(function(a){var b=d(this);b[b.prop?"prop":"attr"]({coordsize:k[0]+l+" "+k[1]+l,path:h,fillcolor:e[0],filled:!!a,stroked:!a}).toggle(!(!l&&!a)),!a&&b.html(ia("stroke",'weight="'+2*l+'px" color="'+e[1]+'" miterlimit="1000" joinstyle="miter"'))})),a.opera&&setTimeout(function(){m.tip.css({display:"inline-block",visibility:"visible"})},1),c!==E&&this.calculate(b,k)},calculate:function(a,b){if(!this.enabled)return E;var c,e,f=this,g=this.qtip.elements,h=this.element,i=this.options.offset,j={};return a=a||this.corner,c=a.precedance,b=b||this._calculateSize(a),e=[a.x,a.y],c===G&&e.reverse(),d.each(e,function(d,e){var h,k,l;e===O?(h=c===H?L:K,j[h]="50%",j[ma+"-"+h]=-Math.round(b[c===H?0:1]/2)+i):(h=f._parseWidth(a,e,g.tooltip),k=f._parseWidth(a,e,g.content),l=f._parseRadius(a),j[e]=Math.max(-f.border,d?k:i+(l>h?l:-h)))}),j[a[c]]-=b[c===G?0:1],h.css({margin:"",top:"",bottom:"",left:"",right:""}).css(j),j},reposition:function(a,b,d){function e(a,b,c,d,e){a===Q&&j.precedance===b&&k[d]&&j[c]!==O?j.precedance=j.precedance===G?H:G:a!==Q&&k[d]&&(j[b]=j[b]===O?k[d]>0?d:e:j[b]===d?e:d)}function f(a,b,e){j[a]===O?p[ma+"-"+b]=o[a]=g[ma+"-"+b]-k[b]:(h=g[e]!==c?[k[b],-g[b]]:[-k[b],g[b]],(o[a]=Math.max(h[0],h[1]))>h[0]&&(d[b]-=k[b],o[b]=E),p[g[e]!==c?e:b]=o[a])}if(this.enabled){var g,h,i=b.cache,j=this.corner.clone(),k=d.adjusted,l=b.options.position.adjust.method.split(" "),m=l[0],n=l[1]||l[0],o={left:E,top:E,x:0,y:0},p={};this.corner.fixed!==D&&(e(m,G,H,L,N),e(n,H,G,K,M),j.string()===i.corner.string()&&i.cornerTop===k.top&&i.cornerLeft===k.left||this.update(j,E)),(g=this.calculate(j)).right!==c&&(g.left=-g.right),g.bottom!==c&&(g.top=-g.bottom),g.user=this.offset,o.left=m===Q&&!!k.left,o.left&&f(G,L,N),o.top=n===Q&&!!k.top,o.top&&f(H,K,M),this.element.css(p).toggle(!(o.x&&o.y||j.x===O&&o.y||j.y===O&&o.x)),d.left-=g.left.charAt?g.user:m!==Q||o.top||!o.left&&!o.top?g.left+this.border:0,d.top-=g.top.charAt?g.user:n!==Q||o.left||!o.left&&!o.top?g.top+this.border:0,i.cornerLeft=k.left,i.cornerTop=k.top,i.corner=j.clone()}},destroy:function(){this.qtip._unbind(this.qtip.tooltip,this._ns),this.qtip.elements.tip&&this.qtip.elements.tip.find("*").remove().end().remove()}}),(ha=R.tip=function(a){return new v(a,a.options.style.tip)}).initialize="render",ha.sanitize=function(a){if(a.style&&"tip"in a.style){var b=a.style.tip;"object"!=typeof b&&(b=a.style.tip={corner:b}),/string|boolean/i.test(typeof b.corner)||(b.corner=D)}},B.tip={"^position.my|style.tip.(corner|mimic|border)$":function(){this.create(),this.qtip.reposition()},"^style.tip.(height|width)$":function(a){this.size=[a.width,a.height],this.update(),this.qtip.reposition()},"^content.title|style.(classes|widget)$":function(){this.update()}},d.extend(D,y.defaults,{style:{tip:{corner:D,mimic:E,width:6,height:6,border:D,offset:0}}});var wa,xa,ya="qtip-modal",za="."+ya;xa=new(xa=function(){function c(a){j.length<1&&a.length?a.not("body").blur():j.first().focus()}function e(a){if(h.is(":visible")){var e=d(a.target),g=f.tooltip,i=e.closest(W);(i.length<1?E:parseInt(i[0].style.zIndex,10)>parseInt(g[0].style.zIndex,10))||e.closest(W)[0]===g[0]||c(e)}}var f,g,h,i=this,j={};d.extend(i,{init:function(){return h=i.elem=d("<div />",{id:"qtip-overlay",html:"<div></div>",mousedown:function(){return E}}).hide(),d(b.body).bind("focusin"+za,e),d(b).bind("keydown"+za,function(a){f&&f.options.show.modal.escape&&27===a.keyCode&&f.hide(a)}),h.bind("click"+za,function(a){f&&f.options.show.modal.blur&&f.hide(a)}),i},update:function(b){f=b,j=b.options.show.modal.stealfocus!==E?b.tooltip.find("*").filter(function(){return function(a){if(d.expr[":"].focusable)return d.expr[":"].focusable;var b,c,e,f=!isNaN(d.attr(a,"tabindex")),g=a.nodeName&&a.nodeName.toLowerCase();return"area"===g?(b=a.parentNode,c=b.name,!(!a.href||!c||"map"!==b.nodeName.toLowerCase())&&!!(e=d("img[usemap=#"+c+"]")[0])&&e.is(":visible")):/input|select|textarea|button|object/.test(g)?!a.disabled:"a"===g?a.href||f:f}(this)}):[]},toggle:function(a,e,j){var k=a.tooltip,l=a.options.show.modal,m=l.effect,n=e?"show":"hide",o=h.is(":visible"),p=d(za).filter(":visible:not(:animated)").not(k);return i.update(a),e&&l.stealfocus!==E&&c(d(":focus")),h.toggleClass("blurs",l.blur),e&&h.appendTo(b.body),h.is(":animated")&&o===e&&g!==E||!e&&p.length?i:(h.stop(D,E),d.isFunction(m)?m.call(h,e):m===E?h[n]():h.fadeTo(parseInt(j,10)||90,e?1:0,function(){e||h.hide()}),e||h.queue(function(a){h.css({left:"",top:""}),d(za).length||h.detach(),a()}),g=e,f.destroyed&&(f=F),i)}}),i.init()}),d.extend(w.prototype,{init:function(a){var b=a.tooltip;return this.options.on?(a.elements.overlay=xa.elem,b.addClass(ya).css("z-index",y.modal_zindex+d(za).length),a._bind(b,["tooltipshow","tooltiphide"],function(a,c,e){var f=a.originalEvent;if(a.target===b[0])if(f&&"tooltiphide"===a.type&&/mouse(leave|enter)/.test(f.type)&&d(f.relatedTarget).closest(xa.elem[0]).length)try{a.preventDefault()}catch(g){}else(!f||f&&"tooltipsolo"!==f.type)&&this.toggle(a,"tooltipshow"===a.type,e)},this._ns,this),a._bind(b,"tooltipfocus",function(a,c){if(!a.isDefaultPrevented()&&a.target===b[0]){var e=d(za),f=y.modal_zindex+e.length,g=parseInt(b[0].style.zIndex,10);xa.elem[0].style.zIndex=f-1,e.each(function(){this.style.zIndex>g&&(this.style.zIndex-=1)}),e.filter("."+$).qtip("blur",a.originalEvent),b.addClass($)[0].style.zIndex=f,xa.update(c);try{a.preventDefault()}catch(h){}}},this._ns,this),void a._bind(b,"tooltiphide",function(a){a.target===b[0]&&d(za).filter(":visible").not(b).last().qtip("focus",a)},this._ns,this)):this},toggle:function(a,b,c){return a&&a.isDefaultPrevented()?this:void xa.toggle(this.qtip,!!b,c)},destroy:function(){this.qtip.tooltip.removeClass(ya),this.qtip._unbind(this.qtip.tooltip,this._ns),xa.toggle(this.qtip,E),delete this.qtip.elements.overlay}}),(wa=R.modal=function(a){return new w(a,a.options.show.modal)}).sanitize=function(a){a.show&&("object"!=typeof a.show.modal?a.show.modal={on:!!a.show.modal}:void 0===a.show.modal.on&&(a.show.modal.on=D))},y.modal_zindex=y.zindex-200,wa.initialize="render",B.modal={"^show.modal.(on|blur)$":function(){this.destroy(),this.init(),this.qtip.elems.overlay.toggle(this.qtip.tooltip[0].offsetWidth>0)}},d.extend(D,y.defaults,{show:{modal:{on:E,effect:D,blur:D,stealfocus:D,escape:D}}}),R.viewport=function(c,d,e,f,g,h,i){function j(a,b,c,e,f,g,h,i,j){var k=d[f],s=u[a],t=v[a],w=c===Q,x=s===f?j:s===g?-j:-j/2,y=t===f?i:t===g?-i:-i/2,z=q[f]+r[f]-(n?0:m[f]),A=z-k,B=k+j-(h===I?o:p)-z,C=x-(u.precedance===a||s===u[b]?y:0)-(t===O?i/2:0);return w?(C=(s===f?1:-1)*x,d[f]+=A>0?A:B>0?-B:0,d[f]=Math.max(-m[f]+r[f],k-C,Math.min(Math.max(-m[f]+r[f]+(h===I?o:p),k+C),d[f],"center"===s?k-x:1e9))):(e*=c===P?2:0,A>0&&(s!==f||B>0)?(d[f]-=C+e,l.invert(a,f)):B>0&&(s!==g||A>0)&&(d[f]-=(s===O?-C:C)+e,l.invert(a,g)),d[f]<q[f]&&-d[f]>B&&(d[f]=k,l=u.clone())),d[f]-k}var k,l,m,n,o,p,q,r,s=e.target,t=c.elements.tooltip,u=e.my,v=e.at,w=e.adjust,x=w.method.split(" "),y=x[0],z=x[1]||x[0],A=e.viewport,B=e.container,C={left:0,top:0};return A.jquery&&s[0]!==a&&s[0]!==b.body&&"none"!==w.method?(m=B.offset()||C,n="static"===B.css("position"),k="fixed"===t.css("position"),o=A[0]===a?A.width():A.outerWidth(E),p=A[0]===a?A.height():A.outerHeight(E),q={left:k?0:A.scrollLeft(),top:k?0:A.scrollTop()},r=A.offset()||C,"shift"===y&&"shift"===z||(l=u.clone()),C={left:"none"!==y?j(G,H,y,w.x,L,N,I,f,h):0,top:"none"!==z?j(H,G,z,w.y,K,M,J,g,i):0,my:l}):C},R.polys={polygon:function(a,b){var c,d,e,f={width:0,height:0,position:{top:1e10,right:0,bottom:0,left:1e10},adjustable:E},g=0,h=[],i=1,j=1,k=0,l=0;for(g=a.length;g--;)(c=[parseInt(a[--g],10),parseInt(a[g+1],10)])[0]>f.position.right&&(f.position.right=c[0]),c[0]<f.position.left&&(f.position.left=c[0]),c[1]>f.position.bottom&&(f.position.bottom=c[1]),c[1]<f.position.top&&(f.position.top=c[1]),h.push(c);if(d=f.width=Math.abs(f.position.right-f.position.left),e=f.height=Math.abs(f.position.bottom-f.position.top),"c"===b.abbrev())f.position={left:f.position.left+f.width/2,top:f.position.top+f.height/2};else{for(;d>0&&e>0&&i>0&&j>0;)for(d=Math.floor(d/2),e=Math.floor(e/2),b.x===L?i=d:b.x===N?i=f.width-d:i+=Math.floor(d/2),b.y===K?j=e:b.y===M?j=f.height-e:j+=Math.floor(e/2),g=h.length;g--&&!(h.length<2);)k=h[g][0]-f.position.left,l=h[g][1]-f.position.top,(b.x===L&&k>=i||b.x===N&&i>=k||b.x===O&&(i>k||k>f.width-i)||b.y===K&&l>=j||b.y===M&&j>=l||b.y===O&&(j>l||l>f.height-j))&&h.splice(g,1);f.position={left:h[0][0],top:h[0][1]}}return f},rect:function(a,b,c,d){return{width:Math.abs(c-a),height:Math.abs(d-b),position:{left:Math.min(a,c),top:Math.min(b,d)}}},_angles:{tc:1.5,tr:7/4,tl:5/4,bc:.5,br:.25,bl:.75,rc:2,lc:1,c:0},ellipse:function(a,b,c,d,e){var f=R.polys._angles[e.abbrev()],g=0===f?0:c*Math.cos(f*Math.PI),h=d*Math.sin(f*Math.PI);return{width:2*c-Math.abs(g),height:2*d-Math.abs(h),position:{left:a+g,top:b+h},adjustable:E}},circle:function(a,b,c,d){return R.polys.ellipse(a,b,c,c,d)}},R.svg=function(a,c,e){for(var f,g,h,i,j,k,l,m,n,o=c[0],p=d(o.ownerSVGElement),q=o.ownerDocument,r=(parseInt(c.css("stroke-width"),10)||0)/2;!o.getBBox;)o=o.parentNode;if(!o.getBBox||!o.parentNode)return E;switch(o.nodeName){case"ellipse":case"circle":m=R.polys.ellipse(o.cx.baseVal.value,o.cy.baseVal.value,(o.rx||o.r).baseVal.value+r,(o.ry||o.r).baseVal.value+r,e);break;case"line":case"polygon":case"polyline":for(m=[],k=-1,i=(l=o.points||[{x:o.x1.baseVal.value,y:o.y1.baseVal.value},{x:o.x2.baseVal.value,y:o.y2.baseVal.value}]).numberOfItems||l.length;++k<i;)j=l.getItem?l.getItem(k):l[k],m.push.apply(m,[j.x,j.y]);m=R.polys.polygon(m,e);break;default:m={width:(m=o.getBBox()).width,height:m.height,position:{left:m.x,top:m.y}}}return n=m.position,(p=p[0]).createSVGPoint&&(g=o.getScreenCTM(),l=p.createSVGPoint(),l.x=n.left,l.y=n.top,h=l.matrixTransform(g),n.left=h.x,n.top=h.y),q!==b&&"mouse"!==a.position.target&&(f=d((q.defaultView||q.parentWindow).frameElement).offset())&&(n.left+=f.left,n.top+=f.top),q=d(q),n.left+=q.scrollLeft(),n.top+=q.scrollTop(),m},R.imagemap=function(a,b,c){b.jquery||(b=d(b));var e,f,g,h,i,j=(b.attr("shape")||"rect").toLowerCase().replace("poly","polygon"),k=d('img[usemap="#'+b.parent("map").attr("name")+'"]'),m=d.trim(b.attr("coords")).replace(/,$/,"").split(",");if(!k.length)return E;if("polygon"===j)h=R.polys.polygon(m,c);else{if(!R.polys[j])return E;for(g=-1,i=m.length,f=[];++g<i;)f.push(parseInt(m[g],10));h=R.polys[j].apply(this,f.concat(c))}return e=k.offset(),e.left+=Math.ceil((k.outerWidth(E)-k.width())/2),e.top+=Math.ceil((k.outerHeight(E)-k.height())/2),h.position.left+=e.left,h.position.top+=e.top,h};d.extend(x.prototype,{_scroll:function(){var b=this.qtip.elements.overlay;b&&(b[0].style.top=d(a).scrollTop()+"px")},init:function(c){var e=c.tooltip;d("select, object").length<1&&(this.bgiframe=c.elements.bgiframe=d('<iframe class="qtip-bgiframe" frameborder="0" tabindex="-1" src="javascript:\'\';"  style="display:block; position:absolute; z-index:-1; filter:alpha(opacity=0); -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";"></iframe>').appendTo(e),c._bind(e,"tooltipmove",this.adjustBGIFrame,this._ns,this)),this.redrawContainer=d("<div/>",{id:S+"-rcontainer"}).appendTo(b.body),c.elements.overlay&&c.elements.overlay.addClass("qtipmodal-ie6fix")&&(c._bind(a,["scroll","resize"],this._scroll,this._ns,this),c._bind(e,["tooltipshow"],this._scroll,this._ns,this)),this.redraw()},adjustBGIFrame:function(){var a,b,c=this.qtip.tooltip,d={height:c.outerHeight(E),width:c.outerWidth(E)},e=this.qtip.plugins.tip,f=this.qtip.elements.tip;b={left:-(b=parseInt(c.css("borderLeftWidth"),10)||0),top:-b},e&&f&&(a="x"===e.corner.precedance?[I,L]:[J,K],b[a[1]]-=f[a[0]]()),this.bgiframe.css(b).css(d)},redraw:function(){if(this.qtip.rendered<1||this.drawing)return this;var a,b,c,d,e=this.qtip.tooltip,f=this.qtip.options.style,g=this.qtip.options.position.container;return this.qtip.drawing=1,f.height&&e.css(J,f.height),f.width?e.css(I,f.width):(e.css(I,"").appendTo(this.redrawContainer),1>(b=e.width())%2&&(b+=1),c=e.css("maxWidth")||"",d=e.css("minWidth")||"",a=(c+d).indexOf("%")>-1?g.width()/100:0,c=(c.indexOf("%")>-1?a:1*parseInt(c,10))||b,d=(d.indexOf("%")>-1?a:1*parseInt(d,10))||0,b=c+d?Math.min(Math.max(b,d),c):b,e.css(I,Math.round(b)).appendTo(g)),this.drawing=0,this},destroy:function(){this.bgiframe&&this.bgiframe.remove(),this.qtip._unbind([a,this.qtip.tooltip],this._ns)}}),(R.ie6=function(a){return 6===da_ie?new x(a):E}).initialize="render",B.ie6={"^content|style$":function(){this.redraw()}}})}(window,document),function(){var t={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(e,n){var r="string"==typeof e.initial?{state:e.initial}:e.initial,i=e.terminal||e.final,a=n||e.target||{},o=e.events||[],u=e.callbacks||{},s={},c={},f=function(e){var n=Array.isArray(e.from)?e.from:e.from?[e.from]:[t.WILDCARD];s[e.name]=s[e.name]||{};for(var r=0;r<n.length;r++)c[n[r]]=c[n[r]]||[],c[n[r]].push(e.name),s[e.name][n[r]]=e.to||n[r];e.to&&(c[e.to]=c[e.to]||[])};r&&(r.event=r.event||"startup",f({name:r.event,from:"none",to:r.state}));for(var l=0;l<o.length;l++)f(o[l]);for(var v in s)s.hasOwnProperty(v)&&(a[v]=t.buildEvent(v,s[v]));for(var v in u)u.hasOwnProperty(v)&&(a[v]=u[v]);return a.current="none",a.is=function(t){return Array.isArray(t)?t.indexOf(this.current)>=0:this.current===t},a.can=function(e){return!this.transition&&void 0!==s[e]&&(s[e].hasOwnProperty(this.current)||s[e].hasOwnProperty(t.WILDCARD))},a.cannot=function(t){return!this.can(t)},a.transitions=function(){return(c[this.current]||[]).concat(c[t.WILDCARD]||[])},a.isFinished=function(){return this.is(i)},a.error=e.error||function(t,e,n,r,i,a,o){throw o||a},a.states=function(){return Object.keys(c).sort()},r&&!r.defer&&a[r.event](),a},doCallback:function(e,n,r,i,a,o){if(n)try{return n.apply(e,[r,i,a].concat(o))}catch(n){return e.error(r,i,a,o,t.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",n)}},beforeAnyEvent:function(e,n,r,i,a){return t.doCallback(e,e.onbeforeevent,n,r,i,a)},afterAnyEvent:function(e,n,r,i,a){return t.doCallback(e,e.onafterevent||e.onevent,n,r,i,a)},leaveAnyState:function(e,n,r,i,a){return t.doCallback(e,e.onleavestate,n,r,i,a)},enterAnyState:function(e,n,r,i,a){return t.doCallback(e,e.onenterstate||e.onstate,n,r,i,a)},changeState:function(e,n,r,i,a){return t.doCallback(e,e.onchangestate,n,r,i,a)},beforeThisEvent:function(e,n,r,i,a){return t.doCallback(e,e["onbefore"+n],n,r,i,a)},afterThisEvent:function(e,n,r,i,a){return t.doCallback(e,e["onafter"+n]||e["on"+n],n,r,i,a)},leaveThisState:function(e,n,r,i,a){return t.doCallback(e,e["onleave"+r],n,r,i,a)},enterThisState:function(e,n,r,i,a){return t.doCallback(e,e["onenter"+i]||e["on"+i],n,r,i,a)},beforeEvent:function(e,n,r,i,a){if(!1===t.beforeThisEvent(e,n,r,i,a)||!1===t.beforeAnyEvent(e,n,r,i,a))return!1},afterEvent:function(e,n,r,i,a){t.afterThisEvent(e,n,r,i,a),t.afterAnyEvent(e,n,r,i,a)},leaveState:function(e,n,r,i,a){var o=t.leaveThisState(e,n,r,i,a),u=t.leaveAnyState(e,n,r,i,a);return!1!==o&&!1!==u&&(t.ASYNC===o||t.ASYNC===u?t.ASYNC:void 0)},enterState:function(e,n,r,i,a){t.enterThisState(e,n,r,i,a),t.enterAnyState(e,n,r,i,a)},buildEvent:function(e,n){return function(){var r=this.current,i=n[r]||(n[t.WILDCARD]!=t.WILDCARD?n[t.WILDCARD]:r)||r,a=Array.prototype.slice.call(arguments);if(this.transition)return this.error(e,r,i,a,t.Error.PENDING_TRANSITION,"event "+e+" inappropriate because previous transition did not complete");if(this.cannot(e))return this.error(e,r,i,a,t.Error.INVALID_TRANSITION,"event "+e+" inappropriate in current state "+this.current);if(!1===t.beforeEvent(this,e,r,i,a))return t.Result.CANCELLED;if(r===i)return t.afterEvent(this,e,r,i,a),t.Result.NOTRANSITION;var o=this;this.transition=function(){return o.transition=null,o.current=i,t.enterState(o,e,r,i,a),t.changeState(o,e,r,i,a),t.afterEvent(o,e,r,i,a),t.Result.SUCCEEDED},this.transition.cancel=function(){o.transition=null,t.afterEvent(o,e,r,i,a)};var u=t.leaveState(this,e,r,i,a);return!1===u?(this.transition=null,t.Result.CANCELLED):t.ASYNC===u?t.Result.PENDING:this.transition?this.transition():void 0}}};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.StateMachine=t):"function"==typeof define&&define.amd?define(function(e){return t}):"undefined"!=typeof window?window.StateMachine=t:"undefined"!=typeof self&&(self.StateMachine=t)}(),function(){var a={},b=function(b){for(var c=a[b],e=c.deps,f=c.defn,g=e.length,h=new Array(g),i=0;i<g;++i)h[i]=d(e[i]);var j=f.apply(null,h);if(void 0===j)throw"module ["+b+"] returned undefined";c.instance=j},c=function(b,c,d){if("string"!=typeof b)throw"module id must be a string";if(void 0===c)throw"no dependencies for "+b;if(void 0===d)throw"no definition function for "+b;a[b]={deps:c,defn:d,instance:void 0}},d=function(c){var d=a[c];if(void 0===d)throw"module ["+c+"] was undefined";return void 0===d.instance&&b(c),d.instance};({}).bolt={module:{api:{define:c,require:function(a,b){for(var c=a.length,e=new Array(c),f=0;f<c;++f)e[f]=d(a[f]);b.apply(null,e)},demand:d}}};var g=c,h=function(a,b){g(a,[],function(){return b})};h("4",Array),h("5",Error),g("1",["4","5"],function(a,b){var e=function(a){return function(){return a}};return{noop:function(){},compose:function(a,b){return function(){return a(b.apply(null,arguments))}},constant:e,identity:function(a){return a},tripleEquals:function(a,b){return a===b},curry:function(b){for(var c=new a(arguments.length-1),d=1;d<arguments.length;d++)c[d-1]=arguments[d];return function(){for(var d=new a(arguments.length),e=0;e<d.length;e++)d[e]=arguments[e];var f=c.concat(d);return b.apply(null,f)}},not:function(a){return function(){return!a.apply(null,arguments)}},die:function(a){return function(){throw new b(a)}},apply:function(a){return a()},call:function(a){a()},never:e(!1),always:e(!0)}}),h("2",window),h("3a",Object),g("2n",["1","3a"],function(a,b){var c=a.never,d=a.always,e=function(){return f},f=function(){var f=function(a){return a.isNone()},g=function(a){return a()},h=function(a){return a},j={fold:function(a,b){return a()},is:c,isSome:c,isNone:d,getOr:h,getOrThunk:g,getOrDie:function(a){throw new Error(a||"error: getOrDie called on none.")},or:h,orThunk:g,map:e,ap:e,each:function(){},bind:e,flatten:e,exists:c,forall:d,filter:e,equals:f,equals_:f,toArray:function(){return[]},toString:a.constant("none()")};return b.freeze&&b.freeze(j),j}(),g=function(a){var b=function(){return a},h=function(){return k},j=function(b){return b(a)},k={fold:function(b,c){return c(a)},is:function(b){return a===b},isSome:d,isNone:c,getOr:b,getOrThunk:b,getOrDie:b,or:h,orThunk:h,map:function(b){return g(b(a))},ap:function(b){return b.fold(e,function(b){return g(b(a))})},each:function(b){b(a)},bind:j,flatten:b,exists:j,forall:j,filter:function(b){return b(a)?k:f},equals:function(b){return b.is(a)},equals_:function(b,d){return b.fold(c,function(b){return d(a,b)})},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return k};return{some:g,none:e,from:function(a){return null===a||void 0===a?f:g(a)}}}),h("3b",String),g("1i",["2n","4","5","3b"],function(a,b,c,d){var e=function(){var a=b.prototype.indexOf;return void 0===a?function(a,b){return u(a,b)}:function(b,c){return a.call(b,c)}}(),g=function(a,b){return e(a,b)>-1},k=function(a,c){for(var d=a.length,e=new b(d),f=0;f<d;f++){var g=a[f];e[f]=c(g,f,a)}return e},l=function(a,b){for(var c=0,d=a.length;c<d;c++){b(a[c],c,a)}},m=function(a,b){for(var c=a.length-1;c>=0;c--){b(a[c],c,a)}},o=function(a,b){for(var c=[],d=0,e=a.length;d<e;d++){var f=a[d];b(f,d,a)&&c.push(f)}return c},t=function(b,c){for(var d=0,e=b.length;d<e;d++){if(c(b[d],d,b))return a.some(d)}return a.none()},u=function(a,b){for(var c=0,d=a.length;c<d;++c)if(a[c]===b)return c;return-1},v=b.prototype.push,w=function(a){for(var d=[],e=0,f=a.length;e<f;++e){if(!b.prototype.isPrototypeOf(a[e]))throw new c("Arr.flatten item "+e+" was not an array, input: "+a);v.apply(d,a[e])}return d},y=function(a,b){for(var c=0,d=a.length;c<d;++c){if(!0!==b(a[c],c,a))return!1}return!0},A=b.prototype.slice;return{map:k,each:l,eachr:m,partition:function(a,b){for(var c=[],d=[],e=0,f=a.length;e<f;e++){var g=a[e];(b(g,e,a)?c:d).push(g)}return{pass:c,fail:d}},filter:o,groupBy:function(a,b){if(0===a.length)return[];for(var c=b(a[0]),d=[],e=[],f=0,g=a.length;f<g;f++){var h=a[f],i=b(h);i!==c&&(d.push(e),e=[]),c=i,e.push(h)}return 0!==e.length&&d.push(e),d},indexOf:function(b,c){var d=e(b,c);return-1===d?a.none():a.some(d)},foldr:function(a,b,c){return m(a,function(a){c=b(c,a)}),c},foldl:function(a,b,c){return l(a,function(a){c=b(c,a)}),c},find:function(b,c){for(var d=0,e=b.length;d<e;d++){var f=b[d];if(c(f,d,b))return a.some(f)}return a.none()},findIndex:t,flatten:w,bind:function(a,b){var c=k(a,b);return w(c)},forall:y,exists:function(a,b){return t(a,b).isSome()},contains:g,equal:function(a,b){return a.length===b.length&&y(a,function(a,c){return a===b[c]})},reverse:function(a){var b=A.call(a,0);return b.reverse(),b},chunk:function(a,b){for(var c=[],d=0;d<a.length;d+=b){var e=a.slice(d,d+b);c.push(e)}return c},difference:function(a,b){return o(a,function(a){return!g(b,a)})},mapToObject:function(a,b){for(var c={},e=0,f=a.length;e<f;e++){var g=a[e];c[d(g)]=b(g,e)}return c},pure:function(a){return[a]},sort:function(a,b){var c=A.call(a,0);return c.sort(b),c},range:function(a,b){for(var c=[],d=0;d<a;d++)c.push(b(d));return c},head:function(b){return 0===b.length?a.none():a.some(b[0])},last:function(b){return 0===b.length?a.none():a.some(b[b.length-1])}}}),h("1j",document),g("65",[],function(){return"undefined"!=typeof window?window:Function("return this;")()}),g("4y",["65"],function(a){var b=function(b,c){for(var d=void 0!==c?c:a,e=0;e<b.length&&void 0!==d&&null!==d;++e)d=d[b[e]];return d},d=function(a,b){return void 0!==a[b]&&null!==a[b]||(a[b]={}),a[b]},e=function(b,c){for(var e=void 0!==c?c:a,f=0;f<b.length;++f)e=d(e,b[f]);return e};return{path:b,resolve:function(a,c){var d=a.split(".");return b(d,c)},forge:e,namespace:function(a,b){var c=a.split(".");return e(c,b)}}}),g("3c",["4y"],function(a){var b=function(b,c){return a.resolve(b,c)};return{getOrDie:function(a,c){var d=b(a,c);if(void 0===d)throw a+" not available on this browser";return d}}}),g("1k",["3c"],function(a){var b=function(){return a.getOrDie("URL")};return{createObjectURL:function(a){return b().createObjectURL(a)},revokeObjectURL:function(a){b().revokeObjectURL(a)}}}),h("1l",matchMedia),h("1m",navigator),g("b",["1k","1j","1l","1m","2"],function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s=d,t=s.userAgent,u=function(a){return"matchMedia"in e&&c(a).matches};f=e.opera&&e.opera.buildNumber,n=/Android/.test(t),h=(h=!(g=/WebKit/.test(t))&&!f&&/MSIE/gi.test(t)&&/Explorer/gi.test(s.appName))&&/MSIE (\w+)\./.exec(t)[1],i=-1!=t.indexOf("Trident/")&&(-1!=t.indexOf("rv:")||-1!=s.appName.indexOf("Netscape"))&&11,j=-1!=t.indexOf("Edge/")&&!h&&!i&&12,h=h||i||j,k=!g&&!i&&/Gecko/.test(t),l=-1!=t.indexOf("Mac"),m=/(iPad|iPhone)/.test(t),o="FormData"in e&&"FileReader"in e&&"URL"in e&&!!a.createObjectURL,p=u("only screen and (max-device-width: 480px)")&&(n||m),q=u("only screen and (min-width: 800px)")&&(n||m),r=-1!=t.indexOf("Windows Phone"),j&&(g=!1);return{opera:f,webkit:g,ie:h,gecko:k,mac:l,iOS:m,android:n,contentEditable:!m||o||t.match(/AppleWebKit\/(\d*)/)[1]>=534,transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",caretAfter:8!=h,range:e.getSelection&&"Range"in e,documentMode:h&&!j?b.documentMode||7:10,fileApi:o,ceFalse:!1===h||h>8,canHaveCSP:!1===h||h>11,desktop:!p&&!q,windowsPhone:r}}),h("1n",clearInterval),h("1o",clearTimeout),h("1p",setInterval),h("1q",setTimeout),g("1d",[],function(){function a(a,b){return function(){a.apply(b,arguments)}}function b(b){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof b)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],h(b,a(d,this),a(e,this))}function c(a){var b=this;return null===this._state?void this._deferreds.push(a):void i(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null!==c){var d;try{d=c(b._value)}catch(b){return void a.reject(b)}a.resolve(d)}else(b._state?a.resolve:a.reject)(b._value)})}function d(b){try{if(b===this)throw new TypeError("A promise cannot be resolved with itself.");if(b&&("object"==typeof b||"function"==typeof b)){var c=b.then;if("function"==typeof c)return void h(a(c,b),a(d,this),a(e,this))}this._state=!0,this._value=b,f.call(this)}catch(a){e.call(this,a)}}function e(a){this._state=!1,this._value=a,f.call(this)}function f(){for(var a=0,b=this._deferreds.length;a<b;a++)c.call(this,this._deferreds[a]);this._deferreds=null}function h(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(a){if(d)return;d=!0,c(a)}}if(window.Promise)return window.Promise;var i=b.immediateFn||"function"==typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},j=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};return b.prototype.catch=function(a){return this.then(null,a)},b.prototype.then=function(a,d){var e=this;return new b(function(b,f){c.call(e,new function(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}(a,d,b,f))})},b.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&j(arguments[0])?arguments[0]:arguments);return new b(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0==--e&&b(a)}catch(a){c(a)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},b.resolve=function(a){return a&&"object"==typeof a&&a.constructor===b?a:new b(function(b){b(a)})},b.reject=function(a){return new b(function(b,c){c(a)})},b.race=function(a){return new b(function(b,c){for(var d=0,e=a.length;d<e;d++)a[d].then(b,c)})},b}),g("15",["1n","1o","1j","1p","1q","2","1d"],function(a,b,c,d,e,f,g){var h,j=function(a,b){return"number"!=typeof b&&(b=0),e(a,b)},k=function(a,b){return"number"!=typeof b&&(b=1),d(a,b)},n=function(a,c){var d,e;return e=function(){var e=arguments;b(d),d=j(function(){a.apply(this,e)},c)},e.stop=function(){b(d)},e};return{requestAnimationFrame:function(a,b){return h?void h.then(a):void(h=new g(function(a){b||(b=c.body),function(a,b){var c,d=f.requestAnimationFrame,e=["ms","moz","webkit"];for(c=0;c<e.length&&!d;c++)d=f[e[c]+"RequestAnimationFrame"];d||(d=function(a){f.setTimeout(a,0)}),d(a,b)}(a,b)}).then(a))},setTimeout:j,setInterval:k,setEditorTimeout:function(a,b,c){return j(function(){a.removed||b()},c)},setEditorInterval:function(b,c,d){var e;return e=k(function(){b.removed?a(e):c()},d)},debounce:n,throttle:n,clearInterval:function(b){return a(b)},clearTimeout:function(a){return b(a)}}}),g("o",["1j","2","b","15"],function(a,b,c,d){"use strict";var f=/^(?:mouse|contextmenu)|click/,g={keyLocation:1,layerX:1,layerY:1,returnValue:1,webkitMovementX:1,webkitMovementY:1,keyIdentifier:1},i=function(){return!1},j=function(){return!0},k=function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent&&a.attachEvent("on"+b,c)},l=function(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d||!1):a.detachEvent&&a.detachEvent("on"+b,c)},n=function(b,d){var e,k,l=d||{};for(e in b)g[e]||(l[e]=b[e]);if(l.target||(l.target=l.srcElement||a),c.experimentalShadowDom&&(l.target=function(a,b){var c,d=b;return(c=a.path)&&c.length>0&&(d=c[0]),a.deepPath&&(c=a.deepPath())&&c.length>0&&(d=c[0]),d}(b,l.target)),b&&f.test(b.type)&&b.pageX===k&&b.clientX!==k){var n=l.target.ownerDocument||a,o=n.documentElement,p=n.body;l.pageX=b.clientX+(o&&o.scrollLeft||p&&p.scrollLeft||0)-(o&&o.clientLeft||p&&p.clientLeft||0),l.pageY=b.clientY+(o&&o.scrollTop||p&&p.scrollTop||0)-(o&&o.clientTop||p&&p.clientTop||0)}return l.preventDefault=function(){l.isDefaultPrevented=j,b&&(b.preventDefault?b.preventDefault():b.returnValue=!1)},l.stopPropagation=function(){l.isPropagationStopped=j,b&&(b.stopPropagation?b.stopPropagation():b.cancelBubble=!0)},l.stopImmediatePropagation=function(){l.isImmediatePropagationStopped=j,l.stopPropagation()},!1===function(a){return a.isDefaultPrevented===j||a.isDefaultPrevented===i}(l)&&(l.isDefaultPrevented=i,l.isPropagationStopped=i,l.isImmediatePropagationStopped=i),void 0===l.metaKey&&(l.metaKey=!1),l},o=function(a,b,e){var f=a.document,g={type:"ready"};if(e.domLoaded)b(g);else{var h=function(){return"complete"===f.readyState||"interactive"===f.readyState&&f.body},i=function(){e.domLoaded||(e.domLoaded=!0,b(g))},j=function(){h()&&(l(f,"readystatechange",j),i())},m=function(){try{f.documentElement.doScroll("left")}catch(a){return void d.setTimeout(m)}i()};!f.addEventListener||c.ie&&c.ie<11?(k(f,"readystatechange",j),f.documentElement.doScroll&&a.self===a.top&&m()):h()?i():k(a,"DOMContentLoaded",i),k(a,"load",i)}},p=function(){var c,d,f,g,h,i=this,j={};d="mce-data-"+(+new Date).toString(32),g="onmouseenter"in a.documentElement,f="onfocusin"in a.documentElement,h={mouseenter:"mouseover",mouseleave:"mouseout"},c=1,i.domLoaded=!1,i.events=j;var m=function(a,b){var c,d,e,f,g=j[b];if(c=g&&g[a.type])for(d=0,e=c.length;d<e;d++)if((f=c[d])&&!1===f.func.call(f.scope,a)&&a.preventDefault(),a.isImmediatePropagationStopped())return};i.bind=function(a,e,l,p){var q,r,s,t,u,v,w,x=b,y=function(a){m(n(a||x.event),q)};if(a&&3!==a.nodeType&&8!==a.nodeType){for(a[d]?q=a[d]:(q=c++,a[d]=q,j[q]={}),p=p||a,s=(e=e.split(" ")).length;s--;)t=e[s],v=y,u=w=!1,"DOMContentLoaded"===t&&(t="ready"),i.domLoaded&&"ready"===t&&"complete"==a.readyState?l.call(p,n({type:t})):(g||(u=h[t])&&(v=function(a){var b,c;if(b=a.currentTarget,(c=a.relatedTarget)&&b.contains)c=b.contains(c);else for(;c&&c!==b;)c=c.parentNode;c||(a=n(a||x.event),a.type="mouseout"===a.type?"mouseleave":"mouseenter",a.target=b,m(a,q))}),f||"focusin"!==t&&"focusout"!==t||(w=!0,u="focusin"===t?"focus":"blur",v=function(a){(a=n(a||x.event)).type="focus"===a.type?"focusin":"focusout",m(a,q)}),(r=j[q][t])?"ready"===t&&i.domLoaded?l({type:t}):r.push({func:l,scope:p}):(j[q][t]=r=[{func:l,scope:p}],r.fakeName=u,r.capture=w,r.nativeHandler=v,"ready"===t?o(a,v,i):k(a,u||t,v,w)));return a=r=0,l}},i.unbind=function(a,b,c){var e,f,g,h,k,m;if(!a||3===a.nodeType||8===a.nodeType)return i;if(e=a[d]){if(m=j[e],b){for(g=(b=b.split(" ")).length;g--;)if(k=b[g],f=m[k]){if(c)for(h=f.length;h--;)if(f[h].func===c){var n=f.nativeHandler,o=f.fakeName,p=f.capture;(f=f.slice(0,h).concat(f.slice(h+1))).nativeHandler=n,f.fakeName=o,f.capture=p,m[k]=f}c&&0!==f.length||(delete m[k],l(a,f.fakeName||k,f.nativeHandler,f.capture))}}else{for(k in m)f=m[k],l(a,f.fakeName||k,f.nativeHandler,f.capture);m={}}for(k in m)return i;delete j[e];try{delete a[d]}catch(b){a[d]=null}}return i},i.fire=function(a,b,c){var e;if(!a||3===a.nodeType||8===a.nodeType)return i;(c=n(null,c)).type=b,c.target=a;do{(e=a[d])&&m(c,e),a=a.parentNode||a.ownerDocument||a.defaultView||a.parentWindow}while(a&&!c.isPropagationStopped());return i},i.clean=function(a){var b,c,e=i.unbind;if(!a||3===a.nodeType||8===a.nodeType)return i;if(a[d]&&e(a),a.getElementsByTagName||(a=a.document),a&&a.getElementsByTagName)for(e(a),c=a.getElementsByTagName("*"),b=c.length;b--;)(a=c[b])[d]&&e(a);return i},i.destroy=function(){j={}},i.cancel=function(a){return a&&(a.preventDefault(),a.stopImmediatePropagation()),!1}};return(p.Event=new p).bind(b,"ready",function(){}),p}),g("r",[],function(){function a(a,b,c,d){var e,f,g,i,k,l,m,n,o,p;if((b?b.ownerDocument||b:L)!==D&&C(b),b=b||D,c=c||[],!a||"string"!=typeof a)return c;if(1!==(i=b.nodeType)&&9!==i)return[];if(F&&!d){if(e=oa.exec(a))if(g=e[1]){if(9===i){if(!(f=b.getElementById(g))||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&J(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return Y.apply(c,b.getElementsByTagName(a)),c;if((g=e[3])&&s.getElementsByClassName)return Y.apply(c,b.getElementsByClassName(g)),c}if(s.qsa&&(!G||!G.test(a))){if(n=m=K,o=b,p=9===i&&a,1===i&&"object"!==b.nodeName.toLowerCase()){for(l=w(a),(m=b.getAttribute("id"))?n=m.replace(qa,"\\$&"):b.setAttribute("id",n),n="[id='"+n+"'] ",k=l.length;k--;)l[k]=n+j(l[k]);o=pa.test(a)&&h(b.parentNode)||b,p=l.join(",")}if(p)try{return Y.apply(c,o.querySelectorAll(p)),c}catch(a){}finally{m||b.removeAttribute("id")}}}return y(a.replace(ea,"$1"),b,c,d)}function b(){function a(c,d){return b.push(c+" ")>t.cacheLength&&delete a[b.shift()],a[c+" "]=d}var b=[];return a}function c(a){return a[K]=!0,a}function d(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||T)-(~a.sourceIndex||T);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function e(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}}function f(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function g(a){return c(function(b){return b=+b,c(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function h(a){return a&&typeof a.getElementsByTagName!==S&&a}function i(){}function j(a){for(var b=0,c=a.length,d="";b<c;b++)d+=a[b].value;return d}function k(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=N++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[M,f];if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e){if(i=b[K]||(b[K]={}),(h=i[d])&&h[0]===M&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function l(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function m(b,c,d){for(var e=0,f=c.length;e<f;e++)a(b,c[e],d);return d}function n(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;h<i;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function o(a,b,d,e,f,g){return e&&!e[K]&&(e=o(e)),f&&!f[K]&&(f=o(f,g)),c(function(c,g,h,i){var j,k,l,o=[],p=[],q=g.length,r=c||m(b||"*",h.nodeType?[h]:h,[]),s=!a||!c&&b?r:n(r,o,a,h,i),t=d?f||(c?a:q||e)?[]:g:s;if(d&&d(s,t,h,i),e)for(j=n(t,p),e(j,[],h,i),k=j.length;k--;)(l=j[k])&&(t[p[k]]=!(s[p[k]]=l));if(c){if(f||a){if(f){for(j=[],k=t.length;k--;)(l=t[k])&&j.push(s[k]=l);f(null,t=[],j,i)}for(k=t.length;k--;)(l=t[k])&&(j=f?$.call(c,l):o[k])>-1&&(c[j]=!(g[j]=l))}}else t=n(t===g?t.splice(q,t.length):t),f?f(null,g,t,i):Y.apply(g,t)})}function p(a){for(var b,c,d,e=a.length,f=t.relative[a[0].type],g=f||t.relative[" "],h=f?1:0,i=k(function(a){return a===b},g,!0),m=k(function(a){return $.call(b,a)>-1},g,!0),n=[function(a,c,d){return!f&&(d||c!==z)||((b=c).nodeType?i(a,c,d):m(a,c,d))}];h<e;h++)if(c=t.relative[a[h].type])n=[k(l(n),c)];else{if((c=t.filter[a[h].type].apply(null,a[h].matches))[K]){for(d=++h;d<e&&!t.relative[a[d].type];d++);return o(h>1&&l(n),h>1&&j(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(ea,"$1"),c,h<d&&p(a.slice(h,d)),d<e&&p(a=a.slice(d)),d<e&&j(a))}n.push(c)}return l(n)}function q(b,d){var e=d.length>0,f=b.length>0,g=function(c,g,h,i,j){var k,l,m,o=0,p="0",q=c&&[],r=[],s=z,u=c||f&&t.find.TAG("*",j),v=M+=null==s?1:Math.random()||.1,w=u.length;for(j&&(z=g!==D&&g);p!==w&&null!=(k=u[p]);p++){if(f&&k){for(l=0;m=b[l++];)if(m(k,g,h)){i.push(k);break}j&&(M=v)}e&&((k=!m&&k)&&o--,c&&q.push(k))}if(o+=p,e&&p!==o){for(l=0;m=d[l++];)m(q,r,g,h);if(c){if(o>0)for(;p--;)q[p]||r[p]||(r[p]=W.call(i));r=n(r)}Y.apply(i,r),j&&!c&&r.length>0&&o+d.length>1&&a.uniqueSort(i)}return j&&(M=v,z=s),q};return e?c(g):g}var r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,J,K="sizzle"+-new Date,L=window.document,M=0,N=0,O=b(),P=b(),Q=b(),R=function(a,b){return a===b&&(B=!0),0},S="undefined",T=1<<31,U={}.hasOwnProperty,V=[],W=V.pop,X=V.push,Y=V.push,Z=V.slice,$=V.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1},aa="[\\x20\\t\\r\\n\\f]",ba="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ca="\\["+aa+"*("+ba+")(?:"+aa+"*([*^$|!~]?=)"+aa+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ba+"))|)"+aa+"*\\]",da=":("+ba+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ca+")*)|.*)\\)|)",ea=new RegExp("^"+aa+"+|((?:^|[^\\\\])(?:\\\\.)*)"+aa+"+$","g"),fa=new RegExp("^"+aa+"*,"+aa+"*"),ga=new RegExp("^"+aa+"*([>+~]|"+aa+")"+aa+"*"),ha=new RegExp("="+aa+"*([^\\]'\"]*?)"+aa+"*\\]","g"),ia=new RegExp(da),ja=new RegExp("^"+ba+"$"),ka={ID:new RegExp("^#("+ba+")"),CLASS:new RegExp("^\\.("+ba+")"),TAG:new RegExp("^("+ba+"|[*])"),ATTR:new RegExp("^"+ca),PSEUDO:new RegExp("^"+da),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+aa+"*(even|odd|(([+-]|)(\\d*)n|)"+aa+"*(?:([+-]|)"+aa+"*(\\d+)|))"+aa+"*\\)|)","i"),bool:new RegExp("^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$","i"),needsContext:new RegExp("^"+aa+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+aa+"*((?:-\\d)?\\d*)"+aa+"*\\)|)(?=[^-]|$)","i")},la=/^(?:input|select|textarea|button)$/i,ma=/^h\d$/i,na=/^[^{]+\{\s*\[native \w/,oa=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,pa=/[+~]/,qa=/'|\\/g,ra=new RegExp("\\\\([\\da-f]{1,6}"+aa+"?|("+aa+")|.)","ig"),sa=function(a,b,c){var d="0x"+b-65536;return d!=d||c?b:d<0?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{Y.apply(V=Z.call(L.childNodes),L.childNodes),V[L.childNodes.length].nodeType}catch(a){Y={apply:V.length?function(a,b){X.apply(a,Z.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}s=a.support={},v=a.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return!!b&&"HTML"!==b.nodeName},C=a.setDocument=function(a){var c,e=a?a.ownerDocument||a:L,f=e.defaultView;return e!==D&&9===e.nodeType&&e.documentElement?(D=e,E=e.documentElement,F=!v(e),f&&f!==function(a){try{return a.top}catch(a){}return null}(f)&&(f.addEventListener?f.addEventListener("unload",function(){C()},!1):f.attachEvent&&f.attachEvent("onunload",function(){C()})),s.attributes=!0,s.getElementsByTagName=!0,s.getElementsByClassName=na.test(e.getElementsByClassName),s.getById=!0,t.find.ID=function(a,b){if(typeof b.getElementById!==S&&F){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},t.filter.ID=function(a){var b=a.replace(ra,sa);return function(a){return a.getAttribute("id")===b}},t.find.TAG=s.getElementsByTagName?function(a,b){if(typeof b.getElementsByTagName!==S)return b.getElementsByTagName(a)}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},t.find.CLASS=s.getElementsByClassName&&function(a,b){if(F)return b.getElementsByClassName(a)},H=[],G=[],s.disconnectedMatch=!0,G=G.length&&new RegExp(G.join("|")),H=H.length&&new RegExp(H.join("|")),c=na.test(E.compareDocumentPosition),J=c||na.test(E.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},R=c?function(a,b){if(a===b)return B=!0,0;var c=!a.compareDocumentPosition-!b.compareDocumentPosition;return c||(1&(c=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!s.sortDetached&&b.compareDocumentPosition(a)===c?a===e||a.ownerDocument===L&&J(L,a)?-1:b===e||b.ownerDocument===L&&J(L,b)?1:A?$.call(A,a)-$.call(A,b):0:4&c?-1:1)}:function(a,b){if(a===b)return B=!0,0;var c,f=0,g=a.parentNode,h=b.parentNode,i=[a],j=[b];if(!g||!h)return a===e?-1:b===e?1:g?-1:h?1:A?$.call(A,a)-$.call(A,b):0;if(g===h)return d(a,b);for(c=a;c=c.parentNode;)i.unshift(c);for(c=b;c=c.parentNode;)j.unshift(c);for(;i[f]===j[f];)f++;return f?d(i[f],j[f]):i[f]===L?-1:j[f]===L?1:0},e):D},a.matches=function(b,c){return a(b,null,null,c)},a.matchesSelector=function(b,c){if((b.ownerDocument||b)!==D&&C(b),c=c.replace(ha,"='$1']"),s.matchesSelector&&F&&(!H||!H.test(c))&&(!G||!G.test(c)))try{var d=(void 0).call(b,c);if(d||s.disconnectedMatch||b.document&&11!==b.document.nodeType)return d}catch(a){}return a(c,D,null,[b]).length>0},a.contains=function(a,b){return(a.ownerDocument||a)!==D&&C(a),J(a,b)},a.attr=function(a,b){(a.ownerDocument||a)!==D&&C(a);var c=t.attrHandle[b.toLowerCase()],d=c&&U.call(t.attrHandle,b.toLowerCase())?c(a,b,!F):void 0;return void 0!==d?d:s.attributes||!F?a.getAttribute(b):(d=a.getAttributeNode(b))&&d.specified?d.value:null},a.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},a.uniqueSort=function(a){var b,c=[],d=0,e=0;if(B=!s.detectDuplicates,A=!s.sortStable&&a.slice(0),a.sort(R),B){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return A=null,a},u=a.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=u(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d++];)c+=u(b);return c},(t=a.selectors={cacheLength:50,createPseudo:c,match:ka,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ra,sa),a[3]=(a[3]||a[4]||a[5]||"").replace(ra,sa),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(b){return b[1]=b[1].toLowerCase(),"nth"===b[1].slice(0,3)?(b[3]||a.error(b[0]),b[4]=+(b[4]?b[5]+(b[6]||1):2*("even"===b[3]||"odd"===b[3])),b[5]=+(b[7]+b[8]||"odd"===b[3])):b[3]&&a.error(b[0]),b},PSEUDO:function(a){var b,c=!a[6]&&a[2];return ka.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&ia.test(c)&&(b=w(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ra,sa).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=O[a+" "];return b||(b=new RegExp("(^|"+aa+")"+a+"("+aa+"|$)"))&&O(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==S&&a.getAttribute("class")||"")})},ATTR:function(b,c,d){return function(e){var f=a.attr(e,b);return null==f?"!="===c:!c||(f+="","="===c?f===d:"!="===c?f!==d:"^="===c?d&&0===f.indexOf(d):"*="===c?d&&f.indexOf(d)>-1:"$="===c?d&&f.slice(-d.length)===d:"~="===c?(" "+f+" ").indexOf(d)>-1:"|="===c&&(f===d||f.slice(0,d.length+1)===d+"-"))}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(n=(j=(k=q[K]||(q[K]={}))[a]||[])[0]===M&&j[1],m=j[0]===M&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[M,n,m];break}}else if(s&&(j=(b[K]||(b[K]={}))[a])&&j[0]===M)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[K]||(l[K]={}))[a]=[M,m]),l!==b)););return(m-=e)===d||m%d==0&&m/d>=0}}},PSEUDO:function(b,d){var e,f=t.pseudos[b]||t.setFilters[b.toLowerCase()]||a.error("unsupported pseudo: "+b);return f[K]?f(d):f.length>1?(e=[b,b,"",d],t.setFilters.hasOwnProperty(b.toLowerCase())?c(function(a,b){for(var c,e=f(a,d),g=e.length;g--;)c=$.call(a,e[g]),a[c]=!(b[c]=e[g])}):function(a){return f(a,0,e)}):f}},pseudos:{not:c(function(a){var b=[],d=[],e=x(a.replace(ea,"$1"));return e[K]?c(function(a,b,c,d){for(var f,g=e(a,null,d,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,c,f){return b[0]=a,e(b,null,f,d),!d.pop()}}),has:c(function(b){return function(c){return a(b,c).length>0}}),contains:c(function(a){return a=a.replace(ra,sa),function(b){return(b.textContent||b.innerText||u(b)).indexOf(a)>-1}}),lang:c(function(b){return ja.test(b||"")||a.error("unsupported lang: "+b),b=b.replace(ra,sa).toLowerCase(),function(a){var c;do{if(c=F?a.lang:a.getAttribute("xml:lang")||a.getAttribute("lang"))return(c=c.toLowerCase())===b||0===c.indexOf(b+"-")}while((a=a.parentNode)&&1===a.nodeType);return!1}}),target:function(a){var b=window.location&&window.location.hash;return b&&b.slice(1)===a.id},root:function(a){return a===E},focus:function(a){return a===D.activeElement&&(!D.hasFocus||D.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return!1===a.disabled},disabled:function(a){return!0===a.disabled},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,!0===a.selected},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!t.pseudos.empty(a)},header:function(a){return ma.test(a.nodeName)},input:function(a){return la.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:g(function(){return[0]}),last:g(function(a,b){return[b-1]}),eq:g(function(a,b,c){return[c<0?c+b:c]}),even:g(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:g(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:g(function(a,b,c){for(var d=c<0?c+b:c;--d>=0;)a.push(d);return a}),gt:g(function(a,b,c){for(var d=c<0?c+b:c;++d<b;)a.push(d);return a})}}).pseudos.nth=t.pseudos.eq;for(r in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})t.pseudos[r]=e(r);for(r in{submit:!0,reset:!0})t.pseudos[r]=f(r);return i.prototype=t.filters=t.pseudos,t.setFilters=new i,w=a.tokenize=function(b,c){var d,e,f,g,h,i,j,k=P[b+" "];if(k)return c?0:k.slice(0);for(h=b,i=[],j=t.preFilter;h;){d&&!(e=fa.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=ga.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(ea," ")}),h=h.slice(d.length));for(g in t.filter)!(e=ka[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return c?h.length:h?a.error(b):P(b,i).slice(0)},x=a.compile=function(a,b){var c,d=[],e=[],f=Q[a+" "];if(!f){for(b||(b=w(a)),c=b.length;c--;)(f=p(b[c]))[K]?d.push(f):e.push(f);(f=Q(a,q(e,d))).selector=a}return f},y=a.select=function(a,b,c,d){var e,f,g,i,k,l="function"==typeof a&&a,m=!d&&w(a=l.selector||a);if(c=c||[],1===m.length){if((f=m[0]=m[0].slice(0)).length>2&&"ID"===(g=f[0]).type&&s.getById&&9===b.nodeType&&F&&t.relative[f[1].type]){if(!(b=(t.find.ID(g.matches[0].replace(ra,sa),b)||[])[0]))return c;l&&(b=b.parentNode),a=a.slice(f.shift().value.length)}for(e=ka.needsContext.test(a)?0:f.length;e--&&(g=f[e],!t.relative[i=g.type]);)if((k=t.find[i])&&(d=k(g.matches[0].replace(ra,sa),pa.test(f[0].type)&&h(b.parentNode)||b))){if(f.splice(e,1),!(a=d.length&&j(f)))return Y.apply(c,d),c;break}}return(l||x(a,m))(d,b,!F,c,pa.test(a)&&h(b.parentNode)||b),c},s.sortStable=K.split("").sort(R).join("")===K,s.detectDuplicates=!!B,C(),s.sortDetached=!0,a}),g("1r",[],function(){var a=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},c=function(a,b,c){var d,e;if(!a)return 0;if(c=c||a,void 0!==a.length){for(d=0,e=a.length;d<e;d++)if(!1===b.call(c,a[d],d,a))return 0}else for(d in a)if(a.hasOwnProperty(d)&&!1===b.call(c,a[d],d,a))return 0;return 1},h=function(a,b,c){var d,e;for(d=0,e=a.length;d<e;d++)if(b.call(c,a[d],d,a))return d;return-1};return{isArray:a,toArray:function(b){var c,d,e=b;if(!a(b))for(e=[],c=0,d=b.length;c<d;c++)e[c]=b[c];return e},each:c,map:function(a,b){var d=[];return c(a,function(c,e){d.push(b(c,e,a))}),d},filter:function(a,b){var d=[];return c(a,function(c,e){b&&!b(c,e,a)||d.push(c)}),d},indexOf:function(a,b){var c,d;if(a)for(c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},reduce:function(a,b,c,d){var e=0;for(arguments.length<3&&(c=a[0]);e<a.length;e++)c=b.call(d,c,a[e],e);return c},findIndex:h,find:function(a,b,c){var d=h(a,b,c);if(-1!==d)return a[d]},last:function(a){return a[a.length-1]}}}),g("1e",["2","b","1r"],function(a,b,c){var d=/^\s*|\s*$/g,e=function(a){return null===a||void 0===a?"":(""+a).replace(d,"")},f=function(a,b){return b?!("array"!=b||!c.isArray(a))||typeof a==b:void 0!==a},k=function(a,b,d,e){e=e||this,a&&(d&&(a=a[d]),c.each(a,function(a,c){return!1!==b.call(e,a,c,d)&&void k(a,b,d,e)}))};return{trim:e,isArray:c.isArray,is:f,toArray:c.toArray,makeMap:function(a,b,c){var d;for(a=a||[],b=b||",","string"==typeof a&&(a=a.split(b)),c=c||{},d=a.length;d--;)c[a[d]]={};return c},each:c.each,map:c.map,grep:c.filter,inArray:c.indexOf,hasOwn:function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},extend:function(a,b){var c,d,e,f,g=arguments;for(c=1,d=g.length;c<d;c++){b=g[c];for(e in b)b.hasOwnProperty(e)&&void 0!==(f=b[e])&&(a[e]=f)}return a},create:function(a,b,c){var d,e,f,g,h,i=this,j=0;if(a=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(a),f=a[3].match(/(^|\.)(\w+)$/i)[2],!(e=i.createNS(a[3].replace(/\.\w+$/,""),c))[f]){if("static"==a[2])return e[f]=b,void(this.onCreate&&this.onCreate(a[2],a[3],e[f]));b[f]||(b[f]=function(){},j=1),e[f]=b[f],i.extend(e[f].prototype,b),a[5]&&(d=i.resolve(a[5]).prototype,g=a[5].match(/\.(\w+)$/i)[1],h=e[f],e[f]=j?function(){return d[g].apply(this,arguments)}:function(){return this.parent=d[g],h.apply(this,arguments)},e[f].prototype[f]=e[f],i.each(d,function(a,b){e[f].prototype[b]=d[b]}),i.each(b,function(a,b){d[b]?e[f].prototype[b]=function(){return this.parent=d[b],a.apply(this,arguments)}:b!=f&&(e[f].prototype[b]=a)})),i.each(b.static,function(a,b){e[f][b]=a})}},walk:k,createNS:function(b,c){var d,e;for(c=c||a,b=b.split("."),d=0;d<b.length;d++)e=b[d],c[e]||(c[e]={}),c=c[e];return c},resolve:function(b,c){var d,e;for(c=c||a,d=0,e=(b=b.split(".")).length;d<e&&(c=c[b[d]]);d++);return c},explode:function(a,b){return!a||f(a,"array")?a:c.map(a.split(b||","),e)},_addCacheSuffix:function(a){var c=b.cacheSuffix;return c&&(a+=(-1===a.indexOf("?")?"?":"&")+c),a}}}),g("n",["1j","o","r","b","1e"],function(a,b,c,d,e){var f,g=a,h=Array.prototype.push,i=Array.prototype.slice,j=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,k=b.Event,l=e.makeMap("children,contents,next,prev"),m=function(a){return void 0!==a},n=function(a){return"string"==typeof a},p=function(a,b){var c,d,e;for(e=(b=b||g).createElement("div"),c=b.createDocumentFragment(),e.innerHTML=a;d=e.firstChild;)c.appendChild(d);return c},q=function(a,b,c,d){var e;if(n(b))b=p(b,F(a[0]));else if(b.length&&!b.nodeType){if(b=z.makeArray(b),d)for(e=b.length-1;e>=0;e--)q(a,b[e],c,d);else for(e=0;e<b.length;e++)q(a,b[e],c,d);return a}if(b.nodeType)for(e=a.length;e--;)c.call(a[e],b);return a},r=function(a,b){return a&&b&&-1!==(" "+a.className+" ").indexOf(" "+b+" ")},s=function(a,b,c){var d,e;return b=z(b)[0],a.each(function(){var a=this;c&&d==a.parentNode?e.appendChild(a):(d=a.parentNode,e=b.cloneNode(!1),a.parentNode.insertBefore(e,a),e.appendChild(a))}),a},t=e.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"," "),u=e.makeMap("checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected"," "),v={for:"htmlFor",class:"className",readonly:"readOnly"},w={float:"cssFloat"},x={},y={},z=function(a,b){return new z.fn.init(a,b)},B=/^\s*|\s*$/g,C=function(a){return null===a||a===f?"":(""+a).replace(B,"")},D=function(a,b){var c,d,e,g;if(a)if(void 0===(c=a.length)){for(d in a)if(a.hasOwnProperty(d)&&(g=a[d],!1===b.call(g,d,g)))break}else for(e=0;e<c&&(g=a[e],!1!==b.call(g,e,g));e++);return a},E=function(a,b){var c=[];return D(a,function(a,d){b(d,a)&&c.push(d)}),c},F=function(a){return a?9==a.nodeType?a:a.ownerDocument:g};z.fn=z.prototype={constructor:z,selector:"",context:null,length:0,init:function(b,c){var d,e,f=this;if(!b)return f;if(b.nodeType)return f.context=f[0]=b,f.length=1,f;if(c&&c.nodeType)f.context=c;else{if(c)return z(b).attr(c);f.context=c=a}if(n(b)){if(f.selector=b,!(d="<"===b.charAt(0)&&">"===b.charAt(b.length-1)&&b.length>=3?[null,b,null]:j.exec(b)))return z(c).find(b);if(d[1])for(e=p(b,F(c)).firstChild;e;)h.call(f,e),e=e.nextSibling;else{if(!(e=F(c).getElementById(d[2])))return f;if(e.id!==d[2])return f.find(b);f.length=1,f[0]=e}}else this.add(b,!1);return f},toArray:function(){return e.toArray(this)},add:function(a,b){var c,d,e=this;if(n(a))return e.add(z(a));if(!1!==b)for(c=z.unique(e.toArray().concat(z.makeArray(a))),e.length=c.length,d=0;d<c.length;d++)e[d]=c[d];else h.apply(e,z.makeArray(a));return e},attr:function(a,b){var c,d=this;if("object"==typeof a)D(a,function(a,b){d.attr(a,b)});else{if(!m(b)){if(d[0]&&1===d[0].nodeType){if((c=x[a])&&c.get)return c.get(d[0],a);if(u[a])return d.prop(a)?a:f;null===(b=d[0].getAttribute(a,2))&&(b=f)}return b}this.each(function(){var c;if(1===this.nodeType){if((c=x[a])&&c.set)return void c.set(this,b);null===b?this.removeAttribute(a,2):this.setAttribute(a,b,2)}})}return d},removeAttr:function(a){return this.attr(a,null)},prop:function(a,b){var c=this;if("object"==typeof(a=v[a]||a))D(a,function(a,b){c.prop(a,b)});else{if(!m(b))return c[0]&&c[0].nodeType&&a in c[0]?c[0][a]:b;this.each(function(){1==this.nodeType&&(this[a]=b)})}return c},css:function(a,b){var c,d,e=this,g=function(a){return a.replace(/-(\D)/g,function(a,b){return b.toUpperCase()})},h=function(a){return a.replace(/[A-Z]/g,function(a){return"-"+a})};if("object"==typeof a)D(a,function(a,b){e.css(a,b)});else if(m(b))a=g(a),"number"!=typeof b||t[a]||(b+="px"),e.each(function(){var c=this.style;if((d=y[a])&&d.set)d.set(this,b);else{try{this.style[w[a]||a]=b}catch(a){}null!==b&&""!==b||(c.removeProperty?c.removeProperty(h(a)):c.removeAttribute(a))}});else{if(c=e[0],(d=y[a])&&d.get)return d.get(c);if(c.ownerDocument.defaultView)try{return c.ownerDocument.defaultView.getComputedStyle(c,null).getPropertyValue(h(a))}catch(a){return f}else if(c.currentStyle)return c.currentStyle[g(a)]}return e},remove:function(){for(var a,c=this.length;c--;)a=this[c],k.clean(a),a.parentNode&&a.parentNode.removeChild(a);return this},empty:function(){for(var a,c=this.length;c--;)for(a=this[c];a.firstChild;)a.removeChild(a.firstChild);return this},html:function(a){var b,c=this;if(m(a)){b=c.length;try{for(;b--;)c[b].innerHTML=a}catch(d){z(c[b]).empty().append(a)}return c}return c[0]?c[0].innerHTML:""},text:function(a){var b,c=this;if(m(a)){for(b=c.length;b--;)"innerText"in c[b]?c[b].innerText=a:c[0].textContent=a;return c}return c[0]?c[0].innerText||c[0].textContent:""},append:function(){return q(this,arguments,function(a){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.appendChild(a)})},prepend:function(){return q(this,arguments,function(a){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.insertBefore(a,this.firstChild)},!0)},before:function(){var a=this;return a[0]&&a[0].parentNode?q(a,arguments,function(a){this.parentNode.insertBefore(a,this)}):a},after:function(){var a=this;return a[0]&&a[0].parentNode?q(a,arguments,function(a){this.parentNode.insertBefore(a,this.nextSibling)},!0):a},appendTo:function(a){return z(a).append(this),this},prependTo:function(a){return z(a).prepend(this),this},replaceWith:function(a){return this.before(a).remove()},wrap:function(a){return s(this,a)},wrapAll:function(a){return s(this,a,!0)},wrapInner:function(a){return this.each(function(){z(this).contents().wrapAll(a)}),this},unwrap:function(){return this.parent().each(function(){z(this).replaceWith(this.childNodes)})},clone:function(){var a=[];return this.each(function(){a.push(this.cloneNode(!0))}),z(a)},addClass:function(a){return this.toggleClass(a,!0)},removeClass:function(a){return this.toggleClass(a,!1)},toggleClass:function(a,b){var c=this;return"string"!=typeof a?c:(-1!==a.indexOf(" ")?D(a.split(" "),function(){c.toggleClass(this,b)}):c.each(function(c,d){var e,f;(f=r(d,a))!==b&&(e=d.className,f?d.className=C((" "+e+" ").replace(" "+a+" "," ")):d.className+=e?" "+a:a)}),c)},hasClass:function(a){return r(this[0],a)},each:function(a){return D(this,a)},on:function(a,b){return this.each(function(){k.bind(this,a,b)})},off:function(a,b){return this.each(function(){k.unbind(this,a,b)})},trigger:function(a){return this.each(function(){"object"==typeof a?k.fire(this,a.type,a):k.fire(this,a)})},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},slice:function(){return new z(i.apply(this,arguments))},eq:function(a){return-1===a?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:function(a){var b,c,d=[];for(b=0,c=this.length;b<c;b++)z.find(a,this[b],d);return z(d)},filter:function(a){return z("function"==typeof a?E(this.toArray(),function(b,c){return a(c,b)}):z.filter(a,this.toArray()))},closest:function(a){var b=[];return a instanceof z&&(a=a[0]),this.each(function(c,d){for(;d;){if("string"==typeof a&&z(d).is(a)){b.push(d);break}if(d==a){b.push(d);break}d=d.parentNode}}),z(b)},offset:function(a){var b,c,d,e,f=0,g=0;return a?this.css(a):((b=this[0])&&(c=b.ownerDocument,d=c.documentElement,b.getBoundingClientRect&&(e=b.getBoundingClientRect(),f=e.left+(d.scrollLeft||c.body.scrollLeft)-d.clientLeft,g=e.top+(d.scrollTop||c.body.scrollTop)-d.clientTop)),{left:f,top:g})},push:h,sort:[].sort,splice:[].splice},e.extend(z,{extend:e.extend,makeArray:function(a){return function(a){return a&&a==a.window}(a)||a.nodeType?[a]:e.toArray(a)},inArray:function(a,b){var c;if(b.indexOf)return b.indexOf(a);for(c=b.length;c--;)if(b[c]===a)return c;return-1},isArray:e.isArray,each:D,trim:C,grep:E,find:c,expr:c.selectors,unique:c.uniqueSort,text:c.getText,contains:c.contains,filter:function(a,b,c){var d=b.length;for(c&&(a=":not("+a+")");d--;)1!=b[d].nodeType&&b.splice(d,1);return b=1===b.length?z.find.matchesSelector(b[0],a)?[b[0]]:[]:z.find.matches(a,b)}});var G=function(a,b,c){var d=[],e=a[b];for("string"!=typeof c&&c instanceof z&&(c=c[0]);e&&9!==e.nodeType;){if(void 0!==c){if(e===c)break;if("string"==typeof c&&z(e).is(c))break}1===e.nodeType&&d.push(e),e=e[b]}return d},H=function(a,b,c,d){var e=[];for(d instanceof z&&(d=d[0]);a;a=a[b])if(!c||a.nodeType===c){if(void 0!==d){if(a===d)break;if("string"==typeof d&&z(a).is(d))break}e.push(a)}return e},I=function(a,b,c){for(a=a[b];a;a=a[b])if(a.nodeType==c)return a;return null};D({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return G(a,"parentNode")},next:function(a){return I(a,"nextSibling",1)},prev:function(a){return I(a,"previousSibling",1)},children:function(a){return H(a.firstChild,"nextSibling",1)},contents:function(a){return e.toArray(("iframe"===a.nodeName?a.contentDocument||a.contentWindow.document:a).childNodes)}},function(a,b){z.fn[a]=function(c){var e=[];return this.each(function(){var a=b.call(e,this,c,e);a&&(z.isArray(a)?e.push.apply(e,a):e.push(a))}),this.length>1&&(l[a]||(e=z.unique(e)),0===a.indexOf("parents")&&(e=e.reverse())),e=z(e),c?e.filter(c):e}}),D({parentsUntil:function(a,b){return G(a,"parentNode",b)},nextUntil:function(a,b){return H(a,"nextSibling",1,b).slice(1)},prevUntil:function(a,b){return H(a,"previousSibling",1,b).slice(1)}},function(a,b){z.fn[a]=function(c,d){var f=[];return this.each(function(){var a=b.call(f,this,c,f);a&&(z.isArray(a)?f.push.apply(f,a):f.push(a))}),this.length>1&&(f=z.unique(f),0!==a.indexOf("parents")&&"prevUntil"!==a||(f=f.reverse())),f=z(f),d?f.filter(d):f}}),z.fn.is=function(a){return!!a&&this.filter(a).length>0},z.fn.init.prototype=z.fn,z.overrideDefaults=function(a){var b,c=function(d,e){return b=b||a(),0===arguments.length&&(d=b.element),e||(e=b.context),new c.fn.init(d,e)};return z.extend(c,this),c};var J=function(a,b,c){D(c,function(c,d){a[c]=a[c]||{},a[c][b]=d})};return d.ie&&d.ie<8&&(J(x,"get",{maxlength:function(a){var b=a.maxLength;return 2147483647===b?f:b},size:function(a){var b=a.size;return 20===b?f:b},class:function(a){return a.className},style:function(a){var b=a.style.cssText;return 0===b.length?f:b}}),J(x,"set",{class:function(a,b){a.className=b},style:function(a,b){a.style.cssText=b}})),d.ie&&d.ie<9&&(w.float="styleFloat",J(y,"set",{opacity:function(a,b){var c=a.style;null===b||""===b?c.removeAttribute("filter"):(c.zoom=1,c.filter="alpha(opacity="+100*b+")")}})),z.attrHooks=x,z.cssHooks=y,z}),g("4z",[],function(){return{cached:function(a){var b,c=!1;return function(){return c||(c=!0,b=a.apply(null,arguments)),b}}}}),h("74",Number),g("6q",["1i","74","3b"],function(a,b,c){var e=function(a,c){var e=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.test(b))return d}}(a,c);if(!e)return{major:0,minor:0};var f=function(a){return b(c.replace(e,"$"+a))};return h(f(1),f(2))},g=function(){return h(0,0)},h=function(a,b){return{major:a,minor:b}};return{nu:h,detect:function(a,b){var d=c(b).toLowerCase();return 0===a.length?g():e(a,d)},unknown:g}}),g("66",["1","6q"],function(a,b){var c="Edge",d="Chrome",f="Opera",g="Firefox",h="Safari",i=function(a,b){return function(){return b===a}},k=function(a){var b=a.current;return{current:b,version:a.version,isEdge:i(c,b),isChrome:i(d,b),isIE:i("IE",b),isOpera:i(f,b),isFirefox:i(g,b),isSafari:i(h,b)}};return{unknown:function(){return k({current:void 0,version:b.unknown()})},nu:k,edge:a.constant(c),chrome:a.constant(d),ie:a.constant("IE"),opera:a.constant(f),firefox:a.constant(g),safari:a.constant(h)}}),g("67",["1","6q"],function(a,b){var c="Windows",e="Android",f="Linux",h="Solaris",i="FreeBSD",j=function(a,b){return function(){return b===a}},l=function(a){var b=a.current;return{current:b,version:a.version,isWindows:j(c,b),isiOS:j("iOS",b),isAndroid:j(e,b),isOSX:j("OSX",b),isLinux:j(f,b),isSolaris:j(h,b),isFreeBSD:j(i,b)}};return{unknown:function(){return l({current:void 0,version:b.unknown()})},nu:l,windows:a.constant(c),ios:a.constant("iOS"),android:a.constant(e),linux:a.constant(f),osx:a.constant("OSX"),solaris:a.constant(h),freebsd:a.constant(i)}}),g("68",["1"],function(a){return function(b,c,d){var e=b.isiOS()&&!0===/ipad/i.test(d),f=b.isiOS()&&!e,g=b.isAndroid()&&3===b.version.major,h=b.isAndroid()&&4===b.version.major,i=e||g||h&&!0===/mobile/i.test(d),j=b.isiOS()||b.isAndroid(),k=j&&!i,l=c.isSafari()&&b.isiOS()&&!1===/safari/i.test(d);return{isiPad:a.constant(e),isiPhone:a.constant(f),isTablet:a.constant(i),isPhone:a.constant(k),isTouch:a.constant(j),isAndroid:b.isAndroid,isiOS:b.isiOS,isWebView:a.constant(l)}}}),g("69",["1i","6q","3b"],function(a,b,c){var d=function(b,d){var e=c(d).toLowerCase();return a.find(b,function(a){return a.search(e)})};return{detectBrowser:function(a,c){return d(a,c).map(function(a){var d=b.detect(a.versionRegexes,c);return{current:a.name,version:d}})},detectOs:function(a,c){return d(a,c).map(function(a){var d=b.detect(a.versionRegexes,c);return{current:a.name,version:d}})}}}),g("53",[],function(){return{addToStart:function(a,b){return b+a},addToEnd:function(a,b){return a+b},removeFromStart:function(a,b){return a.substring(b)},removeFromEnd:function(a,b){return a.substring(0,a.length-b)}}}),g("54",["2n","5"],function(a,b){return{first:function(a,b){return a.substr(0,b)},last:function(a,b){return a.substr(a.length-b,a.length)},head:function(b){return""===b?a.none():a.some(b.substr(0,1))},tail:function(b){return""===b?a.none():a.some(b.substring(1))}}}),g("4h",["53","54","5"],function(a,b,c){var d=function(a,b,c){if(""===b)return!0;if(a.length<b.length)return!1;return a.substr(c,c+b.length)===b},l=function(a,b){return d(a,b,0)},m=function(a,b){return d(a,b,a.length-b.length)};return{supplant:function(a,b){return a.replace(/\${([^{}]*)}/g,function(a,d){var e=b[d];return function(a){var b=typeof e;return"string"===b||"number"===b}()?e:a})},startsWith:l,removeLeading:function(b,c){return l(b,c)?a.removeFromStart(b,c.length):b},removeTrailing:function(b,c){return m(b,c)?a.removeFromEnd(b,c.length):b},ensureLeading:function(b,c){return l(b,c)?b:a.addToStart(b,c)},ensureTrailing:function(b,c){return m(b,c)?b:a.addToEnd(b,c)},endsWith:m,contains:function(a,b){return-1!==a.indexOf(b)},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},lTrim:function(a){return a.replace(/^\s+/g,"")},rTrim:function(a){return a.replace(/\s+$/g,"")},capitalize:function(a){return b.head(a).bind(function(c){return b.tail(a).map(function(a){return c.toUpperCase()+a})}).getOr(a)}}}),g("6a",["1","4h"],function(a,b){var c=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,d=function(a){return function(c){return b.contains(c,a)}},e=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(a){return b.contains(a,"edge/")&&b.contains(a,"chrome")&&b.contains(a,"safari")&&b.contains(a,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,c],search:function(a){return b.contains(a,"chrome")&&!b.contains(a,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(a){return b.contains(a,"msie")||b.contains(a,"trident")}},{name:"Opera",versionRegexes:[c,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:d("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:d("firefox")},{name:"Safari",versionRegexes:[c,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(a){return(b.contains(a,"safari")||b.contains(a,"mobile/"))&&b.contains(a,"applewebkit")}}],f=[{name:"Windows",search:d("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(a){return b.contains(a,"iphone")||b.contains(a,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:d("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:d("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:d("linux"),versionRegexes:[]},{name:"Solaris",search:d("sunos"),versionRegexes:[]},{name:"FreeBSD",search:d("freebsd"),versionRegexes:[]}];return{browsers:a.constant(e),oses:a.constant(f)}}),g("50",["66","67","68","69","6a"],function(a,b,c,d,e){return{detect:function(f){var g=e.browsers(),h=e.oses(),i=d.detectBrowser(g,f).fold(a.unknown,a.nu),j=d.detectOs(h,f).fold(b.unknown,b.nu);return{browser:i,os:j,deviceType:c(j,i,f)}}}}),g("3d",["4z","50","1m"],function(a,b,c){return{detect:a.cached(function(){var a=c.userAgent;return b.detect(a)})}}),g("3e",[],function(){return"undefined"==typeof console&&(console={log:function(){}}),console}),g("1v",["1","5","3e","1j"],function(a,b,c,d){var h=function(c){if(null===c||void 0===c)throw new b("Node cannot be null or undefined");return{dom:a.constant(c)}};return{fromHtml:function(a,b){var f=(b||d).createElement("div");if(f.innerHTML=a,!f.hasChildNodes()||f.childNodes.length>1)throw c.error("HTML does not have a single root node",a),"HTML must have a single root node";return h(f.childNodes[0])},fromTag:function(a,b){var e=(b||d).createElement(a);return h(e)},fromText:function(a,b){var e=(b||d).createTextNode(a);return h(e)},fromDom:h}}),g("4d",[],function(){return{ATTRIBUTE:2,CDATA_SECTION:4,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,ELEMENT:1,TEXT:3,PROCESSING_INSTRUCTION:7,ENTITY_REFERENCE:5,ENTITY:6,NOTATION:12}}),g("3f",["4d"],function(a){var b=function(a){return a.dom().nodeName.toLowerCase()},c=function(a){return a.dom().nodeType},e=function(a){return function(b){return c(b)===a}},g=e(a.ELEMENT),h=e(a.TEXT),i=e(a.DOCUMENT);return{name:b,type:c,value:function(a){return a.dom().nodeValue},isElement:g,isText:h,isDocument:i,isComment:function(d){return c(d)===a.COMMENT||"#comment"===b(d)}}}),g("28",["4","3b"],function(a,b){var c=function(c){if(null===c)return"null";var d=typeof c;return"object"===d&&a.prototype.isPrototypeOf(c)?"array":"object"===d&&b.prototype.isPrototypeOf(c)?"string":d},d=function(a){return function(b){return c(b)===a}};return{isString:d("string"),isObject:d("object"),isArray:d("array"),isNull:d("null"),isBoolean:d("boolean"),isUndefined:d("undefined"),isFunction:d("function"),isNumber:d("number")}}),g("4g",["2n","3a"],function(a,b){var c=function(){var a=b.keys;return void 0===a?function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}:a}(),d=function(a,b){for(var d=c(a),e=0,f=d.length;e<f;e++){var g=d[e];b(a[g],g,a)}},f=function(a,b){var c={};return d(a,function(d,e){var f=b(d,e,a);c[f.k]=f.v}),c},h=function(a,b){var c=[];return d(a,function(a,d){c.push(b(a,d))}),c},j=function(a){return h(a,function(a){return a})};return{bifilter:function(a,b){var c={},e={};return d(a,function(a,d){(b(a,d)?c:e)[d]=a}),{t:c,f:e}},each:d,map:function(a,b){return f(a,function(a,c,d){return{k:c,v:b(a,c,d)}})},mapToArray:h,tupleMap:f,find:function(b,d){for(var e=c(b),f=0,g=e.length;f<g;f++){var h=e[f],i=b[h];if(d(i,h,b))return a.some(i)}return a.none()},keys:c,values:j,size:function(a){return j(a).length}}}),g("48",["28","1i","4g","3f","5","3e"],function(a,b,c,d,e,f){var g=function(b,c,d){if(!(a.isString(d)||a.isBoolean(d)||a.isNumber(d)))throw f.error("Invalid call to Attr.set. Key ",c,":: Value ",d,":: Element ",b),new e("Attribute value was not simple");b.setAttribute(c,d+"")},h=function(a,b,c){g(a.dom(),b,c)},j=function(a,b){var c=a.dom().getAttribute(b);return null===c?void 0:c},k=function(a,b){var c=a.dom();return!(!c||!c.hasAttribute)&&c.hasAttribute(b)};return{clone:function(a){return b.foldl(a.dom().attributes,function(a,b){return a[b.name]=b.value,a},{})},set:h,setAll:function(a,b){var d=a.dom();c.each(b,function(a,b){g(d,b,a)})},get:j,has:k,remove:function(a,b){a.dom().removeAttribute(b)},hasNone:function(a){var b=a.dom().attributes;return void 0===b||null===b||0===b.length},transfer:function(a,c,e){d.isElement(a)&&d.isElement(c)&&b.each(e,function(b){!function(a,b,c){k(a,c)&&!k(b,c)&&h(b,c,j(a,c))}(a,c,b)})}}}),g("51",["4z","1v","3f","1j"],function(a,b,c,d){var f=a.cached(function(){return g(b.fromDom(d))}),g=function(a){var c=a.dom().body;if(null===c||void 0===c)throw"Body is not available yet";return b.fromDom(c)};return{body:f,getBody:g,inBody:function(a){var b=c.isText(a)?a.dom().parentNode:a.dom();return void 0!==b&&null!==b&&b.ownerDocument.body.contains(b)}}}),g("52",[],function(){return{isSupported:function(a){return void 0!==a.style}}}),g("3g",["28","1i","4g","2n","48","51","1v","3f","52","4h","5","3e","2"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=function(b,c,d){if(!a.isString(d))throw l.error("Invalid call to CSS.set. Property ",c,":: Value ",d,":: Element ",b),new k("CSS value must be a string: "+d);i.isSupported(b)&&b.style.setProperty(c,d)},o=function(a,b){i.isSupported(a)&&a.style.removeProperty(b)},p=function(a,b,c){var d=a.dom();n(d,b,c)},t=function(a,b){return i.isSupported(a)?a.style.getPropertyValue(b):""},u=function(a,b){var c=a.dom(),e=t(c,b);return d.from(e).filter(function(a){return a.length>0})};return{copy:function(a,b){var c=a.dom(),d=b.dom();i.isSupported(c)&&i.isSupported(d)&&(d.style.cssText=c.style.cssText)},set:p,preserve:function(a,b){var c=e.get(a,"style"),d=b(a);return(void 0===c?e.remove:e.set)(a,"style",c),d},setAll:function(a,b){var d=a.dom();c.each(b,function(a,b){n(d,b,a)})},setOptions:function(a,b){var d=a.dom();c.each(b,function(a,b){a.fold(function(){o(d,b)},function(a){n(d,b,a)})})},remove:function(a,b){var c=a.dom();o(c,b),e.has(a,"style")&&""===j.trim(e.get(a,"style"))&&e.remove(a,"style")},get:function(a,b){var c=a.dom(),e=m.getComputedStyle(c).getPropertyValue(b),g=""!==e||f.inBody(a)?e:t(c,b);return null===g?void 0:g},getRaw:u,getAllRaw:function(a){var b={},c=a.dom();if(i.isSupported(c))for(var d=0;d<c.style.length;d++){var e=c.style.item(d);b[e]=c.style[e]}return b},isValidValue:function(a,b,c){var d=g.fromTag(a);p(d,b,c);return u(d,b).isSome()},reflow:function(a){return a.dom().offsetWidth},transfer:function(a,c,d){h.isElement(a)&&h.isElement(c)&&b.each(d,function(b){!function(a,b,c){u(a,c).each(function(a){u(b,c).isNone()&&p(b,c,a)})}(a,c,b)})}}}),g("55",["1i","1","4","5"],function(a,b,c,d){return function(){var e=arguments;return function(){for(var f=new c(arguments.length),g=0;g<f.length;g++)f[g]=arguments[g];if(e.length!==f.length)throw new d('Wrong number of arguments to struct. Expected "['+e.length+']", got '+f.length+" arguments");var h={};return a.each(e,function(a,c){h[a]=b.constant(f[c])}),h}}}),g("6b",["1i","28","5"],function(a,b,c){var d=function(a){return a.slice(0).sort()};return{sort:d,reqMessage:function(a,b){throw new c("All required keys ("+d(a).join(", ")+") were not specified. Specified keys were: "+d(b).join(", ")+".")},unsuppMessage:function(a){throw new c("Unsupported keys for object: "+d(a).join(", "))},validateStrArr:function(d,e){if(!b.isArray(e))throw new c("The "+d+" fields must be an array. Was: "+e+".");a.each(e,function(a){if(!b.isString(a))throw new c("The value "+a+" in the "+d+" fields was not a string.")})},invalidTypeMessage:function(a,b){throw new c("All values need to be of type: "+b+". Keys ("+d(a).join(", ")+") were not.")},checkDupes:function(b){var e=d(b);a.find(e,function(a,b){return b<e.length-1&&a===e[b+1]}).each(function(a){throw new c("The field: "+a+" occurs more than once in the combined fields: ["+e.join(", ")+"].")})}}}),g("56",["1i","1","4g","2n","6b","5","3a"],function(a,b,c,d,e,f,g){return function(h,i){var j=h.concat(i);if(0===j.length)throw new f("You must specify at least one required or optional field.");return e.validateStrArr("required",h),e.validateStrArr("optional",i),e.checkDupes(j),function(f){var k=c.keys(f);a.forall(h,function(b){return a.contains(k,b)})||e.reqMessage(h,k);var m=a.filter(k,function(b){return!a.contains(j,b)});m.length>0&&e.unsuppMessage(m);var n={};return a.each(h,function(a){n[a]=b.constant(f[a])}),a.each(i,function(a){n[a]=b.constant(g.prototype.hasOwnProperty.call(f,a)?d.some(f[a]):d.none())}),n}}}),g("45",["55","56"],function(a,b){return{immutable:a,immutableBag:b}}),g("57",[],function(){return{toArray:function(a,b){var c=[],d=function(a){return c.push(a),b(a)},e=b(a);do{e=e.bind(d)}while(e.isSome());return c}}}),g("4c",["3c"],function(a){var b=function(){return a.getOrDie("Node")},c=function(a,b,c){return 0!=(a.compareDocumentPosition(b)&c)};return{documentPositionPreceding:function(a,d){return c(a,d,b().DOCUMENT_POSITION_PRECEDING)},documentPositionContainedBy:function(a,d){return c(a,d,b().DOCUMENT_POSITION_CONTAINED_BY)}}}),g("2z",["1i","2n","1v","4d","5","1j"],function(a,b,c,d,e,f){var g=d.ELEMENT,h=d.DOCUMENT,j=function(a){return a.nodeType!==g&&a.nodeType!==h||0===a.childElementCount};return{all:function(b,d){var e=void 0===d?f:d.dom();return j(e)?[]:a.map(e.querySelectorAll(b),c.fromDom)},is:function(a,b){var c=a.dom();if(c.nodeType!==g)return!1;if(void 0!==c.matches)return c.matches(b);if(void 0!==c.msMatchesSelector)return c.msMatchesSelector(b);if(void 0!==c.webkitMatchesSelector)return c.webkitMatchesSelector(b);if(void 0!==c.mozMatchesSelector)return c.mozMatchesSelector(b);throw new e("Browser lacks native selectors")},one:function(a,d){var e=void 0===d?f:d.dom();return j(e)?b.none():b.from(e.querySelector(a)).map(c.fromDom)}}}),g("31",["1i","1","4c","3d","2z"],function(a,b,c,d,e){var f=function(a,b){return a.dom()===b.dom()},l=d.detect().browser.isIE()?function(a,b){return c.documentPositionContainedBy(a.dom(),b.dom())}:function(a,b){var c=a.dom(),d=b.dom();return c!==d&&c.contains(d)};return{eq:f,isEqualNode:function(a,b){return a.dom().isEqualNode(b.dom())},member:function(c,d){return a.exists(d,b.curry(f,c))},contains:l,is:e.is}}),g("3h",["28","1i","1","2n","45","57","31","1v"],function(a,b,c,d,e,f,g,h){var i=function(a){return h.fromDom(a.dom().ownerDocument)},l=function(a){var b=a.dom();return d.from(b.parentNode).map(h.fromDom)},q=function(a){var b=a.dom();return d.from(b.previousSibling).map(h.fromDom)},r=function(a){var b=a.dom();return d.from(b.nextSibling).map(h.fromDom)},u=function(a){var c=a.dom();return b.map(c.childNodes,h.fromDom)},v=function(a,b){var c=a.dom().childNodes;return d.from(c[b]).map(h.fromDom)},z=e.immutable("element","offset");return{owner:i,defaultView:function(a){var c=a.dom().ownerDocument.defaultView;return h.fromDom(c)},documentElement:function(a){var b=i(a);return h.fromDom(b.dom().documentElement)},parent:l,findIndex:function(a){return l(a).bind(function(c){var d=u(c);return b.findIndex(d,function(b){return g.eq(a,b)})})},parents:function(b,d){for(var e=a.isFunction(d)?d:c.constant(!1),f=b.dom(),g=[];null!==f.parentNode&&void 0!==f.parentNode;){var i=f.parentNode,j=h.fromDom(i);if(g.push(j),!0===e(j))break;f=i}return g},siblings:function(a){return l(a).map(u).map(function(c){return b.filter(c,function(b){return!g.eq(a,b)})}).getOr([])},prevSibling:q,offsetParent:function(a){var b=a.dom();return d.from(b.offsetParent).map(h.fromDom)},prevSiblings:function(a){return b.reverse(f.toArray(a,q))},nextSibling:r,nextSiblings:function(a){return f.toArray(a,r)},children:u,child:v,firstChild:function(a){return v(a,0)},lastChild:function(a){return v(a,a.dom().childNodes.length-1)},childNodesCount:function(a,b){return a.dom().childNodes.length},leaf:function(a,b){var c=u(a);return c.length>0&&b<c.length?z(c[b],0):z(a,b)}}}),g("1s",["1i","3d","1v","3f","3g","3h"],function(a,b,c,d,e,f){var g=b.detect().browser,h=function(b){return a.find(b,d.isElement)},i=function(a){return g.isFirefox()&&"table"===d.name(a)?h(f.children(a)).filter(function(a){return"caption"===d.name(a)}).bind(function(a){return h(f.nextSiblings(a)).map(function(b){var c=b.dom().offsetTop,d=a.dom().offsetTop,e=a.dom().offsetHeight;return c<=d?-e:0})}).getOr(0):0};return{getPos:function(a,b,d){var f,g,h=0,j=0,k=a.ownerDocument;if(d=d||a,b){if(d===a&&b.getBoundingClientRect&&"static"===e.get(c.fromDom(a),"position"))return g=b.getBoundingClientRect(),h=g.left+(k.documentElement.scrollLeft||a.scrollLeft)-k.documentElement.clientLeft,j=g.top+(k.documentElement.scrollTop||a.scrollTop)-k.documentElement.clientTop,{x:h,y:j};for(f=b;f&&f!==d&&f.nodeType;)h+=f.offsetLeft||0,j+=f.offsetTop||0,f=f.offsetParent;for(f=b.parentNode;f&&f!==d&&f.nodeType;)h-=f.scrollLeft||0,j-=f.scrollTop||0,f=f.parentNode;j+=i(c.fromDom(b))}return{x:h,y:j}}}}),g("58",["1i","2n","1q"],function(a,b,c){var d=function(e){var f=b.none(),g=[],i=function(a){k()?m(a):g.push(a)},k=function(){return f.isSome()},l=function(b){a.each(b,m)},m=function(a){f.each(function(b){c(function(){a(b)},0)})};return e(function(a){f=b.some(a),l(g),g=[]}),{get:i,map:function(a){return d(function(b){i(function(c){b(a(c))})})},isReady:k}};return{nu:d,pure:function(a){return d(function(b){b(a)})}}}),g("59",["4","1q"],function(a,b){return{bounce:function(c){return function(){var d=a.prototype.slice.call(arguments),e=this;b(function(){c.apply(e,d)},0)}}}}),g("3i",["58","59"],function(a,b){var c=function(d){var e=function(a){d(b.bounce(a))};return{map:function(a){return c(function(b){e(function(c){var d=a(c);b(d)})})},bind:function(a){return c(function(b){e(function(c){a(c).get(b)})})},anonBind:function(a){return c(function(b){e(function(c){a.get(b)})})},toLazy:function(){return a.nu(e)},get:e}};return{nu:c,pure:function(a){return c(function(b){b(a)})}}}),g("5a",["1i"],function(a){return{par:function(b,c){return c(function(c){var d=[],e=0,f=function(a){return function(f){d[a]=f,++e>=b.length&&c(d)}};0===b.length?c([]):a.each(b,function(a,b){a.get(f(b))})})}}}),g("3j",["1i","3i","5a"],function(a,b,c){var d=function(a){return c.par(a,b.nu)};return{par:d,mapM:function(b,c){var e=a.map(b,c);return d(e)},compose:function(a,b){return function(c){return b(c).bind(a)}}}}),g("3k",["1","2n"],function(a,b){var c=function(d){return{is:function(a){return d===a},isValue:a.constant(!0),isError:a.constant(!1),getOr:a.constant(d),getOrThunk:a.constant(d),getOrDie:a.constant(d),or:function(a){return c(d)},orThunk:function(a){return c(d)},fold:function(a,b){return b(d)},map:function(a){return c(a(d))},each:function(a){a(d)},bind:function(a){return a(d)},exists:function(a){return a(d)},forall:function(a){return a(d)},toOption:function(){return b.some(d)}}},d=function(c){return{is:a.constant(!1),isValue:a.constant(!1),isError:a.constant(!0),getOr:a.identity,getOrThunk:function(a){return a()},getOrDie:function(){return a.die(c)()},or:function(a){return a},orThunk:function(a){return a()},fold:function(a,b){return a(c)},map:function(a){return d(c)},each:a.noop,bind:function(a){return d(c)},exists:a.constant(!1),forall:a.constant(!0),toOption:b.none}};return{value:c,error:d}}),g("1t",["1i","1","3i","3j","3k","1m","15","1e"],function(a,b,c,d,e,f,g,h){"use strict";return function(i,j){var k,l=0,m={};k=(j=j||{}).maxLoadTime||5e3;var n=function(a){i.getElementsByTagName("head")[0].appendChild(a)},o=function(a,b,c){var d,e,j,o,p=function(){for(var a=o.passed,b=a.length;b--;)a[b]();o.status=2,o.passed=[],o.failed=[]},q=function(){for(var a=o.failed,b=a.length;b--;)a[b]();o.status=3,o.passed=[],o.failed=[]},s=function(a,b){a()||((new Date).getTime()-j<k?g.setTimeout(b):q())},t=function(){s(function(){for(var a,b,c=i.styleSheets,e=c.length;e--;)if(a=c[e],(b=a.ownerNode?a.ownerNode:a.owningElement)&&b.id===d.id)return p(),!0},t)},u=function(){s(function(){try{var a=e.sheet.cssRules;return p(),!!a}catch(a){}},u)};if(a=h._addCacheSuffix(a),m[a]?o=m[a]:(o={passed:[],failed:[]},m[a]=o),b&&o.passed.push(b),c&&o.failed.push(c),1!=o.status){if(2==o.status)return void p();if(3==o.status)return void q();if(o.status=1,d=i.createElement("link"),d.rel="stylesheet",d.type="text/css",d.id="u"+l++,d.async=!1,d.defer=!1,j=(new Date).getTime(),"onload"in d&&!function(){var a=f.userAgent.match(/WebKit\/(\d*)/);return!!(a&&a[1]<536)}())d.onload=t,d.onerror=q;else{if(f.userAgent.indexOf("Firefox")>0)return e=i.createElement("style"),e.textContent='@import "'+a+'"',u(),void n(e);t()}n(d),d.href=a}},p=function(a){return c.nu(function(c){o(a,b.compose(c,b.constant(e.value(a))),b.compose(c,b.constant(e.error(a))))})},q=function(a){return a.fold(b.identity,b.identity)};return{load:o,loadAll:function(b,c,e){d.par(a.map(b,p)).get(function(b){var d=a.partition(b,function(a){return a.isValue()});d.fail.length>0?e(d.fail.map(q)):c(d.pass.map(q))})}}}}),g("s",[],function(){return function(a,b){var c=a,d=function(a,c,d,e){var f,g;if(a){if(!e&&a[c])return a[c];if(a!=b){if(f=a[d])return f;for(g=a.parentNode;g&&g!=b;g=g.parentNode)if(f=g[d])return f}}};this.current=function(){return c},this.next=function(a){return c=d(c,"firstChild","nextSibling",a)},this.prev=function(a){return c=d(c,"lastChild","previousSibling",a)},this.prev2=function(a){return c=function(a,c,d,e){var f,g,h;if(a){if(f=a[d],b&&f===b)return;if(f){if(!e)for(h=f[c];h;h=h[c])if(!h[c])return h;return f}if((g=a.parentNode)&&g!==b)return g}}(c,"lastChild","previousSibling",a)}}}),g("3l",["1i","1","3f"],function(a,b,c){var l=function(d){var e;return function(f){return(e=e||a.mapToObject(d,b.constant(!0))).hasOwnProperty(c.name(f))}},m=l(["h1","h2","h3","h4","h5","h6"]),n=l(["article","aside","details","div","dt","figcaption","footer","form","fieldset","header","hgroup","html","main","nav","section","summary","body","p","dl","multicol","dd","figure","address","center","blockquote","h1","h2","h3","h4","h5","h6","listing","xmp","pre","plaintext","menu","dir","ul","ol","li","hr","table","tbody","thead","tfoot","th","tr","td","caption"]);return{isBlock:n,isInline:function(a){return c.isElement(a)&&!n(a)},isHeading:m,isTextBlock:l(["h1","h2","h3","h4","h5","h6","p","div","address","pre","form","blockquote","center","dir","fieldset","header","footer","article","section","hgroup","aside","nav","figure"]),isList:l(["ul","ol","dl"]),isListItem:l(["li","dd","dt"]),isVoid:l(["area","base","basefont","br","col","frame","hr","img","input","isindex","link","meta","param","embed","source","wbr","track"]),isTableSection:l(["thead","tbody","tfoot"]),isTableCell:l(["td","th"]),isBr:function(a){return c.isElement(a)&&"br"===c.name(a)}}}),g("1y",[],function(){var a=function(a){return function(b){return!!b&&b.nodeType==a}},b=a(1),c=function(a){return a=a.toLowerCase().split(" "),function(b){var c,d;if(b&&b.nodeType)for(d=b.nodeName.toLowerCase(),c=0;c<a.length;c++)if(d===a[c])return!0;return!1}},i=function(a){return function(c){if(b(c)){if(c.contentEditable===a)return!0;if(c.getAttribute("data-mce-contenteditable")===a)return!0}return!1}};return{isText:a(3),isElement:b,isComment:a(8),isDocument:a(9),isBr:c("br"),isContentEditableTrue:i("true"),isContentEditableFalse:i("false"),matchNodeNames:c,hasPropValue:function(a,c){return function(d){return b(d)&&d[a]===c}},hasAttribute:function(a,c){return function(c){return b(c)&&c.hasAttribute(a)}},hasAttributeValue:function(a,c){return function(d){return b(d)&&d.getAttribute(a)===c}},matchStyleValues:function(a,c){return c=c.toLowerCase().split(" "),function(d){var e;if(b(d))for(e=0;e<c.length;e++)if(d.ownerDocument.defaultView.getComputedStyle(d,null).getPropertyValue(a)===c[e])return!0;return!1}},isBogus:function(a){return b(a)&&a.hasAttribute("data-mce-bogus")}}}),g("1u",["1v","3l","1y","1e"],function(a,b,c,d){var f=function(a){return a&&"SPAN"===a.tagName&&"bookmark"===a.getAttribute("data-mce-type")},g=function(h,i){var j,k=i.childNodes;if(!c.isElement(i)||!f(i)){for(j=k.length-1;j>=0;j--)g(h,k[j]);if(!1===c.isDocument(i)){if(c.isText(i)&&i.nodeValue.length>0){var l=d.trim(i.nodeValue).length;if(h.isBlock(i.parentNode)||l>0)return;if(0===l&&function(a){var b=a.previousSibling&&"SPAN"===a.previousSibling.nodeName,c=a.nextSibling&&"SPAN"===a.nextSibling.nodeName;return b&&c}(i))return}else if(c.isElement(i)&&(1===(k=i.childNodes).length&&f(k[0])&&i.parentNode.insertBefore(k[0],i),k.length||b.isVoid(a.fromDom(i))))return;h.remove(i)}return i}};return{trimNode:g}}),g("v",["1v","1e"],function(a,b){var c,d,e,f=b.makeMap,g=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,h=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,i=/[<>&\"\']/g,j=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi,k={128:"€",130:"‚",131:"ƒ",132:"„",133:"…",134:"†",135:"‡",136:"ˆ",137:"‰",138:"Š",139:"‹",140:"Œ",142:"Ž",145:"‘",146:"’",147:"“",148:"”",149:"•",150:"–",151:"—",152:"˜",153:"™",154:"š",155:"›",156:"œ",158:"ž",159:"Ÿ"};d={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;","`":"&#96;"},e={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"};var l=function(b){var c;return c=a.fromTag("div").dom(),c.innerHTML=b,c.textContent||c.innerText||b},m=function(a,b){var c,e,f,g={};if(a){for(a=a.split(","),b=b||10,c=0;c<a.length;c+=2)e=String.fromCharCode(parseInt(a[c],b)),d[e]||(f="&"+a[c+1]+";",g[e]=f,g[f]=e);return g}};c=m("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32);var n={encodeRaw:function(a,b){return a.replace(b?g:h,function(a){return d[a]||a})},encodeAllRaw:function(a){return(""+a).replace(i,function(a){return d[a]||a})},encodeNumeric:function(a,b){return a.replace(b?g:h,function(a){return a.length>1?"&#"+(1024*(a.charCodeAt(0)-55296)+(a.charCodeAt(1)-56320)+65536)+";":d[a]||"&#"+a.charCodeAt(0)+";"})},encodeNamed:function(a,b,e){return e=e||c,a.replace(b?g:h,function(a){return d[a]||e[a]||a})},getEncodeFunc:function(a,b){b=m(b)||c;return(a=f(a.replace(/\+/g,","))).named&&a.numeric?function(a,c){return a.replace(c?g:h,function(a){return void 0!==d[a]?d[a]:void 0!==b[a]?b[a]:a.length>1?"&#"+(1024*(a.charCodeAt(0)-55296)+(a.charCodeAt(1)-56320)+65536)+";":"&#"+a.charCodeAt(0)+";"})}:a.named?b?function(a,c){return n.encodeNamed(a,c,b)}:n.encodeNamed:a.numeric?n.encodeNumeric:n.encodeRaw},decode:function(a){return a.replace(j,function(a,b){return b?(b="x"===b.charAt(0).toLowerCase()?parseInt(b.substr(1),16):parseInt(b,10))>65535?(b-=65536,String.fromCharCode(55296+(b>>10),56320+(1023&b))):k[b]||String.fromCharCode(b):e[a]||c[a]||l(a)})}};return n}),g("y",["1e"],function(a){var b={},c={},d=a.makeMap,e=a.each,f=a.extend,g=a.explode,h=a.inArray,i=function(b,c){return(b=a.trim(b))?b.split(c||" "):[]},j=function(a){var d,f,g,h,j,k,l={},m=function(a,b,e){var f,g,h,j=function(a,b){var c,d,e={};for(c=0,d=a.length;c<d;c++)e[a[c]]=b||{};return e};for(e=e||[],b=b||"","string"==typeof e&&(e=i(e)),f=(a=i(a)).length;f--;)g=i([d,b].join(" ")),h={attributes:j(g),attributesOrder:g,children:j(e,c)},l[a[f]]=h},n=function(a,b){var c,d,e,f;for(c=(a=i(a)).length,b=i(b);c--;)for(d=l[a[c]],e=0,f=b.length;e<f;e++)d.attributes[b[e]]={},d.attributesOrder.push(b[e])};return b[a]?b[a]:(d="id accesskey class dir lang style tabindex title role",f="address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul",g="a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment","html4"!=a&&(d+=" contenteditable contextmenu draggable dropzone hidden spellcheck translate",f+=" article aside details dialog figure header footer hgroup section nav",g+=" audio canvas command datalist mark meter output picture progress time wbr video ruby bdi keygen"),"html5-strict"!=a&&(d+=" xml:lang",k="acronym applet basefont big font strike tt",g=[g,k].join(" "),e(i(k),function(a){m(a,"",g)}),j="center dir isindex noframes",f=[f,j].join(" "),h=[f,g].join(" "),e(i(j),function(a){m(a,"",h)})),h=h||[f,g].join(" "),m("html","manifest","head body"),m("head","","base command link meta noscript script style title"),m("title hr noscript br"),m("base","href target"),m("link","href rel media hreflang type sizes hreflang"),m("meta","name http-equiv content charset"),m("style","media type scoped"),m("script","src async defer type charset"),m("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload",h),m("address dt dd div caption","",h),m("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",g),m("blockquote","cite",h),m("ol","reversed start type","li"),m("ul","","li"),m("li","value",h),m("dl","","dt dd"),m("a","href target rel media hreflang type",g),m("q","cite",g),m("ins del","cite datetime",h),m("img","src sizes srcset alt usemap ismap width height"),m("iframe","src name width height",h),m("embed","src type width height"),m("object","data type typemustmatch name usemap form width height",[h,"param"].join(" ")),m("param","name value"),m("map","name",[h,"area"].join(" ")),m("area","alt coords shape href target rel media hreflang type"),m("table","border","caption colgroup thead tfoot tbody tr"+("html4"==a?" col":"")),m("colgroup","span","col"),m("col","span"),m("tbody thead tfoot","","tr"),m("tr","","td th"),m("td","colspan rowspan headers",h),m("th","colspan rowspan headers scope abbr",h),m("form","accept-charset action autocomplete enctype method name novalidate target",h),m("fieldset","disabled form name",[h,"legend"].join(" ")),m("label","form for",g),m("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"),m("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value","html4"==a?h:g),m("select","disabled form multiple name required size","option optgroup"),m("optgroup","disabled label","option"),m("option","disabled label selected value"),m("textarea","cols dirname disabled form maxlength name readonly required rows wrap"),m("menu","type label",[h,"li"].join(" ")),m("noscript","",h),"html4"!=a&&(m("wbr"),m("ruby","",[g,"rt rp"].join(" ")),m("figcaption","",h),m("mark rt rp summary bdi","",g),m("canvas","width height",h),m("video","src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered",[h,"track source"].join(" ")),m("audio","src crossorigin preload autoplay mediagroup loop muted controls buffered volume",[h,"track source"].join(" ")),m("picture","","img source"),m("source","src srcset type media sizes"),m("track","kind src srclang label default"),m("datalist","",[g,"option"].join(" ")),m("article section nav aside header footer","",h),m("hgroup","","h1 h2 h3 h4 h5 h6"),m("figure","",[h,"figcaption"].join(" ")),m("time","datetime",g),m("dialog","open",h),m("command","type label icon disabled checked radiogroup command"),m("output","for form name",g),m("progress","value max",g),m("meter","value min max low high optimum",g),m("details","open",[h,"summary"].join(" ")),m("keygen","autofocus challenge disabled form keytype name")),"html5-strict"!=a&&(n("script","language xml:space"),n("style","xml:space"),n("object","declare classid code codebase codetype archive standby align border hspace vspace"),n("embed","align name hspace vspace"),n("param","valuetype type"),n("a","charset name rev shape coords"),n("br","clear"),n("applet","codebase archive code object alt name width height align hspace vspace"),n("img","name longdesc align border hspace vspace"),n("iframe","longdesc frameborder marginwidth marginheight scrolling align"),n("font basefont","size color face"),n("input","usemap align"),n("select","onchange"),n("textarea"),n("h1 h2 h3 h4 h5 h6 div p legend caption","align"),n("ul","type compact"),n("li","type"),n("ol dl menu dir","compact"),n("pre","width xml:space"),n("hr","align noshade size width"),n("isindex","prompt"),n("table","summary width frame rules cellspacing cellpadding align bgcolor"),n("col","width align char charoff valign"),n("colgroup","width align char charoff valign"),n("thead","align char charoff valign"),n("tr","align char charoff valign bgcolor"),n("th","axis align char charoff valign nowrap bgcolor width height"),n("form","accept"),n("td","abbr axis scope align char charoff valign nowrap bgcolor width height"),n("tfoot","align char charoff valign"),n("tbody","align char charoff valign"),n("area","nohref"),n("body","background bgcolor text link vlink alink")),"html4"!=a&&(n("input button select textarea","autofocus"),n("input textarea","placeholder"),n("a","download"),n("link script img","crossorigin"),n("iframe","sandbox seamless allowfullscreen")),e(i("a form meter progress dfn"),function(a){l[a]&&delete l[a].children[a]}),delete l.caption.children.table,delete l.script,b[a]=l,l)},k=function(a,b){var c;return a&&(c={},"string"==typeof a&&(a={"*":a}),e(a,function(a,e){c[e]=c[e.toUpperCase()]="map"==b?d(a,/[, ]/):g(a,/[, ]/)})),c};return function(a){var c,l,m,n,o,p,q,r,s,t,u,v,w,x=this,y={},z={},A=[],B={},C={},D=function(c,e,g){var h=a[c];return h?h=d(h,/[, ]/,d(h.toUpperCase(),/[, ]/)):(h=b[c])||(h=d(e," ",d(e.toUpperCase()," ")),h=f(h,g),b[c]=h),h};m=j((a=a||{}).schema),!1===a.verify_html&&(a.valid_elements="*[*]"),c=k(a.valid_styles),l=k(a.invalid_styles,"map"),r=k(a.valid_classes,"map"),n=D("whitespace_elements","pre script noscript style textarea video audio iframe object code"),o=D("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),p=D("short_ended_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr track"),q=D("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"),t=D("non_empty_elements","td th iframe video audio object script pre code",p),u=D("move_caret_before_on_enter_elements","table",t),v=D("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside nav figure"),s=D("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup figcaption",v),w=D("text_inline_elements","span strong b em i font strike u var cite dfn code mark q sup sub samp"),e((a.special||"script noscript noframes noembed title style textarea xmp").split(" "),function(a){C[a]=new RegExp("</"+a+"[^>]*>","gi")});var E=function(a){return new RegExp("^"+a.replace(/([?+*])/g,".$1")+"$")},F=function(a){var b,c,e,f,g,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)\])?$/,z=/^([!\-])?(\w+[\\:]:\w+|[^=:<]+)?(?:([=:<])(.*))?$/,B=/[*?+]/;if(a)for(a=i(a,","),y["@"]&&(t=y["@"].attributes,u=y["@"].attributesOrder),b=0,c=a.length;b<c;b++)if(g=x.exec(a[b])){if(r=g[1],m=g[2],s=g[3],l=g[5],p={},q=[],j={attributes:p,attributesOrder:q},"#"===r&&(j.paddEmpty=!0),"-"===r&&(j.removeEmpty=!0),"!"===g[4]&&(j.removeEmptyAttrs=!0),t){for(v in t)p[v]=t[v];q.push.apply(q,u)}if(l)for(l=i(l,"|"),e=0,f=l.length;e<f;e++)if(g=z.exec(l[e])){if(k={},o=g[1],n=g[2].replace(/[\\:]:/g,":"),r=g[3],w=g[4],"!"===o&&(j.attributesRequired=j.attributesRequired||[],j.attributesRequired.push(n),k.required=!0),"-"===o){delete p[n],q.splice(h(q,n),1);continue}r&&("="===r&&(j.attributesDefault=j.attributesDefault||[],j.attributesDefault.push({name:n,value:w}),k.defaultValue=w),":"===r&&(j.attributesForced=j.attributesForced||[],j.attributesForced.push({name:n,value:w}),k.forcedValue=w),"<"===r&&(k.validValues=d(w,"?"))),B.test(n)?(j.attributePatterns=j.attributePatterns||[],k.pattern=E(n),j.attributePatterns.push(k)):(p[n]||q.push(n),p[n]=k)}t||"@"!=m||(t=p,u=q),s&&(j.outputName=m,y[s]=j),B.test(m)?(j.pattern=E(m),A.push(j)):y[m]=j}},G=function(a){y={},A=[],F(a),e(m,function(a,b){z[b]=a.children})},H=function(a){var c=/^(~)?(.+)$/;a&&(b.text_block_elements=b.block_elements=null,e(i(a,","),function(a){var b=c.exec(a),d="~"===b[1],g=d?"span":"div",h=b[2];if(z[h]=z[g],B[h]=g,d||(s[h.toUpperCase()]={},s[h]={}),!y[h]){var i=y[g];delete(i=f({},i)).removeEmptyAttrs,delete i.removeEmpty,y[h]=i}e(z,function(a,b){a[g]&&(z[b]=a=f({},z[b]),a[h]=a[g])})}))},I=function(c){var d=/^([+\-]?)(\w+)\[([^\]]+)\]$/;b[a.schema]=null,c&&e(i(c,","),function(a){var b,c,f=d.exec(a);f&&(c=f[1],b=c?z[f[2]]:z[f[2]]={"#comment":{}},b=z[f[2]],e(i(f[3],"|"),function(a){"-"===c?delete b[a]:b[a]={}}))})},J=function(a){var b,c=y[a];if(c)return c;for(b=A.length;b--;)if((c=A[b]).pattern.test(a))return c};a.valid_elements?G(a.valid_elements):(e(m,function(a,b){y[b]={attributes:a.attributes,attributesOrder:a.attributesOrder},z[b]=a.children}),"html5"!=a.schema&&e(i("strong/b em/i"),function(a){a=i(a,"/"),y[a[1]].outputName=a[0]}),e(i("ol ul sub sup blockquote span font a table tbody tr strong em b i"),function(a){y[a]&&(y[a].removeEmpty=!0)}),e(i("p h1 h2 h3 h4 h5 h6 th td pre div address caption li"),function(a){y[a].paddEmpty=!0}),e(i("span"),function(a){y[a].removeEmptyAttrs=!0})),H(a.custom_elements),I(a.valid_children),F(a.extended_valid_elements),I("+ol[ul|ol],+ul[ul|ol]"),e({dd:"dl",dt:"dl",li:"ul ol",td:"tr",th:"tr",tr:"tbody thead tfoot",tbody:"table",thead:"table",tfoot:"table",legend:"fieldset",area:"map",param:"video audio object"},function(a,b){y[b]&&(y[b].parentsRequired=i(a))}),a.invalid_elements&&e(g(a.invalid_elements),function(a){y[a]&&delete y[a]}),J("span")||F("span[!data-mce-type|*]"),x.children=z,x.getValidStyles=function(){return c},x.getInvalidStyles=function(){return l},x.getValidClasses=function(){return r},x.getBoolAttrs=function(){return q},x.getBlockElements=function(){return s},x.getTextBlockElements=function(){return v},x.getTextInlineElements=function(){return w},x.getShortEndedElements=function(){return p},x.getSelfClosingElements=function(){return o},x.getNonEmptyElements=function(){return t},x.getMoveCaretBeforeOnEnterElements=function(){return u},x.getWhiteSpaceElements=function(){return n},x.getSpecialElements=function(){return C},x.isValidChild=function(a,b){var c=z[a.toLowerCase()];return!(!c||!c[b.toLowerCase()])},x.isValid=function(a,b){var c,d,e=J(a);if(e){if(!b)return!0;if(e.attributes[b])return!0;if(c=e.attributePatterns)for(d=c.length;d--;)if(c[d].pattern.test(a))return!0}return!1},x.getElementRule=J,x.getCustomElements=function(){return B},x.addValidElements=F,x.setValidElements=G,x.addCustomElements=H,x.addValidChildren=I,x.elements=y}}),g("10",[],function(){return function(a,b){var c,d,e,f,g=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,h=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,i=/\s*([^:]+):\s*([^;]+);?/g,j=/\s+$/,k={},l="\ufeff";for(a=a||{},b&&(e=b.getValidStyles(),f=b.getInvalidStyles()),d=("\\\" \\' \\; \\: ; : "+l).split(" "),c=0;c<d.length;c++)k[d[c]]=l+c,k[l+c]=d[c];var m=function(a,b,c,d){var e=function(a){return(a=parseInt(a,10).toString(16)).length>1?a:"0"+a};return"#"+e(b)+e(c)+e(d)};return{toHex:function(a){return a.replace(g,m)},parse:function(b){var d,e,f,n,o={},p=a.url_converter,q=a.url_converter_scope||this,r=function(a,b,d){var e,f,g,h;if((e=o[a+"-top"+b])&&(f=o[a+"-right"+b])&&(g=o[a+"-bottom"+b])&&(h=o[a+"-left"+b])){var i=[e,f,g,h];for(c=i.length-1;c--&&i[c]===i[c+1];);c>-1&&d||(o[a+b]=-1==c?i[0]:i.join(" "),delete o[a+"-top"+b],delete o[a+"-right"+b],delete o[a+"-bottom"+b],delete o[a+"-left"+b])}},s=function(a){var b,c=o[a];if(c){for(b=(c=c.split(" ")).length;b--;)if(c[b]!==c[0])return!1;return o[a]=c[0],!0}},u=function(a){return n=!0,k[a]},v=function(a,b){return n&&(a=a.replace(/\uFEFF[0-9]/g,function(a){return k[a]})),b||(a=a.replace(/\\([\'\";:])/g,"$1")),a},w=function(a){return String.fromCharCode(parseInt(a.slice(1),16))},x=function(a){return a.replace(/\\[0-9a-f]+/gi,w)},y=function(b,c,d,e,f,g){if(f=f||g)return"'"+(f=v(f)).replace(/\'/g,"\\'")+"'";if(c=v(c||d||e),!a.allow_script_urls){var h=c.replace(/[\s\r\n]+/g,"");if(/(java|vb)script:/i.test(h))return"";if(!a.allow_svg_data_urls&&/^data:image\/svg/i.test(h))return""}return p&&(c=p.call(q,c,"style")),"url('"+c.replace(/\'/g,"\\'")+"')"};if(b){for(b=(b=b.replace(/[\u0000-\u001F]/g,"")).replace(/\\[\"\';:\uFEFF]/g,u).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(a){return a.replace(/[;:]/g,u)});d=i.exec(b);)if(i.lastIndex=d.index+d[0].length,e=d[1].replace(j,"").toLowerCase(),f=d[2].replace(j,""),e&&f){if(e=x(e),f=x(f),-1!==e.indexOf(l)||-1!==e.indexOf('"'))continue;if(!a.allow_script_urls&&("behavior"==e||/expression\s*\(|\/\*|\*\//.test(f)))continue;"font-weight"===e&&"700"===f?f="bold":"color"!==e&&"background-color"!==e||(f=f.toLowerCase()),f=(f=f.replace(g,m)).replace(h,y),o[e]=n?v(f,!0):f}r("border","",!0),r("border","-width"),r("border","-color"),r("border","-style"),r("padding",""),r("margin",""),function(a,b,c,d){s(b)&&s(c)&&s(d)&&(o[a]=o[b]+" "+o[c]+" "+o[d],delete o[b],delete o[c],delete o[d])}("border","border-width","border-style","border-color"),"medium none"===o.border&&delete o.border,"none"===o["border-image"]&&delete o["border-image"]}return o},serialize:function(a,b){var c,d,g="",h=function(b){var c,d,f,h;if(c=e[b])for(d=0,f=c.length;d<f;d++)b=c[d],(h=a[b])&&(g+=(g.length>0?" ":"")+b+": "+h+";")},i=function(a,b){var c;return!((c=f["*"])&&c[a]||(c=f[b])&&c[a])};if(b&&e)h("*"),h(b);else for(c in a)!(d=a[c])||f&&!i(c,b)||(g+=(g.length>0?" ":"")+c+": "+d+";");return g}}}}),g("m",["1j","2","b","n","o","1s","r","1t","s","1u","v","y","10","1e"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=n.each,p=n.is,q=n.grep,r=c.ie,s=/^([a-z0-9],?)+$/i,t=/^[ \t\r\n]*$/,v=function(a,b){var c=b.attr("style");(c=a.serializeStyle(a.parseStyle(c),b[0].nodeName))||(c=null),b.attr("data-mce-style",c)},w=function(a,b){var c,d,e=0;if(a)for(c=a.nodeType,a=a.previousSibling;a;a=a.previousSibling)d=a.nodeType,(!b||3!=d||d!=c&&a.nodeValue.length)&&(e++,c=d);return e},x=function(a,c){var f,g=this;g.doc=a,g.win=b,g.files={},g.counter=0,g.stdMode=!r||a.documentMode>=8,g.boxModel=!r||"CSS1Compat"==a.compatMode||g.stdMode,g.styleSheetLoader=new h(a),g.boundEvents=[],g.settings=c=c||{},g.schema=c.schema?c.schema:new l({}),g.styles=new m({url_converter:c.url_converter,url_converter_scope:c.url_converter_scope},c.schema),g.fixDoc(a),g.events=c.ownEvents?new e(c.proxy):e.Event,g.attrHooks=function(a,b){var c,d={},e=b.keep_values;return c={set:function(c,d,e){b.url_converter&&(d=b.url_converter.call(b.url_converter_scope||a,d,e,c[0])),c.attr("data-mce-"+e,d).attr(e,d)},get:function(a,b){return a.attr("data-mce-"+b)||a.attr(b)}},d={style:{set:function(a,b){return null!==b&&"object"==typeof b?void a.css(b):(e&&a.attr("data-mce-style",b),void a.attr("style",b))},get:function(b){var c=b.attr("data-mce-style")||b.attr("style");return c=a.serializeStyle(a.parseStyle(c),b[0].nodeName)}}},e&&(d.href=d.src=c),d}(g,c),f=g.schema.getBlockElements(),g.$=d.overrideDefaults(function(){return{context:a,element:g.getRoot()}}),g.isBlock=function(a){if(!a)return!1;var b=a.nodeType;return b?!(1!==b||!f[a.nodeName]):!!f[a]}};return x.prototype={$$:function(a){return"string"==typeof a&&(a=this.get(a)),this.$(a)},root:null,fixDoc:function(a){var b,c=this.settings;if(r&&c.schema){"abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video".replace(/\w+/g,function(b){a.createElement(b)});for(b in c.schema.getCustomElements())a.createElement(b)}},clone:function(a,b){var c,d,e=this;return!r||1!==a.nodeType||b?a.cloneNode(b):(d=e.doc,b?c.firstChild:(c=d.createElement(a.nodeName),o(e.getAttribs(a),function(b){e.setAttrib(c,b.nodeName,e.getAttrib(a,b.nodeName))}),c))},getRoot:function(){return this.settings.root_element||this.doc.body},getViewPort:function(a){var b,c;return a=a||this.win,b=a.document,c=this.boxModel?b.documentElement:b.body,{x:a.pageXOffset||c.scrollLeft,y:a.pageYOffset||c.scrollTop,w:a.innerWidth||c.clientWidth,h:a.innerHeight||c.clientHeight}},getRect:function(a){var b,c,d=this;return a=d.get(a),b=d.getPos(a),c=d.getSize(a),{x:b.x,y:b.y,w:c.w,h:c.h}},getSize:function(a){var b,c,d=this;return a=d.get(a),b=d.getStyle(a,"width"),c=d.getStyle(a,"height"),-1===b.indexOf("px")&&(b=0),-1===c.indexOf("px")&&(c=0),{w:parseInt(b,10)||a.offsetWidth||a.clientWidth,h:parseInt(c,10)||a.offsetHeight||a.clientHeight}},getParent:function(a,b,c){return this.getParents(a,b,c,!1)},getParents:function(a,b,c,d){var e,f=this,g=[];for(a=f.get(a),d=void 0===d,c=c||("BODY"!=f.getRoot().nodeName?f.getRoot().parentNode:null),p(b,"string")&&(e=b,b="*"===b?function(a){return 1==a.nodeType}:function(a){return f.is(a,e)});a&&a!=c&&a.nodeType&&9!==a.nodeType;){if(!b||b(a)){if(!d)return a;g.push(a)}a=a.parentNode}return d?g:null},get:function(a){var b;return a&&this.doc&&"string"==typeof a&&(b=a,(a=this.doc.getElementById(a))&&a.id!==b)?this.doc.getElementsByName(b)[1]:a},getNext:function(a,b){return this._findSib(a,b,"nextSibling")},getPrev:function(a,b){return this._findSib(a,b,"previousSibling")},select:function(a,b){var c=this;return g(a,c.get(b)||c.settings.root_element||c.doc,[])},is:function(a,b){var c;if(!a)return!1;if(void 0===a.length){if("*"===b)return 1==a.nodeType;if(s.test(b)){for(b=b.toLowerCase().split(/,/),a=a.nodeName.toLowerCase(),c=b.length-1;c>=0;c--)if(b[c]==a)return!0;return!1}}if(a.nodeType&&1!=a.nodeType)return!1;var d=a.nodeType?[a]:a;return g(b,d[0].ownerDocument||d[0],null,d).length>0},add:function(a,b,c,d,e){var f=this;return this.run(a,function(a){var g;return g=p(b,"string")?f.doc.createElement(b):b,f.setAttribs(g,c),d&&(d.nodeType?g.appendChild(d):f.setHTML(g,d)),e?g:a.appendChild(g)})},create:function(a,b,c){return this.add(this.doc.createElement(a),a,b,c,1)},createHTML:function(a,b,c){var d,e="";e+="<"+a;for(d in b)b.hasOwnProperty(d)&&null!==b[d]&&void 0!==b[d]&&(e+=" "+d+'="'+this.encode(b[d])+'"');return void 0!==c?e+">"+c+"</"+a+">":e+" />"},createFragment:function(a){var b,c,d,e=this.doc;for(d=e.createElement("div"),b=e.createDocumentFragment(),a&&(d.innerHTML=a);c=d.firstChild;)b.appendChild(c);return b},remove:function(a,b){return a=this.$$(a),b?a.each(function(){for(var a;a=this.firstChild;)3==a.nodeType&&0===a.data.length?this.removeChild(a):this.parentNode.insertBefore(a,this)}).remove():a.remove(),a.length>1?a.toArray():a[0]},setStyle:function(a,b,c){a=this.$$(a).css(b,c),this.settings.update_styles&&v(this,a)},getStyle:function(a,b,d){return a=this.$$(a),d?a.css(b):("float"==(b=b.replace(/-(\D)/g,function(a,b){return b.toUpperCase()}))&&(b=c.ie&&c.ie<12?"styleFloat":"cssFloat"),a[0]&&a[0].style?a[0].style[b]:void 0)},setStyles:function(a,b){a=this.$$(a).css(b),this.settings.update_styles&&v(this,a)},removeAllAttribs:function(a){return this.run(a,function(a){var b,c=a.attributes;for(b=c.length-1;b>=0;b--)a.removeAttributeNode(c.item(b))})},setAttrib:function(a,b,c){var d,e,f=this,g=f.settings;""===c&&(c=null),d=(a=f.$$(a)).attr(b),a.length&&((e=f.attrHooks[b])&&e.set?e.set(a,c,b):a.attr(b,c),d!=c&&g.onSetAttrib&&g.onSetAttrib({attrElm:a,attrName:b,attrValue:c}))},setAttribs:function(a,b){var c=this;c.$$(a).each(function(a,d){o(b,function(a,b){c.setAttrib(d,b,a)})})},getAttrib:function(a,b,c){var d,e;return(a=this.$$(a)).length&&(d=this.attrHooks[b],e=d&&d.get?d.get(a,b):a.attr(b)),void 0===e&&(e=c||""),e},getPos:function(a,b){return f.getPos(this.doc.body,this.get(a),b)},parseStyle:function(a){return this.styles.parse(a)},serializeStyle:function(a,b){return this.styles.serialize(a,b)},addStyle:function(b){var c,d,f=this.doc;if(this!==x.DOM&&f===a){var g=x.DOM.addedStyles;if((g=g||[])[b])return;g[b]=!0,x.DOM.addedStyles=g}(d=f.getElementById("mceDefaultStyles"))||(d=f.createElement("style"),d.id="mceDefaultStyles",d.type="text/css",(c=f.getElementsByTagName("head")[0]).firstChild?c.insertBefore(d,c.firstChild):c.appendChild(d)),d.styleSheet?d.styleSheet.cssText+=b:d.appendChild(f.createTextNode(b))},loadCSS:function(b){var c,d=this,e=d.doc;return d!==x.DOM&&e===a?void x.DOM.loadCSS(b):(b||(b=""),c=e.getElementsByTagName("head")[0],void o(b.split(","),function(a){var b;a=n._addCacheSuffix(a),d.files[a]||(d.files[a]=!0,b=d.create("link",{rel:"stylesheet",href:a}),r&&e.documentMode&&e.recalc&&(b.onload=function(){e.recalc&&e.recalc(),b.onload=null}),c.appendChild(b))}))},addClass:function(a,b){this.$$(a).addClass(b)},removeClass:function(a,b){this.toggleClass(a,b,!1)},hasClass:function(a,b){return this.$$(a).hasClass(b)},toggleClass:function(a,b,c){this.$$(a).toggleClass(b,c).each(function(){""===this.className&&d(this).attr("class",null)})},show:function(a){this.$$(a).show()},hide:function(a){this.$$(a).hide()},isHidden:function(a){return"none"==this.$$(a).css("display")},uniqueId:function(a){return(a||"mce_")+this.counter++},setHTML:function(a,b){a=this.$$(a),r?a.each(function(a,c){if(!1!==c.canHaveHTML){for(;c.firstChild;)c.removeChild(c.firstChild);try{c.innerHTML="<br>"+b,c.removeChild(c.firstChild)}catch(a){d("<div></div>").html("<br>"+b).contents().slice(1).appendTo(c)}return b}}):a.html(b)},getOuterHTML:function(a){return 1==(a=this.get(a)).nodeType&&"outerHTML"in a?a.outerHTML:d("<div></div>").append(d(a).clone()).html()},setOuterHTML:function(a,b){var c=this;c.$$(a).each(function(){try{if("outerHTML"in this)return void(this.outerHTML=b)}catch(a){}c.remove(d(this).html(b),!0)})},decode:k.decode,encode:k.encodeAllRaw,insertAfter:function(a,b){return b=this.get(b),this.run(a,function(a){var c,d;return c=b.parentNode,(d=b.nextSibling)?c.insertBefore(a,d):c.appendChild(a),a})},replace:function(a,b,c){return this.run(b,function(b){return p(b,"array")&&(a=a.cloneNode(!0)),c&&o(q(b.childNodes),function(b){a.appendChild(b)}),b.parentNode.replaceChild(a,b)})},rename:function(a,b){var c,d=this;return a.nodeName!=b.toUpperCase()&&(c=d.create(b),o(d.getAttribs(a),function(b){d.setAttrib(c,b.nodeName,d.getAttrib(a,b.nodeName))}),d.replace(c,a,1)),c||a},findCommonAncestor:function(a,b){for(var c,d=a;d;){for(c=b;c&&d!=c;)c=c.parentNode;if(d==c)break;d=d.parentNode}return!d&&a.ownerDocument?a.ownerDocument.documentElement:d},toHex:function(a){return this.styles.toHex(n.trim(a))},run:function(a,b,c){var d,e=this;return"string"==typeof a&&(a=e.get(a)),!!a&&(c=c||this,a.nodeType||!a.length&&0!==a.length?b.call(c,a):(d=[],o(a,function(a,f){a&&("string"==typeof a&&(a=e.get(a)),d.push(b.call(c,a,f)))}),d))},getAttribs:function(a){var b;if(!(a=this.get(a)))return[];if(r){if(b=[],"OBJECT"==a.nodeName)return a.attributes;"OPTION"===a.nodeName&&this.getAttrib(a,"selected")&&b.push({specified:1,nodeName:"selected"});return a.cloneNode(!1).outerHTML.replace(/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi,"").replace(/[\w:\-]+/gi,function(a){b.push({specified:1,nodeName:a})}),b}return a.attributes},isEmpty:function(a,b){var c,d,e,f,g,h,j=this,k=0;if(a=a.firstChild){g=new i(a,a.parentNode),b=b||(j.schema?j.schema.getNonEmptyElements():null),f=j.schema?j.schema.getWhiteSpaceElements():{};do{if(1===(e=a.nodeType)){var l=a.getAttribute("data-mce-bogus");if(l){a=g.next("all"===l);continue}if(h=a.nodeName.toLowerCase(),b&&b[h]){if("br"===h){k++,a=g.next();continue}return!1}for(c=(d=j.getAttribs(a)).length;c--;)if("name"===(h=d[c].nodeName)||"data-mce-bookmark"===h)return!1}if(8==e)return!1;if(3===e&&!t.test(a.nodeValue))return!1;if(3===e&&a.parentNode&&f[a.parentNode.nodeName]&&t.test(a.nodeValue))return!1;a=g.next()}while(a)}return k<=1},createRng:function(){return this.doc.createRange()},nodeIndex:w,split:function(a,b,c){var d,e,f,g=this,h=g.createRng();if(a&&b)return h.setStart(a.parentNode,g.nodeIndex(a)),h.setEnd(b.parentNode,g.nodeIndex(b)),d=h.extractContents(),(h=g.createRng()).setStart(b.parentNode,g.nodeIndex(b)+1),h.setEnd(a.parentNode,g.nodeIndex(a)+1),e=h.extractContents(),(f=a.parentNode).insertBefore(j.trimNode(g,d),a),c?f.insertBefore(c,a):f.insertBefore(b,a),f.insertBefore(j.trimNode(g,e),a),g.remove(a),c||b},bind:function(a,b,c,d){var e=this;if(n.isArray(a)){for(var f=a.length;f--;)a[f]=e.bind(a[f],b,c,d);return a}return!e.settings.collect||a!==e.doc&&a!==e.win||e.boundEvents.push([a,b,c,d]),e.events.bind(a,b,c,d||e)},unbind:function(a,b,c){var d,e=this;if(n.isArray(a)){for(d=a.length;d--;)a[d]=e.unbind(a[d],b,c);return a}if(e.boundEvents&&(a===e.doc||a===e.win))for(d=e.boundEvents.length;d--;){var f=e.boundEvents[d];a!=f[0]||b&&b!=f[1]||c&&c!=f[2]||this.events.unbind(f[0],f[1],f[2])}return this.events.unbind(a,b,c)},fire:function(a,b,c){return this.events.fire(a,b,c)},getContentEditable:function(a){var b;return a&&1==a.nodeType?(b=a.getAttribute("data-mce-contenteditable"))&&"inherit"!==b?b:"inherit"!==a.contentEditable?a.contentEditable:null:null},getContentEditableParent:function(a){for(var b=this.getRoot(),c=null;a&&a!==b&&null===(c=this.getContentEditable(a));a=a.parentNode);return c},destroy:function(){var a=this;if(a.boundEvents){for(var b=a.boundEvents.length;b--;){var c=a.boundEvents[b];this.events.unbind(c[0],c[1],c[2])}a.boundEvents=null}g.setDocument&&g.setDocument(),a.win=a.doc=a.root=a.events=a.frag=null},isChildOf:function(a,b){for(;a;){if(b===a)return!0;a=a.parentNode}return!1},dumpRng:function(a){return"startContainer: "+a.startContainer.nodeName+", startOffset: "+a.startOffset+", endContainer: "+a.endContainer.nodeName+", endOffset: "+a.endOffset},_findSib:function(a,b,c){var d=this,e=b;if(a)for("string"==typeof e&&(e=function(a){return d.is(a,b)}),a=a[c];a;a=a[c])if(e(a))return a;return null}},x.DOM=new x(a),x.nodeIndex=w,x}),g("p",["1j","m","1e"],function(a,b,c){var d=b.DOM,e=c.each,f=c.grep,g=function(a){return"function"==typeof a},h=function(){var b,l={},m=[],n={},o=[],p=0,q=function(b,e,f){var h,i,j=d,k=function(){j.remove(i),h&&(h.onreadystatechange=h.onload=h=null),e()};i=j.uniqueId(),(h=a.createElement("script")).id=i,h.type="text/javascript",h.src=c._addCacheSuffix(b),"onreadystatechange"in h?h.onreadystatechange=function(){/loaded|complete/.test(h.readyState)&&k()}:h.onload=k,h.onerror=function(){g(f)?f():"undefined"!=typeof console&&console.log&&console.log("Failed to load script: "+b)},(a.getElementsByTagName("head")[0]||a.body).appendChild(h)};this.isDone=function(a){return 2==l[a]},this.markDone=function(a){l[a]=2},this.add=this.load=function(a,c,d,e){l[a]==b&&(m.push(a),l[a]=0),c&&(n[a]||(n[a]=[]),n[a].push({success:c,failure:e,scope:d||this}))},this.remove=function(a){delete l[a],delete n[a]},this.loadQueue=function(a,b,c){this.loadScripts(m,a,b,c)},this.loadScripts=function(a,c,d,h){var m,r=[],s=function(a,c){e(n[c],function(b){g(b[a])&&b[a].call(b.scope)}),n[c]=b};o.push({success:c,failure:h,scope:d||this}),(m=function(){var b=f(a);if(a.length=0,e(b,function(a){return 2===l[a]?void s("success",a):3===l[a]?void s("failure",a):void(1!==l[a]&&(l[a]=1,p++,q(a,function(){l[a]=2,p--,s("success",a),m()},function(){l[a]=3,p--,r.push(a),s("failure",a),m()})))}),!p){var c=o.slice(0);o.length=0,e(c,function(a){0===r.length?g(a.success)&&a.success.call(a.scope):g(a.failure)&&a.failure.call(a.scope,r)})}})()}};return h.ScriptLoader=new h,h}),g("6",["1i","p","1e"],function(a,b,c){var d=c.each,e=function(){var a=this;a.items=[],a.urls={},a.lookup={},a._listeners=[]};return e.prototype={get:function(a){if(this.lookup[a])return this.lookup[a].instance},dependencies:function(a){var b;return this.lookup[a]&&(b=this.lookup[a].dependencies),b||[]},requireLangPack:function(a,c){var d=e.language;if(d&&!1!==e.languageLoad){if(c)if(-1!=(c=","+c+",").indexOf(","+d.substr(0,2)+","))d=d.substr(0,2);else if(-1==c.indexOf(","+d+","))return;b.ScriptLoader.add(this.urls[a]+"/langs/"+d+".js")}},add:function(b,c,e){this.items.push(c),this.lookup[b]={instance:c,dependencies:e};var f=a.partition(this._listeners,function(a){return a.name===b});return this._listeners=f.fail,d(f.pass,function(a){a.callback()}),c},remove:function(a){delete this.urls[a],delete this.lookup[a]},createUrl:function(a,b){return"object"==typeof b?b:{prefix:a.prefix,resource:b,suffix:a.suffix}},addComponents:function(a,c){var e=this.urls[a];d(c,function(a){b.ScriptLoader.add(e+"/"+a)})},load:function(a,c,f,g,h){var i=this,j=c,k=function(){var e=i.dependencies(a);d(e,function(a){var b=i.createUrl(c,a);i.load(b.resource,b,void 0,void 0)}),f&&(g?f.call(g):f.call(b))};i.urls[a]||("object"==typeof c&&(j=c.prefix+c.resource+c.suffix),0!==j.indexOf("/")&&-1==j.indexOf("://")&&(j=e.baseURL+"/"+j),i.urls[a]=j.substring(0,j.lastIndexOf("/")),i.lookup[a]?k():b.ScriptLoader.add(j,k,g,h))},waitFor:function(a,b){this.lookup.hasOwnProperty(a)?b():this._listeners.push({name:a,callback:b})}},e.PluginManager=new e,e.ThemeManager=new e,e}),g("4b",[],function(){var a="\ufeff";return{isZwsp:function(b){return b===a},ZWSP:a,trim:function(b){return b.replace(new RegExp(a,"g"),"")}}}),g("46",["1j","1y","4b"],function(a,b,c){var d=b.isElement,e=b.isText,f=function(a){return e(a)&&(a=a.parentNode),d(a)&&a.hasAttribute("data-mce-caret")},g=function(a){return e(a)&&c.isZwsp(a.data)},h=function(a){return f(a)||g(a)},o=function(){var b=a.createElement("br");return b.setAttribute("data-mce-bogus","1"),b},q=function(a){return e(a)&&a.data[0]==c.ZWSP},r=function(a){return e(a)&&a.data[a.data.length-1]==c.ZWSP};return{isCaretContainer:h,isCaretContainerBlock:f,isCaretContainerInline:g,showCaretContainerBlock:function(a){return a&&a.hasAttribute("data-mce-caret")?(function(a){var c=a.getElementsByTagName("br"),d=c[c.length-1];b.isBogus(d)&&d.parentNode.removeChild(d)}(a),a.removeAttribute("data-mce-caret"),a.removeAttribute("data-mce-bogus"),a.removeAttribute("style"),a.removeAttribute("_moz_abspos"),a):null},insertInline:function(a,b){var d,f,g,i;if(d=a.ownerDocument,g=d.createTextNode(c.ZWSP),i=a.parentNode,b){if(f=a.previousSibling,e(f)){if(h(f))return f;if(r(f))return f.splitText(f.data.length-1)}i.insertBefore(g,a)}else{if(f=a.nextSibling,e(f)){if(h(f))return f;if(q(f))return f.splitText(1),f}a.nextSibling?i.insertBefore(g,a.nextSibling):i.appendChild(g)}return g},prependInline:function(a){if(b.isText(a)){var d=a.data;return d.length>0&&d.charAt(0)!==c.ZWSP&&a.insertData(0,c.ZWSP),a}return null},appendInline:function(a){if(b.isText(a)){var d=a.data;return d.length>0&&d.charAt(d.length-1)!==c.ZWSP&&a.insertData(d.length,c.ZWSP),a}return null},isBeforeInline:function(a){return a&&b.isText(a.container())&&a.container().data.charAt(a.offset())===c.ZWSP},isAfterInline:function(a){return a&&b.isText(a.container())&&a.container().data.charAt(a.offset()-1)===c.ZWSP},insertBlock:function(a,b,c){var d,e,f;return d=b.ownerDocument,(e=d.createElement(a)).setAttribute("data-mce-caret",c?"before":"after"),e.setAttribute("data-mce-bogus","all"),e.appendChild(o()),f=b.parentNode,c?f.insertBefore(e,b):b.nextSibling?f.insertBefore(e,b.nextSibling):f.appendChild(e),e},hasContent:function(a){return a.firstChild!==a.lastChild||!b.isBr(a.firstChild)},startsWithCaretContainer:q,endsWithCaretContainer:r}}),g("3n",["1y","1r","46"],function(a,b,c){var d=a.isContentEditableTrue,e=a.isContentEditableFalse,f=a.isBr,g=a.isText,h=a.matchNodeNames("script style textarea"),i=a.matchNodeNames("img input textarea hr iframe video audio object"),j=a.matchNodeNames("table"),k=c.isCaretContainer,l=function(a){return!k(a)&&(g(a)?!h(a.parentNode):i(a)||f(a)||j(a)||e(a))},m=function(a,b){for(a=a.parentNode;a&&a!=b;a=a.parentNode){if(e(a))return!1;if(d(a))return!0}return!0};return{isCaretCandidate:l,isInEditable:m,isAtomic:function(a){return i(a)||function(a){return!!e(a)&&!0!==b.reduce(a.getElementsByTagName("*"),function(a,b){return a||d(b)},!1)}(a)},isEditableCaretCandidate:function(a,b){return l(a)&&m(a,b)}}}),g("3o",[],function(){var a=Math.round,b=function(b){return b?{left:a(b.left),top:a(b.top),bottom:a(b.bottom),right:a(b.right),width:a(b.width),height:a(b.height)}:{left:0,top:0,bottom:0,right:0,width:0,height:0}},e=function(a,b,c){return a>=0&&a<=Math.min(b.height,c.height)/2},f=function(a,b){return a.bottom-a.height/2<b.top||!(a.top>b.bottom)&&e(b.top-a.bottom,a,b)},g=function(a,b){return a.top>b.bottom||!(a.bottom<b.top)&&e(b.bottom-a.top,a,b)},h=function(a,b){return a.left<b.left},i=function(a,b){return a.right>b.right};return{clone:b,collapse:function(a,c){return a=b(a),c?a.right=a.left:(a.left=a.left+a.width,a.right=a.left),a.width=0,a},isEqual:function(a,b){return a.left===b.left&&a.top===b.top&&a.bottom===b.bottom&&a.right===b.right},isAbove:f,isBelow:g,isLeft:h,isRight:i,compare:function(a,b){return f(a,b)?-1:g(a,b)?1:h(a,b)?-1:i(a,b)?1:0},containsXY:function(a,b,c){return b>=a.left&&b<=a.right&&c>=a.top&&c<=a.bottom}}}),g("2v",[],function(){return{getSelectedNode:function(a){var b=a.startContainer,c=a.startOffset;return b.hasChildNodes()&&a.endOffset==c+1?b.childNodes[c]:null},getNode:function(a,b){return 1===a.nodeType&&a.hasChildNodes()&&(b>=a.childNodes.length&&(b=a.childNodes.length-1),a=a.childNodes[b]),a}}}),g("3p",[],function(){var a=new RegExp("[̀-ͯ҃-҇҈-҉֑-ֽֿׁ-ׂׄ-ׇׅؐ-ًؚ-ٰٟۖ-ۜ۟-ۤۧ-۪ۨ-ܑۭܰ-݊ަ-ް߫-߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ࣣ-ंऺ़ु-ै्॑-ॗॢ-ॣঁ়াু-ৄ্ৗৢ-ৣਁ-ਂ਼ੁ-ੂੇ-ੈੋ-੍ੑੰ-ੱੵઁ-ં઼ુ-ૅે-ૈ્ૢ-ૣଁ଼ାିୁ-ୄ୍ୖୗୢ-ୣஂாீ்ௗఀా-ీె-ైొ-్ౕ-ౖౢ-ౣಁ಼ಿೂೆೌ-್ೕ-ೖೢ-ೣഁാു-ൄ്ൗൢ-ൣ්ාි-ුූෟัิ-ฺ็-๎ັິ-ູົ-ຼ່-ໍ༘-ཱ༹༙༵༷-ཾྀ-྄྆-྇ྍ-ྗྙ-ྼ࿆ိ-ူဲ-့္-်ွ-ှၘ-ၙၞ-ၠၱ-ၴႂႅ-ႆႍႝ፝-፟ᜒ-᜔ᜲ-᜴ᝒ-ᝓᝲ-ᝳ឴-឵ិ-ួំ៉-៓៝᠋-᠍ᢩᤠ-ᤢᤧ-ᤨᤲ᤹-᤻ᨗ-ᨘᨛᩖᩘ-ᩞ᩠ᩢᩥ-ᩬᩳ-᩿᩼᪰-᪽᪾ᬀ-ᬃ᬴ᬶ-ᬺᬼᭂ᭫-᭳ᮀ-ᮁᮢ-ᮥᮨ-ᮩ᮫-ᮭ᯦ᯨ-ᯩᯭᯯ-ᯱᰬ-ᰳᰶ-᰷᳐-᳔᳒-᳢᳠-᳨᳭᳴᳸-᳹᷀-᷵᷼-᷿‌-‍⃐-⃜⃝-⃠⃡⃢-⃤⃥-⃰⳯-⵿⳱ⷠ-〪ⷿ-〭〮-゙〯-゚꙯꙰-꙲ꙴ-꙽ꚞ-ꚟ꛰-꛱ꠂ꠆ꠋꠥ-ꠦ꣄꣠-꣱ꤦ-꤭ꥇ-ꥑꦀ-ꦂ꦳ꦶ-ꦹꦼꧥꨩ-ꨮꨱ-ꨲꨵ-ꨶꩃꩌꩼꪰꪲ-ꪴꪷ-ꪸꪾ-꪿꫁ꫬ-ꫭ꫶ꯥꯨ꯭ﬞ︀-️︠-︯ﾞ-ﾟ]");return{isExtendingChar:function(b){return"string"==typeof b&&b.charCodeAt(0)>=768&&a.test(b)}}}),g("3q",[],function(){var a=[].slice,g=function(b){var c=a.call(arguments);return c.length-1>=b.length?b.apply(this,c.slice(1)):function(){var a=c.concat([].slice.call(arguments));return g.apply(this,a)}};return{constant:function(a){return function(){return a}},negate:function(a){return function(b){return!a(b)}},and:function(){var b=a.call(arguments);return function(a){for(var c=0;c<b.length;c++)if(!b[c](a))return!1;return!0}},or:function(){var b=a.call(arguments);return function(a){for(var c=0;c<b.length;c++)if(b[c](a))return!0;return!1}},curry:g,compose:function(a,b){return function(c){return a(b(c))}},noop:function(){}}}),g("32",["3n","m","1y","3o","2v","3p","3q"],function(a,b,c,d,e,f,g){var h=c.isElement,i=a.isCaretCandidate,j=c.matchStyleValues("display","block table"),k=c.matchStyleValues("float","left right"),l=g.and(h,i,g.negate(k)),m=g.negate(c.matchStyleValues("white-space","pre pre-line pre-wrap")),n=c.isText,o=c.isBr,p=b.nodeIndex,q=e.getNode,r=function(a){return"createRange"in a?a.createRange():b.DOM.createRng()},s=function(a){return a&&/[\r\n\t ]/.test(a)},t=function(a){var b,c=a.startContainer,d=a.startOffset;return!!(s(a.toString())&&m(c.parentNode)&&(b=c.data,s(b[d-1])||s(b[d+1])))},u=function(a){var b,c,e=[],i=function(a){var b,c;return c=a.getClientRects(),b=c.length>0?d.clone(c[0]):d.clone(a.getBoundingClientRect()),o(a)&&0===b.left?function(a){var b,c=a.ownerDocument,e=r(c),f=c.createTextNode(" "),g=a.parentNode;return g.insertBefore(f,a),e.setStart(f,0),e.setEnd(f,1),b=d.clone(e.getBoundingClientRect()),g.removeChild(f),b}(a):b},k=function(a,b){return a=d.collapse(a,b),a.width=1,a.right=a.left+1,a},m=function(a){0!==a.height&&(e.length>0&&d.isEqual(a,e[e.length-1])||e.push(a))},p=function(a,b){var c=r(a.ownerDocument);if(b<a.data.length){if(f.isExtendingChar(a.data[b]))return e;if(f.isExtendingChar(a.data[b-1])&&(c.setStart(a,b),c.setEnd(a,b+1),!t(c)))return m(k(i(c),!1)),e}b>0&&(c.setStart(a,b-1),c.setEnd(a,b),t(c)||m(k(i(c),!1))),b<a.data.length&&(c.setStart(a,b),c.setEnd(a,b+1),t(c)||m(k(i(c),!0)))};if(n(a.container()))return p(a.container(),a.offset()),e;if(h(a.container()))if(a.isAtEnd())c=q(a.container(),a.offset()),n(c)&&p(c,c.data.length),l(c)&&!o(c)&&m(k(i(c),!1));else{if(c=q(a.container(),a.offset()),n(c)&&p(c,0),l(c)&&a.isAtEnd())return m(k(i(c),!1)),e;b=q(a.container(),a.offset()-1),l(b)&&!o(b)&&(j(b)||j(c)||!l(c))&&m(k(i(b),!1)),l(c)&&m(k(i(c),!0))}return e},v=function(a,b,c){var h=function(){return c||(c=u(new v(a,b))),c};return{container:g.constant(a),offset:g.constant(b),toRange:function(){var c;return(c=r(a.ownerDocument)).setStart(a,b),c.setEnd(a,b),c},getClientRects:h,isVisible:function(){return h().length>0},isAtStart:function(){return n(a),0===b},isAtEnd:function(){return n(a)?b>=a.data.length:b>=a.childNodes.length},isEqual:function(c){return c&&a===c.container()&&b===c.offset()},getNode:function(c){return q(a,c?b-1:b)}}};return v.fromRangeStart=function(a){return new v(a.startContainer,a.startOffset)},v.fromRangeEnd=function(a){return new v(a.endContainer,a.endOffset)},v.after=function(a){return new v(a.parentNode,p(a)+1)},v.before=function(a){return new v(a.parentNode,p(a))},v.isAtStart=function(a){return!!a&&a.isAtStart()},v.isAtEnd=function(a){return!!a&&a.isAtEnd()},v.isTextPosition=function(a){return!!a&&c.isText(a.container())},v}),g("5b",["3q","s","1y","32","46","3n"],function(a,b,c,d,e,f){var g=c.isContentEditableTrue,h=c.isContentEditableFalse,i=c.matchStyleValues("display","block table table-cell table-caption list-item"),j=e.isCaretContainer,k=e.isCaretContainerBlock,l=a.curry,m=c.isElement,n=f.isCaretCandidate,o=function(a){return a>0},p=function(a){return a<0},q=function(a,b){for(var c;c=a(b);)if(!k(c))return c;return null},s=function(a,b){for(a=a.parentNode;a&&a!=b;a=a.parentNode)if(g(a))return a;return b},t=function(a,b){for(;a&&a!=b;){if(i(a))return a;a=a.parentNode}return null},x=function(a,b){var c=b.ownerDocument.createRange();return a?(c.setStartBefore(b),c.setEndBefore(b)):(c.setStartAfter(b),c.setEndAfter(b)),c},y=function(a,b,c){return t(b,a)==t(c,a)},z=function(a,b,c){var d,e;for(e=a?"previousSibling":"nextSibling";c&&c!=b;){if(d=c[e],j(d)&&(d=d[e]),h(d)){if(y(b,d,c))return d;break}if(n(d))break;c=c.parentNode}return null},A=l(x,!0),B=l(x,!1),D=function(a,b){return h(function(a,b){var c,d;return b?(c=b.container(),d=b.offset(),m(c)?c.childNodes[d+a]:null):null}(a,b))};return{isForwards:o,isBackwards:p,findNode:function(a,c,d,e,f){var g=new b(a,e);if(p(c)){if((h(a)||k(a))&&(a=q(g.prev,!0),d(a)))return a;for(;a=q(g.prev,f);)if(d(a))return a}if(o(c)){if((h(a)||k(a))&&(a=q(g.next,!0),d(a)))return a;for(;a=q(g.next,f);)if(d(a))return a}return null},getEditingHost:s,getParentBlock:t,isInSameBlock:function(a,b,c){return t(a.container(),c)==t(b.container(),c)},isInSameEditingHost:function(a,b,c){return s(a.container(),c)==s(b.container(),c)},isBeforeContentEditableFalse:l(D,0),isAfterContentEditableFalse:l(D,-1),normalizeRange:function(a,b,d){var f,g,i,k,n=l(z,!0,b),o=l(z,!1,b);if(g=d.startContainer,i=d.startOffset,e.isCaretContainerBlock(g)){if(m(g)||(g=g.parentNode),"before"==(k=g.getAttribute("data-mce-caret"))&&(f=g.nextSibling,h(f)))return A(f);if("after"==k&&(f=g.previousSibling,h(f)))return B(f)}if(!d.collapsed)return d;if(c.isText(g)){if(j(g)){if(1===a){if(f=o(g))return A(f);if(f=n(g))return B(f)}if(-1===a){if(f=n(g))return B(f);if(f=o(g))return A(f)}return d}if(e.endsWithCaretContainer(g)&&i>=g.data.length-1)return 1===a&&(f=o(g))?A(f):d;if(e.startsWithCaretContainer(g)&&i<=1)return-1===a&&(f=n(g))?B(f):d;if(i===g.data.length)return(f=o(g))?A(f):d;if(0===i)return(f=n(g))?B(f):d}return d}}}),g("3r",["1y","3n","32","5b","1r","3q"],function(a,b,c,d,e,f){var g=a.isContentEditableFalse,h=a.isText,i=a.isElement,j=a.isBr,k=d.isForwards,l=d.isBackwards,m=b.isCaretCandidate,n=b.isAtomic,o=b.isEditableCaretCandidate,q=function(a,b){return a.hasChildNodes()&&b<a.childNodes.length?a.childNodes[b]:null},r=function(a,b){if(k(a)){if(m(b.previousSibling)&&!h(b.previousSibling))return c.before(b);if(h(b))return c(b,0)}if(l(a)){if(m(b.nextSibling)&&!h(b.nextSibling))return c.after(b);if(h(b))return c(b,b.data.length)}return l(a)?j(b)?c.before(b):c.after(b):c.before(b)},s=function(b,e){var f;return!!a.isBr(b)&&!!(f=t(1,c.after(b),e))&&!d.isInSameBlock(c.before(b),c.before(f),e)},t=function(a,b,u){var v,w,x,y,z,A,B;if(!i(u)||!b)return null;if(b.isEqual(c.after(u))&&u.lastChild){if(B=c.after(u.lastChild),l(a)&&m(u.lastChild)&&i(u.lastChild))return j(u.lastChild)?c.before(u.lastChild):B}else B=b;if(v=B.container(),w=B.offset(),h(v)){if(l(a)&&w>0)return c(v,--w);if(k(a)&&w<v.length)return c(v,++w);x=v}else{if(l(a)&&w>0&&(y=q(v,w-1),m(y)))return!n(y)&&(z=d.findNode(y,a,o,y))?h(z)?c(z,z.data.length):c.after(z):h(y)?c(y,y.data.length):c.before(y);if(k(a)&&w<v.childNodes.length&&(y=q(v,w),m(y)))return s(y,u)?t(a,c.after(y),u):!n(y)&&(z=d.findNode(y,a,o,y))?h(z)?c(z,0):c.before(z):h(y)?c(y,0):c.after(y);x=B.getNode()}return(k(a)&&B.isAtEnd()||l(a)&&B.isAtStart())&&(x=d.findNode(x,a,f.constant(!0),u,!0),o(x))?r(a,x):(y=d.findNode(x,a,o,u),!(A=e.last(e.filter(function(a,b){for(var c=[];a&&a!=b;)c.push(a),a=a.parentNode;return c}(v,u),g)))||y&&A.contains(y)?y?r(a,y):null:B=k(a)?c.after(A):c.before(A))};return function(a){return{next:function(b){return t(1,b,a)},prev:function(b){return t(-1,b,a)}}}}),g("3m",["32","3r","1y","1e"],function(a,b,c,d){var l=function(a){return d.grep(a.childNodes,function(a){return"LI"===a.nodeName})},n=function(a){return a&&a.firstChild&&a.firstChild===a.lastChild&&function(a){return" "===a.data||c.isBr(a)}(a.firstChild)},p=function(a){return a.length>0&&function(a){return!a.firstChild||n(a)}(a[a.length-1])?a.slice(0,-1):a},q=function(a,b){var c=a.getParent(b,a.isBlock);return c&&"LI"===c.nodeName?c:null},t=function(c,d){var e=a.before(c),g=new b(d).next(e);return g?g.toRange():null},u=function(c,d){var e=a.after(c),g=new b(d).prev(e);return g?g.toRange():null},v=function(a,b,c,e){var f=function(a,b){var c=b.cloneRange(),d=b.cloneRange();return c.setStartBefore(a),d.setEndAfter(a),[c.cloneContents(),d.cloneContents()]}(a,e),g=a.parentNode;return g.insertBefore(f[0],a),d.each(b,function(b){g.insertBefore(b,a)}),g.insertBefore(f[1],a),g.removeChild(a),u(b[b.length-1],c)},w=function(a,b,c){var e=a.parentNode;return d.each(b,function(b){e.insertBefore(b,a)}),t(a,c)};return{isListFragment:function(a,b){var c=b.firstChild,d=b.lastChild;return c&&"meta"===c.name&&(c=c.next),d&&"mce_marker"===d.attr("id")&&(d=d.prev),function(a,b){var c=a.getNonEmptyElements();return b&&(b.isEmpty(c)||function(a,b){return a.getBlockElements()[b.name]&&function(a){return a.firstChild&&a.firstChild===a.lastChild}(b)&&function(a){return"br"===a.name||" "===a.value}(b.firstChild)}(a,b))}(a,d)&&(d=d.prev),!(!c||c!==d||"ul"!==c.name&&"ol"!==c.name)},insertAtCaret:function(c,d,e,f){var g=function(a,b,c){var d=b.serialize(c);return function(a){var b=a.firstChild,c=a.lastChild;return b&&"META"===b.nodeName&&b.parentNode.removeChild(b),c&&"mce_marker"===c.id&&c.parentNode.removeChild(c),a}(a.createFragment(d))}(d,c,f),h=q(d,e.startContainer),i=p(l(g.firstChild)),n=d.getRoot(),o=function(c){var f=a.fromRangeStart(e),g=new b(d.getRoot()),i=1===c?g.prev(f):g.next(f);return!i||q(d,i.getNode())!==h};return o(1)?w(h,i,n):o(2)?function(a,b,c,d){return d.insertAfter(b.reverse(),a),u(b[0],c)}(h,i,n,d):v(h,i,n,e)},isParentBlockLi:function(a,b){return!!q(a,b)},trimListItems:p,listItems:l}}),g("4n",["1y","m","3q","1r","32"],function(a,b,c,d,e){var f=a.isText,g=a.isBogus,h=b.nodeIndex,i=function(a){var b=a.parentNode;return g(b)?i(b):b},j=function(a){return a?d.reduce(a.childNodes,function(a,b){return g(b)&&"BR"!=b.nodeName?a=a.concat(j(b)):a.push(b),a},[]):[]},l=function(a){return function(b){return a===b}},m=function(b){var c,e,g;return c=j(i(b)),e=d.findIndex(c,l(b),b),c=c.slice(0,e+1),g=d.reduce(c,function(a,b,d){return f(b)&&f(c[d-1])&&a++,a},0),c=d.filter(c,a.matchNodeNames(b.nodeName)),(e=d.findIndex(c,l(b),b))-g},n=function(a){return(f(a)?"text()":a.nodeName.toLowerCase())+"["+m(a)+"]"},q=function(b,c,e){var g=j(b);return g=d.filter(g,function(a,b){return!f(a)||!f(g[b-1])}),(g=d.filter(g,a.matchNodeNames(c)))[e]};return{create:function(b,e){var g,h,i,j,l,m=[];return g=e.container(),h=e.offset(),f(g)?i=function(a,b){for(;(a=a.previousSibling)&&f(a);)b+=a.data.length;return b}(g,h):(j=g.childNodes,h>=j.length?(i="after",h=j.length-1):i="before",g=j[h]),m.push(n(g)),l=function(a,b,c){var d=[];for(b=b.parentNode;!(b==a||c&&c(b));b=b.parentNode)d.push(b);return d}(b,g),l=d.filter(l,c.negate(a.isBogus)),(m=m.concat(d.map(l,function(a){return n(a)}))).reverse().join("/")+","+i},resolve:function(a,b){var c,g,i;return b?(c=b.split(","),b=c[0].split("/"),i=c.length>1?c[1]:"before",(g=d.reduce(b,function(a,b){return(b=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(b))?("text()"===b[1]&&(b[1]="#text"),q(a,b[1],parseInt(b[2],10))):null},a))?f(g)?function(a,b){for(var c,d=a,g=0;f(d);){if(c=d.data.length,b>=g&&b<=g+c){a=d,b-=g;break}if(!f(d.nextSibling)){a=d,b=c;break}g+=c,d=d.nextSibling}return b>a.data.length&&(b=a.data.length),new e(a,b)}(g,parseInt(i,10)):(i="after"===i?h(g)+1:h(g),new e(g.parentNode,i)):null):null}}}),g("2b",["1","4n","46","32","1y","2v","4b","1e"],function(a,b,c,d,e,f,g,h){var i=e.isContentEditableFalse,k=function(a,b,c,d,f){var g,h=d[f?"startContainer":"endContainer"],i=d[f?"startOffset":"endOffset"],k=[],l=0,m=a.getRoot();for(e.isText(h)?k.push(c?function(a,b,c){var d,f;for(f=a(b.data.slice(0,c)).length,d=b.previousSibling;d&&e.isText(d);d=d.previousSibling)f+=a(d.data).length;return f}(b,h,i):i):(g=h.childNodes,i>=g.length&&g.length&&(l=1,i=Math.max(0,g.length-1)),k.push(a.nodeIndex(g[i],c)+l));h&&h!==m;h=h.parentNode)k.push(a.nodeIndex(h,c));return k},m=function(a){e.isText(a)&&0===a.data.length&&a.parentNode.removeChild(a)},n=function(a,b,c){var d=0;return h.each(a.select(b),function(a){if("all"!==a.getAttribute("data-mce-bogus"))return a!==c&&void d++}),d},o=function(a,b){var c,d,f,g=b?"start":"end";c=a[g+"Container"],d=a[g+"Offset"],e.isElement(c)&&"TR"===c.nodeName&&(f=c.childNodes,(c=f[Math.min(b?d:d-1,f.length-1)])&&(d=b?0:c.childNodes.length,a["set"+(b?"Start":"End")](c,d)))},p=function(a){return o(a,!0),o(a,!1),a},q=function(a,b){var d;if(e.isElement(a)&&(a=f.getNode(a,b),i(a)))return a;if(c.isCaretContainer(a)){if(e.isText(a)&&c.isCaretContainerBlock(a)&&(a=a.parentNode),d=a.previousSibling,i(d))return d;if(d=a.nextSibling,i(d))return d}},s=function(a,b,c){var d=c.getNode(),e=d?d.nodeName:null,f=c.getRng();return i(d)||"IMG"===e?{name:e,index:n(c.dom,e,d)}:(d=function(a){return q(a.startContainer,a.startOffset)||q(a.endContainer,a.endOffset)}(f))?(e=d.tagName,{name:e,index:n(c.dom,e,d)}):function(a,b,c,d){var e=b.dom,f={};return f.start=k(e,a,c,d,!0),b.isCollapsed()||(f.end=k(e,a,c,d,!1)),f}(a,c,b,f)},t=function(a){var c=a.getRng();return{start:b.create(a.dom.getRoot(),d.fromRangeStart(c)),end:b.create(a.dom.getRoot(),d.fromRangeEnd(c))}};return{getBookmark:function(a,b,c){return 2===b?s(g.trim,c,a):3===b?t(a):b?function(a){return{rng:a.getRng()}}(a):function(a){var b=a.dom,c=a.getRng(),d=b.uniqueId(),e=a.isCollapsed(),f="overflow:hidden;line-height:0px",g=a.getNode(),h=g.nodeName,i="&#xFEFF;";if("IMG"===h)return{name:h,index:n(b,h,g)};var j=p(c.cloneRange());if(!e){j.collapse(!1);var k=b.create("span",{"data-mce-type":"bookmark",id:d+"_end",style:f},i);j.insertNode(k),m(k.nextSibling)}(c=p(c)).collapse(!0);var l=b.create("span",{"data-mce-type":"bookmark",id:d+"_start",style:f},i);return c.insertNode(l),m(l.previousSibling),a.moveToBookmark({id:d,keep:1}),{id:d}}(a)},getUndoBookmark:a.curry(s,a.identity,!0)}}),g("5c",["2n"],function(a){return{cat:function(a){for(var b=[],c=function(a){b.push(a)},d=0;d<a.length;d++)a[d].each(c);return b},findMap:function(b,c){for(var d=0;d<b.length;d++){var e=c(b[d],d);if(e.isSome())return e}return a.none()},liftN:function(b,c){for(var d=[],e=0;e<b.length;e++){var f=b[e];if(!f.isSome())return a.none();d.push(f.getOrDie())}return a.some(c.apply(null,d))}}}),g("4p",["2n","5c","b","4n","32","1y","1e"],function(a,b,c,d,e,f,g){var h=function(a,b){return!a.isBlock(b)||b.innerHTML||c.ie||(b.innerHTML='<br data-mce-bogus="1" />'),b},i=function(a,b){var c,e;return c=a.createRng(),e=d.resolve(a.getRoot(),b.start),c.setStart(e.container(),e.offset()),e=d.resolve(a.getRoot(),b.end),c.setEnd(e.container(),e.offset()),c},j=function(a,b,c,d){var e,f,g,h,i=c[b?"start":"end"],j=a.getRoot();if(i){for(g=i[0],f=j,e=i.length-1;e>=1;e--){if(h=f.childNodes,i[e]>h.length-1)return;f=h[i[e]]}3===f.nodeType&&(g=Math.min(i[0],f.nodeValue.length)),1===f.nodeType&&(g=Math.min(i[0],f.childNodes.length)),b?d.setStart(f,g):d.setEnd(f,g)}return!0},k=function(b,d,h){var i,j,k,l,m,n,o=b.get(h.id+"_"+d),p=h.keep;if(o){if(i=o.parentNode,p?(i=o.firstChild,j=1):j=b.nodeIndex(o),m=i,n=j,!p){for(l=o.previousSibling,k=o.nextSibling,g.each(g.grep(o.childNodes),function(a){f.isText(a)&&(a.nodeValue=a.nodeValue.replace(/\uFEFF/g,""))});o=b.get(h.id+"_"+d);)b.remove(o,1);l&&k&&l.nodeType===k.nodeType&&f.isText(l)&&!c.opera&&(j=l.nodeValue.length,l.appendData(k.nodeValue),b.remove(k),m=l,n=j)}return a.some(e(m,n))}return a.none()},n=function(a,c){var d=k(a,"start",c),e=k(a,"end",c);return b.liftN([d,function(a,b){return a.isSome()?a:b}(e,d)],function(b,c){var d=a.createRng();return d.setStart(h(a,b.container()),b.offset()),d.setEnd(h(a,c.container()),c.offset()),d})};return{resolve:function(b,c){var d=b.dom;if(c){if(g.isArray(c.start))return function(b,c){var d=b.createRng();return j(b,!0,c,d)&&j(b,!1,c,d)?a.some(d):a.none()}(d,c);if("string"==typeof c.start)return a.some(i(d,c));if(c.id)return n(d,c);if(c.name)return function(b,c){return a.from(b.select(c.name)[c.index]).map(function(a){var c=b.createRng();return c.selectNode(a),c})}(d,c);if(c.rng)return a.some(c.rng)}return a.none()}}}),g("2r",["2b","4p"],function(a,b){return{getBookmark:function(b,c,d){return a.getBookmark(b,c,d)},moveToBookmark:function(a,c){b.resolve(a,c).each(function(b){a.setRng(b)})},isBookmarkNode:function(a){return a&&"SPAN"===a.tagName&&"bookmark"===a.getAttribute("data-mce-type")}}}),g("3s",["2r","1e"],function(a,b){var c=b.each;return function(b){this.compare=function(d,e){if(d.nodeName!=e.nodeName)return!1;var f=function(a){var d={};return c(b.getAttribs(a),function(c){var e=c.nodeName.toLowerCase();0!==e.indexOf("_")&&"style"!==e&&0!==e.indexOf("data-")&&(d[e]=b.getAttrib(a,e))}),d},g=function(a,b){var c,d;for(d in a)if(a.hasOwnProperty(d)){if(void 0===(c=b[d]))return!1;if(a[d]!=c)return!1;delete b[d]}for(d in b)if(b.hasOwnProperty(d))return!1;return!0};return!(!g(f(d),f(e))||!g(b.parseStyle(b.getAttrib(d,"style")),b.parseStyle(b.getAttrib(e,"style")))||a.isBookmarkNode(d)||a.isBookmarkNode(e))}}}),g("41",["3h"],function(a){var b=function(b,c){a.parent(b).each(function(a){a.dom().insertBefore(c.dom(),b.dom())})},e=function(a,b){a.dom().appendChild(b.dom())};return{before:b,after:function(c,d){a.nextSibling(c).fold(function(){a.parent(c).each(function(a){e(a,d)})},function(a){b(a,d)})},prepend:function(b,c){a.firstChild(b).fold(function(){e(b,c)},function(a){b.dom().insertBefore(c.dom(),a.dom())})},append:e,appendAt:function(c,d,f){a.child(c,f).fold(function(){e(c,d)},function(a){b(a,d)})},wrap:function(a,c){b(a,c),e(c,a)}}}),g("5d",["1i","41"],function(a,b){return{before:function(c,d){a.each(d,function(a){b.before(c,a)})},after:function(c,d){a.each(d,function(a,e){var f=0===e?c:d[e-1];b.after(f,a)})},prepend:function(c,d){a.each(d.slice().reverse(),function(a){b.prepend(c,a)})},append:function(c,d){a.each(d,function(a){b.append(c,a)})}}}),g("47",["1i","5d","3h"],function(a,b,c){var e=function(a){var b=a.dom();null!==b.parentNode&&b.parentNode.removeChild(b)};return{empty:function(b){b.dom().textContent="",a.each(c.children(b),function(a){e(a)})},remove:e,unwrap:function(a){var d=c.children(a);d.length>0&&b.before(a,d),e(a)}}}),g("5e",["3d","2n","5"],function(a,b,c){return function(d,e){var h=function(a){return d(a)?b.from(a.dom().nodeValue):b.none()},i=a.detect().browser,j=i.isIE()&&10===i.version.major?function(a){try{return h(a)}catch(a){return b.none()}}:h;return{get:function(a){if(!d(a))throw new c("Can only get "+e+" value of a "+e+" node");return j(a).getOr("")},getOption:j,set:function(a,b){if(!d(a))throw new c("Can only set raw "+e+" value of a "+e+" node");a.dom().nodeValue=b}}}}),g("4e",["3f","5e"],function(a,b){var c=b(a.isText,"text");return{get:function(a){return c.get(a)},getOption:function(a){return c.getOption(a)},set:function(a,b){c.set(a,b)}}}),g("6c",["1i","51","3h"],function(a,b,c){var h=function(b,d){var e=[];return a.each(c.children(b),function(a){d(a)&&(e=e.concat([a])),e=e.concat(h(a,d))}),e};return{all:function(a){return h(b.body(),a)},ancestors:function(b,d,e){return a.filter(c.parents(b,e),d)},siblings:function(b,d){return a.filter(c.siblings(b),d)},children:function(b,d){return a.filter(c.children(b),d)},descendants:h}}),g("5f",["6c","2z"],function(a,b){return{all:function(a){return b.all(a)},ancestors:function(c,d,e){return a.ancestors(c,function(a){return b.is(a,d)},e)},siblings:function(c,d){return a.siblings(c,function(a){return b.is(a,d)})},children:function(c,d){return a.children(c,function(a){return b.is(a,d)})},descendants:function(a,c){return b.all(c,a)}}}),g("3t",["1i","41","47","1v","3f","4e","5f","3h","3l"],function(a,b,c,d,e,f,g,h,i){var j=function(a){for(var b=[],c=a.dom();c;)b.push(d.fromDom(c)),c=c.lastChild;return b},m=function(a){return e.isText(a)?" "===f.get(a):i.isBr(a)};return{removeTrailingBr:function(b){var d=g.descendants(b,"br"),e=a.filter(j(b).slice(-1),i.isBr);d.length===e.length&&a.each(e,c.remove)},fillWithPaddingBr:function(a){c.empty(a),b.append(a,d.fromHtml('<br data-mce-bogus="1">'))},isPaddedElement:function(b){return 1===a.filter(h.children(b),m).length},trimBlockTrailingBr:function(a){h.lastChild(a).each(function(b){h.prevSibling(b).each(function(d){i.isBlock(a)&&i.isBr(b)&&i.isBlock(d)&&c.remove(b)})})}}}),g("11",["v","1e"],function(a,b){var c=b.makeMap;return function(b){var d,e,f,g,h,i=[];return b=b||{},d=b.indent,e=c(b.indent_before||""),f=c(b.indent_after||""),g=a.getEncodeFunc(b.entity_encoding||"raw",b.entities),h="html"==b.element_format,{start:function(a,b,c){var j,k,l,m;if(d&&e[a]&&i.length>0&&(m=i[i.length-1]).length>0&&"\n"!==m&&i.push("\n"),i.push("<",a),b)for(j=0,k=b.length;j<k;j++)l=b[j],i.push(" ",l.name,'="',g(l.value,!0),'"');i[i.length]=!c||h?">":" />",c&&d&&f[a]&&i.length>0&&(m=i[i.length-1]).length>0&&"\n"!==m&&i.push("\n")},end:function(a){var b;i.push("</",a,">"),d&&f[a]&&i.length>0&&(b=i[i.length-1]).length>0&&"\n"!==b&&i.push("\n")},text:function(a,b){a.length>0&&(i[i.length]=b?a:g(a))},cdata:function(a){i.push("<![CDATA[",a,"]]>")},comment:function(a){i.push("\x3c!--",a,"--\x3e")},pi:function(a,b){b?i.push("<?",a," ",g(b),"?>"):i.push("<?",a,"?>"),d&&i.push("\n")},doctype:function(a){i.push("<!DOCTYPE",a,">",d?"\n":"")},reset:function(){i.length=0},getContent:function(){return i.join("").replace(/\n$/,"")}}}}),g("z",["11","y"],function(a,b){return function(c,d){var e=this,f=new a(c);(c=c||{}).validate=!("validate"in c)||c.validate,e.schema=d=d||new b,e.writer=f,e.serialize=function(a){var b,e;e=c.validate,b={3:function(a){f.text(a.value,a.raw)},8:function(a){f.comment(a.value)},7:function(a){f.pi(a.name,a.value)},10:function(a){f.doctype(a.value)},4:function(a){f.cdata(a.value)},11:function(a){if(a=a.firstChild)do{g(a)}while(a=a.next)}},f.reset();var g=function(a){var c,h,i,j,k,l,m,n,o,p=b[a.type];if(p)p(a);else{if(c=a.name,h=a.shortEnded,i=a.attributes,e&&i&&i.length>1&&(l=[],l.map={},o=d.getElementRule(a.name))){for(m=0,n=o.attributesOrder.length;m<n;m++)(j=o.attributesOrder[m])in i.map&&(k=i.map[j],l.map[j]=k,l.push({name:j,value:k}));for(m=0,n=i.length;m<n;m++)(j=i[m].name)in l.map||(k=i.map[j],l.map[j]=k,l.push({name:j,value:k}));i=l}if(f.start(a.name,i,h),!h){if(a=a.firstChild)do{g(a)}while(a=a.next);f.end(c)}}};return 1!=a.type||c.inner?b[11](a):g(a),f.getContent()}}}),g("42",["1","2n","3n","32","5b","3r","1y"],function(a,b,c,d,e,f,g){var j=function(a){return d.isTextPosition(a)?0===a.offset():c.isCaretCandidate(a.getNode())},k=function(a){return d.isTextPosition(a)?a.offset()===a.container().data.length:c.isCaretCandidate(a.getNode(!0))},l=function(a,b){return!d.isTextPosition(a)&&!d.isTextPosition(b)&&a.getNode()===b.getNode(!0)},n=function(a,b,c){return a?!l(b,c)&&!function(a){return!d.isTextPosition(a)&&g.isBr(a.getNode())}(b)&&k(b)&&j(c):!l(c,b)&&j(b)&&k(c)},o=function(a,c,d){var e=new f(c);return b.from(a?e.next(d):e.prev(d))},q=function(a,e){var f=a?e.firstChild:e.lastChild;return g.isText(f)?b.some(new d(f,a?0:f.data.length)):f?c.isCaretCandidate(f)?b.some(a?d.before(f):function(a){return g.isBr(a)?d.before(a):d.after(a)}(f)):function(a,b,c){var e=a?d.before(c):d.after(c);return o(a,b,e)}(a,e,f):b.none()};return{fromPosition:o,nextPosition:a.curry(o,!0),prevPosition:a.curry(o,!1),navigate:function(a,c,d){return o(a,c,d).bind(function(f){return e.isInSameBlock(d,f,c)&&n(a,d,f)?o(a,c,f):b.some(f)})},positionIn:q,firstPositionIn:a.curry(q,!0),lastPositionIn:a.curry(q,!1)}}),g("3u",["1j","42","32","5b"],function(a,b,c,d){var e=function(b,c,d,e){var f=a.createRange();return f.setStart(b,c),f.setEnd(d,e),f},g=function(a){return a.collapsed?a:function(a){var f=c.fromRangeStart(a),g=c.fromRangeEnd(a),h=a.commonAncestorContainer;return b.fromPosition(!1,h,g).map(function(b){return!d.isInSameBlock(f,g,h)&&d.isInSameBlock(f,b,h)?e(f.container(),f.offset(),b.container(),b.offset()):a}).getOr(a)}(a)};return{normalize:function(a){return g(a)}}}),g("1w",["2n","1v","b","3m","32","3r","3s","1y","3t","z","3u","1e"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=h.matchNodeNames("td th"),o=function(c,d){a.from(c.getParent(d,"td,th")).map(b.fromDom).each(i.trimBlockTrailingBr)},p=function(a,b,h){var i,p,q,r,s,t,u,v,w,x,y,z,A=a.schema.getTextInlineElements(),B=a.selection,C=a.dom;if(/^ | $/.test(b)&&(b=function(a){var b,c,d;b=B.getRng(!0),c=b.startContainer,d=b.startOffset;var e=function(a){return c[a]&&3==c[a].nodeType};return 3==c.nodeType&&(d>0?a=a.replace(/^&nbsp;/," "):e("previousSibling")||(a=a.replace(/^ /,"&nbsp;")),d<c.length?a=a.replace(/&nbsp;(<br>|)$/," "):e("nextSibling")||(a=a.replace(/(&nbsp;| )(<br>|)$/,"&nbsp;"))),a}(b)),i=a.parser,z=h.merge,p=new j({validate:a.settings.validate},a.schema),y='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#x200B;</span>',t={content:b,format:"html",selection:!0,paste:h.paste},(t=a.fire("BeforeSetContent",t)).isDefaultPrevented())a.fire("SetContent",{content:t.content,format:"html",selection:!0,paste:h.paste});else{-1==(b=t.content).indexOf("{$caret}")&&(b+="{$caret}"),b=b.replace(/\{\$caret\}/,y);var L=(v=B.getRng()).startContainer||(v.parentElement?v.parentElement():null),M=a.getBody();L===M&&B.isCollapsed()&&C.isBlock(M.firstChild)&&function(b){return b&&!a.schema.getShortEndedElements()[b.nodeName]}(M.firstChild)&&C.isEmpty(M.firstChild)&&((v=C.createRng()).setStart(M.firstChild,0),v.setEnd(M.firstChild,0),B.setRng(v)),B.isCollapsed()||(a.selection.setRng(k.normalize(a.selection.getRng())),a.getDoc().execCommand("Delete",!1,null),function(){var a,c,d;c=(a=B.getRng(!0)).startContainer,d=a.startOffset,3==c.nodeType&&a.collapsed&&(" "===c.data[d]?(c.deleteData(d,1),/[\u00a0| ]$/.test(b)||(b+=" ")):" "===c.data[d-1]&&(c.deleteData(d-1,1),/[\u00a0| ]$/.test(b)||(b=" "+b)))}());var N={context:(q=B.getNode()).nodeName.toLowerCase(),data:h.data,insert:!0};if(s=i.parse(b,N),!0===h.paste&&d.isListFragment(a.schema,s)&&d.isParentBlockLi(C,q))return v=d.insertAtCaret(p,C,a.selection.getRng(!0),s),a.selection.setRng(v),void a.fire("SetContent",t);if(function(a){for(var b=a;b=b.walk();)1===b.type&&b.attr("data-mce-fragment","1")}(s),"mce_marker"==(w=s.lastChild).attr("id"))for(u=w,w=w.prev;w;w=w.walk(!0))if(3==w.type||!C.isBlock(w.name)){a.schema.isValidChild(w.parent.name,"span")&&w.parent.insert(u,w,"br"===w.name);break}if(a._selectionOverrides.showBlockCaretContainer(q),N.invalid){for(B.setContent(y),q=B.getNode(),r=a.getBody(),9==q.nodeType?q=w=r:w=q;w!==r;)q=w,w=w.parentNode;b=q==r?r.innerHTML:C.getOuterHTML(q),b=p.serialize(i.parse(b.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return p.serialize(s)}))),q==r?C.setHTML(r,b):C.setOuterHTML(q,b)}else b=p.serialize(s),function(a,b,c){if("all"===c.getAttribute("data-mce-bogus"))c.parentNode.insertBefore(a.dom.createFragment(b),c);else{var d=c.firstChild,e=c.lastChild;!d||d===e&&"BR"===d.nodeName?a.dom.setHTML(c,b):a.selection.setContent(b)}}(a,b,q);(function(){if(z){var b=a.getBody(),c=new g(C);l.each(C.select("*[data-mce-fragment]"),function(a){for(var d=a.parentNode;d&&d!=b;d=d.parentNode)A[a.nodeName.toLowerCase()]&&c.compare(d,a)&&C.remove(a,!0)})}})(),function(b){var d,g,h;if(b){if(B.scrollIntoView(b),d=function(b){for(var c=a.getBody();b&&b!==c;b=b.parentNode)if("false"===a.dom.getContentEditable(b))return b;return null}(b))return C.remove(b),void B.select(d);v=C.createRng(),(w=b.previousSibling)&&3==w.nodeType?(v.setStart(w,w.nodeValue.length),c.ie||(x=b.nextSibling)&&3==x.nodeType&&(w.appendData(x.data),x.parentNode.removeChild(x))):(v.setStartBefore(b),v.setEndBefore(b)),g=C.getParent(b,C.isBlock),C.remove(b),g&&C.isEmpty(g)&&(a.$(g).empty(),v.setStart(g,0),v.setEnd(g,0),!m(g)&&!g.getAttribute("data-mce-fragment")&&(h=function(b){var c=e.fromRangeStart(b);if(c=new f(a.getBody()).next(c))return c.toRange()}(v))?(v=h,C.remove(g)):C.add(g,C.create("br",{"data-mce-bogus":"1"}))),B.setRng(v)}}(C.get("mce_marker")),function(a){l.each(a.getElementsByTagName("*"),function(a){a.removeAttribute("data-mce-fragment")})}(a.getBody()),o(a.dom,a.selection.getStart()),a.fire("SetContent",t),a.addVisual()}};return{insertAtCaret:function(a,b){var c=function(a){var b;return"string"!=typeof a?(b=l.extend({paste:a.paste,data:{paste:a.paste}},a),{content:a.content,details:b}):{content:a,details:{}}}(b);p(a,c.content,c.details)}}}),g("6d",["28","2n"],function(a,b){return function(c,d,e,f,g){return c(e,f)?b.some(e):a.isFunction(g)&&g(e)?b.none():d(e,f,g)}}),g("5i",["28","1i","1","2n","51","31","1v","6d"],function(a,b,c,d,e,f,g,h){var j=function(b,e,f){for(var h=b.dom(),i=a.isFunction(f)?f:c.constant(!1);h.parentNode;){h=h.parentNode;var j=g.fromDom(h);if(e(j))return d.some(j);if(i(j))break}return d.none()},m=function(a,d){return b.find(a.dom().childNodes,c.compose(d,g.fromDom)).map(g.fromDom)},n=function(a,b){var c=function(a){for(var e=0;e<a.childNodes.length;e++){if(b(g.fromDom(a.childNodes[e])))return d.some(g.fromDom(a.childNodes[e]));var f=c(a.childNodes[e]);if(f.isSome())return f}return d.none()};return c(a.dom())};return{first:function(a){return n(e.body(),a)},ancestor:j,closest:function(a,b,c){return h(function(a){return b(a)},j,a,b,c)},sibling:function(a,b){var c=a.dom();return c.parentNode?m(g.fromDom(c.parentNode),function(c){return!f.eq(a,c)&&b(c)}):d.none()},child:m,descendant:n}}),g("21",["1i","1","4g","2n","4h","45","28","3d","1e"],function(a,b,c,d,e,f,g,h,i){var j=f.immutable("sections","settings"),l=h.detect().deviceType.isTouch(),m=["lists","autolink","autosave"],n={theme:"mobile"},o=function(b){var c=g.isArray(b)?b.join(" "):b,d=a.map(g.isString(c)?c.split(" "):[],e.trim);return a.filter(d,function(a){return a.length>0})},p=function(c){return a.filter(c,b.curry(a.contains,m))},q=function(b,d){var e=c.bifilter(d,function(c,d){return a.contains(b,d)});return j(e.t,e.f)},s=function(a,b){return a.sections().hasOwnProperty(b)},w=function(a,b,c,d){var e=o(c.forced_plugins),f=o(d.plugins),h=function(a,b){return[].concat(o(a)).concat(o(b))}(e,a&&s(b,"mobile")?p(f):f);return i.extend(d,{plugins:h.join(" ")})},y=function(a,b,c,d){var e=q(["mobile"],d),f=i.extend(b,c,e.settings(),function(a,b){var c=b.settings().inline;return a&&s(b,"mobile")&&!c}(a,e)?function(a,b,c){var d=a.sections(),e=d.hasOwnProperty(b)?d[b]:{};return i.extend({},c,e)}(e,"mobile",n):{},{validate:!0,content_editable:e.settings().inline,external_plugins:function(a,b){var c=b.external_plugins?b.external_plugins:{};return a&&a.external_plugins?i.extend({},a.external_plugins,c):c}(c,e.settings())});return w(a,e,c,f)};return{getEditorSettings:function(a,b,c,d,e){var f=function(a,b,c){return{id:a,theme:"modern",delta_width:0,delta_height:0,popup_css:"",plugins:"",document_base_url:b,add_form_submit_trigger:!0,submit_patch:!0,add_unload_trigger:!0,convert_urls:!0,relative_urls:!0,remove_script_host:!0,object_resizing:!0,doctype:"<!DOCTYPE html>",visual:!0,font_size_style_values:"xx-small,x-small,small,medium,large,x-large,xx-large",font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",forced_root_block:"p",hidden_input:!0,padd_empty_editor:!0,render_ui:!0,indentation:"30px",inline_styles:!0,convert_fonts_to_spans:!0,indent:"simple",indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",entity_encoding:"named",url_converter:c.convertURL,url_converter_scope:c,ie7_compat:!0}}(b,c,a);return y(l,f,d,e)},get:function(a,b){return d.from(a.settings[b])},getString:b.curry(function(a,b,c){return d.from(b.settings[c]).filter(a)},g.isString),combineSettings:y}}),g("5j",[],function(){var a=/[\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC]/;return{hasStrongRtl:function(b){return a.test(b)}}}),g("44",["1i","1","2n","1v","2z","21","46","32","5b","m","1y","5j"],function(a,b,c,d,e,f,g,h,i,j,k,l){var o=function(b,c,d){return a.filter(j.DOM.getParents(d.container(),"*",c),b)},s=function(a,b){var c=b.container(),d=b.offset();return a?g.isCaretContainerInline(c)?k.isText(c.nextSibling)?new h(c.nextSibling,0):h.after(c):g.isBeforeInline(b)?new h(c,d+1):b:g.isCaretContainerInline(c)?k.isText(c.previousSibling)?new h(c.previousSibling,c.previousSibling.data.length):h.before(c):g.isAfterInline(b)?new h(c,d-1):b};return{isInlineTarget:function(a,b){var c=f.getString(a,"inline_boundaries_selector").getOr("a[href],code");return e.is(d.fromDom(b),c)},findRootInline:function(a,b,d){var e=o(a,b,d);return c.from(e[e.length-1])},isRtl:function(a){return"rtl"===j.DOM.getStyle(a,"direction",!0)||l.hasStrongRtl(a.textContent)},isAtZwsp:function(a){return g.isBeforeInline(a)||g.isAfterInline(a)},normalizePosition:s,normalizeForwards:b.curry(s,!0),normalizeBackwards:b.curry(s,!1),hasSameParentBlock:function(a,b,c){var d=i.getParentBlock(b,a),e=i.getParentBlock(c,a);return d&&d===e}}}),g("3y",["2n","5c","31","1v","5i","42","3l","44"],function(a,b,c,d,e,f,g,h){var i=function(a){return function(b){return c.eq(a,d.fromDom(b.dom().parentNode))}};return{getParentBlock:function(b,d){return c.contains(b,d)?e.closest(d,function(a){return g.isTextBlock(a)||g.isListItem(a)},i(b)):a.none()},paddEmptyBody:function(a){a.dom.isEmpty(a.getBody())&&(a.setContent(""),function(a){var b=a.getBody(),c=b.firstChild&&a.dom.isBlock(b.firstChild)?b.firstChild:b;a.selection.setCursorLocation(c,0)}(a))},willDeleteLastPositionInElement:function(a,c,d){return b.liftN([f.firstPositionIn(d),f.lastPositionIn(d)],function(b,e){var g=h.normalizePosition(!0,b),i=h.normalizePosition(!1,e),j=h.normalizePosition(!1,c);return a?f.nextPosition(d,j).map(function(a){return a.isEqual(i)&&c.isEqual(g)}).getOr(!1):f.prevPosition(d,j).map(function(a){return a.isEqual(g)&&c.isEqual(i)}).getOr(!1)}).getOr(!0)}}}),g("62",["5i","2z","6d"],function(a,b,c){var e=function(c,d,e){return a.ancestor(c,function(a){return b.is(a,d)},e)};return{first:function(a){return b.one(a)},ancestor:e,sibling:function(c,d){return a.sibling(c,function(a){return b.is(a,d)})},child:function(c,d){return a.child(c,function(a){return b.is(a,d)})},descendant:function(a,c){return b.one(c,a)},closest:function(a,d,f){return c(b.is,e,a,d,f)}}}),g("6e",["62"],function(a){return{any:function(b){return a.first(b).isSome()},ancestor:function(b,c,d){return a.ancestor(b,c,d).isSome()},sibling:function(b,c){return a.sibling(b,c).isSome()},child:function(b,c){return a.child(b,c).isSome()},descendant:function(b,c){return a.descendant(b,c).isSome()},closest:function(b,c,d){return a.closest(b,c,d).isSome()}}}),g("5r",["1","31","1v","6e","3n","1y","s"],function(a,b,c,d,e,f,g){var h=function(e,f){var g=c.fromDom(e),h=c.fromDom(f);return d.ancestor(h,"pre,code",a.curry(b.eq,g))},k=function(a,b){return e.isCaretCandidate(b)&&!1===function(a,b){return f.isText(b)&&/^[ \t\r\n]*$/.test(b.data)&&!1===h(a,b)}(a,b)||function(a){return f.isElement(a)&&"A"===a.nodeName&&a.hasAttribute("name")}(b)||l(b)},l=f.hasAttribute("data-mce-bookmark"),m=f.hasAttribute("data-mce-bogus"),n=f.hasAttributeValue("data-mce-bogus","all");return{isEmpty:function(a){return function(a){var b,c,d=0;if(k(a,a))return!1;if(!(c=a.firstChild))return!0;b=new g(c,a);do{if(n(c))c=b.next(!0);else if(m(c))c=b.next();else if(f.isBr(c))d++,c=b.next();else{if(k(a,c))return!1;c=b.next()}}while(c);return d<=1}(a.dom())}}}),g("5g",["1i","1","2n","5c","45","31","1v","3f","5i","3h","42","32","3y","5r","1y"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=e.immutable("block","position"),q=e.immutable("from","to"),r=function(a,b){var c=g.fromDom(a),d=g.fromDom(b.container());return m.getParentBlock(c,d).map(function(a){return p(a,b)})},s=function(a){return!1===f.eq(a.from().block(),a.to().block())},t=function(a){return j.parent(a.from().block()).bind(function(b){return j.parent(a.to().block()).filter(function(a){return f.eq(b,a)})}).isSome()},v=function(a,b,d){return o.isBr(d.position().getNode())&&!1===n.isEmpty(d.block())?k.positionIn(!1,d.block().dom()).bind(function(e){return e.isEqual(d.position())?k.fromPosition(b,a,e).bind(function(b){return r(a,b)}):c.some(d)}).getOr(d):d},w=function(a,b,c){var e=r(a,l.fromRangeStart(c)),f=e.bind(function(c){return k.fromPosition(b,a,c.position()).bind(function(c){return r(a,c).map(function(c){return v(a,b,c)})})});return d.liftN([e,f],q).filter(function(a){return s(a)&&t(a)&&function(a){return!1===o.isContentEditableFalse(a.from().block())&&!1===o.isContentEditableFalse(a.to().block())}(a)})};return{read:function(a,b,d){return d.collapsed?w(a,b,d):c.none()}}}),g("5s",["1","31","3h"],function(a,b,c){var e=function(a,e,f){return b.contains(e,a)?function(a){return a.slice(0,-1)}(c.parents(a,function(a){return f(a)||b.eq(a,e)})):[]},f=function(b,c){return e(b,c,a.constant(!1))};return{parentsUntil:e,parents:f,parentsAndSelf:function(a,b){return[a].concat(f(a,b))}}}),g("5h",["1i","2n","31","41","47","1v","3h","42","32","3l","5r","1y","3t","5s"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var p=function(b){var c=function(b){var c=g.children(b);return a.findIndex(c,j.isBlock).fold(function(){return c},function(a){return c.slice(0,a)})}(b);return a.each(c,function(a){e.remove(a)}),c},q=function(a,b){h.positionIn(a,b.dom()).each(function(a){var b=a.getNode();l.isBr(b)&&e.remove(f.fromDom(b))})},r=function(b,c){var d=n.parentsAndSelf(c,b);return a.find(d.reverse(),k.isEmpty).each(e.remove)},t=function(a,d){return c.contains(d,a)?g.parent(a).bind(function(e){return c.eq(e,d)?b.some(a):function(a,d){var e=g.parents(d,function(b){return c.eq(b,a)});return b.from(e[e.length-2])}(d,a)}):b.none()},u=function(b,c,f){if(k.isEmpty(f))return e.remove(f),k.isEmpty(c)&&m.fillWithPaddingBr(c),h.firstPositionIn(c.dom());q(!0,c),q(!1,f);var g=p(c);return t(c,f).fold(function(){r(b,c);var e=h.lastPositionIn(f.dom());return a.each(g,function(a){d.append(f,a)}),e},function(e){var j=h.prevPosition(f.dom(),i.before(e.dom()));return a.each(g,function(a){d.before(e,a)}),r(b,c),j})};return{mergeBlocks:function(a,b,c,d){return b?u(a,d,c):u(a,c,d)}}}),g("3v",["1v","5g","5h"],function(a,b,c){return{backspaceDelete:function(d,e){var f,g=a.fromDom(d.getBody());return(f=b.read(g.dom(),e,d.selection.getRng()).bind(function(a){return c.mergeBlocks(g,e,a.from().block(),a.to().block())})).each(function(a){d.selection.setRng(a.toRange())}),f.isSome()}}}),g("3w",["1","5c","31","1v","5i","42","32","3y","5h","3l"],function(a,b,c,d,e,f,g,h,i,j){var k=function(a,e){var f=e.getRng();return b.liftN([h.getParentBlock(a,d.fromDom(f.startContainer)),h.getParentBlock(a,d.fromDom(f.endContainer))],function(b,d){return!1===c.eq(b,d)&&(f.deleteContents(),i.mergeBlocks(a,!0,b,d).each(function(a){e.setRng(a.toRange())}),!0)}).getOr(!1)},l=function(b,f){var g=d.fromDom(f),h=a.curry(c.eq,b);return e.ancestor(g,j.isTableCell,h).isSome()},n=function(a,b){var c=f.prevPosition(a.dom(),g.fromRangeStart(b)).isNone(),d=f.nextPosition(a.dom(),g.fromRangeEnd(b)).isNone();return!function(a,b){return l(a,b.startContainer)||l(a,b.endContainer)}(a,b)&&c&&d};return{backspaceDelete:function(a,b){return!a.selection.isCollapsed()&&function(a){var b=d.fromDom(a.getBody()),c=a.selection.getRng();return n(b,c)?function(a){return a.setContent(""),a.selection.setCursorLocation(),!0}(a):k(b,a.selection)}(a,a.selection.getRng())}}}),g("5n",["1i","4g","28","4","5","3e"],function(a,b,c,d,e,f){return{generate:function(g){if(!c.isArray(g))throw new e("cases must be an array");if(0===g.length)throw new e("there must be at least one case");var h=[],i={};return a.each(g,function(j,k){var l=b.keys(j);if(1!==l.length)throw new e("one and only one name per case");var m=l[0],n=j[m];if(void 0!==i[m])throw new e("duplicate key detected:"+m);if("cata"===m)throw new e("cannot have a case named cata (sorry)");if(!c.isArray(n))throw new e("case arguments must be an array");h.push(m),i[m]=function(){var c=arguments.length;if(c!==n.length)throw new e("Wrong number of arguments to case "+m+". Expected "+n.length+" ("+n+"), got "+c);for(var i=new d(c),j=0;j<i.length;j++)i[j]=arguments[j];return{fold:function(){if(arguments.length!==g.length)throw new e("Wrong number of arguments to fold. Expected "+g.length+", got "+arguments.length);return arguments[k].apply(null,i)},match:function(c){var d=b.keys(c);if(h.length!==d.length)throw new e("Wrong number of arguments to match. Expected: "+h.join(",")+"\nActual: "+d.join(","));if(!a.forall(h,function(b){return a.contains(d,b)}))throw new e("Not all branches were specified when using match. Specified: "+d.join(", ")+"\nRequired: "+h.join(", "));return c[m].apply(null,i)},log:function(a){f.log(a,{constructors:h,constructor:m,params:i})}}}}),i}}}),g("5k",["5n","2n","1v","42","32","5b","3y","5r","1y"],function(a,b,c,d,e,f,g,h,i){var j=a.generate([{remove:["element"]},{moveToElement:["element"]},{moveToPosition:["position"]}]),l=function(a,d,e,f){var i=f.getNode(!1===d);return g.getParentBlock(c.fromDom(a),c.fromDom(e.getNode())).map(function(a){return h.isEmpty(a)?j.remove(a.dom()):j.moveToElement(i)}).orThunk(function(){return b.some(j.moveToElement(i))})},m=function(a,c,e){return d.fromPosition(c,a,e).bind(function(d){return c&&i.isContentEditableFalse(d.getNode())?l(a,c,e,d):!1===c&&i.isContentEditableFalse(d.getNode(!0))?l(a,c,e,d):c&&f.isAfterContentEditableFalse(e)?b.some(j.moveToPosition(d)):!1===c&&f.isBeforeContentEditableFalse(e)?b.some(j.moveToPosition(d)):b.none()})},o=function(a,c,d){return d.fold(function(a){return b.some(j.remove(a))},function(a){return b.some(j.moveToElement(a))},function(d){return f.isInSameBlock(c,d,a)?b.none():b.some(j.moveToPosition(d))})},p=function(a,c,d){return function(a,b){var c=b.getNode(!1===a),d=a?"after":"before";return i.isElement(c)&&c.getAttribute("data-mce-caret")===d}(c,d)?function(a,c){return a&&i.isContentEditableFalse(c.nextSibling)?b.some(j.moveToElement(c.nextSibling)):!1===a&&i.isContentEditableFalse(c.previousSibling)?b.some(j.moveToElement(c.previousSibling)):b.none()}(c,d.getNode(!1===c)).fold(function(){return m(a,c,d)},b.some):m(a,c,d).bind(function(b){return o(a,d,b)})};return{read:function(a,c,d){var g=f.normalizeRange(c?1:-1,a,d),h=e.fromRangeStart(g);return!1===c&&f.isAfterContentEditableFalse(h)?b.some(j.remove(h.getNode(!0))):c&&f.isBeforeContentEditableFalse(h)?b.some(j.remove(h.getNode())):p(a,c,h)}}}),g("5l",["1","2n","5c","41","47","1v","3f","5i","3h","3n","42","32","5r","1y"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var p=function(a,b){return function(a,b){var c=a.container(),d=a.offset();return!1===l.isTextPosition(a)&&c===b.parentNode&&d>l.before(b).offset()}(b,a)?new l(b.container(),b.offset()-1):b},s=function(a){return j.isCaretCandidate(a.previousSibling)?b.some(function(a){return n.isText(a)?new l(a,a.data.length):l.after(a)}(a.previousSibling)):a.previousSibling?k.lastPositionIn(a.previousSibling):b.none()},t=function(a){return j.isCaretCandidate(a.nextSibling)?b.some(function(a){return n.isText(a)?new l(a,0):l.before(a)}(a.nextSibling)):a.nextSibling?k.firstPositionIn(a.nextSibling):b.none()},u=function(a,c){var d=l.before(c.previousSibling?c.previousSibling:c.parentNode);return k.prevPosition(a,d).fold(function(){return k.nextPosition(a,l.after(c))},b.some)},v=function(a,c){return k.nextPosition(a,l.after(c)).fold(function(){return k.prevPosition(a,l.before(c))},b.some)},y=function(a,b,c){return a?function(a,b){return t(b).orThunk(function(){return s(b)}).orThunk(function(){return v(a,b)})}(b,c):function(a,b){return s(b).orThunk(function(){return t(b)}).orThunk(function(){return u(a,b)})}(b,c)},A=function(a,b,c){c.fold(function(){a.focus()},function(c){a.selection.setRng(c.toRange(),b)})},C=function(a,b){return b&&a.schema.getBlockElements().hasOwnProperty(g.name(b))},D=function(a){if(m.isEmpty(a)){var c=f.fromHtml('<br data-mce-bogus="1">');return e.empty(a),d.append(a,c),b.some(l.before(c.dom()))}return b.none()},E=function(a,b){return c.liftN([i.prevSibling(a),i.nextSibling(a),b],function(b,c,d){var f,g=b.dom(),h=c.dom();return n.isText(g)&&n.isText(h)?(f=g.data.length,g.appendData(h.data),e.remove(c),e.remove(a),d.container()===h?new l(g,f):d):(e.remove(a),d)}).orThunk(function(){return e.remove(a),b})};return{deleteElement:function(c,d,e){var f=function(b,c,d){return y(b,c,d).map(a.curry(p,d))}(d,c.getBody(),e.dom()),g=h.ancestor(e,a.curry(C,c),function(a){return function(b){return b.dom()===a}}(c.getBody())),i=E(e,f);c.dom.isEmpty(c.getBody())?(c.setContent(""),c.selection.setCursorLocation()):g.bind(D).fold(function(){A(c,d,i)},function(a){A(c,d,b.some(a))})}}}),g("3x",["1i","47","1v","5f","32","5k","5l","3y","1y"],function(a,b,c,d,e,f,g,h,i){var j=function(a,b){return function(d){return a._selectionOverrides.hideFakeCaret(),g.deleteElement(a,b,c.fromDom(d)),!0}},m=function(a,b){return f.read(a.getBody(),b,a.selection.getRng()).map(function(c){return c.fold(j(a,b),function(a,b){return function(c){var d=b?e.before(c):e.after(c);return a.selection.setRng(d.toRange()),!0}}(a,b),function(a){return function(b){return a.selection.setRng(b.toRange()),!0}}(a))}).getOr(!1)},n=function(c){a.each(d.descendants(c,".mce-offscreen-selection"),b.remove)};return{backspaceDelete:function(a,b){return a.selection.isCollapsed()?m(a,b):function(a,b){var d=a.selection.getNode();return!!i.isContentEditableFalse(d)&&(n(c.fromDom(a.getBody())),g.deleteElement(a,b,c.fromDom(a.selection.getNode())),h.paddEmptyBody(a),!0)}(a,b)},paddEmptyElement:function(a){var b,c=function(a,b){for(;b&&b!==a;){if(i.isContentEditableTrue(b)||i.isContentEditableFalse(b))return b;b=b.parentNode}return null}(a.getBody(),a.selection.getNode());return i.isContentEditableTrue(c)&&a.dom.isBlock(c)&&a.dom.isEmpty(c)&&(b=a.dom.create("br",{"data-mce-bogus":"1"}),a.dom.setHTML(c,""),c.appendChild(b),a.selection.setRng(e.before(b).toRange())),!0}}}),g("6f",["1","1y","4b"],function(a,b,c){var d=b.isText,e=function(a){return d(a)&&a.data[0]===c.ZWSP},f=function(a){return d(a)&&a.data[a.data.length-1]===c.ZWSP},g=function(a){return a.ownerDocument.createTextNode(c.ZWSP)},j=function(a,b){return a?function(a){if(d(a.previousSibling))return f(a.previousSibling)?a.previousSibling:(a.previousSibling.appendData(c.ZWSP),a.previousSibling);if(d(a))return e(a)?a:(a.insertData(0,c.ZWSP),a);var b=g(a);return a.parentNode.insertBefore(b,a),b}(b):function(a){if(d(a.nextSibling))return e(a.nextSibling)?a.nextSibling:(a.nextSibling.insertData(0,c.ZWSP),a.nextSibling);if(d(a))return f(a)?a:(a.appendData(c.ZWSP),a);var b=g(a);return a.nextSibling?a.parentNode.insertBefore(b,a.nextSibling):a.parentNode.appendChild(b),b}(b)};return{insertInline:j,insertInlineBefore:a.curry(j,!0),insertInlineAfter:a.curry(j,!1)}}),g("6g",["1i","46","32","1y","4b"],function(a,b,c,d,e){var f=d.isElement,g=d.isText,h=function(a){var b=a.parentNode;b&&b.removeChild(a)},j=function(a,b){0===b.length?h(a):a.nodeValue=b},k=function(a){var b=e.trim(a);return{count:a.length-b.length,text:b}},l=function(a,b){return r(a),b},n=function(b,d){var e=d.container(),f=a.indexOf(e.childNodes,b).map(function(a){return a<d.offset()?new c(e,d.offset()-1):d}).getOr(d);return r(b),f},o=function(a,b){return b.container()===a?function(a,b){var d=k(a.data.substr(0,b.offset())),e=k(a.data.substr(b.offset())),f=d.text+e.text;return f.length>0?(j(a,f),new c(a,b.offset()-d.count)):b}(a,b):l(a,b)},r=function(a){if(f(a)&&b.isCaretContainer(a)&&(b.hasContent(a)?a.removeAttribute("data-mce-caret"):h(a)),g(a)){var c=e.trim(function(a){try{return a.nodeValue}catch(a){return""}}(a));j(a,c)}};return{removeAndReposition:function(a,b){return c.isTextPosition(b)?o(a,b):function(a,b){return b.container()===a.parentNode?n(a,b):l(a,b)}(a,b)},remove:r}}),g("5m",["2n","46","6f","6g","42","32","1y","44"],function(a,b,c,d,e,f,g,h){var i=function(a,b){return g.isText(a.container())?c.insertInline(b,a.container()):c.insertInline(b,a.getNode())},j=function(a,c){var d=c.get();return d&&a.container()===d&&b.isCaretContainerInline(d)};return{renderCaret:function(b,g){return g.fold(function(e){d.remove(b.get());var g=c.insertInlineBefore(e);return b.set(g),a.some(new f(g,g.length-1))},function(a){return e.firstPositionIn(a).map(function(a){if(j(a,b))return new f(b.get(),1);d.remove(b.get());var c=i(a,!0);return b.set(c),new f(c,1)})},function(a){return e.lastPositionIn(a).map(function(a){if(j(a,b))return new f(b.get(),b.get().length-1);d.remove(b.get());var c=i(a,!1);return b.set(c),new f(c,c.length-1)})},function(e){d.remove(b.get());var g=c.insertInlineAfter(e);return b.set(g),a.some(new f(g,1))})}}}),g("4a",["s"],function(a){var b=function(a){return a&&/^(IMG)$/.test(a.nodeName)},g=function(a){return a&&3===a.nodeType&&/^([\t \r\n]+|)$/.test(a.nodeValue)},j=function(a,b,c){return"color"!==c&&"backgroundColor"!==c||(b=a.toHex(b)),"fontWeight"===c&&700===b&&(b="bold"),"fontFamily"===c&&(b=b.replace(/[\'\"]/g,"").replace(/,\s+/g,",")),""+b};return{isInlineBlock:b,moveStart:function(c,d,e){var f,h,i,j=e.startContainer,k=e.startOffset;if((e.startContainer!==e.endContainer||!b(e.startContainer.childNodes[e.startOffset]))&&(3===j.nodeType&&k>=j.nodeValue.length&&(k=c.nodeIndex(j),j=j.parentNode),1===j.nodeType))for(i=j.childNodes,k<i.length?(j=i[k],f=new a(j,c.getParent(j,c.isBlock))):(j=i[i.length-1],(f=new a(j,c.getParent(j,c.isBlock))).next(!0)),h=f.current();h;h=f.next())if(3===h.nodeType&&!g(h))return e.setStart(h,0),void d.setRng(e)},getNonWhiteSpaceSibling:function(a,b,c){if(a)for(b=b?"nextSibling":"previousSibling",a=c?a:a[b];a;a=a[b])if(1===a.nodeType||!g(a))return a},isTextBlock:function(a,b){return b.nodeType&&(b=b.nodeName),!!a.schema.getTextBlockElements()[b.toLowerCase()]},isValid:function(a,b,c){return a.schema.isValidChild(b,c)},isWhiteSpaceNode:g,replaceVars:function(a,b){return"string"!=typeof a?a=a(b):b&&(a=a.replace(/%(\w+)/g,function(a,c){return b[c]||a})),a},isEq:function(a,b){return a=a||"",b=b||"",a=""+(a.nodeName||a),b=""+(b.nodeName||b),a.toLowerCase()===b.toLowerCase()},normalizeStyleValue:j,getStyle:function(a,b,c){return j(a,a.getStyle(b,c),c)},getTextDecoration:function(a,b){var c;return a.getParent(b,function(b){return(c=a.getStyle(b,"text-decoration"))&&"none"!==c}),c},getParents:function(a,b,c){return a.getParents(b,c,a.getRoot())}}}),g("49",["2r","s","4a","2v"],function(a,b,c,d){var e=a.isBookmarkNode,f=c.getParents,g=c.isWhiteSpaceNode,h=c.isTextBlock,i=function(a,b){for(void 0===b&&(b=3===a.nodeType?a.length:a.childNodes.length);a&&a.hasChildNodes();)(a=a.childNodes[b])&&(b=3===a.nodeType?a.length:a.childNodes.length);return{node:a,offset:b}},j=function(a,b){var c=i(a,b);if(c.node){for(;c.node&&0===c.offset&&c.node.previousSibling;)c=i(c.node.previousSibling);c.node&&c.offset>0&&3===c.node.nodeType&&" "===c.node.nodeValue.charAt(c.offset-1)&&c.offset>1&&(a=c.node).splitText(c.offset-1)}return a},k=function(a){return"BR"===a.nodeName&&a.getAttribute("data-mce-bogus")&&!a.nextSibling},l=function(a,b){for(var c=b;c;){if(1===c.nodeType&&a.getContentEditable(c))return"false"===a.getContentEditable(c)?c:b;c=c.parentNode}return b},m=function(a,b,c,d){var e,f,g=c.nodeValue;return void 0===d&&(d=a?g.length:0),a?(e=g.lastIndexOf(" ",d),f=g.lastIndexOf(" ",d),-1===(e=e>f?e:f)||b||e++):(e=g.indexOf(" ",d),f=g.indexOf(" ",d),e=-1!==e&&(-1===f||e<f)?e:f),e},n=function(a,c,d,e,f,g){var h,i,j,k;if(3===d.nodeType){if(-1!==(j=m(f,g,d,e)))return{container:d,offset:j};k=d}for(h=new b(d,a.getParent(d,a.isBlock)||c);i=h[f?"prev":"next"]();)if(3===i.nodeType){if(k=i,-1!==(j=m(f,g,i)))return{container:i,offset:j}}else if(a.isBlock(i))break;if(k)return e=f?0:k.length,{container:k,offset:e}},o=function(a,b,c,d,e){var g,h,i,j;for(3===d.nodeType&&0===d.nodeValue.length&&d[e]&&(d=d[e]),g=f(a,d),h=0;h<g.length;h++)for(i=0;i<b.length;i++)if(!("collapsed"in(j=b[i])&&j.collapsed!==c.collapsed)&&a.is(g[h],j.selector))return g[h];return d},p=function(a,b,d,e){var g,i=a.dom,j=i.getRoot();if(b[0].wrapper||(g=i.getParent(d,b[0].block,j)),!g){var k=i.getParent(d,"LI,TD,TH");g=i.getParent(3===d.nodeType?d.parentNode:d,function(b){return b!==j&&h(a,b)},k)}if(g&&b[0].wrapper&&(g=f(i,g,"ul,ol").reverse()[0]||g),!g)for(g=d;g[e]&&!i.isBlock(g[e])&&(g=g[e],!c.isEq(g,"br")););return g||d},q=function(a,b,c,d,f,h,i){var j,l,m,n,o;if(j=l=i?c:f,n=i?"previousSibling":"nextSibling",o=a.getRoot(),3===j.nodeType&&!g(j)&&(i?d>0:h<j.nodeValue.length))return j;for(;;){if(!b[0].block_expand&&a.isBlock(l))return l;for(m=l[n];m;m=m[n])if(!e(m)&&!g(m)&&!k(m))return l;if(l===o||l.parentNode===o){j=l;break}l=l.parentNode}return j};return{expandRng:function(a,b,c,f){var g,h=b.startContainer,i=b.startOffset,k=b.endContainer,m=b.endOffset,r=a.dom;return 1===h.nodeType&&h.hasChildNodes()&&3===(h=d.getNode(h,i)).nodeType&&(i=0),1===k.nodeType&&k.hasChildNodes()&&3===(k=d.getNode(k,b.collapsed?m:m-1)).nodeType&&(m=k.nodeValue.length),h=l(r,h),k=l(r,k),(e(h.parentNode)||e(h))&&(h=e(h)?h:h.parentNode,3===(h=h.nextSibling||h).nodeType&&(i=0)),(e(k.parentNode)||e(k))&&(k=e(k)?k:k.parentNode,3===(k=k.previousSibling||k).nodeType&&(m=k.length)),c[0].inline&&(b.collapsed&&((g=n(r,a.getBody(),h,i,!0,f))&&(h=g.container,i=g.offset),(g=n(r,a.getBody(),k,m,!1,f))&&(k=g.container,m=g.offset)),k=f?k:j(k,m)),(c[0].inline||c[0].block_expand)&&(c[0].inline&&3===h.nodeType&&0!==i||(h=q(r,c,h,i,k,m,!0)),c[0].inline&&3===k.nodeType&&m!==k.nodeValue.length||(k=q(r,c,h,i,k,m,!1))),c[0].selector&&!1!==c[0].expand&&!c[0].inline&&(h=o(r,c,b,h,"previousSibling"),k=o(r,c,b,k,"nextSibling")),(c[0].block||c[0].selector)&&(h=p(a,c,h,"previousSibling"),k=p(a,c,k,"nextSibling"),c[0].block&&(r.isBlock(h)||(h=q(r,c,h,i,k,m,!0)),r.isBlock(k)||(k=q(r,c,h,i,k,m,!1)))),1===h.nodeType&&(i=r.nodeIndex(h),h=h.parentNode),1===k.nodeType&&(m=r.nodeIndex(k)+1,k=k.parentNode),{startContainer:h,startOffset:i,endContainer:k,endOffset:m}}}}),g("2i",["4a"],function(a){var b=a.isEq,c=function(a,b,c){var d=a.formatter.get(c);if(d)for(var e=0;e<d.length;e++)if(!1===d[e].inherit&&a.dom.is(b,d[e].selector))return!0;return!1},d=function(a,b,d,e){var f=a.dom.getRoot();return b!==f&&(b=a.dom.getParent(b,function(b){return!!c(a,b,d)||b.parentNode===f||!!g(a,b,d,e,!0)}),g(a,b,d,e))},e=function(a,c,d){return!!b(c,d.inline)||!!b(c,d.block)||(d.selector?1===c.nodeType&&a.is(c,d.selector):void 0)},f=function(c,d,e,f,g,h){var i,j,k,l=e[f];if(e.onmatch)return e.onmatch(d,e,f);if(l)if(void 0===l.length){for(i in l)if(l.hasOwnProperty(i)){if(j="attributes"===f?c.getAttrib(d,i):a.getStyle(c,d,i),g&&!j&&!e.exact)return;if((!g||e.exact)&&!b(j,a.normalizeStyleValue(c,a.replaceVars(l[i],h),i)))return}}else for(k=0;k<l.length;k++)if("attributes"===f?c.getAttrib(d,l[k]):a.getStyle(c,d,l[k]))return e;return e},g=function(a,b,c,d,g){var h,i,j,k,l=a.formatter.get(c),m=a.dom;if(l&&b)for(i=0;i<l.length;i++)if(h=l[i],e(a.dom,b,h)&&f(m,b,h,"attributes",g,d)&&f(m,b,h,"styles",g,d)){if(k=h.classes)for(j=0;j<k.length;j++)if(!a.dom.hasClass(b,k[j]))return;return h}};return{matchNode:g,matchName:e,match:function(a,b,c,e){var f;return e?d(a,e,b,c):(e=a.selection.getNode(),!!d(a,e,b,c)||!((f=a.selection.getStart())===e||!d(a,f,b,c)))},matchAll:function(a,b,c){var d,e=[],f={};return d=a.selection.getStart(),a.dom.getParent(d,function(d){var h,i;for(h=0;h<b.length;h++)i=b[h],!f[i]&&g(a,d,i,c)&&(f[i]=!0,e.push(i))},a.dom.getRoot()),e},canApply:function(b,c){var d,e,f,g,h,i=b.formatter.get(c),j=b.dom;if(i)for(d=b.selection.getStart(),e=a.getParents(j,d),g=i.length-1;g>=0;g--){if(!(h=i[g].selector)||i[g].defaultBlock)return!0;for(f=e.length-1;f>=0;f--)if(j.is(e[f],h))return!0}return!1},matchesUnInheritedFormatSelector:c}}),g("2x",["1y"],function(a){var b=function(a,b){return a.splitText(b)};return{split:function(c){var d=c.startContainer,e=c.startOffset,f=c.endContainer,g=c.endOffset;return d===f&&a.isText(d)?e>0&&e<d.nodeValue.length&&(f=b(d,e),d=f.previousSibling,g>e?(g-=e,d=f=b(f,g).previousSibling,g=f.nodeValue.length,e=0):g=0):(a.isText(d)&&e>0&&e<d.nodeValue.length&&(d=b(d,e),e=0),a.isText(f)&&g>0&&g<f.nodeValue.length&&(f=b(f,g).previousSibling,g=f.nodeValue.length)),{startContainer:d,startOffset:e,endContainer:f,endOffset:g}}}}),g("2f",["1i","41","47","1v","3f","48","32","1y","3t","s","49","4a","2i","2x","4b","3q"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=o.ZWSP,r="_mce_caret",t=function(a){return 1===a.nodeType&&a.id===r},v=function(a){return function(a){for(var b=[];a;){if(3===a.nodeType&&a.nodeValue!==q||a.childNodes.length>1)return[];1===a.nodeType&&b.push(a),a=a.firstChild}return b}(a).length>0},w=function(a){var b;if(a)for(b=new j(a,a),a=b.current();a;a=b.next())if(3===a.nodeType)return a;return null},x=function(a){var c=d.fromTag("span");return f.setAll(c,{id:r,"data-mce-bogus":"1","data-mce-type":"format-caret"}),a&&b.append(c,d.fromText(q)),c},y=function(a,b){for(;b&&b!==a;){if(b.id===r)return b;b=b.parentNode}return null},A=function(a,b,c,e){var f,g,h;f=b.getRng(!0),g=a.getParent(c,a.isBlock),v(c)?(!1!==e&&(f.setStartBefore(c),f.setEndBefore(c)),a.remove(c)):(h=function(a){var b=w(a);return b&&b.nodeValue.charAt(0)===q&&b.deleteData(0,1),b}(c),f.startContainer===h&&f.startOffset>0&&f.setStart(h,f.startOffset-1),f.endContainer===h&&f.endOffset>0&&f.setEnd(h,f.endOffset-1),a.remove(c,!0)),g&&a.isEmpty(g)&&i.fillWithPaddingBr(d.fromDom(g)),b.setRng(f)},B=function(a,b,c,d,e){if(d)A(b,c,d,e);else if(!(d=y(a,c.getStart())))for(;d=b.get(r);)A(b,c,d,!1)},C=function(a,b,c){var e=a.dom,f=e.getParent(c,p.curry(l.isTextBlock,a));f&&e.isEmpty(f)?c.parentNode.replaceChild(b,c):(i.removeTrailingBr(d.fromDom(c)),e.isEmpty(c)?c.parentNode.replaceChild(b,c):e.insertAfter(b,c))},D=function(a,b){return a.appendChild(b),b},E=function(b,c){var d=a.foldr(b,function(a,b){return D(a,b.cloneNode(!1))},c);return D(d,d.ownerDocument.createTextNode(q))};return{setup:function(a){var b=a.dom,c=a.selection,d=a.getBody();a.on("mouseup keydown",function(a){!function(a,b,c,d){B(a,b,c,null,!1),8===d&&c.isCollapsed()&&c.getStart().innerHTML===q&&B(a,b,c,y(a,c.getStart())),37!==d&&39!==d||B(a,b,c,y(a,c.getStart()))}(d,b,c,a.keyCode)})},applyCaretFormat:function(a,b,c){var d,e,f,g,h,j,l=a.selection;g=(d=l.getRng(!0)).startOffset,j=d.startContainer.nodeValue,(e=y(a.getBody(),l.getStart()))&&(f=w(e));var m=/[^\s\u00a0\u00ad\u200b\ufeff]/;j&&g>0&&g<j.length&&m.test(j.charAt(g))&&m.test(j.charAt(g-1))?(h=l.getBookmark(),d.collapse(!0),d=k.expandRng(a,d,a.formatter.get(b)),d=n.split(d),a.formatter.apply(b,c,d),l.moveToBookmark(h)):(e&&f.nodeValue===q?a.formatter.apply(b,c,e):(e=function(a,b){return a.importNode(b,!0)}(a.getDoc(),x(!0).dom()),f=e.firstChild,d.insertNode(e),g=1,a.formatter.apply(b,c,e)),l.setCursorLocation(f,g))},removeCaretFormat:function(a,b,c,d){var e,f,g,h,i,j,l,o=a.dom,p=a.selection,q=p.getRng(!0),r=[];for(e=q.startContainer,f=q.startOffset,i=e,3===e.nodeType&&(f!==e.nodeValue.length&&(h=!0),i=i.parentNode);i;){if(m.matchNode(a,i,b,c,d)){j=i;break}i.nextSibling&&(h=!0),r.push(i),i=i.parentNode}if(j)if(h)g=p.getBookmark(),q.collapse(!0),q=k.expandRng(a,q,a.formatter.get(b),!0),q=n.split(q),a.formatter.remove(b,c,q),p.moveToBookmark(g);else{l=y(a.getBody(),j);var s=x(!1).dom(),t=E(r,s);l?C(a,s,l):C(a,s,j),A(o,p,l,!1),p.setCursorLocation(t,1),o.isEmpty(j)&&o.remove(j)}},isCaretNode:t,getParentCaretContainer:y,replaceWithCaretFormat:function(a,e){var f=x(!1),h=E(e,f.dom());return b.before(d.fromDom(a),f),c.remove(d.fromDom(a)),g(h,0)},isFormatElement:function(a,b){return a.schema.getTextInlineElements().hasOwnProperty(e.name(b))&&!t(b.dom())&&!h.isBogus(b.dom())}}}),g("5o",["2n"],function(a){return{evaluateUntil:function(b,c){for(var d=0;d<b.length;d++){var e=b[d].apply(null,c);if(e.isSome())return e}return a.none()}}}),g("43",["5n","1","2n","5c","42","5b","2f","44","5o"],function(a,b,c,d,e,f,g,h,i){var j=a.generate([{before:["element"]},{start:["element"]},{end:["element"]},{after:["element"]}]),k=function(a,b){var c=f.getParentBlock(b,a);return c||a},l=function(a,d,f){var g=h.normalizeForwards(f),i=k(d,g.container());return h.findRootInline(a,i,g).fold(function(){return e.nextPosition(i,g).bind(b.curry(h.findRootInline,a,i)).map(function(a){return j.before(a)})},c.none)},m=function(a,b){return null===g.getParentCaretContainer(a,b)},n=function(a,c,d){return h.findRootInline(a,c,d).filter(b.curry(m,c))},o=function(a,b,d){var f=h.normalizeBackwards(d);return n(a,b,f).bind(function(a){return e.prevPosition(a,f).isNone()?c.some(j.start(a)):c.none()})},p=function(a,b,d){var f=h.normalizeForwards(d);return n(a,b,f).bind(function(a){return e.nextPosition(a,f).isNone()?c.some(j.end(a)):c.none()})},q=function(a,d,f){var g=h.normalizeBackwards(f),i=k(d,g.container());return h.findRootInline(a,i,g).fold(function(){return e.prevPosition(i,g).bind(b.curry(h.findRootInline,a,i)).map(function(a){return j.after(a)})},c.none)},r=function(a){return!1===h.isRtl(t(a))},s=function(a,b,c){return i.evaluateUntil([l,o,p,q],[a,b,c]).filter(r)},t=function(a){return a.fold(b.identity,b.identity,b.identity,b.identity)},u=function(a){return a.fold(b.constant("before"),b.constant("start"),b.constant("end"),b.constant("after"))},v=function(a){return a.fold(j.before,j.before,j.after,j.after)},y=function(a,b,c,e,f,g){return d.liftN([h.findRootInline(b,c,e),h.findRootInline(b,c,f)],function(b,d){return b!==d&&h.hasSameParentBlock(c,b,d)?j.after(a?b:d):g}).getOr(g)},z=function(a,c){return a.fold(b.constant(!0),function(a){return!function(a,b){return u(a)===u(b)&&t(a)===t(b)}(a,c)})},A=function(a,c,d,f,g){var i=h.normalizePosition(a,g);return e.fromPosition(a,d,i).map(b.curry(h.normalizePosition,a)).fold(function(){return f.map(v)},function(e){return s(c,d,e).map(b.curry(y,a,c,d,i,e)).filter(b.curry(z,f))}).filter(r)},B=function(a,d){return a?d.fold(b.compose(c.some,j.start),c.none,b.compose(c.some,j.after),c.none):d.fold(c.none,b.compose(c.some,j.before),c.none,b.compose(c.some,j.end))},C=function(a,c,d,e){var f=h.normalizePosition(a,e),g=s(c,d,f);return s(c,d,f).bind(b.curry(B,a)).orThunk(function(){return A(a,c,d,g,e)})};return{readLocation:s,findLocation:C,prevLocation:b.curry(C,!1),nextLocation:b.curry(C,!0),getElement:t,outside:v,inside:function(a){return a.fold(j.start,j.start,j.end,j.end)}}}),g("2d",[],function(){var a=function(b){var c=b,d=function(){return c};return{get:d,set:function(a){c=a},clone:function(){return a(d())}}};return a}),g("6h",["28","46","32"],function(a,b,c){var d=function(b){return a.isFunction(b.selection.getSel().modify)},e=function(a,b,d){var e=a?1:-1;return b.setRng(c(d.container(),d.offset()+e).toRange()),b.getSel().modify("move",a?"forward":"backward","word"),!0};return{hasSelectionModifyApi:d,moveByWord:function(a,f){var g=f.selection.getRng(),h=a?c.fromRangeEnd(g):c.fromRangeStart(g);return!!d(f)&&(a&&b.isBeforeInline(h)?e(!0,f.selection,h):!(a||!b.isAfterInline(h))&&e(!1,f.selection,h))}}}),g("5p",["1i","2d","1","6g","32","5m","43","44","6h"],function(a,b,c,d,e,f,g,h,i){var j=function(a,b){var c=a.dom.createRng();c.setStart(b.container(),b.offset()),c.setEnd(b.container(),b.offset()),a.selection.setRng(c)},k=function(a){return!1!==a.settings.inline_boundaries},l=function(a,b){a?b.setAttribute("data-mce-selected","inline-boundary"):b.removeAttribute("data-mce-selected")},m=function(a,b,c){return f.renderCaret(b,c).map(function(b){return j(a,b),c})},n=function(a,b,d){var f=a.getBody(),i=e.fromRangeStart(a.selection.getRng()),j=c.curry(h.isInlineTarget,a);return g.findLocation(d,j,f,i).bind(function(c){return m(a,b,c)})},o=function(b,d,e){var f=a.filter(d.select('*[data-mce-selected="inline-boundary"]'),b),g=a.filter(e,b);a.each(a.difference(f,g),c.curry(l,!1)),a.each(a.difference(g,f),c.curry(l,!0))},p=function(a,b){if(a.selection.isCollapsed()&&!0!==a.composing&&b.get()){var c=e.fromRangeStart(a.selection.getRng());e.isTextPosition(c)&&!1===h.isAtZwsp(c)&&(j(a,d.removeAndReposition(b.get(),c)),b.set(null))}},q=function(b,c,d,f){if(c.selection.isCollapsed()){var h=a.filter(f,b);a.each(h,function(a){var f=e.fromRangeStart(c.selection.getRng());g.readLocation(b,c.getBody(),f).bind(function(a){return m(c,d,a)})})}},s=function(a,b,c){return function(){return!!k(b)&&i.moveByWord(a,b)}};return{move:function(a,b,c){return function(){return!!k(a)&&n(a,b,c).isSome()}},moveNextWord:c.curry(s,!0),movePrevWord:c.curry(s,!1),setupSelectedState:function(a){var d=new b(null),e=c.curry(h.isInlineTarget,a);return a.on("NodeChange",function(b){k(a)&&(o(e,a.dom,b.parents),p(a,d),q(e,a,d,b.parents))}),d},setCaretPosition:j}}),g("3z",["1","2n","5c","1v","1j","46","42","32","5b","5l","5m","43","5p","44"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var p=function(a,b){var c=e.createRange();return c.setStart(a.container(),a.offset()),c.setEnd(b.container(),b.offset()),c},q=function(a){return c.liftN([g.firstPositionIn(a),g.lastPositionIn(a)],function(b,c){var d=n.normalizePosition(!0,b),e=n.normalizePosition(!1,c);return g.nextPosition(a,d).map(function(a){return a.isEqual(e)}).getOr(!0)}).getOr(!0)},r=function(a,b){return function(c){return k.renderCaret(b,c).map(function(b){return m.setCaretPosition(a,b),!0}).getOr(!1)}},s=function(b,c,d,e){var f=b.getBody(),g=a.curry(n.isInlineTarget,b);b.undoManager.ignore(function(){b.selection.setRng(p(d,e)),b.execCommand("Delete"),l.readLocation(g,f,h.fromRangeStart(b.selection.getRng())).map(l.inside).map(r(b,c))}),b.nodeChanged()},t=function(a,b){var c=i.getParentBlock(b,a);return c||a},u=function(c,e,f,h){var i=t(c.getBody(),h.container()),k=a.curry(n.isInlineTarget,c),m=l.readLocation(k,i,h);return m.bind(function(c){return f?c.fold(a.constant(b.some(l.inside(c))),b.none,a.constant(b.some(l.outside(c))),b.none):c.fold(b.none,a.constant(b.some(l.outside(c))),b.none,a.constant(b.some(l.inside(c))))}).map(r(c,e)).getOrThunk(function(){var a=g.navigate(f,i,h),b=a.bind(function(a){return l.readLocation(k,i,a)});return m.isSome()&&b.isSome()?n.findRootInline(k,i,h).map(function(a){return!!q(a)&&(j.deleteElement(c,f,d.fromDom(a)),!0)}).getOr(!1):b.bind(function(b){return a.map(function(a){return f?s(c,e,h,a):s(c,e,a,h),!0})}).getOr(!1)})};return{backspaceDelete:function(a,b,c){if(a.selection.isCollapsed()&&function(a){return!1!==a.settings.inline_boundaries}(a)){var d=h.fromRangeStart(a.selection.getRng());return u(a,b,c,d)}return!1}}}),g("5q",["5n","1i","1","2n","5c","45","31","1v","5f","62"],function(a,b,c,d,e,f,g,h,i,j){var k=f.immutable("start","end"),l=f.immutable("rng","table","cells"),m=a.generate([{removeTable:["element"]},{emptyCells:["cells"]}]),n=function(a,b){return j.closest(h.fromDom(a),"td,th",b)},o=function(a,b){return j.ancestor(a,"table",b)},p=function(a){return!1===g.eq(a.start(),a.end())},s=function(a,b){return function(a,b){return o(a.start(),b).bind(function(c){return o(a.end(),b).bind(function(a){return g.eq(c,a)?d.some(c):d.none()})})}(a,b).bind(function(b){var c=i.descendants(b,"td,th");return l(a,b,c)})},t=function(a,b){var d=c.curry(g.eq,a);return function(a,b){return e.liftN([n(a.startContainer,b),n(a.endContainer,b)],k).filter(p)}(b,d).map(function(a){return s(a,d)})},u=function(a,c){return b.findIndex(a,function(a){return g.eq(a,c)})},w=function(a){return function(a){return e.liftN([u(a.cells(),a.rng().start()),u(a.cells(),a.rng().end())],function(b,c){return a.cells().slice(b,c+1)})}(a).bind(function(b){var c=a.cells();return b.length===c.length?m.removeTable(a.table()):m.emptyCells(b)})};return{getActionFromRange:function(a,b){return t(a,b).map(w)},getActionFromCells:function(a){return m.emptyCells(a)}}}),g("36",["1i","1v","2v"],function(a,b,c){var d=function(a){for(var b=[],c=0;c<a.rangeCount;c++)b.push(a.getRangeAt(c));return b};return{getRanges:d,getSelectedNodes:function(d){return a.bind(d,function(a){var d=c.getSelectedNode(a);return d?[b.fromDom(d)]:[]})},hasMultipleRanges:function(a){return d(a).length>1}}}),g("5t",["1i","1v","5f","3l","36"],function(a,b,c,d,e){var f=function(b){return a.filter(e.getSelectedNodes(b),d.isTableCell)},g=function(a){return c.descendants(a,"td[data-mce-selected],th[data-mce-selected]")},h=function(a,b){var c=g(b),d=f(a);return c.length>0?c:d};return{getCellsFromRanges:f,getCellsFromElement:g,getCellsFromElementOrRanges:h,getCellsFromEditor:function(a){return h(e.getRanges(a.selection.getSel()),b.fromDom(a.getBody()))}}}),g("40",["1i","1","2n","31","1v","3f","42","32","5l","5q","3l","5r","3t","5s","5t"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=function(b,c){return a.each(c,m.fillWithPaddingBr),b.selection.setCursorLocation(c[0].dom(),0),!0},q=function(a,b){return i.deleteElement(a,!1,b),!0},r=function(a,c,d){return j.getActionFromRange(c,d).map(function(c){return c.fold(b.curry(q,a),b.curry(p,a))})},t=function(a,b,c,d){return w(b,d).fold(function(){return r(a,b,c)},function(b){return function(a,b){return y(a,b)}(a,b)}).getOr(!1)},v=function(b,c){return a.find(n.parentsAndSelf(c,b),k.isTableCell)},w=function(b,c){return a.find(n.parentsAndSelf(c,b),function(a){return"caption"===f.name(a)})},x=function(a,b,c,f,h){return g.navigate(c,a.getBody(),h).bind(function(a){return v(b,e.fromDom(a.getNode())).map(function(a){return!1===d.eq(a,f)})})},y=function(a,b){return m.fillWithPaddingBr(b),a.selection.setCursorLocation(b.dom(),0),c.some(!0)},B=function(a,b,c){return w(a,e.fromDom(c.getNode())).map(function(a){return!1===d.eq(a,b)})},C=function(a,b,d,e,f){return g.navigate(d,a.getBody(),f).bind(function(c){return function(a,b,c,d){return g.firstPositionIn(a.dom()).bind(function(e){return g.lastPositionIn(a.dom()).map(function(a){return b?c.isEqual(e)&&d.isEqual(a):c.isEqual(a)&&d.isEqual(e)})}).getOr(!0)}(e,d,f,c)?function(a,b){return y(a,b)}(a,e):B(b,e,c)}).or(c.some(!0))},F=function(a,b,c){var d=e.fromDom(a.getBody());return w(d,c).fold(function(){return function(a,b,c,d){var e=h.fromRangeStart(a.selection.getRng());return v(c,d).bind(function(d){return l.isEmpty(d)?y(a,d):x(a,c,b,d,e)})}(a,b,d,c)},function(c){return function(a,b,c,d){var e=h.fromRangeStart(a.selection.getRng());return l.isEmpty(d)?y(a,d):C(a,c,b,d,e)}(a,b,d,c)}).getOr(!1)};return{backspaceDelete:function(a,b){var c=e.fromDom(a.selection.getStart(!0));return a.selection.isCollapsed()?F(a,b,c):function(a,b){var c=e.fromDom(a.getBody()),d=a.selection.getRng(),f=o.getCellsFromEditor(a);return 0!==f.length?p(a,f):t(a,c,d,b)}(a,c)}}}),g("1x",["3v","3w","3x","3y","3z","40"],function(a,b,c,d,e,f){var g=function(a,b){a.getDoc().execCommand(b,!1,null)};return{deleteCommand:function(h){c.backspaceDelete(h,!1)||e.backspaceDelete(h,!1)||a.backspaceDelete(h,!1)||f.backspaceDelete(h)||b.backspaceDelete(h,!1)||(g(h,"Delete"),d.paddEmptyBody(h))},forwardDeleteCommand:function(d){c.backspaceDelete(d,!0)||e.backspaceDelete(d,!0)||a.backspaceDelete(d,!0)||f.backspaceDelete(d)||b.backspaceDelete(d,!0)||g(d,"ForwardDelete")}}}),g("2u",[],function(){return{isEq:function(a,b){return a&&b&&a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}}}),g("2t",["2n","45","46","1y","s","2f","2u"],function(a,b,c,d,e,f,g){var h=b.immutable("container","offset"),j=function(a,b,c){return null!==function(a,b,c){for(;a&&a!==b;){if(c(a))return a;a=a.parentNode}return null}(a,b,c)},k=function(a,b,c){return j(a,b,function(a){return a.nodeName===c})},l=function(a){return a&&"TABLE"===a.nodeName},m=function(a){return a&&/^(TD|TH|CAPTION)$/.test(a.nodeName)},n=function(a,b){return c.isCaretContainer(a)&&!1===j(a,b,f.isCaretNode)},o=function(a,b,c){for(var f=new e(b,a.getParent(b.parentNode,a.isBlock)||a.getRoot());b=f[c?"prev":"next"]();)if(d.isBr(b))return!0},r=function(b,c,f,g,i){var j,l,m,o,p=b.getRoot(),q=b.schema.getNonEmptyElements();if(m=b.getParent(i.parentNode,b.isBlock)||p,g&&d.isBr(i)&&c&&b.isEmpty(m))return a.some(h(i.parentNode,b.nodeIndex(i)));for(j=new e(i,m);o=j[g?"prev":"next"]();){if("false"===b.getContentEditableParent(o)||n(o,p))return a.none();if(d.isText(o)&&o.nodeValue.length>0)return!1===k(o,p,"A")?a.some(h(o,g?o.nodeValue.length:0)):a.none();if(b.isBlock(o)||q[o.nodeName.toLowerCase()])return a.none();l=o}return f&&l?a.some(h(l,0)):a.none()},s=function(b,f,g,i){var j,k,n,s,t,u,v,w=b.getRoot(),x=!1;if(j=i[(g?"start":"end")+"Container"],k=i[(g?"start":"end")+"Offset"],v=d.isElement(j)&&k===j.childNodes.length,t=b.schema.getNonEmptyElements(),u=g,c.isCaretContainer(j))return a.none();if(d.isElement(j)&&k>j.childNodes.length-1&&(u=!1),d.isDocument(j)&&(j=w,k=0),j===w){if(u&&(s=j.childNodes[k>0?k-1:0])){if(c.isCaretContainer(s))return a.none();if(t[s.nodeName]||l(s))return a.none()}if(j.hasChildNodes()){if(k=Math.min(!u&&k>0?k-1:k,j.childNodes.length-1),j=j.childNodes[k],k=d.isText(j)&&v?j.data.length:0,!f&&j===w.lastChild&&l(j))return a.none();if(function(a,b){for(;b&&b!==a;){if(d.isContentEditableFalse(b))return!0;b=b.parentNode}return!1}(w,j)||c.isCaretContainer(j))return a.none();if(j.hasChildNodes()&&!1===l(j)){s=j,n=new e(j,w);do{if(d.isContentEditableFalse(s)||c.isCaretContainer(s)){x=!1;break}if(d.isText(s)&&s.nodeValue.length>0){k=u?0:s.nodeValue.length,j=s,x=!0;break}if(t[s.nodeName.toLowerCase()]&&!m(s)){k=b.nodeIndex(s),j=s.parentNode,"IMG"!==s.nodeName&&"PRE"!==s.nodeName||u||k++,x=!0;break}}while(s=u?n.next():n.prev())}}}return f&&(d.isText(j)&&0===k&&r(b,v,f,!0,j).each(function(a){j=a.container(),k=a.offset(),x=!0}),d.isElement(j)&&((s=j.childNodes[k])||(s=j.childNodes[k-1]),!s||!d.isBr(s)||function(a,b){return a.previousSibling&&a.previousSibling.nodeName===b}(s,"A")||o(b,s,!1)||o(b,s,!0)||r(b,v,f,!0,s).each(function(a){j=a.container(),k=a.offset(),x=!0}))),u&&!f&&d.isText(j)&&k===j.nodeValue.length&&r(b,v,f,!1,j).each(function(a){j=a.container(),k=a.offset(),x=!0}),x?a.some(h(j,k)):a.none()};return{normalize:function(b,c){var d=c.collapsed,e=c.cloneRange();return s(b,d,!0,e).each(function(a){e.setStart(a.container(),a.offset())}),d||s(b,d,!1,e).each(function(a){e.setEnd(a.container(),a.offset())}),d&&e.collapse(!0),g.isEq(c,e)?a.none():a.some(e)}}}),g("1z",["1","41","1v","42","32","1y","s","43","44","2t"],function(a,b,c,d,e,f,g,h,i,j){var k=function(a,b,c){for(var d,e=new g(b,c),f=a.getNonEmptyElements();d=e.next();)if(f[d.nodeName.toLowerCase()]||d.length>0)return!0},l=function(a,b,c){var d=a.create("span",{},"&nbsp;");c.parentNode.insertBefore(d,c),b.scrollIntoView(d),a.remove(d)},m=function(a,b,c,d){var e=a.createRng();d?(e.setStartBefore(c),e.setEndBefore(c)):(e.setStartAfter(c),e.setEndAfter(c)),b.setRng(e)},o=function(a,d){var e=c.fromTag("br");b.before(c.fromDom(d),e),a.undoManager.add()},p=function(a,d){r(a.getBody(),d)||b.after(c.fromDom(d),c.fromTag("br"));var e=c.fromTag("br");b.after(c.fromDom(d),e),l(a.dom,a.selection,e.dom()),m(a.dom,a.selection,e.dom(),!1),a.undoManager.add()},r=function(a,b){return!!function(a){return f.isBr(a.getNode())}(e.after(b))||d.nextPosition(a,e.after(b)).map(function(a){return f.isBr(a.getNode())}).getOr(!1)},s=function(a){return a&&"A"===a.nodeName&&"href"in a},t=function(b){return b.fold(a.constant(!1),s,s,a.constant(!1))},v=function(b,c){c.fold(a.noop,a.curry(o,b),a.curry(p,b),a.noop)};return{insert:function(b,c){var d=function(b){var c=a.curry(i.isInlineTarget,b),d=e.fromRangeStart(b.selection.getRng());return h.readLocation(c,b.getBody(),d).filter(t)}(b);d.isSome()?d.each(a.curry(v,b)):function(a,b){var c,d,e=a.selection,f=a.dom,g=e.getRng(!0);j.normalize(f,g).each(function(a){g.setStart(a.startContainer,a.startOffset),g.setEnd(a.endContainer,a.endOffset)});var h=g.startOffset,i=g.startContainer;if(1===i.nodeType&&i.hasChildNodes()){var n=h>i.childNodes.length-1;i=i.childNodes[Math.min(h,i.childNodes.length-1)]||i,h=n&&3===i.nodeType?i.nodeValue.length:0}var o=f.getParent(i,f.isBlock),p=o?f.getParent(o.parentNode,f.isBlock):null,q=p?p.nodeName.toUpperCase():"",r=b&&b.ctrlKey;"LI"!==q||r||(o=p),i&&3===i.nodeType&&h>=i.nodeValue.length&&(k(a.schema,i,o)||(c=f.create("br"),g.insertNode(c),g.setStartAfter(c),g.setEndAfter(c),d=!0)),c=f.create("br"),g.insertNode(c),l(f,e,c),m(f,e,c,d),a.undoManager.add()}(b,c)}}}),g("5u",["5n","1"],function(a,b){var c=a.generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]);return{before:c.before,on:c.on,after:c.after,cata:function(a,b,c,d){return a.fold(b,c,d)},getStart:function(a){return a.fold(b.identity,b.identity,b.identity)}}}),g("4f",["5n","45","1v","3h","5u"],function(a,b,c,d,e){var f=a.generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),g=b.immutable("start","soffset","finish","foffset");return{domRange:f.domRange,relative:f.relative,exact:f.exact,exactFromRange:function(a){return f.exact(a.start(),a.soffset(),a.finish(),a.foffset())},range:g,getWin:function(a){var b=function(a){return a.match({domRange:function(a){return c.fromDom(a.startContainer)},relative:function(a,b){return e.getStart(a)},exact:function(a,b,c,d){return a}})}(a);return d.defaultView(b)}}}),g("20",["1","2n","3d","31","1v","3f","4e","3h","4f","1j"],function(a,b,c,d,e,f,g,h,i,j){var k=c.detect().browser,l=function(a,b){var c=f.isText(b)?g.get(b).length:h.children(b).length+1;return a>c?c:a<0?0:a},m=function(a){return i.range(a.start(),l(a.soffset(),a.start()),a.finish(),l(a.foffset(),a.finish()))},n=function(a,b){return d.contains(a,b)||d.eq(a,b)},o=function(a){return function(b){return n(a,b.start())&&n(a,b.finish())}},p=function(a){return!0===a.inline||k.isIE()},q=function(a){return i.range(e.fromDom(a.startContainer),a.startOffset,e.fromDom(a.endContainer),a.endOffset)},r=function(a){var c=a.getSelection();return(c&&0!==c.rangeCount?b.from(c.getRangeAt(0)):b.none()).map(q)},s=function(a){var b=h.defaultView(a);return r(b.dom()).filter(o(a))},t=function(a,c){return b.from(c).filter(o(a)).map(m)},u=function(a){var c=j.createRange();return c.setStart(a.start().dom(),a.soffset()),c.setEnd(a.finish().dom(),a.foffset()),b.some(c)},x=function(c){return(c.bookmark?c.bookmark:b.none()).bind(a.curry(t,e.fromDom(c.getBody()))).bind(u)};return{store:function(a){var c=p(a)?s(e.fromDom(a.getBody())):b.none();a.bookmark=c.isSome()?c:a.bookmark},storeNative:function(a,c){var d=e.fromDom(a.getBody()),g=(p(a)?b.from(c):b.none()).map(q).filter(o(d));a.bookmark=g.isSome()?g:a.bookmark},readRange:r,restore:function(a){x(a).each(function(b){a.selection.setRng(b)})},getRng:x,getBookmark:s,validate:t}}),g("8",["b","1w","1x","1y","1z","20","1e"],function(a,b,c,d,e,f,g){var h=g.each,i=g.extend,j=g.map,k=g.inArray,l=g.explode,m=!0;return function(g){var o,p,q,r,s={state:{},exec:{},value:{}},t=g.settings;g.on("PreInit",function(){o=g.dom,p=g.selection,t=g.settings,q=g.formatter});var v=function(a){var b;if(!g.quirks.isHidden()&&!g.removed){if(a=a.toLowerCase(),b=s.state[a])return b(a);try{return g.getDoc().queryCommandState(a)}catch(a){}return!1}},x=function(a,b){b=b||"exec",h(a,function(a,c){h(c.toLowerCase().split(","),function(c){s[b][c]=a})})};i(this,{execCommand:function(a,b,c,d){var e,i,j=0;if(!g.removed){if(/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(a)||d&&d.skip_focus?f.restore(g):g.focus(),(d=g.fire("BeforeExecCommand",{command:a,ui:b,value:c})).isDefaultPrevented())return!1;if(i=a.toLowerCase(),e=s.exec[i])return e(i,b,c),g.fire("ExecCommand",{command:a,ui:b,value:c}),!0;if(h(g.plugins,function(d){if(d.execCommand&&d.execCommand(a,b,c))return g.fire("ExecCommand",{command:a,ui:b,value:c}),j=!0,!1}),j)return j;if(g.theme&&g.theme.execCommand&&g.theme.execCommand(a,b,c))return g.fire("ExecCommand",{command:a,ui:b,value:c}),!0;try{j=g.getDoc().execCommand(a,b,c)}catch(a){}return!!j&&(g.fire("ExecCommand",{command:a,ui:b,value:c}),!0)}},queryCommandState:v,queryCommandValue:function(a){var b;if(!g.quirks.isHidden()&&!g.removed){if(a=a.toLowerCase(),b=s.value[a])return b(a);try{return g.getDoc().queryCommandValue(a)}catch(a){}}},queryCommandSupported:function(a){if(a=a.toLowerCase(),s.exec[a])return!0;try{return g.getDoc().queryCommandSupported(a)}catch(a){}return!1},addCommands:x,addCommand:function(a,b,c){a=a.toLowerCase(),s.exec[a]=function(a,d,e,f){return b.call(c||g,d,e,f)}},addQueryStateHandler:function(a,b,c){a=a.toLowerCase(),s.state[a]=function(){return b.call(c||g)}},addQueryValueHandler:function(a,b,c){a=a.toLowerCase(),s.value[a]=function(){return b.call(c||g)}},hasCustomCommand:function(a){return a=a.toLowerCase(),!!s.exec[a]}});var D=function(a,b,c){return void 0===b&&(b=!1),void 0===c&&(c=null),g.getDoc().execCommand(a,b,c)},E=function(a){return q.match(a)},F=function(a,b){q.toggle(a,b?{value:b}:void 0),g.nodeChanged()},G=function(a){r=p.getBookmark(a)},H=function(){p.moveToBookmark(r)};x({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){g.undoManager.add()},"Cut,Copy,Paste":function(b){var c,d=g.getDoc();try{D(b)}catch(a){c=m}if("paste"!==b||d.queryCommandEnabled(b)||(c=!0),c||!d.queryCommandSupported(b)){var e=g.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.");a.mac&&(e=e.replace(/Ctrl\+/g,"⌘+")),g.notificationManager.open({text:e,type:"error"})}},unlink:function(){if(p.isCollapsed()){var a=g.dom.getParent(g.selection.getStart(),"a");a&&g.dom.remove(a,!0)}else q.remove("link")},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone":function(a){var b=a.substring(7);"full"==b&&(b="justify"),h("left,center,right,justify".split(","),function(a){b!=a&&q.remove("align"+a)}),"none"!=b&&F("align"+b)},"InsertUnorderedList,InsertOrderedList":function(a){var b,c;D(a),(b=o.getParent(p.getNode(),"ol,ul"))&&(c=b.parentNode,/^(H[1-6]|P|ADDRESS|PRE)$/.test(c.nodeName)&&(G(),o.split(c,b),H()))},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(a){F(a)},"ForeColor,HiliteColor,FontName":function(a,b,c){F(a,c)},FontSize:function(a,b,c){var d,e;c>=1&&c<=7&&(e=l(t.font_size_style_values),d=l(t.font_size_classes),c=d?d[c-1]||c:e[c-1]||c),F(a,c)},RemoveFormat:function(a){q.remove(a)},mceBlockQuote:function(){F("blockquote")},FormatBlock:function(a,b,c){return F(c||"p")},mceCleanup:function(){var a=p.getBookmark();g.setContent(g.getContent({cleanup:m}),{cleanup:m}),p.moveToBookmark(a)},mceRemoveNode:function(a,b,c){var d=c||p.getNode();d!=g.getBody()&&(G(),g.dom.remove(d,m),H())},mceSelectNodeDepth:function(a,b,c){var d=0;o.getParent(p.getNode(),function(a){if(1==a.nodeType&&d++==c)return p.select(a),!1},g.getBody())},mceSelectNode:function(a,b,c){p.select(c)},mceInsertContent:function(a,c,d){b.insertAtCaret(g,d)},mceInsertRawHTML:function(a,b,c){p.setContent("tiny_mce_marker"),g.setContent(g.getContent().replace(/tiny_mce_marker/g,function(){return c}))},mceToggleFormat:function(a,b,c){F(c)},mceSetContent:function(a,b,c){g.setContent(c)},"Indent,Outdent":function(a){var b,c,d;b=t.indentation,c=/[a-z%]+$/i.exec(b),b=parseInt(b,10),v("InsertUnorderedList")||v("InsertOrderedList")?D(a):(t.forced_root_block||o.getParent(p.getNode(),o.isBlock)||q.apply("div"),h(p.getSelectedBlocks(),function(e){if("false"!==o.getContentEditable(e)&&"LI"!==e.nodeName){var f=g.getParam("indent_use_margin",!1)?"margin":"padding";f="TABLE"===e.nodeName?"margin":f,f+="rtl"==o.getStyle(e,"direction",!0)?"Right":"Left","outdent"==a?(d=Math.max(0,parseInt(e.style[f]||0,10)-b),o.setStyle(e,f,d?d+c:"")):(d=parseInt(e.style[f]||0,10)+b+c,o.setStyle(e,f,d))}}))},mceRepaint:function(){},InsertHorizontalRule:function(){g.execCommand("mceInsertContent",!1,"<hr />")},mceToggleVisualAid:function(){g.hasVisual=!g.hasVisual,g.addVisual()},mceReplaceContent:function(a,b,c){g.execCommand("mceInsertContent",!1,c.replace(/\{\$selection\}/g,p.getContent({format:"text"})))},mceInsertLink:function(a,b,c){var d;"string"==typeof c&&(c={href:c}),d=o.getParent(p.getNode(),"a"),c.href=c.href.replace(" ","%20"),d&&c.href||q.remove("link"),c.href&&q.apply("link",c,d)},selectAll:function(){var a=o.getParent(p.getStart(),d.isContentEditableTrue);if(a){var b=o.createRng();b.selectNodeContents(a),p.setRng(b)}},delete:function(){c.deleteCommand(g)},forwardDelete:function(){c.forwardDeleteCommand(g)},mceNewDocument:function(){g.setContent("")},InsertLineBreak:function(a,b,c){return e.insert(g,c),!0}}),x({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(a){var b="align"+a.substring(7),c=p.isCollapsed()?[o.getParent(p.getNode(),o.isBlock)]:p.getSelectedBlocks(),d=j(c,function(a){return!!q.matchNode(a,b)});return-1!==k(d,m)},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(a){return E(a)},mceBlockQuote:function(){return E("blockquote")},Outdent:function(){var a;if(t.inline_styles){if((a=o.getParent(p.getStart(),o.isBlock))&&parseInt(a.style.paddingLeft,10)>0)return m;if((a=o.getParent(p.getEnd(),o.isBlock))&&parseInt(a.style.paddingLeft,10)>0)return m}return v("InsertUnorderedList")||v("InsertOrderedList")||!t.inline_styles&&!!o.getParent(p.getNode(),"BLOCKQUOTE")},"InsertUnorderedList,InsertOrderedList":function(a){var b=o.getParent(p.getNode(),"ul,ol");return b&&("insertunorderedlist"===a&&"UL"===b.tagName||"insertorderedlist"===a&&"OL"===b.tagName)}},"state"),x({"FontSize,FontName":function(a){var b,c=0;return(b=o.getParent(p.getNode(),"span"))&&(c="fontsize"==a?b.style.fontSize:b.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()),c}},"value"),x({Undo:function(){g.undoManager.undo()},Redo:function(){g.undoManager.redo()}})}}),g("16",["1e"],function(a){var b=a.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchmove touchend"," "),c=function(b){var c,d,e=this,f={},g=function(){return!1},h=function(){return!0};c=(b=b||{}).scope||e,d=b.toggleEvent||g;var j=function(b,c,h,i){var j,k,l;if(!1===c&&(c=g),c)for(c={func:c},i&&a.extend(c,i),k=b.toLowerCase().split(" "),l=k.length;l--;)b=k[l],(j=f[b])||(j=f[b]=[],d(b,!0)),h?j.unshift(c):j.push(c);return e},k=function(a,b){var c,g,h,i,j;if(a)for(i=a.toLowerCase().split(" "),c=i.length;c--;){if(a=i[c],g=f[a],!a){for(h in f)d(h,!1),delete f[h];return e}if(g){if(b)for(j=g.length;j--;)g[j].func===b&&(g=g.slice(0,j).concat(g.slice(j+1)),f[a]=g);else g.length=0;g.length||(d(a,!1),delete f[a])}}else{for(a in f)d(a,!1);f={}}return e};e.fire=function(a,d){var e,i,j,l;if(a=a.toLowerCase(),d=d||{},d.type=a,d.target||(d.target=c),d.preventDefault||(d.preventDefault=function(){d.isDefaultPrevented=h},d.stopPropagation=function(){d.isPropagationStopped=h},d.stopImmediatePropagation=function(){d.isImmediatePropagationStopped=h},d.isDefaultPrevented=g,d.isPropagationStopped=g,d.isImmediatePropagationStopped=g),b.beforeFire&&b.beforeFire(d),e=f[a])for(i=0,j=e.length;i<j;i++){if((l=e[i]).once&&k(a,l.func),d.isImmediatePropagationStopped())return d.stopPropagation(),d;if(!1===l.func.call(c,d))return d.preventDefault(),d}return d},e.on=j,e.off=k,e.once=function(a,b,c){return j(a,b,c,{once:!0})},e.has=function(a){return a=a.toLowerCase(),!(!f[a]||0===f[a].length)}};return c.isNative=function(a){return!!b[a.toLowerCase()]},c}),g("1c",["16"],function(a){var b=function(b){return b._eventDispatcher||(b._eventDispatcher=new a({scope:b,toggleEvent:function(c,d){a.isNative(c)&&b.toggleNativeEvent&&b.toggleNativeEvent(c,d)}})),b._eventDispatcher};return{fire:function(a,c,d){var e=this;if(e.removed&&"remove"!==a)return c;if(c=b(e).fire(a,c,d),!1!==d&&e.parent)for(var f=e.parent();f&&!c.isPropagationStopped();)f.fire(a,c,!1),f=f.parent();return c},on:function(a,c,d){return b(this).on(a,c,d)},off:function(a,c){return b(this).off(a,c)},once:function(a,c){return b(this).once(a,c)},hasEventListeners:function(a){return b(this).has(a)}}}),g("a",["1c","m","1e"],function(a,b,c){var d,e=b.DOM,f=function(a,b){return"selectionchange"==b?a.getDoc():!a.inline&&/^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(b)?a.getDoc().documentElement:a.settings.event_root?(a.eventRoot||(a.eventRoot=e.select(a.settings.event_root)[0]),a.eventRoot):a.getBody()},g=function(a,b){var c,g,h=function(a){return!a.hidden&&!a.readonly};if(a.delegates||(a.delegates={}),!a.delegates[b]&&!a.removed)if(c=f(a,b),a.settings.event_root){if(d||(d={},a.editorManager.on("removeEditor",function(){var b;if(!a.editorManager.activeEditor&&d){for(b in d)a.dom.unbind(f(a,b));d=null}})),d[b])return;g=function(c){for(var d=c.target,f=a.editorManager.get(),g=f.length;g--;){var i=f[g].getBody();(i===d||e.isChildOf(d,i))&&h(f[g])&&f[g].fire(b,c)}},d[b]=g,e.bind(c,b,g)}else g=function(c){h(a)&&a.fire(b,c)},e.bind(c,b,g),a.delegates[b]=g},h={bindPendingEventDelegates:function(){var a=this;c.each(a._pendingNativeEvents,function(b){g(a,b)})},toggleNativeEvent:function(a,b){var c=this;"focus"!=a&&"blur"!=a&&(b?c.initialized?g(c,a):c._pendingNativeEvents?c._pendingNativeEvents.push(a):c._pendingNativeEvents=[a]:c.initialized&&(c.dom.unbind(f(c,a),a,c.delegates[a]),delete c.delegates[a]))},unbindAllNativeEvents:function(){var a,b=this;if(b.delegates){for(a in b.delegates)b.dom.unbind(f(b,a),a,b.delegates[a]);delete b.delegates}b.inline||(b.getBody().onload=null,b.dom.unbind(b.getWin()),b.dom.unbind(b.getDoc())),b.dom.unbind(b.getBody()),b.dom.unbind(b.getContainer())}};return h=c.extend({},a,h)}),g("22",[],function(){var a=function(a,b,c){try{a.getDoc().execCommand(b,!1,c)}catch(a){}},c=function(c,d){c._clickBlocker&&(c._clickBlocker.unbind(),c._clickBlocker=null),d?(c._clickBlocker=function(a){var b,c;return b=a.getBody(),c=function(b){a.dom.getParents(b.target,"a").length>0&&b.preventDefault()},a.dom.bind(b,"click",c),{unbind:function(){a.dom.unbind(b,"click",c)}}}(c),c.selection.controlSelection.hideResizeRect(),c.readonly=!0,c.getBody().contentEditable=!1):(c.readonly=!1,c.getBody().contentEditable=!0,a(c,"StyleWithCSS",!1),a(c,"enableInlineTableEditing",!1),a(c,"enableObjectResizing",!1),c.focus(),c.nodeChanged())};return{setMode:function(a,b){var d=a.readonly?"readonly":"design";b!=d&&(a.initialized?c(a,"readonly"==b):a.on("init",function(){c(a,"readonly"==b)}),a.fire("SwitchMode",{mode:b}))}}}),g("c",["1e","b"],function(a,b){var c=a.each,d=a.explode,e={f9:120,f10:121,f11:122},f=a.makeMap("alt,ctrl,shift,meta,access");return function(g){var i={},j=[],k=function(a){var g,h,i={};c(d(a,"+"),function(a){a in f?i[a]=!0:/^[0-9]{2,}$/.test(a)?i.keyCode=parseInt(a,10):(i.charCode=a.charCodeAt(0),i.keyCode=e[a]||a.toUpperCase().charCodeAt(0))}),g=[i.keyCode];for(h in f)i[h]?g.push(h):i[h]=!1;return i.id=g.join(","),i.access&&(i.alt=!0,b.mac?i.ctrl=!0:i.shift=!0),i.meta&&(b.mac?i.meta=!0:(i.ctrl=!0,i.meta=!1)),i},l=function(b,c,e,f){var h;return h=a.map(d(b,">"),k),h[h.length-1]=a.extend(h[h.length-1],{func:e,scope:f||g}),a.extend(h[0],{desc:g.translate(c),subpatterns:h.slice(1)})},o=function(a,b){return!!b&&b.ctrl==a.ctrlKey&&b.meta==a.metaKey&&b.alt==a.altKey&&b.shift==a.shiftKey&&!!(a.keyCode==b.keyCode||a.charCode&&a.charCode==b.charCode)&&(a.preventDefault(),!0)},p=function(a){return a.func?a.func.call(a.scope):null};g.on("keyup keypress keydown",function(a){!function(a){return a.altKey||a.ctrlKey||a.metaKey}(a)&&!function(a){return"keydown"===a.type&&a.keyCode>=112&&a.keyCode<=123}(a)||a.isDefaultPrevented()||(c(i,function(b){if(o(a,b))return j=b.subpatterns.slice(0),"keydown"==a.type&&p(b),!0}),o(a,j[0])&&(1===j.length&&"keydown"==a.type&&p(j[0]),j.shift()))}),this.add=function(b,e,f,h){var j;return j=f,"string"==typeof f?f=function(){g.execCommand(j,!1,null)}:a.isArray(j)&&(f=function(){g.execCommand(j[0],j[1],j[2])}),c(d(a.trim(b.toLowerCase())),function(a){var b=l(a,e,f,h);i[b.id]=b}),!0},this.remove=function(a){var b=l(a);return!!i[b.id]&&(delete i[b.id],!0)}}}),g("x",["y","v","1e"],function(a,b,c){var d=c.each,f=function(a){return a.replace(/<!--|-->/g,"")},g=function(a,b,c){var d,e,f,g,h=1;for(g=a.getShortEndedElements(),(f=/<([!?\/])?([A-Za-z0-9\-_\:\.]+)((?:\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\/|\s+)>/g).lastIndex=d=c;e=f.exec(b);){if(d=f.lastIndex,"/"===e[1])h--;else if(!e[1]){if(e[2]in g)continue;h++}if(0===h)break}return d},h=function(h,i){var j=this;h=h||{},j.schema=i=i||new a,!1!==h.fix_self_closing&&(h.fix_self_closing=!0),d("comment cdata text start end pi doctype".split(" "),function(a){a&&(j[a]=h[a]||function(){})}),j.parse=function(a){var d,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,G,H,I,J,K,L,M=this,N=0,O=[],P=0,Q=b.decode,R=c.makeMap("src,href,data,background,formaction,poster"),S=/((java|vb)script|mhtml):/i,T=/^data:/i,U=function(a){var b,c;for(b=O.length;b--&&O[b].name!==a;);if(b>=0){for(c=O.length-1;c>=b;c--)(a=O[c]).valid&&M.end(a.name);O.length=b}},V=function(a,b,c,d,f){var g,i;if(b=b.toLowerCase(),c=b in s?b:Q(c||d||f||""),u&&!p&&!1===function(a){return 0===a.indexOf("data-")||0===a.indexOf("aria-")}(b)){if(!(g=z[b])&&A){for(i=A.length;i--&&!(g=A[i]).pattern.test(b););-1===i&&(g=null)}if(!g)return;if(g.validValues&&!(c in g.validValues))return}if(R[b]&&!h.allow_script_urls){var k=c.replace(/[\s\u0000-\u001F]+/g,"");try{k=decodeURIComponent(k)}catch(a){k=unescape(k)}if(S.test(k))return;if(!h.allow_html_data_urls&&T.test(k)&&!/^data:image\//i.test(k))return}p&&(b in R||0===b.indexOf("on"))||(l.map[b]=c,l.push({name:b,value:c}))};for(H=new RegExp("<(?:(?:!--([\\w\\W]*?)--\x3e)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)>)|(?:([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/|\\s+)>))","g"),I=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g,r=i.getShortEndedElements(),G=h.self_closing_elements||i.getSelfClosingElements(),s=i.getBoolAttrs(),u=h.validate,q=h.remove_internals,L=h.fix_self_closing,J=i.getSpecialElements(),E=a+">";d=H.exec(E);){if(N<d.index&&M.text(Q(a.substr(N,d.index-N))),j=d[6])":"===(j=j.toLowerCase()).charAt(0)&&(j=j.substr(1)),U(j);else if(j=d[7]){if(d.index+d[0].length>a.length){M.text(Q(a.substr(d.index))),N=d.index+d[0].length;continue}if(":"===(j=j.toLowerCase()).charAt(0)&&(j=j.substr(1)),t=j in r,L&&G[j]&&O.length>0&&O[O.length-1].name===j&&U(j),!u||(v=i.getElementRule(j))){if(w=!0,u&&(z=v.attributes,A=v.attributePatterns),(y=d[8])?((p=-1!==y.indexOf("data-mce-type"))&&q&&(w=!1),l=[],l.map={},y.replace(I,V)):(l=[],l.map={}),u&&!p){if(B=v.attributesRequired,C=v.attributesDefault,D=v.attributesForced,v.removeEmptyAttrs&&!l.length&&(w=!1),D)for(m=D.length;m--;)x=D[m],o=x.name,"{$uid}"===(K=x.value)&&(K="mce_"+P++),l.map[o]=K,l.push({name:o,value:K});if(C)for(m=C.length;m--;)x=C[m],(o=x.name)in l.map||("{$uid}"===(K=x.value)&&(K="mce_"+P++),l.map[o]=K,l.push({name:o,value:K}));if(B){for(m=B.length;m--&&!(B[m]in l.map););-1===m&&(w=!1)}if(x=l.map["data-mce-bogus"]){if("all"===x){N=g(i,a,H.lastIndex),H.lastIndex=N;continue}w=!1}}w&&M.start(j,l,t)}else w=!1;if(k=J[j]){k.lastIndex=N=d.index+d[0].length,(d=k.exec(a))?(w&&(n=a.substr(N,d.index-N)),N=d.index+d[0].length):(n=a.substr(N),N=a.length),w&&(n.length>0&&M.text(n,!0),M.end(j)),H.lastIndex=N;continue}t||(y&&y.indexOf("/")==y.length-1?w&&M.end(j):O.push({name:j,valid:w}))}else(j=d[1])?(">"===j.charAt(0)&&(j=" "+j),h.allow_conditional_comments||"[if"!==j.substr(0,3).toLowerCase()||(j=" "+j),M.comment(j)):(j=d[2])?M.cdata(f(j)):(j=d[3])?M.doctype(j):(j=d[4])&&M.pi(j,d[5]);N=d.index+d[0].length}for(N<a.length&&M.text(Q(a.substr(N))),m=O.length-1;m>=0;m--)(j=O[m]).valid&&M.end(j.name)}};return h.findEndTag=g,h}),g("23",["x","4b"],function(a,b){var d=function(b,d){var e,f,g,h,i,j=d,k=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g,l=b.schema;for(j=function(a,b){var c=new RegExp(["\\s?("+a.join("|")+')="[^"]+"'].join("|"),"gi");return b.replace(c,"")}(b.getTempAttrs(),j),i=l.getShortEndedElements();h=k.exec(j);)f=k.lastIndex,g=h[0].length,e=i[h[1]]?f:a.findEndTag(l,j,f),j=j.substring(0,f-g)+j.substring(e),k.lastIndex=f-g;return j};return{trimExternal:function(a,c){return b.trim(d(a,c))},trimInternal:d}}),g("5v",["5i"],function(a){return{any:function(b){return a.first(b).isSome()},ancestor:function(b,c,d){return a.ancestor(b,c,d).isSome()},closest:function(b,c,d){return a.closest(b,c,d).isSome()},sibling:function(b,c){return a.sibling(b,c).isSome()},child:function(b,c){return a.child(b,c).isSome()},descendant:function(b,c){return a.descendant(b,c).isSome()}}}),g("4i",["1","2n","31","1v","5v","3h","1j"],function(a,b,c,d,e,f,g){var h=function(a){a.dom().focus()},k=function(a){var c=void 0!==a?a.dom():g;return b.from(c.activeElement).map(d.fromDom)};return{hasFocus:function(a){var b=f.owner(a).dom();return a.dom()===b.activeElement},focus:h,blur:function(a){a.dom().blur()},active:k,search:function(a){return k(f.owner(a)).filter(function(b){return a.dom().contains(b.dom())})},focusInside:function(b){var d=f.owner(b);k(d).filter(function(d){return e.closest(d,a.curry(c.eq,b))}).fold(function(){h(b)},a.noop)}}}),g("24",["2n","31","4i","1v","b","42","3l","2v","20"],function(a,b,c,d,e,f,g,h,i){var k=function(b){return b.collapsed?a.from(h.getNode(b.startContainer,b.startOffset)).map(d.fromDom):a.none()},l=function(c,d){return k(d).bind(function(d){return g.isTableSection(d)?a.some(d):!1===b.contains(c,d)?a.some(c):a.none()})},m=function(a,b){l(d.fromDom(a.getBody()),b).bind(function(a){return f.firstPositionIn(a.dom())}).fold(function(){a.selection.normalize()},function(b){a.selection.setRng(b.toRange())})},n=function(a){if(a.setActive)try{a.setActive()}catch(b){a.focus()}else a.focus()},q=function(a){var b=a.getBody();return b&&function(a){return c.hasFocus(a)||c.search(a).isSome()}(d.fromDom(b))},r=function(a){return a.inline?q(a):function(a){return a.iframeElement&&c.hasFocus(d.fromDom(a.iframeElement))}(a)},t=function(a){a.editorManager.setActive(a)};return{focus:function(a,b){a.removed||(b?t(a):function(a){var b,c=a.selection,d=a.settings.content_editable,f=a.getBody(),g=c.getRng();a.quirks.refreshContentEditable(),b=function(a,b){return a.dom.getParent(b,function(b){return"true"===a.dom.getContentEditable(b)})}(a,c.getNode()),a.$.contains(f,b)?(n(b),m(a,g),t(a)):(void 0!==a.bookmark&&!1===r(a)&&i.getRng(a).each(function(b){a.selection.setRng(b),g=b}),d||(e.opera||n(f),a.getWin().focus()),(e.gecko||d)&&(n(f),m(a,g)),t(a))}(a))},hasFocus:r}}),g("2o",["1","2n","31","1v","3g","3h"],function(a,b,c,d,e,f){var g=function(a,b){return b.dom()[a]},h=function(a,b){return parseInt(e.get(b,a),10)},i=a.curry(g,"clientWidth"),j=a.curry(g,"clientHeight"),k=a.curry(h,"margin-top"),l=a.curry(h,"margin-left"),q=function(a){return b.from(a).map(d.fromDom)};return{isXYInContentArea:function(a,b,c){var e=d.fromDom(a.getBody()),g=a.inline?e:f.documentElement(e),h=function(a,b,c,d){var e=b.dom().getBoundingClientRect();return{x:c-(a?e.left+b.dom().clientLeft+l(b):0),y:d-(a?e.top+b.dom().clientTop+k(b):0)}}(a.inline,g,b,c);return function(a,b,c){var d=i(a),e=j(a);return b>=0&&c>=0&&b<=d&&c<=e}(g,h.x,h.y)},isEditorAttachedToDom:function(a){var b=a.inline?a.getBody():a.getContentAreaContainer();return q(b).map(function(a){return c.contains(f.owner(a),a)}).getOr(!1)}}}),g("2p",[],function(){return function(){var a=function(){throw new Error("Theme did not provide a NotificationManager implementation.")};return{open:a,close:a,reposition:a,getArgs:a}}}),g("g",["1i","2n","2o","2p","15"],function(a,b,c,d,e){return function(f){var g=[],h=function(){var a=f.theme;return a&&a.getNotificationManagerImpl?a.getNotificationManagerImpl():d()},k=function(){g.length>0&&h().reposition(g)},m=function(b){a.findIndex(g,function(a){return a===b}).each(function(a){g.splice(a,1)})},n=function(b){if(!f.removed&&c.isEditorAttachedToDom(f))return a.find(g,function(a){return function(a,b){return!(a.type!==b.type||a.text!==b.text||a.progressBar||a.timeout||b.progressBar||b.timeout)}(h().getArgs(a),b)}).getOrThunk(function(){f.editorManager.setActive(f);var a=h().open(b,function(){m(a),k()});return function(a){g.push(a)}(a),k(),a})};return function(b){b.on("SkinLoaded",function(){var a=b.settings.service_message;a&&n({text:a,type:"warning",timeout:0,icon:""})}),b.on("ResizeEditor ResizeWindow",function(){e.requestAnimationFrame(k)}),b.on("remove",function(){a.each(g,function(a){h().close(a)})})}(f),{open:n,close:function(){b.from(g[0]).each(function(a){h().close(a),m(a),k()})},getNotifications:function(){return g}}}}),g("2q",[],function(){return function(){var a=function(){throw new Error("Theme did not provide a WindowManager implementation.")};return{open:a,alert:a,confirm:a,close:a,getParams:a,setParams:a}}}),g("h",["1i","2n","20","2q"],function(a,b,c,d){return function(e){var f=[],g=function(){var a=e.theme;return a&&a.getWindowManagerImpl?a.getWindowManagerImpl():d()},h=function(a,b){return function(){return b?b.apply(a,arguments):void 0}},k=function(a){f.push(a),function(a){e.fire("OpenWindow",{win:a})}(a)},l=function(b){a.findIndex(f,function(a){return a===b}).each(function(a){f.splice(a,1),function(a){e.fire("CloseWindow",{win:a})}(b),0===f.length&&e.focus()})},m=function(){return b.from(f[f.length-1])};return e.on("remove",function(){a.each(f.slice(0),function(a){g().close(a)})}),{windows:f,open:function(a,b){e.editorManager.setActive(e),c.store(e);var d=g().open(a,b,l);return k(d),d},alert:function(a,b,c){var d=g().alert(a,h(c||this,b),l);k(d)},confirm:function(a,b,c){var d=g().confirm(a,h(c||this,b),l);k(d)},close:function(){m().each(function(a){g().close(a),l(a)})},getParams:function(){return m().map(g().getParams).getOr(null)},setParams:function(a){m().each(function(b){g().setParams(b,a)})},getWindows:function(){return f}}}}),g("29",["2","6"],function(a,b){var c=b.PluginManager,d=function(a,b){for(var d in c.urls){if(c.urls[d]+"/plugin"+b+".js"===a)return d}return null},f=function(a,b){a.notificationManager.open({type:"error",text:b})},g=function(a,b){a._skinLoaded?f(a,b):a.on("SkinLoaded",function(){f(a,b)})};return{pluginLoadError:function(a,b){g(a,function(a,b){var c=d(b,a.suffix);return c?"Failed to load plugin: "+c+" from url "+b:"Failed to load plugin url: "+b}(a,b))},uploadError:function(a,b){g(a,"Failed to upload image: "+b)},displayError:g,initError:function(b){var c=a.console;c&&!a.test&&(c.error?c.error.apply(c,arguments):c.log.apply(c,arguments))}}}),g("4k",["6"],function(a){return a.PluginManager}),g("4l",["6"],function(a){return a.ThemeManager}),g("39",["3c"],function(a){return function(){return new(a.getOrDie("XMLHttpRequest"))}}),g("6r",["39","2","3q","1d","1e"],function(a,b,c,d,e){return function(c,f){var g={},i=function(c,d,e,g){var i,j;(i=new a).open("POST",f.url),i.withCredentials=f.credentials,i.upload.onprogress=function(a){g(a.loaded/a.total*100)},i.onerror=function(){e("Image upload failed due to a XHR Transport error. Code: "+i.status)},i.onload=function(){var a;return i.status<200||i.status>=300?void e("HTTP Error: "+i.status):(a=JSON.parse(i.responseText))&&"string"==typeof a.location?void d(function(a,b){return a?a.replace(/\/$/,"")+"/"+b.replace(/^\//,""):b}(f.basePath,a.location)):void e("Invalid JSON: "+i.responseText)},(j=new b.FormData).append("file",c.blob(),c.filename()),i.send(j)},k=function(a,b){return{url:b,blobInfo:a,status:!0}},l=function(a,b){return{url:"",blobInfo:a,status:!1,error:b}},m=function(a,b){e.each(g[a],function(a){a(b)}),delete g[a]},q=function(a,b){return a=e.grep(a,function(a){return!c.isUploaded(a.blobUri())}),d.all(e.map(a,function(a){return c.isPending(a.blobUri())?function(a){var b=a.blobUri();return new d(function(a){g[b]=g[b]||[],g[b].push(a)})}(a):function(a,b,e){return c.markPending(a.blobUri()),new d(function(d){var f,g,h=function(){};try{var i=function(){f&&(f.close(),g=h)};b(a,function(b){i(),c.markUploaded(a.blobUri(),b),m(a.blobUri(),k(a,b)),d(k(a,b))},function(b){i(),c.removeFailed(a.blobUri()),m(a.blobUri(),l(a,b)),d(l(a,b))},g=function(a){a<0||a>100||(f||(f=e()),f.progressBar.value(a))})}catch(b){d(l(a,b.message))}})}(a,f.handler,b)}))};return f=e.extend({credentials:!1,handler:i},f),{upload:function(a,b){return f.url||f.handler!==i?q(a,b):new d(function(a){a([])})}}}}),g("7d",["3c"],function(a){return function(b,c){return new(a.getOrDie("Blob"))(b,c)}}),g("7e",["3c"],function(a){return function(){return new(a.getOrDie("FileReader"))}}),g("7f",["3c"],function(a){return function(b){return new(a.getOrDie("Uint8Array"))(b)}}),g("7g",["3c"],function(a){return{atob:function(b){return a.getOrDie("atob")(b)},requestAnimationFrame:function(b){a.getOrDie("requestAnimationFrame")(b)}}}),g("75",["7d","7e","7f","7g","39","1d"],function(a,b,c,d,e,f){var h=function(a){var b,c;return a=decodeURIComponent(a).split(","),(c=/data:([^;]+)/.exec(a[0]))&&(b=c[1]),{type:b,data:a[1]}},i=function(b){return new f(function(e){var f,g,i;b=h(b);try{f=d.atob(b.data)}catch(b){return void e(new a([]))}for(g=new c(f.length),i=0;i<g.length;i++)g[i]=f.charCodeAt(i);e(new a([g],{type:b.type}))})};return{uriToBlob:function(a){return 0===a.indexOf("blob:")?function(a){return new f(function(b,c){var d=function(){c("Cannot convert "+a+" to Blob. Resource might not exist or is inaccessible.")};try{var f=new e;f.open("GET",a,!0),f.responseType="blob",f.onload=function(){200==this.status?b(this.response):d()},f.onerror=d,f.send()}catch(a){d()}})}(a):0===a.indexOf("data:")?i(a):null},blobToDataUri:function(a){return new f(function(c){var d=new b;d.onloadend=function(){c(d.result)},d.readAsDataURL(a)})},parseDataUri:h}}),g("6s",["1d","1r","3q","75","b"],function(a,b,c,d,e){var f=0,g=function(a){return(a||"blobid")+f++},h=function(a,b,c,e){var f,h;return 0===b.src.indexOf("blob:")?void((h=a.getByUri(b.src))?c({image:b,blobInfo:h}):d.uriToBlob(b.src).then(function(e){d.blobToDataUri(e).then(function(i){f=d.parseDataUri(i).data,h=a.create(g(),e,f),a.add(h),c({image:b,blobInfo:h})})},function(a){e(a)})):(f=d.parseDataUri(b.src).data,void((h=a.findFirst(function(a){return a.base64()===f}))?c({image:b,blobInfo:h}):d.uriToBlob(b.src).then(function(d){h=a.create(g(),d,f),a.add(h),c({image:b,blobInfo:h})},function(a){e(a)})))};return function(d,f){var g={};return{findAll:function(j,k){var l,m;return k||(k=c.constant(!0)),l=b.filter(j?j.getElementsByTagName("img"):[],function(a){var b=a.src;return!!e.fileApi&&!a.hasAttribute("data-mce-bogus")&&!a.hasAttribute("data-mce-placeholder")&&!(!b||b==e.transparentSrc)&&(0===b.indexOf("blob:")?!d.isUploaded(b):0===b.indexOf("data:")&&k(a))}),m=b.map(l,function(b){var c;return g[b.src]?new a(function(a){g[b.src].then(function(c){return"string"==typeof c?c:void a({image:b,blobInfo:c.blobInfo})})}):(c=new a(function(a,c){h(f,b,a,c)}).then(function(a){return delete g[a.image.src],a}).catch(function(a){return delete g[b.src],a}),g[b.src]=c,c)}),a.all(m)}}}}),g("27",[],function(){var a=0;return{uuid:function(c){return c+a+++function(){var a=function(){return Math.round(4294967295*Math.random()).toString(36)};return"s"+(new Date).getTime().toString(36)+a()+a()+a()}()}}}),g("6t",["1k","1r","3q","27"],function(a,b,c,d){return function(){var e=[],f=c.constant,i=function(b){var c,e;if(!b.blob||!b.base64)throw"blob and base64 representations of the image are required for BlobInfo to be created";return c=b.id||d.uuid("blobid"),e=b.name||c,{id:f(c),name:f(e),filename:f(e+"."+function(a){return{"image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/png":"png"}[a.toLowerCase()]||"dat"}(b.blob.type)),blob:f(b.blob),base64:f(b.base64),blobUri:f(b.blobUri||a.createObjectURL(b.blob)),uri:f(b.uri)}},k=function(a){return l(function(b){return b.id()===a})},l=function(a){return b.filter(e,a)[0]};return{create:function(a,b,c,d){return i("object"==typeof a?a:{id:a,name:d,blob:b,base64:c})},add:function(a){k(a.id())||e.push(a)},get:k,getByUri:function(a){return l(function(b){return b.blobUri()==a})},findFirst:l,removeByUri:function(c){e=b.filter(e,function(b){return b.blobUri()!==c||(a.revokeObjectURL(b.blobUri()),!1)})},destroy:function(){b.each(e,function(b){a.revokeObjectURL(b.blobUri())}),e=[]}}}}),g("6u",[],function(){return function(){var c={},d=function(a,b){return{status:a,resultUri:b}},e=function(a){return a in c};return{hasBlobUri:e,getResultUri:function(a){var b=c[a];return b?b.resultUri:null},isPending:function(b){return!!e(b)&&1===c[b].status},isUploaded:function(a){return!!e(a)&&2===c[a].status},markPending:function(b){c[b]=d(1,null)},markUploaded:function(a,e){c[a]=d(2,e)},removeFailed:function(a){delete c[a]},destroy:function(){c={}}}}}),g("6i",["1r","6r","6s","6t","6u","29"],function(a,b,c,d,e,f){return function(g){var h,i,j=new d,k=g.settings,l=new e,m=function(a){return function(b){return g.selection?a(b):[]}},o=function(a,b,c){var d=0;do{-1!==(d=a.indexOf(b,d))&&(a=a.substring(0,d)+c+a.substr(d+b.length),d+=c.length-b.length+1)}while(-1!==d);return a},p=function(a,b,c){return a=o(a,'src="'+b+'"','src="'+c+'"'),a=o(a,'data-mce-src="'+b+'"','data-mce-src="'+c+'"')},q=function(b,c){a.each(g.undoManager.data,function(d){"fragmented"===d.type?d.fragments=a.map(d.fragments,function(a){return p(a,b,c)}):d.content=p(d.content,b,c)})},r=function(){return g.notificationManager.open({text:g.translate("Image uploading..."),type:"info",timeout:-1,progressBar:!0})},s=function(a,b){j.removeByUri(a.src),q(a.src,b),g.$(a).attr({src:k.images_reuse_filename?b+"?"+(new Date).getTime():b,"data-mce-src":g.convertURL(b,"src")})},t=function(c){return h||(h=new b(l,{url:k.images_upload_url,basePath:k.images_upload_base_path,credentials:k.images_upload_credentials,handler:k.images_upload_handler})),w().then(m(function(b){var d;return d=a.map(b,function(a){return a.blobInfo}),h.upload(d,r).then(m(function(d){var e=a.map(d,function(a,c){var d=b[c].image;return a.status&&!1!==g.settings.images_replace_blob_uris?s(d,a.url):a.error&&f.uploadError(g,a.error),{element:d,status:a.status}});return c&&c(e),e}))}))},u=function(a){if(!1!==k.automatic_uploads)return t(a)},v=function(a){return!k.images_dataimg_filter||k.images_dataimg_filter(a)},w=function(){return i||(i=new c(l,j)),i.findAll(g.getBody(),v).then(m(function(b){return b=a.filter(b,function(a){return"string"!=typeof a||(f.displayError(g,a),!1)}),a.each(b,function(a){q(a.image.src,a.blobInfo.blobUri()),a.image.src=a.blobInfo.blobUri(),a.image.removeAttribute("data-mce-src")}),b}))},y=function(b){return b.replace(/src="(blob:[^"]+)"/g,function(b,c){var d=l.getResultUri(c);if(d)return'src="'+d+'"';var e=j.getByUri(c);return e||(e=a.reduce(g.editorManager.get(),function(a,b){return a||b.editorUpload&&b.editorUpload.blobCache.getByUri(c)},null)),e?'src="data:'+e.blob().type+";base64,"+e.base64()+'"':b})};return g.on("setContent",function(){!1!==g.settings.automatic_uploads?u():w()}),g.on("RawSaveContent",function(a){a.content=y(a.content)}),g.on("getContent",function(a){a.source_view||"raw"==a.format||(a.content=y(a.content))}),g.on("PostRender",function(){g.parser.addNodeFilter("img",function(b){a.each(b,function(a){var b=a.attr("src");if(!j.getByUri(b)){var c=l.getResultUri(b);c&&a.attr("src",c)}})})}),{blobCache:j,uploadImages:t,uploadImagesAuto:u,scanForImages:w,destroy:function(){j.destroy(),l.destroy(),i=h=null}}}}),g("6j",["1i","1","1v","2r","1y","5s","24"],function(a,b,c,d,e,f,g){var h=function(a,b){return a.hasOwnProperty(b.nodeName)},i=function(a,b){return!!e.isText(b)||!!e.isElement(b)&&!h(a,b)&&!d.isBookmarkNode(b)},j=function(b,d,e){return a.exists(f.parents(c.fromDom(e),c.fromDom(d)),function(a){return h(b,a.dom())})},k=function(a){var b,c,d,f,h,k,l,m,n,o,p,q=a.settings,r=a.dom,s=a.selection,t=a.schema,u=t.getBlockElements(),v=s.getStart(),w=a.getBody();if(p=q.forced_root_block,v&&e.isElement(v)&&p&&(o=w.nodeName.toLowerCase(),t.isValidChild(o,p.toLowerCase())&&!j(u,w,v))){for(c=(b=s.getRng()).startContainer,d=b.startOffset,f=b.endContainer,h=b.endOffset,n=g.hasFocus(a),v=w.firstChild;v;)if(i(u,v)){if(e.isText(v)&&0===v.nodeValue.length){l=v,v=v.nextSibling,r.remove(l);continue}k||(k=r.create(p,a.settings.forced_root_block_attrs),v.parentNode.insertBefore(k,v),m=!0),l=v,v=v.nextSibling,k.appendChild(l)}else k=null,v=v.nextSibling;m&&n&&(b.setStart(c,d),b.setEnd(f,h),s.setRng(b),a.nodeChanged())}};return{setup:function(a){a.settings.forced_root_block&&a.on("NodeChange",b.curry(k,a))}}}),g("6k",["b","2u","15"],function(a,b,c){return function(d){var e,f=[];"onselectionchange"in d.getDoc()||d.on("NodeChange Click MouseUp KeyUp Focus",function(a){var c,f;f={startContainer:(c=d.selection.getRng()).startContainer,startOffset:c.startOffset,endContainer:c.endContainer,endOffset:c.endOffset},"nodechange"!=a.type&&b.isEq(f,e)||d.fire("SelectionChange"),e=f}),d.on("contextmenu",function(){d.fire("SelectionChange")}),d.on("SelectionChange",function(){var b=d.selection.getStart(!0);!b||!a.range&&d.selection.isCollapsed()||!function(a){var b,c;if((c=d.$(a).parentsUntil(d.getBody()).add(a)).length===f.length){for(b=c.length;b>=0&&c[b]===f[b];b--);if(-1===b)return f=c,!0}return f=c,!1}(b)&&d.dom.isChildOf(b,d.getBody())&&d.nodeChanged({selectionChange:!0})}),d.on("MouseUp",function(a){a.isDefaultPrevented()||("IMG"==d.selection.getNode().nodeName?c.setEditorTimeout(d,function(){d.nodeChanged()}):d.nodeChanged())}),this.nodeChanged=function(a){var b,c,e,f=d.selection;d.initialized&&f&&!d.settings.disable_nodechange&&!d.readonly&&(e=d.getBody(),(b=f.getStart(!0)||e).ownerDocument==d.getDoc()&&d.dom.isChildOf(b,e)||(b=e),c=[],d.dom.getParent(b,function(a){return a===e||void c.push(a)}),a=a||{},a.element=b,a.parents=c,d.fire("NodeChange",a))}}}),g("76",[],function(){var a=function(a){var b,c,d,e;return e=a.getBoundingClientRect(),b=a.ownerDocument,c=b.documentElement,d=b.defaultView,{top:e.top+d.pageYOffset-c.clientTop,left:e.left+d.pageXOffset-c.clientLeft}},b=function(b){return b.inline?a(b.getBody()):{left:0,top:0}},e=function(b,c){if(c.target.ownerDocument!==b.getDoc()){var e=a(b.getContentAreaContainer()),f=function(a){var b=a.getBody(),c=a.getDoc().documentElement,d={left:b.scrollLeft,top:b.scrollTop},e={left:b.scrollLeft||c.scrollLeft,top:b.scrollTop||c.scrollTop};return a.inline?d:e}(b);return{left:c.pageX-e.left+f.left,top:c.pageY-e.top+f.top}}return{left:c.pageX,top:c.pageY}};return{calc:function(a,d){return function(a,b,c){return{pageX:c.left-a.left+b.left,pageY:c.top-a.top+b.top}}(b(a),function(a){var b=a.getBody();return a.inline?{left:b.scrollLeft,top:b.scrollTop}:{left:0,top:0}}(a),e(a,d))}}}),g("6v",["1j","m","76","1y","1r","15","3q"],function(a,b,c,d,e,f,g){var h=d.isContentEditableFalse,i=d.isContentEditableTrue,p=function(a){a&&a.parentNode&&a.parentNode.removeChild(a)},t=function(a,b){return function(c){if(function(a){return 0===a.button}(c)){var d=e.find(b.dom.getParents(c.target),g.or(h,i));if(function(a,b){return h(b)&&b!==a}(b.getBody(),d)){var f=b.dom.getPos(d),k=b.getBody(),l=b.getDoc().documentElement;a.element=d,a.screenX=c.screenX,a.screenY=c.screenY,a.maxX=(b.inline?k.scrollWidth:l.offsetWidth)-2,a.maxY=(b.inline?k.scrollHeight:l.offsetHeight)-2,a.relX=c.pageX-f.x,a.relY=c.pageY-f.y,a.width=d.offsetWidth,a.height=d.offsetHeight,a.ghost=function(a,b,c,d){var e=b.cloneNode(!0);a.dom.setStyles(e,{width:c,height:d}),a.dom.setAttrib(e,"data-mce-selected",null);var f=a.dom.create("div",{class:"mce-drag-container","data-mce-bogus":"all",unselectable:"on",contenteditable:"false"});return a.dom.setStyles(f,{position:"absolute",opacity:.5,overflow:"hidden",border:0,padding:0,margin:0,width:c,height:d}),a.dom.setStyles(e,{margin:0,boxSizing:"border-box"}),f.appendChild(e),f}(b,d,a.width,a.height)}}}},u=function(a,b){var d=f.throttle(function(a,c){b._selectionOverrides.hideFakeCaret(),b.selection.placeCaretAt(a,c)},0);return function(e){var f=Math.max(Math.abs(e.screenX-a.screenX),Math.abs(e.screenY-a.screenY));if(function(a){return a.element}(a)&&!a.dragging&&f>10){if(b.fire("dragstart",{target:a.element}).isDefaultPrevented())return;a.dragging=!0,b.focus()}if(a.dragging){var h=function(a,b){return{pageX:b.pageX-a.relX,pageY:b.pageY+5}}(a,c.calc(b,e));(function(a,b){a.parentNode!==b&&b.appendChild(a)})(a.ghost,b.getBody()),function(a,b,c,d,e,f){var g=0,h=0;a.style.left=b.pageX+"px",a.style.top=b.pageY+"px",b.pageX+c>e&&(g=b.pageX+c-e),b.pageY+d>f&&(h=b.pageY+d-f),a.style.width=c-g+"px",a.style.height=d-h+"px"}(a.ghost,h,a.width,a.height,a.maxX,a.maxY),d(e.clientX,e.clientY)}}},w=function(a,b){return function(c){if(a.dragging&&function(a,b,c){return b!==c&&!a.dom.isChildOf(b,c)&&!h(b)}(b,function(a){var c=a.getSel().getRangeAt(0).startContainer;return 3===c.nodeType?c.parentNode:c}(b.selection),a.element)){var d=function(a){var b=a.cloneNode(!0);return b.removeAttribute("data-mce-selected"),b}(a.element),e=b.fire("drop",{targetClone:d,clientX:c.clientX,clientY:c.clientY});e.isDefaultPrevented()||(d=e.targetClone,b.undoManager.transact(function(){p(a.element),b.insertContent(b.dom.getOuterHTML(d)),b._selectionOverrides.hideFakeCaret()}))}y(a)}},y=function(a){a.dragging=!1,a.element=null,p(a.ghost)},z=function(c){var d,e,f,g,h,i,j={};d=b.DOM,i=a,e=t(j,c),f=u(j,c),g=w(j,c),h=function(a,b){return function(){y(a),a.dragging&&b.fire("dragend")}}(j,c),c.on("mousedown",e),c.on("mousemove",f),c.on("mouseup",g),d.bind(i,"mousemove",f),d.bind(i,"mouseup",h),c.on("remove",function(){d.unbind(i,"mousemove",f),d.unbind(i,"mouseup",h)})};return{init:function(a){z(a),function(a){a.on("drop",function(b){var c=void 0!==b.clientX?a.getDoc().elementFromPoint(b.clientX,b.clientY):null;(h(c)||h(a.dom.getContentEditableParent(c)))&&b.preventDefault()})}(a)}}}),g("6w",["1n","46","6g","n","1y","3o","15"],function(a,b,c,d,e,f,g){var h=e.isContentEditableFalse;return function(e,j){var k,l,m=null,n=function(a,b){var c,d,g,h,i,j=f.collapse(a.getBoundingClientRect(),b);return"BODY"==e.tagName?(c=e.ownerDocument.documentElement,d=e.scrollLeft||c.scrollLeft,g=e.scrollTop||c.scrollTop):(i=e.getBoundingClientRect(),d=e.scrollLeft-i.left,g=e.scrollTop-i.top),j.left+=d,j.right+=d,j.top+=g,j.bottom+=g,j.width=1,(h=a.offsetWidth-a.clientWidth)>0&&(b&&(h*=-1),j.left+=h,j.right+=h),j},q=function(){(function(){var a,c,f,g,h;for(a=d("*[contentEditable=false]",e),g=0;g<a.length;g++)c=a[g],f=c.previousSibling,b.endsWithCaretContainer(f)&&(1==(h=f.data).length?f.parentNode.removeChild(f):f.deleteData(h.length-1,1)),f=c.nextSibling,b.startsWithCaretContainer(f)&&(1==(h=f.data).length?f.parentNode.removeChild(f):f.deleteData(0,1))})(),l&&(c.remove(l),l=null),m&&(m.remove(),m=null),a(k)},s=function(){k=g.setInterval(function(){e.ownerDocument.activeElement===e?d("div.mce-visual-caret",e).toggleClass("mce-visual-caret-hidden"):d("div.mce-visual-caret",e).addClass("mce-visual-caret-hidden")},500)};return{show:function(a,c){var f,g;return q(),c&&/^(TD|TH)$/i.test(c.nodeName)?null:j(c)?(l=b.insertBlock("p",c,a),f=n(c,a),d(l).css("top",f.top),m=d('<div class="mce-visual-caret" data-mce-bogus="all"></div>').css(f).appendTo(e),a&&m.addClass("mce-visual-caret-before"),s(),(g=c.ownerDocument.createRange()).setStart(l,0),g.setEnd(l,0),g):(l=b.insertInline(c,a),g=c.ownerDocument.createRange(),h(l.nextSibling)?(g.setStart(l,0),g.setEnd(l,0)):(g.setStart(l,1),g.setEnd(l,1)),g)},hide:q,getCss:function(){return".mce-visual-caret {position: absolute;background-color: black;background-color: currentcolor;}.mce-visual-caret-hidden {display: none;}*[data-mce-caret] {position: absolute;left: -1000px;right: auto;top: 0;margin: 0;padding: 0;}"},destroy:function(){g.clearInterval(k)}}}}),g("77",["1r","1y","3o"],function(a,b,c){var d=function(e){var f=function(b){return a.map(b,function(a){return a=c.clone(a),a.node=e,a})};if(a.isArray(e))return a.reduce(e,function(a,b){return a.concat(d(b))},[]);if(b.isElement(e))return f(e.getClientRects());if(b.isText(e)){var g=e.ownerDocument.createRange();return g.setStart(e,0),g.setEnd(e,e.data.length),f(g.getClientRects())}};return{getClientRects:d}}),g("6x",["3q","1r","1y","77","3o","5b","3n"],function(a,b,c,d,e,f,g){var h=c.isContentEditableFalse,i=f.findNode,j=a.curry,k=function(a,b){return Math.abs(a.left-b)},l=function(a,b){return Math.abs(a.right-b)},m=function(a,c){var d=function(a,b){return a>=b.left&&a<=b.right};return b.reduce(a,function(a,b){var e,f;return e=Math.min(k(a,c),l(a,c)),f=Math.min(k(b,c),l(b,c)),d(c,b)?b:d(c,a)?a:f==e&&h(b.node)?b:f<e?b:a})},n=function(a,b,c,d){for(;d=i(d,a,g.isEditableCaretCandidate,b);)if(c(d))return},o=function(a,c){var f=[],g=function(a,e){var g;return g=b.filter(d.getClientRects(e),function(b){return!a(b,c)}),f=f.concat(g),0===g.length};return f.push(c),n(-1,a,j(g,e.isAbove),c.node),n(1,a,j(g,e.isBelow),c.node),f};return{findClosestClientRect:m,findLineNodeRects:o,closestCaret:function(a,c,e){var f,g;return f=d.getClientRects(function(a){return b.filter(b.toArray(a.getElementsByTagName("*")),h)}(a)),f=b.filter(f,function(a){return e>=a.top&&e<=a.bottom}),(g=m(f,c))&&(g=m(o(a,g),c))&&h(g.node)?function(a,b){return{node:a.node,before:k(a,b)<l(a,b)}}(g,c):null}}}),g("30",["1i","3o"],function(a,b){return{isXYWithinRange:function(c,d,e){return!e.collapsed&&a.foldl(e.getClientRects(),function(a,e){return a||b.containsXY(e,c,d)},!1)}}}),g("5y",["1o","1q"],function(a,b){return{adaptable:function(c,d){var e=null,f=null;return{cancel:function(){null!==e&&(a(e),e=null,f=null)},throttle:function(){f=arguments,null===e&&(e=b(function(){c.apply(null,f),e=null,f=null},d))}}},first:function(c,d){var e=null;return{cancel:function(){null!==e&&(a(e),e=null)},throttle:function(){var a=arguments;null===e&&(e=b(function(){c.apply(null,a),e=null,a=null},d))}}},last:function(c,d){var e=null;return{cancel:function(){null!==e&&(a(e),e=null)},throttle:function(){var f=arguments;null!==e&&a(e),e=b(function(){c.apply(null,f),e=null,f=null},d)}}}}}),g("6z",["32","5b","1y","3q"],function(a,b,c,d){var e=c.isContentEditableTrue,f=c.isContentEditableFalse,g=function(a,b,c,d){return b._selectionOverrides.showCaret(a,c,d)},j=function(c,h){var i,j;return h=b.normalizeRange(1,c.getBody(),h),i=a.fromRangeStart(h),f(i.getNode())?g(1,c,i.getNode(),!i.isAtEnd()):f(i.getNode(!0))?g(1,c,i.getNode(!0),!1):(j=c.dom.getParent(i.getNode(),d.or(f,e)),f(j)?g(1,c,j,!1):null)};return{showCaret:g,selectNode:function(a,b){return a.fire("BeforeObjectSelected",{target:b}).isDefaultPrevented()?null:function(a){var b=a.ownerDocument.createRange();return b.selectNode(a),b}(b)},renderCaretAtRange:j,renderRangeCaret:function(a,b){return b&&b.collapsed?j(a,b)||b:b}}}),g("6y",["5y","6z"],function(a,b){return{setup:function(c){var d=a.first(function(){if(!c.removed){var a=b.renderRangeCaret(c,c.selection.getRng());c.selection.setRng(a)}},0);c.on("focus",function(){d.throttle()}),c.on("blur",function(){d.cancel()})}}}),g("1g",["b"],function(a){return{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,modifierPressed:function(a){return a.shiftKey||a.ctrlKey||a.altKey||this.metaKeyPressed(a)},metaKeyPressed:function(b){return a.mac?b.metaKey:b.ctrlKey&&!b.altKey}}}),g("6l",["1i","47","1v","48","5f","62","6v","2o","b","46","32","5b","3r","6w","6x","1y","30","6y","6z","1g"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=p.isContentEditableTrue,v=p.isContentEditableFalse,w=l.isAfterContentEditableFalse,x=l.isBeforeContentEditableFalse;return function(p){var y,A=p.getBody(),B=new n(p.getBody(),function(a){return p.dom.isBlock(a)}),C="sel-"+p.dom.uniqueId(),F=function(a){a&&p.selection.setRng(a)},G=function(){return p.selection.getRng()},H=function(a,b){p.selection.scrollIntoView(a,b)},I=function(a,b,c){return p.fire("ShowCaret",{target:b,direction:a,before:c}).isDefaultPrevented()?null:(H(b,-1===a),B.show(c,b))},J=function(a,b){return b=l.normalizeRange(a,A,b),-1==a?k.fromRangeStart(b):k.fromRangeEnd(b)},N=function(a){return j.isCaretContainer(a)||j.startsWithCaretContainer(a)||j.endsWithCaretContainer(a)},O=function(a){return N(a.startContainer)||N(a.endContainer)},P=function(b,g){var h,j,k,l,m,n,o,q,r,s,t=p.$,u=p.dom;if(!b)return null;if(b.collapsed){if(!O(b))if(!1===g){if(q=J(-1,b),v(q.getNode(!0)))return I(-1,q.getNode(!0),!1);if(v(q.getNode()))return I(-1,q.getNode(),!q.isAtEnd())}else{if(q=J(1,b),v(q.getNode()))return I(1,q.getNode(),!q.isAtEnd());if(v(q.getNode(!0)))return I(1,q.getNode(!0),!1)}return null}return l=b.startContainer,m=b.startOffset,n=b.endOffset,3===l.nodeType&&0===m&&v(l.parentNode)&&(l=l.parentNode,m=u.nodeIndex(l),l=l.parentNode),1!=l.nodeType?null:(n==m+1&&(h=l.childNodes[m]),v(h)?(r=s=h.cloneNode(!0),(o=p.fire("ObjectSelected",{target:h,targetClone:r})).isDefaultPrevented()?null:(j=f.descendant(c.fromDom(p.getBody()),"#"+C).fold(function(){return t([])},function(a){return t([a.dom()])}),r=o.targetClone,0===j.length&&(j=t('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>').attr("id",C)).appendTo(p.getBody()),b=p.dom.createRng(),r===s&&i.ie?(j.empty().append('<p style="font-size: 0" data-mce-bogus="all"> </p>').append(r),b.setStartAfter(j[0].firstChild.firstChild),b.setEndAfter(r)):(j.empty().append(" ").append(r).append(" "),b.setStart(j[0].firstChild,1),b.setEnd(j[0].lastChild,0)),j.css({top:u.getPos(h,p.getBody()).y}),j[0].focus(),(k=p.selection.getSel()).removeAllRanges(),k.addRange(b),a.each(e.descendants(c.fromDom(p.getBody()),"*[data-mce-selected]"),function(a){d.remove(a,"data-mce-selected")}),h.setAttribute("data-mce-selected",1),y=h,S(),b)):null)},Q=function(){y&&(y.removeAttribute("data-mce-selected"),f.descendant(c.fromDom(p.getBody()),"#"+C).each(b.remove),y=null)},S=function(){B.hide()};return i.ceFalse&&(function(){var a=function(a){for(var b=p.getBody();a&&a!=b;){if(u(a)||v(a))return a;a=a.parentNode}return null};p.on("mouseup",function(a){var b=G();b.collapsed&&h.isXYInContentArea(p,a.clientX,a.clientY)&&F(s.renderCaretAtRange(p,b))}),p.on("click",function(b){var c;(c=a(b.target))&&(v(c)&&(b.preventDefault(),p.focus()),u(c)&&p.dom.isChildOf(c,p.selection.getNode())&&Q())}),p.on("blur NewBlock",function(){Q()});var e=function(a,b){var e=p.dom.getParent(a,p.dom.isBlock),f=p.dom.getParent(b,p.dom.isBlock);return e&&!function(a,b){return p.dom.getParent(a,p.dom.isBlock)===p.dom.getParent(b,p.dom.isBlock)}(e,f)&&function(a){var b=new m(a);if(!a.firstChild)return!1;var c=k.before(a.firstChild),d=b.next(c);return d&&!x(d)&&!w(d)}(e)};(function(b){var c=!1;b.on("touchstart",function(){c=!1}),b.on("touchmove",function(){c=!0}),b.on("touchend",function(d){var e=a(d.target);v(e)&&(c||(d.preventDefault(),P(s.selectNode(b,e))))})})(p),p.on("mousedown",function(b){var c;if(!1!==h.isXYInContentArea(p,b.clientX,b.clientY))if(c=a(b.target))v(c)?(b.preventDefault(),P(s.selectNode(p,c))):(Q(),u(c)&&b.shiftKey||q.isXYWithinRange(b.clientX,b.clientY,p.selection.getRng())||p.selection.placeCaretAt(b.clientX,b.clientY));else{Q(),S();var d=o.closestCaret(A,b.clientX,b.clientY);d&&(e(b.target,d.node)||(b.preventDefault(),p.getBody().focus(),F(I(1,d.node,d.before))))}}),p.on("keypress",function(a){t.modifierPressed(a)||(a.keyCode,v(p.selection.getNode())&&a.preventDefault())}),p.on("getSelectionRange",function(a){var b=a.range;if(y){if(!y.parentNode)return void(y=null);(b=b.cloneRange()).selectNode(y),a.range=b}}),p.on("setSelectionRange",function(a){var b;(b=P(a.range,a.forward))&&(a.range=b)}),p.on("AfterSetSelectionRange",function(a){var b=a.range;O(b)||S(),function(a){return p.dom.hasClass(a,"mce-offscreen-selection")}(b.startContainer.parentNode)||Q()}),p.on("copy",function(a){var b=a.clipboardData;if(!a.isDefaultPrevented()&&a.clipboardData&&!i.ie){var c=function(){var a=p.dom.get(C);return a?a.getElementsByTagName("*")[0]:a}();c&&(a.preventDefault(),b.clearData(),b.setData("text/html",c.outerHTML),b.setData("text/plain",c.outerText))}}),g.init(p),r.setup(p)}(),function(){var a=p.contentStyles,b=".mce-content-body";a.push(B.getCss()),a.push(b+" .mce-offscreen-selection {position: absolute;left: -9999999999px;max-width: 1000000px;}"+b+" *[contentEditable=false] {cursor: default;}"+b+" *[contentEditable=true] {cursor: text;}")}()),{showCaret:I,showBlockCaretContainer:function(a){a.hasAttribute("data-mce-caret")&&(j.showCaretContainerBlock(a),F(G()),H(a[0]))},hideFakeCaret:S,destroy:function(){B.destroy(),y=null}}}}),g("5z",[],function(){return{KEEP:0,DELETE:2,INSERT:1,diff:function(d,e){var f=d.length+e.length+2,g=new Array(f),h=new Array(f),j=function(f,g,h,i,k){var m=l(f,g,h,i);if(null===m||m.start===g&&m.diag===g-i||m.end===f&&m.diag===f-h)for(var n=f,o=h;n<g||o<i;)n<g&&o<i&&d[n]===e[o]?(k.push([0,d[n]]),++n,++o):g-f>i-h?(k.push([2,d[n]]),++n):(k.push([1,e[o]]),++o);else{j(f,m.start,h,m.start-m.diag,k);for(var p=m.start;p<m.end;++p)k.push([0,d[p]]);j(m.end,g,m.end-m.diag,i,k)}},k=function(a,b,c,f){for(var g=a;g-b<f&&g<c&&d[g]===e[g-b];)++g;return function(a,b,c){return{start:a,end:g,diag:c}}(a,0,b)},l=function(a,b,c,f){var i=b-a,j=f-c;if(0===i||0===j)return null;var l=i-j,m=j+i,n=(m%2==0?m:m+1)/2;g[1+n]=a,h[1+n]=b+1;for(var o=0;o<=n;++o){for(var p=-o;p<=o;p+=2){var q=p+n;p===-o||p!=o&&g[q-1]<g[q+1]?g[q]=g[q+1]:g[q]=g[q-1]+1;for(var r=g[q],s=r-a+c-p;r<b&&s<f&&d[r]===e[s];)g[q]=++r,++s;if(l%2!=0&&l-o<=p&&p<=l+o&&h[q-l]<=g[q])return k(h[q-l],p+a-c,b,f)}for(p=l-o;p<=l+o;p+=2){for(q=p+n-l,p===l-o||p!=l+o&&h[q+1]<=h[q-1]?h[q]=h[q+1]-1:h[q]=h[q-1],s=(r=h[q]-1)-a+c-p;r>=a&&s>=c&&d[r]===e[s];)h[q]=r--,s--;if(l%2==0&&-o<=p&&p<=o&&h[q]<=g[q+l])return k(h[q],p+a-c,b,f)}}},m=[];return j(0,d.length,0,e.length,m),m}}}),g("4o",["1j","v","5z","1r"],function(a,b,c,d){var e=function(a){return 1===a.nodeType?a.outerHTML:3===a.nodeType?b.encodeRaw(a.data,!1):8===a.nodeType?"\x3c!--"+a.data+"--\x3e":""},f=function(b){var c,d,e;for(e=a.createElement("div"),c=a.createDocumentFragment(),b&&(e.innerHTML=b);d=e.firstChild;)c.appendChild(d);return c},i=function(a,b){var e=0;d.each(a,function(a){a[0]===c.KEEP?e++:a[0]===c.INSERT?(function(a,b,c){var d=f(b);if(a.hasChildNodes()&&c<a.childNodes.length){var e=a.childNodes[c];e.parentNode.insertBefore(d,e)}else a.appendChild(d)}(b,a[1],e),e++):a[0]===c.DELETE&&function(a,b){if(a.hasChildNodes()&&b<a.childNodes.length){var c=a.childNodes[b];c.parentNode.removeChild(c)}}(b,e)})};return{read:function(a){return d.filter(d.map(a.childNodes,e),function(a){return a.length>0})},write:function(a,b){var f=d.map(b.childNodes,e);return i(c.diff(f,a),b),b}}}),g("2c",["1i","23","4o"],function(a,b,c){var e=function(a){return{type:"fragmented",fragments:a,content:"",bookmark:null,beforeBookmark:null}},f=function(a){return{type:"complete",fragments:null,content:a,bookmark:null,beforeBookmark:null}},i=function(a){return"fragmented"===a.type?a.fragments.join(""):a.content};return{createFragmentedLevel:e,createCompleteLevel:f,createFromEditor:function(g){var h,i,j;return h=c.read(g.getBody()),j=a.bind(h,function(a){var c=b.trimInternal(g.serializer,a);return c.length>0?[c]:[]}),-1!==(i=j.join("")).indexOf("</iframe>")?e(j):f(i)},applyToEditor:function(a,b,d){"fragmented"===b.type?c.write(b.fragments,a.getBody()):a.setContent(b.content,{format:"raw"}),a.selection.moveToBookmark(d?b.beforeBookmark:b.bookmark)},isEq:function(a,b){return!!a&&!!b&&i(a)===i(b)}}}),g("d",["2b","2c","1e"],function(a,b,c){return function(d){var e,f,g=this,h=0,i=[],j=0,k=function(){return 0===j},l=function(a){k()&&(g.typing=a)},m=function(a){d.setDirty(a)},n=function(a){l(!1),g.add({},a)},o=function(){g.typing&&(l(!1),g.add())};return d.on("init",function(){g.add()}),d.on("BeforeExecCommand",function(a){var b=a.command;"Undo"!==b&&"Redo"!==b&&"mceRepaint"!==b&&(o(),g.beforeChange())}),d.on("ExecCommand",function(a){var b=a.command;"Undo"!==b&&"Redo"!==b&&"mceRepaint"!==b&&n(a)}),d.on("ObjectResizeStart Cut",function(){g.beforeChange()}),d.on("SaveContent ObjectResized blur",n),d.on("DragEnd",n),d.on("KeyUp",function(a){var c=a.keyCode;a.isDefaultPrevented()||((c>=33&&c<=36||c>=37&&c<=40||45===c||a.ctrlKey)&&(n(),d.nodeChanged()),46!==c&&8!==c||d.nodeChanged(),f&&g.typing&&!1===b.isEq(b.createFromEditor(d),i[0])&&(!1===d.isDirty()&&(m(!0),d.fire("change",{level:i[0],lastLevel:null})),d.fire("TypingUndo"),f=!1,d.nodeChanged()))}),d.on("KeyDown",function(a){var b=a.keyCode;if(!a.isDefaultPrevented()){if(b>=33&&b<=36||b>=37&&b<=40||45===b)return void(g.typing&&n(a));var c=a.ctrlKey&&!a.altKey||a.metaKey;!(b<16||b>20)||224===b||91===b||g.typing||c||(g.beforeChange(),l(!0),g.add({},a),f=!0)}}),d.on("MouseDown",function(a){g.typing&&n(a)}),d.addShortcut("meta+z","","Undo"),d.addShortcut("meta+y,meta+shift+z","","Redo"),d.on("AddUndo Undo Redo ClearUndos",function(a){a.isDefaultPrevented()||d.nodeChanged()}),g={data:i,typing:!1,beforeChange:function(){k()&&(e=a.getUndoBookmark(d.selection))},add:function(f,g){var j,l,n,o=d.settings;if(n=b.createFromEditor(d),f=f||{},f=c.extend(f,n),!1===k()||d.removed)return null;if(l=i[h],d.fire("BeforeAddUndo",{level:f,lastLevel:l,originalEvent:g}).isDefaultPrevented())return null;if(l&&b.isEq(l,f))return null;if(i[h]&&(i[h].beforeBookmark=e),o.custom_undo_redo_levels&&i.length>o.custom_undo_redo_levels){for(j=0;j<i.length-1;j++)i[j]=i[j+1];i.length--,h=i.length}f.bookmark=a.getUndoBookmark(d.selection),h<i.length-1&&(i.length=h+1),i.push(f),h=i.length-1;var p={level:f,lastLevel:l,originalEvent:g};return d.fire("AddUndo",p),h>0&&(m(!0),d.fire("change",p)),f},undo:function(){var a;return g.typing&&(g.add(),g.typing=!1,l(!1)),h>0&&(a=i[--h],b.applyToEditor(d,a,!0),m(!0),d.fire("undo",{level:a})),a},redo:function(){var a;return h<i.length-1&&(a=i[++h],b.applyToEditor(d,a,!1),m(!0),d.fire("redo",{level:a})),a},clear:function(){i=[],h=0,g.typing=!1,g.data=i,d.fire("ClearUndos")},hasUndo:function(){return h>0||g.typing&&i[0]&&!b.isEq(b.createFromEditor(d),i[0])},hasRedo:function(){return h<i.length-1&&!g.typing},transact:function(a){return o(),g.beforeChange(),g.ignore(a),g.add()},ignore:function(a){try{j++,a()}finally{j--}},extra:function(a,c){var e,f;g.transact(a)&&(f=i[h].bookmark,e=i[h-1],b.applyToEditor(d,e,!0),g.transact(c)&&(i[h-1].beforeBookmark=f))}}}}),g("4q",["1r","1y","n"],function(a,b,c){var d={},e=a.filter,f=a.each;return function(a,b){var c=d[a];c||(d[a]=c=[]),d[a].push(b)}("pre",function(d){var g,h,i=d.selection.getRng();g=b.matchNodeNames("pre"),i.collapsed||(h=d.selection.getSelectedBlocks(),f(e(e(h,g),function(b){return g(b.previousSibling)&&-1!==a.indexOf(h,b.previousSibling)}),function(a){!function(a,b){c(b).remove(),c(a).append("<br><br>").append(b.childNodes)}(a.previousSibling,a)}))}),{postProcess:function(a,b){f(d[a],function(a){a(b)})}}}),g("2w",["1e"],function(a){var b=a.each;return{walk:function(a,d,e){var f,g,h,i,j,k,l,m=d.startContainer,n=d.startOffset,o=d.endContainer,p=d.endOffset;if((l=a.select("td[data-mce-selected],th[data-mce-selected]")).length>0)b(l,function(a){e([a])});else{var q=function(a){var b;return 3===(b=a[0]).nodeType&&b===m&&n>=b.nodeValue.length&&a.splice(0,1),b=a[a.length-1],0===p&&a.length>0&&b===o&&3===b.nodeType&&a.splice(a.length-1,1),a},r=function(a,b,c){for(var d=[];a&&a!=c;a=a[b])d.push(a);return d},s=function(a,b){do{if(a.parentNode===b)return a;a=a.parentNode}while(a)},t=function(a,b,c){var d=c?"nextSibling":"previousSibling";for(j=(i=a).parentNode;i&&i!=b;i=j)j=i.parentNode,(k=r(i===a?i:i[d],d)).length&&(c||k.reverse(),e(q(k)))};if(1===m.nodeType&&m.hasChildNodes()&&(m=m.childNodes[n]),1===o.nodeType&&o.hasChildNodes()&&(o=function(a,b){var c=a.childNodes;return--b>c.length-1?b=c.length-1:b<0&&(b=0),c[b]||a}(o,p)),m===o)return e(q([m]));for(f=a.findCommonAncestor(m,o),i=m;i;i=i.parentNode){if(i===o)return t(m,f,!0);if(i===f)break}for(i=o;i;i=i.parentNode){if(i===m)return t(o,f);if(i===f)break}g=s(m,f)||m,h=s(o,f)||o,t(m,g,!0),(k=r(g===m?g:g.nextSibling,"nextSibling",h===o?h.nextSibling:h)).length&&e(q(k)),t(o,h)}}}}),g("2k",["2r","1y","s","2f","49","4a","2i","2w","1e"],function(a,b,c,d,e,f,g,h,i){var j=/^(src|href|style)$/,k=i.each,l=f.isEq,m=function(a){return/^(TH|TD)$/.test(a.nodeName)},n=function(a,d,e){var f,g,h;return f=d[e?"startContainer":"endContainer"],g=d[e?"startOffset":"endOffset"],b.isElement(f)&&(h=f.childNodes.length-1,!e&&g&&g--,f=f.childNodes[g>h?h:g]),b.isText(f)&&e&&g>=f.nodeValue.length&&(f=new c(f,a.getBody()).next()||f),b.isText(f)&&!e&&0===g&&(f=new c(f,a.getBody()).prev()||f),f},o=function(a,b,c,d){var e=a.create(c,d);return b.parentNode.insertBefore(e,b),e.appendChild(b),e},p=function(a,c,d){return!!l(c,d.inline)||!!l(c,d.block)||(d.selector?b.isElement(c)&&a.is(c,d.selector):void 0)},r=function(a,b,c,d){return!(b=f.getNonWhiteSpaceSibling(b,c,d))||"BR"===b.nodeName||a.isBlock(b)},s=function(a,b,c){var d,e=b.parentNode,g=a.dom,h=a.settings.forced_root_block;c.block&&(h?e===g.getRoot()&&(c.list_block&&l(b,c.list_block)||k(i.grep(b.childNodes),function(b){f.isValid(a,h,b.nodeName.toLowerCase())?d?d.appendChild(b):(d=o(g,b,h),g.setAttribs(d,a.settings.forced_root_block_attrs)):d=0})):g.isBlock(b)&&!g.isBlock(e)&&(r(g,b,!1)||r(g,b.firstChild,!0,1)||b.insertBefore(g.create("br"),b.firstChild),r(g,b,!0)||r(g,b.lastChild,!1,1)||b.appendChild(g.create("br")))),c.selector&&c.inline&&!l(c.inline,b)||g.remove(b,1)},t=function(a,b,c,d,e){var g,h,i,m=a.dom;if(!p(m,d,b)&&!function(a,b){return b.links&&"A"===a.tagName}(d,b))return!1;if("all"!==b.remove)for(k(b.styles,function(a,g){a=f.normalizeStyleValue(m,f.replaceVars(a,c),g),"number"==typeof g&&(g=a,e=0),(b.remove_similar||!e||l(f.getStyle(m,e,g),a))&&m.setStyle(d,g,""),i=1}),i&&""===m.getAttrib(d,"style")&&(d.removeAttribute("style"),d.removeAttribute("data-mce-style")),k(b.attributes,function(a,b){var g;if(a=f.replaceVars(a,c),"number"==typeof b&&(b=a,e=0),!e||l(m.getAttrib(e,b),a)){if("class"===b&&(a=m.getAttrib(d,b))&&(g="",k(a.split(/\s+/),function(a){/mce\-\w+/.test(a)&&(g+=(g?" ":"")+a)}),g))return void m.setAttrib(d,b,g);"class"===b&&d.removeAttribute("className"),j.test(b)&&d.removeAttribute("data-mce-"+b),d.removeAttribute(b)}}),k(b.classes,function(a){a=f.replaceVars(a,c),e&&!m.hasClass(e,a)||m.removeClass(d,a)}),h=m.getAttribs(d),g=0;g<h.length;g++){var n=h[g].nodeName;if(0!==n.indexOf("_")&&0!==n.indexOf("data-"))return!1}return"none"!==b.remove?(s(a,d,b),!0):void 0};return{removeFormat:t,remove:function(c,j,l,p,q){var r,s,w=c.formatter.get(j),x=w[0],y=!0,z=c.dom,A=c.selection,B=function(a){var b=function(a,b,c,d,e){var h;return k(f.getParents(a.dom,b.parentNode).reverse(),function(b){var f;h||"_start"===b.id||"_end"===b.id||(f=g.matchNode(a,b,c,d,e))&&!1!==f.split&&(h=b)}),h}(c,a,j,l,q);return function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o=a.dom;if(c){for(n=c.parentNode,i=d.parentNode;i&&i!==n;i=i.parentNode){for(j=o.clone(i,!1),m=0;m<b.length;m++)if(t(a,b[m],h,j,j)){j=0;break}j&&(k&&j.appendChild(k),l||(l=j),k=j)}!f||g.mixed&&o.isBlock(c)||(d=o.split(c,d)),k&&(e.parentNode.insertBefore(k,e),l.appendChild(e))}return d}(c,w,b,a,a,!0,x,l)},C=function(a){var d,e,f,g,h;if(b.isElement(a)&&z.getContentEditable(a)&&(g=y,y="true"===z.getContentEditable(a),h=!0),d=i.grep(a.childNodes),y&&!h)for(e=0,f=w.length;e<f&&!t(c,w[e],l,a,a);e++);if(x.deep&&d.length){for(e=0,f=d.length;e<f;e++)C(d[e]);h&&(y=g)}},D=function(c){var d=z.get(c?"_start":"_end"),e=d[c?"firstChild":"lastChild"];return a.isBookmarkNode(e)&&(e=e[c?"firstChild":"lastChild"]),b.isText(e)&&0===e.data.length&&(e=c?d.previousSibling||d.nextSibling:d.nextSibling||d.previousSibling),z.remove(d,!0),e},E=function(a){var d,g,i=a.commonAncestorContainer;if(a=e.expandRng(c,a,w,!0),x.split){if(d=n(c,a,!0),g=n(c,a),d!==g){if(/^(TR|TH|TD)$/.test(d.nodeName)&&d.firstChild&&(d="TR"===d.nodeName?d.firstChild.firstChild||d:d.firstChild||d),i&&/^T(HEAD|BODY|FOOT|R)$/.test(i.nodeName)&&m(g)&&g.firstChild&&(g=g.firstChild||g),z.isChildOf(d,g)&&d!==g&&!z.isBlock(g)&&!m(d)&&!m(g))return d=o(z,d,"span",{id:"_start","data-mce-type":"bookmark"}),B(d),void(d=D(!0));d=o(z,d,"span",{id:"_start","data-mce-type":"bookmark"}),g=o(z,g,"span",{id:"_end","data-mce-type":"bookmark"}),B(d),B(g),d=D(!0),g=D()}else d=g=B(d);a.startContainer=d.parentNode?d.parentNode:d,a.startOffset=z.nodeIndex(d),a.endContainer=g.parentNode?g.parentNode:g,a.endOffset=z.nodeIndex(g)+1}h.walk(z,a,function(a){k(a,function(a){C(a),b.isElement(a)&&"underline"===c.dom.getStyle(a,"text-decoration")&&a.parentNode&&"underline"===f.getTextDecoration(z,a.parentNode)&&t(c,{deep:!1,exact:!0,inline:"span",styles:{textDecoration:"underline"}},null,a)})})};if(p)p.nodeType?((s=z.createRng()).setStartBefore(p),s.setEndAfter(p),E(s)):E(p);else if("false"!==z.getContentEditable(A.getNode()))A.isCollapsed()&&x.inline&&!z.select("td[data-mce-selected],th[data-mce-selected]").length?d.removeCaretFormat(c,j,l,q):(r=A.getBookmark(),E(A.getRng(!0)),A.moveToBookmark(r),x.inline&&g.match(c,j,l,A.getStart())&&f.moveStart(z,A,A.getRng(!0)),c.nodeChanged());else{p=A.getNode();for(var F=0,G=w.length;F<G&&(!w[F].ceFalseOverride||!t(c,w[F],l,p,p));F++);}}}}),g("4r",["1","2r","3s","1y","2f","4a","2i","2k","1e"],function(a,b,c,d,e,f,g,h,i){var j=i.each,k=function(a){return a&&1===a.nodeType&&!b.isBookmarkNode(a)&&!e.isCaretNode(a)&&!d.isBogus(a)},l=function(a,c){var d;for(d=a;d;d=d[c]){if(3===d.nodeType&&0!==d.nodeValue.length)return a;if(1===d.nodeType&&!b.isBookmarkNode(d))return d}return a},m=function(a,b,d){var e,f,g=new c(a);if(b&&d&&(b=l(b,"previousSibling"),d=l(d,"nextSibling"),g.compare(b,d))){for(e=b.nextSibling;e&&e!==d;)f=e,e=e.nextSibling,b.appendChild(f);return a.remove(d),i.each(i.grep(d.childNodes),function(a){b.appendChild(a)}),b}return d},n=function(a,b,c){j(a.childNodes,function(a){k(a)&&(b(a)&&c(a),a.hasChildNodes()&&n(a,b,c))})},o=function(b,c){return a.curry(function(a,c){return!(!c||!f.getStyle(b,c,a))},c)},p=function(b,c,d){return a.curry(function(a,c,d){b.setStyle(d,a,c),""===d.getAttribute("style")&&d.removeAttribute("style"),q(b,d)},c,d)},q=function(a,b){"SPAN"===b.nodeName&&0===a.getAttribs(b).length&&a.remove(b,!0)},r=function(a,b){var c;1===b.nodeType&&b.parentNode&&1===b.parentNode.nodeType&&(c=f.getTextDecoration(a,b.parentNode),a.getStyle(b,"color")&&c?a.setStyle(b,"text-decoration",c):a.getStyle(b,"text-decoration")===c&&a.setStyle(b,"text-decoration",null))};return{mergeWithChildren:function(a,b,c,d){j(b,function(b){j(a.dom.select(b.inline,d),function(d){k(d)&&h.removeFormat(a,b,c,d,b.exact?d:null)}),function(a,b,c){if(b.clear_child_styles){var d=b.links?"*:not(a)":"*";j(a.select(d,c),function(c){k(c)&&j(b.styles,function(b,d){a.setStyle(c,d,"")})})}}(a.dom,b,d)})},mergeUnderlineAndColor:function(b,c,d,e){(c.styles.color||c.styles.textDecoration)&&(i.walk(e,a.curry(r,b),"childNodes"),r(b,e))},mergeBackgroundColorAndFontSize:function(a,b,c,d){b.styles&&b.styles.backgroundColor&&n(d,o(a,"fontSize"),p(a,"backgroundColor",f.replaceVars(b.styles.backgroundColor,c)))},mergeSubSup:function(a,b,c,d){"sub"!==b.inline&&"sup"!==b.inline||(n(d,o(a,"fontSize"),p(a,"fontSize","")),a.remove(a.select("sup"===b.inline?"sub":"sup",d),!0))},mergeSiblings:function(a,b,c,d){d&&!1!==b.merge_siblings&&(d=m(a,f.getNonWhiteSpaceSibling(d),d),d=m(a,d,f.getNonWhiteSpaceSibling(d,!0)))},mergeWithParents:function(a,b,c,d,e){g.matchNode(a,e.parentNode,c,d)&&h.removeFormat(a,b,d,e)||b.merge_with_parents&&a.dom.getParent(e.parentNode,function(f){if(g.matchNode(a,f,c,d))return h.removeFormat(a,b,d,e),!0})}}}),g("2e",["2r","1y","2f","49","4a","4q","2i","4r","3u","2w","1e"],function(a,b,c,d,e,f,g,h,i,j,k){var l=k.each,m=function(d){return d&&1===d.nodeType&&!a.isBookmarkNode(d)&&!c.isCaretNode(d)&&!b.isBogus(d)},n=function(b,o,p,q){var r,s,t=b.formatter.get(o),u=t[0],v=!q&&b.selection.isCollapsed(),w=b.dom,x=b.selection,y=function(a,b){if(b=b||u,a){if(b.onformat&&b.onformat(a,b,p,q),l(b.styles,function(b,c){w.setStyle(a,c,e.replaceVars(b,p))}),b.styles){var c=w.getAttrib(a,"style");c&&a.setAttribute("data-mce-style",c)}l(b.attributes,function(b,c){w.setAttrib(a,c,e.replaceVars(b,p))}),l(b.classes,function(b){b=e.replaceVars(b,p),w.hasClass(a,b)||w.addClass(a,b)})}},z=function(a,b){var d=!1;return!!u.selector&&(l(a,function(a){if(!("collapsed"in a&&a.collapsed!==v))return w.is(b,a.selector)&&!c.isCaretNode(b)?(y(b,a),d=!0,!1):void 0}),d)},A=function(d,f,i,n){var q,r,s=[],v=!0;q=u.inline||u.block,r=d.create(q),y(r),j.walk(d,f,function(a){var f,h=function(a){var i,j,m,w;if(w=v,i=a.nodeName.toLowerCase(),j=a.parentNode.nodeName.toLowerCase(),1===a.nodeType&&d.getContentEditable(a)&&(w=v,v="true"===d.getContentEditable(a),m=!0),e.isEq(i,"br"))return f=0,void(u.block&&d.remove(a));if(u.wrapper&&g.matchNode(b,a,o,p))f=0;else{if(v&&!m&&u.block&&!u.wrapper&&e.isTextBlock(b,i)&&e.isValid(b,j,q))return a=d.rename(a,q),y(a),s.push(a),void(f=0);if(u.selector){var x=z(t,a);if(!u.inline||x)return void(f=0)}!v||m||!e.isValid(b,q,i)||!e.isValid(b,j,q)||!n&&3===a.nodeType&&1===a.nodeValue.length&&65279===a.nodeValue.charCodeAt(0)||c.isCaretNode(a)||u.inline&&d.isBlock(a)?(f=0,l(k.grep(a.childNodes),h),m&&(v=w),f=0):(f||(f=d.clone(r,!1),a.parentNode.insertBefore(f,a),s.push(f)),f.appendChild(a))}};l(a,h)}),!0===u.links&&l(s,function(a){var b=function(a){"A"===a.nodeName&&y(a,u),l(k.grep(a.childNodes),b)};b(a)}),l(s,function(c){var f;return f=function(b){var c=0;return l(b.childNodes,function(b){e.isWhiteSpaceNode(b)||a.isBookmarkNode(b)||c++}),c}(c),(s.length>1||!d.isBlock(c))&&0===f?void d.remove(c,1):void((u.inline||u.wrapper)&&(u.exact||1!==f||(c=function(b){var c,e;return(c=function(a){var b=!1;return l(a.childNodes,function(a){if(m(a))return b=a,!1}),b}(b))&&!a.isBookmarkNode(c)&&g.matchName(d,c,u)&&(e=d.clone(c,!1),y(e),d.replace(e,b,!0),d.remove(c,1)),e||b}(c)),h.mergeWithChildren(b,t,p,c),h.mergeWithParents(b,u,o,p,c),h.mergeBackgroundColorAndFontSize(d,u,p,c),h.mergeSubSup(d,u,p,c),h.mergeSiblings(d,u,p,c)))})};if("false"!==w.getContentEditable(x.getNode())){if(u){if(q)q.nodeType?z(t,q)||((s=w.createRng()).setStartBefore(q),s.setEndAfter(q),A(w,d.expandRng(b,s,t),0,!0)):A(w,q,0,!0);else if(v&&u.inline&&!w.select("td[data-mce-selected],th[data-mce-selected]").length)c.applyCaretFormat(b,o,p);else{var B=b.selection.getNode();b.settings.forced_root_block||!t[0].defaultBlock||w.getParent(B,w.isBlock)||n(b,t[0].defaultBlock),b.selection.setRng(i.normalize(b.selection.getRng())),r=x.getBookmark(),A(w,d.expandRng(b,x.getRng(!0),t)),u.styles&&h.mergeUnderlineAndColor(w,u,p,B),x.moveToBookmark(r),e.moveStart(w,x,x.getRng(!0)),b.nodeChanged()}f.postProcess(o,b)}}else{q=x.getNode();for(var C=0,D=t.length;C<D;C++)if(t[C].ceFalseOverride&&w.is(q,t[C].selector))return void y(q,t[C])}};return{applyFormat:n}}),g("2g",["2d","4a","2i","1e"],function(a,b,c,d){var e=d.each,f=function(a,f){var g={};a.set({}),f.on("NodeChange",function(h){var i=b.getParents(f.dom,h.element),j={};i=d.grep(i,function(a){return 1===a.nodeType&&!a.getAttribute("data-mce-bogus")}),e(a.get(),function(a,b){e(i,function(d){return f.formatter.matchNode(d,b,{},a.similar)?(g[b]||(e(a,function(a){a(!0,{node:d,format:b,parents:i})}),g[b]=a),j[b]=a,!1):!c.matchesUnInheritedFormatSelector(f,d,b)&&void 0})}),e(g,function(a,b){j[b]||(delete g[b],e(a,function(a){a(!1,{node:h.element,format:b,parents:i})}))})})},g=function(a,b,c,d){var f=a.get();e(b.split(","),function(a){f[a]||(f[a]=[],f[a].similar=d),f[a].push(c)}),a.set(f)};return{formatChanged:function(a,b,c,d,e){null===b.get()&&f(b,a),g(b,c,d,e)}}}),g("4s",["1e"],function(a){return{get:function(b){var c={valigntop:[{selector:"td,th",styles:{verticalAlign:"top"}}],valignmiddle:[{selector:"td,th",styles:{verticalAlign:"middle"}}],valignbottom:[{selector:"td,th",styles:{verticalAlign:"bottom"}}],alignleft:[{selector:"figure.image",collapsed:!1,classes:"align-left",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},inherit:!1,preview:!1,defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{float:"left"},preview:"font-family font-size"}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"figure.image",collapsed:!1,classes:"align-center",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"img",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"},preview:!1},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"},preview:"font-family font-size"}],alignright:[{selector:"figure.image",collapsed:!1,classes:"align-right",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{float:"right"},preview:"font-family font-size"}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},inherit:!1,defaultBlock:"div",preview:"font-family font-size"}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all"}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:!0},{inline:"strike",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},fontname:{inline:"span",styles:{fontFamily:"%value"},clear_child_styles:!0},fontsize:{inline:"span",styles:{fontSize:"%value"},clear_child_styles:!0},fontsize_class:{inline:"span",attributes:{class:"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:function(){return!0},onformat:function(c,d,e){a.each(e,function(a,d){b.setAttrib(c,d,a)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]};return a.each("p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp".split(/\s/),function(a){c[a]={block:a,remove:"all"}}),c}}}),g("2h",["4s","1e"],function(a,b){return function(c){var d={},f=function(a,c){a&&("string"!=typeof a?b.each(a,function(a,b){f(b,a)}):(c=c.length?c:[c],b.each(c,function(a){void 0===a.deep&&(a.deep=!a.selector),void 0===a.split&&(a.split=!a.selector||a.inline),void 0===a.remove&&a.selector&&!a.inline&&(a.remove="none"),a.selector&&a.inline&&(a.mixed=!0,a.block_expand=!0),"string"==typeof a.classes&&(a.classes=a.classes.split(/\s+/))}),d[a]=c))};return f(a.get(c.dom)),f(c.settings.formats),{get:function(a){return a?d[a]:d},register:f,unregister:function(a){return a&&d[a]&&delete d[a],d}}}}),g("2j",["m","1e","y"],function(a,b,c){var d=b.each,e=a.DOM,f=function(a,d){var f,g,h,i=d&&d.schema||new c({}),k=function(a){var b;return g="string"==typeof a?{name:a,classes:[],attrs:{}}:a,b=e.create(g.name),function(a,b){b.classes.length&&e.addClass(a,b.classes.join(" ")),e.setAttribs(a,b.attrs)}(b,g),b},l=function(a,c){var d="string"!=typeof a?a.nodeName.toLowerCase():a,e=i.getElementRule(d),f=e&&e.parentsRequired;return!(!f||!f.length)&&(c&&-1!==b.inArray(f,c)?c:f[0])},m=function(a,c,d){var f,g,h,i=c.length>0&&c[0],j=i&&i.name;if(h=l(a,j))j===h?(g=c[0],c=c.slice(1)):g=h;else if(i)g=c[0],c=c.slice(1);else if(!d)return a;return g&&(f=k(g)).appendChild(a),d&&(f||(f=e.create("div")).appendChild(a),b.each(d,function(b){var c=k(b);f.insertBefore(c,a)})),m(f,c,g&&g.siblings)};return a&&a.length?(g=a[0],f=k(g),(h=e.create("div")).appendChild(m(f,a.slice(1),g.siblings)),h):""},h=function(a){var c,d={classes:[],attrs:{}};return"*"!==(a=d.selector=b.trim(a))&&(c=a.replace(/(?:([#\.]|::?)([\w\-]+)|(\[)([^\]]+)\]?)/g,function(a,c,e,f,g){switch(c){case"#":d.attrs.id=e;break;case".":d.classes.push(e);break;case":":-1!==b.inArray("checked disabled enabled read-only required".split(" "),e)&&(d.attrs[e]=e)}if("["===f){var h=g.match(/([\w\-]+)(?:\=\"([^\"]+))?/);h&&(d.attrs[h[1]]=h[2])}return""})),d.name=c||"div",d},i=function(a){return a&&"string"==typeof a?(a=a.split(/\s*,\s*/)[0],a=a.replace(/\s*(~\+|~|\+|>)\s*/g,"$1"),b.map(a.split(/(?:>|\s+(?![^\[\]]+\]))/),function(a){var c=b.map(a.split(/(?:~\+|~|\+)/),h),d=c.pop();return c.length&&(d.siblings=c),d}).reverse()):[]};return{getCssText:function(a,b){var c,g,h,j,k,l,m="";if(!1===(l=a.settings.preview_styles))return"";"string"!=typeof l&&(l="font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow");var n=function(a){return a.replace(/%(\w+)/g,"")};if("string"==typeof b){if(!(b=a.formatter.get(b)))return;b=b[0]}return"preview"in b&&!1===(l=b.preview)?"":(c=b.block||b.inline||"span",(j=i(b.selector)).length?(j[0].name||(j[0].name=c),c=b.selector,g=f(j,a)):g=f([c],a),h=e.select(c,g)[0]||g.firstChild,d(b.styles,function(a,b){(a=n(a))&&e.setStyle(h,b,a)}),d(b.attributes,function(a,b){(a=n(a))&&e.setAttrib(h,b,a)}),d(b.classes,function(a){a=n(a),e.hasClass(h,a)||e.addClass(h,a)}),a.fire("PreviewFormats"),e.setStyles(g,{position:"absolute",left:-65535}),a.getBody().appendChild(g),k=e.getStyle(a.getBody(),"fontSize",!0),k=/px$/.test(k)?parseInt(k,10):0,d(l.split(" "),function(b){var c=e.getStyle(h,b,!0);if(!("background-color"===b&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(c)&&(c=e.getStyle(a.getBody(),b,!0),"#ffffff"===e.toHex(c).toLowerCase())||"color"===b&&"#000000"===e.toHex(c).toLowerCase())){if("font-size"===b&&/em|%$/.test(c)){if(0===k)return;c=(c=parseFloat(c,10)/(/%$/.test(c)?100:1))*k+"px"}"border"===b&&c&&(m+="padding:0 2px;"),m+=b+":"+c+";"}}),a.fire("AfterPreviewFormats"),e.remove(g),m)},parseSelector:i,selectorToHtml:function(a,b){return f(i(a),b)}}}),g("2l",["2e","2i","2k"],function(a,b,c){return{toggle:function(d,e,f,g,h){var i=e.get(f);!b.match(d,f,g,h)||"toggle"in i[0]&&!i[0].toggle?a.applyFormat(d,f,g,h):c.remove(d,f,g,h)}}}),g("2m",[],function(){return{setup:function(a){a.addShortcut("meta+b","","Bold"),a.addShortcut("meta+i","","Italic"),a.addShortcut("meta+u","","Underline");for(var b=1;b<=6;b++)a.addShortcut("access+"+b,"",["FormatBlock",!1,"h"+b]);a.addShortcut("access+7","",["FormatBlock",!1,"p"]),a.addShortcut("access+8","",["FormatBlock",!1,"div"]),a.addShortcut("access+9","",["FormatBlock",!1,"address"])}}}),g("f",["2d","1","2e","2f","2g","2h","2i","2j","2k","2l","2m"],function(a,b,c,d,e,f,g,h,i,j,k){return function(l){var m=f(l),n=a(null);return k.setup(l),d.setup(l),{get:m.get,register:m.register,unregister:m.unregister,apply:b.curry(c.applyFormat,l),remove:b.curry(i.remove,l),toggle:b.curry(j.toggle,l,m),match:b.curry(g.match,l),matchAll:b.curry(g.matchAll,l),matchNode:b.curry(g.matchNode,l),canApply:b.curry(g.canApply,l),formatChanged:b.curry(e.formatChanged,l,n),getCssText:b.curry(h.getCssText,l)}}}),g("4t",["28","4","5"],function(a,b,c){var f=function(a){return function(){for(var d=new b(arguments.length),e=0;e<d.length;e++)d[e]=arguments[e];if(0===d.length)throw new c("Can't merge zero objects");for(var f={},g=0;g<d.length;g++){var h=d[g];for(var i in h)h.hasOwnProperty(i)&&(f[i]=a(f[i],h[i]))}return f}},g=f(function(b,c){return a.isObject(b)&&a.isObject(c)?g(b,c):c}),h=f(function(a,b){return b});return{deepMerge:g,merge:h}}),g("4u",[],function(){return{firePreProcess:function(a,b){return a.fire("PreProcess",b)},firePostProcess:function(a,b){return a.fire("PostProcess",b)}}}),g("4v",["1i","v"],function(a,b){return{register:function(c,d,e){c.addAttributeFilter("data-mce-tabindex",function(a,b){for(var c,d=a.length;d--;)(c=a[d]).attr("tabindex",c.attributes.map["data-mce-tabindex"]),c.attr(b,null)}),c.addAttributeFilter("src,href,style",function(a,b){for(var c,f,h=a.length,i="data-mce-"+b,j=d.url_converter,k=d.url_converter_scope;h--;)c=a[h],void 0!==(f=c.attributes.map[i])?(c.attr(b,f.length>0?f:null),c.attr(i,null)):(f=c.attributes.map[b],"style"===b?f=e.serializeStyle(e.parseStyle(f),c.name):j&&(f=j.call(k,f,b,c.name)),c.attr(b,f.length>0?f:null))}),c.addAttributeFilter("class",function(a){for(var b,c,d=a.length;d--;)b=a[d],(c=b.attr("class"))&&(c=b.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,""),b.attr("class",c.length>0?c:null))}),c.addAttributeFilter("data-mce-type",function(a,b,c){for(var d,e=a.length;e--;)"bookmark"!==(d=a[e]).attributes.map["data-mce-type"]||c.cleanup||d.remove()}),c.addNodeFilter("noscript",function(a){for(var c,d=a.length;d--;)(c=a[d].firstChild)&&(c.value=b.decode(c.value))}),c.addNodeFilter("script,style",function(a,b){for(var c,e,f,g=a.length,h=function(a){return a.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")};g--;)c=a[g],e=c.firstChild?c.firstChild.value:"","script"===b?((f=c.attr("type"))&&c.attr("type","mce-no/type"===f?null:f.replace(/^mce\-/,"")),"xhtml"===d.element_format&&e.length>0&&(c.firstChild.value="// <![CDATA[\n"+h(e)+"\n// ]]>")):"xhtml"===d.element_format&&e.length>0&&(c.firstChild.value="\x3c!--\n"+h(e)+"\n--\x3e")}),c.addNodeFilter("#comment",function(a){for(var b,c=a.length;c--;)0===(b=a[c]).value.indexOf("[CDATA[")?(b.name="#cdata",b.type=4,b.value=b.value.replace(/^\[CDATA\[|\]\]$/g,"")):0===b.value.indexOf("mce:protected ")&&(b.name="#text",b.type=3,b.raw=!0,b.value=unescape(b.value).substr(14))}),c.addNodeFilter("xml:namespace,input",function(a,b){for(var c,d=a.length;d--;)7===(c=a[d]).type?c.remove():1===c.type&&("input"!==b||"type"in c.attributes.map||c.attr("type","text"))}),c.addAttributeFilter("data-mce-type",function(b){a.each(b,function(a){"format-caret"===a.attr("data-mce-type")&&(a.isEmpty(c.schema.getNonEmptyElements())?a.remove():a.unwrap())})}),c.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize",function(a,b){for(var c=a.length;c--;)a[c].attr(b,null)})},trimTrailingBr:function(a){var b,c,d=function(a){return a&&"br"===a.name};d(b=a.lastChild)&&(c=b.prev,d(c)&&(b.remove(),c.remove()))}}}),g("4w",["4t","1j","4u","1e"],function(a,b,c,d){var e=function(e,f,g){var h,i,j,k=e.dom;return f=f.cloneNode(!0),(h=b.implementation).createHTMLDocument&&(i=h.createHTMLDocument(""),d.each("BODY"===f.nodeName?f.childNodes:[f],function(a){i.body.appendChild(i.importNode(a,!0))}),f="BODY"!==f.nodeName?i.body.firstChild:i.body,j=k.doc,k.doc=i),c.firePreProcess(e,a.merge(g,{node:f})),j&&(k.doc=j),f};return{process:function(a,b,c){return function(a,b){return a&&a.hasEventListeners("PreProcess")&&!b.no_events}(a,c)?e(a,b,c):b}}}),g("38",["1i","10","1e"],function(a,b,c){var d=function(b,c){a.each(c,function(a){b.attr(a,null)})},e=function(b,c,e){b.addNodeFilter("font",function(b){a.each(b,function(a){var b=c.parse(a.attr("style")),f=a.attr("color"),g=a.attr("face"),h=a.attr("size");f&&(b.color=f),g&&(b["font-family"]=g),h&&(b["font-size"]=e[parseInt(a.attr("size"),10)-1]),a.name="span",a.attr("style",c.serialize(b)),d(a,["color","face","size"])})})},f=function(b,c){b.addNodeFilter("strike",function(b){a.each(b,function(a){var b=c.parse(a.attr("style"));b["text-decoration"]="line-through",a.name="span",a.attr("style",c.serialize(b))})})},g=function(a,d){var g=b();d.convert_fonts_to_spans&&e(a,g,c.explode(d.font_size_legacy_values)),f(a,g)};return{register:function(a,b){b.inline_styles&&g(a,b)}}}),g("w",[],function(){var a=/^[ \t\r\n]*$/,b={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11},c=function(a,b,c){var d,e,f=c?"lastChild":"firstChild",g=c?"prev":"next";if(a[f])return a[f];if(a!==b){if(d=a[g])return d;for(e=a.parent;e&&e!==b;e=e.parent)if(d=e[g])return d}},d=function(a,b){this.name=a,this.type=b,1===b&&(this.attributes=[],this.attributes.map={})};return d.prototype={replace:function(a){var b=this;return a.parent&&a.remove(),b.insert(a,b),b.remove(),b},attr:function(a,b){var c,d,f=this;if("string"!=typeof a){for(d in a)f.attr(d,a[d]);return f}if(c=f.attributes){if(void 0!==b){if(null===b){if(a in c.map)for(delete c.map[a],d=c.length;d--;)if(c[d].name===a)return c=c.splice(d,1),f;return f}if(a in c.map){for(d=c.length;d--;)if(c[d].name===a){c[d].value=b;break}}else c.push({name:a,value:b});return c.map[a]=b,f}return c.map[a]}},clone:function(){var a,b,c,e,f,g=this,h=new d(g.name,g.type);if(c=g.attributes){for((f=[]).map={},a=0,b=c.length;a<b;a++)"id"!==(e=c[a]).name&&(f[f.length]={name:e.name,value:e.value},f.map[e.name]=e.value);h.attributes=f}return h.value=g.value,h.shortEnded=g.shortEnded,h},wrap:function(a){var b=this;return b.parent.insert(a,b),a.append(b),b},unwrap:function(){var a,b,c=this;for(a=c.firstChild;a;)b=a.next,c.insert(a,c,!0),a=b;c.remove()},remove:function(){var a=this,b=a.parent,c=a.next,d=a.prev;return b&&(b.firstChild===a?(b.firstChild=c,c&&(c.prev=null)):d.next=c,b.lastChild===a?(b.lastChild=d,d&&(d.next=null)):c.prev=d,a.parent=a.next=a.prev=null),a},append:function(a){var b,c=this;return a.parent&&a.remove(),(b=c.lastChild)?(b.next=a,a.prev=b,c.lastChild=a):c.lastChild=c.firstChild=a,a.parent=c,a},insert:function(a,b,c){var d;return a.parent&&a.remove(),d=b.parent||this,c?(b===d.firstChild?d.firstChild=a:b.prev.next=a,a.prev=b.prev,a.next=b,b.prev=a):(b===d.lastChild?d.lastChild=a:b.next.prev=a,a.next=b.next,a.prev=b,b.next=a),a.parent=d,a},getAll:function(a){var b,e=[];for(b=this.firstChild;b;b=c(b,this))b.name===a&&e.push(b);return e},empty:function(){var a,b,d,e=this;if(e.firstChild){for(a=[],d=e.firstChild;d;d=c(d,e))a.push(d);for(b=a.length;b--;)d=a[b],d.parent=d.firstChild=d.lastChild=d.next=d.prev=null}return e.firstChild=e.lastChild=null,e},isEmpty:function(b,d,e){var f,g,i=this.firstChild;if(d=d||{},i)do{if(1===i.type){if(i.attributes.map["data-mce-bogus"])continue;if(b[i.name])return!1;for(f=i.attributes.length;f--;)if("name"===(g=i.attributes[f].name)||0===g.indexOf("data-mce-bookmark"))return!1}if(8===i.type)return!1;if(3===i.type&&!a.test(i.value))return!1;if(3===i.type&&i.parent&&d[i.parent.name]&&a.test(i.value))return!1;if(e&&e(i))return!1}while(i=c(i,this));return!0},walk:function(a){return c(this,null,a)}},d.create=function(a,c){var e,f;if(e=new d(a,b[a]||1),c)for(f in c)e.attr(f,c[f]);return e},d}),g("u",["38","w","x","y","1e"],function(a,b,c,d,e){var f=e.makeMap,g=e.each,h=e.explode,i=e.extend,j=function(a,c,d,e){(a.padd_empty_with_br||c.insert)&&d[e.name]?e.empty().append(new b("br","1")).shortEnded=!0:e.empty().append(new b("#text","3")).value=" "},k=function(a){return l(a,"#text")&&" "===a.firstChild.value},l=function(a,b){return a&&a.firstChild&&a.firstChild===a.lastChild&&a.firstChild.name===b},n=function(a,b,c,d){return d.isEmpty(b,c,function(b){return function(a,b){var c=a.getElementRule(b.name);return c&&c.paddEmpty}(a,b)})};return function(m,o){var p=this,q={},r=[],s={},t={};(m=m||{}).validate=!("validate"in m)||m.validate,m.root_name=m.root_name||"body",p.schema=o=o||new d;var u=function(a){var c,d,e,g,h,i,j,k,m,q,r,s,t,u,v,w;for(s=f("tr,td,th,tbody,thead,tfoot,table"),q=o.getNonEmptyElements(),r=o.getWhiteSpaceElements(),t=o.getTextBlockElements(),u=o.getSpecialElements(),c=0;c<a.length;c++)if((d=a[c]).parent&&!d.fixed)if(t[d.name]&&"li"==d.parent.name){for(v=d.next;v&&t[v.name];)v.name="li",v.fixed=!0,d.parent.insert(v,d.parent),v=v.next;d.unwrap(d)}else{for(g=[d],e=d.parent;e&&!o.isValidChild(e.name,d.name)&&!s[e.name];e=e.parent)g.push(e);if(e&&g.length>1){for(g.reverse(),h=i=p.filterNode(g[0].clone()),m=0;m<g.length-1;m++){for(o.isValidChild(i.name,g[m].name)?(j=p.filterNode(g[m].clone()),i.append(j)):j=i,k=g[m].firstChild;k&&k!=g[m+1];)w=k.next,j.append(k),k=w;i=j}n(o,q,r,h)?e.insert(d,g[0],!0):(e.insert(h,g[0],!0),e.insert(d,h)),e=g[0],(n(o,q,r,e)||l(e,"br"))&&e.empty().remove()}else if(d.parent){if("li"===d.name){if((v=d.prev)&&("ul"===v.name||"ul"===v.name)){v.append(d);continue}if((v=d.next)&&("ul"===v.name||"ul"===v.name)){v.insert(d,v.firstChild,!0);continue}d.wrap(p.filterNode(new b("ul",1)));continue}o.isValidChild(d.parent.name,"div")&&o.isValidChild("div",d.name)?d.wrap(p.filterNode(new b("div",1))):u[d.name]?d.empty().remove():d.unwrap()}}};p.filterNode=function(a){var b,c,d;c in q&&((d=s[c])?d.push(a):s[c]=[a]),b=r.length;for(;b--;)(c=r[b].name)in a.attributes.map&&((d=t[c])?d.push(a):t[c]=[a]);return a},p.addNodeFilter=function(a,b){g(h(a),function(a){var c=q[a];c||(q[a]=c=[]),c.push(b)})},p.addAttributeFilter=function(a,b){g(h(a),function(a){var c;for(c=0;c<r.length;c++)if(r[c].name===a)return void r[c].callbacks.push(b);r.push({name:a,callbacks:[b]})})},p.parse=function(a,d){var e,g,h,l,p,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L=[];d=d||{},s={},t={},B=i(f("script,style,head,html,body,title,meta,param"),o.getBlockElements()),J=o.getNonEmptyElements(),I=o.children,A=m.validate,K="forced_root_block"in d?d.forced_root_block:m.forced_root_block,H=o.getWhiteSpaceElements(),C=/^[ \t\r\n]+/,E=/[ \t\r\n]+$/,F=/[ \t\r\n]+/g,G=/^[ \t\r\n]+$/;var N=function(a,c){var d,e=new b(a,c);return a in q&&((d=s[a])?d.push(e):s[a]=[e]),e},O=function(a){var b,c,d,e,f=o.getBlockElements();for(b=a.prev;b&&3===b.type;){if((d=b.value.replace(E,"")).length>0)return void(b.value=d);if(c=b.next){if(3==c.type&&c.value.length){b=b.prev;continue}if(!f[c.name]&&"script"!=c.name&&"style"!=c.name){b=b.prev;continue}}e=b.prev,b.remove(),b=e}};if(e=new c({validate:A,allow_script_urls:m.allow_script_urls,allow_conditional_comments:m.allow_conditional_comments,self_closing_elements:function(a){var b,c={};for(b in a)"li"!==b&&"p"!=b&&(c[b]=a[b]);return c}(o.getSelfClosingElements()),cdata:function(a){h.append(N("#cdata",4)).value=a},text:function(a,b){var c;D||(a=a.replace(F," "),h.lastChild&&B[h.lastChild.name]&&(a=a.replace(C,""))),0!==a.length&&(c=N("#text",3),c.raw=!!b,h.append(c).value=a)},comment:function(a){h.append(N("#comment",8)).value=a},pi:function(a,b){h.append(N(a,7)).value=b,O(h)},doctype:function(a){h.append(N("#doctype",10)).value=a,O(h)},start:function(a,b,c){var d,e,f,g,i;if(f=A?o.getElementRule(a):{}){for((d=N(f.outputName||a,1)).attributes=b,d.shortEnded=c,h.append(d),(i=I[h.name])&&I[d.name]&&!i[d.name]&&L.push(d),e=r.length;e--;)(g=r[e].name)in b.map&&((y=t[g])?y.push(d):t[g]=[d]);B[a]&&O(d),c||(h=d),!D&&H[a]&&(D=!0)}},end:function(a){var b,c,e,f,g;if(c=A?o.getElementRule(a):{}){if(B[a]&&!D){if((b=h.firstChild)&&3===b.type)if((e=b.value.replace(C,"")).length>0)b.value=e,b=b.next;else for(f=b.next,b.remove(),b=f;b&&3===b.type;)e=b.value,f=b.next,(0===e.length||G.test(e))&&(b.remove(),b=f),b=f;if((b=h.lastChild)&&3===b.type)if((e=b.value.replace(E,"")).length>0)b.value=e,b=b.prev;else for(f=b.prev,b.remove(),b=f;b&&3===b.type;)e=b.value,f=b.prev,(0===e.length||G.test(e))&&(b.remove(),b=f),b=f}if(D&&H[a]&&(D=!1),c.removeEmpty&&n(o,J,H,h)&&!h.attributes.map.name&&!h.attributes.map.id)return g=h.parent,B[h.name]?h.empty().remove():h.unwrap(),void(h=g);c.paddEmpty&&(k(h)||n(o,J,H,h))&&j(m,d,B,h),h=h.parent}}},o),g=h=new b(d.context||m.root_name,11),e.parse(a),A&&L.length&&(d.context?d.invalid=!0:u(L)),K&&("body"==g.name||d.isRootContent)&&function(){var a,b,c=g.firstChild,d=function(a){a&&((c=a.firstChild)&&3==c.type&&(c.value=c.value.replace(C,"")),(c=a.lastChild)&&3==c.type&&(c.value=c.value.replace(E,"")))};if(o.isValidChild(g.name,K.toLowerCase())){for(;c;)a=c.next,3==c.type||1==c.type&&"p"!==c.name&&!B[c.name]&&!c.attr("data-mce-type")?b?b.append(c):((b=N(K,1)).attr(m.forced_root_block_attrs),g.insert(b,c),b.append(c)):(d(b),b=null),c=a;d(b)}}(),!d.invalid){for(z in s){for(y=q[z],w=(l=s[z]).length;w--;)l[w].parent||l.splice(w,1);for(p=0,v=y.length;p<v;p++)y[p](l,z,d)}for(p=0,v=r.length;p<v;p++)if((y=r[p]).name in t){for(w=(l=t[y.name]).length;w--;)l[w].parent||l.splice(w,1);for(w=0,x=y.callbacks.length;w<x;w++)y.callbacks[w](l,y.name,d)}}return g},m.remove_trailing_brs&&p.addNodeFilter("br",function(a,c,d){var e,f,g,h,k,l,p,q,r=a.length,s=i({},o.getBlockElements()),t=o.getNonEmptyElements(),u=o.getNonEmptyElements();for(s.body=1,e=0;e<r;e++)if(f=a[e],g=f.parent,s[f.parent.name]&&f===g.lastChild){for(k=f.prev;k;){if("span"!==(l=k.name)||"bookmark"!==k.attr("data-mce-type")){if("br"!==l)break;if("br"===l){f=null;break}}k=k.prev}f&&(f.remove(),n(o,t,u,g)&&(p=o.getElementRule(g.name))&&(p.removeEmpty?g.remove():p.paddEmpty&&j(m,d,s,g)))}else{for(h=f;g&&g.firstChild===h&&g.lastChild===h&&(h=g,!s[g.name]);)g=g.parent;h===g&&!0!==m.padd_empty_with_br&&(q=new b("#text",3),q.value=" ",f.replace(q))}}),p.addAttributeFilter("href",function(a){var b,c=a.length,f=function(a){var b=a?e.trim(a):"";return/\b(noopener)\b/g.test(b)?b:function(a){return a.split(" ").filter(function(a){return a.length>0}).concat(["noopener"]).sort().join(" ")}(b)};if(!m.allow_unsafe_link_target)for(;c--;)"a"===(b=a[c]).name&&"_blank"===b.attr("target")&&b.attr("rel",f(b.attr("rel")))}),m.allow_html_in_named_anchor||p.addAttributeFilter("id,name",function(a){for(var b,c,d,e,f=a.length;f--;)if("a"===(e=a[f]).name&&e.firstChild&&!e.attr("href")){d=e.parent,b=e.lastChild;do{c=b.prev,d.insert(b,e),b=c}while(b)}}),m.fix_list_elements&&p.addNodeFilter("ul,ol",function(a){for(var c,d,e=a.length;e--;)if(c=a[e],"ul"===(d=c.parent).name||"ol"===d.name)if(c.prev&&"li"===c.prev.name)c.prev.append(c);else{var f=new b("li",1);f.attr("style","list-style-type: none"),c.wrap(f)}}),m.validate&&o.getValidClasses()&&p.addAttributeFilter("class",function(a){for(var b,c,d,e,f,g,h,i=a.length,j=o.getValidClasses();i--;){for(c=(b=a[i]).attr("class").split(" "),f="",d=0;d<c.length;d++)e=c[d],h=!1,(g=j["*"])&&g[e]&&(h=!0),g=j[b.name],!h&&g&&g[e]&&(h=!0),h&&(f&&(f+=" "),f+=e);f.length||(f=null),b.attr("class",f)}}),a.register(this,m)}}),g("2y",["1","4t","4u","m","4v","4w","u","y","z","4b","1e"],function(a,b,c,d,e,f,g,h,i,j,k){var l=function(a,b,c){-1===k.inArray(b,c)&&(a.addAttributeFilter(c,function(a,b){for(var c=a.length;c--;)a[c].attr(b,null)}),b.push(c))},m=function(a,d,e){if(!d.no_events&&a){return c.firePostProcess(a,b.merge(d,{content:e})).content}return e},n=function(a,b,c){var d=j.trim(c.getInner?b.innerHTML:a.getOuterHTML(b));return c.selection?d:k.trim(d)},o=function(a,c,d,f){var g=f.selection?b.merge({forced_root_block:!1},f):f,h=a.parse(d,g);return e.trimTrailingBr(h),h},q=function(a,b,c,d,e){var f=function(a,b,c){return new i(a,b).serialize(c)}(b,c,d);return m(a,e,f)};return function(c,i){var j,k,m,p=["data-mce-selected"];j=i&&i.dom?i.dom:d.DOM,k=i&&i.schema?i.schema:new h(c),c.entity_encoding=c.entity_encoding||"named",c.remove_trailing_brs=!("remove_trailing_brs"in c)||c.remove_trailing_brs,m=new g(c,k),e.register(m,c,j);return{schema:k,addNodeFilter:m.addNodeFilter,addAttributeFilter:m.addAttributeFilter,serialize:function(a,d){var e=b.merge({format:"html"},d||{}),g=f.process(i,a,e),h=n(j,g,e),l=o(m,0,h,e);return"tree"===e.format?l:q(i,c,k,l,e)},addRules:function(a){k.addValidElements(a)},setRules:function(a){k.setValidElements(a)},addTempAttr:a.curry(l,m,p),getTempAttrs:function(){return p}}}}),g("k",["2y"],function(a){return function(b,c){var d=new a(b,c);return{schema:d.schema,addNodeFilter:d.addNodeFilter,addAttributeFilter:d.addAttributeFilter,serialize:d.serialize,addRules:d.addRules,setRules:d.setRules,addTempAttr:d.addTempAttr,getTempAttrs:d.getTempAttrs}}}),g("6m",["1","1v","62","46"],function(a,b,c,d){var e=function(d){return c.descendant(b.fromDom(d.getBody()),"*[data-mce-caret]").fold(a.constant(null),function(a){return a.dom()})},g=function(a,b){b.hasAttribute("data-mce-caret")&&(d.showCaretContainerBlock(b),function(a){a.selection.setRng(a.selection.getRng())}(a),a.selection.scrollIntoView(b))},h=function(a,b){var c=e(a);if(c)return"compositionstart"===b.type?(b.preventDefault(),b.stopPropagation(),void g(c)):void(d.hasContent(c)&&g(a,c))};return{setup:function(b){b.on("keyup compositionstart",a.curry(h,b))}}}),g("i",["1","2r"],function(a,b){var c=function(c){return{getBookmark:a.curry(b.getBookmark,c),moveToBookmark:a.curry(b.moveToBookmark,c)}};return c.isBookmarkNode=b.isBookmarkNode,c}),g("l",["1","1v","2z","1j","1y","30","b","15","1e","1g"],function(a,b,c,d,e,f,g,h,i,j){var k=e.isContentEditableFalse,l=e.isContentEditableTrue,m=function(a,b){for(;b&&b!=a;){if(l(b)||k(b))return b;b=b.parentNode}return null};return function(a,e){var l,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e.dom,E=i.each,F=e.getDoc(),G=d,H=Math.abs,I=Math.round,J=e.getBody();p={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};var K=".mce-content-body";e.contentStyles.push(K+" div.mce-resizehandle {position: absolute;border: 1px solid black;box-sizing: content-box;background: #FFF;width: 7px;height: 7px;z-index: 10000}"+K+" .mce-resizehandle:hover {background: #000}"+K+" img[data-mce-selected],"+K+" hr[data-mce-selected] {outline: 1px solid black;resize: none}"+K+" .mce-clonedresizable {position: absolute;"+(g.gecko?"":"outline: 1px dashed black;")+"opacity: .5;filter: alpha(opacity=50);z-index: 10000}"+K+" .mce-resize-helper {background: #555;background: rgba(0,0,0,0.75);border-radius: 3px;border: 1px;color: white;display: none;font-family: sans-serif;font-size: 12px;white-space: nowrap;line-height: 14px;margin: 5px 10px;padding: 5px;position: absolute;z-index: 10001}");var L=function(a){return a&&("IMG"===a.nodeName||e.dom.is(a,"figure.image"))},N=function(a){var b=a.target;(function(a,b){return L(a.target)&&!f.isXYWithinRange(a.clientX,a.clientY,b)})(a,e.selection.getRng())&&!a.isDefaultPrevented()&&(a.preventDefault(),e.selection.select(b))},O=function(a){return e.dom.is(a,"figure.image")?a.querySelector("img"):a},P=function(a){var d=e.settings.object_resizing;return!1!==d&&!g.iOS&&("string"!=typeof d&&(d="table,img,figure.image,div"),"false"!==a.getAttribute("data-mce-resize")&&a!=e.getBody()&&c.is(b.fromDom(a),d))},Q=function(a){var b,c,f,g;b=a.screenX-r,c=a.screenY-s,z=b*q[2]+v,A=c*q[3]+w,z=z<5?5:z,A=A<5?5:A,(L(l)&&!1!==e.settings.resize_img_proportional?!j.modifierPressed(a):j.modifierPressed(a)||L(l)&&q[2]*q[3]!=0)&&(H(b)>H(c)?(A=I(z*x),z=I(A/x)):(z=I(A/x),A=I(z*x))),D.setStyles(O(n),{width:z,height:A}),f=q.startPos.x+b,g=q.startPos.y+c,f=f>0?f:0,g=g>0?g:0,D.setStyles(o,{left:f,top:g,display:"block"}),o.innerHTML=z+" &times; "+A,q[2]<0&&n.clientWidth<=z&&D.setStyle(n,"left",t+(v-z)),q[3]<0&&n.clientHeight<=A&&D.setStyle(n,"top",u+(w-A)),(b=J.scrollWidth-B)+(c=J.scrollHeight-C)!=0&&D.setStyles(o,{left:f-b,top:g-c}),y||(e.fire("ObjectResizeStart",{target:l,width:v,height:w}),y=!0)},R=function(){y=!1;var a=function(a,b){b&&(l.style[a]||!e.schema.isValid(l.nodeName.toLowerCase(),a)?D.setStyle(O(l),a,b):D.setAttrib(O(l),a,b))};a("width",z),a("height",A),D.unbind(F,"mousemove",Q),D.unbind(F,"mouseup",R),G!=F&&(D.unbind(G,"mousemove",Q),D.unbind(G,"mouseup",R)),D.remove(n),D.remove(o),S(l),e.fire("ObjectResized",{target:l,width:z,height:A}),D.setAttrib(l,"style",D.getAttrib(l,"style")),e.nodeChanged()},S=function(a){var b,c,d,f,h;T(),W(),b=D.getPos(a,J),t=b.x,u=b.y,h=a.getBoundingClientRect(),c=h.width||h.right-h.left,d=h.height||h.bottom-h.top,l!=a&&(l=a,z=A=0),f=e.fire("ObjectSelected",{target:a}),P(a)&&!f.isDefaultPrevented()?E(p,function(a,b){var e,f=function(b){r=b.screenX,s=b.screenY,v=O(l).clientWidth,w=O(l).clientHeight,x=w/v,q=a,a.startPos={x:c*a[0]+t,y:d*a[1]+u},B=J.scrollWidth,C=J.scrollHeight,n=l.cloneNode(!0),D.addClass(n,"mce-clonedresizable"),D.setAttrib(n,"data-mce-bogus","all"),n.contentEditable=!1,n.unSelectabe=!0,D.setStyles(n,{left:t,top:u,margin:0}),n.removeAttribute("data-mce-selected"),J.appendChild(n),D.bind(F,"mousemove",Q),D.bind(F,"mouseup",R),G!=F&&(D.bind(G,"mousemove",Q),D.bind(G,"mouseup",R)),o=D.add(J,"div",{class:"mce-resize-helper","data-mce-bogus":"all"},v+" &times; "+w)};(e=D.get("mceResizeHandle"+b))&&D.remove(e),e=D.add(J,"div",{id:"mceResizeHandle"+b,"data-mce-bogus":"all",class:"mce-resizehandle",unselectable:!0,style:"cursor:"+b+"-resize; margin:0; padding:0"}),g.ie&&(e.contentEditable=!1),D.bind(e,"mousedown",function(a){a.stopImmediatePropagation(),a.preventDefault(),f(a)}),a.elm=e,D.setStyles(e,{left:c*a[0]+t-e.offsetWidth/2,top:d*a[1]+u-e.offsetHeight/2})}):T(),l.setAttribute("data-mce-selected","1")},T=function(){var a,b;W(),l&&l.removeAttribute("data-mce-selected");for(a in p)(b=D.get("mceResizeHandle"+a))&&(D.unbind(b),D.remove(b))},U=function(b){var c,d,f=function(a,b){if(a)do{if(a===b)return!0}while(a=a.parentNode)};if(!y&&!e.removed)return E(D.select("img[data-mce-selected],hr[data-mce-selected]"),function(a){a.removeAttribute("data-mce-selected")}),d="mousedown"==b.type?b.target:a.getNode(),d=D.$(d).closest("table,img,figure.image,hr")[0],f(d,J)&&(X(),c=a.getStart(!0),f(c,d)&&f(a.getEnd(!0),d))?void S(d):void T()},V=function(a){return k(m(e.getBody(),a))},W=function(){for(var a in p){var b=p[a];b.elm&&(D.unbind(b.elm),delete b.elm)}},X=function(){try{e.getDoc().execCommand("enableObjectResizing",!1,!1)}catch(a){}};e.on("init",function(){X(),g.ie&&g.ie>=11&&(e.on("mousedown click",function(a){var b=a.target,c=b.nodeName;y||!/^(TABLE|IMG|HR)$/.test(c)||V(b)||(2!==a.button&&e.selection.select(b,"TABLE"==c),"mousedown"==a.type&&e.nodeChanged())}),e.dom.bind(J,"mscontrolselect",function(a){var b=function(a){h.setEditorTimeout(e,function(){e.selection.select(a)})};return V(a.target)?(a.preventDefault(),void b(a.target)):void(/^(TABLE|IMG|HR)$/.test(a.target.nodeName)&&(a.preventDefault(),"IMG"==a.target.tagName&&b(a.target)))}));var a=h.throttle(function(a){e.composing||U(a)});e.on("nodechange ResizeEditor ResizeWindow drop",a),e.on("keyup compositionend",function(b){l&&"TABLE"==l.nodeName&&a(b)}),e.on("hide blur",T),e.on("contextmenu",N)}),e.on("remove",W);return{isResizable:P,showResizeRect:S,hideResizeRect:T,updateResizeRect:U,destroy:function(){l=n=null}}}}),g("33",["1y"],function(a){var b=function(a){for(var b=0,c=0,d=a;d&&d.nodeType;)b+=d.offsetLeft||0,c+=d.offsetTop||0,d=d.offsetParent;return{x:b,y:c}};return{scrollIntoView:function(d,e,f){var g,h,i,j,k=d.dom,l=k.getRoot(),m=0;if(!function(a,b,c){var d={elm:e,alignToTop:f};return a.fire("scrollIntoView",d),d.isDefaultPrevented()}(d)&&a.isElement(e)){if(!1===f&&(m=e.offsetHeight),"BODY"!==l.nodeName){var n=d.selection.getScrollContainer();if(n)return g=b(e).y-b(n).y+m,j=n.clientHeight,i=n.scrollTop,void((g<i||g+25>i+j)&&(n.scrollTop=g<i?g:g-j+25))}h=k.getViewPort(d.getWin()),g=k.getPos(e).y+m,i=h.y,j=h.h,(g<h.y||g+25>i+j)&&d.getWin().scrollTo(0,g<i?g:g-j+25)}}}}),g("2s",["1y","1e"],function(a,b){var c=function(b){return a.isContentEditableTrue(b)||a.isContentEditableFalse(b)},e=function(a,c,d){var e,f,g;if(e=d.elementFromPoint(a,c),f=d.body.createTextRange(),e&&"HTML"!==e.tagName||(e=d.body),f.moveToElementText(e),g=b.toArray(f.getClientRects()),(g=g.sort(function(a,b){return a=Math.abs(Math.max(a.top-c,a.bottom-c)),b=Math.abs(Math.max(b.top-c,b.bottom-c)),a-b})).length>0){c=(g[0].bottom+g[0].top)/2;try{return f.moveToPoint(a,c),f.collapse(!0),f}catch(a){}}return null},f=function(b,e){var f=b&&b.parentElement?b.parentElement():null;return a.isContentEditableFalse(function(a,b,c){for(;a&&a!==b;){if(c(a))return a;a=a.parentNode}return null}(f,e,c))?null:b};return{fromPoint:function(a,b,c){var d,g;if(c.caretPositionFromPoint)(g=c.caretPositionFromPoint(a,b))&&((d=c.createRange()).setStart(g.offsetNode,g.offset),d.collapse(!0));else if(c.caretRangeFromPoint)d=c.caretRangeFromPoint(a,b);else if(c.body.createTextRange){d=c.body.createTextRange();try{d.moveToPoint(a,b),d.collapse(!0)}catch(f){d=e(a,b,c)}return f(d,c.body)}return d}}}),g("34",["1i"],function(a){return{processRanges:function(b,c){return a.map(c,function(a){var c=b.fire("GetSelectionRange",{range:a});return c.range!==a?c.range:a})}}}),g("60",["48","1v","41","5d","47","3h"],function(a,b,c,d,e,f){var g=function(a,c){return b.fromDom(a.dom().cloneNode(c))},i=function(a){return g(a,!0)},j=function(c,d){var e=b.fromTag(d),f=a.clone(c);return a.setAll(e,f),e};return{shallow:function(a){return g(a,!1)},shallowAs:j,deep:i,copy:function(a,b){var c=j(a,b),e=f.children(i(a));return d.append(c,e),c},mutate:function(a,b){var g=j(a,b);c.before(a,g);var h=f.children(a);return d.append(g,h),e.remove(a),g}}}),g("61",["1i","1v","1j"],function(a,b,c){return{fromElements:function(d,e){var g=(e||c).createDocumentFragment();return a.each(d,function(a){g.appendChild(a.dom())}),b.fromDom(g)}}}),g("63",["1i","1","2n","5c","31","1v","3f","3h","1y"],function(a,b,c,d,e,f,g,h,i){var j=function(a){var b=a.startContainer,d=a.startOffset;return i.isText(b)?0===d?c.some(f.fromDom(b)):c.none():c.from(b.childNodes[d]).map(f.fromDom)},k=function(a){var b=a.endContainer,d=a.endOffset;return i.isText(b)?d===b.data.length?c.some(f.fromDom(b)):c.none():c.from(b.childNodes[d-1]).map(f.fromDom)},l=function(a){return h.firstChild(a).fold(b.constant([a]),function(b){return[a].concat(l(b))})},m=function(a){return h.lastChild(a).fold(b.constant([a]),function(b){return"br"===g.name(b)?h.prevSibling(b).map(function(b){return[a].concat(m(b))}).getOr([]):[a].concat(m(b))})};return{hasAllContentsSelected:function(c,f){return d.liftN([j(f),k(f)],function(d,f){var g=a.find(l(c),b.curry(e.eq,d)),h=a.find(m(c),b.curry(e.eq,f));return g.isSome()&&h.isSome()}).getOr(!1)}}}),g("64",["1i","2n","45","31","41","5d","60","1v","48","5f"],function(a,b,c,d,e,f,g,h,i,j){var k=c.immutable("element","width","rows"),l=c.immutable("element","cells"),m=c.immutable("x","y"),n=function(a,b){var c=parseInt(i.get(a,b),10);return isNaN(c)?1:c},p=function(a,b,c){var d=a.rows();return!!(d[c]?d[c].cells():[])[b]},r=function(b){return a.foldl(b,function(a,b){return b.cells().length>a?b.cells().length:a},0)},s=function(a,c){for(var e=a.rows(),f=0;f<e.length;f++)for(var g=e[f].cells(),h=0;h<g.length;h++)if(d.eq(g[h],c))return b.some(m(h,f));return b.none()},t=function(a,b,c,d,e){for(var f=[],g=a.rows(),h=c;h<=e;h++){var i=g[h].cells(),j=b<d?i.slice(b,d+1):i.slice(d,b+1);f.push(l(g[h].element(),j))}return f},w=function(b){return a.map(b.rows(),function(b){var c=a.map(b.cells(),function(a){var b=g.deep(a);return i.remove(b,"colspan"),i.remove(b,"rowspan"),b}),d=g.shallow(b.element());return f.append(d,c),d})};return{fromDom:function(b){var c=k(g.shallow(b),0,[]);return a.each(j.descendants(b,"tr"),function(b,d){a.each(j.descendants(b,"td,th"),function(a,e){!function(a,b,c,d,e){for(var f=n(e,"rowspan"),h=n(e,"colspan"),i=a.rows(),j=c;j<c+f;j++){i[j]||(i[j]=l(g.deep(d),[]));for(var k=b;k<b+h;k++)i[j].cells()[k]=j==c&&k==b?e:g.shallow(e)}}(c,function(a,b,c){for(;p(a,b,c);)b++;return b}(c,e,d),d,b,a)})}),k(c.element(),r(c.rows()),c.rows())},toDom:function(a){return function(a,b){var c=g.shallow(a.element()),d=h.fromTag("tbody");return f.append(d,b),e.append(c,d),c}(a,w(a))},subsection:function(a,b,c){return s(a,b).bind(function(b){return s(a,c).map(function(c){return function(a,b,c){var d=b.x(),e=b.y(),f=c.x(),g=c.y(),h=e<g?t(a,d,e,f,g):t(a,d,g,f,e);return k(a.element(),r(h),h)}(a,b,c)})})}}}),g("4x",["1i","1","31","41","60","1v","61","3f","62","3h","3l","5s","63","64","5t"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=function(b){return a.find(b,function(a){return"ul"===h.name(a)||"ol"===h.name(a)})},q=function(c,d){return a.find(c,function(a){return"li"===h.name(a)&&m.hasAllContentsSelected(a,d)}).fold(b.constant([]),function(a){return p(c).map(function(a){return[f.fromTag("li"),f.fromTag(h.name(a))]}).getOr([])})},r=function(b,c){var e=a.foldl(c,function(a,b){return d.append(b,a),b},b);return c.length>0?g.fromElements([e]):e},s=function(a){return k.isListItem(a)?j.parent(a).filter(k.isList).fold(b.constant([]),function(b){return[a,b]}):k.isList(a)?[a]:[]},t=function(b,c){var d=f.fromDom(c.commonAncestorContainer),g=l.parentsAndSelf(d,b),h=a.filter(g,function(a){return k.isInline(a)||k.isHeading(a)}),i=q(g,c),j=h.concat(i.length?i:s(d));return a.map(j,e.shallow)},u=function(){return g.fromElements([])},w=function(a,d){return i.ancestor(d,"table",b.curry(c.eq,a))},y=function(a,b){return b.length>0&&b[0].collapsed?u():function(a,b){return r(f.fromDom(b.cloneContents()),t(a,b))}(a,b[0])};return{read:function(a,b){var c=o.getCellsFromElementOrRanges(b,a);return c.length>0?function(a,b){return w(a,b[0]).bind(function(a){var c=b[0],d=b[b.length-1],e=n.fromDom(a);return n.subsection(e,c,d).map(function(a){return g.fromElements([n.toDom(a)])})}).getOrThunk(u)}(a,c):y(a,b)}}}),g("35",["1v","34","4x","36","4b"],function(a,b,c,d,e){return{getContent:function(f,g){var h,i=f.selection.getRng(),j=f.dom.create("body"),k=f.selection.getSel(),l=b.processRanges(f,d.getRanges(k));if(g=g||{},g.get=!0,g.format=g.format||"html",g.selection=!0,(g=f.fire("BeforeGetContent",g)).isDefaultPrevented())return f.fire("GetContent",g),g.content;if("text"===g.format)return f.selection.isCollapsed()?"":e.trim(i.text||(k.toString?k.toString():""));i.cloneContents?(h=g.contextual?c.read(a.fromDom(f.getBody()),l).dom():i.cloneContents())&&j.appendChild(h):void 0!==i.item||void 0!==i.htmlText?(j.innerHTML="<br>"+(i.item?i.item(0).outerHTML:i.htmlText),j.removeChild(j.firstChild)):j.innerHTML=i.toString(),g.getInner=!0;var m=f.selection.serializer.serialize(j,g);return"tree"===g.format?m:(g.content=f.selection.isCollapsed()?"":m,f.fire("GetContent",g),g.content)}}}),g("37",[],function(){return{setContent:function(a,b,c){var d,e,f,g=a.selection.getRng(),h=a.getDoc();if(c=c||{format:"html"},c.set=!0,c.selection=!0,c.content=b,c.no_events||!(c=a.fire("BeforeSetContent",c)).isDefaultPrevented()){if(b=c.content,g.insertNode){b+='<span id="__caret">_</span>',g.startContainer==h&&g.endContainer==h?h.body.innerHTML=b:(g.deleteContents(),0===h.body.childNodes.length?h.body.innerHTML=b:g.createContextualFragment?g.insertNode(g.createContextualFragment(b)):(e=h.createDocumentFragment(),f=h.createElement("div"),e.appendChild(f),f.outerHTML=b,g.insertNode(e))),d=a.dom.get("__caret"),(g=h.createRange()).setStartBefore(d),g.setEndBefore(d),a.selection.setRng(g),a.dom.remove("__caret");try{a.selection.setRng(g)}catch(a){}}else g.item&&(h.execCommand("Delete",!1,null),g=a.getRng()),/^\s+/.test(b)?(g.pasteHTML('<span id="__mce_tmp">_</span>'+b),a.dom.remove("__mce_tmp")):g.pasteHTML(b);c.no_events||a.fire("SetContent",c)}else a.fire("SetContent",c)}}}),g("q",["31","1v","b","i","32","l","33","s","24","2s","34","35","36","2t","20","37","1e"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=q.each,s=q.trim,t=function(c){return!(!c||!c.ownerDocument)&&a.contains(b.fromDom(c.ownerDocument),b.fromDom(c))},v=function(a,b,c,e){var g=this;g.dom=a,g.win=b,g.serializer=c,g.editor=e,g.bookmarkManager=new d(g),g.controlSelection=new f(g,e)};return v.prototype={setCursorLocation:function(a,b){var c=this,d=c.dom.createRng();a?(d.setStart(a,b),d.setEnd(a,b),c.setRng(d),c.collapse(!1)):(c._moveEndPoint(d,c.editor.getBody(),!0),c.setRng(d))},getContent:function(a){return l.getContent(this.editor,a)},setContent:function(a,b){p.setContent(this.editor,a,b)},getStart:function(a){var b,d=this.getRng();return 1==(b=d.startContainer).nodeType&&b.hasChildNodes()&&(a&&d.collapsed||(b=b.childNodes[Math.min(b.childNodes.length-1,d.startOffset)])),b&&3==b.nodeType?b.parentNode:b},getEnd:function(a){var b,c,e=this.getRng();return b=e.endContainer,c=e.endOffset,1==b.nodeType&&b.hasChildNodes()&&(a&&e.collapsed||(b=b.childNodes[c>0?c-1:c])),b&&3==b.nodeType?b.parentNode:b},getBookmark:function(a,b){return this.bookmarkManager.getBookmark(a,b)},moveToBookmark:function(a){return this.bookmarkManager.moveToBookmark(a)},select:function(a,b){var c,d=this,e=d.dom,f=e.createRng();return a&&(c=e.nodeIndex(a),f.setStart(a.parentNode,c),f.setEnd(a.parentNode,c+1),b&&(d._moveEndPoint(f,a,!0),d._moveEndPoint(f,a)),d.setRng(f)),a},isCollapsed:function(){var b=this.getRng(),c=this.getSel();return!(!b||b.item)&&(b.compareEndPoints?0===b.compareEndPoints("StartToEnd",b):!c||b.collapsed)},collapse:function(a){var c=this.getRng();c.collapse(!!a),this.setRng(c)},getSel:function(){var a=this.win;return a.getSelection?a.getSelection():a.document.selection},getRng:function(a){var b,c,d,e,f=this,g=function(a,b,c){try{return b.compareBoundaryPoints(a,c)}catch(a){return-1}};if(!f.win)return null;if(void 0===(e=f.win.document)||null===e)return null;if(void 0!==f.editor.bookmark&&!1===i.hasFocus(f.editor)){var h=o.getRng(f.editor);if(h.isSome())return h.getOr(e.createRange())}try{(b=f.getSel())&&(c=b.rangeCount>0?b.getRangeAt(0):b.createRange?b.createRange():e.createRange())}catch(a){}return(c=k.processRanges(f.editor,[c])[0])||(c=e.createRange?e.createRange():e.body.createTextRange()),c.setStart&&9===c.startContainer.nodeType&&c.collapsed&&(d=f.dom.getRoot(),c.setStart(d,0),c.setEnd(d,0)),f.selectedRange&&f.explicitRange&&(0===g(c.START_TO_START,c,f.selectedRange)&&0===g(c.END_TO_END,c,f.selectedRange)?c=f.explicitRange:(f.selectedRange=null,f.explicitRange=null)),c},setRng:function(a,b){var d,e,f,g=this;if(function(a){return!!a&&(!!a.select||t(a.startContainer)&&t(a.endContainer))}(a))if(a.select){g.explicitRange=null;try{a.select()}catch(a){}}else{if(d=g.getSel(),f=g.editor.fire("SetSelectionRange",{range:a,forward:b}),a=f.range,d){g.explicitRange=a;try{d.removeAllRanges(),d.addRange(a)}catch(a){}!1===b&&d.extend&&(d.collapse(a.endContainer,a.endOffset),d.extend(a.startContainer,a.startOffset)),g.selectedRange=d.rangeCount>0?d.getRangeAt(0):null}a.collapsed||a.startContainer!==a.endContainer||!d.setBaseAndExtent||c.ie||a.endOffset-a.startOffset<2&&a.startContainer.hasChildNodes()&&(e=a.startContainer.childNodes[a.startOffset])&&"IMG"===e.tagName&&(d.setBaseAndExtent(a.startContainer,a.startOffset,a.endContainer,a.endOffset),d.anchorNode===a.startContainer&&d.focusNode===a.endContainer||d.setBaseAndExtent(e,0,e,1)),g.editor.fire("AfterSetSelectionRange",{range:a,forward:b})}},setNode:function(a){return this.setContent(this.dom.getOuterHTML(a)),a},getNode:function(){var a,b,c,d,e,g=this.getRng(),h=this.dom.getRoot(),i=function(a,b){for(var c=a;a&&3===a.nodeType&&0===a.length;)a=b?a.nextSibling:a.previousSibling;return a||c};return g?(b=g.startContainer,c=g.endContainer,d=g.startOffset,e=g.endOffset,a=g.commonAncestorContainer,!g.collapsed&&(b==c&&e-d<2&&b.hasChildNodes()&&(a=b.childNodes[d]),3===b.nodeType&&3===c.nodeType&&(b=b.length===d?i(b.nextSibling,!0):b.parentNode,c=0===e?i(c.previousSibling,!1):c.parentNode,b&&b===c))?b:a&&3==a.nodeType?a.parentNode:a):h},getSelectedBlocks:function(a,b){var c,d,e=this,f=e.dom,g=[];if(d=f.getRoot(),a=f.getParent(a||e.getStart(),f.isBlock),b=f.getParent(b||e.getEnd(),f.isBlock),a&&a!=d&&g.push(a),a&&b&&a!=b){c=a;for(var i=new h(a,d);(c=i.next())&&c!=b;)f.isBlock(c)&&g.push(c)}return b&&a!=b&&b!=d&&g.push(b),g},isForward:function(){var a,b,c=this.dom,d=this.getSel();return!(d&&d.anchorNode&&d.focusNode)||((a=c.createRng()).setStart(d.anchorNode,d.anchorOffset),a.collapse(!0),(b=c.createRng()).setStart(d.focusNode,d.focusOffset),b.collapse(!0),a.compareBoundaryPoints(a.START_TO_START,b)<=0)},normalize:function(){var a=this,b=a.getRng();if(!m.hasMultipleRanges(a.getSel())){var c=n.normalize(a.dom,b);return c.each(function(b){a.setRng(b,a.isForward())}),c.getOr(b)}return b},selectorChanged:function(a,b){var c,d=this;return d.selectorChangedData||(d.selectorChangedData={},c={},d.editor.on("NodeChange",function(a){var b=a.element,e=d.dom,f=e.getParents(b,null,e.getRoot()),g={};r(d.selectorChangedData,function(a,b){r(f,function(d){if(e.is(d,b))return c[b]||(r(a,function(a){a(!0,{node:d,selector:b,parents:f})}),c[b]=a),g[b]=a,!1})}),r(c,function(a,d){g[d]||(delete c[d],r(a,function(a){a(!1,{node:b,selector:d,parents:f})}))})})),d.selectorChangedData[a]||(d.selectorChangedData[a]=[]),d.selectorChangedData[a].push(b),d},getScrollContainer:function(){for(var a,b=this.dom.getRoot();b&&"BODY"!=b.nodeName;){if(b.scrollHeight>b.clientHeight){a=b;break}b=b.parentNode}return a},scrollIntoView:function(a,b){g.scrollIntoView(this.editor,a,b)},placeCaretAt:function(a,b){this.setRng(j.fromPoint(a,b,this.editor.getDoc()))},_moveEndPoint:function(a,b,d){var e=b,f=new h(b,e),g=this.dom.schema.getNonEmptyElements();do{if(3==b.nodeType&&0!==s(b.nodeValue).length)return void(d?a.setStart(b,0):a.setEnd(b,b.nodeValue.length));if(g[b.nodeName]&&!/^(TD|TH)$/.test(b.nodeName))return void(d?a.setStartBefore(b):"BR"==b.nodeName?a.setEndBefore(b):a.setEndAfter(b));if(c.ie&&c.ie<11&&this.dom.isBlock(b)&&this.dom.isEmpty(b))return void(d?a.setStart(b,0):a.setEnd(b,0))}while(b=d?f.next():f.prev());"BODY"==e.nodeName&&(d?a.setStart(e,0):a.setEnd(e,e.childNodes.length))},getBoundingClientRect:function(){var a=this.getRng();return a.collapsed?e.fromRangeStart(a).getClientRects()[0]:a.getBoundingClientRect()},destroy:function(){this.win=null,this.controlSelection.destroy()}},v}),g("7h",["3q","1r","77","3n","5b","3r","32","3o"],function(a,b,c,d,e,f,g,h){var i=a.curry,j=function(a,b,c,f){for(;f=e.findNode(f,a,d.isEditableCaretCandidate,b);)if(c(f))return},k=function(a,d,e,f,g,h){var i,k,l=0,m=[],n=function(f){var h,i,j;for(j=c.getClientRects(f),-1==a&&(j=j.reverse()),h=0;h<j.length;h++)if(i=j[h],!e(i,k)){if(m.length>0&&d(i,b.last(m))&&l++,i.line=l,g(i))return!0;m.push(i)}};return(k=b.last(h.getClientRects()))?(i=h.getNode(),n(i),j(a,f,n,i),m):m};return{upUntil:i(k,-1,h.isAbove,h.isBelow),downUntil:i(k,1,h.isBelow,h.isAbove),positionsUntil:function(a,c,d,e){var i,j,k,l,m,n,o=new f(c),p=[],q=0,r=function(c){return b.last(c.getClientRects())};1==a?(i=o.next,j=h.isBelow,k=h.isAbove,l=g.after(e)):(i=o.prev,j=h.isAbove,k=h.isBelow,l=g.before(e)),n=r(l);do{if(l.isVisible()&&(m=r(l),!k(m,n))){if(p.length>0&&j(m,b.last(p))&&q++,m=h.clone(m),m.position=l,m.line=q,d(m))return p;p.push(m)}}while(l=i(l));return p},isAboveLine:i(function(a,b){return b.line>a}),isLine:i(function(a,b){return b.line===a})}}),g("78",["b","46","32","5b","3r","6x","7h","1y","6z","2v","1r","3q"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=h.isContentEditableFalse,n=j.getSelectedNode,o=d.isAfterContentEditableFalse,p=d.isBeforeContentEditableFalse,q=function(a,b){for(;b=a(b);)if(b.isVisible())return b;return b},r=function(a,b){var c=d.isInSameBlock(a,b);return!(c||!h.isBr(a.getNode()))||c},s=function(a){return b.isCaretContainerBlock(a.startContainer)},t=function(a,b,e){return e=d.normalizeRange(a,b,e),-1===a?c.fromRangeStart(e):c.fromRangeEnd(e)},u=function(a,b,c,d,e){var f,g,h,j;return!e.collapsed&&(f=n(e),m(f))?i.showCaret(a,b,f,-1===a):(j=s(e),g=t(a,b.getBody(),e),d(g)?i.selectNode(b,g.getNode(-1===a)):(g=c(g))?d(g)?i.showCaret(a,b,g.getNode(-1===a),1===a):(h=c(g),d(h)&&r(g,h)?i.showCaret(a,b,h.getNode(-1===a),1===a):j?i.renderRangeCaret(b,g.toRange()):null):j?e:null)},v=function(a,b,c,d){var e,h,j,l,q,r,s,u,v;if(v=n(d),e=t(a,b.getBody(),d),h=c(b.getBody(),g.isAboveLine(1),e),j=k.filter(h,g.isLine(1)),q=k.last(e.getClientRects()),p(e)&&(v=e.getNode()),o(e)&&(v=e.getNode(!0)),!q)return null;if(r=q.left,(l=f.findClosestClientRect(j,r))&&m(l.node))return s=Math.abs(r-l.left),u=Math.abs(r-l.right),i.showCaret(a,b,l.node,s<u);if(v){var w=g.positionsUntil(a,b.getBody(),g.isAboveLine(1),v);if(l=f.findClosestClientRect(k.filter(w,g.isLine(1)),r))return i.renderRangeCaret(b,l.position.toRange());if(l=k.last(k.filter(w,g.isLine(0))))return i.renderRangeCaret(b,l.position.toRange())}},w=function(b){var c=b.dom.create(b.settings.forced_root_block);return(!a.ie||a.ie>=11)&&(c.innerHTML='<br data-mce-bogus="1">'),c},x=function(a,b,d){var f,h,i=new e(a.getBody()),j=l.curry(q,i.next),k=l.curry(q,i.prev);if(d.collapsed&&a.settings.forced_root_block){if(!(f=a.dom.getParent(d.startContainer,"PRE")))return;(1===b?j(c.fromRangeStart(d)):k(c.fromRangeStart(d)))||(h=w(a),1===b?a.$(f).after(h):a.$(f).before(h),a.selection.select(h,!0),a.selection.collapse())}};return{moveH:function(a,b){return function(){var c=function(a,b){var c,d=new e(a.getBody()),f=l.curry(q,d.next),g=l.curry(q,d.prev),h=b?1:-1,i=b?f:g,j=b?p:o,k=a.selection.getRng();return(c=u(h,a,i,j,k))?c:(c=x(a,h,k))||null}(a,b);return!!c&&(a.selection.setRng(c),!0)}},moveV:function(a,b){return function(){var c=function(a,b){var c,d=b?1:-1,e=b?g.downUntil:g.upUntil,f=a.selection.getRng();return(c=v(d,a,e,f))?c:(c=x(a,d,f))||null}(a,b);return!!c&&(a.selection.setRng(c),!0)}}}}),g("79",["1i","1","4t"],function(a,b,c){var d=function(d){return a.map(d,function(a){return c.merge({shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1,keyCode:0,action:b.noop},a)})},f=function(b,c){return a.bind(d(b),function(a){return function(a,b){return b.keyCode===a.keyCode&&b.shiftKey===a.shiftKey&&b.altKey===a.altKey&&b.ctrlKey===a.ctrlKey&&b.metaKey===a.metaKey}(a,c)?[a]:[]})};return{match:f,action:function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}},execute:function(b,c){return a.find(f(b,c),function(a){return a.action()})}}}),g("70",["3d","5p","78","79","1g"],function(a,b,c,d,e){var f=function(f,g,h){var i=a.detect().os;d.execute([{keyCode:e.RIGHT,action:c.moveH(f,!0)},{keyCode:e.LEFT,action:c.moveH(f,!1)},{keyCode:e.UP,action:c.moveV(f,!1)},{keyCode:e.DOWN,action:c.moveV(f,!0)},{keyCode:e.RIGHT,action:b.move(f,g,!0)},{keyCode:e.LEFT,action:b.move(f,g,!1)},{keyCode:e.RIGHT,ctrlKey:!i.isOSX(),altKey:i.isOSX(),action:b.moveNextWord(f,g)},{keyCode:e.LEFT,ctrlKey:!i.isOSX(),altKey:i.isOSX(),action:b.movePrevWord(f,g)}],h).each(function(a){h.preventDefault()})};return{setup:function(a,b){a.on("keydown",function(c){!1===c.isDefaultPrevented()&&f(a,b,c)})}}}),g("7a",["1i","1","1v","3h","32","5l","3y","3l","5s","2f"],function(a,b,c,d,e,f,g,h,i,j){var k=function(c,d){var e=i.parentsAndSelf(d,c);return a.findIndex(e,h.isBlock).fold(b.constant(e),function(a){return e.slice(0,a)})},l=function(a){return 1===d.children(a).length},m=function(c,d,e,g){var h=b.curry(j.isFormatElement,d),i=a.map(a.filter(g,h),function(a){return a.dom()});if(0===i.length)f.deleteElement(d,c,e);else{var k=j.replaceWithCaretFormat(e.dom(),i);d.selection.setRng(k.toRange())}},n=function(b,d){var f=c.fromDom(b.getBody()),h=c.fromDom(b.selection.getStart()),i=a.filter(k(f,h),l);return a.last(i).map(function(a){var c=e.fromRangeStart(b.selection.getRng());return!!g.willDeleteLastPositionInElement(d,c,a.dom())&&(m(d,b,a,i),!0)}).getOr(!1)};return{backspaceDelete:function(a,b){return!!a.selection.isCollapsed()&&n(a,b)}}}),g("71",["3v","3w","3x","3z","7a","40","79","1g"],function(a,b,c,d,e,f,g,h){var i=function(i,j,k){g.execute([{keyCode:h.BACKSPACE,action:g.action(c.backspaceDelete,i,!1)},{keyCode:h.DELETE,action:g.action(c.backspaceDelete,i,!0)},{keyCode:h.BACKSPACE,action:g.action(d.backspaceDelete,i,j,!1)},{keyCode:h.DELETE,action:g.action(d.backspaceDelete,i,j,!0)},{keyCode:h.BACKSPACE,action:g.action(b.backspaceDelete,i,!1)},{keyCode:h.DELETE,action:g.action(b.backspaceDelete,i,!0)},{keyCode:h.BACKSPACE,action:g.action(a.backspaceDelete,i,!1)},{keyCode:h.DELETE,action:g.action(a.backspaceDelete,i,!0)},{keyCode:h.BACKSPACE,action:g.action(f.backspaceDelete,i,!1)},{keyCode:h.DELETE,action:g.action(f.backspaceDelete,i,!0)},{keyCode:h.BACKSPACE,action:g.action(e.backspaceDelete,i,!1)},{keyCode:h.DELETE,action:g.action(e.backspaceDelete,i,!0)}],k).each(function(a){k.preventDefault()})};return{setup:function(a,b){a.on("keydown",function(c){!1===c.isDefaultPrevented()&&i(a,b,c)}),a.on("keyup",function(b){!1===b.isDefaultPrevented()&&function(a,b){g.execute([{keyCode:h.BACKSPACE,action:g.action(c.paddEmptyElement,a)},{keyCode:h.DELETE,action:g.action(c.paddEmptyElement,a)}],b)}(a,b)})}}}),g("6p",[],function(){var a=function(a,b,c){var d=a.getParam(b,c);if(-1!==d.indexOf("=")){var e=a.getParam(b,"","hash");return e.hasOwnProperty(a.id)?e[a.id]:c}return d};return{getIframeAttrs:function(a){return a.getParam("iframe_attrs",{})},getDocType:function(a){return a.getParam("doctype","<!DOCTYPE html>")},getDocumentBaseUrl:function(a){return a.getParam("document_base_url","")},getBodyId:function(b){return a(b,"body_id","tinymce")},getBodyClass:function(b){return a(b,"body_class","")},getContentSecurityPolicy:function(a){return a.getParam("content_security_policy","")},shouldPutBrInPre:function(a){return a.getParam("br_in_pre",!0)},getForcedRootBlock:function(a){if(a.getParam("force_p_newlines",!1))return"p";var b=a.getParam("forced_root_block","p");return!1===b?"":b},getForcedRootBlockAttrs:function(a){return a.getParam("forced_root_block_attrs",{})},getBrNewLineSelector:function(a){return a.getParam("br_newline_selector",".mce-toc h2,figcaption,caption")},getNoNewLineSelector:function(a){return a.getParam("no_newline_selector","")},shouldKeepStyles:function(a){return a.getParam("keep_styles",!0)},shouldEndContainerOnEmtpyBlock:function(a){return a.getParam("end_container_on_empty_block",!1)}}}),g("7l",["1","2n","1v","3l","1y","s"],function(a,b,c,d,e,f){var j=function(a){return b.from(a.dom.getParent(a.selection.getStart(!0),a.dom.isBlock))};return{moveToCaretPosition:function(a,b){var c,d,h,j=b,k=a.dom,l=a.schema.getMoveCaretBeforeOnEnterElements();if(b){if(/^(LI|DT|DD)$/.test(b.nodeName)){var m=function(a){for(;a;){if(1===a.nodeType||3===a.nodeType&&a.data&&/[\r\n\s]/.test(a.data))return a;a=a.nextSibling}}(b.firstChild);m&&/^(UL|OL|DL)$/.test(m.nodeName)&&b.insertBefore(k.doc.createTextNode(" "),b.firstChild)}if(h=k.createRng(),b.normalize(),b.hasChildNodes()){for(c=new f(b,b);d=c.current();){if(e.isText(d)){h.setStart(d,0),h.setEnd(d,0);break}if(l[d.nodeName.toLowerCase()]){h.setStartBefore(d),h.setEndBefore(d);break}j=d,d=c.next()}d||(h.setStart(j,0),h.setEnd(j,0))}else e.isBr(b)?b.nextSibling&&k.isBlock(b.nextSibling)?(h.setStartBefore(b),h.setEndBefore(b)):(h.setStartAfter(b),h.setEndAfter(b)):(h.setStart(b,0),h.setEnd(b,0));a.selection.setRng(h),k.remove(void 0),a.selection.scrollIntoView(b)}},getEditableRoot:function(a,b){var c,d,e=a.getRoot();for(c=b;c!==e&&"false"!==a.getContentEditable(c);)"true"===a.getContentEditable(c)&&(d=c),c=c.parentNode;return c!==e?d:e},getParentBlock:j,getParentBlockName:function(b){return j(b).fold(a.constant(""),function(a){return a.nodeName.toUpperCase()})},isListItemParentBlock:function(a){return j(a).filter(function(a){return d.isListItem(c.fromDom(a))}).isSome()}}}),g("7k",["1y","7l"],function(a,b){var d=function(a,b){return a&&a.parentNode&&a.parentNode.nodeName===b},e=function(a){return a&&/^(OL|UL|LI)$/.test(a.nodeName)},f=function(a){return e(a)&&e(a.parentNode)},g=function(a){var b=a.parentNode;return/^(LI|DT|DD)$/.test(b.nodeName)?b:a},h=function(b,c,d){for(var e=b[d?"firstChild":"lastChild"];e&&!a.isElement(e);)e=e[d?"nextSibling":"previousSibling"];return e===c};return{insert:function(a,e,i,j,k){var l=a.dom,m=a.selection.getRng();if(i!==a.getBody()){f(i)&&(k="LI");var n=k?e(k):l.create("BR");if(h(i,j,!0)&&h(i,j,!1))d(i,"LI")?l.insertAfter(n,g(i)):l.replace(n,i);else if(h(i,j,!0))d(i,"LI")?(l.insertAfter(n,g(i)),n.appendChild(l.doc.createTextNode(" ")),n.appendChild(i)):i.parentNode.insertBefore(n,i);else if(h(i,j,!1))l.insertAfter(n,g(i));else{i=g(i);var o=m.cloneRange();o.setStartAfter(j),o.setEndAfter(i);var p=o.extractContents();"LI"===k&&function(a,b){return a.firstChild&&a.firstChild.nodeName===b}(p,"LI")?(n=p.firstChild,l.insertAfter(p,i)):(l.insertAfter(p,i),l.insertAfter(n,i))}l.remove(j),b.moveToCaretPosition(a,n)}}}}),g("7i",["6p","46","1y","s","2f","7k","7l","2t","4b","1e"],function(a,b,c,d,e,f,g,h,i,j){var k=function(a){return a&&"A"===a.nodeName&&0===j.trim(i.trim(a.innerText||a.textContent)).length},m=function(a){a.innerHTML='<br data-mce-bogus="1">'},n=function(a,b){return a.nodeName===b||a.previousSibling&&a.previousSibling.nodeName===b},o=function(a,b){return b&&a.isBlock(b)&&!/^(TD|TH|CAPTION|FORM)$/.test(b.nodeName)&&!/^(fixed|absolute)/i.test(b.style.position)&&"true"!==a.getContentEditable(b)},p=function(a,b,d){var e,f=d,g=[];if(f){for(;f=f.firstChild;){if(a.isBlock(f))return;c.isElement(f)&&!b[f.nodeName.toLowerCase()]&&g.push(f)}for(e=g.length;e--;)!(f=g[e]).hasChildNodes()||f.firstChild===f.lastChild&&""===f.firstChild.nodeValue?a.remove(f):k(f)&&a.remove(f)}},q=function(a,b,d){return!1===c.isText(b)?d:a?1===d&&b.data.charAt(d-1)===i.ZWSP?0:d:d===b.data.length-1&&b.data.charAt(d)===i.ZWSP?b.data.length:d},t=function(a,b){var c,d,e=a.getRoot();for(c=b;c!==e&&"false"!==a.getContentEditable(c);)"true"===a.getContentEditable(c)&&(d=c),c=c.parentNode;return c!==e?d:e},u=function(b,c){var d=a.getForcedRootBlock(b);d&&d.toLowerCase()===c.tagName.toLowerCase()&&b.dom.setAttribs(c,a.getForcedRootBlockAttrs(b))};return{insert:function(i,j){var k,l,x,y,z,A,B,C,D,E,F,G,H,I=i.dom,J=i.schema,K=J.getNonEmptyElements(),L=i.selection.getRng(),M=function(b){var c,d,f,g=x,h=J.getTextInlineElements();if(b||"TABLE"===E||"HR"===E?(c=I.create(b||G),u(i,c)):c=z.cloneNode(!1),f=c,!1===a.shouldKeepStyles(i))I.setAttrib(c,"style",null),I.setAttrib(c,"class",null);else do{if(h[g.nodeName]){if(e.isCaretNode(g))continue;d=g.cloneNode(!1),I.setAttrib(d,"id",""),c.hasChildNodes()?(d.appendChild(c.firstChild),c.appendChild(d)):(f=d,c.appendChild(d))}}while((g=g.parentNode)&&g!==l);return m(f),c},N=function(a){var b,e,f,g;if(g=q(a,x,y),c.isText(x)&&(a?g>0:g<x.nodeValue.length))return!1;if(x.parentNode===z&&H&&!a)return!0;if(a&&c.isElement(x)&&x===z.firstChild)return!0;if(n(x,"TABLE")||n(x,"HR"))return H&&!a||!H&&a;for(b=new d(x,z),c.isText(x)&&(a&&0===g?b.prev():a||g!==x.nodeValue.length||b.next());e=b.current();){if(c.isElement(e)){if(!e.getAttribute("data-mce-bogus")&&(f=e.nodeName.toLowerCase(),K[f]&&"br"!==f))return!1}else if(c.isText(e)&&!/^[ \t\r\n]*$/.test(e.nodeValue))return!1;a?b.prev():b.next()}return!0},O=function(){B=/^(H[1-6]|PRE|FIGURE)$/.test(E)&&"HGROUP"!==F?M(G):M(),a.shouldEndContainerOnEmtpyBlock(i)&&o(I,D)&&I.isEmpty(z)?B=I.split(D,z):I.insertAfter(B,z),g.moveToCaretPosition(i,B)};if(h.normalize(I,L).each(function(a){L.setStart(a.startContainer,a.startOffset),L.setEnd(a.endContainer,a.endOffset)}),x=L.startContainer,y=L.startOffset,G=a.getForcedRootBlock(i),A=j.shiftKey,c.isElement(x)&&x.hasChildNodes()&&(H=y>x.childNodes.length-1,x=x.childNodes[Math.min(y,x.childNodes.length-1)]||x,y=H&&c.isText(x)?x.nodeValue.length:0),l=t(I,x))return(G&&!A||!G&&A)&&(x=function(a,b,c,d,e){var f,g,h,i,j,k,m=G||"P",n=a.dom,p=t(n,d);if(!(g=n.getParent(d,n.isBlock))||!o(n,g)){if(g=g||p,k=g===a.getBody()||g&&/^(TD|TH|CAPTION)$/.test(g.nodeName)?g.nodeName.toLowerCase():g.parentNode.nodeName.toLowerCase(),!g.hasChildNodes())return f=n.create(m),u(a,f),g.appendChild(f),c.setStart(f,0),c.setEnd(f,0),f;for(i=d;i.parentNode!==g;)i=i.parentNode;for(;i&&!n.isBlock(i);)h=i,i=i.previousSibling;if(h&&a.schema.isValidChild(k,m.toLowerCase())){for(f=n.create(m),u(a,f),h.parentNode.insertBefore(f,h),i=h;i&&!n.isBlock(i);)j=i.nextSibling,f.appendChild(i),i=j;c.setStart(d,e),c.setEnd(d,e)}}return d}(i,0,L,x,y)),z=I.getParent(x,I.isBlock),D=z?I.getParent(z.parentNode,I.isBlock):null,E=z?z.nodeName.toUpperCase():"","LI"!==(F=D?D.nodeName.toUpperCase():"")||j.ctrlKey||(z=D,D=D.parentNode,E=F),/^(LI|DT|DD)$/.test(E)&&I.isEmpty(z)?void f.insert(i,M,D,z,G):void(G&&z===i.getBody()||(G=G||"P",b.isCaretContainerBlock(z)?(B=b.showCaretContainerBlock(z),I.isEmpty(z)&&m(z),g.moveToCaretPosition(i,B)):N()?O():N(!0)?(B=z.parentNode.insertBefore(M(),z),g.moveToCaretPosition(i,n(z,"HR")?B:z)):((k=function(a){var b=a.cloneRange();return b.setStart(a.startContainer,q(!0,a.startContainer,a.startOffset)),b.setEnd(a.endContainer,q(!1,a.endContainer,a.endOffset)),b}(L).cloneRange()).setEndAfter(z),C=k.extractContents(),function(a){do{c.isText(a)&&(a.nodeValue=a.nodeValue.replace(/^[\r\n]+/,"")),a=a.firstChild}while(a)}(C),B=C.firstChild,I.insertAfter(C,z),p(I,K,B),function(a,b){var c;b.normalize(),(c=b.lastChild)&&!/^(left|right)$/gi.test(a.getStyle(c,"float",!0))||a.add(b,"br")}(I,z),I.isEmpty(z)&&m(z),B.normalize(),I.isEmpty(B)?(I.remove(B),O()):g.moveToCaretPosition(i,B)),I.setAttrib(B,"id",""),i.fire("NewBlock",{newBlock:B})))}}}),g("7m",["1v","2z","6p","7l"],function(a,b,c,d){var e=function(c,e){return d.getParentBlock(c).filter(function(c){return e.length>0&&b.is(a.fromDom(c),e)}).isSome()};return{shouldInsertBr:function(a){return e(a,c.getBrNewLineSelector(a))},shouldBlockNewLine:function(a){return e(a,c.getNoNewLineSelector(a))}}}),g("7j",["5n","1i","2n","6p","7m","7l","5o"],function(a,b,c,d,e,f,g){var h=a.generate([{br:[]},{block:[]},{none:[]}]),i=function(a,b){return e.shouldBlockNewLine(a)},j=function(a){return function(b,c){return""===d.getForcedRootBlock(b)===a}},k=function(a){return function(b,c){return f.isListItemParentBlock(b)===a}},l=function(a){return function(b,c){return"PRE"===f.getParentBlockName(b)===a}},m=function(a){return function(b,c){return d.shouldPutBrInPre(b)===a}},n=function(a,b){return e.shouldInsertBr(a)},o=function(a,b){return b},p=function(a){var b=d.getForcedRootBlock(a),c=f.getEditableRoot(a.dom,a.selection.getStart());return c&&a.schema.isValidChild(c.nodeName,b||"P")},q=function(a,d){return function(e,f){return b.foldl(a,function(a,b){return a&&b(e,f)},!0)?c.some(d):c.none()}};return{getAction:function(a,b){return g.evaluateUntil([q([i],h.none()),q([l(!0),m(!1),o],h.br()),q([l(!0),m(!1)],h.block()),q([l(!0),m(!0),o],h.block()),q([l(!0),m(!0)],h.br()),q([k(!0),o],h.br()),q([k(!0)],h.block()),q([j(!0),o,p],h.block()),q([j(!0)],h.br()),q([n],h.br()),q([j(!1),o],h.br()),q([p],h.block())],[a,b.shiftKey]).getOr(h.none())}}}),g("7b",["1","7i","1z","7j"],function(a,b,c,d){return{insert:function(e,f){d.getAction(e,f).fold(function(){c.insert(e,f)},function(){b.insert(e,f)},a.noop)}}}),g("72",["7b","1g"],function(a,b){var d=function(b,d){d.isDefaultPrevented()||(d.preventDefault(),function(a){a.typing&&(a.typing=!1,a.add())}(b.undoManager),b.undoManager.transact(function(){!1===b.selection.isCollapsed()&&b.execCommand("Delete"),a.insert(b,d)}))};return{setup:function(a){a.on("keydown",function(c){c.keyCode===b.ENTER&&d(a,c)})}}}),g("7c",["1","32","1y","43","44"],function(a,b,c,d,e){var f=function(a,b){return j(a)&&c.isText(b.container())},h=function(a,b,c){return!!f(c,b)&&(function(a,b){var c=b.container(),d=b.offset();c.insertData(d," "),a.selection.setCursorLocation(c,d+1)}(a,b),!0)},i=function(c){var f=a.curry(e.isInlineTarget,c),g=b.fromRangeStart(c.selection.getRng());return d.readLocation(f,c.getBody(),g).map(a.curry(h,c,g)).getOr(!1)},j=function(b){return b.fold(a.constant(!1),a.constant(!0),a.constant(!0),a.constant(!1))};return{insertAtSelection:function(a){return!!a.selection.isCollapsed()&&i(a)}}}),g("73",["7c","79","1g"],function(a,b,c){var d=function(d,e){b.execute([{keyCode:c.SPACEBAR,action:b.action(a.insertAtSelection,d)}],e).each(function(a){e.preventDefault()})};return{setup:function(a){a.on("keydown",function(b){!1===b.isDefaultPrevented()&&d(a,b)})}}}),g("6n",["70","5p","71","72","73"],function(a,b,c,d,e){return{setup:function(f){var g=b.setupSelectedState(f);a.setup(f,g),c.setup(f,g),d.setup(f),e.setup(f)}}}),g("6o",["1j","2","b","46","2s","15","1e","1g"],function(a,b,c,d,e,f,g,h){return function(i){var j=g.each,k=h.BACKSPACE,l=h.DELETE,m=i.dom,n=i.selection,o=i.settings,p=i.parser,q=c.gecko,r=c.ie,s=c.webkit,t="data:text/mce-internal,",u=r?"Text":"URL",v=function(a,b){try{i.getDoc().execCommand(a,!1,b)}catch(a){}},w=function(a){return a.isDefaultPrevented()},B=function(){i.shortcuts.add("meta+a",null,"SelectAll")},H=function(){i.on("keydown",function(a){if(!w(a)&&a.keyCode===k&&n.isCollapsed()&&0===n.getRng(!0).startOffset){var b=n.getNode().previousSibling;if(b&&b.nodeName&&"table"===b.nodeName.toLowerCase())return a.preventDefault(),!1}})},P=function(){i.inline||(i.contentStyles.push("body {min-height: 150px}"),i.on("click",function(a){var b;if("HTML"==a.target.nodeName){if(c.ie>11)return void i.getBody().focus();b=i.selection.getRng(),i.getBody().focus(),i.selection.setRng(b),i.selection.normalize(),i.nodeChanged()}}))},W=function(){};return i.on("keydown",function(a){var b,c,d,e,f;if(!w(a)&&a.keyCode==h.BACKSPACE&&(b=n.getRng(),c=b.startContainer,d=b.startOffset,e=m.getRoot(),f=c,b.collapsed&&0===d)){for(;f&&f.parentNode&&f.parentNode.firstChild==f&&f.parentNode!=e;)f=f.parentNode;"BLOCKQUOTE"===f.tagName&&(i.formatter.toggle("blockquote",null,f),(b=m.createRng()).setStart(c,0),b.setEnd(c,0),n.setRng(b))}}),function(){var a=function(a){var b=m.create("body"),c=a.cloneContents();return b.appendChild(c),n.serializer.serialize(b,{format:"html"})},b=function(b){var c=a(b),d=m.createRng();return d.selectNode(i.getBody()),c===a(d)};i.on("keydown",function(a){var c,d,e=a.keyCode;if(!w(a)&&(e==l||e==k)){if(c=i.selection.isCollapsed(),d=i.getBody(),c&&!m.isEmpty(d))return;if(!c&&!b(i.selection.getRng()))return;a.preventDefault(),i.setContent(""),d.firstChild&&m.isBlock(d.firstChild)?i.selection.setCursorLocation(d.firstChild,0):i.selection.setCursorLocation(d,0),i.nodeChanged()}})}(),c.windowsPhone||i.on("keyup focusin mouseup",function(a){h.modifierPressed(a)||n.normalize()},!0),s&&(i.settings.content_editable||m.bind(i.getDoc(),"mousedown mouseup",function(a){var b;if(a.target==i.getDoc().documentElement)if(b=n.getRng(),i.getBody().focus(),"mousedown"==a.type){if(d.isCaretContainer(b.startContainer))return;n.placeCaretAt(a.clientX,a.clientY)}else n.setRng(b)}),i.on("click",function(a){var b=a.target;/^(IMG|HR)$/.test(b.nodeName)&&"false"!==m.getContentEditableParent(b)&&(a.preventDefault(),i.selection.select(b),i.nodeChanged()),"A"==b.nodeName&&m.hasClass(b,"mce-item-anchor")&&(a.preventDefault(),n.select(b))}),o.forced_root_block&&i.on("init",function(){v("DefaultParagraphSeparator",o.forced_root_block)}),i.on("init",function(){i.dom.bind(i.getBody(),"submit",function(a){a.preventDefault()})}),H(),p.addNodeFilter("br",function(a){for(var b=a.length;b--;)"Apple-interchange-newline"==a[b].attr("class")&&a[b].remove()}),c.iOS?(i.inline||i.on("keydown",function(){a.activeElement==a.body&&i.getWin().focus()}),P(),i.on("click",function(a){var b=a.target;do{if("A"===b.tagName)return void a.preventDefault()}while(b=b.parentNode)}),i.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}")):B()),c.ie>=11&&(P(),H()),c.ie&&(B(),v("AutoUrlDetect",!1),i.on("dragstart",function(a){!function(a){var b,c;a.dataTransfer&&(i.selection.isCollapsed()&&"IMG"==a.target.tagName&&n.select(a.target),(b=i.selection.getContent()).length>0&&(c=t+escape(i.id)+","+escape(b),a.dataTransfer.setData(u,c)))}(a)}),i.on("drop",function(a){if(!w(a)){var b=function(a){var b;return a.dataTransfer&&(b=a.dataTransfer.getData(u))&&b.indexOf(t)>=0?(b=b.substr(t.length).split(","),{id:unescape(b[0]),html:unescape(b[1])}):null}(a);if(b&&b.id!=i.id){a.preventDefault();var c=e.fromPoint(a.x,a.y,i.getDoc());n.setRng(c),function(a,b){i.queryCommandSupported("mceInsertClipboardContent")?i.execCommand("mceInsertClipboardContent",!1,{content:a,internal:b}):i.execCommand("mceInsertContent",!1,a)}(b.html,!0)}}})),q&&(i.on("keydown",function(a){if(!w(a)&&a.keyCode===k){if(!i.getBody().getElementsByTagName("hr").length)return;if(n.isCollapsed()&&0===n.getRng(!0).startOffset){var b=n.getNode(),c=b.previousSibling;if("HR"==b.nodeName)return m.remove(b),void a.preventDefault();c&&c.nodeName&&"hr"===c.nodeName.toLowerCase()&&(m.remove(c),a.preventDefault())}}}),b.Range.prototype.getClientRects||i.on("mousedown",function(a){if(!w(a)&&"HTML"===a.target.nodeName){var b=i.getBody();b.blur(),f.setEditorTimeout(i,function(){b.focus()})}}),function(){var a=function(){var a=m.getAttribs(n.getStart().cloneNode(!1));return function(){var b=n.getStart();b!==i.getBody()&&(m.setAttrib(b,"style",null),j(a,function(a){b.setAttributeNode(a.cloneNode(!0))}))}},b=function(){return!n.isCollapsed()&&m.getParent(n.getStart(),m.isBlock)!=m.getParent(n.getEnd(),m.isBlock)};i.on("keypress",function(c){var d;if(!w(c)&&(8==c.keyCode||46==c.keyCode)&&b())return d=a(),i.getDoc().execCommand("delete",!1,null),d(),c.preventDefault(),!1}),m.bind(i.getDoc(),"cut",function(c){var d;!w(c)&&b()&&(d=a(),f.setEditorTimeout(i,function(){d()}))})}(),o.readonly||i.on("BeforeExecCommand MouseDown",function(){W(),v("StyleWithCSS",!1),v("enableInlineTableEditing",!1),o.object_resizing||v("enableObjectResizing",!1)}),i.on("SetContent ExecCommand",function(b){"setcontent"!=b.type&&"mceInsertLink"!==b.command||j(m.select("a"),function(a){var b=a.parentNode,c=m.getRoot();if(b.lastChild===a){for(;b&&!m.isBlock(b);){if(b.parentNode.lastChild!==b||b===c)return;b=b.parentNode}m.add(b,"br",{"data-mce-bogus":1})}})}),i.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}"),c.mac&&i.on("keydown",function(a){!h.metaKeyPressed(a)||a.shiftKey||37!=a.keyCode&&39!=a.keyCode||(a.preventDefault(),i.selection.getSel().modify("move",37==a.keyCode?"backward":"forward","lineboundary"))}),H()),{refreshContentEditable:W,isHidden:function(){var a;return!q||i.removed?0:!(a=i.selection.getSel())||!a.rangeCount||0===a.rangeCount}}}}),g("5w",["41","1v","48","1j","2","6i","6j","6k","6l","d","f","k","6m","m","q","u","w","y","6n","15","6o","1e"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=n.DOM,x=function(d,e){var f=b.fromDom(d.getDoc().head),g=b.fromTag("style");c.set(g,"type","text/css"),a.append(g,b.fromText(e)),a.append(f,g)},y=function(a){var b=new p(a.settings,a.schema);return b.addAttributeFilter("src,href,style,tabindex",function(b,c){for(var d,e,f,g=b.length,h=a.dom;g--;)if(d=b[g],e=d.attr(c),f="data-mce-"+c,!d.attributes.map[f]){if(0===e.indexOf("data:")||0===e.indexOf("blob:"))continue;"style"===c?((e=h.serializeStyle(h.parseStyle(e),d.name)).length||(e=null),d.attr(f,e),d.attr(c,e)):"tabindex"===c?(d.attr(f,e),d.attr(c,null)):d.attr(f,a.convertURL(e,c,d.name))}}),b.addNodeFilter("script",function(a){for(var b,c,d=a.length;d--;)b=a[d],0!==(c=b.attr("type")||"no/type").indexOf("mce-")&&b.attr("type","mce-"+c)}),b.addNodeFilter("#cdata",function(a){for(var b,c=a.length;c--;)b=a[c],b.type=8,b.name="#comment",b.value="[CDATA["+b.value+"]]"}),b.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",function(b){for(var c,d=b.length,e=a.schema.getNonEmptyElements();d--;)(c=b[d]).isEmpty(e)&&0===c.getAll("br").length&&(c.append(new q("br",1)).shortEnded=!0)}),b},A=function(a){a.bindPendingEventDelegates(),a.initialized=!0,a.fire("init"),a.focus(!0),a.nodeChanged({initial:!0}),a.execCallback("init_instance_callback",a),function(a){a.settings.auto_focus&&t.setEditorTimeout(a,function(){var b;(b=!0===a.settings.auto_focus?a:a.editorManager.get(a.settings.auto_focus)).destroyed||b.focus()},100)}(a)};return{initContentBody:function(a,b){var c,p,q=a.settings,t=a.getElement(),z=a.getDoc();q.inline||(a.getElement().style.visibility=a.orgVisibility),b||q.content_editable||(z.open(),z.write(a.iframeHTML),z.close()),q.content_editable&&(a.on("remove",function(){var a=this.getBody();w.removeClass(a,"mce-content-body"),w.removeClass(a,"mce-edit-focus"),w.setAttrib(a,"contentEditable",null)}),w.addClass(t,"mce-content-body"),a.contentDocument=z=q.content_document||d,a.contentWindow=q.content_window||e,a.bodyElement=t,q.content_document=q.content_window=null,q.root_name=t.nodeName.toLowerCase()),(c=a.getBody()).disabled=!0,a.readonly=q.readonly,a.readonly||(a.inline&&"static"===w.getStyle(c,"position",!0)&&(c.style.position="relative"),c.contentEditable=a.getParam("content_editable_state",!0)),c.disabled=!1,a.editorUpload=new f(a),a.schema=new r(q),a.dom=new n(z,{keep_values:!0,url_converter:a.convertURL,url_converter_scope:a,hex_colors:q.force_hex_style_colors,class_filter:q.class_filter,update_styles:!0,root_element:a.inline?a.getBody():null,collect:q.content_editable,schema:a.schema,onSetAttrib:function(b){a.fire("SetAttrib",b)}}),a.parser=y(a),a.serializer=new l(q,a),a.selection=new o(a.dom,a.getWin(),a.serializer,a),a.formatter=new k(a),a.undoManager=new j(a),a._nodeChangeDispatcher=new h(a),a._selectionOverrides=new i(a),m.setup(a),s.setup(a),g.setup(a),a.fire("PreInit"),q.browser_spellcheck||q.gecko_spellcheck||(z.body.spellcheck=!1,w.setAttrib(c,"spellcheck","false")),a.quirks=new u(a),a.fire("PostRender"),q.directionality&&(c.dir=q.directionality),q.nowrap&&(c.style.whiteSpace="nowrap"),q.protect&&a.on("BeforeSetContent",function(a){v.each(q.protect,function(b){a.content=a.content.replace(b,function(a){return"\x3c!--mce:protected "+escape(a)+"--\x3e"})})}),a.on("SetContent",function(){a.addVisual(a.getBody())}),q.padd_empty_editor&&a.on("PostProcess",function(a){a.content=a.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|<br \/>|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/,"")}),a.load({initial:!0,format:"html"}),a.startContent=a.getContent({format:"raw"}),a.on("compositionstart compositionend",function(b){a.composing="compositionstart"===b.type}),a.contentStyles.length>0&&(p="",v.each(a.contentStyles,function(a){p+=a+"\r\n"}),a.dom.addStyle(p)),function(a){return a.inline?w.styleSheetLoader:a.dom.styleSheetLoader}(a).loadAll(a.contentCSS,function(b){A(a)},function(b){A(a)}),q.content_style&&x(a,q.content_style)}}}),g("5x",["1v","48","3g","1j","2","b","6p","m","5w","27"],function(a,b,c,d,e,f,g,h,i,j){var k=h.DOM,l=function(a,b){if(d.domain!==e.location.hostname&&f.ie&&f.ie<12){var c=j.uuid("mce");a[c]=function(){i.initContentBody(a)};var g='javascript:(function(){document.open();document.domain="'+d.domain+'";var ed = window.parent.tinymce.get("'+a.id+'");document.write(ed.iframeHTML);document.close();ed.'+c+"(true);})()";return k.setAttrib(b,"src",g),!0}return!1},n=function(d,e,f,g){var h=a.fromTag("iframe");return b.setAll(h,g),b.setAll(h,{id:d+"_ifr",frameBorder:"0",allowTransparency:"true",title:e}),c.setAll(h,{width:"100%",height:function(a){var b="number"==typeof a?a+"px":a;return b||""}(f),display:"block"}),h},p=function(a,b){var c=a.editorManager.translate("Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help"),d=n(a.id,c,b.height,g.getIframeAttrs(a)).dom();d.onload=function(){d.onload=null,a.fire("load")};var e=l(a,d);return a.contentAreaContainer=b.iframeContainer,a.iframeElement=d,a.iframeHTML=function(a){var b,c,d;return d=g.getDocType(a)+"<html><head>",g.getDocumentBaseUrl(a)!==a.documentBaseUrl&&(d+='<base href="'+a.documentBaseURI.getURI()+'" />'),d+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />',b=g.getBodyId(a),c=g.getBodyClass(a),g.getContentSecurityPolicy(a)&&(d+='<meta http-equiv="Content-Security-Policy" content="'+g.getContentSecurityPolicy(a)+'" />'),d+='</head><body id="'+b+'" class="mce-content-body '+c+'" data-id="'+a.id+'"><br></body></html>'}(a),k.add(b.iframeContainer,d),e};return{init:function(a,b){var c=p(a,b);b.editorContainer&&(k.get(b.editorContainer).style.display=a.orgDisplay,a.hidden=k.isHidden(b.editorContainer)),a.getElement().style.display="none",k.setAttrib(a.id,"aria-hidden",!0),c||i.initContentBody(a)}}}),g("4j",["28","1j","2","4k","4l","m","5w","5x","1e"],function(a,b,c,d,e,f,g,h,i){var j=f.DOM,k=function(a,b,c){var e,f,g=d.get(c);if(e=d.urls[c]||a.documentBaseUrl.replace(/\/$/,""),c=i.trim(c),g&&-1===i.inArray(b,c)){if(i.each(d.dependencies(c),function(c){k(a,b,c)}),a.plugins[c])return;f=new g(a,e,a.$),a.plugins[c]=f,f.init&&(f.init(a,e),b.push(c))}},l=function(a){return a.replace(/^\-/,"")},n=function(b){var c,d=b.settings.theme;a.isString(d)?(b.settings.theme=l(d),c=e.get(d),b.theme=new c(b,e.urls[d]),b.theme.init&&b.theme.init(b,e.urls[d]||b.documentBaseUrl.replace(/\/$/,""),b.$)):b.theme={}},q=function(a){return{editorContainer:a,iframeContainer:a}},s=function(a){var b=a.getElement();return a.inline?q(null):function(a){var b=j.create("div");return j.insertAfter(b,a),q(b)}(b)},t=function(b){var c=b.settings,d=b.getElement();return b.orgDisplay=d.style.display,a.isString(c.theme)?function(a){var b,c,d,e,f,g=a.settings,h=a.getElement();return b=g.width||j.getStyle(h,"width")||"100%",c=g.height||j.getStyle(h,"height")||h.offsetHeight,d=g.min_height||100,(e=/^[0-9\.]+(|px)$/i).test(""+b)&&(b=Math.max(parseInt(b,10),100)),e.test(""+c)&&(c=Math.max(parseInt(c,10),d)),f=a.theme.renderUI({targetNode:h,width:b,height:c,deltaWidth:g.delta_width,deltaHeight:g.delta_height}),g.content_editable||(c=(f.iframeHeight||c)+("number"==typeof c?f.deltaHeight||0:""))<d&&(c=d),f.height=c,f}(b):a.isFunction(c.theme)?function(a){var b,c=a.getElement();return(b=a.settings.theme(a,c)).editorContainer.nodeType&&(b.editorContainer.id=b.editorContainer.id||a.id+"_parent"),b.iframeContainer&&b.iframeContainer.nodeType&&(b.iframeContainer.id=b.iframeContainer.id||a.id+"_iframecontainer"),b.height=b.iframeHeight?b.iframeHeight:c.offsetHeight,b}(b):s(b)};return{init:function(a){var b,c=a.settings,d=a.getElement();return a.rtl=c.rtl_ui||a.editorManager.i18n.rtl,a.editorManager.i18n.setCode(c.language),c.aria_label=c.aria_label||j.getAttrib(d,"aria-label",a.getLang("aria.rich_text_area")),a.fire("ScriptsLoaded"),n(a),function(a){var b=[];i.each(a.settings.plugins.split(/[ ,]/),function(c){k(a,b,l(c))})}(a),b=t(a),a.editorContainer=b.editorContainer?b.editorContainer:null,c.content_css&&i.each(i.explode(c.content_css),function(b){a.contentCSS.push(a.documentBaseURI.toAbsolute(b))}),c.content_editable?g.initContentBody(a):h.init(a,b)}}}),g("25",["28","2","g","h","m","o","p","b","29","4j","4k","4l","1e"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=e.DOM,o=function(a){return"-"===a.charAt(0)},q=function(b,c,d,e){var f=c.settings,g=f.theme;if(a.isString(g)){if(!o(g)&&!l.urls.hasOwnProperty(g)){var h=f.theme_url;h?l.load(g,c.documentBaseURI.toAbsolute(h)):l.load(g,"themes/"+g+"/theme"+d+".js")}b.loadQueue(function(){l.waitFor(g,e)})}else e()},s=function(a,b){var c=g.ScriptLoader;q(c,a,b,function(){(function(a,b){var c=b.settings;c.language&&"en"!==c.language&&!c.language_url&&(c.language_url=b.editorManager.baseURL+"/langs/"+c.language+".js"),c.language_url&&!b.editorManager.i18n.data[c.language]&&a.add(c.language_url)})(c,a),function(a,b){m.isArray(a.plugins)&&(a.plugins=a.plugins.join(" ")),m.each(a.external_plugins,function(b,c){k.load(c,b),a.plugins+=" "+c}),m.each(a.plugins.split(/[ ,]/),function(a){if((a=m.trim(a))&&!k.urls[a])if(o(a)){a=a.substr(1,a.length);var c=k.dependencies(a);m.each(c,function(a){var c={prefix:"plugins/",resource:a,suffix:"/plugin"+b+".js"};a=k.createUrl(c,a),k.load(a.resource,a)})}else k.load(a,{prefix:"plugins/",resource:a,suffix:"/plugin"+b+".js"})})}(a.settings,b),c.loadQueue(function(){a.removed||j.init(a)},a,function(b){i.pluginLoadError(a,b[0]),a.removed||j.init(a)})})};return{render:function(a){var e=a.settings,g=a.id,i=function(){n.unbind(b,"ready",i),a.render()};if(f.Event.domLoaded){if(a.getElement()&&h.contentEditable){e.inline?a.inline=!0:(a.orgVisibility=a.getElement().style.visibility,a.getElement().style.visibility="hidden");var j=a.getElement().form||n.getParent(g,"form");j&&(a.formElement=j,e.hidden_input&&!/TEXTAREA|INPUT/i.test(a.getElement().nodeName)&&(n.insertAfter(n.create("input",{type:"hidden",name:g}),g),a.hasHiddenInput=!0),a.formEventDelegate=function(b){a.fire(b.type,b)},n.bind(j,"submit reset",a.formEventDelegate),a.on("reset",function(){a.setContent(a.startContent,{format:"raw"})}),!e.submit_patch||j.submit.nodeType||j.submit.length||j._mceOldSubmit||(j._mceOldSubmit=j.submit,j.submit=function(){return a.editorManager.triggerSave(),a.setDirty(!1),j._mceOldSubmit(j)})),a.windowManager=new d(a),a.notificationManager=new c(a),"xml"===e.encoding&&a.on("GetContent",function(a){a.save&&(a.content=n.encode(a.content))}),e.add_form_submit_trigger&&a.on("submit",function(){a.initialized&&a.save()}),e.add_unload_trigger&&(a._beforeUnload=function(){!a.initialized||a.destroyed||a.isHidden()||a.save({format:"raw",no_events:!0,set_dirty:!1})},a.editorManager.on("BeforeUnload",a._beforeUnload)),a.editorManager.add(a),s(a,a.suffix)}}else n.bind(b,"ready",i)}}}),g("26",[],function(){return{add:function(a,b,c){var d=a.sidebars?a.sidebars:[];d.push({name:b,settings:c}),a.sidebars=d}}}),g("1f",["1j","1e"],function(a,b){var c=b.each,d=b.trim,e="source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),f={ftp:21,http:80,https:443,mailto:25},g=function(b,f){var h,i,j=this;if(b=d(b),f=j.settings=f||{},h=f.base_uri,/^([\w\-]+):([^\/]{2})/i.test(b)||/^\s*#/.test(b))j.source=b;else{var k=0===b.indexOf("//");0!==b.indexOf("/")||k||(b=(h?h.protocol||"http":"http")+"://mce_host"+b),/^[\w\-]*:?\/\//.test(b)||(i=f.base_uri?f.base_uri.path:new g(a.location.href).directory,""===f.base_uri.protocol?b="//mce_host"+j.toAbsPath(i,b):(b=/([^#?]*)([#?]?.*)/.exec(b),b=(h&&h.protocol||"http")+"://mce_host"+j.toAbsPath(i,b[1])+b[2])),b=b.replace(/@@/g,"(mce_at)"),b=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(b),c(e,function(a,c){var d=b[c];d&&(d=d.replace(/\(mce_at\)/g,"@@")),j[a]=d}),h&&(j.protocol||(j.protocol=h.protocol),j.userInfo||(j.userInfo=h.userInfo),j.port||"mce_host"!==j.host||(j.port=h.port),j.host&&"mce_host"!==j.host||(j.host=h.host),j.source=""),k&&(j.protocol="")}};return g.prototype={setPath:function(a){var b=this;a=/^(.*?)\/?(\w+)?$/.exec(a),b.path=a[0],b.directory=a[1],b.file=a[2],b.source="",b.getURI()},toRelative:function(a){var b,c=this;if("./"===a)return a;if("mce_host"!=(a=new g(a,{base_uri:c})).host&&c.host!=a.host&&a.host||c.port!=a.port||c.protocol!=a.protocol&&""!==a.protocol)return a.getURI();var d=c.getURI(),e=a.getURI();return d==e||"/"==d.charAt(d.length-1)&&d.substr(0,d.length-1)==e?d:(b=c.toRelPath(c.path,a.path),a.query&&(b+="?"+a.query),a.anchor&&(b+="#"+a.anchor),b)},toAbsolute:function(a,b){return(a=new g(a,{base_uri:this})).getURI(b&&this.isSameOrigin(a))},isSameOrigin:function(a){if(this.host==a.host&&this.protocol==a.protocol){if(this.port==a.port)return!0;var b=f[this.protocol];if(b&&(this.port||b)==(a.port||b))return!0}return!1},toRelPath:function(a,b){var c,d,e,f=0,g="";if(a=a.substring(0,a.lastIndexOf("/")),a=a.split("/"),c=b.split("/"),a.length>=c.length)for(d=0,e=a.length;d<e;d++)if(d>=c.length||a[d]!=c[d]){f=d+1;break}if(a.length<c.length)for(d=0,e=c.length;d<e;d++)if(d>=a.length||a[d]!=c[d]){f=d+1;break}if(1===f)return b;for(d=0,e=a.length-(f-1);d<e;d++)g+="../";for(d=f-1,e=c.length;d<e;d++)g+=d!=f-1?"/"+c[d]:c[d];return g},toAbsPath:function(a,b){var d,e,f,g=0,h=[];for(e=/\/$/.test(b)?"/":"",a=a.split("/"),b=b.split("/"),c(a,function(a){a&&h.push(a)}),a=h,d=b.length-1,h=[];d>=0;d--)0!==b[d].length&&"."!==b[d]&&(".."!==b[d]?g>0?g--:h.push(b[d]):g++);return d=a.length-g,0!==(f=d<=0?h.reverse().join("/"):a.slice(0,d).join("/")+"/"+h.reverse().join("/")).indexOf("/")&&(f="/"+f),e&&f.lastIndexOf("/")!==f.length-1&&(f+=e),f},getURI:function(a){var b,c=this;return c.source&&!a||(b="",a||(b+=c.protocol?c.protocol+"://":"//",c.userInfo&&(b+=c.userInfo+"@"),c.host&&(b+=c.host),c.port&&(b+=":"+c.port)),c.path&&(b+=c.path),c.query&&(b+="?"+c.query),c.anchor&&(b+="#"+c.anchor),c.source=b),c.source}},g.parseDataUri=function(a){var b,c;return a=decodeURIComponent(a).split(","),(c=/data:([^;]+)/.exec(a[0]))&&(b=c[1]),{type:b,data:a[1]}},g.getDocumentBaseUrl=function(a){var b;return b=0!==a.protocol.indexOf("http")&&"file:"!==a.protocol?a.href:a.protocol+"//"+a.host+a.pathname,/^[^:]+:\/\/\/?[^\/]+\//.test(b)&&(b=b.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(b)||(b+="/")),b},g}),g("7",["6","8","a","21","b","22","c","m","n","23","24","z","25","26","1e","1f","27"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=h.DOM,s=o.extend,t=o.each,u=o.trim,v=o.resolve,w=e.ie,x=function(c,f,h){var j,k,l=this;j=l.documentBaseUrl=h.documentBaseURL,k=h.baseURI,f=d.getEditorSettings(l,c,j,h.defaultSettings,f),l.settings=f,a.language=f.language||"en",a.languageLoad=f.language_load,a.baseURL=h.baseURL,l.id=c,l.setDirty(!1),l.plugins={},l.documentBaseURI=new p(f.document_base_url,{base_uri:k}),l.baseURI=k,l.contentCSS=[],l.contentStyles=[],l.shortcuts=new g(l),l.loadedCSS={},l.editorCommands=new b(l),l.suffix=h.suffix,l.editorManager=h,l.inline=f.inline,l.buttons={},l.menuItems={},f.cache_suffix&&(e.cacheSuffix=f.cache_suffix.replace(/^[\?\&]+/,"")),!1===f.override_viewport&&(e.overrideViewPort=!1),h.fire("SetupEditor",l),l.execCallback("setup",l),l.$=i.overrideDefaults(function(){return{context:l.inline?l.getBody():l.getDoc(),element:l.getBody()}})};return x.prototype={render:function(){m.render(this)},focus:function(a){k.focus(this,a)},execCallback:function(a){var b,c=this,d=c.settings[a];if(d)return c.callbackLookup&&(b=c.callbackLookup[a])&&(d=b.func,b=b.scope),"string"==typeof d&&(b=d.replace(/\.\w+$/,""),b=b?v(b):0,d=v(d),c.callbackLookup=c.callbackLookup||{},c.callbackLookup[a]={func:d,scope:b}),d.apply(b||c,Array.prototype.slice.call(arguments,1))},translate:function(a){if(a&&o.is(a,"string")){var b=this.settings.language||"en",c=this.editorManager.i18n;a=c.data[b+"."+a]||a.replace(/\{\#([^\}]+)\}/g,function(a,d){return c.data[b+"."+d]||"{#"+d+"}"})}return this.editorManager.translate(a)},getLang:function(a,b){return this.editorManager.i18n.data[(this.settings.language||"en")+"."+a]||(void 0!==b?b:"{#"+a+"}")},getParam:function(a,b,c){var d,e=a in this.settings?this.settings[a]:b;return"hash"===c?(d={},"string"==typeof e?t(e.indexOf("=")>0?e.split(/[;,](?![^=;,]*(?:[;,]|$))/):e.split(","),function(a){(a=a.split("=")).length>1?d[u(a[0])]=u(a[1]):d[u(a[0])]=u(a)}):d=e,d):e},nodeChanged:function(a){this._nodeChangeDispatcher.nodeChanged(a)},addButton:function(a,b){var c=this;b.cmd&&(b.onclick=function(){c.execCommand(b.cmd)}),b.stateSelector&&void 0===b.active&&(b.active=!1),b.text||b.icon||(b.icon=a),c.buttons=c.buttons,b.tooltip=b.tooltip||b.title,c.buttons[a]=b},addSidebar:function(a,b){return n.add(this,a,b)},addMenuItem:function(a,b){var c=this;b.cmd&&(b.onclick=function(){c.execCommand(b.cmd)}),c.menuItems=c.menuItems,c.menuItems[a]=b},addContextToolbar:function(a,b){var c,d=this;d.contextToolbars=d.contextToolbars||[],"string"==typeof a&&(c=a,a=function(a){return d.dom.is(a,c)}),d.contextToolbars.push({id:q.uuid("mcet"),predicate:a,items:b})},addCommand:function(a,b,c){this.editorCommands.addCommand(a,b,c)},addQueryStateHandler:function(a,b,c){this.editorCommands.addQueryStateHandler(a,b,c)},addQueryValueHandler:function(a,b,c){this.editorCommands.addQueryValueHandler(a,b,c)},addShortcut:function(a,b,c,d){this.shortcuts.add(a,b,c,d)},execCommand:function(a,b,c,d){return this.editorCommands.execCommand(a,b,c,d)},queryCommandState:function(a){return this.editorCommands.queryCommandState(a)},queryCommandValue:function(a){return this.editorCommands.queryCommandValue(a)},queryCommandSupported:function(a){return this.editorCommands.queryCommandSupported(a)},show:function(){var a=this;a.hidden&&(a.hidden=!1,a.inline?a.getBody().contentEditable=!0:(r.show(a.getContainer()),r.hide(a.id)),a.load(),a.fire("show"))},hide:function(){var a=this,b=a.getDoc();a.hidden||(w&&b&&!a.inline&&b.execCommand("SelectAll"),a.save(),a.inline?(a.getBody().contentEditable=!1,a==a.editorManager.focusedEditor&&(a.editorManager.focusedEditor=null)):(r.hide(a.getContainer()),r.setStyle(a.id,"display",a.orgDisplay)),a.hidden=!0,a.fire("hide"))},isHidden:function(){return!!this.hidden},setProgressState:function(a,b){this.fire("ProgressState",{state:a,time:b})},load:function(a){var b,c=this,d=c.getElement();return c.removed?"":d?(a=a||{},a.load=!0,b=c.setContent(void 0!==d.value?d.value:d.innerHTML,a),a.element=d,a.no_events||c.fire("LoadContent",a),a.element=d=null,b):void 0},save:function(a){var b,c,d=this,e=d.getElement();if(e&&d.initialized&&!d.removed)return a=a||{},a.save=!0,a.element=e,b=a.content=d.getContent(a),a.no_events||d.fire("SaveContent",a),"raw"==a.format&&d.fire("RawSaveContent",a),b=a.content,/TEXTAREA|INPUT/i.test(e.nodeName)?e.value=b:(d.inline||(e.innerHTML=b),(c=r.getParent(d.id,"form"))&&t(c.elements,function(a){if(a.name==d.id)return a.value=b,!1})),a.element=e=null,!1!==a.set_dirty&&d.setDirty(!1),b},setContent:function(a,b){var c,d,e=this,f=e.getBody();return b=b||{},b.format=b.format||"html",b.set=!0,b.content=a,b.no_events||e.fire("BeforeSetContent",b),0===(a=b.content).length||/^\s+$/.test(a)?(d=w&&w<11?"":'<br data-mce-bogus="1">',"TABLE"==f.nodeName?a="<tr><td>"+d+"</td></tr>":/^(UL|OL)$/.test(f.nodeName)&&(a="<li>"+d+"</li>"),(c=e.settings.forced_root_block)&&e.schema.isValidChild(f.nodeName.toLowerCase(),c.toLowerCase())?(a=d,a=e.dom.createHTML(c,e.settings.forced_root_block_attrs,a)):w||a||(a='<br data-mce-bogus="1">'),e.dom.setHTML(f,a),e.fire("SetContent",b)):("raw"!==b.format&&(a=new l({validate:e.validate},e.schema).serialize(e.parser.parse(a,{isRootContent:!0,insert:!0}))),b.content=u(a),e.dom.setHTML(f,b.content),b.no_events||e.fire("SetContent",b)),b.content},getContent:function(a){var b,c=this,d=c.getBody();if(c.removed)return"";if(a=a||{},a.format=a.format||"html",a.get=!0,a.getInner=!0,a.no_events||c.fire("BeforeGetContent",a),"raw"===a.format)b=o.trim(j.trimExternal(c.serializer,d.innerHTML));else if("text"===a.format)b=d.innerText||d.textContent;else{if("tree"===a.format)return c.serializer.serialize(d,a);b=c.serializer.serialize(d,a)}return"text"!==a.format?a.content=u(b):a.content=b,a.no_events||c.fire("GetContent",a),a.content},insertContent:function(a,b){b&&(a=s({content:a},b)),this.execCommand("mceInsertContent",!1,a)},isDirty:function(){return!this.isNotDirty},setDirty:function(a){var b=!this.isNotDirty;this.isNotDirty=!a,a&&a!=b&&this.fire("dirty")},setMode:function(a){f.setMode(this,a)},getContainer:function(){var a=this;return a.container||(a.container=r.get(a.editorContainer||a.id+"_parent")),a.container},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){return this.targetElm||(this.targetElm=r.get(this.id)),this.targetElm},getWin:function(){var a,b=this;return b.contentWindow||(a=b.iframeElement)&&(b.contentWindow=a.contentWindow),b.contentWindow},getDoc:function(){var a,b=this;return b.contentDocument||(a=b.getWin())&&(b.contentDocument=a.document),b.contentDocument},getBody:function(){var a=this.getDoc();return this.bodyElement||(a?a.body:null)},convertURL:function(a,b,c){var d=this,e=d.settings;return e.urlconverter_callback?d.execCallback("urlconverter_callback",a,c,!0,b):!e.convert_urls||c&&"LINK"==c.nodeName||0===a.indexOf("file:")||0===a.length?a:e.relative_urls?d.documentBaseURI.toRelative(a):a=d.documentBaseURI.toAbsolute(a,e.remove_script_host)},addVisual:function(a){var b,c=this,d=c.settings,e=c.dom;a=a||c.getBody(),void 0===c.hasVisual&&(c.hasVisual=d.visual),t(e.select("table,a",a),function(a){var f;switch(a.nodeName){case"TABLE":return b=d.visual_table_class||"mce-item-table",void((f=e.getAttrib(a,"border"))&&"0"!=f||!c.hasVisual?e.removeClass(a,b):e.addClass(a,b));case"A":return void(e.getAttrib(a,"href",!1)||(f=e.getAttrib(a,"name")||a.id,b=d.visual_anchor_class||"mce-item-anchor",f&&c.hasVisual?e.addClass(a,b):e.removeClass(a,b)))}}),c.fire("VisualAid",{element:a,hasVisual:c.hasVisual})},remove:function(){var a=this;a.removed||(a.save(),a.removed=1,a.unbindAllNativeEvents(),a.hasHiddenInput&&r.remove(a.getElement().nextSibling),a.inline||(w&&w<10&&a.getDoc().execCommand("SelectAll",!1,null),r.setStyle(a.id,"display",a.orgDisplay),a.getBody().onload=null),a.fire("remove"),a.editorManager.remove(a),r.remove(a.getContainer()),a._selectionOverrides.destroy(),a.editorUpload.destroy(),a.destroy())},destroy:function(a){var b,c=this;if(!c.destroyed){if(!a&&!c.removed)return void c.remove();a||(c.editorManager.off("beforeunload",c._beforeUnload),c.theme&&c.theme.destroy&&c.theme.destroy(),c.selection.destroy(),c.dom.destroy()),(b=c.formElement)&&(b._mceOldSubmit&&(b.submit=b._mceOldSubmit,b._mceOldSubmit=null),r.unbind(b,"submit reset",c.formEventDelegate)),c.contentAreaContainer=c.formElement=c.container=c.editorContainer=null,c.bodyElement=c.contentDocument=c.contentWindow=null,c.iframeElement=c.targetElm=null,c.selection&&(c.selection=c.selection.win=c.selection.dom=c.selection.dom.doc=null),c.destroyed=1}},uploadImages:function(a){return this.editorUpload.uploadImages(a)},_scanForImages:function(){return this.editorUpload.scanForImages()}},s(x.prototype,c),x}),g("e",["1j"],function(a){return{isEditorUIElement:function(a){return-1!==a.className.toString().indexOf("mce-")}}}),g("4m",["5y","3d","1j","m","20"],function(a,b,c,d,e){var g=function(a,b){var e=function(){b.throttle()};d.DOM.bind(c,"mouseup",e),a.on("remove",function(){d.DOM.unbind(c,"mouseup",e)})},j=function(a,c){var d=b.detect().browser;d.isIE()||d.isEdge()?function(a){a.on("focusout",function(){e.store(a)})}(a):function(a,b){a.on("mouseup touchend",function(a){b.throttle()})}(a,c),a.on("keyup nodechange",function(b){(function(a){return"nodechange"===a.type&&a.selectionChange})(b)||e.store(a)})};return{register:function(b){var c=a.first(function(){e.store(b)},0);b.inline&&g(b,c),b.on("init",function(){j(b,c)}),b.on("remove",function(){c.cancel()})}}}),g("2a",["1","1j","e","m","4m","15"],function(a,b,c,d,e,f){var g,h=d.DOM,i=function(a){return c.isEditorUIElement(a)},j=function(a,b){var c=a?a.settings.custom_ui_selector:"";return null!==h.getParent(b,function(b){return i(b)||!!c&&a.dom.is(b,c)})},k=function(){try{return b.activeElement}catch(a){return b.body}},l=function(a,c){var d=c.editor;e.register(d),d.on("focusin",function(){var b=a.focusedEditor;b!=d&&(b&&b.fire("blur",{focusedEditor:d}),a.setActive(d),a.focusedEditor=d,d.fire("focus",{blurredEditor:b}),d.focus(!0))}),d.on("focusout",function(){f.setEditorTimeout(d,function(){var b=a.focusedEditor;j(d,k())||b!=d||(d.fire("blur",{focusedEditor:null}),a.focusedEditor=null)})}),g||(g=function(c){var d,e=a.activeEditor;d=c.target,e&&d.ownerDocument===b&&(d===b.body||j(e,d)||a.focusedEditor!==e||(e.fire("blur",{focusedEditor:null}),a.focusedEditor=null))},h.bind(b,"focusin",g))},m=function(a,c){a.focusedEditor==c.editor&&(a.focusedEditor=null),a.activeEditor||(h.unbind(b,"focusin",g),g=null)};return{setup:function(b){b.on("AddEditor",a.curry(l,b)),b.on("RemoveEditor",a.curry(m,b))},isEditorUIElement:i,isUIElement:j}}),g("17",["1e"],function(a){"use strict";var b={},c="en";return{setCode:function(a){a&&(c=a,this.rtl=!!this.data[a]&&"rtl"===this.data[a]._dir)},getCode:function(){return c},rtl:!1,add:function(a,c){var d=b[a];d||(b[a]=d={});for(var e in c)d[e]=c[e];this.setCode(a)},translate:function(d){var e=b[c]||{},f=function(b){return a.is(b,"function")?Object.prototype.toString.call(b):g(b)?"":""+b},g=function(b){return""===b||null===b||a.is(b,"undefined")},h=function(b){return b=f(b),a.hasOwn(e,b)?f(e[b]):b};if(g(d))return"";if(a.is(d,"object")&&a.hasOwn(d,"raw"))return f(d.raw);if(a.is(d,"array")){var i=d.slice(1);d=h(d[0]).replace(/\{([0-9]+)\}/g,function(b,c){return a.hasOwn(i,c)?f(i[c]):b})}return h(d).replace(/{context:\w+}$/,"")},data:b}}),g("9",["1i","28","1j","2","6","7","b","29","m","n","2a","17","1c","1d","1e","1f"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q,r,s=i.DOM,t=o.explode,u=o.each,v=o.extend,w=0,x=!1,y=[],z=[],B=function(a){u(r.get(),function(b){"scroll"===a.type?b.fire("ScrollWindow",a):b.fire("ResizeWindow",a)})},C=function(a){a!==x&&(a?j(d).on("resize scroll",B):j(d).off("resize scroll",B),x=a)},D=function(b){var c=z;delete y[b.id];for(var d=0;d<y.length;d++)if(y[d]===b){y.splice(d,1);break}return z=a.filter(z,function(a){return b!==a}),r.activeEditor===b&&(r.activeEditor=z.length>0?z[0]:null),r.focusedEditor===b&&(r.focusedEditor=null),c.length!==z.length};return r={defaultSettings:{},$:j,majorVersion:"4",minorVersion:"7.3",releaseDate:"2017-11-23",editors:y,i18n:l,activeEditor:null,settings:{},setup:function(){var a,b,e,f,g=this,h="";if(b=p.getDocumentBaseUrl(c.location),/^[^:]+:\/\/\/?[^\/]+\//.test(b)&&(b=b.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(b)||(b+="/")),e=d.tinymce||d.tinyMCEPreInit)a=e.base||e.baseURL,h=e.suffix;else{for(var i=c.getElementsByTagName("script"),j=0;j<i.length;j++){var l=(f=i[j].src).substring(f.lastIndexOf("/"));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(f)){-1!=l.indexOf(".min")&&(h=".min"),a=f.substring(0,f.lastIndexOf("/"));break}}!a&&c.currentScript&&(-1!=(f=c.currentScript.src).indexOf(".min")&&(h=".min"),a=f.substring(0,f.lastIndexOf("/")))}g.baseURL=new p(b).toAbsolute(a),g.documentBaseURL=b,g.baseURI=new p(g.baseURL),g.suffix=h,k.setup(g)},overrideDefaults:function(a){var b,c;(b=a.base_url)&&(this.baseURL=new p(this.documentBaseURL).toAbsolute(b.replace(/\/+$/,"")),this.baseURI=new p(this.baseURL)),c=a.suffix,a.suffix&&(this.suffix=c),this.defaultSettings=a;var d=a.plugin_base_urls;for(var f in d)e.PluginManager.urls[f]=d[f]},init:function(a){var b,e,i=this;e=o.makeMap("area base basefont br col frame hr img input isindex link meta param embed source wbr track colgroup option tbody tfoot thead tr script noscript style textarea video audio iframe object menu"," ");var k=function(a,b){return a.inline&&b.tagName.toLowerCase()in e},l=function(a){var b=a.id;return b||(b=a.name,b=b&&!s.get(b)?a.name:s.uniqueId(),a.setAttribute("id",b)),b},p=function(a,b){return b.constructor===RegExp?b.test(a.className):s.hasClass(a,b)},q=function(a){var b,d=[];if(g.ie&&g.ie<11)return h.initError("TinyMCE does not support the browser you are using. For a list of supported browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/"),[];if(a.types)return u(a.types,function(a){d=d.concat(s.select(a.selector))}),d;if(a.selector)return s.select(a.selector);if(a.target)return[a.target];switch(a.mode){case"exact":(b=a.elements||"").length>0&&u(t(b),function(a){var b;(b=s.get(a))?d.push(b):u(c.forms,function(b){u(b.elements,function(b){b.name===a&&(a="mce_editor_"+w++,s.setAttrib(b,"id",a),d.push(b))})})});break;case"textareas":case"specific_textareas":u(s.select("textarea"),function(b){a.editor_deselector&&p(b,a.editor_deselector)||a.editor_selector&&!p(b,a.editor_selector)||d.push(b)})}return d},r=function(a){b=a},x=function(){var b,c=0,e=[],g=function(a,d,g){var h=new f(a,d,i);e.push(h),h.on("init",function(){++c===b.length&&r(e)}),h.targetElm=h.targetElm||g,h.render()};return s.unbind(d,"ready",x),function(b){var c=a[b];if(c)c.apply(i,Array.prototype.slice.call(arguments,2))}("onpageload"),b=j.unique(q(a)),a.types?void u(a.types,function(c){o.each(b,function(b){return!s.is(b,c.selector)||(g(l(b),v({},a,c),b),!1)})}):(o.each(b,function(a){!function(a){a&&a.initialized&&!(a.getContainer()||a.getBody()).parentNode&&(D(a),a.unbindAllNativeEvents(),a.destroy(!0),a.removed=!0,a=null)}(i.get(a.id))}),void(0===(b=o.grep(b,function(a){return!i.get(a.id)})).length?r([]):u(b,function(b){k(a,b)?h.initError("Could not initialize inline editor on invalid inline target element",b):g(l(b),a,b)})))};return i.settings=a,s.bind(d,"ready",x),new n(function(a){b?a(b):r=function(b){a(b)}})},get:function(c){return 0===arguments.length?z.slice(0):b.isString(c)?a.find(z,function(a){return a.id===c}).getOr(null):b.isNumber(c)&&z[c]?z[c]:null},add:function(a){var c=this;return y[a.id]===a?a:(null===c.get(a.id)&&(function(a){return"length"!==a}(a.id)&&(y[a.id]=a),y.push(a),z.push(a)),C(!0),c.activeEditor=a,c.fire("AddEditor",{editor:a}),q||(q=function(){c.fire("BeforeUnload")},s.bind(d,"beforeunload",q)),a)},createEditor:function(a,b){return this.add(new f(a,b,this))},remove:function(a){var c,e,f=this;if(a)return b.isString(a)?(a=a.selector||a,void u(s.select(a),function(a){(e=f.get(a.id))&&f.remove(e)})):(e=a,b.isNull(f.get(e.id))?null:(D(e)&&f.fire("RemoveEditor",{editor:e}),0===z.length&&s.unbind(d,"beforeunload",q),e.remove(),C(z.length>0),e));for(c=z.length-1;c>=0;c--)f.remove(z[c])},execCommand:function(a,b,c){var d=this,e=d.get(c);switch(a){case"mceAddEditor":return d.get(c)||new f(c,d.settings,d).render(),!0;case"mceRemoveEditor":return e&&e.remove(),!0;case"mceToggleEditor":return e?(e.isHidden()?e.show():e.hide(),!0):(d.execCommand("mceAddEditor",0,c),!0)}return!!d.activeEditor&&d.activeEditor.execCommand(a,b,c)},triggerSave:function(){u(z,function(a){a.save()})},addI18n:function(a,b){l.add(a,b)},translate:function(a){return l.translate(a)},setActive:function(a){var b=this.activeEditor;this.activeEditor!=a&&(b&&b.fire("deactivate",{relatedTarget:a}),a.fire("activate",{relatedTarget:b})),this.activeEditor=a}},v(r,m),r.setup(),r}),g("j",["1","2s","2t","2u","2v","2w","2x"],function(a,b,c,d,e,f,g){var h=function(b){return{walk:function(a,c){return f.walk(b,a,c)},split:g.split,normalize:function(d){return c.normalize(b,d).fold(a.constant(!1),function(a){return d.setStart(a.startContainer,a.startOffset),d.setEnd(a.endContainer,a.endOffset),!0})}}};return h.compareRanges=d.isEq,h.getCaretRangeFromPoint=b.fromPoint,h.getSelectedNode=e.getSelectedNode,h.getNode=e.getNode,h}),g("t",[],function(){"use strict";var a=Math.min,b=Math.max,c=Math.round,d=function(a,b,d){var e,f,g,h,j,k;return e=b.x,f=b.y,g=a.w,h=a.h,j=b.w,k=b.h,"b"===(d=(d||"").split(""))[0]&&(f+=k),"r"===d[1]&&(e+=j),"c"===d[0]&&(f+=c(k/2)),"c"===d[1]&&(e+=c(j/2)),"b"===d[3]&&(f-=h),"r"===d[4]&&(e-=g),"c"===d[3]&&(f-=c(h/2)),"c"===d[4]&&(e-=c(g/2)),i(e,f,g,h)},i=function(a,b,c,d){return{x:a,y:b,w:c,h:d}};return{inflate:function(a,b,c){return i(a.x-b,a.y-c,a.w+2*b,a.h+2*c)},relativePosition:d,findBestRelativePosition:function(a,b,c,e){var f,g;for(g=0;g<e.length;g++)if((f=d(a,b,e[g])).x>=c.x&&f.x+f.w<=c.w+c.x&&f.y>=c.y&&f.y+f.h<=c.h+c.y)return e[g];return null},intersect:function(c,d){var e,f,g,h;return e=b(c.x,d.x),f=b(c.y,d.y),g=a(c.x+c.w,d.x+d.w),h=a(c.y+c.h,d.y+d.h),g-e<0||h-f<0?null:i(e,f,g-e,h-f)},clamp:function(a,c,d){var e,f,g,h,j,k,l,m,n,o;return j=a.x,k=a.y,l=a.x+a.w,m=a.y+a.h,n=c.x+c.w,o=c.y+c.h,e=b(0,c.x-j),f=b(0,c.y-k),g=b(0,l-n),h=b(0,m-o),j+=e,k+=f,d&&(l+=e,m+=f,j-=g,k-=h),l-=g,m-=h,i(j,k,l-j,m-k)},create:i,fromClientRect:function(a){return i(a.left,a.top,a.width,a.height)}}}),g("12",[],function(){"use strict";var a={};return{add:function(b,c){a[b.toLowerCase()]=c},has:function(b){return!!a[b.toLowerCase()]},get:function(b){var c=b.toLowerCase(),d=a.hasOwnProperty(c)?a[c]:null;if(null===d)throw new Error("Could not find module for type: "+b);return d},create:function(b,c){var d;if("string"==typeof b?(c=c||{},c.type=b):(c=b,b=c.type),b=b.toLowerCase(),!(d=a[b]))throw new Error("Could not find control by type: "+b);return d=new d(c),d.type=b,d}}}),g("13",["1e"],function(a){var b,c,d=a.each,e=a.extend,f=function(){};return f.extend=b=function(a){var f,g,h,j=this.prototype,k=function(){var a,b,d,e=this;if(!c&&(e.init&&e.init.apply(e,arguments),b=e.Mixins))for(a=b.length;a--;)(d=b[a]).init&&d.init.apply(e,arguments)},l=function(){return this},m=function(a,b){return function(){var c,d=this,e=d._super;return d._super=j[a],c=b.apply(d,arguments),d._super=e,c}};c=!0,f=new this,c=!1,a.Mixins&&(d(a.Mixins,function(b){for(var c in b)"init"!==c&&(a[c]=b[c])}),j.Mixins&&(a.Mixins=j.Mixins.concat(a.Mixins))),a.Methods&&d(a.Methods.split(","),function(b){a[b]=l}),a.Properties&&d(a.Properties.split(","),function(b){var c="_"+b;a[b]=function(a){var d=this;return void 0!==a?(d[c]=a,d):d[c]}}),a.Statics&&d(a.Statics,function(a,b){k[b]=a}),a.Defaults&&j.Defaults&&(a.Defaults=e({},j.Defaults,a.Defaults));for(g in a)"function"==typeof(h=a[g])&&j[g]?f[g]=m(g,h):f[g]=h;return k.prototype=f,k.constructor=k,k.extend=b,k},f}),g("14",[],function(){var a=Math.min,b=Math.max,c=Math.round;return function(d){var e=this,f=0,g=0,h=0,j=function(d,e,i){var j,k,l,m;if(d=(parseInt(d,10)||0)%360,e=parseInt(e,10)/100,i=parseInt(i,10)/100,e=b(0,a(e,1)),i=b(0,a(i,1)),0!==e){switch(j=d/60,k=i*e,l=k*(1-Math.abs(j%2-1)),m=i-k,Math.floor(j)){case 0:f=k,g=l,h=0;break;case 1:f=l,g=k,h=0;break;case 2:f=0,g=k,h=l;break;case 3:f=0,g=l,h=k;break;case 4:f=l,g=0,h=k;break;case 5:f=k,g=0,h=l;break;default:f=g=h=0}f=c(255*(f+m)),g=c(255*(g+m)),h=c(255*(h+m))}else f=g=h=c(255*i)},n=function(a){var b;return"object"==typeof a?"r"in a?(f=a.r,g=a.g,h=a.b):"v"in a&&j(a.h,a.s,a.v):(b=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(a))?(f=parseInt(b[1],10),g=parseInt(b[2],10),h=parseInt(b[3],10)):(b=/#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(a))?(f=parseInt(b[1],16),g=parseInt(b[2],16),h=parseInt(b[3],16)):(b=/#([0-F])([0-F])([0-F])/gi.exec(a))&&(f=parseInt(b[1]+b[1],16),g=parseInt(b[2]+b[2],16),h=parseInt(b[3]+b[3],16)),f=f<0?0:f>255?255:f,g=g<0?0:g>255?255:g,h=h<0?0:h>255?255:h,e};d&&n(d),e.toRgb=function(){return{r:f,g:g,b:h}},e.toHsv=function(){return function(d,e,f){var g,h,i,j,k,l;return g=0,h=0,i=0,d/=255,e/=255,f/=255,k=a(d,a(e,f)),l=b(d,b(e,f)),k==l?(i=k,{h:0,s:0,v:100*i}):(j=d==k?e-f:f==k?d-e:f-d,g=d==k?3:f==k?1:5,g=60*(g-j/(l-k)),h=(l-k)/l,i=l,{h:c(g),s:c(100*h),v:c(100*i)})}(f,g,h)},e.toHex=function(){var a=function(a){return(a=parseInt(a,10).toString(16)).length>1?a:"0"+a};return"#"+a(f)+a(g)+a(h)},e.parse=n}}),g("18",["2"],function(a){var b=function(a,c){var d,e,f,g;if(c=c||'"',null===a)return"null";if("string"==(f=typeof a))return e="\bb\tt\nn\ff\rr\"\"''\\\\",c+a.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g,function(a,b){return'"'===c&&"'"===a?a:(d=e.indexOf(b))+1?"\\"+e.charAt(d+1):(a=b.charCodeAt().toString(16),"\\u"+"0000".substring(a.length)+a)})+c;if("object"==f){if(a.hasOwnProperty&&"[object Array]"===Object.prototype.toString.call(a)){for(d=0,e="[";d<a.length;d++)e+=(d>0?",":"")+b(a[d],c);return e+"]"}e="{";for(g in a)a.hasOwnProperty(g)&&(e+="function"!=typeof a[g]?(e.length>1?","+c:c)+g+c+":"+b(a[g],c):"");return e+"}"}return""+a};return{serialize:b,parse:function(b){try{return a[String.fromCharCode(101)+"val"]("("+b+")")}catch(a){}}}}),g("19",["m"],function(a){return{callbacks:{},count:0,send:function(b){var c=this,d=a.DOM,e=void 0!==b.count?b.count:c.count,f="tinymce_jsonp_"+e;c.callbacks[e]=function(a){d.remove(f),delete c.callbacks[e],b.callback(a)},d.add(d.doc.body,"script",{id:f,src:b.url,type:"text/javascript"}),c.count++}}}),g("1h",["39","1q","1c","1e"],function(a,b,c,d){var e={send:function(c){var f,g=0,h=function(){!c.async||4==f.readyState||g++>1e4?(c.success&&g<1e4&&200==f.status?c.success.call(c.success_scope,""+f.responseText,f,c):c.error&&c.error.call(c.error_scope,g>1e4?"TIMED_OUT":"GENERAL",f,c),f=null):b(h,10)};if(c.scope=c.scope||this,c.success_scope=c.success_scope||c.scope,c.error_scope=c.error_scope||c.scope,c.async=!1!==c.async,c.data=c.data||"",e.fire("beforeInitialize",{settings:c}),f=new a){if(f.overrideMimeType&&f.overrideMimeType(c.content_type),f.open(c.type||(c.data?"POST":"GET"),c.url,c.async),c.crossDomain&&(f.withCredentials=!0),c.content_type&&f.setRequestHeader("Content-Type",c.content_type),c.requestheaders&&d.each(c.requestheaders,function(a){f.setRequestHeader(a.key,a.value)}),f.setRequestHeader("X-Requested-With","XMLHttpRequest"),(f=e.fire("beforeSend",{xhr:f,settings:c}).xhr).send(c.data),!c.async)return h();b(h,10)}}};return d.extend(e,c),e}),g("1a",["18","1h","1e"],function(a,b,c){var d=c.extend,e=function(a){this.settings=d({},a),this.count=0};return e.sendRPC=function(a){return(new e).send(a)},e.prototype={send:function(c){var e=c.error,f=c.success;(c=d(this.settings,c)).success=function(b,d){void 0===(b=a.parse(b))&&(b={error:"JSON Parse error."}),b.error?e.call(c.error_scope||c.scope,b.error,d):f.call(c.success_scope||c.scope,b.result)},c.error=function(a,b){e&&e.call(c.error_scope||c.scope,a,b)},c.data=a.serialize({id:c.id||"c"+this.count++,method:c.method,params:c.params}),c.content_type="application/json",b.send(c)}},e}),g("1b",["1j","2"],function(a,b){var c,d,e,f,g,h;try{if(b.localStorage)return b.localStorage}catch(a){}g="tinymce",d=a.documentElement,(h=!!d.addBehavior)&&d.addBehavior("#default#userData");var i=function(){f=[];for(var a in e)f.push(a);c.length=f.length},k=function(){var a,b="";if(h){for(var c in e)a=e[c],b+=(b?",":"")+c.length.toString(32)+","+c+","+a.length.toString(32)+","+a;d.setAttribute(g,b);try{d.save(g)}catch(a){}i()}};return c={key:function(a){return f[a]},getItem:function(a){return a in e?e[a]:null},setItem:function(a,b){e[a]=""+b,k()},removeItem:function(a){delete e[a],k()},clear:function(){e={},k()}},function(){var a,b,c,f=0;if(e={},h){var j=function(a){var c,d;return-1===(d=void 0!==a?f+a:b.indexOf(",",f))||d>b.length?null:(c=b.substring(f,d),f=d+1,c)};d.load(g),b=d.getAttribute(g)||"";do{var k=j();if(null===k)break;if(null!==(a=j(parseInt(k,32)||0))){if(null===(k=j()))break;c=j(parseInt(k,32)||0),a&&(e[a]=c)}}while(null!==a);i()}}(),c}),g("3",["6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","1g","1h"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V){var W=d,X={geom:{Rect:x},util:{Promise:R,Delay:J,Tools:S,VK:U,URI:T,Class:H,EventDispatcher:K,Observable:Q,I18n:L,XHR:V,JSON:M,JSONRequest:O,JSONP:N,LocalStorage:P,Color:I},dom:{EventUtils:s,Sizzle:v,DomQuery:r,TreeWalker:w,DOMUtils:q,ScriptLoader:t,RangeUtils:n,Serializer:o,ControlSelection:p,BookmarkManager:m,Selection:u,Event:s.Event},html:{Styles:E,Entities:z,Node:A,Schema:C,SaxParser:B,DomParser:y,Writer:F,Serializer:D},ui:{Factory:G},Env:f,AddOnManager:a,Formatter:j,UndoManager:h,EditorCommands:c,WindowManager:l,NotificationManager:k,EditorObservable:e,Shortcuts:g,Editor:b,FocusManager:i,EditorManager:d,DOM:q.DOM,ScriptLoader:t.ScriptLoader,PluginManager:a.PluginManager,ThemeManager:a.ThemeManager,trim:S.trim,isArray:S.isArray,is:S.is,toArray:S.toArray,makeMap:S.makeMap,each:S.each,map:S.map,grep:S.grep,inArray:S.inArray,extend:S.extend,create:S.create,walk:S.walk,createNS:S.createNS,resolve:S.resolve,explode:S.explode,_addCacheSuffix:S._addCacheSuffix,isOpera:f.opera,isWebKit:f.webkit,isIE:f.ie,isGecko:f.gecko,isMac:f.mac};return W=S.extend(W,X)}),g("0",["1","2","3"],function(a,b,c){var d=this||b;return function(){return function(a){b.tinymce=a,b.tinyMCE=a}(c),function(b){"function"!=typeof d.define||d.define.amd||(d.define("ephox/tinymce",[],a.constant(b)),d.define("9",[],a.constant(b))),"object"==typeof module&&(module.exports=b)}(c),c}}),d("0")()}();var Handlebars=function(){var __module4__=function(){"use strict";function SafeString(string){this.string=string}return SafeString.prototype.toString=function(){return""+this.string},SafeString}(),__module3__=function(__dependency1__){"use strict";function escapeChar(chr){return escape[chr]||"&amp;"}var __exports__={},SafeString=__module4__,escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},badChars=/[&<>"'`]/g,possible=/[&<>"'`]/;__exports__.extend=function(obj,value){for(var key in value)Object.prototype.hasOwnProperty.call(value,key)&&(obj[key]=value[key])};var toString=Object.prototype.toString;__exports__.toString=toString;(isFunction=function(value){return"function"==typeof value})(/x/)&&(isFunction=function(value){return"function"==typeof value&&"[object Function]"===toString.call(value)});var isFunction;__exports__.isFunction=isFunction;var isArray=Array.isArray||function(value){return!(!value||"object"!=typeof value)&&"[object Array]"===toString.call(value)};return __exports__.isArray=isArray,__exports__.escapeExpression=function(string){return string instanceof SafeString?string.toString():string||0===string?(string=""+string,possible.test(string)?string.replace(badChars,escapeChar):string):""},__exports__.isEmpty=function(value){return!value&&0!==value||!(!isArray(value)||0!==value.length)},__exports__}(),__module5__=function(){"use strict";function Exception(message,node){var line;node&&node.firstLine&&(message+=" - "+(line=node.firstLine)+":"+node.firstColumn);for(var tmp=Error.prototype.constructor.call(this,message),idx=0;idx<errorProps.length;idx++)this[errorProps[idx]]=tmp[errorProps[idx]];line&&(this.lineNumber=line,this.column=node.firstColumn)}var errorProps=["description","fileName","lineNumber","message","name","number","stack"];return Exception.prototype=new Error,Exception}(),__module2__=function(__dependency1__,__dependency2__){"use strict";function HandlebarsEnvironment(helpers,partials){this.helpers=helpers||{},this.partials=partials||{},function(instance){instance.registerHelper("helperMissing",function(arg){if(2!==arguments.length)throw new Exception("Missing helper: '"+arg+"'")}),instance.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse||function(){},fn=options.fn;return isFunction(context)&&(context=context.call(this)),!0===context?fn(this):!1===context||null==context?inverse(this):isArray(context)?context.length>0?instance.helpers.each(context,options):inverse(this):fn(context)}),instance.registerHelper("each",function(context,options){var data,fn=options.fn,inverse=options.inverse,i=0,ret="";if(isFunction(context)&&(context=context.call(this)),options.data&&(data=createFrame(options.data)),context&&"object"==typeof context)if(isArray(context))for(var j=context.length;i<j;i++)data&&(data.index=i,data.first=0===i,data.last=i===context.length-1),ret+=fn(context[i],{data:data});else for(var key in context)context.hasOwnProperty(key)&&(data&&(data.key=key,data.index=i,data.first=0===i),ret+=fn(context[key],{data:data}),i++);return 0===i&&(ret=inverse(this)),ret}),instance.registerHelper("if",function(conditional,options){return isFunction(conditional)&&(conditional=conditional.call(this)),!options.hash.includeZero&&!conditional||Utils.isEmpty(conditional)?options.inverse(this):options.fn(this)}),instance.registerHelper("unless",function(conditional,options){return instance.helpers.if.call(this,conditional,{fn:options.inverse,inverse:options.fn,hash:options.hash})}),instance.registerHelper("with",function(context,options){if(isFunction(context)&&(context=context.call(this)),!Utils.isEmpty(context))return options.fn(context)}),instance.registerHelper("log",function(context,options){var level=options.data&&null!=options.data.level?parseInt(options.data.level,10):1;instance.log(level,context)})}(this)}function log(level,obj){logger.log(level,obj)}var __exports__={},Utils=__module3__,Exception=__module5__;__exports__.VERSION="1.3.0";__exports__.COMPILER_REVISION=4;__exports__.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};var isArray=Utils.isArray,isFunction=Utils.isFunction,toString=Utils.toString;__exports__.HandlebarsEnvironment=HandlebarsEnvironment,HandlebarsEnvironment.prototype={constructor:HandlebarsEnvironment,logger:logger,log:log,registerHelper:function(name,fn,inverse){if("[object Object]"===toString.call(name)){if(inverse||fn)throw new Exception("Arg not supported with multiple helpers");Utils.extend(this.helpers,name)}else inverse&&(fn.not=inverse),this.helpers[name]=fn},registerPartial:function(name,str){"[object Object]"===toString.call(name)?Utils.extend(this.partials,name):this.partials[name]=str}};var logger={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(level,obj){if(logger.level<=level){var method=logger.methodMap[level];"undefined"!=typeof console&&console[method]&&console[method].call(console,obj)}}};__exports__.logger=logger,__exports__.log=log;var createFrame=function(object){var obj={};return Utils.extend(obj,object),obj};return __exports__.createFrame=createFrame,__exports__}(),__module6__=function(__dependency1__,__dependency2__,__dependency3__){"use strict";function program(i,fn,data){var prog=function(context,options){return options=options||{},fn(context,options.data||data)};return prog.program=i,prog.depth=0,prog}var __exports__={},Utils=__module3__,Exception=__module5__,COMPILER_REVISION=__dependency3__.COMPILER_REVISION,REVISION_CHANGES=__dependency3__.REVISION_CHANGES;return __exports__.checkRevision=function(compilerInfo){var compilerRevision=compilerInfo&&compilerInfo[0]||1;if(compilerRevision!==COMPILER_REVISION){if(compilerRevision<COMPILER_REVISION){var runtimeVersions=REVISION_CHANGES[COMPILER_REVISION],compilerVersions=REVISION_CHANGES[compilerRevision];throw new Exception("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+").")}throw new Exception("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+compilerInfo[1]+").")}},__exports__.template=function(templateSpec,env){if(!env)throw new Exception("No environment passed to template");var container={escapeExpression:Utils.escapeExpression,invokePartial:function(partial,name,context,helpers,partials,data){var result=env.VM.invokePartial.apply(this,arguments);if(null!=result)return result;if(env.compile){var options={helpers:helpers,partials:partials,data:data};return partials[name]=env.compile(partial,{data:void 0!==data},env),partials[name](context,options)}throw new Exception("The partial "+name+" could not be compiled when running in runtime-only mode")},programs:[],program:function(i,fn,data){var programWrapper=this.programs[i];return data?programWrapper=program(i,fn,data):programWrapper||(programWrapper=this.programs[i]=program(i,fn)),programWrapper},merge:function(param,common){var ret=param||common;return param&&common&&param!==common&&(ret={},Utils.extend(ret,common),Utils.extend(ret,param)),ret},programWithDepth:env.VM.programWithDepth,noop:env.VM.noop,compilerInfo:null};return function(context,options){var helpers,partials,namespace=(options=options||{}).partial?options:env;options.partial||(helpers=options.helpers,partials=options.partials);var result=templateSpec.call(container,namespace,context,helpers,partials,options.data);return options.partial||env.VM.checkRevision(container.compilerInfo),result}},__exports__.programWithDepth=function(i,fn,data){var args=Array.prototype.slice.call(arguments,3),prog=function(context,options){return options=options||{},fn.apply(this,[context,options.data||data].concat(args))};return prog.program=i,prog.depth=args.length,prog},__exports__.program=program,__exports__.invokePartial=function(partial,name,context,helpers,partials,data){var options={partial:!0,helpers:helpers,partials:partials,data:data};if(void 0===partial)throw new Exception("The partial "+name+" could not be found");if(partial instanceof Function)return partial(context,options)},__exports__.noop=function(){return""},__exports__}(0,0,__module2__),__module1__=function(__dependency1__,__dependency2__,__dependency3__,__dependency4__,__dependency5__){"use strict";var base=__module2__,SafeString=__module4__,Exception=__module5__,Utils=__module3__,runtime=__module6__,create=function(){var hb=new base.HandlebarsEnvironment;return Utils.extend(hb,base),hb.SafeString=SafeString,hb.Exception=Exception,hb.Utils=Utils,hb.VM=runtime,hb.template=function(spec){return runtime.template(spec,hb)},hb},Handlebars=create();return Handlebars.create=create,Handlebars}(),__module7__=function(__dependency1__){"use strict";function LocationInfo(locInfo){locInfo=locInfo||{},this.firstLine=locInfo.first_line,this.firstColumn=locInfo.first_column,this.lastColumn=locInfo.last_column,this.lastLine=locInfo.last_line}var Exception=__module5__,AST={ProgramNode:function(statements,inverseStrip,inverse,locInfo){var inverseLocationInfo,firstInverseNode;3===arguments.length?(locInfo=inverse,inverse=null):2===arguments.length&&(locInfo=inverseStrip,inverseStrip=null),LocationInfo.call(this,locInfo),this.type="program",this.statements=statements,this.strip={},inverse?((firstInverseNode=inverse[0])?(inverseLocationInfo={first_line:firstInverseNode.firstLine,last_line:firstInverseNode.lastLine,last_column:firstInverseNode.lastColumn,first_column:firstInverseNode.firstColumn},this.inverse=new AST.ProgramNode(inverse,inverseStrip,inverseLocationInfo)):this.inverse=new AST.ProgramNode(inverse,inverseStrip),this.strip.right=inverseStrip.left):inverseStrip&&(this.strip.left=inverseStrip.right)},MustacheNode:function(rawParams,hash,open,strip,locInfo){if(LocationInfo.call(this,locInfo),this.type="mustache",this.strip=strip,null!=open&&open.charAt){var escapeFlag=open.charAt(3)||open.charAt(2);this.escaped="{"!==escapeFlag&&"&"!==escapeFlag}else this.escaped=!!open;rawParams instanceof AST.SexprNode?this.sexpr=rawParams:this.sexpr=new AST.SexprNode(rawParams,hash),this.sexpr.isRoot=!0,this.id=this.sexpr.id,this.params=this.sexpr.params,this.hash=this.sexpr.hash,this.eligibleHelper=this.sexpr.eligibleHelper,this.isHelper=this.sexpr.isHelper},SexprNode:function(rawParams,hash,locInfo){LocationInfo.call(this,locInfo),this.type="sexpr",this.hash=hash;var id=this.id=rawParams[0],params=this.params=rawParams.slice(1),eligibleHelper=this.eligibleHelper=id.isSimple;this.isHelper=eligibleHelper&&(params.length||hash)},PartialNode:function(partialName,context,strip,locInfo){LocationInfo.call(this,locInfo),this.type="partial",this.partialName=partialName,this.context=context,this.strip=strip},BlockNode:function(mustache,program,inverse,close,locInfo){if(LocationInfo.call(this,locInfo),mustache.sexpr.id.original!==close.path.original)throw new Exception(mustache.sexpr.id.original+" doesn't match "+close.path.original,this);this.type="block",this.mustache=mustache,this.program=program,this.inverse=inverse,this.strip={left:mustache.strip.left,right:close.strip.right},(program||inverse).strip.left=mustache.strip.right,(inverse||program).strip.right=close.strip.left,inverse&&!program&&(this.isInverse=!0)},ContentNode:function(string,locInfo){LocationInfo.call(this,locInfo),this.type="content",this.string=string},HashNode:function(pairs,locInfo){LocationInfo.call(this,locInfo),this.type="hash",this.pairs=pairs},IdNode:function(parts,locInfo){LocationInfo.call(this,locInfo),this.type="ID";for(var original="",dig=[],depth=0,i=0,l=parts.length;i<l;i++){var part=parts[i].part;if(original+=(parts[i].separator||"")+part,".."===part||"."===part||"this"===part){if(dig.length>0)throw new Exception("Invalid path: "+original,this);".."===part?depth++:this.isScoped=!0}else dig.push(part)}this.original=original,this.parts=dig,this.string=dig.join("."),this.depth=depth,this.isSimple=1===parts.length&&!this.isScoped&&0===depth,this.stringModeValue=this.string},PartialNameNode:function(name,locInfo){LocationInfo.call(this,locInfo),this.type="PARTIAL_NAME",this.name=name.original},DataNode:function(id,locInfo){LocationInfo.call(this,locInfo),this.type="DATA",this.id=id},StringNode:function(string,locInfo){LocationInfo.call(this,locInfo),this.type="STRING",this.original=this.string=this.stringModeValue=string},IntegerNode:function(integer,locInfo){LocationInfo.call(this,locInfo),this.type="INTEGER",this.original=this.integer=integer,this.stringModeValue=Number(integer)},BooleanNode:function(bool,locInfo){LocationInfo.call(this,locInfo),this.type="BOOLEAN",this.bool=bool,this.stringModeValue="true"===bool},CommentNode:function(comment,locInfo){LocationInfo.call(this,locInfo),this.type="comment",this.comment=comment}};return AST}(),__module9__=function(){"use strict";return function(){function stripFlags(open,close){return{left:"~"===open.charAt(2),right:"~"===close.charAt(0)||"~"===close.charAt(1)}}function Parser(){this.yy={}}var parser={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,program:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,sexpr:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,partial_option0:27,sexpr_repetition0:28,sexpr_option0:29,dataName:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,OPEN_SEXPR:35,CLOSE_SEXPR:36,hash:37,hash_repetition_plus0:38,hashSegment:39,ID:40,EQUALS:41,DATA:42,pathSegments:43,SEP:44,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",35:"OPEN_SEXPR",36:"CLOSE_SEXPR",40:"ID",41:"EQUALS",42:"DATA",44:"SEP"},productions_:[0,[3,2],[3,1],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[31,3],[37,1],[39,3],[26,1],[26,1],[26,1],[30,2],[21,1],[43,3],[43,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[38,1],[38,2]],performAction:function(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return new yy.ProgramNode($$[$0-1],this._$);case 2:return new yy.ProgramNode([],this._$);case 3:this.$=new yy.ProgramNode([],$$[$0-1],$$[$0],this._$);break;case 4:this.$=new yy.ProgramNode($$[$0-2],$$[$0-1],$$[$0],this._$);break;case 5:this.$=new yy.ProgramNode($$[$0-1],$$[$0],[],this._$);break;case 6:this.$=new yy.ProgramNode($$[$0],this._$);break;case 7:case 8:this.$=new yy.ProgramNode([],this._$);break;case 9:this.$=[$$[$0]];break;case 10:$$[$0-1].push($$[$0]),this.$=$$[$0-1];break;case 11:this.$=new yy.BlockNode($$[$0-2],$$[$0-1].inverse,$$[$0-1],$$[$0],this._$);break;case 12:this.$=new yy.BlockNode($$[$0-2],$$[$0-1],$$[$0-1].inverse,$$[$0],this._$);break;case 13:case 14:this.$=$$[$0];break;case 15:this.$=new yy.ContentNode($$[$0],this._$);break;case 16:this.$=new yy.CommentNode($$[$0],this._$);break;case 17:case 18:this.$=new yy.MustacheNode($$[$0-1],null,$$[$0-2],stripFlags($$[$0-2],$$[$0]),this._$);break;case 19:this.$={path:$$[$0-1],strip:stripFlags($$[$0-2],$$[$0])};break;case 20:case 21:this.$=new yy.MustacheNode($$[$0-1],null,$$[$0-2],stripFlags($$[$0-2],$$[$0]),this._$);break;case 22:this.$=new yy.PartialNode($$[$0-2],$$[$0-1],stripFlags($$[$0-3],$$[$0]),this._$);break;case 23:this.$=stripFlags($$[$0-1],$$[$0]);break;case 24:this.$=new yy.SexprNode([$$[$0-2]].concat($$[$0-1]),$$[$0],this._$);break;case 25:this.$=new yy.SexprNode([$$[$0]],null,this._$);break;case 26:this.$=$$[$0];break;case 27:this.$=new yy.StringNode($$[$0],this._$);break;case 28:this.$=new yy.IntegerNode($$[$0],this._$);break;case 29:this.$=new yy.BooleanNode($$[$0],this._$);break;case 30:this.$=$$[$0];break;case 31:$$[$0-1].isHelper=!0,this.$=$$[$0-1];break;case 32:this.$=new yy.HashNode($$[$0],this._$);break;case 33:this.$=[$$[$0-2],$$[$0]];break;case 34:this.$=new yy.PartialNameNode($$[$0],this._$);break;case 35:this.$=new yy.PartialNameNode(new yy.StringNode($$[$0],this._$),this._$);break;case 36:this.$=new yy.PartialNameNode(new yy.IntegerNode($$[$0],this._$));break;case 37:this.$=new yy.DataNode($$[$0],this._$);break;case 38:this.$=new yy.IdNode($$[$0],this._$);break;case 39:$$[$0-2].push({part:$$[$0],separator:$$[$0-1]}),this.$=$$[$0-2];break;case 40:this.$=[{part:$$[$0]}];break;case 43:this.$=[];break;case 44:$$[$0-1].push($$[$0]);break;case 47:this.$=[$$[$0]];break;case 48:$$[$0-1].push($$[$0])}},table:[{3:1,4:2,5:[1,3],8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[3]},{5:[1,16],8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[2,2]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{4:20,6:18,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{4:20,6:22,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{17:23,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:29,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:30,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:31,21:24,30:25,40:[1,28],42:[1,27],43:26},{21:33,26:32,32:[1,34],33:[1,35],40:[1,28],43:26},{1:[2,1]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{10:36,20:[1,37]},{4:38,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,7],22:[1,13],23:[1,14],25:[1,15]},{7:39,8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,6],22:[1,13],23:[1,14],25:[1,15]},{17:23,18:[1,40],21:24,30:25,40:[1,28],42:[1,27],43:26},{10:41,20:[1,37]},{18:[1,42]},{18:[2,43],24:[2,43],28:43,32:[2,43],33:[2,43],34:[2,43],35:[2,43],36:[2,43],40:[2,43],42:[2,43]},{18:[2,25],24:[2,25],36:[2,25]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],35:[2,38],36:[2,38],40:[2,38],42:[2,38],44:[1,44]},{21:45,40:[1,28],43:26},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],42:[2,40],44:[2,40]},{18:[1,46]},{18:[1,47]},{24:[1,48]},{18:[2,41],21:50,27:49,40:[1,28],43:26},{18:[2,34],40:[2,34]},{18:[2,35],40:[2,35]},{18:[2,36],40:[2,36]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{21:51,40:[1,28],43:26},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,3],22:[1,13],23:[1,14],25:[1,15]},{4:52,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,5],22:[1,13],23:[1,14],25:[1,15]},{14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,45],21:56,24:[2,45],29:53,30:60,31:54,32:[1,57],33:[1,58],34:[1,59],35:[1,61],36:[2,45],37:55,38:62,39:63,40:[1,64],42:[1,27],43:26},{40:[1,65]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],35:[2,37],36:[2,37],40:[2,37],42:[2,37]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,66]},{18:[2,42]},{18:[1,67]},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],25:[1,15]},{18:[2,24],24:[2,24],36:[2,24]},{18:[2,44],24:[2,44],32:[2,44],33:[2,44],34:[2,44],35:[2,44],36:[2,44],40:[2,44],42:[2,44]},{18:[2,46],24:[2,46],36:[2,46]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],35:[2,26],36:[2,26],40:[2,26],42:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],35:[2,27],36:[2,27],40:[2,27],42:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],35:[2,28],36:[2,28],40:[2,28],42:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],35:[2,29],36:[2,29],40:[2,29],42:[2,29]},{18:[2,30],24:[2,30],32:[2,30],33:[2,30],34:[2,30],35:[2,30],36:[2,30],40:[2,30],42:[2,30]},{17:68,21:24,30:25,40:[1,28],42:[1,27],43:26},{18:[2,32],24:[2,32],36:[2,32],39:69,40:[1,70]},{18:[2,47],24:[2,47],36:[2,47],40:[2,47]},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],41:[1,71],42:[2,40],44:[2,40]},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],35:[2,39],36:[2,39],40:[2,39],42:[2,39],44:[2,39]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{36:[1,72]},{18:[2,48],24:[2,48],36:[2,48],40:[2,48]},{41:[1,71]},{21:56,30:60,31:73,32:[1,57],33:[1,58],34:[1,59],35:[1,61],40:[1,28],42:[1,27],43:26},{18:[2,31],24:[2,31],32:[2,31],33:[2,31],34:[2,31],35:[2,31],36:[2,31],40:[2,31],42:[2,31]},{18:[2,33],24:[2,33],36:[2,33],40:[2,33]}],defaultActions:{3:[2,2],16:[2,1],50:[2,42]},parseError:function(str,hash){throw new Error(str)},parse:function(input){function lex(){var token;return"number"!=typeof(token=self.lexer.lex()||1)&&(token=self.symbols_[token]||token),token}var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0;this.lexer.setInput(input),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var yyloc=this.lexer.yylloc;lstack.push(yyloc);var ranges=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var symbol,preErrorSymbol,state,action,r,p,len,newState,expected,yyval={};;){if(state=stack[stack.length-1],this.defaultActions[state]?action=this.defaultActions[state]:(null!==symbol&&void 0!==symbol||(symbol=lex()),action=table[state]&&table[state][symbol]),void 0===action||!action.length||!action[0]){var errStr="";if(!recovering){expected=[];for(p in table[state])this.terminals_[p]&&p>2&&expected.push("'"+this.terminals_[p]+"'");errStr=this.lexer.showPosition?"Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'":"Parse error on line "+(yylineno+1)+": Unexpected "+(1==symbol?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'"),this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}}if(action[0]instanceof Array&&action.length>1)throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);switch(action[0]){case 1:stack.push(symbol),vstack.push(this.lexer.yytext),lstack.push(this.lexer.yylloc),stack.push(action[1]),symbol=null,preErrorSymbol?(symbol=preErrorSymbol,preErrorSymbol=null):(yyleng=this.lexer.yyleng,yytext=this.lexer.yytext,yylineno=this.lexer.yylineno,yyloc=this.lexer.yylloc,recovering>0&&recovering--);break;case 2:if(len=this.productions_[action[1]][1],yyval.$=vstack[vstack.length-len],yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column},ranges&&(yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]),void 0!==(r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack)))return r;len&&(stack=stack.slice(0,-1*len*2),vstack=vstack.slice(0,-1*len),lstack=lstack.slice(0,-1*len)),stack.push(this.productions_[action[1]][0]),vstack.push(yyval.$),lstack.push(yyval._$),newState=table[stack[stack.length-2]][stack[stack.length-1]],stack.push(newState);break;case 3:return!0}}return!0}},lexer=function(){var lexer={EOF:1,parseError:function(str,hash){if(!this.yy.parser)throw new Error(str);this.yy.parser.parseError(str,hash)},setInput:function(input){return this._input=input,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var ch=this._input[0];this.yytext+=ch,this.yyleng++,this.offset++,this.match+=ch,this.matched+=ch;return ch.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),ch},unput:function(ch){var len=ch.length,lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-len-1),this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),lines.length-1&&(this.yylineno-=lines.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-len]),this},more:function(){return this._more=!0,this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;return next.length<20&&(next+=this._input.substr(0,20-next.length)),(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput(),c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var token,match,tempMatch,index,lines;this._more||(this.yytext="",this.match="");for(var rules=this._currentRules(),i=0;i<rules.length&&(!(tempMatch=this._input.match(this.rules[rules[i]]))||match&&!(tempMatch[0].length>match[0].length)||(match=tempMatch,index=i,this.options.flex));i++);return match?((lines=match[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=lines.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length},this.yytext+=match[0],this.match+=match[0],this.matches=match,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(match[0].length),this.matched+=match[0],token=this.performAction.call(this,this.yy,this,rules[index],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),token||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var r=this.next();return void 0!==r?r:this.lex()},begin:function(condition){this.conditionStack.push(condition)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(condition){this.begin(condition)}};return lexer.options={},lexer.performAction=function(yy,yy_,$avoiding_name_collisions,YY_START){function strip(start,end){return yy_.yytext=yy_.yytext.substr(start,yy_.yyleng-end)}switch($avoiding_name_collisions){case 0:if("\\\\"===yy_.yytext.slice(-2)?(strip(0,1),this.begin("mu")):"\\"===yy_.yytext.slice(-1)?(strip(0,1),this.begin("emu")):this.begin("mu"),yy_.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return strip(0,4),this.popState(),15;case 4:return 35;case 5:return 36;case 6:return 25;case 7:return 16;case 8:return 20;case 9:case 10:return 19;case 11:return 23;case 12:return 22;case 13:this.popState(),this.begin("com");break;case 14:return strip(3,5),this.popState(),15;case 15:return 22;case 16:return 41;case 17:case 18:return 40;case 19:return 44;case 20:break;case 21:return this.popState(),24;case 22:return this.popState(),18;case 23:return yy_.yytext=strip(1,2).replace(/\\"/g,'"'),32;case 24:return yy_.yytext=strip(1,2).replace(/\\'/g,"'"),32;case 25:return 42;case 26:case 27:return 34;case 28:return 33;case 29:return 40;case 30:return yy_.yytext=strip(1,2),40;case 31:return"INVALID";case 32:return 5}},lexer.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],lexer.conditions={mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},INITIAL:{rules:[0,1,32],inclusive:!0}},lexer}();return parser.lexer=lexer,Parser.prototype=parser,parser.Parser=Parser,new Parser}()}();return function(__dependency1__,__dependency2__,__dependency3__,__dependency4__,__dependency5__){"use strict";var Handlebars=__module1__,AST=__module7__,Parser=__dependency3__.parser,parse=__dependency3__.parse,Compiler=__dependency4__.Compiler,compile=__dependency4__.compile,precompile=__dependency4__.precompile,JavaScriptCompiler=__dependency5__,_create=Handlebars.create,create=function(){var hb=_create();return hb.compile=function(input,options){return compile(input,options,hb)},hb.precompile=function(input,options){return precompile(input,options,hb)},hb.AST=AST,hb.Compiler=Compiler,hb.JavaScriptCompiler=JavaScriptCompiler,hb.Parser=Parser,hb.parse=parse,hb};return Handlebars=create(),Handlebars.create=create,Handlebars}(0,0,function(__dependency1__,__dependency2__){"use strict";var __exports__={},parser=__module9__,AST=__module7__;return __exports__.parser=parser,__exports__.parse=function(input){return input.constructor===AST.ProgramNode?input:(parser.yy=AST,parser.parse(input))},__exports__}(),function(__dependency1__){"use strict";function Compiler(){}var __exports__={},Exception=__module5__;return __exports__.Compiler=Compiler,Compiler.prototype={compiler:Compiler,disassemble:function(){for(var opcode,params,param,opcodes=this.opcodes,out=[],i=0,l=opcodes.length;i<l;i++)if("DECLARE"===(opcode=opcodes[i]).opcode)out.push("DECLARE "+opcode.name+"="+opcode.value);else{params=[];for(var j=0;j<opcode.args.length;j++)"string"==typeof(param=opcode.args[j])&&(param='"'+param.replace("\n","\\n")+'"'),params.push(param);out.push(opcode.opcode+" "+params.join(" "))}return out.join("\n")},equals:function(other){var len=this.opcodes.length;if(other.opcodes.length!==len)return!1;for(var i=0;i<len;i++){var opcode=this.opcodes[i],otherOpcode=other.opcodes[i];if(opcode.opcode!==otherOpcode.opcode||opcode.args.length!==otherOpcode.args.length)return!1;for(var j=0;j<opcode.args.length;j++)if(opcode.args[j]!==otherOpcode.args[j])return!1}if(len=this.children.length,other.children.length!==len)return!1;for(i=0;i<len;i++)if(!this.children[i].equals(other.children[i]))return!1;return!0},guid:0,compile:function(program,options){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=options;var knownHelpers=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0},knownHelpers)for(var name in knownHelpers)this.options.knownHelpers[name]=knownHelpers[name];return this.accept(program)},accept:function(node){var ret,strip=node.strip||{};return strip.left&&this.opcode("strip"),ret=this[node.type](node),strip.right&&this.opcode("strip"),ret},program:function(program){for(var statements=program.statements,i=0,l=statements.length;i<l;i++)this.accept(statements[i]);return this.isSimple=1===l,this.depths.list=this.depths.list.sort(function(a,b){return a-b}),this},compileProgram:function(program){var depth,result=(new this.compiler).compile(program,this.options),guid=this.guid++;this.usePartial=this.usePartial||result.usePartial,this.children[guid]=result;for(var i=0,l=result.depths.list.length;i<l;i++)(depth=result.depths.list[i])<2||this.addDepth(depth-1);return guid},block:function(block){var mustache=block.mustache,program=block.program,inverse=block.inverse;program&&(program=this.compileProgram(program)),inverse&&(inverse=this.compileProgram(inverse));var sexpr=mustache.sexpr,type=this.classifySexpr(sexpr);"helper"===type?this.helperSexpr(sexpr,program,inverse):"simple"===type?(this.simpleSexpr(sexpr),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousSexpr(sexpr,program,inverse),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(hash){var pair,val,pairs=hash.pairs;this.opcode("pushHash");for(var i=0,l=pairs.length;i<l;i++)val=(pair=pairs[i])[1],this.options.stringParams?(val.depth&&this.addDepth(val.depth),this.opcode("getContext",val.depth||0),this.opcode("pushStringParam",val.stringModeValue,val.type),"sexpr"===val.type&&this.sexpr(val)):this.accept(val),this.opcode("assignToHash",pair[0]);this.opcode("popHash")},partial:function(partial){var partialName=partial.partialName;this.usePartial=!0,partial.context?this.ID(partial.context):this.opcode("push","depth0"),this.opcode("invokePartial",partialName.name),this.opcode("append")},content:function(content){this.opcode("appendContent",content.string)},mustache:function(mustache){this.sexpr(mustache.sexpr),mustache.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousSexpr:function(sexpr,program,inverse){var id=sexpr.id,name=id.parts[0],isBlock=null!=program||null!=inverse;this.opcode("getContext",id.depth),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),this.opcode("invokeAmbiguous",name,isBlock)},simpleSexpr:function(sexpr){var id=sexpr.id;"DATA"===id.type?this.DATA(id):id.parts.length?this.ID(id):(this.addDepth(id.depth),this.opcode("getContext",id.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperSexpr:function(sexpr,program,inverse){var params=this.setupFullMustacheParams(sexpr,program,inverse),name=sexpr.id.parts[0];if(this.options.knownHelpers[name])this.opcode("invokeKnownHelper",params.length,name);else{if(this.options.knownHelpersOnly)throw new Exception("You specified knownHelpersOnly, but used the unknown helper "+name,sexpr);this.opcode("invokeHelper",params.length,name,sexpr.isRoot)}},sexpr:function(sexpr){var type=this.classifySexpr(sexpr);"simple"===type?this.simpleSexpr(sexpr):"helper"===type?this.helperSexpr(sexpr):this.ambiguousSexpr(sexpr)},ID:function(id){this.addDepth(id.depth),this.opcode("getContext",id.depth);id.parts[0]?this.opcode("lookupOnContext",id.parts[0]):this.opcode("pushContext");for(var i=1,l=id.parts.length;i<l;i++)this.opcode("lookup",id.parts[i])},DATA:function(data){if(this.options.data=!0,data.id.isScoped||data.id.depth)throw new Exception("Scoped data references are not supported: "+data.original,data);this.opcode("lookupData");for(var parts=data.id.parts,i=0,l=parts.length;i<l;i++)this.opcode("lookup",parts[i])},STRING:function(string){this.opcode("pushString",string.string)},INTEGER:function(integer){this.opcode("pushLiteral",integer.integer)},BOOLEAN:function(bool){this.opcode("pushLiteral",bool.bool)},comment:function(){},opcode:function(name){this.opcodes.push({opcode:name,args:[].slice.call(arguments,1)})},declare:function(name,value){this.opcodes.push({opcode:"DECLARE",name:name,value:value})},addDepth:function(depth){0!==depth&&(this.depths[depth]||(this.depths[depth]=!0,this.depths.list.push(depth)))},classifySexpr:function(sexpr){var isHelper=sexpr.isHelper,isEligible=sexpr.eligibleHelper,options=this.options;if(isEligible&&!isHelper){var name=sexpr.id.parts[0];options.knownHelpers[name]?isHelper=!0:options.knownHelpersOnly&&(isEligible=!1)}return isHelper?"helper":isEligible?"ambiguous":"simple"},pushParams:function(params){for(var param,i=params.length;i--;)param=params[i],this.options.stringParams?(param.depth&&this.addDepth(param.depth),this.opcode("getContext",param.depth||0),this.opcode("pushStringParam",param.stringModeValue,param.type),"sexpr"===param.type&&this.sexpr(param)):this[param.type](param)},setupFullMustacheParams:function(sexpr,program,inverse){var params=sexpr.params;return this.pushParams(params),this.opcode("pushProgram",program),this.opcode("pushProgram",inverse),sexpr.hash?this.hash(sexpr.hash):this.opcode("emptyHash"),params}},__exports__.precompile=function(input,options,env){if(null==input||"string"!=typeof input&&input.constructor!==env.AST.ProgramNode)throw new Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+input);"data"in(options=options||{})||(options.data=!0);var ast=env.parse(input),environment=(new env.Compiler).compile(ast,options);return(new env.JavaScriptCompiler).compile(environment,options)},__exports__.compile=function(input,options,env){function compileInput(){var ast=env.parse(input),environment=(new env.Compiler).compile(ast,options),templateSpec=(new env.JavaScriptCompiler).compile(environment,options,void 0,!0);return env.template(templateSpec)}if(null==input||"string"!=typeof input&&input.constructor!==env.AST.ProgramNode)throw new Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+input);"data"in(options=options||{})||(options.data=!0);var compiled;return function(context,options){return compiled||(compiled=compileInput()),compiled.call(this,context,options)}},__exports__}(),function(__dependency1__,__dependency2__){"use strict";function Literal(value){this.value=value}function JavaScriptCompiler(){}var COMPILER_REVISION=__dependency1__.COMPILER_REVISION,REVISION_CHANGES=__dependency1__.REVISION_CHANGES,log=__dependency1__.log,Exception=__dependency2__;JavaScriptCompiler.prototype={nameLookup:function(parent,name){var wrap,ret;return 0===parent.indexOf("depth")&&(wrap=!0),ret=/^[0-9]+$/.test(name)?parent+"["+name+"]":JavaScriptCompiler.isValidJavaScriptVariableName(name)?parent+"."+name:parent+"['"+name+"']",wrap?"("+parent+" && "+ret+")":ret},compilerInfo:function(){return"this.compilerInfo = ["+COMPILER_REVISION+",'"+REVISION_CHANGES[COMPILER_REVISION]+"'];\n"},appendToBuffer:function(string){return this.environment.isSimple?"return "+string+";":{appendToBuffer:!0,content:string,toString:function(){return"buffer += "+string+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(environment,options,context,asObject){this.environment=environment,this.options=options||{},log("debug",this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!context,this.context=context||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.compileChildren(environment,options);var opcode,opcodes=environment.opcodes;this.i=0;for(var l=opcodes.length;this.i<l;this.i++)"DECLARE"===(opcode=opcodes[this.i]).opcode?this[opcode.name]=opcode.value:this[opcode.opcode].apply(this,opcode.args),opcode.opcode!==this.stripNext&&(this.stripNext=!1);if(this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new Exception("Compile completed with content left on stack");return this.createFunctionContext(asObject)},preamble:function(){var out=[];if(this.isChild)out.push("");else{var namespace=this.namespace,copies="helpers = this.merge(helpers, "+namespace+".helpers);";this.environment.usePartial&&(copies=copies+" partials = this.merge(partials, "+namespace+".partials);"),this.options.data&&(copies+=" data = data || {};"),out.push(copies)}this.environment.isSimple?out.push(""):out.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=out},createFunctionContext:function(asObject){var locals=this.stackVars.concat(this.registers.list);if(locals.length>0&&(this.source[1]=this.source[1]+", "+locals.join(", ")),!this.isChild)for(var alias in this.context.aliases)this.context.aliases.hasOwnProperty(alias)&&(this.source[1]=this.source[1]+", "+alias+"="+this.context.aliases[alias]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.pushSource("return buffer;");for(var params=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],i=0,l=this.environment.depths.list.length;i<l;i++)params.push("depth"+this.environment.depths.list[i]);var source=this.mergeSource();if(this.isChild||(source=this.compilerInfo()+source),asObject)return params.push(source),Function.apply(this,params);var functionSource="function "+(this.name||"")+"("+params.join(",")+") {\n  "+source+"}";return log("debug",functionSource+"\n\n"),functionSource},mergeSource:function(){for(var buffer,source="",i=0,len=this.source.length;i<len;i++){var line=this.source[i];line.appendToBuffer?buffer=buffer?buffer+"\n    + "+line.content:line.content:(buffer&&(source+="buffer += "+buffer+";\n  ",buffer=void 0),source+=line+"\n  ")}return source},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var params=["depth0"];this.setupParams(0,params),this.replaceStack(function(current){return params.splice(1,0,current),"blockHelperMissing.call("+params.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var params=["depth0"];this.setupParams(0,params);var current=this.topStack();params.splice(1,0,current),this.pushSource("if (!"+this.lastHelper+") { "+current+" = blockHelperMissing.call("+params.join(", ")+"); }")},appendContent:function(content){this.pendingContent&&(content=this.pendingContent+content),this.stripNext&&(content=content.replace(/^\s+/,"")),this.pendingContent=content},strip:function(){this.pendingContent&&(this.pendingContent=this.pendingContent.replace(/\s+$/,"")),this.stripNext="strip"},append:function(){this.flushInline();var local=this.popStack();this.pushSource("if("+local+" || "+local+" === 0) { "+this.appendToBuffer(local)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(depth){this.lastContext!==depth&&(this.lastContext=depth)},lookupOnContext:function(name){this.push(this.nameLookup("depth"+this.lastContext,name,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(current){return"typeof "+current+" === functionType ? "+current+".apply(depth0) : "+current})},lookup:function(name){this.replaceStack(function(current){return current+" == null || "+current+" === false ? "+current+" : "+this.nameLookup(current,name,"context")})},lookupData:function(){this.pushStackLiteral("data")},pushStringParam:function(string,type){this.pushStackLiteral("depth"+this.lastContext),this.pushString(type),"sexpr"!==type&&("string"==typeof string?this.pushString(string):this.pushStackLiteral(string))},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.push("{}"),this.push("{}"))},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[]}},popHash:function(){var hash=this.hash;this.hash=this.hashes.pop(),this.options.stringParams&&(this.push("{"+hash.contexts.join(",")+"}"),this.push("{"+hash.types.join(",")+"}")),this.push("{\n    "+hash.values.join(",\n    ")+"\n  }")},pushString:function(string){this.pushStackLiteral(this.quotedString(string))},push:function(expr){return this.inlineStack.push(expr),expr},pushLiteral:function(value){this.pushStackLiteral(value)},pushProgram:function(guid){null!=guid?this.pushStackLiteral(this.programExpression(guid)):this.pushStackLiteral(null)},invokeHelper:function(paramSize,name,isRoot){this.context.aliases.helperMissing="helpers.helperMissing",this.useRegister("helper");var helper=this.lastHelper=this.setupHelper(paramSize,name,!0),nonHelper=this.nameLookup("depth"+this.lastContext,name,"context"),lookup="helper = "+helper.name+" || "+nonHelper;helper.paramsInit&&(lookup+=","+helper.paramsInit),this.push("("+lookup+",helper ? helper.call("+helper.callParams+") : helperMissing.call("+helper.helperMissingParams+"))"),isRoot||this.flushInline()},invokeKnownHelper:function(paramSize,name){var helper=this.setupHelper(paramSize,name);this.push(helper.name+".call("+helper.callParams+")")},invokeAmbiguous:function(name,helperCall){this.context.aliases.functionType='"function"',this.useRegister("helper"),this.emptyHash();var helper=this.setupHelper(0,name,helperCall),helperName=this.lastHelper=this.nameLookup("helpers",name,"helper"),nonHelper=this.nameLookup("depth"+this.lastContext,name,"context"),nextStack=this.nextStack();helper.paramsInit&&this.pushSource(helper.paramsInit),this.pushSource("if (helper = "+helperName+") { "+nextStack+" = helper.call("+helper.callParams+"); }"),this.pushSource("else { helper = "+nonHelper+"; "+nextStack+" = typeof helper === functionType ? helper.call("+helper.callParams+") : helper; }")},invokePartial:function(name){var params=[this.nameLookup("partials",name,"partial"),"'"+name+"'",this.popStack(),"helpers","partials"];this.options.data&&params.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+params.join(", ")+")")},assignToHash:function(key){var context,type,value=this.popStack();this.options.stringParams&&(type=this.popStack(),context=this.popStack());var hash=this.hash;context&&hash.contexts.push("'"+key+"': "+context),type&&hash.types.push("'"+key+"': "+type),hash.values.push("'"+key+"': ("+value+")")},compiler:JavaScriptCompiler,compileChildren:function(environment,options){for(var child,compiler,children=environment.children,i=0,l=children.length;i<l;i++){child=children[i],compiler=new this.compiler;var index=this.matchExistingProgram(child);null==index?(this.context.programs.push(""),index=this.context.programs.length,child.index=index,child.name="program"+index,this.context.programs[index]=compiler.compile(child,options,this.context),this.context.environments[index]=child):(child.index=index,child.name="program"+index)}},matchExistingProgram:function(child){for(var i=0,len=this.context.environments.length;i<len;i++){var environment=this.context.environments[i];if(environment&&environment.equals(child))return i}},programExpression:function(guid){if(this.context.aliases.self="this",null==guid)return"self.noop";for(var depth,child=this.environment.children[guid],depths=child.depths.list,programParams=[child.index,child.name,"data"],i=0,l=depths.length;i<l;i++)1===(depth=depths[i])?programParams.push("depth0"):programParams.push("depth"+(depth-1));return(0===depths.length?"self.program(":"self.programWithDepth(")+programParams.join(", ")+")"},register:function(name,val){this.useRegister(name),this.pushSource(name+" = "+val+";")},useRegister:function(name){this.registers[name]||(this.registers[name]=!0,this.registers.list.push(name))},pushStackLiteral:function(item){return this.push(new Literal(item))},pushSource:function(source){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=void 0),source&&this.source.push(source)},pushStack:function(item){this.flushInline();var stack=this.incrStack();return item&&this.pushSource(stack+" = "+item+";"),this.compileStack.push(stack),stack},replaceStack:function(callback){var stack,createdStack,usedLiteral,prefix="",inline=this.isInline();if(inline){var top=this.popStack(!0);if(top instanceof Literal)stack=top.value,usedLiteral=!0;else{var name=(createdStack=!this.stackSlot)?this.incrStack():this.topStackName();prefix="("+this.push(name)+" = "+top+"),",stack=this.topStack()}}else stack=this.topStack();var item=callback.call(this,stack);return inline?(usedLiteral||this.popStack(),createdStack&&this.stackSlot--,this.push("("+prefix+item+")")):(/^stack/.test(stack)||(stack=this.nextStack()),this.pushSource(stack+" = ("+prefix+item+");")),stack},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var inlineStack=this.inlineStack;if(inlineStack.length){this.inlineStack=[];for(var i=0,len=inlineStack.length;i<len;i++){var entry=inlineStack[i];entry instanceof Literal?this.compileStack.push(entry):this.pushStack(entry)}}},isInline:function(){return this.inlineStack.length},popStack:function(wrapped){var inline=this.isInline(),item=(inline?this.inlineStack:this.compileStack).pop();if(!wrapped&&item instanceof Literal)return item.value;if(!inline){if(!this.stackSlot)throw new Exception("Invalid stack pop");this.stackSlot--}return item},topStack:function(wrapped){var stack=this.isInline()?this.inlineStack:this.compileStack,item=stack[stack.length-1];return!wrapped&&item instanceof Literal?item.value:item},quotedString:function(str){return'"'+str.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(paramSize,name,missingParams){var params=[];return{params:params,paramsInit:this.setupParams(paramSize,params,missingParams),name:this.nameLookup("helpers",name,"helper"),callParams:["depth0"].concat(params).join(", "),helperMissingParams:missingParams&&["depth0",this.quotedString(name)].concat(params).join(", ")}},setupOptions:function(paramSize,params){var param,inverse,program,options=[],contexts=[],types=[];options.push("hash:"+this.popStack()),this.options.stringParams&&(options.push("hashTypes:"+this.popStack()),options.push("hashContexts:"+this.popStack())),inverse=this.popStack(),((program=this.popStack())||inverse)&&(program||(this.context.aliases.self="this",program="self.noop"),inverse||(this.context.aliases.self="this",inverse="self.noop"),options.push("inverse:"+inverse),options.push("fn:"+program));for(var i=0;i<paramSize;i++)param=this.popStack(),params.push(param),this.options.stringParams&&(types.push(this.popStack()),contexts.push(this.popStack()));return this.options.stringParams&&(options.push("contexts:["+contexts.join(",")+"]"),options.push("types:["+types.join(",")+"]")),this.options.data&&options.push("data:data"),options},setupParams:function(paramSize,params,useRegister){var options="{"+this.setupOptions(paramSize,params).join(",")+"}";return useRegister?(this.useRegister("options"),params.push("options"),"options="+options):(params.push(options),"")}};for(var reservedWords="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),compilerWords=JavaScriptCompiler.RESERVED_WORDS={},i=0,l=reservedWords.length;i<l;i++)compilerWords[reservedWords[i]]=!0;return JavaScriptCompiler.isValidJavaScriptVariableName=function(name){return!(JavaScriptCompiler.RESERVED_WORDS[name]||!/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(name))},JavaScriptCompiler}(__module2__,__module5__))}();!function($){$.version={versionStr:"2.3.1",major:parseInt("2",10),minor:parseInt("3",10),revision:parseInt("1",10)};var class2type={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},toString=Object.prototype.toString,hasOwn=Object.prototype.hasOwnProperty;$.isFunction=function(obj){return"function"===$.type(obj)},$.isArray=Array.isArray||function(obj){return"array"===$.type(obj)},$.isWindow=function(obj){return obj&&"object"==typeof obj&&"setInterval"in obj},$.type=function(obj){return null===obj||void 0===obj?String(obj):class2type[toString.call(obj)]||"object"},$.isPlainObject=function(obj){if(!obj||"object"!==OpenSeadragon.type(obj)||obj.nodeType||$.isWindow(obj))return!1;if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1;var lastKey;for(var key in obj)lastKey=key;return void 0===lastKey||hasOwn.call(obj,lastKey)},$.isEmptyObject=function(obj){for(var name in obj)return!1;return!0},$.freezeObject=function(obj){return Object.freeze?$.freezeObject=Object.freeze:$.freezeObject=function(obj){return obj},$.freezeObject(obj)},$.supportsCanvas=function(){var canvasElement=document.createElement("canvas");return!(!$.isFunction(canvasElement.getContext)||!canvasElement.getContext("2d"))}(),$.isCanvasTainted=function(canvas){var isTainted=!1;try{canvas.getContext("2d").getImageData(0,0,1,1)}catch(e){isTainted=!0}return isTainted},$.pixelDensityRatio=function(){if($.supportsCanvas){var context=document.createElement("canvas").getContext("2d"),devicePixelRatio=window.devicePixelRatio||1,backingStoreRatio=context.webkitBackingStorePixelRatio||context.mozBackingStorePixelRatio||context.msBackingStorePixelRatio||context.oBackingStorePixelRatio||context.backingStorePixelRatio||1;return Math.max(devicePixelRatio,1)/backingStoreRatio}return 1}()}(OpenSeadragon),function($){function getOffsetParent(element,isFixed){return isFixed&&element!=document.body?document.body:element.offsetParent}$.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},length=arguments.length,deep=!1,i=1;for("boolean"==typeof target&&(deep=target,target=arguments[1]||{},i=2),"object"==typeof target||OpenSeadragon.isFunction(target)||(target={}),length===i&&(target=this,--i);i<length;i++)if(null!==(options=arguments[i])||void 0!==options)for(name in options)src=target[name],target!==(copy=options[name])&&(deep&&copy&&(OpenSeadragon.isPlainObject(copy)||(copyIsArray=OpenSeadragon.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&OpenSeadragon.isArray(src)?src:[]):clone=src&&OpenSeadragon.isPlainObject(src)?src:{},target[name]=OpenSeadragon.extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var userAgent=navigator.userAgent;return"string"==typeof userAgent&&(-1!==userAgent.indexOf("iPhone")||-1!==userAgent.indexOf("iPad")||-1!==userAgent.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,degrees:0,opacity:1,preload:!1,compositeOperation:null,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(object,method){return function(){var args=arguments;return void 0===args&&(args=[]),method.apply(object,args)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(element){return"string"==typeof element&&(element=document.getElementById(element)),element},getElementPosition:function(element){var isFixed,offsetParent,result=new $.Point;for(offsetParent=getOffsetParent(element=$.getElement(element),isFixed="fixed"==$.getElementStyle(element).position);offsetParent;)result.x+=element.offsetLeft,result.y+=element.offsetTop,isFixed&&(result=result.plus($.getPageScroll())),offsetParent=getOffsetParent(element=offsetParent,isFixed="fixed"==$.getElementStyle(element).position);return result},getElementOffset:function(element){var docElement,win,doc=(element=$.getElement(element))&&element.ownerDocument,boundingRect={top:0,left:0};return doc?(docElement=doc.documentElement,void 0!==element.getBoundingClientRect&&(boundingRect=element.getBoundingClientRect()),win=doc==doc.window?doc:9===doc.nodeType&&(doc.defaultView||doc.parentWindow),new $.Point(boundingRect.left+(win.pageXOffset||docElement.scrollLeft)-(docElement.clientLeft||0),boundingRect.top+(win.pageYOffset||docElement.scrollTop)-(docElement.clientTop||0))):new $.Point},getElementSize:function(element){return element=$.getElement(element),new $.Point(element.clientWidth,element.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(element){return(element=$.getElement(element)).currentStyle}:function(element){return element=$.getElement(element),window.getComputedStyle(element,"")},getCssPropertyWithVendorPrefix:function(property){var memo={};return $.getCssPropertyWithVendorPrefix=function(property){if(void 0!==memo[property])return memo[property];var style=document.createElement("div").style,result=null;if(void 0!==style[property])result=property;else for(var prefixes=["Webkit","Moz","MS","O","webkit","moz","ms","o"],suffix=$.capitalizeFirstLetter(property),i=0;i<prefixes.length;i++){var prop=prefixes[i]+suffix;if(void 0!==style[prop]){result=prop;break}}return memo[property]=result,result},$.getCssPropertyWithVendorPrefix(property)},capitalizeFirstLetter:function(string){return string.charAt(0).toUpperCase()+string.slice(1)},positiveModulo:function(number,modulo){var result=number%modulo;return result<0&&(result+=modulo),result},pointInElement:function(element,point){element=$.getElement(element);var offset=$.getElementOffset(element),size=$.getElementSize(element);return point.x>=offset.x&&point.x<offset.x+size.x&&point.y<offset.y+size.y&&point.y>=offset.y},getEvent:function(event){return $.getEvent=event?function(event){return event}:function(){return window.event},$.getEvent(event)},getMousePosition:function(event){if("number"==typeof event.pageX)$.getMousePosition=function(event){var result=new $.Point;return event=$.getEvent(event),result.x=event.pageX,result.y=event.pageY,result};else{if("number"!=typeof event.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(event){var result=new $.Point;return event=$.getEvent(event),result.x=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,result.y=event.clientY+document.body.scrollTop+document.documentElement.scrollTop,result}}return $.getMousePosition(event)},getPageScroll:function(){var docElement=document.documentElement||{},body=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(body.scrollLeft||body.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!docElement.scrollLeft&&!docElement.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(scroll){if(void 0!==window.scrollTo)$.setPageScroll=function(scroll){window.scrollTo(scroll.x,scroll.y)};else{var originalScroll=$.getPageScroll();if(originalScroll.x===scroll.x&&originalScroll.y===scroll.y)return;document.body.scrollLeft=scroll.x,document.body.scrollTop=scroll.y;var currentScroll=$.getPageScroll();if(currentScroll.x!==originalScroll.x&&currentScroll.y!==originalScroll.y)return void($.setPageScroll=function(scroll){document.body.scrollLeft=scroll.x,document.body.scrollTop=scroll.y});if(document.documentElement.scrollLeft=scroll.x,document.documentElement.scrollTop=scroll.y,(currentScroll=$.getPageScroll()).x!==originalScroll.x&&currentScroll.y!==originalScroll.y)return void($.setPageScroll=function(scroll){document.documentElement.scrollLeft=scroll.x,document.documentElement.scrollTop=scroll.y});$.setPageScroll=function(scroll){}}return $.setPageScroll(scroll)},getWindowSize:function(){var docElement=document.documentElement||{},body=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(docElement.clientWidth||docElement.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!body.clientWidth&&!body.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(element){element=$.getElement(element);var wrappers=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(wrappers[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(wrappers[1].style,{display:"table-row"}),$.extend(wrappers[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),wrappers[0].appendChild(wrappers[1]),wrappers[1].appendChild(wrappers[2]),wrappers[2].appendChild(element),wrappers[0]},makeNeutralElement:function(tagName){var element=document.createElement(tagName),style=element.style;return style.background="transparent none",style.border="none",style.margin="0px",style.padding="0px",style.position="static",element},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(src){return $.makeTransparentImage=function(src){var img=$.makeNeutralElement("img");return img.src=src,img},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(src){var img=$.makeNeutralElement("img"),element=null;return element=$.makeNeutralElement("span"),element.style.display="inline-block",img.onload=function(){element.style.width=element.style.width||img.width+"px",element.style.height=element.style.height||img.height+"px",img.onload=null,img=null},img.src=src,element.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+src+"', sizingMethod='scale')",element}),$.makeTransparentImage(src)},setElementOpacity:function(element,opacity,usesAlpha){var ieFilter;element=$.getElement(element),usesAlpha&&!$.Browser.alpha&&(opacity=Math.round(opacity)),$.Browser.opacity?element.style.opacity=opacity<1?opacity:"":opacity<1?(ieFilter="alpha(opacity="+Math.round(100*opacity)+")",element.style.filter=ieFilter):element.style.filter=""},setElementTouchActionNone:function(element){void 0!==(element=$.getElement(element)).style.touchAction?element.style.touchAction="none":void 0!==element.style.msTouchAction&&(element.style.msTouchAction="none")},addClass:function(element,className){(element=$.getElement(element)).className?-1===(" "+element.className+" ").indexOf(" "+className+" ")&&(element.className+=" "+className):element.className=className},indexOf:function(array,searchElement,fromIndex){return Array.prototype.indexOf?this.indexOf=function(array,searchElement,fromIndex){return array.indexOf(searchElement,fromIndex)}:this.indexOf=function(array,searchElement,fromIndex){var i,length,pivot=fromIndex||0;if(!array)throw new TypeError;if(0===(length=array.length)||pivot>=length)return-1;for(pivot<0&&(pivot=length-Math.abs(pivot)),i=pivot;i<length;i++)if(array[i]===searchElement)return i;return-1},this.indexOf(array,searchElement,fromIndex)},removeClass:function(element,className){var oldClasses,i,newClasses=[];for(oldClasses=(element=$.getElement(element)).className.split(/\s+/),i=0;i<oldClasses.length;i++)oldClasses[i]&&oldClasses[i]!==className&&newClasses.push(oldClasses[i]);element.className=newClasses.join(" ")},addEvent:function(){if(window.addEventListener)return function(element,eventName,handler,useCapture){(element=$.getElement(element)).addEventListener(eventName,handler,useCapture)};if(window.attachEvent)return function(element,eventName,handler,useCapture){(element=$.getElement(element)).attachEvent("on"+eventName,handler)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(element,eventName,handler,useCapture){(element=$.getElement(element)).removeEventListener(eventName,handler,useCapture)};if(window.detachEvent)return function(element,eventName,handler,useCapture){(element=$.getElement(element)).detachEvent("on"+eventName,handler)};throw new Error("No known event model.")}(),cancelEvent:function(event){(event=$.getEvent(event)).preventDefault?$.cancelEvent=function(event){event.preventDefault()}:$.cancelEvent=function(event){(event=$.getEvent(event)).cancel=!0,event.returnValue=!1},$.cancelEvent(event)},stopEvent:function(event){(event=$.getEvent(event)).stopPropagation?$.stopEvent=function(event){event.stopPropagation()}:$.stopEvent=function(event){(event=$.getEvent(event)).cancelBubble=!0},$.stopEvent(event)},createCallback:function(object,method){var i,initialArgs=[];for(i=2;i<arguments.length;i++)initialArgs.push(arguments[i]);return function(){var i,args=initialArgs.concat([]);for(i=0;i<arguments.length;i++)args.push(arguments[i]);return method.apply(object,args)}},getUrlParameter:function(key){var value=URLPARAMS[key];return value||null},getUrlProtocol:function(url){var match=url.match(/^([a-z]+:)\/\//i);return null===match?window.location.protocol:match[1].toLowerCase()},createAjaxRequest:function(local){var supportActiveX;try{supportActiveX=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){supportActiveX=!1}if(supportActiveX)window.XMLHttpRequest?$.createAjaxRequest=function(local){return local?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(local)},makeAjaxRequest:function(url,onSuccess,onError){var withCredentials,headers,responseType;$.isPlainObject(url)&&(onSuccess=url.success,onError=url.error,withCredentials=url.withCredentials,headers=url.headers,responseType=url.responseType||null,url=url.url);var protocol=$.getUrlProtocol(url),request=$.createAjaxRequest("file:"===protocol);if(!$.isFunction(onSuccess))throw new Error("makeAjaxRequest requires a success callback");request.onreadystatechange=function(){4==request.readyState&&(request.onreadystatechange=function(){},request.status>=200&&request.status<300||0===request.status&&"http:"!==protocol&&"https:"!==protocol?onSuccess(request):($.console.log("AJAX request returned %d: %s",request.status,url),$.isFunction(onError)&&onError(request)))};try{if(request.open("GET",url,!0),responseType&&(request.responseType=responseType),headers)for(var headerName in headers)headers.hasOwnProperty(headerName)&&headers[headerName]&&request.setRequestHeader(headerName,headers[headerName]);withCredentials&&(request.withCredentials=!0),request.send(null)}catch(e){var msg=e.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==e.number&&-2147024891==e.number&&(msg+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",e.name,msg),request.onreadystatechange=function(){},window.XDomainRequest){var xdr=new XDomainRequest;if(xdr){xdr.onload=function(e){$.isFunction(onSuccess)&&onSuccess({responseText:xdr.responseText,status:200,statusText:"OK"})},xdr.onerror=function(e){$.isFunction(onError)&&onError({responseText:xdr.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{xdr.open("GET",url),xdr.send()}catch(e2){$.isFunction(onError)&&onError(request,e)}}}else $.isFunction(onError)&&onError(request,e)}return request},jsonp:function(options){var script,url=options.url,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement,jsonpCallback=options.callbackName||"openseadragon"+$.now(),previous=window[jsonpCallback],replace="$1"+jsonpCallback+"$2",callbackParam=options.param||"callback",callback=options.callback;url=url.replace(/(\=)\?(&|$)|\?\?/i,replace),url+=(/\?/.test(url)?"&":"?")+callbackParam+"="+jsonpCallback,window[jsonpCallback]=function(response){if(previous)window[jsonpCallback]=previous;else try{delete window[jsonpCallback]}catch(e){}callback&&$.isFunction(callback)&&callback(response)},script=document.createElement("script"),void 0===options.async&&!1===options.async||(script.async="async"),options.scriptCharset&&(script.charset=options.scriptCharset),script.src=url,script.onload=script.onreadystatechange=function(_,isAbort){(isAbort||!script.readyState||/loaded|complete/.test(script.readyState))&&(script.onload=script.onreadystatechange=null,head&&script.parentNode&&head.removeChild(script),script=void 0)},head.insertBefore(script,head.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(string){if(window.DOMParser)$.parseXml=function(string){var parser;return parser=new DOMParser,parser.parseFromString(string,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(string){var xmlDoc=null;return xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async=!1,xmlDoc.loadXML(string),xmlDoc}}return $.parseXml(string)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(extension){return extension=extension||"",!!FILEFORMATS[extension.toLowerCase()]}}),$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};!function(){var ver=navigator.appVersion,ua=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(ua.substring(ua.indexOf("MSIE")+5,ua.indexOf(";",ua.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(ua.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(ua.substring(ua.indexOf("Firefox")+8))):ua.indexOf("Safari")>=0?($.Browser.vendor=ua.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(ua.substring(ua.substring(0,ua.indexOf("Safari")).lastIndexOf("/")+1,ua.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(ua)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(ver)}var part,sep,i,parts=window.location.search.substring(1).split("&");for(i=0;i<parts.length;i++)(sep=(part=parts[i]).indexOf("="))>0&&(URLPARAMS[part.substring(0,sep)]=decodeURIComponent(part.substring(sep+1)));$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}();var nullfunction=function(msg){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},function(w){var requestAnimationFrame=w.requestAnimationFrame||w.mozRequestAnimationFrame||w.webkitRequestAnimationFrame||w.msRequestAnimationFrame,cancelAnimationFrame=w.cancelAnimationFrame||w.mozCancelAnimationFrame||w.webkitCancelAnimationFrame||w.msCancelAnimationFrame;if(requestAnimationFrame&&cancelAnimationFrame)$.requestAnimationFrame=function(){return requestAnimationFrame.apply(w,arguments)},$.cancelAnimationFrame=function(){return cancelAnimationFrame.apply(w,arguments)};else{var iIntervalId,aAnimQueue=[],processing=[],iRequestId=0;$.requestAnimationFrame=function(callback){return aAnimQueue.push([++iRequestId,callback]),iIntervalId||(iIntervalId=setInterval(function(){if(aAnimQueue.length){var time=$.now(),temp=processing;for(processing=aAnimQueue,aAnimQueue=temp;processing.length;)processing.shift()[1](time)}else clearInterval(iIntervalId),iIntervalId=void 0},20)),iRequestId},$.cancelAnimationFrame=function(requestId){var i,j;for(i=0,j=aAnimQueue.length;i<j;i+=1)if(aAnimQueue[i][0]===requestId)return void aAnimQueue.splice(i,1);for(i=0,j=processing.length;i<j;i+=1)if(processing[i][0]===requestId)return void processing.splice(i,1)}}}(window)}(OpenSeadragon),function(root,factory){"function"==typeof define&&define.amd?define([],factory):"object"==typeof module&&module.exports?module.exports=factory():root.OpenSeadragon=factory()}(this,function(){return OpenSeadragon}),function($){var fullScreenApi={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.fullscreenElement},fullScreenApi.requestFullScreen=function(element){return element.requestFullscreen()},fullScreenApi.exitFullScreen=function(){document.exitFullscreen()},fullScreenApi.fullScreenEventName="fullscreenchange",fullScreenApi.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.msFullscreenElement},fullScreenApi.requestFullScreen=function(element){return element.msRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.msExitFullscreen()},fullScreenApi.fullScreenEventName="MSFullscreenChange",fullScreenApi.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitFullscreenElement},fullScreenApi.requestFullScreen=function(element){return element.webkitRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.webkitExitFullscreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},fullScreenApi.requestFullScreen=function(element){return element.webkitRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.webkitCancelFullScreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.mozFullScreenElement},fullScreenApi.requestFullScreen=function(element){return element.mozRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.mozCancelFullScreen()},fullScreenApi.fullScreenEventName="mozfullscreenchange",fullScreenApi.fullScreenErrorEventName="mozfullscreenerror"),fullScreenApi.isFullScreen=function(){return null!==fullScreenApi.getFullScreenElement()},fullScreenApi.cancelFullScreen=function(){$.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),fullScreenApi.exitFullScreen()},$.extend($,fullScreenApi)}(OpenSeadragon),function($){$.EventSource=function(){this.events={}},$.EventSource.prototype={addOnceHandler:function(eventName,handler,userData,times){var self=this;times=times||1;var count=0,onceHandler=function(event){++count===times&&self.removeHandler(eventName,onceHandler),handler(event)};this.addHandler(eventName,onceHandler,userData)},addHandler:function(eventName,handler,userData){var events=this.events[eventName];events||(this.events[eventName]=events=[]),handler&&$.isFunction(handler)&&(events[events.length]={handler:handler,userData:userData||null})},removeHandler:function(eventName,handler){var i,events=this.events[eventName],handlers=[];if(events&&$.isArray(events)){for(i=0;i<events.length;i++)events[i].handler!==handler&&handlers.push(events[i]);this.events[eventName]=handlers}},removeAllHandlers:function(eventName){if(eventName)this.events[eventName]=[];else for(var eventType in this.events)this.events[eventType]=[]},getHandler:function(eventName){var events=this.events[eventName];return events&&events.length?(events=1===events.length?[events[0]]:Array.apply(null,events),function(source,args){var i,length=events.length;for(i=0;i<length;i++)events[i]&&(args.eventSource=source,args.userData=events[i].userData,events[i].handler(args))}):null},raiseEvent:function(eventName,eventArgs){var handler=this.getHandler(eventName);handler&&(eventArgs||(eventArgs={}),handler(this,eventArgs))}}}(OpenSeadragon),function($){function clearTrackedPointers(tracker){var i,delegate=THIS[tracker.hash],pointerListCount=delegate.activePointersLists.length;for(i=0;i<pointerListCount;i++)delegate.activePointersLists[i].captureCount>0&&($.removeEvent($.MouseTracker.captureElement,"mousemove",delegate.mousemovecaptured,!0),$.removeEvent($.MouseTracker.captureElement,"mouseup",delegate.mouseupcaptured,!0),$.removeEvent($.MouseTracker.captureElement,$.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",delegate.pointermovecaptured,!0),$.removeEvent($.MouseTracker.captureElement,$.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",delegate.pointerupcaptured,!0),$.removeEvent($.MouseTracker.captureElement,"touchmove",delegate.touchmovecaptured,!0),$.removeEvent($.MouseTracker.captureElement,"touchend",delegate.touchendcaptured,!0),delegate.activePointersLists[i].captureCount=0);for(i=0;i<pointerListCount;i++)delegate.activePointersLists.pop()}function stopTracking(tracker){var event,i,delegate=THIS[tracker.hash];if(delegate.tracking){for(i=0;i<$.MouseTracker.subscribeEvents.length;i++)event=$.MouseTracker.subscribeEvents[i],$.removeEvent(tracker.element,event,delegate[event],!1);clearTrackedPointers(tracker),delegate.tracking=!1}}function getCaptureEventParams(tracker,pointerType){var delegate=THIS[tracker.hash];if("pointerevent"===pointerType)return{upName:$.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:delegate.pointerupcaptured,moveName:$.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:delegate.pointermovecaptured};if("mouse"===pointerType)return{upName:"mouseup",upHandler:delegate.mouseupcaptured,moveName:"mousemove",moveHandler:delegate.mousemovecaptured};if("touch"===pointerType)return{upName:"touchend",upHandler:delegate.touchendcaptured,moveName:"touchmove",moveHandler:delegate.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function capturePointer(tracker,pointerType,pointerCount){var eventParams,pointsList=tracker.getActivePointersListByType(pointerType);pointsList.captureCount+=pointerCount||1,1===pointsList.captureCount&&($.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?tracker.element.setCapture(!0):(eventParams=getCaptureEventParams(tracker,$.MouseTracker.havePointerEvents?"pointerevent":pointerType),isInIframe&&canAccessEvents(window.top)&&$.addEvent(window.top,eventParams.upName,eventParams.upHandler,!0),$.addEvent($.MouseTracker.captureElement,eventParams.upName,eventParams.upHandler,!0),$.addEvent($.MouseTracker.captureElement,eventParams.moveName,eventParams.moveHandler,!0)))}function releasePointer(tracker,pointerType,pointerCount){var eventParams,pointsList=tracker.getActivePointersListByType(pointerType);pointsList.captureCount-=pointerCount||1,0===pointsList.captureCount&&($.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?tracker.element.releaseCapture():(eventParams=getCaptureEventParams(tracker,$.MouseTracker.havePointerEvents?"pointerevent":pointerType),isInIframe&&canAccessEvents(window.top)&&$.removeEvent(window.top,eventParams.upName,eventParams.upHandler,!0),$.removeEvent($.MouseTracker.captureElement,eventParams.moveName,eventParams.moveHandler,!0),$.removeEvent($.MouseTracker.captureElement,eventParams.upName,eventParams.upHandler,!0)))}function getPointerType(event){var pointerTypeStr;if($.MouseTracker.unprefixedPointerEvents)pointerTypeStr=event.pointerType;else switch(event.pointerType){case 2:pointerTypeStr="touch";break;case 3:pointerTypeStr="pen";break;case 4:pointerTypeStr="mouse";break;default:pointerTypeStr=""}return pointerTypeStr}function getMouseAbsolute(event){return $.getMousePosition(event)}function getMouseRelative(event,element){return getPointRelativeToAbsolute(getMouseAbsolute(event),element)}function getPointRelativeToAbsolute(point,element){var offset=$.getElementOffset(element);return point.minus(offset)}function getCenterPoint(point1,point2){return new $.Point((point1.x+point2.x)/2,(point1.y+point2.y)/2)}function onMouseWheel(tracker,event){var simulatedEvent={target:(event=$.getEvent(event)).target||event.srcElement,type:"wheel",shiftKey:event.shiftKey||!1,clientX:event.clientX,clientY:event.clientY,pageX:event.pageX?event.pageX:event.clientX,pageY:event.pageY?event.pageY:event.clientY,deltaMode:"MozMousePixelScroll"==event.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==$.MouseTracker.wheelEventName?simulatedEvent.deltaY=-event.wheelDelta/$.DEFAULT_SETTINGS.pixelsPerWheelLine:simulatedEvent.deltaY=event.detail,handleWheelEvent(tracker,simulatedEvent,event)}function handleWheelEvent(tracker,event,originalEvent){var nDelta=0;nDelta=event.deltaY<0?1:-1,tracker.scrollHandler&&!1===tracker.scrollHandler({eventSource:tracker,pointerType:"mouse",position:getMouseRelative(event,tracker.element),scroll:nDelta,shift:event.shiftKey,isTouchEvent:!1,originalEvent:originalEvent,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(originalEvent)}function isParentChild(parent,child){if(parent===child)return!1;for(;child&&child!==parent;)child=child.parentNode;return child===parent}function handleMouseEnter(tracker,event){updatePointersEnter(tracker,event,[{id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function handleMouseExit(tracker,event){updatePointersExit(tracker,event,[{id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function getStandardizedButton(button){return $.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?1===button?0:2===button?2:4===button?1:-1:button}function handleMouseUp(tracker,event){updatePointersUp(tracker,event=$.getEvent(event),[{id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()}],getStandardizedButton(event.button))&&releasePointer(tracker,"mouse")}function handleMouseMove(tracker,event){updatePointersMove(tracker,event=$.getEvent(event),[{id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function abortContacts(tracker,event,pointsList){var i,gPointCount=pointsList.getLength(),abortGPoints=[];if("touch"===pointsList.type||pointsList.contacts>0){for(i=0;i<gPointCount;i++)abortGPoints.push(pointsList.getByIndex(i));abortGPoints.length>0&&(updatePointersUp(tracker,event,abortGPoints,0),pointsList.captureCount=1,releasePointer(tracker,pointsList.type),updatePointersExit(tracker,event,abortGPoints))}}function handleTouchEnd(tracker,event){var time,i,j,parentGPoints,touchCount=event.changedTouches.length,gPoints=[];for(time=$.now(),i=0;i<touchCount;i++)gPoints.push({id:event.changedTouches[i].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[i]),currentTime:time});for(updatePointersUp(tracker,event,gPoints,0)&&releasePointer(tracker,"touch",touchCount),updatePointersExit(tracker,event,gPoints),i=0;i<MOUSETRACKERS.length;i++)if(MOUSETRACKERS[i]!==tracker&&MOUSETRACKERS[i].isTracking()&&isParentChild(MOUSETRACKERS[i].element,tracker.element)){for(parentGPoints=[],j=0;j<touchCount;j++)parentGPoints.push({id:event.changedTouches[j].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[j]),currentTime:time});updatePointersExit(MOUSETRACKERS[i],event,parentGPoints)}$.cancelEvent(event)}function handleTouchMove(tracker,event){var i,touchCount=event.changedTouches.length,gPoints=[];for(i=0;i<touchCount;i++)gPoints.push({id:event.changedTouches[i].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[i]),currentTime:$.now()});updatePointersMove(tracker,event,gPoints),$.cancelEvent(event)}function onPointerOver(tracker,event){event.currentTarget===event.relatedTarget||isParentChild(event.currentTarget,event.relatedTarget)||updatePointersEnter(tracker,event,[{id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function onPointerOut(tracker,event){event.currentTarget===event.relatedTarget||isParentChild(event.currentTarget,event.relatedTarget)||updatePointersExit(tracker,event,[{id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function onPointerDown(tracker,event){var gPoint;updatePointersDown(tracker,event,[gPoint={id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()}],event.button)&&($.stopEvent(event),capturePointer(tracker,gPoint.type)),(tracker.clickHandler||tracker.dblClickHandler||tracker.pressHandler||tracker.dragHandler||tracker.dragEndHandler||tracker.pinchHandler)&&$.cancelEvent(event)}function onPointerUp(tracker,event){handlePointerUp(tracker,event)}function handlePointerUp(tracker,event){var gPoint;updatePointersUp(tracker,event,[gPoint={id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()}],event.button)&&releasePointer(tracker,gPoint.type)}function onPointerMove(tracker,event){handlePointerMove(tracker,event)}function handlePointerMove(tracker,event){updatePointersMove(tracker,event,[{id:event.pointerId,type:getPointerType(event),isPrimary:event.isPrimary,currentPos:getMouseAbsolute(event),currentTime:$.now()}])}function onPointerCancel(tracker,event){!function(tracker,event,gPoints){updatePointersUp(tracker,event,gPoints,0),updatePointersExit(tracker,event,gPoints)}(tracker,event,[{id:event.pointerId,type:getPointerType(event)}])}function startTrackingPointer(pointsList,gPoint){return gPoint.hasOwnProperty("isPrimary")||(0===pointsList.getLength()?gPoint.isPrimary=!0:gPoint.isPrimary=!1),gPoint.speed=0,gPoint.direction=0,gPoint.contactPos=gPoint.currentPos,gPoint.contactTime=gPoint.currentTime,gPoint.lastPos=gPoint.currentPos,gPoint.lastTime=gPoint.currentTime,pointsList.add(gPoint)}function stopTrackingPointer(pointsList,gPoint){var listLength,primaryPoint;return pointsList.getById(gPoint.id)?(listLength=pointsList.removeById(gPoint.id),gPoint.hasOwnProperty("isPrimary")||(primaryPoint=pointsList.getPrimary())||(primaryPoint=pointsList.getByIndex(0))&&(primaryPoint.isPrimary=!0)):listLength=pointsList.getLength(),listLength}function updatePointersEnter(tracker,event,gPoints){var i,curGPoint,updateGPoint,pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length;for(i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))?(updateGPoint.insideElement=!0,updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime,curGPoint=updateGPoint):(curGPoint.captured=!1,curGPoint.insideElementPressed=!1,curGPoint.insideElement=!0,startTrackingPointer(pointsList,curGPoint)),tracker.enterHandler&&!1===tracker.enterHandler({eventSource:tracker,pointerType:curGPoint.type,position:getPointRelativeToAbsolute(curGPoint.currentPos,tracker.element),buttons:pointsList.buttons,pointers:tracker.getActivePointerCount(),insideElementPressed:curGPoint.insideElementPressed,buttonDownAny:0!==pointsList.buttons,isTouchEvent:"touch"===curGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)}function updatePointersExit(tracker,event,gPoints){var i,curGPoint,updateGPoint,pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length;for(i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))&&(updateGPoint.captured?(updateGPoint.insideElement=!1,updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime):stopTrackingPointer(pointsList,updateGPoint),curGPoint=updateGPoint),tracker.exitHandler&&!1===tracker.exitHandler({eventSource:tracker,pointerType:curGPoint.type,position:getPointRelativeToAbsolute(curGPoint.currentPos,tracker.element),buttons:pointsList.buttons,pointers:tracker.getActivePointerCount(),insideElementPressed:!!updateGPoint&&updateGPoint.insideElementPressed,buttonDownAny:0!==pointsList.buttons,isTouchEvent:"touch"===curGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)}function updatePointersDown(tracker,event,gPoints,buttonChanged){var i,curGPoint,updateGPoint,delegate=THIS[tracker.hash],pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length;void 0!==event.buttons?pointsList.buttons=event.buttons:$.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?0===buttonChanged?pointsList.buttons+=1:1===buttonChanged?pointsList.buttons+=4:2===buttonChanged?pointsList.buttons+=2:3===buttonChanged?pointsList.buttons+=8:4===buttonChanged?pointsList.buttons+=16:5===buttonChanged&&(pointsList.buttons+=32):0===buttonChanged?pointsList.buttons|=1:1===buttonChanged?pointsList.buttons|=4:2===buttonChanged?pointsList.buttons|=2:3===buttonChanged?pointsList.buttons|=8:4===buttonChanged?pointsList.buttons|=16:5===buttonChanged&&(pointsList.buttons|=32);var otherPointsLists=tracker.getActivePointersListsExceptType(gPoints[0].type);for(i=0;i<otherPointsLists.length;i++)abortContacts(tracker,event,otherPointsLists[i]);if(0!==buttonChanged)return tracker.nonPrimaryPressHandler&&!1===tracker.nonPrimaryPressHandler({eventSource:tracker,pointerType:gPoints[0].type,position:getPointRelativeToAbsolute(gPoints[0].currentPos,tracker.element),button:buttonChanged,buttons:pointsList.buttons,isTouchEvent:"touch"===gPoints[0].type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),!1;for(i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))?(updateGPoint.captured=!0,updateGPoint.insideElementPressed=!0,updateGPoint.insideElement=!0,updateGPoint.contactPos=curGPoint.currentPos,updateGPoint.contactTime=curGPoint.currentTime,updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime,curGPoint=updateGPoint):(curGPoint.captured=!0,curGPoint.insideElementPressed=!0,curGPoint.insideElement=!0,startTrackingPointer(pointsList,curGPoint)),pointsList.addContact(),(tracker.dragHandler||tracker.dragEndHandler||tracker.pinchHandler)&&$.MouseTracker.gesturePointVelocityTracker.addPoint(tracker,curGPoint),1===pointsList.contacts?tracker.pressHandler&&!1===tracker.pressHandler({eventSource:tracker,pointerType:curGPoint.type,position:getPointRelativeToAbsolute(curGPoint.contactPos,tracker.element),buttons:pointsList.buttons,isTouchEvent:"touch"===curGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event):2===pointsList.contacts&&tracker.pinchHandler&&"touch"===curGPoint.type&&(delegate.pinchGPoints=pointsList.asArray(),delegate.lastPinchDist=delegate.currentPinchDist=delegate.pinchGPoints[0].currentPos.distanceTo(delegate.pinchGPoints[1].currentPos),delegate.lastPinchCenter=delegate.currentPinchCenter=getCenterPoint(delegate.pinchGPoints[0].currentPos,delegate.pinchGPoints[1].currentPos));return!0}function updatePointersUp(tracker,event,gPoints,buttonChanged){var releasePoint,releaseTime,i,curGPoint,updateGPoint,quick,delegate=THIS[tracker.hash],pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length,releaseCapture=!1,wasCaptured=!1;if(void 0!==event.buttons?pointsList.buttons=event.buttons:$.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?0===buttonChanged?pointsList.buttons-=1:1===buttonChanged?pointsList.buttons-=4:2===buttonChanged?pointsList.buttons-=2:3===buttonChanged?pointsList.buttons-=8:4===buttonChanged?pointsList.buttons-=16:5===buttonChanged&&(pointsList.buttons-=32):0===buttonChanged?pointsList.buttons^=-2:1===buttonChanged?pointsList.buttons^=-5:2===buttonChanged?pointsList.buttons^=-3:3===buttonChanged?pointsList.buttons^=-9:4===buttonChanged?pointsList.buttons^=-17:5===buttonChanged&&(pointsList.buttons^=-33),0!==buttonChanged){tracker.nonPrimaryReleaseHandler&&!1===tracker.nonPrimaryReleaseHandler({eventSource:tracker,pointerType:gPoints[0].type,position:getPointRelativeToAbsolute(gPoints[0].currentPos,tracker.element),button:buttonChanged,buttons:pointsList.buttons,isTouchEvent:"touch"===gPoints[0].type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event);return abortContacts(tracker,event,tracker.getActivePointersListByType("mouse")),!1}for(i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))&&(updateGPoint.captured&&(updateGPoint.captured=!1,releaseCapture=!0,wasCaptured=!0),updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime,updateGPoint.insideElement||stopTrackingPointer(pointsList,updateGPoint),releasePoint=updateGPoint.currentPos,releaseTime=updateGPoint.currentTime,wasCaptured?(pointsList.removeContact(),(tracker.dragHandler||tracker.dragEndHandler||tracker.pinchHandler)&&$.MouseTracker.gesturePointVelocityTracker.removePoint(tracker,updateGPoint),0===pointsList.contacts?(tracker.releaseHandler&&!1===tracker.releaseHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(releasePoint,tracker.element),buttons:pointsList.buttons,insideElementPressed:updateGPoint.insideElementPressed,insideElementReleased:updateGPoint.insideElement,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),tracker.dragEndHandler&&!updateGPoint.currentPos.equals(updateGPoint.contactPos)&&!1===tracker.dragEndHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),speed:updateGPoint.speed,direction:updateGPoint.direction,shift:event.shiftKey,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),(tracker.clickHandler||tracker.dblClickHandler)&&updateGPoint.insideElement&&(quick=releaseTime-updateGPoint.contactTime<=tracker.clickTimeThreshold&&updateGPoint.contactPos.distanceTo(releasePoint)<=tracker.clickDistThreshold,tracker.clickHandler&&!1===tracker.clickHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),quick:quick,shift:event.shiftKey,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),tracker.dblClickHandler&&quick&&(pointsList.clicks++,1===pointsList.clicks?(delegate.lastClickPos=releasePoint,delegate.dblClickTimeOut=setTimeout(function(){pointsList.clicks=0},tracker.dblClickTimeThreshold)):2===pointsList.clicks&&(clearTimeout(delegate.dblClickTimeOut),pointsList.clicks=0,delegate.lastClickPos.distanceTo(releasePoint)<=tracker.dblClickDistThreshold&&!1===tracker.dblClickHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),shift:event.shiftKey,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event),delegate.lastClickPos=null)))):2===pointsList.contacts&&tracker.pinchHandler&&"touch"===updateGPoint.type&&(delegate.pinchGPoints=pointsList.asArray(),delegate.lastPinchDist=delegate.currentPinchDist=delegate.pinchGPoints[0].currentPos.distanceTo(delegate.pinchGPoints[1].currentPos),delegate.lastPinchCenter=delegate.currentPinchCenter=getCenterPoint(delegate.pinchGPoints[0].currentPos,delegate.pinchGPoints[1].currentPos))):tracker.releaseHandler&&!1===tracker.releaseHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(releasePoint,tracker.element),buttons:pointsList.buttons,insideElementPressed:updateGPoint.insideElementPressed,insideElementReleased:updateGPoint.insideElement,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event));return releaseCapture}function updatePointersMove(tracker,event,gPoints){var i,curGPoint,updateGPoint,gPointArray,delta,delegate=THIS[tracker.hash],pointsList=tracker.getActivePointersListByType(gPoints[0].type),gPointCount=gPoints.length;for(void 0!==event.buttons&&(pointsList.buttons=event.buttons),i=0;i<gPointCount;i++)curGPoint=gPoints[i],(updateGPoint=pointsList.getById(curGPoint.id))?(curGPoint.hasOwnProperty("isPrimary")&&(updateGPoint.isPrimary=curGPoint.isPrimary),updateGPoint.lastPos=updateGPoint.currentPos,updateGPoint.lastTime=updateGPoint.currentTime,updateGPoint.currentPos=curGPoint.currentPos,updateGPoint.currentTime=curGPoint.currentTime):(curGPoint.captured=!1,curGPoint.insideElementPressed=!1,curGPoint.insideElement=!0,startTrackingPointer(pointsList,curGPoint));tracker.stopHandler&&"mouse"===gPoints[0].type&&(clearTimeout(tracker.stopTimeOut),tracker.stopTimeOut=setTimeout(function(){!function(tracker,originalMoveEvent,pointerType){tracker.stopHandler&&tracker.stopHandler({eventSource:tracker,pointerType:pointerType,position:getMouseRelative(originalMoveEvent,tracker.element),buttons:tracker.getActivePointersListByType(pointerType).buttons,isTouchEvent:"touch"===pointerType,originalEvent:originalMoveEvent,preventDefaultAction:!1,userData:tracker.userData})}(tracker,event,gPoints[0].type)},tracker.stopDelay)),0===pointsList.contacts?tracker.moveHandler&&!1===tracker.moveHandler({eventSource:tracker,pointerType:gPoints[0].type,position:getPointRelativeToAbsolute(gPoints[0].currentPos,tracker.element),buttons:pointsList.buttons,isTouchEvent:"touch"===gPoints[0].type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event):1===pointsList.contacts?(tracker.moveHandler&&(updateGPoint=pointsList.asArray()[0],!1===tracker.moveHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),buttons:pointsList.buttons,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)),tracker.dragHandler&&(delta=(updateGPoint=pointsList.asArray()[0]).currentPos.minus(updateGPoint.lastPos),!1===tracker.dragHandler({eventSource:tracker,pointerType:updateGPoint.type,position:getPointRelativeToAbsolute(updateGPoint.currentPos,tracker.element),buttons:pointsList.buttons,delta:delta,speed:updateGPoint.speed,direction:updateGPoint.direction,shift:event.shiftKey,isTouchEvent:"touch"===updateGPoint.type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event))):2===pointsList.contacts&&(tracker.moveHandler&&(gPointArray=pointsList.asArray(),!1===tracker.moveHandler({eventSource:tracker,pointerType:gPointArray[0].type,position:getPointRelativeToAbsolute(getCenterPoint(gPointArray[0].currentPos,gPointArray[1].currentPos),tracker.element),buttons:pointsList.buttons,isTouchEvent:"touch"===gPointArray[0].type,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)),tracker.pinchHandler&&"touch"===gPoints[0].type&&(delta=delegate.pinchGPoints[0].currentPos.distanceTo(delegate.pinchGPoints[1].currentPos))!=delegate.currentPinchDist&&(delegate.lastPinchDist=delegate.currentPinchDist,delegate.currentPinchDist=delta,delegate.lastPinchCenter=delegate.currentPinchCenter,delegate.currentPinchCenter=getCenterPoint(delegate.pinchGPoints[0].currentPos,delegate.pinchGPoints[1].currentPos),!1===tracker.pinchHandler({eventSource:tracker,pointerType:"touch",gesturePoints:delegate.pinchGPoints,lastCenter:getPointRelativeToAbsolute(delegate.lastPinchCenter,tracker.element),center:getPointRelativeToAbsolute(delegate.currentPinchCenter,tracker.element),lastDistance:delegate.lastPinchDist,distance:delegate.currentPinchDist,shift:event.shiftKey,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event)))}function canAccessEvents(target){try{return target.addEventListener&&target.removeEventListener}catch(e){return!1}}var MOUSETRACKERS=[],THIS={};$.MouseTracker=function(options){MOUSETRACKERS.push(this);var args=arguments;$.isPlainObject(options)||(options={element:args[0],clickTimeThreshold:args[1],clickDistThreshold:args[2]}),this.hash=Math.random(),this.element=$.getElement(options.element),this.clickTimeThreshold=options.clickTimeThreshold||$.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=options.clickDistThreshold||$.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=options.dblClickTimeThreshold||$.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=options.dblClickDistThreshold||$.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=options.userData||null,this.stopDelay=options.stopDelay||50,this.enterHandler=options.enterHandler||null,this.exitHandler=options.exitHandler||null,this.pressHandler=options.pressHandler||null,this.nonPrimaryPressHandler=options.nonPrimaryPressHandler||null,this.releaseHandler=options.releaseHandler||null,this.nonPrimaryReleaseHandler=options.nonPrimaryReleaseHandler||null,this.moveHandler=options.moveHandler||null,this.scrollHandler=options.scrollHandler||null,this.clickHandler=options.clickHandler||null,this.dblClickHandler=options.dblClickHandler||null,this.dragHandler=options.dragHandler||null,this.dragEndHandler=options.dragEndHandler||null,this.pinchHandler=options.pinchHandler||null,this.stopHandler=options.stopHandler||null,this.keyDownHandler=options.keyDownHandler||null,this.keyUpHandler=options.keyUpHandler||null,this.keyHandler=options.keyHandler||null,this.focusHandler=options.focusHandler||null,this.blurHandler=options.blurHandler||null;var _this=this;THIS[this.hash]={click:function(event){!function(tracker,event){tracker.clickHandler&&$.cancelEvent(event)}(_this,event)},dblclick:function(event){!function(tracker,event){tracker.dblClickHandler&&$.cancelEvent(event)}(_this,event)},keydown:function(event){!function(tracker,event){tracker.keyDownHandler&&(event=$.getEvent(event),tracker.keyDownHandler({eventSource:tracker,keyCode:event.keyCode?event.keyCode:event.charCode,ctrl:event.ctrlKey,shift:event.shiftKey,alt:event.altKey,meta:event.metaKey,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})||$.cancelEvent(event))}(_this,event)},keyup:function(event){!function(tracker,event){tracker.keyUpHandler&&(event=$.getEvent(event),tracker.keyUpHandler({eventSource:tracker,keyCode:event.keyCode?event.keyCode:event.charCode,ctrl:event.ctrlKey,shift:event.shiftKey,alt:event.altKey,meta:event.metaKey,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})||$.cancelEvent(event))}(_this,event)},keypress:function(event){!function(tracker,event){tracker.keyHandler&&(event=$.getEvent(event),tracker.keyHandler({eventSource:tracker,keyCode:event.keyCode?event.keyCode:event.charCode,ctrl:event.ctrlKey,shift:event.shiftKey,alt:event.altKey,meta:event.metaKey,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})||$.cancelEvent(event))}(_this,event)},focus:function(event){!function(tracker,event){tracker.focusHandler&&(event=$.getEvent(event),!1===tracker.focusHandler({eventSource:tracker,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event))}(_this,event)},blur:function(event){!function(tracker,event){tracker.blurHandler&&(event=$.getEvent(event),!1===tracker.blurHandler({eventSource:tracker,originalEvent:event,preventDefaultAction:!1,userData:tracker.userData})&&$.cancelEvent(event))}(_this,event)},wheel:function(event){!function(tracker,event){handleWheelEvent(tracker,event,event)}(_this,event)},mousewheel:function(event){onMouseWheel(_this,event)},DOMMouseScroll:function(event){onMouseWheel(_this,event)},MozMousePixelScroll:function(event){onMouseWheel(_this,event)},mouseenter:function(event){!function(tracker,event){handleMouseEnter(tracker,event=$.getEvent(event))}(_this,event)},mouseleave:function(event){!function(tracker,event){handleMouseExit(tracker,event=$.getEvent(event))}(_this,event)},mouseover:function(event){!function(tracker,event){(event=$.getEvent(event)).currentTarget===event.relatedTarget||isParentChild(event.currentTarget,event.relatedTarget)||handleMouseEnter(tracker,event)}(_this,event)},mouseout:function(event){!function(tracker,event){(event=$.getEvent(event)).currentTarget===event.relatedTarget||isParentChild(event.currentTarget,event.relatedTarget)||handleMouseExit(tracker,event)}(_this,event)},mousedown:function(event){!function(tracker,event){updatePointersDown(tracker,event=$.getEvent(event),[{id:$.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(event),currentTime:$.now()}],getStandardizedButton(event.button))&&($.stopEvent(event),capturePointer(tracker,"mouse")),(tracker.clickHandler||tracker.dblClickHandler||tracker.pressHandler||tracker.dragHandler||tracker.dragEndHandler)&&$.cancelEvent(event)}(_this,event)},mouseup:function(event){!function(tracker,event){handleMouseUp(tracker,event)}(_this,event)},mouseupcaptured:function(event){!function(tracker,event){handleMouseUp(tracker,event),$.stopEvent(event)}(_this,event)},mousemove:function(event){!function(tracker,event){handleMouseMove(tracker,event)}(_this,event)},mousemovecaptured:function(event){!function(tracker,event){handleMouseMove(tracker,event),$.stopEvent(event)}(_this,event)},touchstart:function(event){!function(tracker,event){var time,i,j,parentGPoints,touchCount=event.changedTouches.length,gPoints=[],pointsList=tracker.getActivePointersListByType("touch");for(time=$.now(),pointsList.getLength()>event.touches.length-touchCount&&($.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),abortContacts(tracker,event,pointsList)),i=0;i<touchCount;i++)gPoints.push({id:event.changedTouches[i].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[i]),currentTime:time});for(updatePointersEnter(tracker,event,gPoints),i=0;i<MOUSETRACKERS.length;i++)if(MOUSETRACKERS[i]!==tracker&&MOUSETRACKERS[i].isTracking()&&isParentChild(MOUSETRACKERS[i].element,tracker.element)){for(parentGPoints=[],j=0;j<touchCount;j++)parentGPoints.push({id:event.changedTouches[j].identifier,type:"touch",currentPos:getMouseAbsolute(event.changedTouches[j]),currentTime:time});updatePointersEnter(MOUSETRACKERS[i],event,parentGPoints)}updatePointersDown(tracker,event,gPoints,0)&&($.stopEvent(event),capturePointer(tracker,"touch",touchCount)),$.cancelEvent(event)}(_this,event)},touchend:function(event){!function(tracker,event){handleTouchEnd(tracker,event)}(_this,event)},touchendcaptured:function(event){!function(tracker,event){handleTouchEnd(tracker,event),$.stopEvent(event)}(_this,event)},touchmove:function(event){!function(tracker,event){handleTouchMove(tracker,event)}(_this,event)},touchmovecaptured:function(event){!function(tracker,event){handleTouchMove(tracker,event),$.stopEvent(event)}(_this,event)},touchcancel:function(event){!function(tracker,event){abortContacts(tracker,event,tracker.getActivePointersListByType("touch"))}(_this,event)},gesturestart:function(event){!function(tracker,event){event.stopPropagation(),event.preventDefault()}(0,event)},gesturechange:function(event){!function(tracker,event){event.stopPropagation(),event.preventDefault()}(0,event)},pointerover:function(event){onPointerOver(_this,event)},MSPointerOver:function(event){onPointerOver(_this,event)},pointerout:function(event){onPointerOut(_this,event)},MSPointerOut:function(event){onPointerOut(_this,event)},pointerdown:function(event){onPointerDown(_this,event)},MSPointerDown:function(event){onPointerDown(_this,event)},pointerup:function(event){onPointerUp(_this,event)},MSPointerUp:function(event){onPointerUp(_this,event)},pointermove:function(event){onPointerMove(_this,event)},MSPointerMove:function(event){onPointerMove(_this,event)},pointercancel:function(event){onPointerCancel(_this,event)},MSPointerCancel:function(event){onPointerCancel(_this,event)},pointerupcaptured:function(event){!function(tracker,event){tracker.getActivePointersListByType(getPointerType(event)).getById(event.pointerId)&&handlePointerUp(tracker,event),$.stopEvent(event)}(_this,event)},pointermovecaptured:function(event){!function(tracker,event){tracker.getActivePointersListByType(getPointerType(event)).getById(event.pointerId)&&handlePointerMove(tracker,event),$.stopEvent(event)}(_this,event)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},options.startDisabled||this.setTracking(!0)},$.MouseTracker.prototype={destroy:function(){var i;for(stopTracking(this),this.element=null,i=0;i<MOUSETRACKERS.length;i++)if(MOUSETRACKERS[i]===this){MOUSETRACKERS.splice(i,1);break}THIS[this.hash]=null,delete THIS[this.hash]},isTracking:function(){return THIS[this.hash].tracking},setTracking:function(track){return track?function(tracker){var event,i,delegate=THIS[tracker.hash];if(!delegate.tracking){for(i=0;i<$.MouseTracker.subscribeEvents.length;i++)event=$.MouseTracker.subscribeEvents[i],$.addEvent(tracker.element,event,delegate[event],!1);clearTrackedPointers(tracker),delegate.tracking=!0}}(this):stopTracking(this),this},getActivePointersListsExceptType:function(type){for(var delegate=THIS[this.hash],listArray=[],i=0;i<delegate.activePointersLists.length;++i)delegate.activePointersLists[i].type!==type&&listArray.push(delegate.activePointersLists[i]);return listArray},getActivePointersListByType:function(type){var i,list,delegate=THIS[this.hash],len=delegate.activePointersLists.length;for(i=0;i<len;i++)if(delegate.activePointersLists[i].type===type)return delegate.activePointersLists[i];return list=new $.MouseTracker.GesturePointList(type),delegate.activePointersLists.push(list),list},getActivePointerCount:function(){var i,delegate=THIS[this.hash],len=delegate.activePointersLists.length,count=0;for(i=0;i<len;i++)count+=delegate.activePointersLists[i].getLength();return count},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},$.MouseTracker.resetAllMouseTrackers=function(){for(var i=0;i<MOUSETRACKERS.length;i++)MOUSETRACKERS[i].isTracking()&&(MOUSETRACKERS[i].setTracking(!1),MOUSETRACKERS[i].setTracking(!0))},$.MouseTracker.gesturePointVelocityTracker=function(){var trackerPoints=[],intervalId=0,lastTime=0,_generateGuid=function(tracker,gPoint){return tracker.hash.toString()+gPoint.type+gPoint.id.toString()},_doTracking=function(){var i,trackPoint,gPoint,elapsedTime,distance,speed,len=trackerPoints.length,now=$.now();for(elapsedTime=now-lastTime,lastTime=now,i=0;i<len;i++)(gPoint=(trackPoint=trackerPoints[i]).gPoint).direction=Math.atan2(gPoint.currentPos.y-trackPoint.lastPos.y,gPoint.currentPos.x-trackPoint.lastPos.x),distance=trackPoint.lastPos.distanceTo(gPoint.currentPos),trackPoint.lastPos=gPoint.currentPos,speed=1e3*distance/(elapsedTime+1),gPoint.speed=.75*speed+.25*gPoint.speed};return{addPoint:function(tracker,gPoint){var guid=_generateGuid(tracker,gPoint);trackerPoints.push({guid:guid,gPoint:gPoint,lastPos:gPoint.currentPos}),1===trackerPoints.length&&(lastTime=$.now(),intervalId=window.setInterval(_doTracking,50))},removePoint:function(tracker,gPoint){var i,guid=_generateGuid(tracker,gPoint),len=trackerPoints.length;for(i=0;i<len;i++)if(trackerPoints[i].guid===guid){trackerPoints.splice(i,1),0==--len&&window.clearInterval(intervalId);break}}}}(),$.MouseTracker.captureElement=document,$.MouseTracker.wheelEventName=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",$.MouseTracker.supportsMouseCapture=function(){var divElement=document.createElement("div");return $.isFunction(divElement.setCapture)&&$.isFunction(divElement.releaseCapture)}(),$.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",$.MouseTracker.wheelEventName],"DOMMouseScroll"==$.MouseTracker.wheelEventName&&$.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||$.Browser.vendor!==$.BROWSERS.IE)?($.MouseTracker.havePointerEvents=!0,$.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),$.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?$.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:$.MouseTracker.maxTouchPoints=0,$.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?($.MouseTracker.havePointerEvents=!0,$.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),$.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?$.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:$.MouseTracker.maxTouchPoints=0,$.MouseTracker.haveMouseEnter=!1):($.MouseTracker.havePointerEvents=!1,$.Browser.vendor===$.BROWSERS.IE&&$.Browser.version<9?($.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),$.MouseTracker.haveMouseEnter=!0):($.MouseTracker.subscribeEvents.push("mouseover","mouseout"),$.MouseTracker.haveMouseEnter=!1),$.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&$.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&$.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),$.MouseTracker.mousePointerId="legacy-mouse",$.MouseTracker.maxTouchPoints=10),$.MouseTracker.GesturePointList=function(type){this._gPoints=[],this.type=type,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},$.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(gp){return this._gPoints.push(gp)},removeById:function(id){var i,len=this._gPoints.length;for(i=0;i<len;i++)if(this._gPoints[i].id===id){this._gPoints.splice(i,1);break}return this._gPoints.length},getByIndex:function(index){return index<this._gPoints.length?this._gPoints[index]:null},getById:function(id){var i,len=this._gPoints.length;for(i=0;i<len;i++)if(this._gPoints[i].id===id)return this._gPoints[i];return null},getPrimary:function(id){var i,len=this._gPoints.length;for(i=0;i<len;i++)if(this._gPoints[i].isPrimary)return this._gPoints[i];return null},addContact:function(){++this.contacts,this.contacts>1&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var isInIframe=function(){try{return window.self!==window.top}catch(e){return!0}}()}(OpenSeadragon),function($){$.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},$.Control=function(element,options,container){var parent=element.parentNode;"number"==typeof options&&($.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),options={anchor:options}),options.attachToViewer=void 0===options.attachToViewer||options.attachToViewer,this.autoFade=void 0===options.autoFade||options.autoFade,this.element=element,this.anchor=options.anchor,this.container=container,this.anchor==$.ControlAnchor.ABSOLUTE?(this.wrapper=$.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof options.top?options.top+"px":options.top,this.wrapper.style.left="number"==typeof options.left?options.left+"px":options.left,this.wrapper.style.height="number"==typeof options.height?options.height+"px":options.height,this.wrapper.style.width="number"==typeof options.width?options.width+"px":options.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=$.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==$.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),options.attachToViewer?this.anchor==$.ControlAnchor.TOP_RIGHT||this.anchor==$.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):parent.appendChild(this.wrapper)},$.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(visible){this.wrapper.style.display=visible?this.anchor==$.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(opacity){this.element[$.SIGNAL]&&$.Browser.vendor==$.BROWSERS.IE?$.setElementOpacity(this.element,opacity,!0):$.setElementOpacity(this.wrapper,opacity,!0)}}}(OpenSeadragon),function($){function getControlIndex(dock,element){var i,controls=dock.controls;for(i=controls.length-1;i>=0;i--)if(controls[i].element==element)return i;return-1}$.ControlDock=function(options){var layout,i,layouts=["topleft","topright","bottomright","bottomleft"];for($.extend(!0,this,{id:"controldock-"+$.now()+"-"+Math.floor(1e6*Math.random()),container:$.makeNeutralElement("div"),controls:[]},options),this.container.onsubmit=function(){return!1},this.element&&(this.element=$.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),i=0;i<layouts.length;i++)layout=layouts[i],this.controls[layout]=$.makeNeutralElement("div"),this.controls[layout].style.position="absolute",layout.match("left")&&(this.controls[layout].style.left="0px"),layout.match("right")&&(this.controls[layout].style.right="0px"),layout.match("top")&&(this.controls[layout].style.top="0px"),layout.match("bottom")&&(this.controls[layout].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},$.ControlDock.prototype={addControl:function(element,controlOptions){var div=null;if(!(getControlIndex(this,element=$.getElement(element))>=0)){switch(controlOptions.anchor){case $.ControlAnchor.TOP_RIGHT:div=this.controls.topright,element.style.position="relative",element.style.paddingRight="0px",element.style.paddingTop="0px";break;case $.ControlAnchor.BOTTOM_RIGHT:div=this.controls.bottomright,element.style.position="relative",element.style.paddingRight="0px",element.style.paddingBottom="0px";break;case $.ControlAnchor.BOTTOM_LEFT:div=this.controls.bottomleft,element.style.position="relative",element.style.paddingLeft="0px",element.style.paddingBottom="0px";break;case $.ControlAnchor.TOP_LEFT:div=this.controls.topleft,element.style.position="relative",element.style.paddingLeft="0px",element.style.paddingTop="0px";break;case $.ControlAnchor.ABSOLUTE:div=this.container,element.style.margin="0px",element.style.padding="0px";break;default:case $.ControlAnchor.NONE:div=this.container,element.style.margin="0px",element.style.padding="0px"}this.controls.push(new $.Control(element,controlOptions,div)),element.style.display="inline-block"}},removeControl:function(element){var i=getControlIndex(this,element=$.getElement(element));return i>=0&&(this.controls[i].destroy(),this.controls.splice(i,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var i;for(i=this.controls.length-1;i>=0;i--)if(this.controls[i].isVisible())return!0;return!1},setControlsEnabled:function(enabled){var i;for(i=this.controls.length-1;i>=0;i--)this.controls[i].setVisible(enabled);return this}}}(OpenSeadragon),function($){$.Placement=$.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function($){function _getSafeElemSize(oElement){return oElement=$.getElement(oElement),new $.Point(0===oElement.clientWidth?1:oElement.clientWidth,0===oElement.clientHeight?1:oElement.clientHeight)}function getOverlayObject(viewer,overlay){if(overlay instanceof $.Overlay)return overlay;var element=null;if(overlay.element)element=$.getElement(overlay.element);else{var id=overlay.id?overlay.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(element=$.getElement(overlay.id))||((element=document.createElement("a")).href="#/overlay/"+id),element.id=id,$.addClass(element,overlay.className?overlay.className:"openseadragon-overlay")}var location=overlay.location,width=overlay.width,height=overlay.height;if(!location){var x=overlay.x,y=overlay.y;if(void 0!==overlay.px){var rect=viewer.viewport.imageToViewportRectangle(new $.Rect(overlay.px,overlay.py,width||0,height||0));x=rect.x,y=rect.y,width=void 0!==width?rect.width:void 0,height=void 0!==height?rect.height:void 0}location=new $.Point(x,y)}var placement=overlay.placement;return placement&&"string"===$.type(placement)&&(placement=$.Placement[overlay.placement.toUpperCase()]),new $.Overlay({element:element,location:location,placement:placement,onDraw:overlay.onDraw,checkResize:overlay.checkResize,width:width,height:height,rotationMode:overlay.rotationMode})}function getOverlayIndex(overlays,element){var i;for(i=overlays.length-1;i>=0;i--)if(overlays[i].element===element)return i;return-1}function scheduleUpdate(viewer,updateFunc){return $.requestAnimationFrame(function(){updateFunc(viewer)})}function scheduleControlsFade(viewer){$.requestAnimationFrame(function(){!function(viewer){var currentTime,deltaTime,opacity,i;if(viewer.controlsShouldFade){for(currentTime=$.now(),deltaTime=currentTime-viewer.controlsFadeBeginTime,opacity=1-deltaTime/viewer.controlsFadeLength,opacity=Math.min(1,opacity),opacity=Math.max(0,opacity),i=viewer.controls.length-1;i>=0;i--)viewer.controls[i].autoFade&&viewer.controls[i].setOpacity(opacity);opacity>0&&scheduleControlsFade(viewer)}}(viewer)})}function beginControlsAutoHide(viewer){viewer.autoHideControls&&(viewer.controlsShouldFade=!0,viewer.controlsFadeBeginTime=$.now()+viewer.controlsFadeDelay,window.setTimeout(function(){scheduleControlsFade(viewer)},viewer.controlsFadeDelay))}function abortControlsAutoHide(viewer){var i;for(viewer.controlsShouldFade=!1,i=viewer.controls.length-1;i>=0;i--)viewer.controls[i].setOpacity(1)}function onFocus(){abortControlsAutoHide(this)}function onBlur(){beginControlsAutoHide(this)}function onCanvasKeyDown(event){if(event.preventDefaultAction||event.ctrl||event.alt||event.meta)return!0;switch(event.keyCode){case 38:return event.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(0,-40))),this.viewport.applyConstraints(),!1;case 40:return event.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(0,40))),this.viewport.applyConstraints(),!1;case 37:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(-40,0))),this.viewport.applyConstraints(),!1;case 39:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(40,0))),this.viewport.applyConstraints(),!1;default:return!0}}function onCanvasKeyPress(event){if(event.preventDefaultAction||event.ctrl||event.alt||event.meta)return!0;switch(event.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return event.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(0,-40))),this.viewport.applyConstraints(),!1;case 115:case 83:return event.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(0,40))),this.viewport.applyConstraints(),!1;case 97:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(-40,0))),this.viewport.applyConstraints(),!1;case 100:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new $.Point(40,0))),this.viewport.applyConstraints(),!1;default:return!0}}function onCanvasClick(event){document.activeElement==this.canvas||this.canvas.focus();var canvasClickEventArgs={tracker:event.eventSource,position:event.position,quick:event.quick,shift:event.shift,originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction};this.raiseEvent("canvas-click",canvasClickEventArgs),!canvasClickEventArgs.preventDefaultAction&&this.viewport&&event.quick&&this.gestureSettingsByDeviceType(event.pointerType).clickToZoom&&(this.viewport.zoomBy(event.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(event.position,!0)),this.viewport.applyConstraints())}function onCanvasDblClick(event){!event.preventDefaultAction&&this.viewport&&this.gestureSettingsByDeviceType(event.pointerType).dblClickToZoom&&(this.viewport.zoomBy(event.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(event.position,!0)),this.viewport.applyConstraints()),this.raiseEvent("canvas-double-click",{tracker:event.eventSource,position:event.position,shift:event.shift,originalEvent:event.originalEvent})}function onCanvasDrag(event){var gestureSettings,canvasDragEventArgs={tracker:event.eventSource,position:event.position,delta:event.delta,speed:event.speed,direction:event.direction,shift:event.shift,originalEvent:event.originalEvent,preventDefaultAction:event.preventDefaultAction};if(this.raiseEvent("canvas-drag",canvasDragEventArgs),!canvasDragEventArgs.preventDefaultAction&&this.viewport){if(gestureSettings=this.gestureSettingsByDeviceType(event.pointerType),this.panHorizontal||(event.delta.x=0),this.panVertical||(event.delta.y=0),this.constrainDuringPan){var delta=this.viewport.deltaPointsFromPixels(event.delta.negate());this.viewport.centerSpringX.target.value+=delta.x,this.viewport.centerSpringY.target.value+=delta.y;var bounds=this.viewport.getBounds(),constrainedBounds=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=delta.x,this.viewport.centerSpringY.target.value-=delta.y,bounds.x!=constrainedBounds.x&&(event.delta.x=0),bounds.y!=constrainedBounds.y&&(event.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(event.delta.negate()),gestureSettings.flickEnabled&&!this.constrainDuringPan)}}function onCanvasDragEnd(event){if(!event.preventDefaultAction&&this.viewport){var gestureSettings=this.gestureSettingsByDeviceType(event.pointerType);if(gestureSettings.flickEnabled&&event.speed>=gestureSettings.flickMinSpeed){var amplitudeX=0;this.panHorizontal&&(amplitudeX=gestureSettings.flickMomentum*event.speed*Math.cos(event.direction));var amplitudeY=0;this.panVertical&&(amplitudeY=gestureSettings.flickMomentum*event.speed*Math.sin(event.direction));var center=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),target=this.viewport.pointFromPixel(new $.Point(center.x-amplitudeX,center.y-amplitudeY));this.viewport.panTo(target,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:event.eventSource,position:event.position,speed:event.speed,direction:event.direction,shift:event.shift,originalEvent:event.originalEvent})}function onCanvasEnter(event){this.raiseEvent("canvas-enter",{tracker:event.eventSource,pointerType:event.pointerType,position:event.position,buttons:event.buttons,pointers:event.pointers,insideElementPressed:event.insideElementPressed,buttonDownAny:event.buttonDownAny,originalEvent:event.originalEvent})}function onCanvasExit(event){window.location!=window.parent.location&&$.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:event.eventSource,pointerType:event.pointerType,position:event.position,buttons:event.buttons,pointers:event.pointers,insideElementPressed:event.insideElementPressed,buttonDownAny:event.buttonDownAny,originalEvent:event.originalEvent})}function onCanvasPress(event){this.raiseEvent("canvas-press",{tracker:event.eventSource,pointerType:event.pointerType,position:event.position,insideElementPressed:event.insideElementPressed,insideElementReleased:event.insideElementReleased,originalEvent:event.originalEvent})}function onCanvasRelease(event){this.raiseEvent("canvas-release",{tracker:event.eventSource,pointerType:event.pointerType,position:event.position,insideElementPressed:event.insideElementPressed,insideElementReleased:event.insideElementReleased,originalEvent:event.originalEvent})}function onCanvasNonPrimaryPress(event){this.raiseEvent("canvas-nonprimary-press",{tracker:event.eventSource,position:event.position,pointerType:event.pointerType,button:event.button,buttons:event.buttons,originalEvent:event.originalEvent})}function onCanvasNonPrimaryRelease(event){this.raiseEvent("canvas-nonprimary-release",{tracker:event.eventSource,position:event.position,pointerType:event.pointerType,button:event.button,buttons:event.buttons,originalEvent:event.originalEvent})}function onCanvasPinch(event){var gestureSettings,centerPt,panByPt;if(!event.preventDefaultAction&&this.viewport&&((gestureSettings=this.gestureSettingsByDeviceType(event.pointerType)).pinchToZoom&&(centerPt=this.viewport.pointFromPixel(event.center,!0),panByPt=this.viewport.pointFromPixel(event.lastCenter,!0).minus(centerPt),this.panHorizontal||(panByPt.x=0),this.panVertical||(panByPt.y=0),this.viewport.zoomBy(event.distance/event.lastDistance,centerPt,!0),this.viewport.panBy(panByPt,!0),this.viewport.applyConstraints()),gestureSettings.pinchRotate)){var angle1=Math.atan2(event.gesturePoints[0].currentPos.y-event.gesturePoints[1].currentPos.y,event.gesturePoints[0].currentPos.x-event.gesturePoints[1].currentPos.x),angle2=Math.atan2(event.gesturePoints[0].lastPos.y-event.gesturePoints[1].lastPos.y,event.gesturePoints[0].lastPos.x-event.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(angle1-angle2)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:event.eventSource,gesturePoints:event.gesturePoints,lastCenter:event.lastCenter,center:event.center,lastDistance:event.lastDistance,distance:event.distance,shift:event.shift,originalEvent:event.originalEvent}),!1}function onCanvasScroll(event){var gestureSettings,factor,thisScrollTime;if(thisScrollTime=$.now(),thisScrollTime-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=thisScrollTime,!event.preventDefaultAction&&this.viewport&&(gestureSettings=this.gestureSettingsByDeviceType(event.pointerType)).scrollToZoom&&(factor=Math.pow(this.zoomPerScroll,event.scroll),this.viewport.zoomBy(factor,this.viewport.pointFromPixel(event.position,!0)),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:event.eventSource,position:event.position,scroll:event.scroll,shift:event.shift,originalEvent:event.originalEvent}),gestureSettings&&gestureSettings.scrollToZoom)return!1}else if((gestureSettings=this.gestureSettingsByDeviceType(event.pointerType))&&gestureSettings.scrollToZoom)return!1}function onContainerEnter(event){THIS[this.hash].mouseInside=!0,abortControlsAutoHide(this),this.raiseEvent("container-enter",{tracker:event.eventSource,position:event.position,buttons:event.buttons,pointers:event.pointers,insideElementPressed:event.insideElementPressed,buttonDownAny:event.buttonDownAny,originalEvent:event.originalEvent})}function onContainerExit(event){event.pointers<1&&(THIS[this.hash].mouseInside=!1,THIS[this.hash].animating||beginControlsAutoHide(this)),this.raiseEvent("container-exit",{tracker:event.eventSource,position:event.position,buttons:event.buttons,pointers:event.pointers,insideElementPressed:event.insideElementPressed,buttonDownAny:event.buttonDownAny,originalEvent:event.originalEvent})}function updateMulti(viewer){!function(viewer){if(viewer._opening)return;if(viewer.autoResize){var containerSize=_getSafeElemSize(viewer.container),prevContainerSize=THIS[viewer.hash].prevContainerSize;if(!containerSize.equals(prevContainerSize)){var viewport=viewer.viewport;if(viewer.preserveImageSizeOnResize){var resizeRatio=prevContainerSize.x/containerSize.x,zoom=viewport.getZoom()*resizeRatio,center=viewport.getCenter();viewport.resize(containerSize,!1),viewport.zoomTo(zoom,null,!0),viewport.panTo(center,!0)}else{var oldBounds=viewport.getBounds();viewport.resize(containerSize,!0),viewport.fitBoundsWithConstraints(oldBounds,!0)}THIS[viewer.hash].prevContainerSize=containerSize,THIS[viewer.hash].forceRedraw=!0}}var viewportChange=viewer.viewport.update(),animated=viewer.world.update()||viewportChange;viewportChange&&viewer.raiseEvent("viewport-change");viewer.referenceStrip&&(animated=viewer.referenceStrip.update(viewer.viewport)||animated);!THIS[viewer.hash].animating&&animated&&(viewer.raiseEvent("animation-start"),abortControlsAutoHide(viewer));(animated||THIS[viewer.hash].forceRedraw||viewer.world.needsDraw())&&(!function(viewer){viewer.imageLoader.clear(),viewer.drawer.clear(),viewer.world.draw(),viewer.raiseEvent("update-viewport",{})}(viewer),viewer._drawOverlays(),viewer.navigator&&viewer.navigator.update(viewer.viewport),THIS[viewer.hash].forceRedraw=!1,animated&&viewer.raiseEvent("animation"));THIS[viewer.hash].animating&&!animated&&(viewer.raiseEvent("animation-finish"),THIS[viewer.hash].mouseInside||beginControlsAutoHide(viewer));THIS[viewer.hash].animating=animated}(viewer),viewer.isOpen()?viewer._updateRequestId=scheduleUpdate(viewer,updateMulti):viewer._updateRequestId=!1}function resolveUrl(prefix,url){return prefix?prefix+url:url}function beginZoomingIn(){THIS[this.hash].lastZoomTime=$.now(),THIS[this.hash].zoomFactor=this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function beginZoomingOut(){THIS[this.hash].lastZoomTime=$.now(),THIS[this.hash].zoomFactor=1/this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function endZooming(){THIS[this.hash].zooming=!1}function scheduleZoom(viewer){$.requestAnimationFrame($.delegate(viewer,doZoom))}function doZoom(){var currentTime,deltaTime,adjustedFactor;THIS[this.hash].zooming&&this.viewport&&(deltaTime=(currentTime=$.now())-THIS[this.hash].lastZoomTime,adjustedFactor=Math.pow(THIS[this.hash].zoomFactor,deltaTime/1e3),this.viewport.zoomBy(adjustedFactor),this.viewport.applyConstraints(),THIS[this.hash].lastZoomTime=currentTime,scheduleZoom(this))}function doSingleZoomIn(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function doSingleZoomOut(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function lightUp(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function onHome(){this.viewport&&this.viewport.goHome()}function onFullScreen(){this.isFullPage()&&!$.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function onRotateLeft(){if(this.viewport){var currRotation=this.viewport.getRotation();0===currRotation?currRotation=270:currRotation-=90,this.viewport.setRotation(currRotation)}}function onRotateRight(){if(this.viewport){var currRotation=this.viewport.getRotation();270===currRotation?currRotation=0:currRotation+=90,this.viewport.setRotation(currRotation)}}function onPrevious(){var previous=this._sequenceIndex-1;this.navPrevNextWrap&&previous<0&&(previous+=this.tileSources.length),this.goToPage(previous)}function onNext(){var next=this._sequenceIndex+1;this.navPrevNextWrap&&next>=this.tileSources.length&&(next=0),this.goToPage(next)}var THIS={},nextHash=1;$.Viewer=function(options){var i,args=arguments,_this=this;if($.isPlainObject(options)||(options={id:args[0],xmlPath:args.length>1?args[1]:void 0,prefixUrl:args.length>2?args[2]:void 0,controls:args.length>3?args[3]:void 0,overlays:args.length>4?args[4]:void 0}),options.config&&($.extend(!0,options,options.config),delete options.config),$.extend(!0,this,{id:options.id,hash:options.hash||nextHash++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},$.DEFAULT_SETTINGS,options),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==THIS[this.hash]&&$.console.warn("Hash "+this.hash+" has already been used."),THIS[this.hash]={fsBoundsDelta:new $.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=$.now(),$.EventSource.call(this),this.addHandler("open-failed",function(event){var msg=$.getString("Errors.OpenFailed",event.eventSource,event.message);_this._showMessage(msg)}),$.ControlDock.call(this,options),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=$.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(style){style.width="100%",style.height="100%",style.overflow="hidden",style.position="absolute",style.top="0px",style.left="0px"}(this.canvas.style),$.setElementTouchActionNone(this.canvas),""!==options.tabIndex&&(this.canvas.tabIndex=void 0===options.tabIndex?0:options.tabIndex),this.container.className="openseadragon-container",function(style){style.width="100%",style.height="100%",style.position="relative",style.overflow="hidden",style.left="0px",style.top="0px",style.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new $.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:$.delegate(this,onCanvasKeyDown),keyHandler:$.delegate(this,onCanvasKeyPress),clickHandler:$.delegate(this,onCanvasClick),dblClickHandler:$.delegate(this,onCanvasDblClick),dragHandler:$.delegate(this,onCanvasDrag),dragEndHandler:$.delegate(this,onCanvasDragEnd),enterHandler:$.delegate(this,onCanvasEnter),exitHandler:$.delegate(this,onCanvasExit),pressHandler:$.delegate(this,onCanvasPress),releaseHandler:$.delegate(this,onCanvasRelease),nonPrimaryPressHandler:$.delegate(this,onCanvasNonPrimaryPress),nonPrimaryReleaseHandler:$.delegate(this,onCanvasNonPrimaryRelease),scrollHandler:$.delegate(this,onCanvasScroll),pinchHandler:$.delegate(this,onCanvasPinch)}),this.outerTracker=new $.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:$.delegate(this,onContainerEnter),exitHandler:$.delegate(this,onContainerExit)}),this.toolbar&&(this.toolbar=new $.ControlDock({element:this.toolbar})),this.bindStandardControls(),THIS[this.hash].prevContainerSize=_getSafeElemSize(this.container),this.world=new $.World({viewer:this}),this.world.addHandler("add-item",function(event){_this.source=_this.world.getItemAt(0).source,THIS[_this.hash].forceRedraw=!0,_this._updateRequestId||(_this._updateRequestId=scheduleUpdate(_this,updateMulti))}),this.world.addHandler("remove-item",function(event){_this.world.getItemCount()?_this.source=_this.world.getItemAt(0).source:_this.source=null,THIS[_this.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(event){_this.viewport&&_this.viewport._setContentBounds(_this.world.getHomeBounds(),_this.world.getContentFactor())}),this.world.addHandler("item-index-change",function(event){_this.source=_this.world.getItemAt(0).source}),this.viewport=new $.Viewport({containerSize:THIS[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new $.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:options.timeout}),this.tileCache=new $.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new $.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=$.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(i=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(i,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(i=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(i,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new $.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),i=0;i<this.customControls.length;i++)this.addControl(this.customControls[i].id,{anchor:this.customControls[i].anchor});$.requestAnimationFrame(function(){beginControlsAutoHide(_this)})},$.extend($.Viewer.prototype,$.EventSource.prototype,$.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(dzi){return $.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(dzi)},openTileSource:function(tileSource){return $.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(tileSource)},open:function(tileSources,initialPage){var _this=this;if(this.close(),tileSources){if(this.sequenceMode&&$.isArray(tileSources))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===initialPage||isNaN(initialPage)||(this.initialPage=initialPage),this.tileSources=tileSources,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),void this._updateSequenceButtons(this._sequenceIndex);if($.isArray(tileSources)||(tileSources=[tileSources]),tileSources.length){this._opening=!0;for(var failEvent,expected=tileSources.length,successes=0,failures=0,checkCompletion=function(){if(successes+failures===expected)if(successes){!_this._firstOpen&&_this.preserveViewport||(_this.viewport.goHome(!0),_this.viewport.update()),_this._firstOpen=!1;var source=tileSources[0];if(source.tileSource&&(source=source.tileSource),_this.overlays&&!_this.preserveOverlays)for(var i=0;i<_this.overlays.length;i++)_this.currentOverlays[i]=getOverlayObject(_this,_this.overlays[i]);_this._drawOverlays(),_this._opening=!1,_this.raiseEvent("open",{source:source})}else _this._opening=!1,_this.raiseEvent("open-failed",failEvent)},doOne=function(options){$.isPlainObject(options)&&options.tileSource||(options={tileSource:options}),void 0!==options.index&&($.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete options.index),void 0===options.collectionImmediately&&(options.collectionImmediately=!0);var originalSuccess=options.success;options.success=function(event){if(successes++,options.tileSource.overlays)for(var i=0;i<options.tileSource.overlays.length;i++)_this.addOverlay(options.tileSource.overlays[i]);originalSuccess&&originalSuccess(event),checkCompletion()};var originalError=options.error;options.error=function(event){failures++,failEvent||(failEvent=event),originalError&&originalError(event),checkCompletion()},_this.addTiledImage(options)},i=0;i<tileSources.length;i++)doOne(tileSources[i]);return this}}},close:function(){return THIS[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),THIS[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(THIS[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&($.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),THIS[this.hash]=null,delete THIS[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(enabled){return this.innerTracker.setTracking(enabled),this.outerTracker.setTracking(enabled),this.raiseEvent("mouse-enabled",{enabled:enabled}),this},areControlsEnabled:function(){var i,enabled=this.controls.length;for(i=0;i<this.controls.length;i++)enabled=enabled&&this.controls[i].isVisibile();return enabled},setControlsEnabled:function(enabled){return enabled?abortControlsAutoHide(this):beginControlsAutoHide(this),this.raiseEvent("controls-enabled",{enabled:enabled}),this},setDebugMode:function(debugMode){for(var i=0;i<this.world.getItemCount();i++)this.world.getItemAt(i).debugMode=debugMode;this.debugMode=debugMode,this.forceRedraw()},isFullPage:function(){return THIS[this.hash].fullPage},setFullPage:function(fullPage){var nodes,i,body=document.body,bodyStyle=body.style,docStyle=document.documentElement.style,_this=this;if(fullPage==this.isFullPage())return this;var fullPageEventArgs={fullPage:fullPage,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",fullPageEventArgs),fullPageEventArgs.preventDefaultAction)return this;if(fullPage){for(this.elementSize=$.getElementSize(this.element),this.pageScroll=$.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=bodyStyle.margin,this.docMargin=docStyle.margin,bodyStyle.margin="0",docStyle.margin="0",this.bodyPadding=bodyStyle.padding,this.docPadding=docStyle.padding,bodyStyle.padding="0",docStyle.padding="0",this.bodyWidth=bodyStyle.width,this.docWidth=docStyle.width,bodyStyle.width="100%",docStyle.width="100%",this.bodyHeight=bodyStyle.height,this.docHeight=docStyle.height,bodyStyle.height="100%",docStyle.height="100%",this.previousBody=[],THIS[this.hash].prevElementParent=this.element.parentNode,THIS[this.hash].prevNextSibling=this.element.nextSibling,THIS[this.hash].prevElementWidth=this.element.style.width,THIS[this.hash].prevElementHeight=this.element.style.height,nodes=body.childNodes.length,i=0;i<nodes;i++)this.previousBody.push(body.childNodes[0]),body.removeChild(body.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,body.appendChild(this.toolbar.element),$.addClass(this.toolbar.element,"fullpage")),$.addClass(this.element,"fullpage"),body.appendChild(this.element),this.element.style.height=$.getWindowSize().y+"px",this.element.style.width=$.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=$.getElementSize(this.element).y-$.getElementSize(this.toolbar.element).y+"px"),THIS[this.hash].fullPage=!0,$.delegate(this,onContainerEnter)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,bodyStyle.margin=this.bodyMargin,docStyle.margin=this.docMargin,bodyStyle.padding=this.bodyPadding,docStyle.padding=this.docPadding,bodyStyle.width=this.bodyWidth,docStyle.width=this.docWidth,bodyStyle.height=this.bodyHeight,docStyle.height=this.docHeight,body.removeChild(this.element),nodes=this.previousBody.length,i=0;i<nodes;i++)body.appendChild(this.previousBody.shift());$.removeClass(this.element,"fullpage"),THIS[this.hash].prevElementParent.insertBefore(this.element,THIS[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(body.removeChild(this.toolbar.element),$.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=THIS[this.hash].prevElementWidth,this.element.style.height=THIS[this.hash].prevElementHeight;var restoreScrollCounter=0,restoreScroll=function(){$.setPageScroll(_this.pageScroll);var pageScroll=$.getPageScroll();++restoreScrollCounter<10&&(pageScroll.x!==_this.pageScroll.x||pageScroll.y!==_this.pageScroll.y)&&$.requestAnimationFrame(restoreScroll)};$.requestAnimationFrame(restoreScroll),THIS[this.hash].fullPage=!1,$.delegate(this,onContainerExit)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:fullPage}),this},setFullScreen:function(fullScreen){var _this=this;if(!$.supportsFullScreen)return this.setFullPage(fullScreen);if($.isFullScreen()===fullScreen)return this;var fullScreeEventArgs={fullScreen:fullScreen,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",fullScreeEventArgs),fullScreeEventArgs.preventDefaultAction)return this;if(fullScreen){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var onFullScreenChange=function(){var isFullScreen=$.isFullScreen();isFullScreen||($.removeEvent(document,$.fullScreenEventName,onFullScreenChange),$.removeEvent(document,$.fullScreenErrorEventName,onFullScreenChange),_this.setFullPage(!1),_this.isFullPage()&&(_this.element.style.width=_this.fullPageStyleWidth,_this.element.style.height=_this.fullPageStyleHeight)),_this.navigator&&_this.viewport&&_this.navigator.update(_this.viewport),_this.raiseEvent("full-screen",{fullScreen:isFullScreen})};$.addEvent(document,$.fullScreenEventName,onFullScreenChange),$.addEvent(document,$.fullScreenErrorEventName,onFullScreenChange),$.requestFullScreen(document.body)}else $.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(visible){return this.container.style.visibility=visible?"":"hidden",this.raiseEvent("visible",{visible:visible}),this},addTiledImage:function(options){function raiseAddItemFailed(event){for(var i=0;i<_this._loadQueue.length;i++)if(_this._loadQueue[i]===myQueueItem){_this._loadQueue.splice(i,1);break}0===_this._loadQueue.length&&refreshWorld(myQueueItem),_this.raiseEvent("add-item-failed",event),options.error&&options.error(event)}function refreshWorld(theItem){_this.collectionMode&&(_this.world.arrange({immediately:theItem.options.collectionImmediately,rows:_this.collectionRows,columns:_this.collectionColumns,layout:_this.collectionLayout,tileSize:_this.collectionTileSize,tileMargin:_this.collectionTileMargin}),_this.world.setAutoRefigureSizes(!0))}function processReadyItems(){for(var queueItem,tiledImage,optionsClone;_this._loadQueue.length&&(queueItem=_this._loadQueue[0]).tileSource;){if(_this._loadQueue.splice(0,1),queueItem.options.replace){var newIndex=_this.world.getIndexOfItem(queueItem.options.replaceItem);-1!=newIndex&&(queueItem.options.index=newIndex),_this.world.removeItem(queueItem.options.replaceItem)}tiledImage=new $.TiledImage({viewer:_this,source:queueItem.tileSource,viewport:_this.viewport,drawer:_this.drawer,tileCache:_this.tileCache,imageLoader:_this.imageLoader,x:queueItem.options.x,y:queueItem.options.y,width:queueItem.options.width,height:queueItem.options.height,fitBounds:queueItem.options.fitBounds,fitBoundsPlacement:queueItem.options.fitBoundsPlacement,clip:queueItem.options.clip,placeholderFillStyle:queueItem.options.placeholderFillStyle,opacity:queueItem.options.opacity,preload:queueItem.options.preload,degrees:queueItem.options.degrees,compositeOperation:queueItem.options.compositeOperation,springStiffness:_this.springStiffness,animationTime:_this.animationTime,minZoomImageRatio:_this.minZoomImageRatio,wrapHorizontal:_this.wrapHorizontal,wrapVertical:_this.wrapVertical,immediateRender:_this.immediateRender,blendTime:_this.blendTime,alwaysBlend:_this.alwaysBlend,minPixelRatio:_this.minPixelRatio,smoothTileEdgesMinZoom:_this.smoothTileEdgesMinZoom,iOSDevice:_this.iOSDevice,crossOriginPolicy:queueItem.options.crossOriginPolicy,ajaxWithCredentials:queueItem.options.ajaxWithCredentials,loadTilesWithAjax:queueItem.options.loadTilesWithAjax,ajaxHeaders:queueItem.options.ajaxHeaders,debugMode:_this.debugMode}),_this.collectionMode&&_this.world.setAutoRefigureSizes(!1),_this.world.addItem(tiledImage,{index:queueItem.options.index}),0===_this._loadQueue.length&&refreshWorld(queueItem),1!==_this.world.getItemCount()||_this.preserveViewport||_this.viewport.goHome(!0),_this.navigator&&(optionsClone=$.extend({},queueItem.options,{replace:!1,originalTiledImage:tiledImage,tileSource:queueItem.tileSource}),_this.navigator.addTiledImage(optionsClone)),queueItem.options.success&&queueItem.options.success({item:tiledImage})}}$.console.assert(options,"[Viewer.addTiledImage] options is required"),$.console.assert(options.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),$.console.assert(!options.replace||options.index>-1&&options.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var _this=this;options.replace&&(options.replaceItem=_this.world.getItemAt(options.index)),this._hideMessage(),void 0===options.placeholderFillStyle&&(options.placeholderFillStyle=this.placeholderFillStyle),void 0===options.opacity&&(options.opacity=this.opacity),void 0===options.preload&&(options.preload=this.preload),void 0===options.compositeOperation&&(options.compositeOperation=this.compositeOperation),void 0===options.crossOriginPolicy&&(options.crossOriginPolicy=void 0!==options.tileSource.crossOriginPolicy?options.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===options.ajaxWithCredentials&&(options.ajaxWithCredentials=this.ajaxWithCredentials),void 0===options.loadTilesWithAjax&&(options.loadTilesWithAjax=this.loadTilesWithAjax),void 0===options.ajaxHeaders||null===options.ajaxHeaders?options.ajaxHeaders=this.ajaxHeaders:$.isPlainObject(options.ajaxHeaders)&&$.isPlainObject(this.ajaxHeaders)&&(options.ajaxHeaders=$.extend({},this.ajaxHeaders,options.ajaxHeaders));var myQueueItem={options:options};$.isArray(options.tileSource)?setTimeout(function(){raiseAddItemFailed({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:options.tileSource,options:options})}):(this._loadQueue.push(myQueueItem),function(viewer,tileSource,imgOptions,successCallback,failCallback){function waitUntilReady(tileSource,originalTileSource){tileSource.ready?successCallback(tileSource):(tileSource.addHandler("ready",function(){successCallback(tileSource)}),tileSource.addHandler("open-failed",function(event){failCallback({message:event.message,source:originalTileSource})}))}var _this=viewer;if("string"==$.type(tileSource))if(tileSource.match(/^\s*<.*>\s*$/))tileSource=$.parseXml(tileSource);else if(tileSource.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var tileSourceJ=$.parseJSON(tileSource);tileSource=tileSourceJ}catch(e){}setTimeout(function(){if("string"==$.type(tileSource))(tileSource=new $.TileSource({url:tileSource,crossOriginPolicy:void 0!==imgOptions.crossOriginPolicy?imgOptions.crossOriginPolicy:viewer.crossOriginPolicy,ajaxWithCredentials:viewer.ajaxWithCredentials,ajaxHeaders:viewer.ajaxHeaders,useCanvas:viewer.useCanvas,success:function(event){successCallback(event.tileSource)}})).addHandler("open-failed",function(event){failCallback(event)});else if($.isPlainObject(tileSource)||tileSource.nodeType)if(void 0!==tileSource.crossOriginPolicy||void 0===imgOptions.crossOriginPolicy&&void 0===viewer.crossOriginPolicy||(tileSource.crossOriginPolicy=void 0!==imgOptions.crossOriginPolicy?imgOptions.crossOriginPolicy:viewer.crossOriginPolicy),void 0===tileSource.ajaxWithCredentials&&(tileSource.ajaxWithCredentials=viewer.ajaxWithCredentials),void 0===tileSource.useCanvas&&(tileSource.useCanvas=viewer.useCanvas),$.isFunction(tileSource.getTileUrl)){var customTileSource=new $.TileSource(tileSource);customTileSource.getTileUrl=tileSource.getTileUrl,successCallback(customTileSource)}else{var $TileSource=$.TileSource.determineType(_this,tileSource);if(!$TileSource)return void failCallback({message:"Unable to load TileSource",source:tileSource});waitUntilReady(new $TileSource($TileSource.prototype.configure.apply(_this,[tileSource])),tileSource)}else waitUntilReady(tileSource,tileSource)})}(this,options.tileSource,options,function(tileSource){myQueueItem.tileSource=tileSource,processReadyItems()},function(event){event.options=options,raiseAddItemFailed(event),processReadyItems()}))},addSimpleImage:function(options){$.console.assert(options,"[Viewer.addSimpleImage] options is required"),$.console.assert(options.url,"[Viewer.addSimpleImage] options.url is required");var opts=$.extend({},options,{tileSource:{type:"image",url:options.url}});delete opts.url,this.addTiledImage(opts)},addLayer:function(options){var _this=this;$.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var optionsClone=$.extend({},options,{success:function(event){_this.raiseEvent("add-layer",{options:options,drawer:event.item})},error:function(event){_this.raiseEvent("add-layer-failed",event)}});return this.addTiledImage(optionsClone),this},getLayerAtLevel:function(level){return $.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(level)},getLevelOfLayer:function(drawer){return $.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(drawer)},getLayersCount:function(){return $.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(drawer,level){return $.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(drawer,level)},removeLayer:function(drawer){return $.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(drawer)},forceRedraw:function(){return THIS[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var onFocusHandler=$.delegate(this,onFocus),onBlurHandler=$.delegate(this,onBlur),onNextHandler=$.delegate(this,onNext),onPreviousHandler=$.delegate(this,onPrevious),navImages=this.navImages,useGroup=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(useGroup=!1),this.previousButton=new $.Button({element:this.previousButton?$.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.PreviousPage"),srcRest:resolveUrl(this.prefixUrl,navImages.previous.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.previous.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.previous.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.previous.DOWN),onRelease:onPreviousHandler,onFocus:onFocusHandler,onBlur:onBlurHandler}),this.nextButton=new $.Button({element:this.nextButton?$.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.NextPage"),srcRest:resolveUrl(this.prefixUrl,navImages.next.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.next.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.next.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.next.DOWN),onRelease:onNextHandler,onFocus:onFocusHandler,onBlur:onBlurHandler}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),useGroup&&(this.paging=new $.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:$.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||$.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var beginZoomingInHandler=$.delegate(this,beginZoomingIn),endZoomingHandler=$.delegate(this,endZooming),doSingleZoomInHandler=$.delegate(this,doSingleZoomIn),beginZoomingOutHandler=$.delegate(this,beginZoomingOut),doSingleZoomOutHandler=$.delegate(this,doSingleZoomOut),onHomeHandler=$.delegate(this,onHome),onFullScreenHandler=$.delegate(this,onFullScreen),onRotateLeftHandler=$.delegate(this,onRotateLeft),onRotateRightHandler=$.delegate(this,onRotateRight),onFocusHandler=$.delegate(this,onFocus),onBlurHandler=$.delegate(this,onBlur),navImages=this.navImages,buttons=[],useGroup=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton)&&(useGroup=!1),this.showZoomControl&&(buttons.push(this.zoomInButton=new $.Button({element:this.zoomInButton?$.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomIn"),srcRest:resolveUrl(this.prefixUrl,navImages.zoomIn.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.zoomIn.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.zoomIn.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.zoomIn.DOWN),onPress:beginZoomingInHandler,onRelease:endZoomingHandler,onClick:doSingleZoomInHandler,onEnter:beginZoomingInHandler,onExit:endZoomingHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),buttons.push(this.zoomOutButton=new $.Button({element:this.zoomOutButton?$.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomOut"),srcRest:resolveUrl(this.prefixUrl,navImages.zoomOut.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.zoomOut.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.zoomOut.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.zoomOut.DOWN),onPress:beginZoomingOutHandler,onRelease:endZoomingHandler,onClick:doSingleZoomOutHandler,onEnter:beginZoomingOutHandler,onExit:endZoomingHandler,onFocus:onFocusHandler,onBlur:onBlurHandler}))),this.showHomeControl&&buttons.push(this.homeButton=new $.Button({element:this.homeButton?$.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.Home"),srcRest:resolveUrl(this.prefixUrl,navImages.home.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.home.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.home.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.home.DOWN),onRelease:onHomeHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),this.showFullPageControl&&buttons.push(this.fullPageButton=new $.Button({element:this.fullPageButton?$.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.FullPage"),srcRest:resolveUrl(this.prefixUrl,navImages.fullpage.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.fullpage.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.fullpage.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.fullpage.DOWN),onRelease:onFullScreenHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),this.showRotationControl&&(buttons.push(this.rotateLeftButton=new $.Button({element:this.rotateLeftButton?$.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.RotateLeft"),srcRest:resolveUrl(this.prefixUrl,navImages.rotateleft.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.rotateleft.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.rotateleft.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.rotateleft.DOWN),onRelease:onRotateLeftHandler,onFocus:onFocusHandler,onBlur:onBlurHandler})),buttons.push(this.rotateRightButton=new $.Button({element:this.rotateRightButton?$.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.RotateRight"),srcRest:resolveUrl(this.prefixUrl,navImages.rotateright.REST),srcGroup:resolveUrl(this.prefixUrl,navImages.rotateright.GROUP),srcHover:resolveUrl(this.prefixUrl,navImages.rotateright.HOVER),srcDown:resolveUrl(this.prefixUrl,navImages.rotateright.DOWN),onRelease:onRotateRightHandler,onFocus:onFocusHandler,onBlur:onBlurHandler}))),useGroup&&(this.buttons=new $.ButtonGroup({buttons:buttons,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",$.delegate(this,lightUp)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||$.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||$.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(page){return this.tileSources&&page>=0&&page<this.tileSources.length&&(this.raiseEvent("page",{page:page}),this._sequenceIndex=page,this._updateSequenceButtons(page),this.open(this.tileSources[page]),this.referenceStrip&&this.referenceStrip.setFocus(page)),this},addOverlay:function(element,location,placement,onDraw){var options;if(options=$.isPlainObject(element)?element:{element:element,location:location,placement:placement,onDraw:onDraw},element=$.getElement(options.element),getOverlayIndex(this.currentOverlays,element)>=0)return this;var overlay=getOverlayObject(this,options);return this.currentOverlays.push(overlay),overlay.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:element,location:options.location,placement:options.placement}),this},updateOverlay:function(element,location,placement){var i;return element=$.getElement(element),(i=getOverlayIndex(this.currentOverlays,element))>=0&&(this.currentOverlays[i].update(location,placement),THIS[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:element,location:location,placement:placement})),this},removeOverlay:function(element){var i;return element=$.getElement(element),(i=getOverlayIndex(this.currentOverlays,element))>=0&&(this.currentOverlays[i].destroy(),this.currentOverlays.splice(i,1),THIS[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:element})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return THIS[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(element){var i;return element=$.getElement(element),(i=getOverlayIndex(this.currentOverlays,element))>=0?this.currentOverlays[i]:null},_updateSequenceButtons:function(page){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==page?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(page>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(message){this._hideMessage();var div=$.makeNeutralElement("div");div.appendChild(document.createTextNode(message)),this.messageDiv=$.makeCenteredNode(div),$.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var div=this.messageDiv;div&&(div.parentNode.removeChild(div),delete this.messageDiv)},gestureSettingsByDeviceType:function(type){switch(type){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var i,length=this.currentOverlays.length;for(i=0;i<length;i++)this.currentOverlays[i].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new $.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else $.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function($){function onCanvasClick(event){event.quick&&this.viewer.viewport&&(this.viewer.viewport.panTo(this.viewport.pointFromPixel(event.position)),this.viewer.viewport.applyConstraints())}function onCanvasDrag(event){this.viewer.viewport&&(this.panHorizontal||(event.delta.x=0),this.panVertical||(event.delta.y=0),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(event.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function onCanvasRelease(event){event.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function onCanvasScroll(event){return this.viewer.raiseEvent("navigator-scroll",{tracker:event.eventSource,position:event.position,scroll:event.scroll,shift:event.shift,originalEvent:event.originalEvent}),!1}function _setTransformRotate(element,degrees){element.style.webkitTransform="rotate("+degrees+"deg)",element.style.mozTransform="rotate("+degrees+"deg)",element.style.msTransform="rotate("+degrees+"deg)",element.style.oTransform="rotate("+degrees+"deg)",element.style.transform="rotate("+degrees+"deg)"}$.Navigator=function(options){function rotate(degrees){_setTransformRotate(_this.displayRegionContainer,degrees),_setTransformRotate(_this.displayRegion,-degrees),_this.viewport.setRotation(degrees)}var viewerSize,navigatorSize,viewer=options.viewer,_this=this;if(options.id?(this.element=document.getElementById(options.id),options.controlOptions={anchor:$.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(options.id="navigator-"+$.now(),this.element=$.makeNeutralElement("div"),options.controlOptions={anchor:$.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:options.autoFade},options.position&&("BOTTOM_RIGHT"==options.position?options.controlOptions.anchor=$.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==options.position?options.controlOptions.anchor=$.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==options.position?options.controlOptions.anchor=$.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==options.position?options.controlOptions.anchor=$.ControlAnchor.TOP_LEFT:"ABSOLUTE"==options.position&&(options.controlOptions.anchor=$.ControlAnchor.ABSOLUTE,options.controlOptions.top=options.top,options.controlOptions.left=options.left,options.controlOptions.height=options.height,options.controlOptions.width=options.width))),this.element.id=options.id,this.element.className+=" navigator",options=$.extend(!0,{sizeRatio:$.DEFAULT_SETTINGS.navigatorSizeRatio},options,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:options.autoResize,minZoomImageRatio:1}),options.minPixelRatio=this.minPixelRatio=viewer.minPixelRatio,$.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new $.Point(1,1),this.totalBorderWidths=new $.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),options.controlOptions.anchor!=$.ControlAnchor.NONE&&function(style,borderWidth){style.margin="0px",style.border=borderWidth+"px solid #555",style.padding="0px",style.background="#000",style.opacity=.8,style.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=$.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(style,borderWidth){style.position="relative",style.top="0px",style.left="0px",style.fontSize="0px",style.overflow="hidden",style.border=borderWidth+"px solid #900",style.margin="0px",style.padding="0px",style.background="transparent",style.float="left",style.cssFloat="left",style.styleFloat="left",style.zIndex=999999999,style.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=$.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",viewer.addControl(this.element,options.controlOptions),this._resizeWithViewer=options.controlOptions.anchor!=$.ControlAnchor.ABSOLUTE&&options.controlOptions.anchor!=$.ControlAnchor.NONE,this._resizeWithViewer&&(options.width&&options.height?(this.element.style.height="number"==typeof options.height?options.height+"px":options.height,this.element.style.width="number"==typeof options.width?options.width+"px":options.width):(viewerSize=$.getElementSize(viewer.element),this.element.style.height=Math.round(viewerSize.y*options.sizeRatio)+"px",this.element.style.width=Math.round(viewerSize.x*options.sizeRatio)+"px",this.oldViewerSize=viewerSize),navigatorSize=$.getElementSize(this.element),this.elementArea=navigatorSize.x*navigatorSize.y),this.oldContainerSize=new $.Point(0,0),$.Viewer.apply(this,[options]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),options.navigatorRotate){rotate(options.viewer.viewport?options.viewer.viewport.getRotation():options.viewer.degrees||0),options.viewer.addHandler("rotate",function(args){rotate(args.degrees)})}this.innerTracker.destroy(),this.innerTracker=new $.MouseTracker({element:this.element,dragHandler:$.delegate(this,onCanvasDrag),clickHandler:$.delegate(this,onCanvasClick),releaseHandler:$.delegate(this,onCanvasRelease),scrollHandler:$.delegate(this,onCanvasScroll)}),this.addHandler("reset-size",function(){_this.viewport&&_this.viewport.goHome(!0)}),viewer.world.addHandler("item-index-change",function(event){window.setTimeout(function(){var item=_this.world.getItemAt(event.previousIndex);_this.world.setItemIndex(item,event.newIndex)},1)}),viewer.world.addHandler("remove-item",function(event){var theirItem=event.item,myItem=_this._getMatchingItem(theirItem);myItem&&_this.world.removeItem(myItem)}),this.update(viewer.viewport)},$.extend($.Navigator.prototype,$.EventSource.prototype,$.Viewer.prototype,{updateSize:function(){if(this.viewport){var containerSize=new $.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);containerSize.equals(this.oldContainerSize)||(this.viewport.resize(containerSize,!0),this.viewport.goHome(!0),this.oldContainerSize=containerSize,this.drawer.clear(),this.world.draw())}},update:function(viewport){var viewerSize,newWidth,newHeight,bounds,topleft,bottomright;if(viewerSize=$.getElementSize(this.viewer.element),this._resizeWithViewer&&viewerSize.x&&viewerSize.y&&!viewerSize.equals(this.oldViewerSize)&&(this.oldViewerSize=viewerSize,this.maintainSizeRatio||!this.elementArea?(newWidth=viewerSize.x*this.sizeRatio,newHeight=viewerSize.y*this.sizeRatio):(newWidth=Math.sqrt(this.elementArea*(viewerSize.x/viewerSize.y)),newHeight=this.elementArea/newWidth),this.element.style.width=Math.round(newWidth)+"px",this.element.style.height=Math.round(newHeight)+"px",this.elementArea||(this.elementArea=newWidth*newHeight),this.updateSize()),viewport&&this.viewport){bounds=viewport.getBoundsNoRotate(!0),topleft=this.viewport.pixelFromPointNoRotate(bounds.getTopLeft(),!1),bottomright=this.viewport.pixelFromPointNoRotate(bounds.getBottomRight(),!1).minus(this.totalBorderWidths);var style=this.displayRegion.style;style.display=this.world.getItemCount()?"block":"none",style.top=Math.round(topleft.y)+"px",style.left=Math.round(topleft.x)+"px";var width=Math.abs(topleft.x-bottomright.x),height=Math.abs(topleft.y-bottomright.y);style.width=Math.round(Math.max(width,0))+"px",style.height=Math.round(Math.max(height,0))+"px"}},addTiledImage:function(options){var _this=this,original=options.originalTiledImage;delete options.original;var optionsClone=$.extend({},options,{success:function(event){function matchBounds(){_this._matchBounds(myItem,original)}var myItem=event.item;myItem._originalForNavigator=original,_this._matchBounds(myItem,original,!0),original.addHandler("bounds-change",matchBounds),original.addHandler("clip-change",matchBounds),original.addHandler("opacity-change",function(){_this._matchOpacity(myItem,original)}),original.addHandler("composite-operation-change",function(){_this._matchCompositeOperation(myItem,original)})}});return $.Viewer.prototype.addTiledImage.apply(this,[optionsClone])},_getMatchingItem:function(theirItem){for(var item,count=this.world.getItemCount(),i=0;i<count;i++)if((item=this.world.getItemAt(i))._originalForNavigator===theirItem)return item;return null},_matchBounds:function(myItem,theirItem,immediately){var bounds=theirItem.getBoundsNoRotate();myItem.setPosition(bounds.getTopLeft(),immediately),myItem.setWidth(bounds.width,immediately),myItem.setRotation(theirItem.getRotation(),immediately),myItem.setClip(theirItem.getClip())},_matchOpacity:function(myItem,theirItem){myItem.setOpacity(theirItem.opacity)},_matchCompositeOperation:function(myItem,theirItem){myItem.setCompositeOperation(theirItem.compositeOperation)}})}(OpenSeadragon),function($){var I18N={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right"}};$.extend($,{getString:function(prop){var i,props=prop.split("."),string=null,args=arguments,container=I18N;for(i=0;i<props.length-1;i++)container=container[props[i]]||{};return"string"!=typeof(string=container[props[i]])&&($.console.log("Untranslated source string:",prop),string=""),string.replace(/\{\d+\}/g,function(capture){var i=parseInt(capture.match(/\d+/),10)+1;return i<args.length?args[i]:""})},setString:function(prop,value){var i,props=prop.split("."),container=I18N;for(i=0;i<props.length-1;i++)container[props[i]]||(container[props[i]]={}),container=container[props[i]];container[props[i]]=value}})}(OpenSeadragon),function($){$.Point=function(x,y){this.x="number"==typeof x?x:0,this.y="number"==typeof y?y:0},$.Point.prototype={clone:function(){return new $.Point(this.x,this.y)},plus:function(point){return new $.Point(this.x+point.x,this.y+point.y)},minus:function(point){return new $.Point(this.x-point.x,this.y-point.y)},times:function(factor){return new $.Point(this.x*factor,this.y*factor)},divide:function(factor){return new $.Point(this.x/factor,this.y/factor)},negate:function(){return new $.Point(-this.x,-this.y)},distanceTo:function(point){return Math.sqrt(Math.pow(this.x-point.x,2)+Math.pow(this.y-point.y,2))},squaredDistanceTo:function(point){return Math.pow(this.x-point.x,2)+Math.pow(this.y-point.y,2)},apply:function(func){return new $.Point(func(this.x),func(this.y))},equals:function(point){return point instanceof $.Point&&this.x===point.x&&this.y===point.y},rotate:function(degrees,pivot){pivot=pivot||new $.Point(0,0);var cos,sin;if(degrees%90==0){switch($.positiveModulo(degrees,360)){case 0:cos=1,sin=0;break;case 90:cos=0,sin=1;break;case 180:cos=-1,sin=0;break;case 270:cos=0,sin=-1}}else{var angle=degrees*Math.PI/180;cos=Math.cos(angle),sin=Math.sin(angle)}var x=cos*(this.x-pivot.x)-sin*(this.y-pivot.y)+pivot.x,y=sin*(this.x-pivot.x)+cos*(this.y-pivot.y)+pivot.y;return new $.Point(x,y)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function($){$.TileSource=function(width,height,tileSize,tileOverlap,minLevel,maxLevel){var options,i,_this=this,args=arguments;if(options=$.isPlainObject(width)?width:{width:args[0],height:args[1],tileSize:args[2],tileOverlap:args[3],minLevel:args[4],maxLevel:args[5]},$.EventSource.call(this),$.extend(!0,this,options),!this.success)for(i=0;i<arguments.length;i++)if($.isFunction(arguments[i])){this.success=arguments[i];break}this.success&&this.addHandler("ready",function(event){_this.success(event)}),"string"==$.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new $.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=options.width&&options.height?options.width/options.height:1,this.dimensions=new $.Point(options.width,options.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=options.tileOverlap?options.tileOverlap:0,this.minLevel=options.minLevel?options.minLevel:0,this.maxLevel=void 0!==options.maxLevel&&null!==options.maxLevel?options.maxLevel:options.width&&options.height?Math.ceil(Math.log(Math.max(options.width,options.height))/Math.log(2)):0,this.success&&$.isFunction(this.success)&&this.success(this))},$.TileSource.prototype={getTileSize:function(level){return $.console.error("[TileSource.getTileSize] is deprecated.Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(level){return this._tileWidth?this._tileWidth:this.getTileSize(level)},getTileHeight:function(level){return this._tileHeight?this._tileHeight:this.getTileSize(level)},getLevelScale:function(level){var i,levelScaleCache={};for(i=0;i<=this.maxLevel;i++)levelScaleCache[i]=1/Math.pow(2,this.maxLevel-i);return this.getLevelScale=function(_level){return levelScaleCache[_level]},this.getLevelScale(level)},getNumTiles:function(level){var scale=this.getLevelScale(level),x=Math.ceil(scale*this.dimensions.x/this.getTileWidth(level)),y=Math.ceil(scale*this.dimensions.y/this.getTileHeight(level));return new $.Point(x,y)},getPixelRatio:function(level){var imageSizeScaled=this.dimensions.times(this.getLevelScale(level)),rx=1/imageSizeScaled.x,ry=1/imageSizeScaled.y;return new $.Point(rx,ry)},getClosestLevel:function(){var i,tiles;for(i=this.minLevel+1;i<=this.maxLevel&&!((tiles=this.getNumTiles(i)).x>1||tiles.y>1);i++);return i-1},getTileAtPoint:function(level,point){var validPoint=point.x>=0&&point.x<=1&&point.y>=0&&point.y<=1/this.aspectRatio;$.console.assert(validPoint,"[TileSource.getTileAtPoint] must be called with a valid point.");var widthScaled=this.dimensions.x*this.getLevelScale(level),pixelX=point.x*widthScaled,pixelY=point.y*widthScaled,x=Math.floor(pixelX/this.getTileWidth(level)),y=Math.floor(pixelY/this.getTileHeight(level));point.x>=1&&(x=this.getNumTiles(level).x-1);return point.y>=1/this.aspectRatio-1e-16&&(y=this.getNumTiles(level).y-1),new $.Point(x,y)},getTileBounds:function(level,x,y){var dimensionsScaled=this.dimensions.times(this.getLevelScale(level)),tileWidth=this.getTileWidth(level),tileHeight=this.getTileHeight(level),px=0===x?0:tileWidth*x-this.tileOverlap,py=0===y?0:tileHeight*y-this.tileOverlap,sx=tileWidth+(0===x?1:2)*this.tileOverlap,sy=tileHeight+(0===y?1:2)*this.tileOverlap,scale=1/dimensionsScaled.x;return sx=Math.min(sx,dimensionsScaled.x-px),sy=Math.min(sy,dimensionsScaled.y-py),new $.Rect(px*scale,py*scale,sx*scale,sy*scale)},getImageInfo:function(url){var callbackName,callback,readySource,options,urlParts,filename,lastDot,_this=this;url&&(lastDot=(filename=(urlParts=url.split("/"))[urlParts.length-1]).lastIndexOf("."))>-1&&(urlParts[urlParts.length-1]=filename.slice(0,lastDot)),callback=function(data){"string"==typeof data&&(data=$.parseXml(data));var $TileSource=$.TileSource.determineType(_this,data,url);$TileSource?(void 0===(options=$TileSource.prototype.configure.apply(_this,[data,url])).ajaxWithCredentials&&(options.ajaxWithCredentials=_this.ajaxWithCredentials),readySource=new $TileSource(options),_this.ready=!0,_this.raiseEvent("ready",{tileSource:readySource})):_this.raiseEvent("open-failed",{message:"Unable to load TileSource",source:url})},url.match(/\.js$/)?(callbackName=url.split("/").pop().replace(".js",""),$.jsonp({url:url,async:!1,callbackName:callbackName,callback:callback})):$.makeAjaxRequest({url:url,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(xhr){var data=function(xhr){var statusText,data,responseText=xhr.responseText,status=xhr.status;if(!xhr)throw new Error($.getString("Errors.Security"));if(200!==xhr.status&&0!==xhr.status)throw status=xhr.status,statusText=404==status?"Not Found":xhr.statusText,new Error($.getString("Errors.Status",status,statusText));if(responseText.match(/\s*<.*/))try{data=xhr.responseXML&&xhr.responseXML.documentElement?xhr.responseXML:$.parseXml(responseText)}catch(e){data=xhr.responseText}else if(responseText.match(/\s*[\{\[].*/))try{data=$.parseJSON(responseText)}catch(e){data=responseText}else data=responseText;return data}(xhr);callback(data)},error:function(xhr,exc){var msg;try{msg="HTTP "+xhr.status+" attempting to load TileSource"}catch(e){var formattedExc;formattedExc=void 0!==exc&&exc.toString?exc.toString():"Unknown error",msg=formattedExc+" attempting to load TileSource"}_this.raiseEvent("open-failed",{message:msg,source:url})}})},supports:function(data,url){return!1},configure:function(data,url){throw new Error("Method not implemented.")},getTileUrl:function(level,x,y){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(level,x,y){return{}},tileExists:function(level,x,y){var numTiles=this.getNumTiles(level);return level>=this.minLevel&&level<=this.maxLevel&&x>=0&&y>=0&&x<numTiles.x&&y<numTiles.y}},$.extend(!0,$.TileSource.prototype,$.EventSource.prototype),$.TileSource.determineType=function(tileSource,data,url){var property;for(property in OpenSeadragon)if(property.match(/.+TileSource$/)&&$.isFunction(OpenSeadragon[property])&&$.isFunction(OpenSeadragon[property].prototype.supports)&&OpenSeadragon[property].prototype.supports.call(tileSource,data,url))return OpenSeadragon[property];$.console.error("No TileSource was able to open %s %s",url,data)}}(OpenSeadragon),function($){function configureFromObject(tileSource,configuration){var rectData,i,imageData=configuration.Image,tilesUrl=imageData.Url,fileFormat=imageData.Format,sizeData=imageData.Size,dispRectData=imageData.DisplayRect||[],width=parseInt(sizeData.Width,10),height=parseInt(sizeData.Height,10),tileSize=parseInt(imageData.TileSize,10),tileOverlap=parseInt(imageData.Overlap,10),displayRects=[];for(i=0;i<dispRectData.length;i++)rectData=dispRectData[i].Rect,displayRects.push(new $.DisplayRect(parseInt(rectData.X,10),parseInt(rectData.Y,10),parseInt(rectData.Width,10),parseInt(rectData.Height,10),parseInt(rectData.MinLevel,10),parseInt(rectData.MaxLevel,10)));return $.extend(!0,{width:width,height:height,tileSize:tileSize,tileOverlap:tileOverlap,minLevel:null,maxLevel:null,tilesUrl:tilesUrl,fileFormat:fileFormat,displayRects:displayRects},configuration)}$.DziTileSource=function(width,height,tileSize,tileOverlap,tilesUrl,fileFormat,displayRects,minLevel,maxLevel){var i,rect,level,options;if(options=$.isPlainObject(width)?width:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=options.tilesUrl,this.fileFormat=options.fileFormat,this.displayRects=options.displayRects,this.displayRects)for(i=this.displayRects.length-1;i>=0;i--)for(level=(rect=this.displayRects[i]).minLevel;level<=rect.maxLevel;level++)this._levelRects[level]||(this._levelRects[level]=[]),this._levelRects[level].push(rect);$.TileSource.apply(this,[options])},$.extend($.DziTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){var ns;return data.Image?ns=data.Image.xmlns:data.documentElement&&("Image"!=data.documentElement.localName&&"Image"!=data.documentElement.tagName||(ns=data.documentElement.namespaceURI)),-1!==(ns=(ns||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==ns.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(data,url){var options;return options=$.isPlainObject(data)?configureFromObject(0,data):function(tileSource,xmlDoc){if(!xmlDoc||!xmlDoc.documentElement)throw new Error($.getString("Errors.Xml"));var dispRectNodes,dispRectNode,rectNode,sizeNode,i,root=xmlDoc.documentElement,rootName=root.localName||root.tagName,ns=xmlDoc.documentElement.namespaceURI,configuration=null,displayRects=[];if("Image"==rootName)try{if(void 0===(sizeNode=root.getElementsByTagName("Size")[0])&&(sizeNode=root.getElementsByTagNameNS(ns,"Size")[0]),configuration={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:root.getAttribute("Url"),Format:root.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(root.getAttribute("Overlap"),10),TileSize:parseInt(root.getAttribute("TileSize"),10),Size:{Height:parseInt(sizeNode.getAttribute("Height"),10),Width:parseInt(sizeNode.getAttribute("Width"),10)}}},!$.imageFormatSupported(configuration.Image.Format))throw new Error($.getString("Errors.ImageFormat",configuration.Image.Format.toUpperCase()));for(void 0===(dispRectNodes=root.getElementsByTagName("DisplayRect"))&&(dispRectNodes=root.getElementsByTagNameNS(ns,"DisplayRect")[0]),i=0;i<dispRectNodes.length;i++)void 0===(rectNode=(dispRectNode=dispRectNodes[i]).getElementsByTagName("Rect")[0])&&(rectNode=dispRectNode.getElementsByTagNameNS(ns,"Rect")[0]),displayRects.push({Rect:{X:parseInt(rectNode.getAttribute("X"),10),Y:parseInt(rectNode.getAttribute("Y"),10),Width:parseInt(rectNode.getAttribute("Width"),10),Height:parseInt(rectNode.getAttribute("Height"),10),MinLevel:parseInt(dispRectNode.getAttribute("MinLevel"),10),MaxLevel:parseInt(dispRectNode.getAttribute("MaxLevel"),10)}});return displayRects.length&&(configuration.Image.DisplayRect=displayRects),configureFromObject(0,configuration)}catch(e){throw e instanceof Error?e:new Error($.getString("Errors.Dzi"))}else{if("Collection"==rootName)throw new Error($.getString("Errors.Dzc"));if("Error"==rootName){var message=root.getElementsByTagName("Message")[0].firstChild.nodeValue;throw new Error(message)}}throw new Error($.getString("Errors.Dzi"))}(0,data),url&&!options.tilesUrl&&(options.tilesUrl=url.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=url.search(/\.(dzi|xml|js)\?/)?options.queryParams=url.match(/\?.*/):options.queryParams=""),options},getTileUrl:function(level,x,y){return[this.tilesUrl,level,"/",x,"_",y,".",this.fileFormat,this.queryParams].join("")},tileExists:function(level,x,y){var rect,scale,xMin,yMin,xMax,yMax,i,rects=this._levelRects[level];if(!rects||!rects.length)return!0;for(i=rects.length-1;i>=0;i--)if(rect=rects[i],!(level<rect.minLevel||level>rect.maxLevel)&&(scale=this.getLevelScale(level),xMin=rect.x*scale,yMin=rect.y*scale,xMax=xMin+rect.width*scale,yMax=yMin+rect.height*scale,xMin=Math.floor(xMin/this._tileWidth),yMin=Math.floor(yMin/this._tileWidth),xMax=Math.ceil(xMax/this._tileWidth),yMax=Math.ceil(yMax/this._tileWidth),xMin<=x&&x<xMax&&yMin<=y&&y<yMax))return!0;return!1}})}(OpenSeadragon),function($){function parseXML10(node,configuration,property){var i,value;if(3==node.nodeType&&property)(value=node.nodeValue.trim()).match(/^\d*$/)&&(value=Number(value)),configuration[property]?($.isArray(configuration[property])||(configuration[property]=[configuration[property]]),configuration[property].push(value)):configuration[property]=value;else if(1==node.nodeType)for(i=0;i<node.childNodes.length;i++)parseXML10(node.childNodes[i],configuration,node.nodeName)}$.IIIFTileSource=function(options){if($.extend(!0,this,options),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(options.tileSizePerScaleFactor={},this.tile_width&&this.tile_height)options.tileWidth=this.tile_width,options.tileHeight=this.tile_height;else if(this.tile_width)options.tileSize=this.tile_width;else if(this.tile_height)options.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)options.tileWidth=this.tiles[0].width,options.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var t=0;t<this.tiles.length;t++)for(var sf=0;sf<this.tiles[t].scaleFactors.length;sf++){var scaleFactor=this.tiles[t].scaleFactors[sf];this.scale_factors.push(scaleFactor),options.tileSizePerScaleFactor[scaleFactor]={width:this.tiles[t].width,height:this.tiles[t].height||this.tiles[t].width}}}else if(function(profile){return!(-1!=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json"].indexOf(profile[0]))||-1!=profile.indexOf("sizeByW")}(options.profile)){for(var shortDim=Math.min(this.height,this.width),tileOptions=[256,512,1024],smallerTiles=[],c=0;c<tileOptions.length;c++)tileOptions[c]<=shortDim&&smallerTiles.push(tileOptions[c]);smallerTiles.length>0?options.tileSize=Math.max.apply(null,smallerTiles):options.tileSize=shortDim}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,options.levels=function(options){for(var levels=[],i=0;i<options.sizes.length;i++)levels.push({url:options["@id"]+"/full/"+options.sizes[i].width+",/0/default.jpg",width:options.sizes[i].width,height:options.sizes[i].height});return levels.sort(function(a,b){return a.width-b.width})}(this),$.extend(!0,options,{width:options.levels[options.levels.length-1].width,height:options.levels[options.levels.length-1].height,tileSize:Math.max(options.height,options.width),tileOverlap:0,minLevel:0,maxLevel:options.levels.length-1}),this.levels=options.levels):$.console.error("Nothing in the info.json to construct image pyramids from");options.maxLevel||this.emulateLegacyImagePyramid||(this.scale_factors?options.maxLevel=Math.floor(Math.pow(Math.max.apply(null,this.scale_factors),.5)):options.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)))),$.TileSource.apply(this,[options])},$.extend($.IIIFTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return!(!data.protocol||"http://iiif.io/api/image"!=data.protocol)||(!(!data["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!=data["@context"]&&"http://iiif.io/api/image/1/context.json"!=data["@context"])||(!(!data.profile||0!==data.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html"))||(!!(data.identifier&&data.width&&data.height)||!(!data.documentElement||"info"!=data.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!=data.documentElement.namespaceURI))))},configure:function(data,url){if($.isPlainObject(data))return data["@context"]?data:(data["@context"]="http://iiif.io/api/image/1.0/context.json",data["@id"]=url.replace("/info.json",""),data);var options=function(xmlDoc){if(!xmlDoc||!xmlDoc.documentElement)throw new Error($.getString("Errors.Xml"));var root=xmlDoc.documentElement,configuration=null;if("info"==root.tagName)try{return configuration={},parseXML10(root,configuration),configuration}catch(e){throw e instanceof Error?e:new Error($.getString("Errors.IIIF"))}throw new Error($.getString("Errors.IIIF"))}(data);return options["@context"]="http://iiif.io/api/image/1.0/context.json",options["@id"]=url.replace("/info.xml",""),options},getTileWidth:function(level){if(this.emulateLegacyImagePyramid)return $.TileSource.prototype.getTileWidth.call(this,level);var scaleFactor=Math.pow(2,this.maxLevel-level);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[scaleFactor]?this.tileSizePerScaleFactor[scaleFactor].width:this._tileWidth},getTileHeight:function(level){if(this.emulateLegacyImagePyramid)return $.TileSource.prototype.getTileHeight.call(this,level);var scaleFactor=Math.pow(2,this.maxLevel-level);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[scaleFactor]?this.tileSizePerScaleFactor[scaleFactor].height:this._tileHeight},getLevelScale:function(level){if(this.emulateLegacyImagePyramid){var levelScale=NaN;return this.levels.length>0&&level>=this.minLevel&&level<=this.maxLevel&&(levelScale=this.levels[level].width/this.levels[this.maxLevel].width),levelScale}return $.TileSource.prototype.getLevelScale.call(this,level)},getNumTiles:function(level){if(this.emulateLegacyImagePyramid){return this.getLevelScale(level)?new $.Point(1,1):new $.Point(0,0)}return $.TileSource.prototype.getNumTiles.call(this,level)},getTileAtPoint:function(level,point){return this.emulateLegacyImagePyramid?new $.Point(0,0):$.TileSource.prototype.getTileAtPoint.call(this,level,point)},getTileUrl:function(level,x,y){if(this.emulateLegacyImagePyramid){var url=null;return this.levels.length>0&&level>=this.minLevel&&level<=this.maxLevel&&(url=this.levels[level].url),url}var tileWidth,tileHeight,iiifTileSizeWidth,iiifTileSizeHeight,iiifRegion,iiifTileX,iiifTileY,iiifTileW,iiifTileH,iiifSize,iiifQuality,scale=Math.pow(.5,this.maxLevel-level),levelWidth=Math.ceil(this.width*scale),levelHeight=Math.ceil(this.height*scale);return tileWidth=this.getTileWidth(level),tileHeight=this.getTileHeight(level),iiifTileSizeWidth=Math.ceil(tileWidth/scale),iiifTileSizeHeight=Math.ceil(tileHeight/scale),iiifQuality=this["@context"].indexOf("/1.0/context.json")>-1||this["@context"].indexOf("/1.1/context.json")>-1||this["@context"].indexOf("/1/context.json")>-1?"native.jpg":"default.jpg",levelWidth<tileWidth&&levelHeight<tileHeight?(iiifSize=levelWidth+",",iiifRegion="full"):(iiifTileX=x*iiifTileSizeWidth,iiifTileY=y*iiifTileSizeHeight,iiifTileW=Math.min(iiifTileSizeWidth,this.width-iiifTileX),iiifTileH=Math.min(iiifTileSizeHeight,this.height-iiifTileY),iiifSize=Math.ceil(iiifTileW*scale)+",",iiifRegion=[iiifTileX,iiifTileY,iiifTileW,iiifTileH].join(",")),[this["@id"],iiifRegion,iiifSize,"0",iiifQuality].join("/")}})}(OpenSeadragon),function($){$.OsmTileSource=function(width,height,tileSize,tileOverlap,tilesUrl){var options;(options=$.isPlainObject(width)?width:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]}).width&&options.height||(options.width=65572864,options.height=65572864),options.tileSize||(options.tileSize=256,options.tileOverlap=0),options.tilesUrl||(options.tilesUrl="http://tile.openstreetmap.org/"),options.minLevel=8,$.TileSource.apply(this,[options])},$.extend($.OsmTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return data.type&&"openstreetmaps"==data.type},configure:function(data,url){return data},getTileUrl:function(level,x,y){return this.tilesUrl+(level-8)+"/"+x+"/"+y+".png"}})}(OpenSeadragon),function($){$.TmsTileSource=function(width,height,tileSize,tileOverlap,tilesUrl){var options;options=$.isPlainObject(width)?width:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var max,bufferedWidth=256*Math.ceil(options.width/256),bufferedHeight=256*Math.ceil(options.height/256);max=bufferedWidth>bufferedHeight?bufferedWidth/256:bufferedHeight/256,options.maxLevel=Math.ceil(Math.log(max)/Math.log(2))-1,options.tileSize=256,options.width=bufferedWidth,options.height=bufferedHeight,$.TileSource.apply(this,[options])},$.extend($.TmsTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return data.type&&"tiledmapservice"==data.type},configure:function(data,url){return data},getTileUrl:function(level,x,y){var yTiles=this.getNumTiles(level).y-1;return this.tilesUrl+level+"/"+x+"/"+(yTiles-y)+".png"}})}(OpenSeadragon),function($){$.ZoomifyTileSource=function(options){options.tileSize=256;var currentImageSize={x:options.width,y:options.height};for(options.imageSizes=[{x:options.width,y:options.height}],options.gridSize=[this._getGridSize(options.width,options.height,options.tileSize)];parseInt(currentImageSize.x,10)>options.tileSize||parseInt(currentImageSize.y,10)>options.tileSize;)currentImageSize.x=Math.floor(currentImageSize.x/2),currentImageSize.y=Math.floor(currentImageSize.y/2),options.imageSizes.push({x:currentImageSize.x,y:currentImageSize.y}),options.gridSize.push(this._getGridSize(currentImageSize.x,currentImageSize.y,options.tileSize));options.imageSizes.reverse(),options.gridSize.reverse(),options.minLevel=0,options.maxLevel=options.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[options])},$.extend($.ZoomifyTileSource.prototype,$.TileSource.prototype,{_getGridSize:function(width,height,tileSize){return{x:Math.ceil(width/tileSize),y:Math.ceil(height/tileSize)}},_calculateAbsoluteTileNumber:function(level,x,y){for(var num=0,size={},z=0;z<level;z++)num+=(size=this.gridSize[z]).x*size.y;return size=this.gridSize[level],num+=size.x*y+x},supports:function(data,url){return data.type&&"zoomifytileservice"==data.type},configure:function(data,url){return data},getTileUrl:function(level,x,y){var result=0,num=this._calculateAbsoluteTileNumber(level,x,y);return result=Math.floor(num/256),this.tilesUrl+"TileGroup"+result+"/"+level+"-"+x+"-"+y+".jpg"}})}(OpenSeadragon),function($){function configureFromObject(tileSource,configuration){return configuration.levels}$.LegacyTileSource=function(levels){var options,width,height;$.isArray(levels)&&(options={type:"legacy-image-pyramid",levels:levels}),options.levels=function(files){var file,i,filtered=[];for(i=0;i<files.length;i++)(file=files[i]).height&&file.width&&file.url?filtered.push({url:file.url,width:Number(file.width),height:Number(file.height)}):$.console.error("Unsupported image format: %s",file.url?file.url:"<no URL>");return filtered.sort(function(a,b){return a.height-b.height})}(options.levels),options.levels.length>0?(width=options.levels[options.levels.length-1].width,height=options.levels[options.levels.length-1].height):(width=0,height=0,$.console.error("No supported image formats found")),$.extend(!0,options,{width:width,height:height,tileSize:Math.max(height,width),tileOverlap:0,minLevel:0,maxLevel:options.levels.length>0?options.levels.length-1:0}),$.TileSource.apply(this,[options]),this.levels=options.levels},$.extend($.LegacyTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return data.type&&"legacy-image-pyramid"==data.type||data.documentElement&&"legacy-image-pyramid"==data.documentElement.getAttribute("type")},configure:function(configuration,dataUrl){return $.isPlainObject(configuration)?configureFromObject(0,configuration):function(tileSource,xmlDoc){if(!xmlDoc||!xmlDoc.documentElement)throw new Error($.getString("Errors.Xml"));var level,i,root=xmlDoc.documentElement,rootName=root.tagName,conf=null,levels=[];if("image"==rootName)try{for(conf={type:root.getAttribute("type"),levels:[]},levels=root.getElementsByTagName("level"),i=0;i<levels.length;i++)level=levels[i],conf.levels.push({url:level.getAttribute("url"),width:parseInt(level.getAttribute("width"),10),height:parseInt(level.getAttribute("height"),10)});return configureFromObject(0,conf)}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==rootName)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==rootName)throw new Error("Error: "+xmlDoc)}throw new Error("Unknown element "+rootName)}(0,configuration)},getLevelScale:function(level){var levelScale=NaN;return this.levels.length>0&&level>=this.minLevel&&level<=this.maxLevel&&(levelScale=this.levels[level].width/this.levels[this.maxLevel].width),levelScale},getNumTiles:function(level){return this.getLevelScale(level)?new $.Point(1,1):new $.Point(0,0)},getTileUrl:function(level,x,y){var url=null;return this.levels.length>0&&level>=this.minLevel&&level<=this.maxLevel&&(url=this.levels[level].url),url}})}(OpenSeadragon),function($){$.ImageTileSource=function(options){options=$.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},options),$.TileSource.apply(this,[options])},$.extend($.ImageTileSource.prototype,$.TileSource.prototype,{supports:function(data,url){return data.type&&"image"===data.type},configure:function(options,dataUrl){return options},getImageInfo:function(url){var image=this._image=new Image,_this=this;this.crossOriginPolicy&&(image.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(image.useCredentials=this.ajaxWithCredentials),$.addEvent(image,"load",function(){_this.width=Object.prototype.hasOwnProperty.call(image,"naturalWidth")?image.naturalWidth:image.width,_this.height=Object.prototype.hasOwnProperty.call(image,"naturalHeight")?image.naturalHeight:image.height,_this.aspectRatio=_this.width/_this.height,_this.dimensions=new $.Point(_this.width,_this.height),_this._tileWidth=_this.width,_this._tileHeight=_this.height,_this.tileOverlap=0,_this.minLevel=0,_this.levels=_this._buildLevels(),_this.maxLevel=_this.levels.length-1,_this.ready=!0,_this.raiseEvent("ready",{tileSource:_this})}),$.addEvent(image,"error",function(){_this.raiseEvent("open-failed",{message:"Error loading image at "+url,source:url})}),image.src=url},getLevelScale:function(level){var levelScale=NaN;return level>=this.minLevel&&level<=this.maxLevel&&(levelScale=this.levels[level].width/this.levels[this.maxLevel].width),levelScale},getNumTiles:function(level){return this.getLevelScale(level)?new $.Point(1,1):new $.Point(0,0)},getTileUrl:function(level,x,y){var url=null;return level>=this.minLevel&&level<=this.maxLevel&&(url=this.levels[level].url),url},getContext2D:function(level,x,y){var context=null;return level>=this.minLevel&&level<=this.maxLevel&&(context=this.levels[level].context2D),context},_buildLevels:function(){var levels=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!$.supportsCanvas||!this.useCanvas)return delete this._image,levels;var currentWidth=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,currentHeight=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,bigCanvas=document.createElement("canvas"),bigContext=bigCanvas.getContext("2d");if(bigCanvas.width=currentWidth,bigCanvas.height=currentHeight,bigContext.drawImage(this._image,0,0,currentWidth,currentHeight),levels[0].context2D=bigContext,delete this._image,$.isCanvasTainted(bigCanvas))return levels;for(;currentWidth>=2&&currentHeight>=2;){currentWidth=Math.floor(currentWidth/2),currentHeight=Math.floor(currentHeight/2);var smallCanvas=document.createElement("canvas"),smallContext=smallCanvas.getContext("2d");smallCanvas.width=currentWidth,smallCanvas.height=currentHeight,smallContext.drawImage(bigCanvas,0,0,currentWidth,currentHeight),levels.splice(0,0,{context2D:smallContext,width:currentWidth,height:currentHeight}),bigCanvas=smallCanvas,bigContext=smallContext}return levels}})}(OpenSeadragon),function($){$.TileSourceCollection=function(tileSize,tileSources,rows,layout){$.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function($){function scheduleFade(button){$.requestAnimationFrame(function(){!function(button){var currentTime,deltaTime,opacity;button.shouldFade&&(currentTime=$.now(),deltaTime=currentTime-button.fadeBeginTime,opacity=1-deltaTime/button.fadeLength,opacity=Math.min(1,opacity),opacity=Math.max(0,opacity),button.imgGroup&&$.setElementOpacity(button.imgGroup,opacity,!0),opacity>0&&scheduleFade(button))}(button)})}function inTo(button,newState){button.element.disabled||(newState>=$.ButtonState.GROUP&&button.currentState==$.ButtonState.REST&&(!function(button){button.shouldFade=!1,button.imgGroup&&$.setElementOpacity(button.imgGroup,1,!0)}(button),button.currentState=$.ButtonState.GROUP),newState>=$.ButtonState.HOVER&&button.currentState==$.ButtonState.GROUP&&(button.imgHover&&(button.imgHover.style.visibility=""),button.currentState=$.ButtonState.HOVER),newState>=$.ButtonState.DOWN&&button.currentState==$.ButtonState.HOVER&&(button.imgDown&&(button.imgDown.style.visibility=""),button.currentState=$.ButtonState.DOWN))}function outTo(button,newState){button.element.disabled||(newState<=$.ButtonState.HOVER&&button.currentState==$.ButtonState.DOWN&&(button.imgDown&&(button.imgDown.style.visibility="hidden"),button.currentState=$.ButtonState.HOVER),newState<=$.ButtonState.GROUP&&button.currentState==$.ButtonState.HOVER&&(button.imgHover&&(button.imgHover.style.visibility="hidden"),button.currentState=$.ButtonState.GROUP),newState<=$.ButtonState.REST&&button.currentState==$.ButtonState.GROUP&&(!function(button){button.shouldFade=!0,button.fadeBeginTime=$.now()+button.fadeDelay,window.setTimeout(function(){scheduleFade(button)},button.fadeDelay)}(button),button.currentState=$.ButtonState.REST))}$.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},$.Button=function(options){var _this=this;$.EventSource.call(this),$.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:$.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:$.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},options),this.element=options.element||$.makeNeutralElement("div"),options.element||(this.imgRest=$.makeTransparentImage(this.srcRest),this.imgGroup=$.makeTransparentImage(this.srcGroup),this.imgHover=$.makeTransparentImage(this.srcHover),this.imgDown=$.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",$.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",$.Browser.vendor==$.BROWSERS.FIREFOX&&$.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=$.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new $.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(event){event.insideElementPressed?(inTo(_this,$.ButtonState.DOWN),_this.raiseEvent("enter",{originalEvent:event.originalEvent})):event.buttonDownAny||inTo(_this,$.ButtonState.HOVER)},focusHandler:function(event){this.enterHandler(event),_this.raiseEvent("focus",{originalEvent:event.originalEvent})},exitHandler:function(event){outTo(_this,$.ButtonState.GROUP),event.insideElementPressed&&_this.raiseEvent("exit",{originalEvent:event.originalEvent})},blurHandler:function(event){this.exitHandler(event),_this.raiseEvent("blur",{originalEvent:event.originalEvent})},pressHandler:function(event){inTo(_this,$.ButtonState.DOWN),_this.raiseEvent("press",{originalEvent:event.originalEvent})},releaseHandler:function(event){event.insideElementPressed&&event.insideElementReleased?(outTo(_this,$.ButtonState.HOVER),_this.raiseEvent("release",{originalEvent:event.originalEvent})):event.insideElementPressed?outTo(_this,$.ButtonState.GROUP):inTo(_this,$.ButtonState.HOVER)},clickHandler:function(event){event.quick&&_this.raiseEvent("click",{originalEvent:event.originalEvent})},keyHandler:function(event){return 13!==event.keyCode||(_this.raiseEvent("click",{originalEvent:event.originalEvent}),_this.raiseEvent("release",{originalEvent:event.originalEvent}),!1)}}),outTo(this,$.ButtonState.REST)},$.extend($.Button.prototype,$.EventSource.prototype,{notifyGroupEnter:function(){inTo(this,$.ButtonState.GROUP)},notifyGroupExit:function(){outTo(this,$.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,$.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,$.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function($){$.ButtonGroup=function(options){$.extend(!0,this,{buttons:[],clickTimeThreshold:$.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:$.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},options);var i,buttons=this.buttons.concat([]),_this=this;if(this.element=options.element||$.makeNeutralElement("div"),!options.group)for(this.label=$.makeNeutralElement("label"),this.element.style.display="inline-block",this.element.appendChild(this.label),i=0;i<buttons.length;i++)this.element.appendChild(buttons[i].element);$.setElementTouchActionNone(this.element),this.tracker=new $.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(event){var i;for(i=0;i<_this.buttons.length;i++)_this.buttons[i].notifyGroupEnter()},exitHandler:function(event){var i;if(!event.insideElementPressed)for(i=0;i<_this.buttons.length;i++)_this.buttons[i].notifyGroupExit()}})},$.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function($){$.Rect=function(x,y,width,height,degrees){this.x="number"==typeof x?x:0,this.y="number"==typeof y?y:0,this.width="number"==typeof width?width:0,this.height="number"==typeof height?height:0,this.degrees="number"==typeof degrees?degrees:0,this.degrees=$.positiveModulo(this.degrees,360);var newTopLeft,newWidth;this.degrees>=270?(newTopLeft=this.getTopRight(),this.x=newTopLeft.x,this.y=newTopLeft.y,newWidth=this.height,this.height=this.width,this.width=newWidth,this.degrees-=270):this.degrees>=180?(newTopLeft=this.getBottomRight(),this.x=newTopLeft.x,this.y=newTopLeft.y,this.degrees-=180):this.degrees>=90&&(newTopLeft=this.getBottomLeft(),this.x=newTopLeft.x,this.y=newTopLeft.y,newWidth=this.height,this.height=this.width,this.width=newWidth,this.degrees-=90)},$.Rect.fromSummits=function(topLeft,topRight,bottomLeft){var width=topLeft.distanceTo(topRight),height=topLeft.distanceTo(bottomLeft),diff=topRight.minus(topLeft),radians=Math.atan(diff.y/diff.x);return diff.x<0?radians+=Math.PI:diff.y<0&&(radians+=2*Math.PI),new $.Rect(topLeft.x,topLeft.y,width,height,radians/Math.PI*180)},$.Rect.prototype={clone:function(){return new $.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new $.Point(this.x,this.y)},getBottomRight:function(){return new $.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new $.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new $.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new $.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new $.Point(this.width,this.height)},equals:function(other){return other instanceof $.Rect&&this.x===other.x&&this.y===other.y&&this.width===other.width&&this.height===other.height&&this.degrees===other.degrees},times:function(factor){return new $.Rect(this.x*factor,this.y*factor,this.width*factor,this.height*factor,this.degrees)},translate:function(delta){return new $.Rect(this.x+delta.x,this.y+delta.y,this.width,this.height,this.degrees)},union:function(rect){var thisBoundingBox=this.getBoundingBox(),otherBoundingBox=rect.getBoundingBox(),left=Math.min(thisBoundingBox.x,otherBoundingBox.x),top=Math.min(thisBoundingBox.y,otherBoundingBox.y),right=Math.max(thisBoundingBox.x+thisBoundingBox.width,otherBoundingBox.x+otherBoundingBox.width),bottom=Math.max(thisBoundingBox.y+thisBoundingBox.height,otherBoundingBox.y+otherBoundingBox.height);return new $.Rect(left,top,right-left,bottom-top)},intersection:function(rect){var EPSILON=1e-10,intersectionPoints=[],thisTopLeft=this.getTopLeft();rect.containsPoint(thisTopLeft,EPSILON)&&intersectionPoints.push(thisTopLeft);var thisTopRight=this.getTopRight();rect.containsPoint(thisTopRight,EPSILON)&&intersectionPoints.push(thisTopRight);var thisBottomLeft=this.getBottomLeft();rect.containsPoint(thisBottomLeft,EPSILON)&&intersectionPoints.push(thisBottomLeft);var thisBottomRight=this.getBottomRight();rect.containsPoint(thisBottomRight,EPSILON)&&intersectionPoints.push(thisBottomRight);var rectTopLeft=rect.getTopLeft();this.containsPoint(rectTopLeft,EPSILON)&&intersectionPoints.push(rectTopLeft);var rectTopRight=rect.getTopRight();this.containsPoint(rectTopRight,EPSILON)&&intersectionPoints.push(rectTopRight);var rectBottomLeft=rect.getBottomLeft();this.containsPoint(rectBottomLeft,EPSILON)&&intersectionPoints.push(rectBottomLeft);var rectBottomRight=rect.getBottomRight();this.containsPoint(rectBottomRight,EPSILON)&&intersectionPoints.push(rectBottomRight);for(var thisSegments=this._getSegments(),rectSegments=rect._getSegments(),i=0;i<thisSegments.length;i++)for(var thisSegment=thisSegments[i],j=0;j<rectSegments.length;j++){var rectSegment=rectSegments[j],intersect=function(a,b,c,d){var abVector=b.minus(a),cdVector=d.minus(c),denom=-cdVector.x*abVector.y+abVector.x*cdVector.y;if(0===denom)return null;var s=(abVector.x*(a.y-c.y)-abVector.y*(a.x-c.x))/denom,t=(cdVector.x*(a.y-c.y)-cdVector.y*(a.x-c.x))/denom;return-EPSILON<=s&&s<=1-EPSILON&&-EPSILON<=t&&t<=1-EPSILON?new $.Point(a.x+t*abVector.x,a.y+t*abVector.y):null}(thisSegment[0],thisSegment[1],rectSegment[0],rectSegment[1]);intersect&&intersectionPoints.push(intersect)}if(0===intersectionPoints.length)return null;for(var minX=intersectionPoints[0].x,maxX=intersectionPoints[0].x,minY=intersectionPoints[0].y,maxY=intersectionPoints[0].y,k=1;k<intersectionPoints.length;k++){var point=intersectionPoints[k];point.x<minX&&(minX=point.x),point.x>maxX&&(maxX=point.x),point.y<minY&&(minY=point.y),point.y>maxY&&(maxY=point.y)}return new $.Rect(minX,minY,maxX-minX,maxY-minY)},_getSegments:function(){var topLeft=this.getTopLeft(),topRight=this.getTopRight(),bottomLeft=this.getBottomLeft(),bottomRight=this.getBottomRight();return[[topLeft,topRight],[topRight,bottomRight],[bottomRight,bottomLeft],[bottomLeft,topLeft]]},rotate:function(degrees,pivot){if(0===(degrees=$.positiveModulo(degrees,360)))return this.clone();pivot=pivot||this.getCenter();var newTopLeft=this.getTopLeft().rotate(degrees,pivot),diff=this.getTopRight().rotate(degrees,pivot).minus(newTopLeft);diff=diff.apply(function(x){return Math.abs(x)<1e-15?0:x});var radians=Math.atan(diff.y/diff.x);return diff.x<0?radians+=Math.PI:diff.y<0&&(radians+=2*Math.PI),new $.Rect(newTopLeft.x,newTopLeft.y,this.width,this.height,radians/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var topLeft=this.getTopLeft(),topRight=this.getTopRight(),bottomLeft=this.getBottomLeft(),bottomRight=this.getBottomRight(),minX=Math.min(topLeft.x,topRight.x,bottomLeft.x,bottomRight.x),maxX=Math.max(topLeft.x,topRight.x,bottomLeft.x,bottomRight.x),minY=Math.min(topLeft.y,topRight.y,bottomLeft.y,bottomRight.y),maxY=Math.max(topLeft.y,topRight.y,bottomLeft.y,bottomRight.y);return new $.Rect(minX,minY,maxX-minX,maxY-minY)},getIntegerBoundingBox:function(){var boundingBox=this.getBoundingBox(),x=Math.floor(boundingBox.x),y=Math.floor(boundingBox.y),width=Math.ceil(boundingBox.width+boundingBox.x-x),height=Math.ceil(boundingBox.height+boundingBox.y-y);return new $.Rect(x,y,width,height)},containsPoint:function(point,epsilon){epsilon=epsilon||0;var topLeft=this.getTopLeft(),topRight=this.getTopRight(),bottomLeft=this.getBottomLeft(),topDiff=topRight.minus(topLeft),leftDiff=bottomLeft.minus(topLeft);return(point.x-topLeft.x)*topDiff.x+(point.y-topLeft.y)*topDiff.y>=-epsilon&&(point.x-topRight.x)*topDiff.x+(point.y-topRight.y)*topDiff.y<=epsilon&&(point.x-topLeft.x)*leftDiff.x+(point.y-topLeft.y)*leftDiff.y>=-epsilon&&(point.x-bottomLeft.x)*leftDiff.x+(point.y-bottomLeft.y)*leftDiff.y<=epsilon},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function($){function onStripDrag(event){var offsetLeft=Number(this.element.style.marginLeft.replace("px","")),offsetTop=Number(this.element.style.marginTop.replace("px","")),scrollWidth=Number(this.element.style.width.replace("px","")),scrollHeight=Number(this.element.style.height.replace("px","")),viewerSize=$.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-event.delta.x>0?offsetLeft>-(scrollWidth-viewerSize.x)&&(this.element.style.marginLeft=offsetLeft+2*event.delta.x+"px",loadPanels(this,viewerSize.x,offsetLeft+2*event.delta.x)):-event.delta.x<0&&offsetLeft<0&&(this.element.style.marginLeft=offsetLeft+2*event.delta.x+"px",loadPanels(this,viewerSize.x,offsetLeft+2*event.delta.x)):-event.delta.y>0?offsetTop>-(scrollHeight-viewerSize.y)&&(this.element.style.marginTop=offsetTop+2*event.delta.y+"px",loadPanels(this,viewerSize.y,offsetTop+2*event.delta.y)):-event.delta.y<0&&offsetTop<0&&(this.element.style.marginTop=offsetTop+2*event.delta.y+"px",loadPanels(this,viewerSize.y,offsetTop+2*event.delta.y))),!1}function onStripScroll(event){var offsetLeft=Number(this.element.style.marginLeft.replace("px","")),offsetTop=Number(this.element.style.marginTop.replace("px","")),scrollWidth=Number(this.element.style.width.replace("px","")),scrollHeight=Number(this.element.style.height.replace("px","")),viewerSize=$.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?event.scroll>0?offsetLeft>-(scrollWidth-viewerSize.x)&&(this.element.style.marginLeft=offsetLeft-60*event.scroll+"px",loadPanels(this,viewerSize.x,offsetLeft-60*event.scroll)):event.scroll<0&&offsetLeft<0&&(this.element.style.marginLeft=offsetLeft-60*event.scroll+"px",loadPanels(this,viewerSize.x,offsetLeft-60*event.scroll)):event.scroll<0?offsetTop>viewerSize.y-scrollHeight&&(this.element.style.marginTop=offsetTop+60*event.scroll+"px",loadPanels(this,viewerSize.y,offsetTop+60*event.scroll)):event.scroll>0&&offsetTop<0&&(this.element.style.marginTop=offsetTop+60*event.scroll+"px",loadPanels(this,viewerSize.y,offsetTop+60*event.scroll))),!1}function loadPanels(strip,viewerSize,scroll){var panelSize,activePanelsStart,activePanelsEnd,miniViewer,style,i,element;for(panelSize="horizontal"==strip.scroll?strip.panelWidth:strip.panelHeight,activePanelsStart=Math.ceil(viewerSize/panelSize)+5,i=activePanelsStart=(activePanelsStart=(activePanelsEnd=Math.ceil((Math.abs(scroll)+viewerSize)/panelSize)+1)-activePanelsStart)<0?0:activePanelsStart;i<activePanelsEnd&&i<strip.panels.length;i++)if(!(element=strip.panels[i]).activePanel){var miniTileSource,originalTileSource=strip.viewer.tileSources[i];miniTileSource=originalTileSource.referenceStripThumbnailUrl?{type:"image",url:originalTileSource.referenceStripThumbnailUrl}:originalTileSource,(miniViewer=new $.Viewer({id:element.id,tileSources:[miniTileSource],element:element,navigatorSizeRatio:strip.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0})).displayRegion=$.makeNeutralElement("div"),miniViewer.displayRegion.id=element.id+"-displayregion",miniViewer.displayRegion.className="displayregion",(style=miniViewer.displayRegion.style).position="relative",style.top="0px",style.left="0px",style.fontSize="0px",style.overflow="hidden",style.float="left",style.cssFloat="left",style.styleFloat="left",style.zIndex=999999999,style.cursor="default",style.width=strip.panelWidth-4+"px",style.height=strip.panelHeight-4+"px",miniViewer.displayRegion.innerTracker=new $.MouseTracker({element:miniViewer.displayRegion,startDisabled:!0}),element.getElementsByTagName("div")[0].appendChild(miniViewer.displayRegion),strip.miniViewers[element.id]=miniViewer,element.activePanel=!0}}function onStripEnter(event){var element=event.eventSource.element;return"horizontal"==this.scroll?element.style.marginBottom="0px":element.style.marginLeft="0px",!1}function onStripExit(event){var element=event.eventSource.element;return"horizontal"==this.scroll?element.style.marginBottom="-"+$.getElementSize(element).y/2+"px":element.style.marginLeft="-"+$.getElementSize(element).x/2+"px",!1}function onKeyDown(event){if(event.preventDefaultAction||event.ctrl||event.alt||event.meta)return!0;switch(event.keyCode){case 38:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function onKeyPress(event){if(event.preventDefaultAction||event.ctrl||event.alt||event.meta)return!0;switch(event.keyCode){case 61:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}var THIS={};$.ReferenceStrip=function(options){var element,style,i,viewer=options.viewer,viewerSize=$.getElementSize(viewer.element);for(options.id||(options.id="referencestrip-"+$.now(),this.element=$.makeNeutralElement("div"),this.element.id=options.id,this.element.className="referencestrip"),options=$.extend(!0,{sizeRatio:$.DEFAULT_SETTINGS.referenceStripSizeRatio,position:$.DEFAULT_SETTINGS.referenceStripPosition,scroll:$.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:$.DEFAULT_SETTINGS.clickTimeThreshold},options,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),$.extend(this,options),THIS[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(style=this.element.style).marginTop="0px",style.marginRight="0px",style.marginBottom="0px",style.marginLeft="0px",style.left="0px",style.bottom="0px",style.border="0px",style.background="#000",style.position="relative",$.setElementTouchActionNone(this.element),$.setElementOpacity(this.element,.8),this.viewer=viewer,this.innerTracker=new $.MouseTracker({element:this.element,dragHandler:$.delegate(this,onStripDrag),scrollHandler:$.delegate(this,onStripScroll),enterHandler:$.delegate(this,onStripEnter),exitHandler:$.delegate(this,onStripExit),keyDownHandler:$.delegate(this,onKeyDown),keyHandler:$.delegate(this,onKeyPress)}),options.width&&options.height?(this.element.style.width=options.width+"px",this.element.style.height=options.height+"px",viewer.addControl(this.element,{anchor:$.ControlAnchor.BOTTOM_LEFT})):"horizontal"==options.scroll?(this.element.style.width=viewerSize.x*options.sizeRatio*viewer.tileSources.length+12*viewer.tileSources.length+"px",this.element.style.height=viewerSize.y*options.sizeRatio+"px",viewer.addControl(this.element,{anchor:$.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=viewerSize.y*options.sizeRatio*viewer.tileSources.length+12*viewer.tileSources.length+"px",this.element.style.width=viewerSize.x*options.sizeRatio+"px",viewer.addControl(this.element,{anchor:$.ControlAnchor.TOP_LEFT})),this.panelWidth=viewerSize.x*this.sizeRatio+8,this.panelHeight=viewerSize.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},i=0;i<viewer.tileSources.length;i++)(element=$.makeNeutralElement("div")).id=this.element.id+"-"+i,element.style.width=this.panelWidth+"px",element.style.height=this.panelHeight+"px",element.style.display="inline",element.style.float="left",element.style.cssFloat="left",element.style.styleFloat="left",element.style.padding="2px",$.setElementTouchActionNone(element),element.innerTracker=new $.MouseTracker({element:element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(event){event.eventSource.dragging=$.now()},releaseHandler:function(event){var tracker=event.eventSource,id=tracker.element.id,page=Number(id.split("-")[2]),now=$.now();event.insideElementPressed&&event.insideElementReleased&&tracker.dragging&&now-tracker.dragging<tracker.clickTimeThreshold&&(tracker.dragging=null,viewer.goToPage(page))}}),this.element.appendChild(element),element.activePanel=!1,this.panels.push(element);loadPanels(this,"vertical"==this.scroll?viewerSize.y:viewerSize.x,0),this.setFocus(0)},$.extend($.ReferenceStrip.prototype,$.EventSource.prototype,$.Viewer.prototype,{setFocus:function(page){var offset,element=$.getElement(this.element.id+"-"+page),viewerSize=$.getElementSize(this.viewer.canvas),scrollWidth=Number(this.element.style.width.replace("px","")),scrollHeight=Number(this.element.style.height.replace("px","")),offsetLeft=-Number(this.element.style.marginLeft.replace("px","")),offsetTop=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==element&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=element,this.currentSelected.style.background="#999","horizontal"==this.scroll?(offset=Number(page)*(this.panelWidth+3))>offsetLeft+viewerSize.x-this.panelWidth?(offset=Math.min(offset,scrollWidth-viewerSize.x),this.element.style.marginLeft=-offset+"px",loadPanels(this,viewerSize.x,-offset)):offset<offsetLeft&&(offset=Math.max(0,offset-viewerSize.x/2),this.element.style.marginLeft=-offset+"px",loadPanels(this,viewerSize.x,-offset)):(offset=Number(page)*(this.panelHeight+3))>offsetTop+viewerSize.y-this.panelHeight?(offset=Math.min(offset,scrollHeight-viewerSize.y),this.element.style.marginTop=-offset+"px",loadPanels(this,viewerSize.y,-offset)):offset<offsetTop&&(offset=Math.max(0,offset-viewerSize.y/2),this.element.style.marginTop=-offset+"px",loadPanels(this,viewerSize.y,-offset)),this.currentPage=page,onStripEnter.call(this,{eventSource:this.innerTracker}))},update:function(){return!!THIS[this.id].animating&&($.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var key in this.miniViewers)this.miniViewers[key].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function($){$.DisplayRect=function(x,y,width,height,minLevel,maxLevel){$.Rect.apply(this,[x,y,width,height]),this.minLevel=minLevel,this.maxLevel=maxLevel},$.extend($.DisplayRect.prototype,$.Rect.prototype)}(OpenSeadragon),function($){$.Spring=function(options){var args=arguments;"object"!=typeof options&&(options={initial:args.length&&"number"==typeof args[0]?args[0]:void 0,springStiffness:args.length>1?args[1].springStiffness:5,animationTime:args.length>1?args[1].animationTime:1.5}),$.console.assert("number"==typeof options.springStiffness&&0!==options.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),$.console.assert("number"==typeof options.animationTime&&options.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),options.exponential&&(this._exponential=!0,delete options.exponential),$.extend(!0,this,options),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:$.now()},$.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},$.Spring.prototype={resetTo:function(target){$.console.assert(!this._exponential||0!==target,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=target,this.start.time=this.target.time=this.current.time=$.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(target){$.console.assert(!this._exponential||0!==target,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=target,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(delta){this.start.value+=delta,this.target.value+=delta,this._exponential&&($.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(value){this._exponential=value,this._exponential&&($.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=$.now();var startValue,targetValue;this._exponential?(startValue=this.start._logValue,targetValue=this.target._logValue):(startValue=this.start.value,targetValue=this.target.value);var currentValue=this.current.time>=this.target.time?targetValue:startValue+(targetValue-startValue)*function(stiffness,x){return(1-Math.exp(stiffness*-x))/(1-Math.exp(-stiffness))}(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),oldValue=this.current.value;return this._exponential?this.current.value=Math.exp(currentValue):this.current.value=currentValue,oldValue!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function($){function ImageJob(options){$.extend(!0,this,{timeout:$.DEFAULT_SETTINGS.timeout,jobId:null},options),this.image=null}ImageJob.prototype={errorMsg:null,start:function(){var self=this,selfAbort=this.abort;this.image=new Image,this.image.onload=function(){self.finish(!0)},this.image.onabort=this.image.onerror=function(){self.errorMsg="Image load aborted",self.finish(!1)},this.jobId=window.setTimeout(function(){self.errorMsg="Image load exceeded timeout",self.finish(!1)},this.timeout),this.loadWithAjax?(this.request=$.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(request){var blb;try{blb=new window.Blob([request.response])}catch(e){var BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===e.name&&BlobBuilder){var bb=new BlobBuilder;bb.append(request.response),blb=bb.getBlob()}}0===blb.size&&(self.errorMsg="Empty image response.",self.finish(!1));var url=(window.URL||window.webkitURL).createObjectURL(blb);self.image.src=url},error:function(request){self.errorMsg="Image load aborted - XHR error",self.finish(!1)}}),this.abort=function(){self.request.abort(),"function"==typeof selfAbort&&selfAbort()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(successful){this.image.onload=this.image.onerror=this.image.onabort=null,successful||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},$.ImageLoader=function(options){$.extend(!0,this,{jobLimit:$.DEFAULT_SETTINGS.imageLoaderLimit,timeout:$.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},options)},$.ImageLoader.prototype={addJob:function(options){var _this=this,newJob=new ImageJob({src:options.src,loadWithAjax:options.loadWithAjax,ajaxHeaders:options.loadWithAjax?options.ajaxHeaders:null,crossOriginPolicy:options.crossOriginPolicy,ajaxWithCredentials:options.ajaxWithCredentials,callback:function(job){!function(loader,job,callback){loader.jobsInProgress--,(!loader.jobLimit||loader.jobsInProgress<loader.jobLimit)&&loader.jobQueue.length>0&&(loader.jobQueue.shift().start(),loader.jobsInProgress++),callback(job.image,job.errorMsg,job.request)}(_this,job,options.callback)},abort:options.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(newJob.start(),this.jobsInProgress++):this.jobQueue.push(newJob)},clear:function(){for(var i=0;i<this.jobQueue.length;i++){var job=this.jobQueue[i];"function"==typeof job.abort&&job.abort()}this.jobQueue=[]}}}(OpenSeadragon),function($){$.Tile=function(level,x,y,bounds,exists,url,context2D,loadWithAjax,ajaxHeaders){this.level=level,this.x=x,this.y=y,this.bounds=bounds,this.exists=exists,this.url=url,this.context2D=context2D,this.loadWithAjax=loadWithAjax,this.ajaxHeaders=ajaxHeaders,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},$.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(container){this.cacheImageRecord?this.loaded?(this.element||(this.element=$.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=container&&container.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",$.setElementOpacity(this.element,this.opacity)):$.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):$.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(context,drawingHandler,scale,translate){var rendered,position=this.position.times($.pixelDensityRatio),size=this.size.times($.pixelDensityRatio);this.context2D||this.cacheImageRecord?(rendered=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&rendered?(context.save(),context.globalAlpha=this.opacity,"number"==typeof scale&&1!==scale&&(position=position.times(scale),size=size.times(scale)),translate instanceof $.Point&&(position=position.plus(translate)),1===context.globalAlpha&&this._hasTransparencyChannel()&&context.clearRect(position.x+1,position.y+1,size.x-2,size.y-2),drawingHandler({context:context,tile:this,rendered:rendered}),context.drawImage(rendered.canvas,0,0,rendered.canvas.width,rendered.canvas.height,position.x,position.y,size.x,size.y),context.restore()):$.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):$.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var context;if(this.cacheImageRecord)context=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return $.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;context=this.context2D}return context.canvas.width/(this.size.x*$.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(scale,canvasSize,sketchCanvasSize){var x=Math.max(1,Math.ceil((sketchCanvasSize.x-canvasSize.x)/2)),y=Math.max(1,Math.ceil((sketchCanvasSize.y-canvasSize.y)/2));return new $.Point(x,y).minus(this.position.times($.pixelDensityRatio).times(scale||1).apply(function(x){return x%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function($){$.OverlayPlacement=$.Placement,$.OverlayRotationMode=$.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),$.Overlay=function(element,location,placement){var options;options=$.isPlainObject(element)?element:{element:element,location:location,placement:placement},this.element=options.element,this.style=options.element.style,this._init(options)},$.Overlay.prototype={_init:function(options){this.location=options.location,this.placement=void 0===options.placement?$.Placement.TOP_LEFT:options.placement,this.onDraw=options.onDraw,this.checkResize=void 0===options.checkResize||options.checkResize,this.width=void 0===options.width?null:options.width,this.height=void 0===options.height?null:options.height,this.rotationMode=options.rotationMode||$.OverlayRotationMode.EXACT,this.location instanceof $.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=$.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new $.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(position,size){var properties=$.Placement.properties[this.placement];properties&&(properties.isHorizontallyCentered?position.x-=size.x/2:properties.isRight&&(position.x-=size.x),properties.isVerticallyCentered?position.y-=size.y/2:properties.isBottom&&(position.y-=size.y))},destroy:function(){var element=this.element,style=this.style;element.parentNode&&(element.parentNode.removeChild(element),element.prevElementParent&&(style.display="none",document.body.appendChild(element))),this.onDraw=null,style.top="",style.left="",style.position="",null!==this.width&&(style.width=""),null!==this.height&&(style.height="");var transformOriginProp=$.getCssPropertyWithVendorPrefix("transformOrigin"),transformProp=$.getCssPropertyWithVendorPrefix("transform");transformOriginProp&&transformProp&&(style[transformOriginProp]="",style[transformProp]="")},drawHTML:function(container,viewport){var element=this.element;element.parentNode!==container&&(element.prevElementParent=element.parentNode,element.prevNextSibling=element.nextSibling,container.appendChild(element),this.style.position="absolute",this.size=$.getElementSize(element));var positionAndSize=this._getOverlayPositionAndSize(viewport),position=positionAndSize.position,size=this.size=positionAndSize.size,rotate=positionAndSize.rotate;if(this.onDraw)this.onDraw(position,size,this.element);else{var style=this.style;style.left=position.x+"px",style.top=position.y+"px",null!==this.width&&(style.width=size.x+"px"),null!==this.height&&(style.height=size.y+"px");var transformOriginProp=$.getCssPropertyWithVendorPrefix("transformOrigin"),transformProp=$.getCssPropertyWithVendorPrefix("transform");transformOriginProp&&transformProp&&(rotate?(style[transformOriginProp]=this._getTransformOrigin(),style[transformProp]="rotate("+rotate+"deg)"):(style[transformOriginProp]="",style[transformProp]="")),"none"!==style.display&&(style.display="block")}},_getOverlayPositionAndSize:function(viewport){var position=viewport.pixelFromPoint(this.location,!0),size=this._getSizeInPixels(viewport);this.adjust(position,size);var rotate=0;if(viewport.degrees&&this.rotationMode!==$.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===$.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var rect=new $.Rect(position.x,position.y,size.x,size.y),boundingBox=this._getBoundingBox(rect,viewport.degrees);position=boundingBox.getTopLeft(),size=boundingBox.getSize()}else rotate=viewport.degrees;return{position:position,size:size,rotate:rotate}},_getSizeInPixels:function(viewport){var width=this.size.x,height=this.size.y;if(null!==this.width||null!==this.height){var scaledSize=viewport.deltaPixelsFromPointsNoRotate(new $.Point(this.width||0,this.height||0),!0);null!==this.width&&(width=scaledSize.x),null!==this.height&&(height=scaledSize.y)}if(this.checkResize&&(null===this.width||null===this.height)){var eltSize=this.size=$.getElementSize(this.element);null===this.width&&(width=eltSize.x),null===this.height&&(height=eltSize.y)}return new $.Point(width,height)},_getBoundingBox:function(rect,degrees){var refPoint=this._getPlacementPoint(rect);return rect.rotate(degrees,refPoint).getBoundingBox()},_getPlacementPoint:function(rect){var result=new $.Point(rect.x,rect.y),properties=$.Placement.properties[this.placement];return properties&&(properties.isHorizontallyCentered?result.x+=rect.width/2:properties.isRight&&(result.x+=rect.width),properties.isVerticallyCentered?result.y+=rect.height/2:properties.isBottom&&(result.y+=rect.height)),result},_getTransformOrigin:function(){var result="",properties=$.Placement.properties[this.placement];return properties?(properties.isLeft?result="left":properties.isRight&&(result="right"),properties.isTop?result+=" top":properties.isBottom&&(result+=" bottom"),result):result},update:function(location,placement){var options=$.isPlainObject(location)?location:{location:location,placement:placement};this._init({location:options.location||this.location,placement:void 0!==options.placement?options.placement:this.placement,onDraw:options.onDraw||this.onDraw,checkResize:options.checkResize||this.checkResize,width:void 0!==options.width?options.width:this.width,height:void 0!==options.height?options.height:this.height,rotationMode:options.rotationMode||this.rotationMode})},getBounds:function(viewport){$.console.assert(viewport,"A viewport must now be passed to Overlay.getBounds.");var width=this.width,height=this.height;if(null===width||null===height){var size=viewport.deltaPointsFromPixelsNoRotate(this.size,!0);null===width&&(width=size.x),null===height&&(height=size.y)}var location=this.location.clone();return this.adjust(location,new $.Point(width,height)),this._adjustBoundsForRotation(viewport,new $.Rect(location.x,location.y,width,height))},_adjustBoundsForRotation:function(viewport,bounds){if(!viewport||0===viewport.degrees||this.rotationMode===$.OverlayRotationMode.EXACT)return bounds;if(this.rotationMode===$.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return bounds;var positionAndSize=this._getOverlayPositionAndSize(viewport);return viewport.viewerElementToViewportRectangle(new $.Rect(positionAndSize.position.x,positionAndSize.position.y,positionAndSize.size.x,positionAndSize.size.y))}return bounds.rotate(-viewport.degrees,this._getPlacementPoint(bounds))}}}(OpenSeadragon),function($){$.Drawer=function(options){$.console.assert(options.viewer,"[Drawer] options.viewer is required");var args=arguments;if($.isPlainObject(options)||(options={source:args[0],viewport:args[1],element:args[2]}),$.console.assert(options.viewport,"[Drawer] options.viewport is required"),$.console.assert(options.element,"[Drawer] options.element is required"),options.source&&$.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=options.viewer,this.viewport=options.viewport,this.debugGridColor="string"==typeof options.debugGridColor?[options.debugGridColor]:options.debugGridColor||$.DEFAULT_SETTINGS.debugGridColor,options.opacity&&$.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=$.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=$.getElement(options.element),this.canvas=$.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var viewportSize=this._calculateCanvasSize();this.canvas.width=viewportSize.x,this.canvas.height=viewportSize.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",$.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas)},$.Drawer.prototype={addOverlay:function(element,location,placement,onDraw){return $.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(element,location,placement,onDraw),this},updateOverlay:function(element,location,placement){return $.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(element,location,placement),this},removeOverlay:function(element){return $.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(element),this},clearOverlays:function(){return $.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},setOpacity:function(opacity){$.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var world=this.viewer.world,i=0;i<world.getItemCount();i++)world.getItemAt(i).setOpacity(opacity);return this},getOpacity:function(){$.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var world=this.viewer.world,maxOpacity=0,i=0;i<world.getItemCount();i++){var opacity=world.getItemAt(i).getOpacity();opacity>maxOpacity&&(maxOpacity=opacity)}return maxOpacity},needsUpdate:function(){return $.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return $.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return $.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return $.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var viewportSize=this._calculateCanvasSize();if((this.canvas.width!=viewportSize.x||this.canvas.height!=viewportSize.y)&&(this.canvas.width=viewportSize.x,this.canvas.height=viewportSize.y,null!==this.sketchCanvas)){var sketchCanvasSize=this._calculateSketchCanvasSize();this.sketchCanvas.width=sketchCanvasSize.x,this.sketchCanvas.height=sketchCanvasSize.y}this._clear()}},_clear:function(useSketch,bounds){if(this.useCanvas){var context=this._getContext(useSketch);if(bounds)context.clearRect(bounds.x,bounds.y,bounds.width,bounds.height);else{var canvas=context.canvas;context.clearRect(0,0,canvas.width,canvas.height)}}},viewportToDrawerRectangle:function(rectangle){var topLeft=this.viewport.pixelFromPointNoRotate(rectangle.getTopLeft(),!0),size=this.viewport.deltaPixelsFromPointsNoRotate(rectangle.getSize(),!0);return new $.Rect(topLeft.x*$.pixelDensityRatio,topLeft.y*$.pixelDensityRatio,size.x*$.pixelDensityRatio,size.y*$.pixelDensityRatio)},drawTile:function(tile,drawingHandler,useSketch,scale,translate){if($.console.assert(tile,"[Drawer.drawTile] tile is required"),$.console.assert(drawingHandler,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var context=this._getContext(useSketch);scale=scale||1,tile.drawCanvas(context,drawingHandler,scale,translate)}else tile.drawHTML(this.canvas)},_getContext:function(useSketch){var context=this.context;if(useSketch){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var sketchCanvasSize=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=sketchCanvasSize.x,this.sketchCanvas.height=sketchCanvasSize.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var self=this;this.viewer.addHandler("rotate",function resizeSketchCanvas(){if(0!==self.viewport.getRotation()){self.viewer.removeHandler("rotate",resizeSketchCanvas);var sketchCanvasSize=self._calculateSketchCanvasSize();self.sketchCanvas.width=sketchCanvasSize.x,self.sketchCanvas.height=sketchCanvasSize.y}})}}context=this.sketchContext}return context},saveContext:function(useSketch){this.useCanvas&&this._getContext(useSketch).save()},restoreContext:function(useSketch){this.useCanvas&&this._getContext(useSketch).restore()},setClip:function(rect,useSketch){if(this.useCanvas){var context=this._getContext(useSketch);context.beginPath(),context.rect(rect.x,rect.y,rect.width,rect.height),context.clip()}},drawRectangle:function(rect,fillStyle,useSketch){if(this.useCanvas){var context=this._getContext(useSketch);context.save(),context.fillStyle=fillStyle,context.fillRect(rect.x,rect.y,rect.width,rect.height),context.restore()}},blendSketch:function(opacity,scale,translate,compositeOperation){var options=opacity;if($.isPlainObject(options)||(options={opacity:opacity,scale:scale,translate:translate,compositeOperation:compositeOperation}),this.useCanvas&&this.sketchCanvas){opacity=options.opacity,compositeOperation=options.compositeOperation;var bounds=options.bounds;if(this.context.save(),this.context.globalAlpha=opacity,compositeOperation&&(this.context.globalCompositeOperation=compositeOperation),bounds)bounds.x<0&&(bounds.width+=bounds.x,bounds.x=0),bounds.x+bounds.width>this.canvas.width&&(bounds.width=this.canvas.width-bounds.x),bounds.y<0&&(bounds.height+=bounds.y,bounds.y=0),bounds.y+bounds.height>this.canvas.height&&(bounds.height=this.canvas.height-bounds.y),this.context.drawImage(this.sketchCanvas,bounds.x,bounds.y,bounds.width,bounds.height,bounds.x,bounds.y,bounds.width,bounds.height);else{scale=options.scale||1;var position=(translate=options.translate)instanceof $.Point?translate:new $.Point(0,0),widthExt=0,heightExt=0;if(translate){var widthDiff=this.sketchCanvas.width-this.canvas.width,heightDiff=this.sketchCanvas.height-this.canvas.height;widthExt=Math.round(widthDiff/2),heightExt=Math.round(heightDiff/2)}this.context.drawImage(this.sketchCanvas,position.x-widthExt*scale,position.y-heightExt*scale,(this.canvas.width+2*widthExt)*scale,(this.canvas.height+2*heightExt)*scale,-widthExt,-heightExt,this.canvas.width+2*widthExt,this.canvas.height+2*heightExt)}this.context.restore()}},drawDebugInfo:function(tile,count,i,tiledImage){if(this.useCanvas){var colorIndex=this.viewer.world.getIndexOfItem(tiledImage)%this.debugGridColor.length,context=this.context;context.save(),context.lineWidth=2*$.pixelDensityRatio,context.font="small-caps bold "+13*$.pixelDensityRatio+"px arial",context.strokeStyle=this.debugGridColor[colorIndex],context.fillStyle=this.debugGridColor[colorIndex],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),tiledImage.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:tiledImage.getRotation(!0),point:tiledImage.viewport.pixelFromPointNoRotate(tiledImage._getRotationPoint(!0),!0)}),context.strokeRect(tile.position.x*$.pixelDensityRatio,tile.position.y*$.pixelDensityRatio,tile.size.x*$.pixelDensityRatio,tile.size.y*$.pixelDensityRatio);var tileCenterX=(tile.position.x+tile.size.x/2)*$.pixelDensityRatio,tileCenterY=(tile.position.y+tile.size.y/2)*$.pixelDensityRatio;context.translate(tileCenterX,tileCenterY),context.rotate(Math.PI/180*-this.viewport.degrees),context.translate(-tileCenterX,-tileCenterY),0===tile.x&&0===tile.y&&(context.fillText("Zoom: "+this.viewport.getZoom(),tile.position.x*$.pixelDensityRatio,(tile.position.y-30)*$.pixelDensityRatio),context.fillText("Pan: "+this.viewport.getBounds().toString(),tile.position.x*$.pixelDensityRatio,(tile.position.y-20)*$.pixelDensityRatio)),context.fillText("Level: "+tile.level,(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+20)*$.pixelDensityRatio),context.fillText("Column: "+tile.x,(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+30)*$.pixelDensityRatio),context.fillText("Row: "+tile.y,(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+40)*$.pixelDensityRatio),context.fillText("Order: "+i+" of "+count,(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+50)*$.pixelDensityRatio),context.fillText("Size: "+tile.size.toString(),(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+60)*$.pixelDensityRatio),context.fillText("Position: "+tile.position.toString(),(tile.position.x+10)*$.pixelDensityRatio,(tile.position.y+70)*$.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),tiledImage.getRotation(!0)%360!=0&&this._restoreRotationChanges(),context.restore()}},debugRect:function(rect){if(this.useCanvas){var context=this.context;context.save(),context.lineWidth=2*$.pixelDensityRatio,context.strokeStyle=this.debugGridColor[0],context.fillStyle=this.debugGridColor[0],context.strokeRect(rect.x*$.pixelDensityRatio,rect.y*$.pixelDensityRatio,rect.width*$.pixelDensityRatio,rect.height*$.pixelDensityRatio),context.restore()}},getCanvasSize:function(sketch){var canvas=this._getContext(sketch).canvas;return new $.Point(canvas.width,canvas.height)},getCanvasCenter:function(){return new $.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(options){var point=options.point?options.point.times($.pixelDensityRatio):this.getCanvasCenter(),context=this._getContext(options.useSketch);context.save(),context.translate(point.x,point.y),context.rotate(Math.PI/180*options.degrees),context.translate(-point.x,-point.y)},_restoreRotationChanges:function(useSketch){this._getContext(useSketch).restore()},_calculateCanvasSize:function(){var pixelDensityRatio=$.pixelDensityRatio,viewportSize=this.viewport.getContainerSize();return{x:viewportSize.x*pixelDensityRatio,y:viewportSize.y*pixelDensityRatio}},_calculateSketchCanvasSize:function(){var canvasSize=this._calculateCanvasSize();if(0===this.viewport.getRotation())return canvasSize;var sketchCanvasSize=Math.ceil(Math.sqrt(canvasSize.x*canvasSize.x+canvasSize.y*canvasSize.y));return{x:sketchCanvasSize,y:sketchCanvasSize}}}}(OpenSeadragon),function($){$.Viewport=function(options){var args=arguments;args.length&&args[0]instanceof $.Point&&(options={containerSize:args[0],contentSize:args[1],config:args[2]}),options.config&&($.extend(!0,options,options.config),delete options.config),this._margins=$.extend({left:0,top:0,right:0,bottom:0},options.margins||{}),delete options.margins,$.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:$.DEFAULT_SETTINGS.springStiffness,animationTime:$.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:$.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:$.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:$.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:$.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:$.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:$.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:$.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:$.DEFAULT_SETTINGS.maxZoomLevel,degrees:$.DEFAULT_SETTINGS.degrees,homeFillsViewer:$.DEFAULT_SETTINGS.homeFillsViewer},options),this._updateContainerInnerSize(),this.centerSpringX=new $.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new $.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new $.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new $.Rect(0,0,1,1),1),this.goHome(!0),this.update()},$.Viewport.prototype={resetContentSize:function(contentSize){return $.console.assert(contentSize,"[Viewport.resetContentSize] contentSize is required"),$.console.assert(contentSize instanceof $.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),$.console.assert(contentSize.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),$.console.assert(contentSize.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new $.Rect(0,0,1,contentSize.y/contentSize.x),contentSize.x),this},setHomeBounds:function(bounds,contentFactor){$.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(bounds,contentFactor)},_setContentBounds:function(bounds,contentFactor){$.console.assert(bounds,"[Viewport._setContentBounds] bounds is required"),$.console.assert(bounds instanceof $.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),$.console.assert(bounds.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),$.console.assert(bounds.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=bounds.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(contentFactor),this._contentBounds=bounds.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(contentFactor),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:contentFactor,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var aspectFactor=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?aspectFactor>=1?aspectFactor:1:aspectFactor>=1?1:aspectFactor)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var center=this._contentBounds.getCenter(),width=1/this.getHomeZoom(),height=width/this.getAspectRatio();return new $.Rect(center.x-width/2,center.y-height/2,width,height)},goHome:function(immediately){return this.viewer&&this.viewer.raiseEvent("home",{immediately:immediately}),this.fitBounds(this.getHomeBounds(),immediately)},getMinZoom:function(){var homeZoom=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*homeZoom},getMaxZoom:function(){var zoom=this.maxZoomLevel;return zoom||(zoom=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,zoom/=this._contentBounds.width),Math.max(zoom,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new $.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return $.extend({},this._margins)},setMargins:function(margins){$.console.assert("object"===$.type(margins),"[Viewport.setMargins] margins must be an object"),this._margins=$.extend({left:0,top:0,right:0,bottom:0},margins),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(current){return this.getBoundsNoRotate(current).rotate(-this.getRotation())},getBoundsNoRotate:function(current){var center=this.getCenter(current),width=1/this.getZoom(current),height=width/this.getAspectRatio();return new $.Rect(center.x-width/2,center.y-height/2,width,height)},getBoundsWithMargins:function(current){return this.getBoundsNoRotateWithMargins(current).rotate(-this.getRotation(),this.getCenter(current))},getBoundsNoRotateWithMargins:function(current){var bounds=this.getBoundsNoRotate(current),factor=this._containerInnerSize.x*this.getZoom(current);return bounds.x-=this._margins.left/factor,bounds.y-=this._margins.top/factor,bounds.width+=(this._margins.left+this._margins.right)/factor,bounds.height+=(this._margins.top+this._margins.bottom)/factor,bounds},getCenter:function(current){var oldZoomPixel,zoom,width,height,bounds,newZoomPixel,deltaZoomPixels,deltaZoomPoints,centerCurrent=new $.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),centerTarget=new $.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return current?centerCurrent:this.zoomPoint?(oldZoomPixel=this.pixelFromPoint(this.zoomPoint,!0),zoom=this.getZoom(),width=1/zoom,height=width/this.getAspectRatio(),bounds=new $.Rect(centerCurrent.x-width/2,centerCurrent.y-height/2,width,height),newZoomPixel=this._pixelFromPoint(this.zoomPoint,bounds),deltaZoomPixels=newZoomPixel.minus(oldZoomPixel),deltaZoomPoints=deltaZoomPixels.divide(this._containerInnerSize.x*zoom),centerTarget.plus(deltaZoomPoints)):centerTarget},getZoom:function(current){return current?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(zoom){return Math.max(Math.min(zoom,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(bounds){var newBounds=new $.Rect(bounds.x,bounds.y,bounds.width,bounds.height);if(this.wrapHorizontal);else{var horizontalThreshold=this.visibilityRatio*newBounds.width,boundsRight=newBounds.x+newBounds.width,contentRight=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,leftDx=this._contentBoundsNoRotate.x-boundsRight+horizontalThreshold,rightDx=contentRight-newBounds.x-horizontalThreshold;horizontalThreshold>this._contentBoundsNoRotate.width?newBounds.x+=(leftDx+rightDx)/2:rightDx<0?newBounds.x+=rightDx:leftDx>0&&(newBounds.x+=leftDx)}if(this.wrapVertical);else{var verticalThreshold=this.visibilityRatio*newBounds.height,boundsBottom=newBounds.y+newBounds.height,contentBottom=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,topDy=this._contentBoundsNoRotate.y-boundsBottom+verticalThreshold,bottomDy=contentBottom-newBounds.y-verticalThreshold;verticalThreshold>this._contentBoundsNoRotate.height?newBounds.y+=(topDy+bottomDy)/2:bottomDy<0?newBounds.y+=bottomDy:topDy>0&&(newBounds.y+=topDy)}return newBounds},_raiseConstraintsEvent:function(immediately){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:immediately})},applyConstraints:function(immediately){var actualZoom=this.getZoom(),constrainedZoom=this._applyZoomConstraints(actualZoom);actualZoom!==constrainedZoom&&this.zoomTo(constrainedZoom,this.zoomPoint,immediately);var bounds=this.getBoundsNoRotate(),constrainedBounds=this._applyBoundaryConstraints(bounds);return this._raiseConstraintsEvent(immediately),(bounds.x!==constrainedBounds.x||bounds.y!==constrainedBounds.y||immediately)&&this.fitBounds(constrainedBounds.rotate(-this.getRotation()),immediately),this},ensureVisible:function(immediately){return this.applyConstraints(immediately)},_fitBounds:function(bounds,options){var immediately=(options=options||{}).immediately||!1,constraints=options.constraints||!1,aspect=this.getAspectRatio(),center=bounds.getCenter(),newBounds=new $.Rect(bounds.x,bounds.y,bounds.width,bounds.height,bounds.degrees+this.getRotation()).getBoundingBox();newBounds.getAspectRatio()>=aspect?newBounds.height=newBounds.width/aspect:newBounds.width=newBounds.height*aspect,newBounds.x=center.x-newBounds.width/2,newBounds.y=center.y-newBounds.height/2;var newZoom=1/newBounds.width;if(constraints){var newBoundsAspectRatio=newBounds.getAspectRatio(),newConstrainedZoom=this._applyZoomConstraints(newZoom);newZoom!==newConstrainedZoom&&(newZoom=newConstrainedZoom,newBounds.width=1/newZoom,newBounds.x=center.x-newBounds.width/2,newBounds.height=newBounds.width/newBoundsAspectRatio,newBounds.y=center.y-newBounds.height/2),center=(newBounds=this._applyBoundaryConstraints(newBounds)).getCenter(),this._raiseConstraintsEvent(immediately)}if(immediately)return this.panTo(center,!0),this.zoomTo(newZoom,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var oldBounds=this.getBounds(),oldZoom=this.getZoom();if(0===oldZoom||Math.abs(newZoom/oldZoom-1)<1e-8)return this.zoomTo(newZoom,!0),this.panTo(center,immediately);var referencePoint=(newBounds=newBounds.rotate(-this.getRotation())).getTopLeft().times(newZoom).minus(oldBounds.getTopLeft().times(oldZoom)).divide(newZoom-oldZoom);return this.zoomTo(newZoom,referencePoint,immediately)},fitBounds:function(bounds,immediately){return this._fitBounds(bounds,{immediately:immediately,constraints:!1})},fitBoundsWithConstraints:function(bounds,immediately){return this._fitBounds(bounds,{immediately:immediately,constraints:!0})},fitVertically:function(immediately){var box=new $.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(box,immediately)},fitHorizontally:function(immediately){var box=new $.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(box,immediately)},getConstrainedBounds:function(current){var bounds;return bounds=this.getBounds(current),this._applyBoundaryConstraints(bounds)},panBy:function(delta,immediately){var center=new $.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(center.plus(delta),immediately)},panTo:function(center,immediately){return immediately?(this.centerSpringX.resetTo(center.x),this.centerSpringY.resetTo(center.y)):(this.centerSpringX.springTo(center.x),this.centerSpringY.springTo(center.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:center,immediately:immediately}),this},zoomBy:function(factor,refPoint,immediately){return this.zoomTo(this.zoomSpring.target.value*factor,refPoint,immediately)},zoomTo:function(zoom,refPoint,immediately){var _this=this;return this.zoomPoint=refPoint instanceof $.Point&&!isNaN(refPoint.x)&&!isNaN(refPoint.y)?refPoint:null,immediately?this._adjustCenterSpringsForZoomPoint(function(){_this.zoomSpring.resetTo(zoom)}):this.zoomSpring.springTo(zoom),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:zoom,refPoint:refPoint,immediately:immediately}),this},setRotation:function(degrees){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=$.positiveModulo(degrees,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:degrees}),this):this},getRotation:function(){return this.degrees},resize:function(newContainerSize,maintain){var widthDeltaFactor,oldBounds=this.getBoundsNoRotate(),newBounds=oldBounds;return this.containerSize.x=newContainerSize.x,this.containerSize.y=newContainerSize.y,this._updateContainerInnerSize(),maintain&&(widthDeltaFactor=newContainerSize.x/this.containerSize.x,newBounds.width=oldBounds.width*widthDeltaFactor,newBounds.height=newBounds.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:newContainerSize,maintain:maintain}),this.fitBounds(newBounds,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new $.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var _this=this;this._adjustCenterSpringsForZoomPoint(function(){_this.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var changed=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,changed},_adjustCenterSpringsForZoomPoint:function(zoomSpringHandler){if(this.zoomPoint){var oldZoomPixel=this.pixelFromPoint(this.zoomPoint,!0);zoomSpringHandler();var deltaZoomPixels=this.pixelFromPoint(this.zoomPoint,!0).minus(oldZoomPixel),deltaZoomPoints=this.deltaPointsFromPixels(deltaZoomPixels,!0);this.centerSpringX.shiftBy(deltaZoomPoints.x),this.centerSpringY.shiftBy(deltaZoomPoints.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else zoomSpringHandler()},deltaPixelsFromPointsNoRotate:function(deltaPoints,current){return deltaPoints.times(this._containerInnerSize.x*this.getZoom(current))},deltaPixelsFromPoints:function(deltaPoints,current){return this.deltaPixelsFromPointsNoRotate(deltaPoints.rotate(this.getRotation()),current)},deltaPointsFromPixelsNoRotate:function(deltaPixels,current){return deltaPixels.divide(this._containerInnerSize.x*this.getZoom(current))},deltaPointsFromPixels:function(deltaPixels,current){return this.deltaPointsFromPixelsNoRotate(deltaPixels,current).rotate(-this.getRotation())},pixelFromPointNoRotate:function(point,current){return this._pixelFromPointNoRotate(point,this.getBoundsNoRotate(current))},pixelFromPoint:function(point,current){return this._pixelFromPoint(point,this.getBoundsNoRotate(current))},_pixelFromPointNoRotate:function(point,bounds){return point.minus(bounds.getTopLeft()).times(this._containerInnerSize.x/bounds.width).plus(new $.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(point,bounds){return this._pixelFromPointNoRotate(point.rotate(this.getRotation(),this.getCenter(!0)),bounds)},pointFromPixelNoRotate:function(pixel,current){var bounds=this.getBoundsNoRotate(current);return pixel.minus(new $.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/bounds.width).plus(bounds.getTopLeft())},pointFromPixel:function(pixel,current){return this.pointFromPixelNoRotate(pixel,current).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(viewerX,viewerY){var scale=this._contentBoundsNoRotate.width;return new $.Point(viewerX*this._contentSizeNoRotate.x/scale,viewerY*this._contentSizeNoRotate.x/scale)},viewportToImageCoordinates:function(viewerX,viewerY){if(viewerX instanceof $.Point)return this.viewportToImageCoordinates(viewerX.x,viewerX.y);if(this.viewer){var count=this.viewer.world.getItemCount();if(count>1)$.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===count){return this.viewer.world.getItemAt(0).viewportToImageCoordinates(viewerX,viewerY,!0)}}return this._viewportToImageDelta(viewerX-this._contentBoundsNoRotate.x,viewerY-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(imageX,imageY){var scale=this._contentBoundsNoRotate.width;return new $.Point(imageX/this._contentSizeNoRotate.x*scale,imageY/this._contentSizeNoRotate.x*scale)},imageToViewportCoordinates:function(imageX,imageY){if(imageX instanceof $.Point)return this.imageToViewportCoordinates(imageX.x,imageX.y);if(this.viewer){var count=this.viewer.world.getItemCount();if(count>1)$.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===count){return this.viewer.world.getItemAt(0).imageToViewportCoordinates(imageX,imageY,!0)}}var point=this._imageToViewportDelta(imageX,imageY);return point.x+=this._contentBoundsNoRotate.x,point.y+=this._contentBoundsNoRotate.y,point},imageToViewportRectangle:function(imageX,imageY,pixelWidth,pixelHeight){var rect=imageX;if(rect instanceof $.Rect||(rect=new $.Rect(imageX,imageY,pixelWidth,pixelHeight)),this.viewer){var count=this.viewer.world.getItemCount();if(count>1)$.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===count){return this.viewer.world.getItemAt(0).imageToViewportRectangle(imageX,imageY,pixelWidth,pixelHeight,!0)}}var coordA=this.imageToViewportCoordinates(rect.x,rect.y),coordB=this._imageToViewportDelta(rect.width,rect.height);return new $.Rect(coordA.x,coordA.y,coordB.x,coordB.y,rect.degrees)},viewportToImageRectangle:function(viewerX,viewerY,pointWidth,pointHeight){var rect=viewerX;if(rect instanceof $.Rect||(rect=new $.Rect(viewerX,viewerY,pointWidth,pointHeight)),this.viewer){var count=this.viewer.world.getItemCount();if(count>1)$.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===count){return this.viewer.world.getItemAt(0).viewportToImageRectangle(viewerX,viewerY,pointWidth,pointHeight,!0)}}var coordA=this.viewportToImageCoordinates(rect.x,rect.y),coordB=this._viewportToImageDelta(rect.width,rect.height);return new $.Rect(coordA.x,coordA.y,coordB.x,coordB.y,rect.degrees)},viewerElementToImageCoordinates:function(pixel){var point=this.pointFromPixel(pixel,!0);return this.viewportToImageCoordinates(point)},imageToViewerElementCoordinates:function(pixel){var point=this.imageToViewportCoordinates(pixel);return this.pixelFromPoint(point,!0)},windowToImageCoordinates:function(pixel){$.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var viewerCoordinates=pixel.minus($.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(viewerCoordinates)},imageToWindowCoordinates:function(pixel){$.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");return this.imageToViewerElementCoordinates(pixel).plus($.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(pixel){return this.pointFromPixel(pixel,!0)},viewportToViewerElementCoordinates:function(point){return this.pixelFromPoint(point,!0)},viewerElementToViewportRectangle:function(rectangle){return $.Rect.fromSummits(this.pointFromPixel(rectangle.getTopLeft(),!0),this.pointFromPixel(rectangle.getTopRight(),!0),this.pointFromPixel(rectangle.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(rectangle){return $.Rect.fromSummits(this.pixelFromPoint(rectangle.getTopLeft(),!0),this.pixelFromPoint(rectangle.getTopRight(),!0),this.pixelFromPoint(rectangle.getBottomLeft(),!0))},windowToViewportCoordinates:function(pixel){$.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var viewerCoordinates=pixel.minus($.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(viewerCoordinates)},viewportToWindowCoordinates:function(point){$.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");return this.viewportToViewerElementCoordinates(point).plus($.getElementPosition(this.viewer.element))},viewportToImageZoom:function(viewportZoom){if(this.viewer){var count=this.viewer.world.getItemCount();if(count>1)$.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===count){return this.viewer.world.getItemAt(0).viewportToImageZoom(viewportZoom)}}var imageWidth=this._contentSizeNoRotate.x;return viewportZoom*(this._containerInnerSize.x/imageWidth*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(imageZoom){if(this.viewer){var count=this.viewer.world.getItemCount();if(count>1)$.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===count){return this.viewer.world.getItemAt(0).imageToViewportZoom(imageZoom)}}return imageZoom*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)}}}(OpenSeadragon),function($){function updateLevel(tiledImage,haveDrawn,drawLevel,level,levelOpacity,levelVisibility,drawArea,currentTime,best){var topLeftBound=drawArea.getBoundingBox().getTopLeft(),bottomRightBound=drawArea.getBoundingBox().getBottomRight();tiledImage.viewer&&tiledImage.viewer.raiseEvent("update-level",{tiledImage:tiledImage,havedrawn:haveDrawn,level:level,opacity:levelOpacity,visibility:levelVisibility,drawArea:drawArea,topleft:topLeftBound,bottomright:bottomRightBound,currenttime:currentTime,best:best}),resetCoverage(tiledImage.coverage,level),resetCoverage(tiledImage.loadingCoverage,level);for(var cornerTiles=tiledImage._getCornerTiles(level,topLeftBound,bottomRightBound),topLeftTile=cornerTiles.topLeft,bottomRightTile=cornerTiles.bottomRight,numberOfTiles=tiledImage.source.getNumTiles(level),viewportCenter=tiledImage.viewport.pixelFromPoint(tiledImage.viewport.getCenter()),x=topLeftTile.x;x<=bottomRightTile.x;x++)for(var y=topLeftTile.y;y<=bottomRightTile.y;y++){if(!tiledImage.wrapHorizontal&&!tiledImage.wrapVertical){var tileBounds=tiledImage.source.getTileBounds(level,x,y);if(null===drawArea.intersection(tileBounds))continue}best=function(tiledImage,haveDrawn,drawLevel,x,y,level,levelOpacity,levelVisibility,viewportCenter,numberOfTiles,currentTime,best){var tile=function(x,y,level,tiledImage,tileSource,tilesMatrix,time,numTiles,worldWidth,worldHeight){var xMod,yMod,bounds,exists,url,ajaxHeaders,context2D,tile;tilesMatrix[level]||(tilesMatrix[level]={});tilesMatrix[level][x]||(tilesMatrix[level][x]={});tilesMatrix[level][x][y]||(xMod=(numTiles.x+x%numTiles.x)%numTiles.x,yMod=(numTiles.y+y%numTiles.y)%numTiles.y,bounds=tileSource.getTileBounds(level,xMod,yMod),exists=tileSource.tileExists(level,xMod,yMod),url=tileSource.getTileUrl(level,xMod,yMod),tiledImage.loadTilesWithAjax?(ajaxHeaders=tileSource.getTileAjaxHeaders(level,xMod,yMod),$.isPlainObject(tiledImage.ajaxHeaders)&&(ajaxHeaders=$.extend({},tiledImage.ajaxHeaders,ajaxHeaders))):ajaxHeaders=null,context2D=tileSource.getContext2D?tileSource.getContext2D(level,xMod,yMod):void 0,bounds.x+=(x-xMod)/numTiles.x,bounds.y+=worldHeight/worldWidth*((y-yMod)/numTiles.y),tile=new $.Tile(level,x,y,bounds,exists,url,context2D,tiledImage.loadTilesWithAjax,ajaxHeaders),xMod===numTiles.x-1&&(tile.isRightMost=!0),yMod===numTiles.y-1&&(tile.isBottomMost=!0),tilesMatrix[level][x][y]=tile);return tile=tilesMatrix[level][x][y],tile.lastTouchTime=time,tile}(x,y,level,tiledImage,tiledImage.source,tiledImage.tilesMatrix,currentTime,numberOfTiles,tiledImage._worldWidthCurrent,tiledImage._worldHeightCurrent),drawTile=drawLevel;tiledImage.viewer&&tiledImage.viewer.raiseEvent("update-tile",{tiledImage:tiledImage,tile:tile});setCoverage(tiledImage.coverage,level,x,y,!1);var loadingCoverage=tile.loaded||tile.loading||isCovered(tiledImage.loadingCoverage,level,x,y);if(setCoverage(tiledImage.loadingCoverage,level,x,y,loadingCoverage),!tile.exists)return best;haveDrawn&&!drawTile&&(isCovered(tiledImage.coverage,level,x,y)?setCoverage(tiledImage.coverage,level,x,y,!0):drawTile=!0);if(!drawTile)return best;if(function(tile,overlap,viewport,viewportCenter,levelVisibility,tiledImage){var boundsTL=tile.bounds.getTopLeft();boundsTL.x*=tiledImage._scaleSpring.current.value,boundsTL.y*=tiledImage._scaleSpring.current.value,boundsTL.x+=tiledImage._xSpring.current.value,boundsTL.y+=tiledImage._ySpring.current.value;var boundsSize=tile.bounds.getSize();boundsSize.x*=tiledImage._scaleSpring.current.value,boundsSize.y*=tiledImage._scaleSpring.current.value;var positionC=viewport.pixelFromPointNoRotate(boundsTL,!0),positionT=viewport.pixelFromPointNoRotate(boundsTL,!1),sizeC=viewport.deltaPixelsFromPointsNoRotate(boundsSize,!0),sizeT=viewport.deltaPixelsFromPointsNoRotate(boundsSize,!1),tileCenter=positionT.plus(sizeT.divide(2)),tileSquaredDistance=viewportCenter.squaredDistanceTo(tileCenter);overlap||(sizeC=sizeC.plus(new $.Point(1,1))),tile.isRightMost&&tiledImage.wrapHorizontal&&(sizeC.x+=.75),tile.isBottomMost&&tiledImage.wrapVertical&&(sizeC.y+=.75),tile.position=positionC,tile.size=sizeC,tile.squaredDistance=tileSquaredDistance,tile.visibility=levelVisibility}(tile,tiledImage.source.tileOverlap,tiledImage.viewport,viewportCenter,levelVisibility,tiledImage),!tile.loaded)if(tile.context2D)setTileLoaded(tiledImage,tile);else{var imageRecord=tiledImage._tileCache.getImageRecord(tile.cacheKey);if(imageRecord){var image=imageRecord.getImage();setTileLoaded(tiledImage,tile,image)}}if(tile.loaded){(function(tiledImage,tile,x,y,level,levelOpacity,currentTime){var deltaTime,opacity,blendTimeMillis=1e3*tiledImage.blendTime;tile.blendStart||(tile.blendStart=currentTime);deltaTime=currentTime-tile.blendStart,opacity=blendTimeMillis?Math.min(1,deltaTime/blendTimeMillis):1,tiledImage.alwaysBlend&&(opacity*=levelOpacity);if(tile.opacity=opacity,tiledImage.lastDrawn.push(tile),1==opacity)setCoverage(tiledImage.coverage,level,x,y,!0),tiledImage._hasOpaqueTile=!0;else if(deltaTime<blendTimeMillis)return!0;return!1})(tiledImage,tile,x,y,level,levelOpacity,currentTime)&&(tiledImage._needsDraw=!0)}else tile.loading?tiledImage._tilesLoading++:loadingCoverage||(best=function(previousBest,tile){if(!previousBest)return tile;{if(tile.visibility>previousBest.visibility)return tile;if(tile.visibility==previousBest.visibility&&tile.squaredDistance<previousBest.squaredDistance)return tile}return previousBest}(best,tile));return best}(tiledImage,drawLevel,haveDrawn,x,y,level,levelOpacity,levelVisibility,viewportCenter,numberOfTiles,currentTime,best)}return best}function loadTile(tiledImage,tile,time){tile.loading=!0,tiledImage._imageLoader.addJob({src:tile.url,loadWithAjax:tile.loadWithAjax,ajaxHeaders:tile.ajaxHeaders,crossOriginPolicy:tiledImage.crossOriginPolicy,ajaxWithCredentials:tiledImage.ajaxWithCredentials,callback:function(image,errorMsg,tileRequest){!function(tiledImage,tile,time,image,errorMsg,tileRequest){if(!image)return $.console.log("Tile %s failed to load: %s - error: %s",tile,tile.url,errorMsg),tiledImage.viewer.raiseEvent("tile-load-failed",{tile:tile,tiledImage:tiledImage,time:time,message:errorMsg,tileRequest:tileRequest}),tile.loading=!1,void(tile.exists=!1);if(time<tiledImage.lastResetTime)return $.console.log("Ignoring tile %s loaded before reset: %s",tile,tile.url),void(tile.loading=!1);var finish=function(){var cutoff=tiledImage.source.getClosestLevel();setTileLoaded(tiledImage,tile,image,cutoff,tileRequest)};tiledImage._midDraw?window.setTimeout(finish,1):finish()}(tiledImage,tile,time,image,errorMsg,tileRequest)},abort:function(){tile.loading=!1}})}function setTileLoaded(tiledImage,tile,image,cutoff,tileRequest){function getCompletionCallback(){return increment++,completionCallback}function completionCallback(){0===--increment&&(tile.loading=!1,tile.loaded=!0,tile.context2D||tiledImage._tileCache.cacheTile({image:image,tile:tile,cutoff:cutoff,tiledImage:tiledImage}),tiledImage._needsDraw=!0)}var increment=0;tiledImage.viewer.raiseEvent("tile-loaded",{tile:tile,tiledImage:tiledImage,tileRequest:tileRequest,image:image,getCompletionCallback:getCompletionCallback}),getCompletionCallback()()}function providesCoverage(coverage,level,x,y){var rows,cols,i,j;if(!coverage[level])return!1;if(void 0===x||void 0===y){rows=coverage[level];for(i in rows)if(rows.hasOwnProperty(i)){cols=rows[i];for(j in cols)if(cols.hasOwnProperty(j)&&!cols[j])return!1}return!0}return void 0===coverage[level][x]||void 0===coverage[level][x][y]||!0===coverage[level][x][y]}function isCovered(coverage,level,x,y){return void 0===x||void 0===y?providesCoverage(coverage,level+1):providesCoverage(coverage,level+1,2*x,2*y)&&providesCoverage(coverage,level+1,2*x,2*y+1)&&providesCoverage(coverage,level+1,2*x+1,2*y)&&providesCoverage(coverage,level+1,2*x+1,2*y+1)}function setCoverage(coverage,level,x,y,covers){coverage[level]?(coverage[level][x]||(coverage[level][x]={}),coverage[level][x][y]=covers):$.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",level)}function resetCoverage(coverage,level){coverage[level]={}}function drawTiles(tiledImage,lastDrawn){if(0!==tiledImage.opacity&&(0!==lastDrawn.length||tiledImage.placeholderFillStyle)){var useSketch,tile=lastDrawn[0];tile&&(useSketch=tiledImage.opacity<1||tiledImage.compositeOperation&&"source-over"!==tiledImage.compositeOperation||!tiledImage._isBottomItem()&&tile._hasTransparencyChannel());var sketchScale,sketchTranslate,zoom=tiledImage.viewport.getZoom(!0),imageZoom=tiledImage.viewportToImageZoom(zoom);lastDrawn.length>1&&imageZoom>tiledImage.smoothTileEdgesMinZoom&&!tiledImage.iOSDevice&&tiledImage.getRotation(!0)%360==0&&$.supportsCanvas&&(useSketch=!0,sketchScale=tile.getScaleForEdgeSmoothing(),sketchTranslate=tile.getTranslationForEdgeSmoothing(sketchScale,tiledImage._drawer.getCanvasSize(!1),tiledImage._drawer.getCanvasSize(!0)));var bounds;useSketch&&(sketchScale||(bounds=tiledImage.viewport.viewportToViewerElementRectangle(tiledImage.getClippedBounds(!0)).getIntegerBoundingBox().times($.pixelDensityRatio)),tiledImage._drawer._clear(!0,bounds)),sketchScale||(0!==tiledImage.viewport.degrees&&tiledImage._drawer._offsetForRotation({degrees:tiledImage.viewport.degrees,useSketch:useSketch}),tiledImage.getRotation(!0)%360!=0&&tiledImage._drawer._offsetForRotation({degrees:tiledImage.getRotation(!0),point:tiledImage.viewport.pixelFromPointNoRotate(tiledImage._getRotationPoint(!0),!0),useSketch:useSketch}));var usedClip=!1;if(tiledImage._clip){tiledImage._drawer.saveContext(useSketch);var box=tiledImage.imageToViewportRectangle(tiledImage._clip,!0);box=box.rotate(-tiledImage.getRotation(!0),tiledImage._getRotationPoint(!0));var clipRect=tiledImage._drawer.viewportToDrawerRectangle(box);sketchScale&&(clipRect=clipRect.times(sketchScale)),sketchTranslate&&(clipRect=clipRect.translate(sketchTranslate)),tiledImage._drawer.setClip(clipRect,useSketch),usedClip=!0}if(tiledImage.placeholderFillStyle&&!1===tiledImage._hasOpaqueTile){var placeholderRect=tiledImage._drawer.viewportToDrawerRectangle(tiledImage.getBounds(!0));sketchScale&&(placeholderRect=placeholderRect.times(sketchScale)),sketchTranslate&&(placeholderRect=placeholderRect.translate(sketchTranslate));var fillStyle=null;fillStyle="function"==typeof tiledImage.placeholderFillStyle?tiledImage.placeholderFillStyle(tiledImage,tiledImage._drawer.context):tiledImage.placeholderFillStyle,tiledImage._drawer.drawRectangle(placeholderRect,fillStyle,useSketch)}for(var i=lastDrawn.length-1;i>=0;i--)tile=lastDrawn[i],tiledImage._drawer.drawTile(tile,tiledImage._drawingHandler,useSketch,sketchScale,sketchTranslate),tile.beingDrawn=!0,tiledImage.viewer&&tiledImage.viewer.raiseEvent("tile-drawn",{tiledImage:tiledImage,tile:tile});usedClip&&tiledImage._drawer.restoreContext(useSketch),sketchScale||(tiledImage.getRotation(!0)%360!=0&&tiledImage._drawer._restoreRotationChanges(useSketch),0!==tiledImage.viewport.degrees&&tiledImage._drawer._restoreRotationChanges(useSketch)),useSketch&&(sketchScale&&(0!==tiledImage.viewport.degrees&&tiledImage._drawer._offsetForRotation({degrees:tiledImage.viewport.degrees,useSketch:!1}),tiledImage.getRotation(!0)%360!=0&&tiledImage._drawer._offsetForRotation({degrees:tiledImage.getRotation(!0),point:tiledImage.viewport.pixelFromPointNoRotate(tiledImage._getRotationPoint(!0),!0),useSketch:!1})),tiledImage._drawer.blendSketch({opacity:tiledImage.opacity,scale:sketchScale,translate:sketchTranslate,compositeOperation:tiledImage.compositeOperation,bounds:bounds}),sketchScale&&(tiledImage.getRotation(!0)%360!=0&&tiledImage._drawer._restoreRotationChanges(!1),0!==tiledImage.viewport.degrees&&tiledImage._drawer._restoreRotationChanges(!1))),function(tiledImage,lastDrawn){if(tiledImage.debugMode)for(var i=lastDrawn.length-1;i>=0;i--){var tile=lastDrawn[i];try{tiledImage._drawer.drawDebugInfo(tile,lastDrawn.length,i,tiledImage)}catch(e){$.console.error(e)}}}(tiledImage,lastDrawn)}}$.TiledImage=function(options){var _this=this;$.console.assert(options.tileCache,"[TiledImage] options.tileCache is required"),$.console.assert(options.drawer,"[TiledImage] options.drawer is required"),$.console.assert(options.viewer,"[TiledImage] options.viewer is required"),$.console.assert(options.imageLoader,"[TiledImage] options.imageLoader is required"),$.console.assert(options.source,"[TiledImage] options.source is required"),$.console.assert(!options.clip||options.clip instanceof $.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),$.EventSource.call(this),this._tileCache=options.tileCache,delete options.tileCache,this._drawer=options.drawer,delete options.drawer,this._imageLoader=options.imageLoader,delete options.imageLoader,options.clip instanceof $.Rect&&(this._clip=options.clip.clone()),delete options.clip;var x=options.x||0;delete options.x;var y=options.y||0;delete options.y,this.normHeight=options.source.dimensions.y/options.source.dimensions.x,this.contentAspectX=options.source.dimensions.x/options.source.dimensions.y;var scale=1;options.width?(scale=options.width,delete options.width,options.height&&($.console.error("specifying both width and height to a tiledImage is not supported"),delete options.height)):options.height&&(scale=options.height/this.normHeight,delete options.height);var fitBounds=options.fitBounds;delete options.fitBounds;var fitBoundsPlacement=options.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete options.fitBoundsPlacement;var degrees=options.degrees||0;delete options.degrees,$.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:$.DEFAULT_SETTINGS.springStiffness,animationTime:$.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:$.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:$.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:$.DEFAULT_SETTINGS.wrapVertical,immediateRender:$.DEFAULT_SETTINGS.immediateRender,blendTime:$.DEFAULT_SETTINGS.blendTime,alwaysBlend:$.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:$.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:$.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:$.DEFAULT_SETTINGS.iOSDevice,debugMode:$.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:$.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:$.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:$.DEFAULT_SETTINGS.placeholderFillStyle,opacity:$.DEFAULT_SETTINGS.opacity,preload:$.DEFAULT_SETTINGS.preload,compositeOperation:$.DEFAULT_SETTINGS.compositeOperation},options),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new $.Spring({initial:x,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new $.Spring({initial:y,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new $.Spring({initial:scale,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new $.Spring({initial:degrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),fitBounds&&this.fitBounds(fitBounds,fitBoundsPlacement,!0),this._drawingHandler=function(args){_this.viewer.raiseEvent("tile-drawing",$.extend({tiledImage:_this},args))}},$.extend($.TiledImage.prototype,$.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(flag){flag!==this._fullyLoaded&&(this._fullyLoaded=flag,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=$.now(),this._needsDraw=!0},update:function(){var xUpdated=this._xSpring.update(),yUpdated=this._ySpring.update(),scaleUpdated=this._scaleSpring.update(),degreesUpdated=this._degreesSpring.update();return!!(xUpdated||yUpdated||scaleUpdated||degreesUpdated)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){(0!==this.opacity||this._preload)&&(this._midDraw=!0,this._updateViewport(),this._midDraw=!1)},destroy:function(){this.reset()},getBounds:function(current){return this.getBoundsNoRotate(current).rotate(this.getRotation(current),this._getRotationPoint(current))},getBoundsNoRotate:function(current){return current?new $.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new $.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return $.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(current){var bounds=this.getBoundsNoRotate(current);if(this._clip){var ratio=(current?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,clip=this._clip.times(ratio);bounds=new $.Rect(bounds.x+clip.x,bounds.y+clip.y,clip.width,clip.height)}return bounds.rotate(this.getRotation(current),this._getRotationPoint(current))},getContentSize:function(){return new $.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(viewerX,viewerY,current){var scale=current?this._scaleSpring.current.value:this._scaleSpring.target.value;return new $.Point(viewerX*(this.source.dimensions.x/scale),viewerY*(this.source.dimensions.y*this.contentAspectX/scale))},viewportToImageCoordinates:function(viewerX,viewerY,current){var point;return viewerX instanceof $.Point?(current=viewerY,point=viewerX):point=new $.Point(viewerX,viewerY),point=point.rotate(-this.getRotation(current),this._getRotationPoint(current)),current?this._viewportToImageDelta(point.x-this._xSpring.current.value,point.y-this._ySpring.current.value):this._viewportToImageDelta(point.x-this._xSpring.target.value,point.y-this._ySpring.target.value)},_imageToViewportDelta:function(imageX,imageY,current){var scale=current?this._scaleSpring.current.value:this._scaleSpring.target.value;return new $.Point(imageX/this.source.dimensions.x*scale,imageY/this.source.dimensions.y/this.contentAspectX*scale)},imageToViewportCoordinates:function(imageX,imageY,current){imageX instanceof $.Point&&(current=imageY,imageY=imageX.y,imageX=imageX.x);var point=this._imageToViewportDelta(imageX,imageY);return current?(point.x+=this._xSpring.current.value,point.y+=this._ySpring.current.value):(point.x+=this._xSpring.target.value,point.y+=this._ySpring.target.value),point.rotate(this.getRotation(current),this._getRotationPoint(current))},imageToViewportRectangle:function(imageX,imageY,pixelWidth,pixelHeight,current){var rect=imageX;rect instanceof $.Rect?current=imageY:rect=new $.Rect(imageX,imageY,pixelWidth,pixelHeight);var coordA=this.imageToViewportCoordinates(rect.getTopLeft(),current),coordB=this._imageToViewportDelta(rect.width,rect.height,current);return new $.Rect(coordA.x,coordA.y,coordB.x,coordB.y,rect.degrees+this.getRotation(current))},viewportToImageRectangle:function(viewerX,viewerY,pointWidth,pointHeight,current){var rect=viewerX;viewerX instanceof $.Rect?current=viewerY:rect=new $.Rect(viewerX,viewerY,pointWidth,pointHeight);var coordA=this.viewportToImageCoordinates(rect.getTopLeft(),current),coordB=this._viewportToImageDelta(rect.width,rect.height,current);return new $.Rect(coordA.x,coordA.y,coordB.x,coordB.y,rect.degrees-this.getRotation(current))},viewerElementToImageCoordinates:function(pixel){var point=this.viewport.pointFromPixel(pixel,!0);return this.viewportToImageCoordinates(point)},imageToViewerElementCoordinates:function(pixel){var point=this.imageToViewportCoordinates(pixel);return this.viewport.pixelFromPoint(point,!0)},windowToImageCoordinates:function(pixel){var viewerCoordinates=pixel.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(viewerCoordinates)},imageToWindowCoordinates:function(pixel){return this.imageToViewerElementCoordinates(pixel).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(rect){var scale=this._scaleSpring.current.value;return rect=rect.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new $.Rect((rect.x-this._xSpring.current.value)/scale,(rect.y-this._ySpring.current.value)/scale,rect.width/scale,rect.height/scale,rect.degrees)},viewportToImageZoom:function(viewportZoom){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*viewportZoom},imageToViewportZoom:function(imageZoom){return imageZoom/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(position,immediately){var sameTarget=this._xSpring.target.value===position.x&&this._ySpring.target.value===position.y;if(immediately){if(sameTarget&&this._xSpring.current.value===position.x&&this._ySpring.current.value===position.y)return;this._xSpring.resetTo(position.x),this._ySpring.resetTo(position.y),this._needsDraw=!0}else{if(sameTarget)return;this._xSpring.springTo(position.x),this._ySpring.springTo(position.y),this._needsDraw=!0}sameTarget||this._raiseBoundsChange()},setWidth:function(width,immediately){this._setScale(width,immediately)},setHeight:function(height,immediately){this._setScale(height/this.normHeight,immediately)},fitBounds:function(bounds,anchor,immediately){anchor=anchor||$.Placement.CENTER;var anchorProperties=$.Placement.properties[anchor],aspectRatio=this.contentAspectX,xOffset=0,yOffset=0,displayedWidthRatio=1,displayedHeightRatio=1;if(this._clip&&(aspectRatio=this._clip.getAspectRatio(),displayedWidthRatio=this._clip.width/this.source.dimensions.x,displayedHeightRatio=this._clip.height/this.source.dimensions.y,bounds.getAspectRatio()>aspectRatio?(xOffset=this._clip.x/this._clip.height*bounds.height,yOffset=this._clip.y/this._clip.height*bounds.height):(xOffset=this._clip.x/this._clip.width*bounds.width,yOffset=this._clip.y/this._clip.width*bounds.width)),bounds.getAspectRatio()>aspectRatio){var height=bounds.height/displayedHeightRatio,marginLeft=0;anchorProperties.isHorizontallyCentered?marginLeft=(bounds.width-bounds.height*aspectRatio)/2:anchorProperties.isRight&&(marginLeft=bounds.width-bounds.height*aspectRatio),this.setPosition(new $.Point(bounds.x-xOffset+marginLeft,bounds.y-yOffset),immediately),this.setHeight(height,immediately)}else{var width=bounds.width/displayedWidthRatio,marginTop=0;anchorProperties.isVerticallyCentered?marginTop=(bounds.height-bounds.width/aspectRatio)/2:anchorProperties.isBottom&&(marginTop=bounds.height-bounds.width/aspectRatio),this.setPosition(new $.Point(bounds.x-xOffset,bounds.y-yOffset+marginTop),immediately),this.setWidth(width,immediately)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(newClip){$.console.assert(!newClip||newClip instanceof $.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),newClip instanceof $.Rect?this._clip=newClip.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(opacity){opacity!==this.opacity&&(this.opacity=opacity,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(preload){this._preload=!!preload,this._needsDraw=!0},getRotation:function(current){return current?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(degrees,immediately){this._degreesSpring.target.value===degrees&&this._degreesSpring.isAtTargetValue()||(immediately?this._degreesSpring.resetTo(degrees):this._degreesSpring.springTo(degrees),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(current){return this.getBoundsNoRotate(current).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(compositeOperation){compositeOperation!==this.compositeOperation&&(this.compositeOperation=compositeOperation,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(scale,immediately){var sameTarget=this._scaleSpring.target.value===scale;if(immediately){if(sameTarget&&this._scaleSpring.current.value===scale)return;this._scaleSpring.resetTo(scale),this._updateForScale(),this._needsDraw=!0}else{if(sameTarget)return;this._scaleSpring.springTo(scale),this._updateForScale(),this._needsDraw=!0}sameTarget||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var lowestLevel=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),currentZeroRatio=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,highestLevel=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(currentZeroRatio/this.minPixelRatio)/Math.log(2))));return lowestLevel=Math.min(lowestLevel,highestLevel),{lowestLevel:lowestLevel,highestLevel:highestLevel}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){this.lastDrawn.pop().beingDrawn=!1}var viewport=this.viewport,drawArea=this._viewportToTiledImageRectangle(viewport.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var tiledImageBounds=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(drawArea=drawArea.intersection(tiledImageBounds)))return}for(var levelsInterval=this._getLevelsInterval(),lowestLevel=levelsInterval.lowestLevel,highestLevel=levelsInterval.highestLevel,bestTile=null,haveDrawn=!1,currentTime=$.now(),level=highestLevel;level>=lowestLevel;level--){var drawLevel=!1,currentRenderPixelRatio=viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(level),!0).x*this._scaleSpring.current.value;if(level===lowestLevel||!haveDrawn&&currentRenderPixelRatio>=this.minPixelRatio)drawLevel=!0,haveDrawn=!0;else if(!haveDrawn)continue;var targetRenderPixelRatio=viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(level),!1).x*this._scaleSpring.current.value,targetZeroRatio=viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,optimalRatio=this.immediateRender?1:targetZeroRatio;if(bestTile=updateLevel(this,haveDrawn,drawLevel,level,Math.min(1,(currentRenderPixelRatio-.5)/.5),optimalRatio/Math.abs(optimalRatio-targetRenderPixelRatio),drawArea,currentTime,bestTile),providesCoverage(this.coverage,level))break}drawTiles(this,this.lastDrawn),bestTile&&!bestTile.context2D?(loadTile(this,bestTile,currentTime),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(level,topLeftBound,bottomRightBound){var leftX,rightX;this.wrapHorizontal?(leftX=$.positiveModulo(topLeftBound.x,1),rightX=$.positiveModulo(bottomRightBound.x,1)):(leftX=Math.max(0,topLeftBound.x),rightX=Math.min(1,bottomRightBound.x));var topY,bottomY,aspectRatio=1/this.source.aspectRatio;this.wrapVertical?(topY=$.positiveModulo(topLeftBound.y,aspectRatio),bottomY=$.positiveModulo(bottomRightBound.y,aspectRatio)):(topY=Math.max(0,topLeftBound.y),bottomY=Math.min(aspectRatio,bottomRightBound.y));var topLeftTile=this.source.getTileAtPoint(level,new $.Point(leftX,topY)),bottomRightTile=this.source.getTileAtPoint(level,new $.Point(rightX,bottomY)),numTiles=this.source.getNumTiles(level);return this.wrapHorizontal&&(topLeftTile.x+=numTiles.x*Math.floor(topLeftBound.x),bottomRightTile.x+=numTiles.x*Math.floor(bottomRightBound.x)),this.wrapVertical&&(topLeftTile.y+=numTiles.y*Math.floor(topLeftBound.y/aspectRatio),bottomRightTile.y+=numTiles.y*Math.floor(bottomRightBound.y/aspectRatio)),{topLeft:topLeftTile,bottomRight:bottomRightTile}}})}(OpenSeadragon),function($){var ImageRecord=function(options){$.console.assert(options,"[ImageRecord] options is required"),$.console.assert(options.image,"[ImageRecord] options.image is required"),this._image=options.image,this._tiles=[]};ImageRecord.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var canvas=document.createElement("canvas");canvas.width=this._image.width,canvas.height=this._image.height,this._renderedContext=canvas.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(renderedContext){$.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=renderedContext},addTile:function(tile){$.console.assert(tile,"[ImageRecord.addTile] tile is required"),this._tiles.push(tile)},removeTile:function(tile){for(var i=0;i<this._tiles.length;i++)if(this._tiles[i]===tile)return void this._tiles.splice(i,1);$.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",tile)},getTileCount:function(){return this._tiles.length}},$.TileCache=function(options){options=options||{},this._maxImageCacheCount=options.maxImageCacheCount||$.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},$.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(options){$.console.assert(options,"[TileCache.cacheTile] options is required"),$.console.assert(options.tile,"[TileCache.cacheTile] options.tile is required"),$.console.assert(options.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),$.console.assert(options.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var cutoff=options.cutoff||0,insertionIndex=this._tilesLoaded.length,imageRecord=this._imagesLoaded[options.tile.cacheKey];if(imageRecord||($.console.assert(options.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),imageRecord=this._imagesLoaded[options.tile.cacheKey]=new ImageRecord({image:options.image}),this._imagesLoadedCount++),imageRecord.addTile(options.tile),options.tile.cacheImageRecord=imageRecord,this._imagesLoadedCount>this._maxImageCacheCount){for(var prevTile,worstTime,worstLevel,prevTime,prevLevel,prevTileRecord,worstTile=null,worstTileIndex=-1,worstTileRecord=null,i=this._tilesLoaded.length-1;i>=0;i--)(prevTile=(prevTileRecord=this._tilesLoaded[i]).tile).level<=cutoff||prevTile.beingDrawn||(worstTile?(prevTime=prevTile.lastTouchTime,worstTime=worstTile.lastTouchTime,prevLevel=prevTile.level,worstLevel=worstTile.level,(prevTime<worstTime||prevTime==worstTime&&prevLevel>worstLevel)&&(worstTile=prevTile,worstTileIndex=i,worstTileRecord=prevTileRecord)):(worstTile=prevTile,worstTileIndex=i,worstTileRecord=prevTileRecord));worstTile&&worstTileIndex>=0&&(this._unloadTile(worstTileRecord),insertionIndex=worstTileIndex)}this._tilesLoaded[insertionIndex]=new function(options){$.console.assert(options,"[TileCache.cacheTile] options is required"),$.console.assert(options.tile,"[TileCache.cacheTile] options.tile is required"),$.console.assert(options.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=options.tile,this.tiledImage=options.tiledImage}({tile:options.tile,tiledImage:options.tiledImage})},clearTilesFor:function(tiledImage){$.console.assert(tiledImage,"[TileCache.clearTilesFor] tiledImage is required");for(var tileRecord,i=0;i<this._tilesLoaded.length;++i)(tileRecord=this._tilesLoaded[i]).tiledImage===tiledImage&&(this._unloadTile(tileRecord),this._tilesLoaded.splice(i,1),i--)},getImageRecord:function(cacheKey){return $.console.assert(cacheKey,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[cacheKey]},_unloadTile:function(tileRecord){$.console.assert(tileRecord,"[TileCache._unloadTile] tileRecord is required");var tile=tileRecord.tile,tiledImage=tileRecord.tiledImage;tile.unload(),tile.cacheImageRecord=null;var imageRecord=this._imagesLoaded[tile.cacheKey];imageRecord.removeTile(tile),imageRecord.getTileCount()||(imageRecord.destroy(),delete this._imagesLoaded[tile.cacheKey],this._imagesLoadedCount--),tiledImage.viewer.raiseEvent("tile-unloaded",{tile:tile,tiledImage:tiledImage})}}}(OpenSeadragon),function($){$.World=function(options){var _this=this;$.console.assert(options.viewer,"[World] options.viewer is required"),$.EventSource.call(this),this.viewer=options.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(event){_this._autoRefigureSizes?_this._figureSizes():_this._needsSizesFigured=!0},this._figureSizes()},$.extend($.World.prototype,$.EventSource.prototype,{addItem:function(item,options){if($.console.assert(item,"[World.addItem] item is required"),$.console.assert(item instanceof $.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(options=options||{}).index){var index=Math.max(0,Math.min(this._items.length,options.index));this._items.splice(index,0,item)}else this._items.push(item);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,item.addHandler("bounds-change",this._delegatedFigureSizes),item.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:item})},getItemAt:function(index){return $.console.assert(void 0!==index,"[World.getItemAt] index is required"),this._items[index]},getIndexOfItem:function(item){return $.console.assert(item,"[World.getIndexOfItem] item is required"),$.indexOf(this._items,item)},getItemCount:function(){return this._items.length},setItemIndex:function(item,index){$.console.assert(item,"[World.setItemIndex] item is required"),$.console.assert(void 0!==index,"[World.setItemIndex] index is required");var oldIndex=this.getIndexOfItem(item);if(index>=this._items.length)throw new Error("Index bigger than number of layers.");index!==oldIndex&&-1!==oldIndex&&(this._items.splice(oldIndex,1),this._items.splice(index,0,item),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:item,previousIndex:oldIndex,newIndex:index}))},removeItem:function(item){$.console.assert(item,"[World.removeItem] item is required");var index=$.indexOf(this._items,item);-1!==index&&(item.removeHandler("bounds-change",this._delegatedFigureSizes),item.removeHandler("clip-change",this._delegatedFigureSizes),item.destroy(),this._items.splice(index,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(item))},removeAll:function(){this.viewer._cancelPendingImages();var item,i;for(i=0;i<this._items.length;i++)(item=this._items[i]).removeHandler("bounds-change",this._delegatedFigureSizes),item.removeHandler("clip-change",this._delegatedFigureSizes),item.destroy();var removedItems=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,i=0;i<removedItems.length;i++)item=removedItems[i],this._raiseRemoveItem(item)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(){for(var animated=!1,i=0;i<this._items.length;i++)animated=this._items[i].update()||animated;return animated},draw:function(){for(var i=0;i<this._items.length;i++)this._items[i].draw();this._needsDraw=!1},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(value){this._autoRefigureSizes=value,value&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(options){var wrap,immediately=(options=options||{}).immediately||!1,layout=options.layout||$.DEFAULT_SETTINGS.collectionLayout,rows=options.rows||$.DEFAULT_SETTINGS.collectionRows,columns=options.columns||$.DEFAULT_SETTINGS.collectionColumns,tileSize=options.tileSize||$.DEFAULT_SETTINGS.collectionTileSize,increment=tileSize+(options.tileMargin||$.DEFAULT_SETTINGS.collectionTileMargin);wrap=!options.rows&&columns?columns:Math.ceil(this._items.length/rows);var item,box,width,height,position,x=0,y=0;this.setAutoRefigureSizes(!1);for(var i=0;i<this._items.length;i++)i&&i%wrap==0&&("horizontal"===layout?(y+=increment,x=0):(x+=increment,y=0)),height=(width=(box=(item=this._items[i]).getBounds()).width>box.height?tileSize:tileSize*(box.width/box.height))*(box.height/box.width),position=new $.Point(x+(tileSize-width)/2,y+(tileSize-height)/2),item.setPosition(position,immediately),item.setWidth(width,immediately),"horizontal"===layout?x+=increment:y+=increment;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var oldHomeBounds=this._homeBounds?this._homeBounds.clone():null,oldContentSize=this._contentSize?this._contentSize.clone():null,oldContentFactor=this._contentFactor||0;if(this._items.length){var item=this._items[0],bounds=item.getBounds();this._contentFactor=item.getContentSize().x/bounds.width;for(var clippedBounds=item.getClippedBounds().getBoundingBox(),left=clippedBounds.x,top=clippedBounds.y,right=clippedBounds.x+clippedBounds.width,bottom=clippedBounds.y+clippedBounds.height,i=1;i<this._items.length;i++)bounds=(item=this._items[i]).getBounds(),this._contentFactor=Math.max(this._contentFactor,item.getContentSize().x/bounds.width),clippedBounds=item.getClippedBounds().getBoundingBox(),left=Math.min(left,clippedBounds.x),top=Math.min(top,clippedBounds.y),right=Math.max(right,clippedBounds.x+clippedBounds.width),bottom=Math.max(bottom,clippedBounds.y+clippedBounds.height);this._homeBounds=new $.Rect(left,top,right-left,bottom-top),this._contentSize=new $.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new $.Rect(0,0,1,1),this._contentSize=new $.Point(1,1),this._contentFactor=1;this._contentFactor===oldContentFactor&&this._homeBounds.equals(oldHomeBounds)&&this._contentSize.equals(oldContentSize)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(item){this.raiseEvent("remove-item",{item:item})}})}(OpenSeadragon),function(){function n(n){return n&&(n.ownerDocument||n.document||n).documentElement}function t(n){return n&&(n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView)}function e(n,t){return t>n?-1:n>t?1:n>=t?0:NaN}function r(n){return null===n?NaN:+n}function i(n){return!isNaN(n)}function u(n){return{left:function(t,e,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);i>r;){var u=r+i>>>1;n(t[u],e)<0?r=u+1:i=u}return r},right:function(t,e,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);i>r;){var u=r+i>>>1;n(t[u],e)>0?i=u:r=u+1}return r}}}function o(n){return n.length}function l(n,t){for(var e in t)Object.defineProperty(n.prototype,e,{value:t[e],enumerable:!1})}function c(){this._=Object.create(null)}function f(n){return(n+="")===bo||n[0]===_o?_o+n:n}function s(n){return(n+="")[0]===_o?n.slice(1):n}function h(n){return f(n)in this._}function p(n){return(n=f(n))in this._&&delete this._[n]}function g(){var n=[];for(var t in this._)n.push(s(t));return n}function v(){var n=0;for(var t in this._)++n;return n}function d(){for(var n in this._)return!1;return!0}function y(){this._=Object.create(null)}function m(n){return n}function M(n,t,e){return function(){var r=e.apply(t,arguments);return r===t?n:r}}function x(n,t){if(t in n)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var e=0,r=wo.length;r>e;++e){var i=wo[e]+t;if(i in n)return i}}function b(){}function _(){}function w(n){function t(){for(var t,r=e,i=-1,u=r.length;++i<u;)(t=r[i].on)&&t.apply(this,arguments);return n}var e=[],r=new c;return t.on=function(t,i){var u,o=r.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,e=e.slice(0,u=e.indexOf(o)).concat(e.slice(u+1)),r.remove(t)),i&&e.push(r.set(t,{on:i})),n)},t}function S(){ao.event.preventDefault()}function k(){for(var n,t=ao.event;n=t.sourceEvent;)t=n;return t}function N(n){for(var t=new _,e=0,r=arguments.length;++e<r;)t[arguments[e]]=w(t);return t.of=function(e,r){return function(i){try{var u=i.sourceEvent=ao.event;i.target=n,ao.event=i,t[i.type].apply(e,r)}finally{ao.event=u}}},t}function E(n){return ko(n,Co),n}function A(n){return"function"==typeof n?n:function(){return No(n,this)}}function C(n){return"function"==typeof n?n:function(){return Eo(n,this)}}function z(n,t){return n=ao.ns.qualify(n),null==t?n.local?function(){this.removeAttributeNS(n.space,n.local)}:function(){this.removeAttribute(n)}:"function"==typeof t?n.local?function(){var e=t.apply(this,arguments);null==e?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}:function(){var e=t.apply(this,arguments);null==e?this.removeAttribute(n):this.setAttribute(n,e)}:n.local?function(){this.setAttributeNS(n.space,n.local,t)}:function(){this.setAttribute(n,t)}}function L(n){return n.trim().replace(/\s+/g," ")}function q(n){return new RegExp("(?:^|\\s+)"+ao.requote(n)+"(?:\\s+|$)","g")}function T(n){return(n+"").trim().split(/^|\s+/)}function R(n,t){var i=(n=T(n).map(D)).length;return"function"==typeof t?function(){for(var e=-1,r=t.apply(this,arguments);++e<i;)n[e](this,r)}:function(){for(var e=-1;++e<i;)n[e](this,t)}}function D(n){var t=q(n);return function(e,r){if(i=e.classList)return r?i.add(n):i.remove(n);var i=e.getAttribute("class")||"";r?(t.lastIndex=0,t.test(i)||e.setAttribute("class",L(i+" "+n))):e.setAttribute("class",L(i.replace(t," ")))}}function P(n,t,e){return null==t?function(){this.style.removeProperty(n)}:"function"==typeof t?function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,e)}:function(){this.style.setProperty(n,t,e)}}function U(n,t){return null==t?function(){delete this[n]}:"function"==typeof t?function(){var e=t.apply(this,arguments);null==e?delete this[n]:this[n]=e}:function(){this[n]=t}}function j(n){return"function"==typeof n?n:(n=ao.ns.qualify(n)).local?function(){return this.ownerDocument.createElementNS(n.space,n.local)}:function(){var t=this.ownerDocument,e=this.namespaceURI;return e===zo&&t.documentElement.namespaceURI===zo?t.createElement(n):t.createElementNS(e,n)}}function F(){var n=this.parentNode;n&&n.removeChild(this)}function H(n){return{__data__:n}}function O(n){return function(){return Ao(this,n)}}function I(n){return arguments.length||(n=e),function(t,e){return t&&e?n(t.__data__,e.__data__):!t-!e}}function Y(n,t){for(var e=0,r=n.length;r>e;e++)for(var i,u=n[e],o=0,a=u.length;a>o;o++)(i=u[o])&&t(i,o,e);return n}function Z(n){return ko(n,qo),n}function X(n,t,e){function r(){var t=this[o];t&&(this.removeEventListener(n,t,t.$),delete this[o])}var o="__on"+n,a=n.indexOf("."),l=$;a>0&&(n=n.slice(0,a));var c=To.get(n);return c&&(n=c,l=B),a?t?function(){var i=l(t,co(arguments));r.call(this),this.addEventListener(n,this[o]=i,i.$=e),i._=t}:r:t?b:function(){var t,e=new RegExp("^__on([^.]+)"+ao.requote(n)+"$");for(var r in this)if(t=r.match(e)){var i=this[r];this.removeEventListener(t[1],i,i.$),delete this[r]}}}function $(n,t){return function(e){var r=ao.event;ao.event=e,t[0]=this.__data__;try{n.apply(this,t)}finally{ao.event=r}}}function B(n,t){var e=$(n,t);return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||e.call(t,n)}}function W(e){var r=".dragsuppress-"+ ++Do,i="click"+r,u=ao.select(t(e)).on("touchmove"+r,S).on("dragstart"+r,S).on("selectstart"+r,S);if(null==Ro&&(Ro=!("onselectstart"in e)&&x(e.style,"userSelect")),Ro){var o=n(e).style,a=o[Ro];o[Ro]="none"}return function(n){if(u.on(r,null),Ro&&(o[Ro]=a),n){var t=function(){u.on(i,null)};u.on(i,function(){S(),t()},!0),setTimeout(t,0)}}}function J(n,e){e.changedTouches&&(e=e.changedTouches[0]);var r=n.ownerSVGElement||n;if(r.createSVGPoint){var i=r.createSVGPoint();if(0>Po){var u=t(n);if(u.scrollX||u.scrollY){var o=(r=ao.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important"))[0][0].getScreenCTM();Po=!(o.f||o.e),r.remove()}}return Po?(i.x=e.pageX,i.y=e.pageY):(i.x=e.clientX,i.y=e.clientY),i=i.matrixTransform(n.getScreenCTM().inverse()),[i.x,i.y]}var a=n.getBoundingClientRect();return[e.clientX-a.left-n.clientLeft,e.clientY-a.top-n.clientTop]}function G(){return ao.event.changedTouches[0].identifier}function K(n){return n>0?1:0>n?-1:0}function Q(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(t[1]-n[1])*(e[0]-n[0])}function nn(n){return n>1?0:-1>n?Fo:Math.acos(n)}function tn(n){return n>1?Io:-1>n?-Io:Math.asin(n)}function rn(n){return((n=Math.exp(n))+1/n)/2}function on(n){return(n=Math.sin(n/2))*n}function an(){}function ln(n,t,e){return this instanceof ln?(this.h=+n,this.s=+t,void(this.l=+e)):arguments.length<2?n instanceof ln?new ln(n.h,n.s,n.l):_n(""+n,wn,ln):new ln(n,t,e)}function cn(n,t,e){function i(n){return Math.round(255*function(n){return n>360?n-=360:0>n&&(n+=360),60>n?u+(o-u)*n/60:180>n?o:240>n?u+(o-u)*(240-n)/60:u}(n))}var u,o;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)?0:0>t?0:t>1?1:t,e=0>e?0:e>1?1:e,o=.5>=e?e*(1+t):e+t-e*t,u=2*e-o,new mn(i(n+120),i(n),i(n-120))}function fn(n,t,e){return this instanceof fn?(this.h=+n,this.c=+t,void(this.l=+e)):arguments.length<2?n instanceof fn?new fn(n.h,n.c,n.l):n instanceof hn?gn(n.l,n.a,n.b):gn((n=Sn((n=ao.rgb(n)).r,n.g,n.b)).l,n.a,n.b):new fn(n,t,e)}function sn(n,t,e){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),new hn(e,Math.cos(n*=Yo)*t,Math.sin(n)*t)}function hn(n,t,e){return this instanceof hn?(this.l=+n,this.a=+t,void(this.b=+e)):arguments.length<2?n instanceof hn?new hn(n.l,n.a,n.b):n instanceof fn?sn(n.h,n.c,n.l):Sn((n=mn(n)).r,n.g,n.b):new hn(n,t,e)}function pn(n,t,e){var r=(n+16)/116,i=r+t/500,u=r-e/200;return i=vn(i)*na,r=vn(r)*ta,u=vn(u)*ea,new mn(yn(3.2404542*i-1.5371385*r-.4985314*u),yn(-.969266*i+1.8760108*r+.041556*u),yn(.0556434*i-.2040259*r+1.0572252*u))}function gn(n,t,e){return n>0?new fn(Math.atan2(e,t)*Zo,Math.sqrt(t*t+e*e),n):new fn(NaN,NaN,n)}function vn(n){return n>.206893034?n*n*n:(n-4/29)/7.787037}function dn(n){return n>.008856?Math.pow(n,1/3):7.787037*n+4/29}function yn(n){return Math.round(255*(.00304>=n?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function mn(n,t,e){return this instanceof mn?(this.r=~~n,this.g=~~t,void(this.b=~~e)):arguments.length<2?n instanceof mn?new mn(n.r,n.g,n.b):_n(""+n,mn,cn):new mn(n,t,e)}function Mn(n){return new mn(n>>16,n>>8&255,255&n)}function xn(n){return Mn(n)+""}function bn(n){return 16>n?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function _n(n,t,e){var r,i,u,o=0,a=0,l=0;if(r=/([a-z]+)\((.*)\)/.exec(n=n.toLowerCase()))switch(i=r[2].split(","),r[1]){case"hsl":return e(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return t(Nn(i[0]),Nn(i[1]),Nn(i[2]))}return(u=ua.get(n))?t(u.r,u.g,u.b):(null==n||"#"!==n.charAt(0)||isNaN(u=parseInt(n.slice(1),16))||(4===n.length?(o=(3840&u)>>4,o|=o>>4,a=240&u,a|=a>>4,l=15&u,l|=l<<4):7===n.length&&(o=(16711680&u)>>16,a=(65280&u)>>8,l=255&u)),t(o,a,l))}function wn(n,t,e){var r,i,u=Math.min(n/=255,t/=255,e/=255),o=Math.max(n,t,e),a=o-u,l=(o+u)/2;return a?(i=.5>l?a/(o+u):a/(2-o-u),r=n==o?(t-e)/a+(e>t?6:0):t==o?(e-n)/a+2:(n-t)/a+4,r*=60):(r=NaN,i=l>0&&1>l?0:r),new ln(r,i,l)}function Sn(n,t,e){var r=dn((.4124564*(n=kn(n))+.3575761*(t=kn(t))+.1804375*(e=kn(e)))/na),i=dn((.2126729*n+.7151522*t+.072175*e)/ta);return hn(116*i-16,500*(r-i),200*(i-dn((.0193339*n+.119192*t+.9503041*e)/ea)))}function kn(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Nn(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function En(n){return"function"==typeof n?n:function(){return n}}function An(n){return function(t,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),Cn(t,e,n,r)}}function Cn(n,t,e,r){function i(){var n,t=l.status;if(!t&&function(n){var t=n.responseType;return t&&"text"!==t?n.response:n.responseText}(l)||t>=200&&300>t||304===t){try{n=e.call(u,l)}catch(r){return void o.error.call(u,r)}o.load.call(u,n)}else o.error.call(u,l)}var u={},o=ao.dispatch("beforesend","progress","load","error"),a={},l=new XMLHttpRequest,c=null;return!this.XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(n)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=i:l.onreadystatechange=function(){l.readyState>3&&i()},l.onprogress=function(n){var t=ao.event;ao.event=n;try{o.progress.call(u,l)}finally{ao.event=t}},u.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?a[n]:(null==t?delete a[n]:a[n]=t+"",u)},u.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",u):t},u.responseType=function(n){return arguments.length?(c=n,u):c},u.response=function(n){return e=n,u},["get","post"].forEach(function(n){u[n]=function(){return u.send.apply(u,[n].concat(co(arguments)))}}),u.send=function(e,r,i){if(2===arguments.length&&"function"==typeof r&&(i=r,r=null),l.open(e,n,!0),null==t||"accept"in a||(a.accept=t+",*/*"),l.setRequestHeader)for(var f in a)l.setRequestHeader(f,a[f]);return null!=t&&l.overrideMimeType&&l.overrideMimeType(t),null!=c&&(l.responseType=c),null!=i&&u.on("error",i).on("load",function(n){i(null,n)}),o.beforesend.call(u,l),l.send(null==r?null:r),u},u.abort=function(){return l.abort(),u},ao.rebind(u,o,"on"),null==r?u:u.get(function(n){return 1===n.length?function(t,e){n(null==t?e:null)}:n}(r))}function qn(n,t,e){var r=arguments.length;2>r&&(t=0),3>r&&(e=Date.now());var u={c:n,t:e+t,n:null};return aa?aa.n=u:oa=u,aa=u,la||(ca=clearTimeout(ca),la=1,fa(Tn)),u}function Tn(){var n=Rn(),t=Dn()-n;t>24?(isFinite(t)&&(clearTimeout(ca),ca=setTimeout(Tn,t)),la=0):(la=1,fa(Tn))}function Rn(){for(var n=Date.now(),t=oa;t;)n>=t.t&&t.c(n-t.t)&&(t.c=null),t=t.n;return n}function Dn(){for(var n,t=oa,e=1/0;t;)t.c?(t.t<e&&(e=t.t),t=(n=t).n):t=n?n.n=t.n:oa=t.n;return aa=n,e}function Pn(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function Hn(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function On(n,t,e){function r(t){var e=n(t),r=u(e,1);return r-t>t-e?e:r}function i(e){return t(e=n(new va(e-1)),1),e}function u(n,e){return t(n=new va(+n),e),n}function o(n,r,u){var o=i(n),a=[];if(u>1)for(;r>o;)e(o)%u||a.push(new Date(+o)),t(o,1);else for(;r>o;)a.push(new Date(+o)),t(o,1);return a}n.floor=n,n.round=r,n.ceil=i,n.offset=u,n.range=o;var l=n.utc=In(n);return l.floor=l,l.round=In(r),l.ceil=In(i),l.offset=In(u),l.range=function(n,t,e){try{va=Hn;var r=new Hn;return r._=n,o(r,t,e)}finally{va=Date}},n}function In(n){return function(t,e){try{va=Hn;var r=new Hn;return r._=t,n(r,e)._}finally{va=Date}}}function Zn(n,t,e){var r=0>n?"-":"",i=(r?-n:n)+"",u=i.length;return r+(e>u?new Array(e-u+1).join(t)+i:i)}function Vn(n){return new RegExp("^(?:"+n.map(ao.requote).join("|")+")","i")}function Xn(n){for(var t=new c,e=-1,r=n.length;++e<r;)t.set(n[e].toLowerCase(),e);return t}function $n(n,t,e){ma.lastIndex=0;var r=ma.exec(t.slice(e,e+1));return r?(n.w=+r[0],e+r[0].length):-1}function Bn(n,t,e){ma.lastIndex=0;var r=ma.exec(t.slice(e));return r?(n.U=+r[0],e+r[0].length):-1}function Wn(n,t,e){ma.lastIndex=0;var r=ma.exec(t.slice(e));return r?(n.W=+r[0],e+r[0].length):-1}function Jn(n,t,e){ma.lastIndex=0;var r=ma.exec(t.slice(e,e+4));return r?(n.y=+r[0],e+r[0].length):-1}function Gn(n,t,e){ma.lastIndex=0;var r=ma.exec(t.slice(e,e+2));return r?(n.y=function(n){return n+(n>68?1900:2e3)}(+r[0]),e+r[0].length):-1}function Kn(n,t,e){return/^[+-]\d{4}$/.test(t=t.slice(e,e+5))?(n.Z=-t,e+5):-1}function nt(n,t,e){ma.lastIndex=0;var r=ma.exec(t.slice(e,e+2));return r?(n.m=r[0]-1,e+r[0].length):-1}function tt(n,t,e){ma.lastIndex=0;var r=ma.exec(t.slice(e,e+2));return r?(n.d=+r[0],e+r[0].length):-1}function et(n,t,e){ma.lastIndex=0;var r=ma.exec(t.slice(e,e+3));return r?(n.j=+r[0],e+r[0].length):-1}function rt(n,t,e){ma.lastIndex=0;var r=ma.exec(t.slice(e,e+2));return r?(n.H=+r[0],e+r[0].length):-1}function it(n,t,e){ma.lastIndex=0;var r=ma.exec(t.slice(e,e+2));return r?(n.M=+r[0],e+r[0].length):-1}function ut(n,t,e){ma.lastIndex=0;var r=ma.exec(t.slice(e,e+2));return r?(n.S=+r[0],e+r[0].length):-1}function ot(n,t,e){ma.lastIndex=0;var r=ma.exec(t.slice(e,e+3));return r?(n.L=+r[0],e+r[0].length):-1}function at(n){var t=n.getTimezoneOffset(),e=t>0?"-":"+",r=xo(t)/60|0,i=xo(t)%60;return e+Zn(r,"0",2)+Zn(i,"0",2)}function lt(n,t,e){Ma.lastIndex=0;var r=Ma.exec(t.slice(e,e+1));return r?e+r[0].length:-1}function ct(n){for(var t=n.length,e=-1;++e<t;)n[e][0]=this(n[e][0]);return function(t){for(var e=0,r=n[e];!r[1](t);)r=n[++e];return r[0](t)}}function ft(){}function st(n,t,e){var r=e.s=n+t,i=r-n,u=r-i;e.t=n-u+(t-i)}function ht(n,t){n&&wa.hasOwnProperty(n.type)&&wa[n.type](n,t)}function pt(n,t,e){var r,i=-1,u=n.length-e;for(t.lineStart();++i<u;)r=n[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function gt(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)pt(n[e],t,1);t.polygonEnd()}function vt(){function n(n,t){t=t*Yo/2+Fo/4;var e=(n*=Yo)-r,o=e>=0?1:-1,a=o*e,l=Math.cos(t),c=Math.sin(t),f=u*c,s=i*l+f*Math.cos(a),h=f*o*Math.sin(a);ka.add(Math.atan2(h,s)),r=n,i=l,u=c}var t,e,r,i,u;Na.point=function(o,a){Na.point=n,r=(t=o)*Yo,i=Math.cos(a=(e=a)*Yo/2+Fo/4),u=Math.sin(a)},Na.lineEnd=function(){n(t,e)}}function dt(n){var t=n[0],e=n[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)]}function yt(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function mt(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Mt(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function xt(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function bt(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function _t(n){return[Math.atan2(n[1],n[0]),tn(n[2])]}function wt(n,t){return xo(n[0]-t[0])<Uo&&xo(n[1]-t[1])<Uo}function St(n,t){n*=Yo;var e=Math.cos(t*=Yo);kt(e*Math.cos(n),e*Math.sin(n),Math.sin(t))}function kt(n,t,e){Ca+=(n-Ca)/++Ea,za+=(t-za)/Ea,La+=(e-La)/Ea}function Nt(){function n(n,i){n*=Yo;var u=Math.cos(i*=Yo),o=u*Math.cos(n),a=u*Math.sin(n),l=Math.sin(i),c=Math.atan2(Math.sqrt((c=e*l-r*a)*c+(c=r*o-t*l)*c+(c=t*a-e*o)*c),t*o+e*a+r*l);Aa+=c,qa+=c*(t+(t=o)),Ta+=c*(e+(e=a)),Ra+=c*(r+(r=l)),kt(t,e,r)}var t,e,r;ja.point=function(i,u){i*=Yo;var o=Math.cos(u*=Yo);t=o*Math.cos(i),e=o*Math.sin(i),r=Math.sin(u),ja.point=n,kt(t,e,r)}}function Et(){ja.point=St}function At(){function n(n,t){n*=Yo;var e=Math.cos(t*=Yo),o=e*Math.cos(n),a=e*Math.sin(n),l=Math.sin(t),c=i*l-u*a,f=u*o-r*l,s=r*a-i*o,h=Math.sqrt(c*c+f*f+s*s),p=r*o+i*a+u*l,g=h&&-nn(p)/h,v=Math.atan2(h,p);Da+=g*c,Pa+=g*f,Ua+=g*s,Aa+=v,qa+=v*(r+(r=o)),Ta+=v*(i+(i=a)),Ra+=v*(u+(u=l)),kt(r,i,u)}var t,e,r,i,u;ja.point=function(o,a){t=o,e=a,ja.point=n,o*=Yo;var l=Math.cos(a*=Yo);r=l*Math.cos(o),i=l*Math.sin(o),u=Math.sin(a),kt(r,i,u)},ja.lineEnd=function(){n(t,e),ja.lineEnd=Et,ja.point=St}}function Ct(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return(e=t.invert(e,r))&&n.invert(e[0],e[1])}),e}function zt(){return!0}function Lt(n,t,e,r,i){var u=[],o=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,e=n[0],r=n[t];if(wt(e,r)){i.lineStart();for(var a=0;t>a;++a)i.point((e=n[a])[0],e[1]);return void i.lineEnd()}var l=new Tt(e,n,null,!0),c=new Tt(e,null,l,!1);l.o=c,u.push(l),o.push(c),c=new Tt(r,null,l=new Tt(r,n,null,!1),!0),l.o=c,u.push(l),o.push(c)}}),o.sort(t),qt(u),qt(o),u.length){for(var a=0,l=e,c=o.length;c>a;++a)o[a].e=l=!l;for(var f,s,h=u[0];;){for(var p=h,g=!0;p.v;)if((p=p.n)===h)return;f=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(g)for(var a=0,c=f.length;c>a;++a)i.point((s=f[a])[0],s[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(g)for(a=(f=p.p.z).length-1;a>=0;--a)i.point((s=f[a])[0],s[1]);else r(p.x,p.p.x,-1,i);p=p.p}f=(p=p.o).z,g=!g}while(!p.v);i.lineEnd()}}}function qt(n){if(t=n.length){for(var t,e,r=0,i=n[0];++r<t;)i.n=e=n[r],e.p=i,i=e;i.n=e=n[0],e.p=i}}function Tt(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Rt(n,t,e,r){return function(i,u){function o(t,e){var r=i(t,e);n(t=r[0],e=r[1])&&u.point(t,e)}function a(n,t){var e=i(n,t);d.point(e[0],e[1])}function l(){m.point=a,d.lineStart()}function c(){m.point=o,d.lineEnd()}function f(n,t){v.push([n,t]);var e=i(n,t);x.point(e[0],e[1])}function s(){x.lineStart(),v=[]}function h(){f(v[0][0],v[0][1]),x.lineEnd();var n,t=x.clean(),e=M.buffer(),r=e.length;if(v.pop(),g.push(v),v=null,r)if(1&t){var i,o=-1;if((r=(n=e[0]).length-1)>0){for(b||(u.polygonStart(),b=!0),u.lineStart();++o<r;)u.point((i=n[o])[0],i[1]);u.lineEnd()}}else r>1&&2&t&&e.push(e.pop().concat(e.shift())),p.push(e.filter(Dt))}var p,g,v,d=t(u),y=i.invert(r[0],r[1]),m={point:o,lineStart:l,lineEnd:c,polygonStart:function(){m.point=f,m.lineStart=s,m.lineEnd=h,p=[],g=[]},polygonEnd:function(){m.point=o,m.lineStart=l,m.lineEnd=c,p=ao.merge(p);var n=function(n,t){var e=n[0],r=n[1],i=[Math.sin(e),-Math.cos(e),0],u=0,o=0;ka.reset();for(var a=0,l=t.length;l>a;++a){var c=t[a],f=c.length;if(f)for(var s=c[0],h=s[0],p=s[1]/2+Fo/4,g=Math.sin(p),v=Math.cos(p),d=1;;){d===f&&(d=0);var y=(n=c[d])[0],m=n[1]/2+Fo/4,M=Math.sin(m),x=Math.cos(m),b=y-h,_=b>=0?1:-1,w=_*b,S=w>Fo,k=g*M;if(ka.add(Math.atan2(k*_*Math.sin(w),v*x+k*Math.cos(w))),u+=S?b+_*Ho:b,S^h>=e^y>=e){var N=mt(dt(s),dt(n));bt(N);var E=mt(i,N);bt(E);var A=(S^b>=0?-1:1)*tn(E[2]);(r>A||r===A&&(N[0]||N[1]))&&(o+=S^b>=0?1:-1)}if(!d++)break;h=y,g=M,v=x,s=n}}return(-Uo>u||Uo>u&&-Uo>ka)^1&o}(y,g);p.length?(b||(u.polygonStart(),b=!0),Lt(p,Ut,n,e,u)):n&&(b||(u.polygonStart(),b=!0),u.lineStart(),e(null,null,1,u),u.lineEnd()),b&&(u.polygonEnd(),b=!1),p=g=null},sphere:function(){u.polygonStart(),u.lineStart(),e(null,null,1,u),u.lineEnd(),u.polygonEnd()}},M=Pt(),x=t(M),b=!1;return m}}function Dt(n){return n.length>1}function Pt(){var n,t=[];return{lineStart:function(){t.push(n=[])},point:function(t,e){n.push([t,e])},lineEnd:b,buffer:function(){var e=t;return t=[],n=null,e},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Ut(n,t){return((n=n.x)[0]<0?n[1]-Io-Uo:Io-n[1])-((t=t.x)[0]<0?t[1]-Io-Uo:Io-t[1])}function Yt(n,t,e,r){return function(i){var u,o=i.a,a=i.b,l=o.x,c=o.y,h=0,p=1,g=a.x-l,v=a.y-c;if(u=n-l,g||!(u>0)){if(u/=g,0>g){if(h>u)return;p>u&&(p=u)}else if(g>0){if(u>p)return;u>h&&(h=u)}if(u=e-l,g||!(0>u)){if(u/=g,0>g){if(u>p)return;u>h&&(h=u)}else if(g>0){if(h>u)return;p>u&&(p=u)}if(u=t-c,v||!(u>0)){if(u/=v,0>v){if(h>u)return;p>u&&(p=u)}else if(v>0){if(u>p)return;u>h&&(h=u)}if(u=r-c,v||!(0>u)){if(u/=v,0>v){if(u>p)return;u>h&&(h=u)}else if(v>0){if(h>u)return;p>u&&(p=u)}return h>0&&(i.a={x:l+h*g,y:c+h*v}),1>p&&(i.b={x:l+p*g,y:c+p*v}),i}}}}}}function Zt(n,t,e,r){function i(r,i){return xo(r[0]-n)<Uo?i>0?0:3:xo(r[0]-e)<Uo?i>0?2:1:xo(r[1]-t)<Uo?i>0?1:0:i>0?3:2}function u(n,t){return o(n.x,t.x)}function o(n,t){var e=i(n,1),r=i(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}return function(a){function c(u,a,l,c){var f=0,s=0;if(null==u||(f=i(u,l))!==(s=i(a,l))||o(u,a)<0^l>0)do{c.point(0===f||3===f?n:e,f>1?r:t)}while((f=(f+l+4)%4)!==s);else c.point(a[0],a[1])}function f(i,u){return i>=n&&e>=i&&u>=t&&r>=u}function s(n,t){f(n,t)&&a.point(n,t)}function g(n,t){var e=f(n=Math.max(-Ha,Math.min(Ha,n)),t=Math.max(-Ha,Math.min(Ha,t)));if(d&&y.push([n,t]),S)m=n,M=t,x=e,S=!1,e&&(a.lineStart(),a.point(n,t));else if(e&&w)a.point(n,t);else{var r={a:{x:b,y:_},b:{x:n,y:t}};A(r)?(w||(a.lineStart(),a.point(r.a.x,r.a.y)),a.point(r.b.x,r.b.y),e||a.lineEnd(),k=!1):e&&(a.lineStart(),a.point(n,t),k=!1)}b=n,_=t,w=e}var v,d,y,m,M,x,b,_,w,S,k,N=a,E=Pt(),A=Yt(n,t,e,r),C={point:s,lineStart:function(){C.point=g,d&&d.push(y=[]),S=!0,w=!1,b=_=NaN},lineEnd:function(){v&&(g(m,M),x&&w&&E.rejoin(),v.push(E.buffer())),C.point=s,w&&a.lineEnd()},polygonStart:function(){a=E,v=[],d=[],k=!0},polygonEnd:function(){a=N,v=ao.merge(v);var t=function(n){for(var t=0,e=d.length,r=n[1],i=0;e>i;++i)for(var u,o=1,a=d[i],l=a.length,c=a[0];l>o;++o)u=a[o],c[1]<=r?u[1]>r&&Q(c,u,n)>0&&++t:u[1]<=r&&Q(c,u,n)<0&&--t,c=u;return 0!==t}([n,r]),e=k&&t,i=v.length;(e||i)&&(a.polygonStart(),e&&(a.lineStart(),c(null,null,1,a),a.lineEnd()),i&&Lt(v,u,t,c,a),a.polygonEnd()),v=d=y=null}};return C}}function Vt(n){var t=0,e=Fo/3,r=ae(n),i=r(t,e);return i.parallels=function(n){return arguments.length?r(t=n[0]*Fo/180,e=n[1]*Fo/180):[t/Fo*180,e/Fo*180]},i}function Xt(n,t){function e(n,t){var e=Math.sqrt(u-2*i*Math.sin(t))/i;return[e*Math.sin(n*=i),o-e*Math.cos(n)]}var r=Math.sin(n),i=(r+Math.sin(t))/2,u=1+r*(2*i-r),o=Math.sqrt(u)/i;return e.invert=function(n,t){var e=o-t;return[Math.atan2(n,e)/i,tn((u-(n*n+e*e)*i*i)/(2*i))]},e}function $t(){function n(n,t){Ia+=i*n-r*t,r=n,i=t}var t,e,r,i;$a.point=function(u,o){$a.point=n,t=r=u,e=i=o},$a.lineEnd=function(){n(t,e)}}function Jt(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function Gt(n,t){Ca+=n,za+=t,++La}function Kt(){function n(n,r){var i=n-t,u=r-e,o=Math.sqrt(i*i+u*u);qa+=o*(t+n)/2,Ta+=o*(e+r)/2,Ra+=o,Gt(t=n,e=r)}var t,e;Wa.point=function(r,i){Wa.point=n,Gt(t=r,e=i)}}function Qt(){Wa.point=Gt}function ne(){function n(n,t){var e=n-r,u=t-i,o=Math.sqrt(e*e+u*u);qa+=o*(r+n)/2,Ta+=o*(i+t)/2,Ra+=o,Da+=(o=i*n-r*t)*(r+n),Pa+=o*(i+t),Ua+=3*o,Gt(r=n,i=t)}var t,e,r,i;Wa.point=function(u,o){Wa.point=n,Gt(t=r=u,e=i=o)},Wa.lineEnd=function(){n(t,e)}}function ee(n){function t(n){return(a?r:e)(n)}function e(t){return ue(t,function(e,r){e=n(e,r),t.point(e[0],e[1])})}function r(t){function e(e,r){e=n(e,r),t.point(e[0],e[1])}function r(){M=NaN,S.point=u,t.lineStart()}function u(e,r){var u=dt([e,r]),o=n(e,r);i(M,x,m,b,_,w,M=o[0],x=o[1],m=e,b=u[0],_=u[1],w=u[2],a,t),t.point(M,x)}function o(){S.point=e,t.lineEnd()}function l(){r(),S.point=c,S.lineEnd=f}function c(n,t){u(s=n,h=t),p=M,g=x,v=b,d=_,y=w,S.point=u}function f(){i(M,x,m,b,_,w,p,g,s,v,d,y,a,t),S.lineEnd=o,o()}var s,h,p,g,v,d,y,m,M,x,b,_,w,S={point:e,lineStart:r,lineEnd:o,polygonStart:function(){t.polygonStart(),S.lineStart=l},polygonEnd:function(){t.polygonEnd(),S.lineStart=r}};return S}function i(t,e,r,a,l,c,f,s,h,p,g,v,d,y){var m=f-t,M=s-e,x=m*m+M*M;if(x>4*u&&d--){var b=a+p,_=l+g,w=c+v,S=Math.sqrt(b*b+_*_+w*w),k=Math.asin(w/=S),N=xo(xo(w)-1)<Uo||xo(r-h)<Uo?(r+h)/2:Math.atan2(_,b),E=n(N,k),A=E[0],C=E[1],z=A-t,L=C-e,q=M*z-m*L;(q*q/x>u||xo((m*z+M*L)/x-.5)>.3||o>a*p+l*g+c*v)&&(i(t,e,r,a,l,c,A,C,N,b/=S,_/=S,w,d,y),y.point(A,C),i(A,C,N,b,_,w,f,s,h,p,g,v,d,y))}}var u=.5,o=Math.cos(30*Yo),a=16;return t.precision=function(n){return arguments.length?(a=(u=n*n)>0&&16,t):Math.sqrt(u)},t}function ie(n){this.stream=n}function ue(n,t){return{point:t,sphere:function(){n.sphere()},lineStart:function(){n.lineStart()},lineEnd:function(){n.lineEnd()},polygonStart:function(){n.polygonStart()},polygonEnd:function(){n.polygonEnd()}}}function oe(n){return ae(function(){return n})()}function ae(n){function t(n){return n=a(n[0]*Yo,n[1]*Yo),[n[0]*h+l,c-n[1]*h]}function r(){a=Ct(o=se(y,M,x),u);var n=u(v,d);return l=p-n[0]*h,c=g+n[1]*h,i()}function i(){return f&&(f.valid=!1,f=null),t}var u,o,a,l,c,f,s=ee(function(n,t){return n=u(n,t),[n[0]*h+l,c-n[1]*h]}),h=150,p=480,g=250,v=0,d=0,y=0,M=0,x=0,b=Fa,_=m,w=null,S=null;return t.stream=function(n){return f&&(f.valid=!1),f=le(b(o,s(_(n)))),f.valid=!0,f},t.clipAngle=function(n){return arguments.length?(b=null==n?(w=n,Fa):function(n){function t(n,t){return Math.cos(n)*Math.cos(t)>u}function r(n,t,e){var o=[1,0,0],a=mt(dt(n),dt(t)),l=yt(a,a),c=a[0],f=l-c*c;if(!f)return!e&&n;var s=u*l/f,h=-u*c/f,p=mt(o,a),g=xt(o,s);Mt(g,xt(a,h));var d=p,y=yt(g,d),m=yt(d,d),M=y*y-m*(yt(g,g)-1);if(!(0>M)){var x=Math.sqrt(M),b=xt(d,(-y-x)/m);if(Mt(b,g),b=_t(b),!e)return b;var _,w=n[0],S=t[0],k=n[1],N=t[1];w>S&&(_=w,w=S,S=_);var E=S-w,A=xo(E-Fo)<Uo;if(!A&&k>N&&(_=k,k=N,N=_),A||Uo>E?A?k+N>0^b[1]<(xo(b[0]-w)<Uo?k:N):k<=b[1]&&b[1]<=N:E>Fo^(w<=b[0]&&b[0]<=S)){var z=xt(d,(-y+x)/m);return Mt(z,g),[b,_t(z)]}}}function i(t,e){var r=o?n:Fo-n,i=0;return-r>t?i|=1:t>r&&(i|=2),-r>e?i|=4:e>r&&(i|=8),i}var u=Math.cos(n),o=u>0,a=xo(u)>Uo;return Rt(t,function(n){var e,u,l,c,f;return{lineStart:function(){c=l=!1,f=1},point:function(s,h){var p,g=[s,h],v=t(s,h),d=o?v?0:i(s,h):v?i(s+(0>s?Fo:-Fo),h):0;if(!e&&(c=l=v)&&n.lineStart(),v!==l&&(p=r(e,g),(wt(e,p)||wt(g,p))&&(g[0]+=Uo,g[1]+=Uo,v=t(g[0],g[1]))),v!==l)f=0,v?(n.lineStart(),p=r(g,e),n.point(p[0],p[1])):(p=r(e,g),n.point(p[0],p[1]),n.lineEnd()),e=p;else if(a&&e&&o^v){var y;d&u||!(y=r(g,e,!0))||(f=0,o?(n.lineStart(),n.point(y[0][0],y[0][1]),n.point(y[1][0],y[1][1]),n.lineEnd()):(n.point(y[1][0],y[1][1]),n.lineEnd(),n.lineStart(),n.point(y[0][0],y[0][1])))}!v||e&&wt(e,g)||n.point(g[0],g[1]),e=g,l=v,u=d},lineEnd:function(){l&&n.lineEnd(),e=null},clean:function(){return f|(c&&l)<<1}}},ve(n,6*Yo),o?[0,-n]:[-Fo,n-Fo])}((w=+n)*Yo),i()):w},t.clipExtent=function(n){return arguments.length?(S=n,_=n?Zt(n[0][0],n[0][1],n[1][0],n[1][1]):m,i()):S},t.scale=function(n){return arguments.length?(h=+n,r()):h},t.translate=function(n){return arguments.length?(p=+n[0],g=+n[1],r()):[p,g]},t.center=function(n){return arguments.length?(v=n[0]%360*Yo,d=n[1]%360*Yo,r()):[v*Zo,d*Zo]},t.rotate=function(n){return arguments.length?(y=n[0]%360*Yo,M=n[1]%360*Yo,x=n.length>2?n[2]%360*Yo:0,r()):[y*Zo,M*Zo,x*Zo]},ao.rebind(t,s,"precision"),function(){return u=n.apply(this,arguments),t.invert=u.invert&&function(n){return(n=a.invert((n[0]-l)/h,(c-n[1])/h))&&[n[0]*Zo,n[1]*Zo]},r()}}function le(n){return ue(n,function(t,e){n.point(t*Yo,e*Yo)})}function ce(n,t){return[n,t]}function fe(n,t){return[n>Fo?n-Ho:-Fo>n?n+Ho:n,t]}function se(n,t,e){return n?t||e?Ct(pe(n),ge(t,e)):pe(n):t||e?ge(t,e):fe}function he(n){return function(t,e){return t+=n,[t>Fo?t-Ho:-Fo>t?t+Ho:t,e]}}function pe(n){var t=he(n);return t.invert=he(-n),t}function ge(n,t){function e(n,t){var e=Math.cos(t),a=Math.cos(n)*e,l=Math.sin(n)*e,c=Math.sin(t),f=c*r+a*i;return[Math.atan2(l*u-f*o,a*r-c*i),tn(f*u+l*o)]}var r=Math.cos(n),i=Math.sin(n),u=Math.cos(t),o=Math.sin(t);return e.invert=function(n,t){var e=Math.cos(t),a=Math.cos(n)*e,l=Math.sin(n)*e,c=Math.sin(t),f=c*u-l*o;return[Math.atan2(l*u+c*o,a*r+f*i),tn(f*r-a*i)]},e}function ve(n,t){var e=Math.cos(n),r=Math.sin(n);return function(i,u,o,a){var l=o*t;null!=i?(i=de(e,i),u=de(e,u),(o>0?u>i:i>u)&&(i+=o*Ho)):(i=n+o*Ho,u=n-.5*l);for(var c,f=i;o>0?f>u:u>f;f-=l)a.point((c=_t([e,-r*Math.cos(f),-r*Math.sin(f)]))[0],c[1])}}function de(n,t){var e=dt(t);e[0]-=n,bt(e);var r=nn(-e[1]);return((-e[2]<0?-r:r)+2*Math.PI-Uo)%(2*Math.PI)}function ye(n,t,e){var r=ao.range(n,t-Uo,e).concat(t);return function(n){return r.map(function(t){return[n,t]})}}function me(n,t,e){var r=ao.range(n,t-Uo,e).concat(t);return function(n){return r.map(function(t){return[t,n]})}}function Me(n){return n.source}function xe(n){return n.target}function we(n,t){function e(t,e){var r=Math.cos(t),i=Math.cos(e),u=n(r*i);return[u*i*Math.sin(t),u*Math.sin(e)]}return e.invert=function(n,e){var r=Math.sqrt(n*n+e*e),i=t(r),u=Math.sin(i),o=Math.cos(i);return[Math.atan2(n*u,r*o),Math.asin(r&&e*u/r)]},e}function Se(n,t){function e(n,t){o>0?-Io+Uo>t&&(t=-Io+Uo):t>Io-Uo&&(t=Io-Uo);var e=o/Math.pow(i(t),u);return[e*Math.sin(u*n),o-e*Math.cos(u*n)]}var r=Math.cos(n),i=function(n){return Math.tan(Fo/4+n/2)},u=n===t?Math.sin(n):Math.log(r/Math.cos(t))/Math.log(i(t)/i(n)),o=r*Math.pow(i(n),u)/u;return u?(e.invert=function(n,t){var e=o-t,r=K(u)*Math.sqrt(n*n+e*e);return[Math.atan2(n,e)/u,2*Math.atan(Math.pow(o/r,1/u))-Io]},e):Ne}function ke(n,t){function e(n,t){var e=u-t;return[e*Math.sin(i*n),u-e*Math.cos(i*n)]}var r=Math.cos(n),i=n===t?Math.sin(n):(r-Math.cos(t))/(t-n),u=r/i+n;return xo(i)<Uo?ce:(e.invert=function(n,t){var e=u-t;return[Math.atan2(n,e)/i,u-K(i)*Math.sqrt(n*n+e*e)]},e)}function Ne(n,t){return[n,Math.log(Math.tan(Fo/4+t/2))]}function Ee(n){var t,e=oe(n),r=e.scale,i=e.translate,u=e.clipExtent;return e.scale=function(){var n=r.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.translate=function(){var n=i.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.clipExtent=function(n){var o=u.apply(e,arguments);if(o===e){if(t=null==n){var a=Fo*r(),l=i();u([[l[0]-a,l[1]-a],[l[0]+a,l[1]+a]])}}else t&&(o=null);return o},e.clipExtent(null)}function Ae(n,t){return[Math.log(Math.tan(Fo/4+t/2)),-n]}function Ce(n){return n[0]}function ze(n){return n[1]}function Le(n){for(var t=n.length,e=[0,1],r=2,i=2;t>i;i++){for(;r>1&&Q(n[e[r-2]],n[e[r-1]],n[i])<=0;)--r;e[r++]=i}return e.slice(0,r)}function qe(n,t){return n[0]-t[0]||n[1]-t[1]}function Te(n,t,e){return(e[0]-t[0])*(n[1]-t[1])<(e[1]-t[1])*(n[0]-t[0])}function Re(n,t,e,r){var i=n[0],u=e[0],o=t[0]-i,a=r[0]-u,l=n[1],c=e[1],f=t[1]-l,s=r[1]-c,h=(a*(l-c)-s*(i-u))/(s*o-a*f);return[i+h*o,l+h*f]}function De(n){var t=n[0],e=n[n.length-1];return!(t[0]-e[0]||t[1]-e[1])}function Ue(n){var t=cl.pop()||new function(){rr(this),this.edge=this.site=this.circle=null};return t.site=n,t}function je(n){Be(n),ol.remove(n),cl.push(n),rr(n)}function Fe(n){var t=n.circle,e=t.x,r=t.cy,i={x:e,y:r},u=n.P,o=n.N,a=[n];je(n);for(var l=u;l.circle&&xo(e-l.circle.x)<Uo&&xo(r-l.circle.cy)<Uo;)u=l.P,a.unshift(l),je(l),l=u;a.unshift(l),Be(l);for(var c=o;c.circle&&xo(e-c.circle.x)<Uo&&xo(r-c.circle.cy)<Uo;)o=c.N,a.push(c),je(c),c=o;a.push(c),Be(c);var f,s=a.length;for(f=1;s>f;++f)c=a[f],l=a[f-1],nr(c.edge,l.site,c.site,i);l=a[0],(c=a[s-1]).edge=Ke(l.site,c.site,null,i),$e(l),$e(c)}function He(n){for(var t,e,r,i,u=n.x,o=n.y,a=ol._;a;)if((r=Oe(a,o)-u)>Uo)a=a.L;else{if(!((i=u-function(n,t){var e=n.N;if(e)return Oe(e,t);var r=n.site;return r.y===t?r.x:1/0}(a,o))>Uo)){r>-Uo?(t=a.P,e=a):i>-Uo?(t=a,e=a.N):t=e=a;break}if(!a.R){t=a;break}a=a.R}var l=Ue(n);if(ol.insert(t,l),t||e){if(t===e)return Be(t),e=Ue(t.site),ol.insert(l,e),l.edge=e.edge=Ke(t.site,l.site),$e(t),void $e(e);if(!e)return void(l.edge=Ke(t.site,l.site));Be(t),Be(e);var c=t.site,f=c.x,s=c.y,h=n.x-f,p=n.y-s,g=e.site,v=g.x-f,d=g.y-s,y=2*(h*d-p*v),m=h*h+p*p,M=v*v+d*d,x={x:(d*m-p*M)/y+f,y:(h*M-v*m)/y+s};nr(e.edge,c,g,x),l.edge=Ke(c,n,null,x),e.edge=Ke(n,g,null,x),$e(t),$e(e)}}function Oe(n,t){var e=n.site,r=e.x,i=e.y,u=i-t;if(!u)return r;var o=n.P;if(!o)return-1/0;var a=(e=o.site).x,l=e.y,c=l-t;if(!c)return a;var f=a-r,s=1/u-1/c,h=f/c;return s?(-h+Math.sqrt(h*h-2*s*(f*f/(-2*c)-l+c/2+i-u/2)))/s+r:(r+a)/2}function Ye(n){this.site=n,this.edges=[]}function Ze(n){for(var t,e,r,i,u,o,a,l,c,f,s=n[0][0],h=n[1][0],p=n[0][1],g=n[1][1],v=ul,d=v.length;d--;)if((u=v[d])&&u.prepare())for(a=u.edges,l=a.length,o=0;l>o;)f=a[o].end(),r=f.x,i=f.y,c=a[++o%l].start(),t=c.x,e=c.y,(xo(r-t)>Uo||xo(i-e)>Uo)&&(a.splice(o,0,new tr(function(n,t,e){var r=new Ge(n,null);return r.a=t,r.b=e,il.push(r),r}(u.site,f,xo(r-s)<Uo&&g-i>Uo?{x:s,y:xo(t-s)<Uo?e:g}:xo(i-g)<Uo&&h-r>Uo?{x:xo(e-g)<Uo?t:h,y:g}:xo(r-h)<Uo&&i-p>Uo?{x:h,y:xo(t-h)<Uo?e:p}:xo(i-p)<Uo&&r-s>Uo?{x:xo(e-p)<Uo?t:s,y:p}:null),u.site,null)),++l)}function Ve(n,t){return t.angle-n.angle}function $e(n){var t=n.P,e=n.N;if(t&&e){var r=t.site,i=n.site,u=e.site;if(r!==u){var o=i.x,a=i.y,l=r.x-o,c=r.y-a,f=u.x-o,h=2*(l*(s=u.y-a)-c*f);if(!(h>=-jo)){var p=l*l+c*c,g=f*f+s*s,v=(s*p-c*g)/h,d=(l*g-f*p)/h,s=d+a,y=fl.pop()||new function(){rr(this),this.x=this.y=this.arc=this.site=this.cy=null};y.arc=n,y.site=i,y.x=v+o,y.y=s+Math.sqrt(v*v+d*d),y.cy=s,n.circle=y;for(var m=null,M=ll._;M;)if(y.y<M.y||y.y===M.y&&y.x<=M.x){if(!M.L){m=M.P;break}M=M.L}else{if(!M.R){m=M;break}M=M.R}ll.insert(m,y),m||(al=y)}}}}function Be(n){var t=n.circle;t&&(t.P||(al=t.N),ll.remove(t),fl.push(t),rr(t),n.circle=null)}function Ge(n,t){this.l=n,this.r=t,this.a=this.b=null}function Ke(n,t,e,r){var i=new Ge(n,t);return il.push(i),e&&nr(i,n,t,e),r&&nr(i,t,n,r),ul[n.i].edges.push(new tr(i,n,t)),ul[t.i].edges.push(new tr(i,t,n)),i}function nr(n,t,e,r){n.a||n.b?n.l===e?n.b=r:n.a=r:(n.a=r,n.l=t,n.r=e)}function tr(n,t,e){var r=n.a,i=n.b;this.edge=n,this.site=t,this.angle=e?Math.atan2(e.y-t.y,e.x-t.x):n.l===t?Math.atan2(i.x-r.x,r.y-i.y):Math.atan2(r.x-i.x,i.y-r.y)}function er(){this._=null}function rr(n){n.U=n.C=n.L=n.R=n.P=n.N=null}function ir(n,t){var e=t,r=t.R,i=e.U;i?i.L===e?i.L=r:i.R=r:n._=r,r.U=i,e.U=r,e.R=r.L,e.R&&(e.R.U=e),r.L=e}function ur(n,t){var e=t,r=t.L,i=e.U;i?i.L===e?i.L=r:i.R=r:n._=r,r.U=i,e.U=r,e.L=r.R,e.L&&(e.L.U=e),r.R=e}function or(n){for(;n.L;)n=n.L;return n}function ar(n,t){var e,r,i,u=n.sort(lr).pop();for(il=[],ul=new Array(n.length),ol=new er,ll=new er;;)if(i=al,u&&(!i||u.y<i.y||u.y===i.y&&u.x<i.x))u.x===e&&u.y===r||(ul[u.i]=new Ye(u),He(u),e=u.x,r=u.y),u=n.pop();else{if(!i)break;Fe(i.arc)}t&&(function(n){for(var t,e=il,r=Yt(n[0][0],n[0][1],n[1][0],n[1][1]),i=e.length;i--;)t=e[i],(!function(n,t){var e=n.b;if(e)return!0;var r,i,u=n.a,o=t[0][0],a=t[1][0],l=t[0][1],c=t[1][1],f=n.l,s=n.r,h=f.x,p=f.y,g=s.x,v=s.y,d=(h+g)/2,y=(p+v)/2;if(v===p){if(o>d||d>=a)return;if(h>g){if(u){if(u.y>=c)return}else u={x:d,y:l};e={x:d,y:c}}else{if(u){if(u.y<l)return}else u={x:d,y:c};e={x:d,y:l}}}else if(r=(h-g)/(v-p),i=y-r*d,-1>r||r>1)if(h>g){if(u){if(u.y>=c)return}else u={x:(l-i)/r,y:l};e={x:(c-i)/r,y:c}}else{if(u){if(u.y<l)return}else u={x:(c-i)/r,y:c};e={x:(l-i)/r,y:l}}else if(v>p){if(u){if(u.x>=a)return}else u={x:o,y:r*o+i};e={x:a,y:r*a+i}}else{if(u){if(u.x<o)return}else u={x:a,y:r*a+i};e={x:o,y:r*o+i}}return n.a=u,n.b=e,!0}(t,n)||!r(t)||xo(t.a.x-t.b.x)<Uo&&xo(t.a.y-t.b.y)<Uo)&&(t.a=t.b=null,e.splice(i,1))}(t),Ze(t));var o={cells:ul,edges:il};return ol=ll=il=ul=null,o}function lr(n,t){return t.y-n.y||t.x-n.x}function cr(n,t,e){return(n.x-e.x)*(t.y-n.y)-(n.x-t.x)*(e.y-n.y)}function fr(n){return n.x}function sr(n){return n.y}function pr(n,t,e,r,i,u){if(!n(t,e,r,i,u)){var o=.5*(e+i),a=.5*(r+u),l=t.nodes;l[0]&&pr(n,l[0],e,r,o,a),l[1]&&pr(n,l[1],o,r,i,a),l[2]&&pr(n,l[2],e,a,o,u),l[3]&&pr(n,l[3],o,a,i,u)}}function vr(n,t){n=ao.rgb(n),t=ao.rgb(t);var e=n.r,r=n.g,i=n.b,u=t.r-e,o=t.g-r,a=t.b-i;return function(n){return"#"+bn(Math.round(e+u*n))+bn(Math.round(r+o*n))+bn(Math.round(i+a*n))}}function dr(n,t){var e,r={},i={};for(e in n)e in t?r[e]=Mr(n[e],t[e]):i[e]=n[e];for(e in t)e in n||(i[e]=t[e]);return function(n){for(e in r)i[e]=r[e](n);return i}}function yr(n,t){return n=+n,t=+t,function(e){return n*(1-e)+t*e}}function mr(n,t){var e,r,i,u=hl.lastIndex=pl.lastIndex=0,o=-1,a=[],l=[];for(n+="",t+="";(e=hl.exec(n))&&(r=pl.exec(t));)(i=r.index)>u&&(i=t.slice(u,i),a[o]?a[o]+=i:a[++o]=i),(e=e[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:yr(e,r)})),u=pl.lastIndex;return u<t.length&&(i=t.slice(u),a[o]?a[o]+=i:a[++o]=i),a.length<2?l[0]?(t=l[0].x,function(n){return t(n)+""}):function(){return t}:(t=l.length,function(n){for(var e,r=0;t>r;++r)a[(e=l[r]).i]=e.x(n);return a.join("")})}function Mr(n,t){for(var e,r=ao.interpolators.length;--r>=0&&!(e=ao.interpolators[r](n,t)););return e}function xr(n,t){var e,r=[],i=[],u=n.length,o=t.length,a=Math.min(n.length,t.length);for(e=0;a>e;++e)r.push(Mr(n[e],t[e]));for(;u>e;++e)i[e]=n[e];for(;o>e;++e)i[e]=t[e];return function(n){for(e=0;a>e;++e)i[e]=r[e](n);return i}}function _r(n){return function(t){return 1-n(1-t)}}function wr(n){return function(t){return.5*(.5>t?n(2*t):2-n(2-2*t))}}function Sr(n){return n*n}function kr(n){return n*n*n}function Ar(n){return 1-Math.cos(n*Io)}function Cr(n){return Math.pow(2,10*(n-1))}function zr(n){return 1-Math.sqrt(1-n*n)}function Tr(n){return 1/2.75>n?7.5625*n*n:2/2.75>n?7.5625*(n-=1.5/2.75)*n+.75:2.5/2.75>n?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}function Ur(n,t){return t-=n,function(e){return Math.round(n+t*e)}}function jr(n){var t=[n.a,n.b],e=[n.c,n.d],r=Hr(t),i=Fr(t,e),u=Hr(function(n,t,e){return n[0]+=e*t[0],n[1]+=e*t[1],n}(e,t,-i))||0;t[0]*e[1]<e[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-e[0],e[1]))*Zo,this.translate=[n.e,n.f],this.scale=[r,u],this.skew=u?Math.atan2(i,u)*Zo:0}function Fr(n,t){return n[0]*t[0]+n[1]*t[1]}function Hr(n){var t=Math.sqrt(Fr(n,n));return t&&(n[0]/=t,n[1]/=t),t}function Ir(n){return n.length?n.pop()+",":""}function $r(n,t){var e=[],r=[];return n=ao.transform(n),t=ao.transform(t),function(n,t,e,r){if(n[0]!==t[0]||n[1]!==t[1]){var i=e.push("translate(",null,",",null,")");r.push({i:i-4,x:yr(n[0],t[0])},{i:i-2,x:yr(n[1],t[1])})}else(t[0]||t[1])&&e.push("translate("+t+")")}(n.translate,t.translate,e,r),function(n,t,e,r){n!==t?(n-t>180?t+=360:t-n>180&&(n+=360),r.push({i:e.push(Ir(e)+"rotate(",null,")")-2,x:yr(n,t)})):t&&e.push(Ir(e)+"rotate("+t+")")}(n.rotate,t.rotate,e,r),function(n,t,e,r){n!==t?r.push({i:e.push(Ir(e)+"skewX(",null,")")-2,x:yr(n,t)}):t&&e.push(Ir(e)+"skewX("+t+")")}(n.skew,t.skew,e,r),function(n,t,e,r){if(n[0]!==t[0]||n[1]!==t[1]){var i=e.push(Ir(e)+"scale(",null,",",null,")");r.push({i:i-4,x:yr(n[0],t[0])},{i:i-2,x:yr(n[1],t[1])})}else 1===t[0]&&1===t[1]||e.push(Ir(e)+"scale("+t+")")}(n.scale,t.scale,e,r),n=t=null,function(n){for(var t,i=-1,u=r.length;++i<u;)e[(t=r[i]).i]=t.x(n);return e.join("")}}function Jr(n){for(var t=n.source,e=n.target,r=function(n,t){if(n===t)return n;for(var e=Gr(n),r=Gr(t),i=e.pop(),u=r.pop(),o=null;i===u;)o=i,i=e.pop(),u=r.pop();return o}(t,e),i=[t];t!==r;)t=t.parent,i.push(t);for(var u=i.length;e!==r;)i.splice(u,0,e),e=e.parent;return i}function Gr(n){for(var t=[],e=n.parent;null!=e;)t.push(n),n=e,e=e.parent;return t.push(n),t}function Qr(n){n.fixed|=2}function ni(n){n.fixed&=-7}function ti(n){n.fixed|=4,n.px=n.x,n.py=n.y}function ei(n){n.fixed&=-5}function ri(n,t,e){var r=0,i=0;if(n.charge=0,!n.leaf)for(var u,o=n.nodes,a=o.length,l=-1;++l<a;)null!=(u=o[l])&&(ri(u,t,e),n.charge+=u.charge,r+=u.charge*u.cx,i+=u.charge*u.cy);if(n.point){n.leaf||(n.point.x+=Math.random()-.5,n.point.y+=Math.random()-.5);var c=t*e[n.point.index];n.charge+=n.pointCharge=c,r+=c*n.point.x,i+=c*n.point.y}n.cx=r/n.charge,n.cy=i/n.charge}function ii(n,t){return ao.rebind(n,t,"sort","children","value"),n.nodes=n,n.links=fi,n}function ui(n,t){for(var e=[n];null!=(n=e.pop());)if(t(n),(i=n.children)&&(r=i.length))for(var r,i;--r>=0;)e.push(i[r])}function oi(n,t){for(var e=[n],r=[];null!=(n=e.pop());)if(r.push(n),(u=n.children)&&(i=u.length))for(var i,u,o=-1;++o<i;)e.push(u[o]);for(;null!=(n=r.pop());)t(n)}function ai(n){return n.children}function li(n){return n.value}function ci(n,t){return t.value-n.value}function fi(n){return ao.merge(n.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t}})}))}function si(n){return n.x}function hi(n){return n.y}function pi(n,t,e){n.y0=t,n.y=e}function gi(n){return ao.range(n.length)}function vi(n){for(var t=-1,e=n[0].length,r=[];++t<e;)r[t]=0;return r}function di(n){for(var t,e=1,r=0,i=n[0][1],u=n.length;u>e;++e)(t=n[e][1])>i&&(r=e,i=t);return r}function yi(n){return n.reduce(mi,0)}function mi(n,t){return n+t[1]}function Mi(n,t){return xi(n,Math.ceil(Math.log(t.length)/Math.LN2+1))}function xi(n,t){for(var e=-1,r=+n[0],i=(n[1]-r)/t,u=[];++e<=t;)u[e]=i*e+r;return u}function bi(n){return[ao.min(n),ao.max(n)]}function _i(n,t){return n.value-t.value}function wi(n,t){var e=n._pack_next;n._pack_next=t,t._pack_prev=n,t._pack_next=e,e._pack_prev=t}function Si(n,t){n._pack_next=t,t._pack_prev=n}function ki(n,t){var e=t.x-n.x,r=t.y-n.y,i=n.r+t.r;return.999*i*i>e*e+r*r}function Ni(n){function t(n){f=Math.min(n.x-n.r,f),s=Math.max(n.x+n.r,s),h=Math.min(n.y-n.r,h),p=Math.max(n.y+n.r,p)}if((e=n.children)&&(c=e.length)){var e,r,i,u,o,a,l,c,f=1/0,s=-1/0,h=1/0,p=-1/0;if(e.forEach(Ei),r=e[0],r.x=-r.r,r.y=0,t(r),c>1&&(i=e[1],i.x=i.r,i.y=0,t(i),c>2))for(u=e[2],zi(r,i,u),t(u),wi(r,u),r._pack_prev=u,wi(u,i),i=r._pack_next,o=3;c>o;o++){zi(r,i,u=e[o]);var g=0,v=1,d=1;for(a=i._pack_next;a!==i;a=a._pack_next,v++)if(ki(a,u)){g=1;break}if(1==g)for(l=r._pack_prev;l!==a._pack_prev&&!ki(l,u);l=l._pack_prev,d++);g?(d>v||v==d&&i.r<r.r?Si(r,i=a):Si(r=l,i),o--):(wi(r,u),i=u,t(u))}var y=(f+s)/2,m=(h+p)/2,M=0;for(o=0;c>o;o++)u=e[o],u.x-=y,u.y-=m,M=Math.max(M,u.r+Math.sqrt(u.x*u.x+u.y*u.y));n.r=M,e.forEach(Ai)}}function Ei(n){n._pack_next=n._pack_prev=n}function Ai(n){delete n._pack_next,delete n._pack_prev}function Ci(n,t,e,r){var i=n.children;if(n.x=t+=r*n.x,n.y=e+=r*n.y,n.r*=r,i)for(var u=-1,o=i.length;++u<o;)Ci(i[u],t,e,r)}function zi(n,t,e){var r=n.r+e.r,i=t.x-n.x,u=t.y-n.y;if(r&&(i||u)){var o=t.r+e.r,a=i*i+u*u,l=.5+((r*=r)-(o*=o))/(2*a),c=Math.sqrt(Math.max(0,2*o*(r+a)-(r-=a)*r-o*o))/(2*a);e.x=n.x+l*i+c*u,e.y=n.y+l*u-c*i}else e.x=n.x+r,e.y=n.y}function Li(n,t){return n.parent==t.parent?1:2}function qi(n){var t=n.children;return t.length?t[0]:n.t}function Ti(n){var t,e=n.children;return(t=e.length)?e[t-1]:n.t}function Ri(n,t,e){var r=e/(t.i-n.i);t.c-=r,t.s+=e,n.c+=r,t.z+=e,t.m+=e}function Pi(n,t,e){return n.a.parent===t.parent?n.a:e}function Fi(n){var t=n.children;return t&&t.length?Fi(t[0]):n}function Hi(n){var t,e=n.children;return e&&(t=e.length)?Hi(e[t-1]):n}function Oi(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function Ii(n,t){var e=n.x+t[3],r=n.y+t[0],i=n.dx-t[1]-t[3],u=n.dy-t[0]-t[2];return 0>i&&(e+=i/2,i=0),0>u&&(r+=u/2,u=0),{x:e,y:r,dx:i,dy:u}}function Yi(n){var t=n[0],e=n[n.length-1];return e>t?[t,e]:[e,t]}function Zi(n){return n.rangeExtent?n.rangeExtent():Yi(n.range())}function Xi(n,t){var e,r=0,i=n.length-1,u=n[r],o=n[i];return u>o&&(e=r,r=i,i=e,e=u,u=o,o=e),n[r]=t.floor(u),n[i]=t.ceil(o),n}function $i(n){return n?{floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}}:Sl}function Wi(n,t,e,r){function i(){var i=Math.min(n.length,t.length)>2?function(n,t,e,r){var i=[],u=[],o=0,a=Math.min(n.length,t.length)-1;for(n[a]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<=a;)i.push(e(n[o-1],n[o])),u.push(r(t[o-1],t[o]));return function(t){var e=ao.bisect(n,t,1,a)-1;return u[e](i[e](t))}}:function(n,t,e,r){var i=e(n[0],n[1]),u=r(t[0],t[1]);return function(n){return u(i(n))}},l=r?function(n,t){return t=(t-=n=+n)||1/t,function(e){return Math.max(0,Math.min(1,(e-n)/t))}}:function(n,t){return t=(t-=n=+n)||1/t,function(e){return(e-n)/t}};return o=i(n,t,l,e),a=i(t,n,l,Mr),u}function u(n){return o(n)}var o,a;return u.invert=function(n){return a(n)},u.domain=function(t){return arguments.length?(n=t.map(Number),i()):n},u.range=function(n){return arguments.length?(t=n,i()):t},u.rangeRound=function(n){return u.range(n).interpolate(Ur)},u.clamp=function(n){return arguments.length?(r=n,i()):r},u.interpolate=function(n){return arguments.length?(e=n,i()):e},u.ticks=function(t){return Qi(n,t)},u.tickFormat=function(t,e){return nu(n,t,e)},u.nice=function(t){return Gi(n,t),i()},u.copy=function(){return Wi(n,t,e,r)},i()}function Ji(n,t){return ao.rebind(n,t,"range","rangeRound","interpolate","clamp")}function Gi(n,t){return Xi(n,$i(Ki(n,t)[2])),Xi(n,$i(Ki(n,t)[2])),n}function Ki(n,t){null==t&&(t=10);var e=Yi(n),r=e[1]-e[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),u=t/r*i;return.15>=u?i*=10:.35>=u?i*=5:.75>=u&&(i*=2),e[0]=Math.ceil(e[0]/i)*i,e[1]=Math.floor(e[1]/i)*i+.5*i,e[2]=i,e}function Qi(n,t){return ao.range.apply(ao,Ki(n,t))}function nu(n,t,e){var r=Ki(n,t);if(e){var i=ha.exec(e);if(i.shift(),"s"===i[8]){var u=ao.formatPrefix(Math.max(xo(r[0]),xo(r[1])));return i[7]||(i[7]="."+tu(u.scale(r[2]))),i[8]="f",e=ao.format(i.join("")),function(n){return e(u.scale(n))+u.symbol}}i[7]||(i[7]="."+function(n,t){var e=tu(t[2]);return n in kl?Math.abs(e-tu(Math.max(xo(t[0]),xo(t[1]))))+ +("e"!==n):e-2*("%"===n)}(i[8],r)),e=i.join("")}else e=",."+tu(r[2])+"f";return ao.format(e)}function tu(n){return-Math.floor(Math.log(n)/Math.LN10+.01)}function ru(n,t,e,r){function i(n){return(e?Math.log(0>n?0:n):-Math.log(n>0?0:-n))/Math.log(t)}function u(n){return e?Math.pow(t,n):-Math.pow(t,-n)}function o(t){return n(i(t))}return o.invert=function(t){return u(n.invert(t))},o.domain=function(t){return arguments.length?(e=t[0]>=0,n.domain((r=t.map(Number)).map(i)),o):r},o.base=function(e){return arguments.length?(t=+e,n.domain(r.map(i)),o):t},o.nice=function(){var t=Xi(r.map(i),e?Math:El);return n.domain(t),r=t.map(u),o},o.ticks=function(){var n=Yi(r),o=[],a=n[0],l=n[1],c=Math.floor(i(a)),f=Math.ceil(i(l)),s=t%1?2:t;if(isFinite(f-c)){if(e){for(;f>c;c++)for(h=1;s>h;h++)o.push(u(c)*h);o.push(u(c))}else for(o.push(u(c));c++<f;)for(var h=s-1;h>0;h--)o.push(u(c)*h);for(c=0;o[c]<a;c++);for(f=o.length;o[f-1]>l;f--);o=o.slice(c,f)}return o},o.tickFormat=function(n,e){if(!arguments.length)return Nl;arguments.length<2?e=Nl:"function"!=typeof e&&(e=ao.format(e));var r=Math.max(1,t*n/o.ticks().length);return function(n){var o=n/u(Math.round(i(n)));return t-.5>o*t&&(o*=t),r>=o?e(n):""}},o.copy=function(){return ru(n.copy(),t,e,r)},Ji(o,n)}function iu(n,t,e){function r(t){return n(i(t))}var i=uu(t),u=uu(1/t);return r.invert=function(t){return u(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain((e=t.map(Number)).map(i)),r):e},r.ticks=function(n){return Qi(e,n)},r.tickFormat=function(n,t){return nu(e,n,t)},r.nice=function(n){return r.domain(Gi(e,n))},r.exponent=function(o){return arguments.length?(i=uu(t=o),u=uu(1/t),n.domain(e.map(i)),r):t},r.copy=function(){return iu(n.copy(),t,e)},Ji(r,n)}function uu(n){return function(t){return 0>t?-Math.pow(-t,n):Math.pow(t,n)}}function ou(n,t){function e(e){return u[((i.get(e)||("range"===t.t?i.set(e,n.push(e)):NaN))-1)%u.length]}function r(t,e){return ao.range(n.length).map(function(n){return t+e*n})}var i,u,o;return e.domain=function(r){if(!arguments.length)return n;n=[],i=new c;for(var u,o=-1,a=r.length;++o<a;)i.has(u=r[o])||i.set(u,n.push(u));return e[t.t].apply(e,t.a)},e.range=function(n){return arguments.length?(u=n,o=0,t={t:"range",a:arguments},e):u},e.rangePoints=function(i,a){arguments.length<2&&(a=0);var l=i[0],c=i[1],f=n.length<2?(l=(l+c)/2,0):(c-l)/(n.length-1+a);return u=r(l+f*a/2,f),o=0,t={t:"rangePoints",a:arguments},e},e.rangeRoundPoints=function(i,a){arguments.length<2&&(a=0);var l=i[0],c=i[1],f=n.length<2?(l=c=Math.round((l+c)/2),0):(c-l)/(n.length-1+a)|0;return u=r(l+Math.round(f*a/2+(c-l-(n.length-1+a)*f)/2),f),o=0,t={t:"rangeRoundPoints",a:arguments},e},e.rangeBands=function(i,a,l){arguments.length<2&&(a=0),arguments.length<3&&(l=a);var c=i[1]<i[0],f=i[c-0],h=(i[1-c]-f)/(n.length-a+2*l);return u=r(f+h*l,h),c&&u.reverse(),o=h*(1-a),t={t:"rangeBands",a:arguments},e},e.rangeRoundBands=function(i,a,l){arguments.length<2&&(a=0),arguments.length<3&&(l=a);var c=i[1]<i[0],f=i[c-0],s=i[1-c],h=Math.floor((s-f)/(n.length-a+2*l));return u=r(f+Math.round((s-f-(n.length-a)*h)/2),h),c&&u.reverse(),o=Math.round(h*(1-a)),t={t:"rangeRoundBands",a:arguments},e},e.rangeBand=function(){return o},e.rangeExtent=function(){return Yi(t.a[0])},e.copy=function(){return ou(n,t)},e.domain(n)}function au(n,t){function u(){var e=0,r=t.length;for(a=[];++e<r;)a[e-1]=ao.quantile(n,e/r);return o}function o(n){return isNaN(n=+n)?void 0:t[ao.bisect(a,n)]}var a;return o.domain=function(t){return arguments.length?(n=t.map(r).filter(i).sort(e),u()):n},o.range=function(n){return arguments.length?(t=n,u()):t},o.quantiles=function(){return a},o.invertExtent=function(e){return 0>(e=t.indexOf(e))?[NaN,NaN]:[e>0?a[e-1]:n[0],e<a.length?a[e]:n[n.length-1]]},o.copy=function(){return au(n,t)},u()}function lu(n,t,e){function r(t){return e[Math.max(0,Math.min(o,Math.floor(u*(t-n))))]}function i(){return u=e.length/(t-n),o=e.length-1,r}var u,o;return r.domain=function(e){return arguments.length?(n=+e[0],t=+e[e.length-1],i()):[n,t]},r.range=function(n){return arguments.length?(e=n,i()):e},r.invertExtent=function(t){return t=e.indexOf(t),t=0>t?NaN:t/u+n,[t,t+1/u]},r.copy=function(){return lu(n,t,e)},i()}function cu(n,t){function e(e){return e>=e?t[ao.bisect(n,e)]:void 0}return e.domain=function(t){return arguments.length?(n=t,e):n},e.range=function(n){return arguments.length?(t=n,e):t},e.invertExtent=function(e){return e=t.indexOf(e),[n[e-1],n[e]]},e.copy=function(){return cu(n,t)},e}function fu(n){function t(n){return+n}return t.invert=t,t.domain=t.range=function(e){return arguments.length?(n=e.map(t),t):n},t.ticks=function(t){return Qi(n,t)},t.tickFormat=function(t,e){return nu(n,t,e)},t.copy=function(){return fu(n)},t}function su(){return 0}function hu(n){return n.innerRadius}function pu(n){return n.outerRadius}function gu(n){return n.startAngle}function vu(n){return n.endAngle}function du(n){return n&&n.padAngle}function yu(n,t,e,r){return(n-e)*t-(t-r)*n>0?0:1}function mu(n,t,e,r,i){var u=n[0]-t[0],o=n[1]-t[1],a=(i?r:-r)/Math.sqrt(u*u+o*o),l=a*o,c=-a*u,f=n[0]+l,s=n[1]+c,h=t[0]+l,p=t[1]+c,g=(f+h)/2,v=(s+p)/2,d=h-f,y=p-s,m=d*d+y*y,M=e-r,x=f*p-h*s,b=(0>y?-1:1)*Math.sqrt(Math.max(0,M*M*m-x*x)),_=(x*y-d*b)/m,w=(-x*d-y*b)/m,S=(x*y+d*b)/m,k=(-x*d+y*b)/m,N=_-g,E=w-v,A=S-g,C=k-v;return N*N+E*E>A*A+C*C&&(_=S,w=k),[[_-l,w-c],[_*e/M,w*e/M]]}function Mu(n){function t(t){function o(){c.push("M",u(n(f),a))}for(var l,c=[],f=[],s=-1,h=t.length,p=En(e),g=En(r);++s<h;)i.call(this,l=t[s],s)?f.push([+p.call(this,l,s),+g.call(this,l,s)]):f.length&&(o(),f=[]);return f.length&&o(),c.length?c.join(""):null}var e=Ce,r=ze,i=zt,u=xu,o=u.key,a=.7;return t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t.defined=function(n){return arguments.length?(i=n,t):i},t.interpolate=function(n){return arguments.length?(o="function"==typeof n?u=n:(u=Tl.get(n)||xu).key,t):o},t.tension=function(n){return arguments.length?(a=n,t):a},t}function xu(n){return n.length>1?n.join("L"):n+"Z"}function bu(n){return n.join("L")+"Z"}function wu(n){for(var t=0,e=n.length,r=n[0],i=[r[0],",",r[1]];++t<e;)i.push("V",(r=n[t])[1],"H",r[0]);return i.join("")}function Su(n){for(var t=0,e=n.length,r=n[0],i=[r[0],",",r[1]];++t<e;)i.push("H",(r=n[t])[0],"V",r[1]);return i.join("")}function Au(n,t){if(t.length<1||n.length!=t.length&&n.length!=t.length+2)return xu(n);var e=n.length!=t.length,r="",i=n[0],u=n[1],o=t[0],a=o,l=1;if(e&&(r+="Q"+(u[0]-2*o[0]/3)+","+(u[1]-2*o[1]/3)+","+u[0]+","+u[1],i=n[1],l=2),t.length>1){a=t[1],u=n[l],l++,r+="C"+(i[0]+o[0])+","+(i[1]+o[1])+","+(u[0]-a[0])+","+(u[1]-a[1])+","+u[0]+","+u[1];for(var c=2;c<t.length;c++,l++)u=n[l],a=t[c],r+="S"+(u[0]-a[0])+","+(u[1]-a[1])+","+u[0]+","+u[1]}if(e){var f=n[l];r+="Q"+(u[0]+2*a[0]/3)+","+(u[1]+2*a[1]/3)+","+f[0]+","+f[1]}return r}function Cu(n,t){for(var e,r=[],i=(1-t)/2,u=n[0],o=n[1],a=1,l=n.length;++a<l;)e=u,u=o,o=n[a],r.push([i*(o[0]-e[0]),i*(o[1]-e[1])]);return r}function zu(n){if(n.length<3)return xu(n);var t=1,e=n.length,r=n[0],i=r[0],u=r[1],o=[i,i,i,(r=n[1])[0]],a=[u,u,u,r[1]],l=[i,",",u,"L",Ru(Pl,o),",",Ru(Pl,a)];for(n.push(n[e-1]);++t<=e;)r=n[t],o.shift(),o.push(r[0]),a.shift(),a.push(r[1]),Du(l,o,a);return n.pop(),l.push("L",r),l.join("")}function Ru(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function Du(n,t,e){n.push("C",Ru(Rl,t),",",Ru(Rl,e),",",Ru(Dl,t),",",Ru(Dl,e),",",Ru(Pl,t),",",Ru(Pl,e))}function Pu(n,t){return(t[1]-n[1])/(t[0]-n[0])}function ju(n){for(var t,e,r,i,u=[],o=function(n){for(var t=0,e=n.length-1,r=[],i=n[0],u=n[1],o=r[0]=Pu(i,u);++t<e;)r[t]=(o+(o=Pu(i=u,u=n[t+1])))/2;return r[t]=o,r}(n),a=-1,l=n.length-1;++a<l;)t=Pu(n[a],n[a+1]),xo(t)<Uo?o[a]=o[a+1]=0:(e=o[a]/t,r=o[a+1]/t,(i=e*e+r*r)>9&&(i=3*t/Math.sqrt(i),o[a]=i*e,o[a+1]=i*r));for(a=-1;++a<=l;)i=(n[Math.min(l,a+1)][0]-n[Math.max(0,a-1)][0])/(6*(1+o[a]*o[a])),u.push([i||0,o[a]*i||0]);return u}function Hu(n){for(var t,e,r,i=-1,u=n.length;++i<u;)t=n[i],e=t[0],r=t[1]-Io,t[0]=e*Math.cos(r),t[1]=e*Math.sin(r);return n}function Ou(n){function t(t){function l(){v.push("M",a(n(y),s),f,c(n(d.reverse()),s),"Z")}for(var h,p,g,v=[],d=[],y=[],m=-1,M=t.length,x=En(e),b=En(i),_=e===r?function(){return p}:En(r),w=i===u?function(){return g}:En(u);++m<M;)o.call(this,h=t[m],m)?(d.push([p=+x.call(this,h,m),g=+b.call(this,h,m)]),y.push([+_.call(this,h,m),+w.call(this,h,m)])):d.length&&(l(),d=[],y=[]);return d.length&&l(),v.length?v.join(""):null}var e=Ce,r=Ce,i=0,u=ze,o=zt,a=xu,l=a.key,c=a,f="L",s=.7;return t.x=function(n){return arguments.length?(e=r=n,t):r},t.x0=function(n){return arguments.length?(e=n,t):e},t.x1=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(i=u=n,t):u},t.y0=function(n){return arguments.length?(i=n,t):i},t.y1=function(n){return arguments.length?(u=n,t):u},t.defined=function(n){return arguments.length?(o=n,t):o},t.interpolate=function(n){return arguments.length?(l="function"==typeof n?a=n:(a=Tl.get(n)||xu).key,c=a.reverse||a,f=a.closed?"M":"L",t):l},t.tension=function(n){return arguments.length?(s=n,t):s},t}function Iu(n){return n.radius}function Yu(n){return[n.x,n.y]}function Vu(){return 64}function Xu(){return"circle"}function $u(n){var t=Math.sqrt(n/Fo);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Bu(n){return function(){var t,e,r;(t=this[n])&&(r=t[e=t.active])&&(r.timer.c=null,r.timer.t=NaN,--t.count?delete t[e]:delete this[n],t.active+=.5,r.event&&r.event.interrupt.call(this,this.__data__,r.index))}}function Wu(n,t,e){return ko(n,Yl),n.namespace=t,n.id=e,n}function Ju(n,t,e,r){var i=n.id,u=n.namespace;return Y(n,"function"==typeof e?function(n,o,a){n[u][i].tween.set(t,r(e.call(n,n.__data__,o,a)))}:(e=r(e),function(n){n[u][i].tween.set(t,e)}))}function Gu(n){return null==n&&(n=""),function(){this.textContent=n}}function Ku(n){return null==n?"__transition__":"__transition_"+n+"__"}function Qu(n,t,e,r,i){function o(e){var i=g.active,u=g[i];u&&(u.timer.c=null,u.timer.t=NaN,--g.count,delete g[i],u.event&&u.event.interrupt.call(n,n.__data__,u.index));for(var o in g)if(r>+o){var c=g[o];c.timer.c=null,c.timer.t=NaN,--g.count,delete g[o]}f.c=a,qn(function(){return f.c&&a(e||1)&&(f.c=null,f.t=NaN),1},0,l),g.active=r,v.event&&v.event.start.call(n,n.__data__,t),p=[],v.tween.forEach(function(e,r){(r=r.call(n,n.__data__,t))&&p.push(r)}),h=v.ease,s=v.duration}function a(i){for(var u=i/s,o=h(u),a=p.length;a>0;)p[--a].call(n,o);return u>=1?(v.event&&v.event.end.call(n,n.__data__,t),--g.count?delete g[r]:delete n[e],1):void 0}var l,f,s,h,p,g=n[e]||(n[e]={active:0,count:0}),v=g[r];v||(l=i.time,f=qn(function(n){var t=v.delay;return f.t=t+l,n>=t?o(n-t):void(f.c=o)},0,l),v=g[r]={tween:new c,time:l,timer:f,delay:i.delay,duration:i.duration,ease:i.ease,index:t},i=null,++g.count)}function no(n,t,e){n.attr("transform",function(n){var r=t(n);return"translate("+(isFinite(r)?r:e(n))+",0)"})}function to(n,t,e){n.attr("transform",function(n){var r=t(n);return"translate(0,"+(isFinite(r)?r:e(n))+")"})}function eo(n){return n.toISOString()}function ro(n,t,e){function r(t){return n(t)}function i(n,e){var i=(n[1]-n[0])/e,u=ao.bisect(Kl,i);return u==Kl.length?[t.year,Ki(n.map(function(n){return n/31536e6}),e)[2]]:u?t[i/Kl[u-1]<Kl[u]/i?u-1:u]:[tc,Ki(n,e)[2]]}return r.invert=function(t){return io(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain(t),r):n.domain().map(io)},r.nice=function(n,t){function e(e){return!isNaN(e)&&!n.range(e,io(+e+1),t).length}var u=r.domain(),o=Yi(u),a=null==n?i(o,10):"number"==typeof n&&i(o,n);return a&&(n=a[0],t=a[1]),r.domain(Xi(u,t>1?{floor:function(t){for(;e(t=n.floor(t));)t=io(t-1);return t},ceil:function(t){for(;e(t=n.ceil(t));)t=io(+t+1);return t}}:n))},r.ticks=function(n,t){var e=Yi(r.domain()),u=null==n?i(e,10):"number"==typeof n?i(e,n):!n.range&&[{range:n},t];return u&&(n=u[0],t=u[1]),n.range(e[0],io(+e[1]+1),1>t?1:t)},r.tickFormat=function(){return e},r.copy=function(){return ro(n.copy(),t,e)},Ji(r,n)}function io(n){return new Date(n)}function uo(n){return JSON.parse(n.responseText)}function oo(n){var t=fo.createRange();return t.selectNode(fo.body),t.createContextualFragment(n.responseText)}var ao={version:"3.5.17"},lo=[].slice,co=function(n){return lo.call(n)},fo=this.document;if(fo)try{co(fo.documentElement.childNodes)[0].nodeType}catch(so){co=function(n){for(var t=n.length,e=new Array(t);t--;)e[t]=n[t];return e}}if(Date.now||(Date.now=function(){return+new Date}),fo)try{fo.createElement("DIV").style.setProperty("opacity",0,"")}catch(ho){var po=this.Element.prototype,go=po.setAttribute,vo=po.setAttributeNS,yo=this.CSSStyleDeclaration.prototype,mo=yo.setProperty;po.setAttribute=function(n,t){go.call(this,n,t+"")},po.setAttributeNS=function(n,t,e){vo.call(this,n,t,e+"")},yo.setProperty=function(n,t,e){mo.call(this,n,t+"",e)}}ao.ascending=e,ao.descending=function(n,t){return n>t?-1:t>n?1:t>=n?0:NaN},ao.min=function(n,t){var e,r,i=-1,u=n.length;if(1===arguments.length){for(;++i<u;)if(null!=(r=n[i])&&r>=r){e=r;break}for(;++i<u;)null!=(r=n[i])&&e>r&&(e=r)}else{for(;++i<u;)if(null!=(r=t.call(n,n[i],i))&&r>=r){e=r;break}for(;++i<u;)null!=(r=t.call(n,n[i],i))&&e>r&&(e=r)}return e},ao.max=function(n,t){var e,r,i=-1,u=n.length;if(1===arguments.length){for(;++i<u;)if(null!=(r=n[i])&&r>=r){e=r;break}for(;++i<u;)null!=(r=n[i])&&r>e&&(e=r)}else{for(;++i<u;)if(null!=(r=t.call(n,n[i],i))&&r>=r){e=r;break}for(;++i<u;)null!=(r=t.call(n,n[i],i))&&r>e&&(e=r)}return e},ao.extent=function(n,t){var e,r,i,u=-1,o=n.length;if(1===arguments.length){for(;++u<o;)if(null!=(r=n[u])&&r>=r){e=i=r;break}for(;++u<o;)null!=(r=n[u])&&(e>r&&(e=r),r>i&&(i=r))}else{for(;++u<o;)if(null!=(r=t.call(n,n[u],u))&&r>=r){e=i=r;break}for(;++u<o;)null!=(r=t.call(n,n[u],u))&&(e>r&&(e=r),r>i&&(i=r))}return[e,i]},ao.sum=function(n,t){var e,r=0,u=n.length,o=-1;if(1===arguments.length)for(;++o<u;)i(e=+n[o])&&(r+=e);else for(;++o<u;)i(e=+t.call(n,n[o],o))&&(r+=e);return r},ao.mean=function(n,t){var e,u=0,o=n.length,a=-1,l=o;if(1===arguments.length)for(;++a<o;)i(e=r(n[a]))?u+=e:--l;else for(;++a<o;)i(e=r(t.call(n,n[a],a)))?u+=e:--l;return l?u/l:void 0},ao.quantile=function(n,t){var e=(n.length-1)*t+1,r=Math.floor(e),i=+n[r-1],u=e-r;return u?i+u*(n[r]-i):i},ao.median=function(n,t){var u,o=[],a=n.length,l=-1;if(1===arguments.length)for(;++l<a;)i(u=r(n[l]))&&o.push(u);else for(;++l<a;)i(u=r(t.call(n,n[l],l)))&&o.push(u);return o.length?ao.quantile(o.sort(e),.5):void 0},ao.variance=function(n,t){var e,u,o=n.length,a=0,l=0,c=-1,f=0;if(1===arguments.length)for(;++c<o;)i(e=r(n[c]))&&(u=e-a,a+=u/++f,l+=u*(e-a));else for(;++c<o;)i(e=r(t.call(n,n[c],c)))&&(u=e-a,a+=u/++f,l+=u*(e-a));return f>1?l/(f-1):void 0},ao.deviation=function(){var n=ao.variance.apply(this,arguments);return n?Math.sqrt(n):n};var Mo=u(e);ao.bisectLeft=Mo.left,ao.bisect=ao.bisectRight=Mo.right,ao.bisector=function(n){return u(1===n.length?function(t,r){return e(n(t),r)}:n)},ao.shuffle=function(n,t,e){(u=arguments.length)<3&&(e=n.length,2>u&&(t=0));for(var r,i,u=e-t;u;)i=Math.random()*u--|0,r=n[u+t],n[u+t]=n[i+t],n[i+t]=r;return n},ao.permute=function(n,t){for(var e=t.length,r=new Array(e);e--;)r[e]=n[t[e]];return r},ao.pairs=function(n){for(var e=0,r=n.length-1,i=n[0],u=new Array(0>r?0:r);r>e;)u[e]=[i,i=n[++e]];return u},ao.transpose=function(n){if(!(i=n.length))return[];for(var t=-1,e=ao.min(n,o),r=new Array(e);++t<e;)for(var i,u=-1,a=r[t]=new Array(i);++u<i;)a[u]=n[u][t];return r},ao.zip=function(){return ao.transpose(arguments)},ao.keys=function(n){var t=[];for(var e in n)t.push(e);return t},ao.values=function(n){var t=[];for(var e in n)t.push(n[e]);return t},ao.entries=function(n){var t=[];for(var e in n)t.push({key:e,value:n[e]});return t},ao.merge=function(n){for(var t,e,r,i=n.length,u=-1,o=0;++u<i;)o+=n[u].length;for(e=new Array(o);--i>=0;)for(r=n[i],t=r.length;--t>=0;)e[--o]=r[t];return e};var xo=Math.abs;ao.range=function(n,t,e){if(arguments.length<3&&(e=1,arguments.length<2&&(t=n,n=0)),(t-n)/e==1/0)throw new Error("infinite range");var r,i=[],u=function(n){for(var t=1;n*t%1;)t*=10;return t}(xo(e)),o=-1;if(n*=u,t*=u,0>(e*=u))for(;(r=n+e*++o)>t;)i.push(r/u);else for(;(r=n+e*++o)<t;)i.push(r/u);return i},ao.map=function(n,t){var e=new c;if(n instanceof c)n.forEach(function(n,t){e.set(n,t)});else if(Array.isArray(n)){var r,i=-1,u=n.length;if(1===arguments.length)for(;++i<u;)e.set(i,n[i]);else for(;++i<u;)e.set(t.call(n,r=n[i],i),r)}else for(var o in n)e.set(o,n[o]);return e};var bo="__proto__",_o="\0";l(c,{has:h,get:function(n){return this._[f(n)]},set:function(n,t){return this._[f(n)]=t},remove:p,keys:g,values:function(){var n=[];for(var t in this._)n.push(this._[t]);return n},entries:function(){var n=[];for(var t in this._)n.push({key:s(t),value:this._[t]});return n},size:v,empty:d,forEach:function(n){for(var t in this._)n.call(this,s(t),this._[t])}}),ao.nest=function(){function n(t,o,a){if(a>=u.length)return r?r.call(i,o):e?o.sort(e):o;for(var l,f,s,h,p=-1,g=o.length,v=u[a++],d=new c;++p<g;)(h=d.get(l=v(f=o[p])))?h.push(f):d.set(l,[f]);return t?(f=t(),s=function(e,r){f.set(e,n(t,r,a))}):(f={},s=function(e,r){f[e]=n(t,r,a)}),d.forEach(s),f}function t(n,e){if(e>=u.length)return n;var r=[],i=o[e++];return n.forEach(function(n,i){r.push({key:n,values:t(i,e)})}),i?r.sort(function(n,t){return i(n.key,t.key)}):r}var e,r,i={},u=[],o=[];return i.map=function(t,e){return n(e,t,0)},i.entries=function(e){return t(n(ao.map,e,0),0)},i.key=function(n){return u.push(n),i},i.sortKeys=function(n){return o[u.length-1]=n,i},i.sortValues=function(n){return e=n,i},i.rollup=function(n){return r=n,i},i},ao.set=function(n){var t=new y;if(n)for(var e=0,r=n.length;r>e;++e)t.add(n[e]);return t},l(y,{has:h,add:function(n){return this._[f(n+="")]=!0,n},remove:p,values:g,size:v,empty:d,forEach:function(n){for(var t in this._)n.call(this,s(t))}}),ao.behavior={},ao.rebind=function(n,t){for(var e,r=1,i=arguments.length;++r<i;)n[e=arguments[r]]=M(n,t,t[e]);return n};var wo=["webkit","ms","moz","Moz","o","O"];ao.dispatch=function(){for(var n=new _,t=-1,e=arguments.length;++t<e;)n[arguments[t]]=w(n);return n},_.prototype.on=function(n,t){var e=n.indexOf("."),r="";if(e>=0&&(r=n.slice(e+1),n=n.slice(0,e)),n)return arguments.length<2?this[n].on(r):this[n].on(r,t);if(2===arguments.length){if(null==t)for(n in this)this.hasOwnProperty(n)&&this[n].on(r,null);return this}},ao.event=null,ao.requote=function(n){return n.replace(So,"\\$&")};var So=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,ko={}.__proto__?function(n,t){n.__proto__=t}:function(n,t){for(var e in t)n[e]=t[e]},No=function(n,t){return t.querySelector(n)},Eo=function(n,t){return t.querySelectorAll(n)},Ao=function(n,t){var e=n.matches||n[x(n,"matchesSelector")];return(Ao=function(n,t){return e.call(n,t)})(n,t)};"function"==typeof Sizzle&&(No=function(n,t){return Sizzle(n,t)[0]||null},Eo=Sizzle,Ao=Sizzle.matchesSelector),ao.selection=function(){return ao.select(fo.documentElement)};var Co=ao.selection.prototype=[];Co.select=function(n){var t,e,r,i,u=[];n=A(n);for(var o=-1,a=this.length;++o<a;){u.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var l=-1,c=r.length;++l<c;)(i=r[l])?(t.push(e=n.call(i,i.__data__,l,o)),e&&"__data__"in i&&(e.__data__=i.__data__)):t.push(null)}return E(u)},Co.selectAll=function(n){var t,e,r=[];n=C(n);for(var i=-1,u=this.length;++i<u;)for(var o=this[i],a=-1,l=o.length;++a<l;)(e=o[a])&&(r.push(t=co(n.call(e,e.__data__,a,i))),t.parentNode=e);return E(r)};var zo="http://www.w3.org/1999/xhtml",Lo={svg:"http://www.w3.org/2000/svg",xhtml:zo,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};ao.ns={prefix:Lo,qualify:function(n){var t=n.indexOf(":"),e=n;return t>=0&&"xmlns"!==(e=n.slice(0,t))&&(n=n.slice(t+1)),Lo.hasOwnProperty(e)?{space:Lo[e],local:n}:n}},Co.attr=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node();return(n=ao.ns.qualify(n)).local?e.getAttributeNS(n.space,n.local):e.getAttribute(n)}for(t in n)this.each(z(t,n[t]));return this}return this.each(z(n,t))},Co.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node(),r=(n=T(n)).length,i=-1;if(t=e.classList){for(;++i<r;)if(!t.contains(n[i]))return!1}else for(t=e.getAttribute("class");++i<r;)if(!q(n[i]).test(t))return!1;return!0}for(t in n)this.each(R(t,n[t]));return this}return this.each(R(n,t))},Co.style=function(n,e,r){var i=arguments.length;if(3>i){if("string"!=typeof n){2>i&&(e="");for(r in n)this.each(P(r,n[r],e));return this}if(2>i){var u=this.node();return t(u).getComputedStyle(u,null).getPropertyValue(n)}r=""}return this.each(P(n,e,r))},Co.property=function(n,t){if(arguments.length<2){if("string"==typeof n)return this.node()[n];for(t in n)this.each(U(t,n[t]));return this}return this.each(U(n,t))},Co.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.textContent=null==t?"":t}:null==n?function(){this.textContent=""}:function(){this.textContent=n}):this.node().textContent},Co.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.innerHTML=null==t?"":t}:null==n?function(){this.innerHTML=""}:function(){this.innerHTML=n}):this.node().innerHTML},Co.append=function(n){return n=j(n),this.select(function(){return this.appendChild(n.apply(this,arguments))})},Co.insert=function(n,t){return n=j(n),t=A(t),this.select(function(){return this.insertBefore(n.apply(this,arguments),t.apply(this,arguments)||null)})},Co.remove=function(){return this.each(F)},Co.data=function(n,t){function e(n,e){var r,i,u,o=n.length,s=e.length,h=Math.min(o,s),p=new Array(s),g=new Array(s),v=new Array(o);if(t){var d,y=new c,m=new Array(o);for(r=-1;++r<o;)(i=n[r])&&(y.has(d=t.call(i,i.__data__,r))?v[r]=i:y.set(d,i),m[r]=d);for(r=-1;++r<s;)(i=y.get(d=t.call(e,u=e[r],r)))?!0!==i&&(p[r]=i,i.__data__=u):g[r]=H(u),y.set(d,!0);for(r=-1;++r<o;)r in m&&!0!==y.get(m[r])&&(v[r]=n[r])}else{for(r=-1;++r<h;)i=n[r],u=e[r],i?(i.__data__=u,p[r]=i):g[r]=H(u);for(;s>r;++r)g[r]=H(e[r]);for(;o>r;++r)v[r]=n[r]}g.update=p,g.parentNode=p.parentNode=v.parentNode=n.parentNode,a.push(g),l.push(p),f.push(v)}var r,i,u=-1,o=this.length;if(!arguments.length){for(n=new Array(o=(r=this[0]).length);++u<o;)(i=r[u])&&(n[u]=i.__data__);return n}var a=Z([]),l=E([]),f=E([]);if("function"==typeof n)for(;++u<o;)e(r=this[u],n.call(r,r.parentNode.__data__,u));else for(;++u<o;)e(r=this[u],n);return l.enter=function(){return a},l.exit=function(){return f},l},Co.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__")},Co.filter=function(n){var t,e,r,i=[];"function"!=typeof n&&(n=O(n));for(var u=0,o=this.length;o>u;u++){i.push(t=[]),t.parentNode=(e=this[u]).parentNode;for(var a=0,l=e.length;l>a;a++)(r=e[a])&&n.call(r,r.__data__,a,u)&&t.push(r)}return E(i)},Co.order=function(){for(var n=-1,t=this.length;++n<t;)for(var e,r=this[n],i=r.length-1,u=r[i];--i>=0;)(e=r[i])&&(u&&u!==e.nextSibling&&u.parentNode.insertBefore(e,u),u=e);return this},Co.sort=function(n){n=I.apply(this,arguments);for(var t=-1,e=this.length;++t<e;)this[t].sort(n);return this.order()},Co.each=function(n){return Y(this,function(t,e,r){n.call(t,t.__data__,e,r)})},Co.call=function(n){var t=co(arguments);return n.apply(t[0]=this,t),this},Co.empty=function(){return!this.node()},Co.node=function(){for(var n=0,t=this.length;t>n;n++)for(var e=this[n],r=0,i=e.length;i>r;r++){var u=e[r];if(u)return u}return null},Co.size=function(){var n=0;return Y(this,function(){++n}),n};var qo=[];ao.selection.enter=Z,ao.selection.enter.prototype=qo,qo.append=Co.append,qo.empty=Co.empty,qo.node=Co.node,qo.call=Co.call,qo.size=Co.size,qo.select=function(n){for(var t,e,r,i,u,o=[],a=-1,l=this.length;++a<l;){r=(i=this[a]).update,o.push(t=[]),t.parentNode=i.parentNode;for(var c=-1,f=i.length;++c<f;)(u=i[c])?(t.push(r[c]=e=n.call(i.parentNode,u.__data__,c,a)),e.__data__=u.__data__):t.push(null)}return E(o)},qo.insert=function(n,t){return arguments.length<2&&(t=function(n){var t,e;return function(r,i,u){var o,a=n[u].update,l=a.length;for(u!=e&&(e=u,t=0),i>=t&&(t=i+1);!(o=a[t])&&++t<l;);return o}}(this)),Co.insert.call(this,n,t)},ao.select=function(t){var e;return"string"==typeof t?(e=[No(t,fo)],e.parentNode=fo.documentElement):(e=[t],e.parentNode=n(t)),E([e])},ao.selectAll=function(n){var t;return"string"==typeof n?(t=co(Eo(n,fo)),t.parentNode=fo.documentElement):(t=co(n),t.parentNode=null),E([t])},Co.on=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t=!1);for(e in n)this.each(X(e,n[e],t));return this}if(2>r)return(r=this.node()["__on"+n])&&r._;e=!1}return this.each(X(n,t,e))};var To=ao.map({mouseenter:"mouseover",mouseleave:"mouseout"});fo&&To.forEach(function(n){"on"+n in fo&&To.remove(n)});var Ro,Do=0;ao.mouse=function(n){return J(n,k())};var Po=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;ao.touch=function(n,t,e){if(arguments.length<3&&(e=t,t=k().changedTouches),t)for(var r,i=0,u=t.length;u>i;++i)if((r=t[i]).identifier===e)return J(n,r)},ao.behavior.drag=function(){function n(){this.on("mousedown.drag",u).on("touchstart.drag",o)}function e(n,t,e,u,o){return function(){var c,f=this,s=ao.event.target.correspondingElement||ao.event.target,h=f.parentNode,p=r.of(f,arguments),g=0,v=n(),d=".drag"+(null==v?"":"-"+v),y=ao.select(e(s)).on(u+d,function(){var n,e,r=t(h,v);r&&(n=r[0]-M[0],e=r[1]-M[1],g|=n|e,M=r,p({type:"drag",x:r[0]+c[0],y:r[1]+c[1],dx:n,dy:e}))}).on(o+d,function(){t(h,v)&&(y.on(u+d,null).on(o+d,null),m(g),p({type:"dragend"}))}),m=W(s),M=t(h,v);i?(c=i.apply(f,arguments),c=[c.x-M[0],c.y-M[1]]):c=[0,0],p({type:"dragstart"})}}var r=N(n,"drag","dragstart","dragend"),i=null,u=e(b,ao.mouse,t,"mousemove","mouseup"),o=e(G,ao.touch,m,"touchmove","touchend");return n.origin=function(t){return arguments.length?(i=t,n):i},ao.rebind(n,r,"on")},ao.touches=function(n,t){return arguments.length<2&&(t=k().touches),t?co(t).map(function(t){var e=J(n,t);return e.identifier=t.identifier,e}):[]};var Uo=1e-6,jo=Uo*Uo,Fo=Math.PI,Ho=2*Fo,Oo=Ho-Uo,Io=Fo/2,Yo=Fo/180,Zo=180/Fo,Vo=Math.SQRT2;ao.interpolateZoom=function(n,t){var e,r,i=n[0],u=n[1],o=n[2],a=t[0],l=t[1],c=t[2],f=a-i,s=l-u,h=f*f+s*s;if(jo>h)r=Math.log(c/o)/Vo,e=function(n){return[i+n*f,u+n*s,o*Math.exp(Vo*n*r)]};else{var p=Math.sqrt(h),g=(c*c-o*o+4*h)/(2*o*2*p),v=(c*c-o*o-4*h)/(2*c*2*p),d=Math.log(Math.sqrt(g*g+1)-g),y=Math.log(Math.sqrt(v*v+1)-v);r=(y-d)/Vo,e=function(n){var t=n*r,e=rn(d),a=o/(2*p)*(e*function(n){return((n=Math.exp(2*n))-1)/(n+1)}(Vo*t+d)-function(n){return((n=Math.exp(n))-1/n)/2}(d));return[i+a*f,u+a*s,o*e/rn(Vo*t+d)]}}return e.duration=1e3*r,e},ao.behavior.zoom=function(){function n(n){n.on(L,s).on(Wo+".zoom",p).on("dblclick.zoom",g).on(R,h)}function e(n){return[(n[0]-k.x)/k.k,(n[1]-k.y)/k.k]}function i(n){k.k=Math.max(A[0],Math.min(A[1],n))}function u(n,t){t=function(n){return[n[0]*k.k+k.x,n[1]*k.k+k.y]}(t),k.x+=n[0]-t[0],k.y+=n[1]-t[1]}function o(t,e,r,o){t.__chart__={x:k.x,y:k.y,k:k.k},i(Math.pow(2,o)),u(d=e,r),t=ao.select(t),C>0&&(t=t.transition().duration(C)),t.call(n.event)}function a(){b&&b.domain(x.range().map(function(n){return(n-k.x)/k.k}).map(x.invert)),w&&w.domain(_.range().map(function(n){return(n-k.y)/k.k}).map(_.invert))}function l(n){z++||n({type:"zoomstart"})}function c(n){a(),n({type:"zoom",scale:k.k,translate:[k.x,k.y]})}function f(n){--z||(n({type:"zoomend"}),d=null)}function s(){var i=this,o=D.of(i,arguments),a=0,s=ao.select(t(i)).on(q,function(){a=1,u(ao.mouse(i),h),c(o)}).on(T,function(){s.on(q,null).on(T,null),p(a),f(o)}),h=e(ao.mouse(i)),p=W(i);Il.call(i),l(o)}function h(){function n(){var n=ao.touches(g);return p=k.k,n.forEach(function(n){n.identifier in d&&(d[n.identifier]=e(n))}),n}function t(){var t=ao.event.target;ao.select(t).on(x,r).on(b,a),_.push(t);for(var e=ao.event.changedTouches,i=0,u=e.length;u>i;++i)d[e[i].identifier]=null;var l=n(),c=Date.now();if(1===l.length){if(500>c-M){f=l[0];o(g,f,d[f.identifier],Math.floor(Math.log(k.k)/Math.LN2)+1),S()}M=c}else if(l.length>1){var f=l[0],s=l[1],h=f[0]-s[0],p=f[1]-s[1];y=h*h+p*p}}function r(){var n,t,e,r,o=ao.touches(g);Il.call(g);for(var a=0,l=o.length;l>a;++a,r=null)if(e=o[a],r=d[e.identifier]){if(t)break;n=e,t=r}if(r){var f=(f=e[0]-n[0])*f+(f=e[1]-n[1])*f,s=y&&Math.sqrt(f/y);n=[(n[0]+e[0])/2,(n[1]+e[1])/2],t=[(t[0]+r[0])/2,(t[1]+r[1])/2],i(s*p)}M=null,u(n,t),c(v)}function a(){if(ao.event.touches.length){for(var t=ao.event.changedTouches,e=0,r=t.length;r>e;++e)delete d[t[e].identifier];for(var i in d)return void n()}ao.selectAll(_).on(m,null),w.on(L,s).on(R,h),N(),f(v)}var p,g=this,v=D.of(g,arguments),d={},y=0,m=".zoom-"+ao.event.changedTouches[0].identifier,x="touchmove"+m,b="touchend"+m,_=[],w=ao.select(g),N=W(g);t(),l(v),w.on(L,null).on(R,t)}function p(){var n=D.of(this,arguments);m?clearTimeout(m):(Il.call(this),v=e(d=y||ao.mouse(this)),l(n)),m=setTimeout(function(){m=null,f(n)},50),S(),i(Math.pow(2,.002*Bo())*k.k),u(d,v),c(n)}function g(){var n=ao.mouse(this),t=Math.log(k.k)/Math.LN2;o(this,n,e(n),ao.event.shiftKey?Math.ceil(t)-1:Math.floor(t)+1)}var v,d,y,m,M,x,b,_,w,k={x:0,y:0,k:1},E=[960,500],A=Jo,C=250,z=0,L="mousedown.zoom",q="mousemove.zoom",T="mouseup.zoom",R="touchstart.zoom",D=N(n,"zoomstart","zoom","zoomend");return Wo||(Wo="onwheel"in fo?(Bo=function(){return-ao.event.deltaY*(ao.event.deltaMode?120:1)},"wheel"):"onmousewheel"in fo?(Bo=function(){return ao.event.wheelDelta},"mousewheel"):(Bo=function(){return-ao.event.detail},"MozMousePixelScroll")),n.event=function(n){n.each(function(){var n=D.of(this,arguments),t=k;Hl?ao.select(this).transition().each("start.zoom",function(){k=this.__chart__||{x:0,y:0,k:1},l(n)}).tween("zoom:zoom",function(){var e=E[0],r=E[1],i=d?d[0]:e/2,u=d?d[1]:r/2,o=ao.interpolateZoom([(i-k.x)/k.k,(u-k.y)/k.k,e/k.k],[(i-t.x)/t.k,(u-t.y)/t.k,e/t.k]);return function(t){var r=o(t),a=e/r[2];this.__chart__=k={x:i-r[0]*a,y:u-r[1]*a,k:a},c(n)}}).each("interrupt.zoom",function(){f(n)}).each("end.zoom",function(){f(n)}):(this.__chart__=k,l(n),c(n),f(n))})},n.translate=function(t){return arguments.length?(k={x:+t[0],y:+t[1],k:k.k},a(),n):[k.x,k.y]},n.scale=function(t){return arguments.length?(k={x:k.x,y:k.y,k:null},i(+t),a(),n):k.k},n.scaleExtent=function(t){return arguments.length?(A=null==t?Jo:[+t[0],+t[1]],n):A},n.center=function(t){return arguments.length?(y=t&&[+t[0],+t[1]],n):y},n.size=function(t){return arguments.length?(E=t&&[+t[0],+t[1]],n):E},n.duration=function(t){return arguments.length?(C=+t,n):C},n.x=function(t){return arguments.length?(b=t,x=t.copy(),k={x:0,y:0,k:1},n):b},n.y=function(t){return arguments.length?(w=t,_=t.copy(),k={x:0,y:0,k:1},n):w},ao.rebind(n,D,"on")};var Bo,Wo,Jo=[0,1/0];ao.color=an,an.prototype.toString=function(){return this.rgb()+""},ao.hsl=ln;var Go=ln.prototype=new an;Go.brighter=function(n){return n=Math.pow(.7,arguments.length?n:1),new ln(this.h,this.s,this.l/n)},Go.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),new ln(this.h,this.s,n*this.l)},Go.rgb=function(){return cn(this.h,this.s,this.l)},ao.hcl=fn;var Ko=fn.prototype=new an;Ko.brighter=function(n){return new fn(this.h,this.c,Math.min(100,this.l+Qo*(arguments.length?n:1)))},Ko.darker=function(n){return new fn(this.h,this.c,Math.max(0,this.l-Qo*(arguments.length?n:1)))},Ko.rgb=function(){return sn(this.h,this.c,this.l).rgb()},ao.lab=hn;var Qo=18,na=.95047,ta=1,ea=1.08883,ra=hn.prototype=new an;ra.brighter=function(n){return new hn(Math.min(100,this.l+Qo*(arguments.length?n:1)),this.a,this.b)},ra.darker=function(n){return new hn(Math.max(0,this.l-Qo*(arguments.length?n:1)),this.a,this.b)},ra.rgb=function(){return pn(this.l,this.a,this.b)},ao.rgb=mn;var ia=mn.prototype=new an;ia.brighter=function(n){n=Math.pow(.7,arguments.length?n:1);var t=this.r,e=this.g,r=this.b,i=30;return t||e||r?(t&&i>t&&(t=i),e&&i>e&&(e=i),r&&i>r&&(r=i),new mn(Math.min(255,t/n),Math.min(255,e/n),Math.min(255,r/n))):new mn(i,i,i)},ia.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),new mn(n*this.r,n*this.g,n*this.b)},ia.hsl=function(){return wn(this.r,this.g,this.b)},ia.toString=function(){return"#"+bn(this.r)+bn(this.g)+bn(this.b)};var ua=ao.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});ua.forEach(function(n,t){ua.set(n,Mn(t))}),ao.functor=En,ao.xhr=An(m),ao.dsv=function(n,t){function e(n,e,u){arguments.length<3&&(u=e,e=null);var o=Cn(n,t,null==e?r:i(e),u);return o.row=function(n){return arguments.length?o.response(null==(e=n)?r:i(n)):e},o}function r(n){return e.parse(n.responseText)}function i(n){return function(t){return e.parse(t.responseText,n)}}function u(t){return t.map(o).join(n)}function o(n){return a.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var a=new RegExp('["'+n+"\n]"),l=n.charCodeAt(0);return e.parse=function(n,t){var r;return e.parseRows(n,function(n,e){if(r)return r(n,e-1);var i=new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}");r=t?function(n,e){return t(i(n),e)}:i})},e.parseRows=function(n,t){function e(){if(f>=c)return o;if(i)return i=!1,u;var t=f;if(34===n.charCodeAt(t)){for(var e=t;e++<c;)if(34===n.charCodeAt(e)){if(34!==n.charCodeAt(e+1))break;++e}f=e+2;return 13===(r=n.charCodeAt(e+1))?(i=!0,10===n.charCodeAt(e+2)&&++f):10===r&&(i=!0),n.slice(t+1,e).replace(/""/g,'"')}for(;c>f;){var r=n.charCodeAt(f++),a=1;if(10===r)i=!0;else if(13===r)i=!0,10===n.charCodeAt(f)&&(++f,++a);else if(r!==l)continue;return n.slice(t,f-a)}return n.slice(t)}for(var r,i,u={},o={},a=[],c=n.length,f=0,s=0;(r=e())!==o;){for(var h=[];r!==u&&r!==o;)h.push(r),r=e();t&&null==(h=t(h,s++))||a.push(h)}return a},e.format=function(t){if(Array.isArray(t[0]))return e.formatRows(t);var r=new y,i=[];return t.forEach(function(n){for(var t in n)r.has(t)||i.push(r.add(t))}),[i.map(o).join(n)].concat(t.map(function(t){return i.map(function(n){return o(t[n])}).join(n)})).join("\n")},e.formatRows=function(n){return n.map(u).join("\n")},e},ao.csv=ao.dsv(",","text/csv"),ao.tsv=ao.dsv("\t","text/tab-separated-values");var oa,aa,la,ca,fa=this[x(this,"requestAnimationFrame")]||function(n){setTimeout(n,17)};ao.timer=function(){qn.apply(this,arguments)},ao.timer.flush=function(){Rn(),Dn()},ao.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n)};var sa=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(function(n,t){var e=Math.pow(10,3*xo(8-t));return{scale:t>8?function(n){return n/e}:function(n){return n*e},symbol:n}});ao.formatPrefix=function(n,t){var e=0;return(n=+n)&&(0>n&&(n*=-1),t&&(n=ao.round(n,Pn(n,t))),e=1+Math.floor(1e-12+Math.log(n)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((e-1)/3)))),sa[8+e/3]};var ha=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,pa=ao.map({b:function(n){return n.toString(2)},c:function(n){return String.fromCharCode(n)},o:function(n){return n.toString(8)},x:function(n){return n.toString(16)},X:function(n){return n.toString(16).toUpperCase()},g:function(n,t){return n.toPrecision(t)},e:function(n,t){return n.toExponential(t)},f:function(n,t){return n.toFixed(t)},r:function(n,t){return(n=ao.round(n,Pn(n,t))).toFixed(Math.max(0,Math.min(20,Pn(n*(1+1e-15),t))))}}),ga=ao.time={},va=Date;Hn.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){da.setUTCDate.apply(this._,arguments)},setDay:function(){da.setUTCDay.apply(this._,arguments)},setFullYear:function(){da.setUTCFullYear.apply(this._,arguments)},setHours:function(){da.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){da.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){da.setUTCMinutes.apply(this._,arguments)},setMonth:function(){da.setUTCMonth.apply(this._,arguments)},setSeconds:function(){da.setUTCSeconds.apply(this._,arguments)},setTime:function(){da.setTime.apply(this._,arguments)}};var da=Date.prototype;ga.year=On(function(n){return(n=ga.day(n)).setMonth(0,1),n},function(n,t){n.setFullYear(n.getFullYear()+t)},function(n){return n.getFullYear()}),ga.years=ga.year.range,ga.years.utc=ga.year.utc.range,ga.day=On(function(n){var t=new va(2e3,0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t},function(n,t){n.setDate(n.getDate()+t)},function(n){return n.getDate()-1}),ga.days=ga.day.range,ga.days.utc=ga.day.utc.range,ga.dayOfYear=function(n){var t=ga.year(n);return Math.floor((n-t-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(n,t){t=7-t;var e=ga[n]=On(function(n){return(n=ga.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n},function(n,t){n.setDate(n.getDate()+7*Math.floor(t))},function(n){var e=ga.year(n).getDay();return Math.floor((ga.dayOfYear(n)+(e+t)%7)/7)-(e!==t)});ga[n+"s"]=e.range,ga[n+"s"].utc=e.utc.range,ga[n+"OfYear"]=function(n){var e=ga.year(n).getDay();return Math.floor((ga.dayOfYear(n)+(e+t)%7)/7)}}),ga.week=ga.sunday,ga.weeks=ga.sunday.range,ga.weeks.utc=ga.sunday.utc.range,ga.weekOfYear=ga.sundayOfYear;var ya={"-":"",_:" ",0:"0"},ma=/^\s*\d+/,Ma=/^%/;ao.locale=function(n){return{numberFormat:function(n){var t=n.decimal,e=n.thousands,r=n.grouping,i=n.currency,u=r&&e?function(n,t){for(var i=n.length,u=[],o=0,a=r[0],l=0;i>0&&a>0&&(l+a+1>t&&(a=Math.max(1,t-l)),u.push(n.substring(i-=a,i+a)),!((l+=a+1)>t));)a=r[o=(o+1)%r.length];return u.reverse().join(e)}:m;return function(n){var e=ha.exec(n),r=e[1]||" ",o=e[2]||">",a=e[3]||"-",l=e[4]||"",c=e[5],f=+e[6],s=e[7],h=e[8],p=e[9],g=1,v="",d="",y=!1,m=!0;switch(h&&(h=+h.substring(1)),(c||"0"===r&&"="===o)&&(c=r="0",o="="),p){case"n":s=!0,p="g";break;case"%":g=100,d="%",p="f";break;case"p":g=100,d="%",p="r";break;case"b":case"o":case"x":case"X":"#"===l&&(v="0"+p.toLowerCase());case"c":m=!1;case"d":y=!0,h=0;break;case"s":g=-1,p="r"}"$"===l&&(v=i[0],d=i[1]),"r"!=p||h||(p="g"),null!=h&&("g"==p?h=Math.max(1,Math.min(21,h)):"e"!=p&&"f"!=p||(h=Math.max(0,Math.min(20,h)))),p=pa.get(p)||function(n){return n+""};var M=c&&s;return function(n){var e=d;if(y&&n%1)return"";var i=0>n||0===n&&0>1/n?(n=-n,"-"):"-"===a?"":a;if(0>g){var l=ao.formatPrefix(n,h);n=l.scale(n),e=l.symbol+d}else n*=g;var x,b,_=(n=p(n,h)).lastIndexOf(".");if(0>_){var w=m?n.lastIndexOf("e"):-1;0>w?(x=n,b=""):(x=n.substring(0,w),b=n.substring(w))}else x=n.substring(0,_),b=t+n.substring(_+1);!c&&s&&(x=u(x,1/0));var S=v.length+x.length+b.length+(M?0:i.length),k=f>S?new Array(S=f-S+1).join(r):"";return M&&(x=u(k+x,k.length?f-b.length:1/0)),i+=v,n=x+b,("<"===o?i+n+k:">"===o?k+i+n:"^"===o?k.substring(0,S>>=1)+i+n+k.substring(S):i+(M?n:k+n))+e}}}(n),timeFormat:function(n){function t(n){function t(t){for(var e,i,u,o=[],a=-1,l=0;++a<r;)37===n.charCodeAt(a)&&(o.push(n.slice(l,a)),null!=(i=ya[e=n.charAt(++a)])&&(e=n.charAt(++a)),(u=A[e])&&(e=u(t,null==i?"e"===e?" ":"0":i)),o.push(e),l=a+1);return o.push(n.slice(l,a)),o.join("")}var r=n.length;return t.parse=function(t){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(e(r,n,t,0)!=t.length)return null;"p"in r&&(r.H=r.H%12+12*r.p);var u=null!=r.Z&&va!==Hn,o=new(u?Hn:va);return"j"in r?o.setFullYear(r.y,0,r.j):"W"in r||"U"in r?("w"in r||(r.w="W"in r?1:0),o.setFullYear(r.y,0,1),o.setFullYear(r.y,0,"W"in r?(r.w+6)%7+7*r.W-(o.getDay()+5)%7:r.w+7*r.U-(o.getDay()+6)%7)):o.setFullYear(r.y,r.m,r.d),o.setHours(r.H+(r.Z/100|0),r.M+r.Z%100,r.S,r.L),u?o._:o},t.toString=function(){return n},t}function e(n,t,e,r){for(var i,u,o,a=0,l=t.length,c=e.length;l>a;){if(r>=c)return-1;if(37===(i=t.charCodeAt(a++))){if(o=t.charAt(a++),!(u=C[o in ya?t.charAt(a++):o])||(r=u(n,e,r))<0)return-1}else if(i!=e.charCodeAt(r++))return-1}return r}var s=n.dateTime,h=n.date,p=n.time,g=n.periods,v=n.days,d=n.shortDays,y=n.months,m=n.shortMonths;t.utc=function(n){function e(n){try{var t=new(va=Hn);return t._=n,r(t)}finally{va=Date}}var r=t(n);return e.parse=function(n){try{va=Hn;var t=r.parse(n);return t&&t._}finally{va=Date}},e.toString=r.toString,e},t.multi=t.utc.multi=ct;var M=ao.map(),x=Vn(v),b=Xn(v),_=Vn(d),w=Xn(d),S=Vn(y),k=Xn(y),N=Vn(m),E=Xn(m);g.forEach(function(n,t){M.set(n.toLowerCase(),t)});var A={a:function(n){return d[n.getDay()]},A:function(n){return v[n.getDay()]},b:function(n){return m[n.getMonth()]},B:function(n){return y[n.getMonth()]},c:t(s),d:function(n,t){return Zn(n.getDate(),t,2)},e:function(n,t){return Zn(n.getDate(),t,2)},H:function(n,t){return Zn(n.getHours(),t,2)},I:function(n,t){return Zn(n.getHours()%12||12,t,2)},j:function(n,t){return Zn(1+ga.dayOfYear(n),t,3)},L:function(n,t){return Zn(n.getMilliseconds(),t,3)},m:function(n,t){return Zn(n.getMonth()+1,t,2)},M:function(n,t){return Zn(n.getMinutes(),t,2)},p:function(n){return g[+(n.getHours()>=12)]},S:function(n,t){return Zn(n.getSeconds(),t,2)},U:function(n,t){return Zn(ga.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return Zn(ga.mondayOfYear(n),t,2)},x:t(h),X:t(p),y:function(n,t){return Zn(n.getFullYear()%100,t,2)},Y:function(n,t){return Zn(n.getFullYear()%1e4,t,4)},Z:at,"%":function(){return"%"}},C={a:function(n,t,e){_.lastIndex=0;var r=_.exec(t.slice(e));return r?(n.w=w.get(r[0].toLowerCase()),e+r[0].length):-1},A:function(n,t,e){x.lastIndex=0;var r=x.exec(t.slice(e));return r?(n.w=b.get(r[0].toLowerCase()),e+r[0].length):-1},b:function(n,t,e){N.lastIndex=0;var r=N.exec(t.slice(e));return r?(n.m=E.get(r[0].toLowerCase()),e+r[0].length):-1},B:function(n,t,e){S.lastIndex=0;var r=S.exec(t.slice(e));return r?(n.m=k.get(r[0].toLowerCase()),e+r[0].length):-1},c:function(n,t,r){return e(n,A.c.toString(),t,r)},d:tt,e:tt,H:rt,I:rt,j:et,L:ot,m:nt,M:it,p:function(n,t,e){var r=M.get(t.slice(e,e+=2).toLowerCase());return null==r?-1:(n.p=r,e)},S:ut,U:Bn,w:$n,W:Wn,x:function(n,t,r){return e(n,A.x.toString(),t,r)},X:function(n,t,r){return e(n,A.X.toString(),t,r)},y:Gn,Y:Jn,Z:Kn,"%":lt};return t}(n)}};var xa=ao.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});ao.format=xa.numberFormat,ao.geo={},ft.prototype={s:0,t:0,add:function(n){st(n,this.t,ba),st(ba.s,this.s,this),this.s?this.t+=ba.t:this.s=ba.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var ba=new ft;ao.geo.stream=function(n,t){n&&_a.hasOwnProperty(n.type)?_a[n.type](n,t):ht(n,t)};var _a={Feature:function(n,t){ht(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,i=e.length;++r<i;)ht(e[r].geometry,t)}},wa={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){pt(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)pt(e[r],t,0)},Polygon:function(n,t){gt(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)gt(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,i=e.length;++r<i;)ht(e[r],t)}};ao.geo.area=function(n){return Sa=0,ao.geo.stream(n,Na),Sa};var Sa,ka=new ft,Na={sphere:function(){Sa+=4*Fo},point:b,lineStart:b,lineEnd:b,polygonStart:function(){ka.reset(),Na.lineStart=vt},polygonEnd:function(){var n=2*ka;Sa+=0>n?4*Fo+n:n,Na.lineStart=Na.lineEnd=Na.point=b}};ao.geo.bounds=function(){function n(n,t){M.push(x=[f=n,h=n]),s>t&&(s=t),t>p&&(p=t)}function t(t,e){var r=dt([t*Yo,e*Yo]);if(y){var i=mt(y,r),o=mt([i[1],-i[0],0],i);bt(o),o=_t(o);var l=t-g,c=l>0?1:-1,v=o[0]*Zo*c,d=xo(l)>180;if(d^(v>c*g&&c*t>v)){(m=o[1]*Zo)>p&&(p=m)}else if(v=(v+360)%360-180,d^(v>c*g&&c*t>v)){var m=-o[1]*Zo;s>m&&(s=m)}else s>e&&(s=e),e>p&&(p=e);d?g>t?a(f,t)>a(f,h)&&(h=t):a(t,h)>a(f,h)&&(f=t):h>=f?(f>t&&(f=t),t>h&&(h=t)):t>g?a(f,t)>a(f,h)&&(h=t):a(t,h)>a(f,h)&&(f=t)}else n(t,e);y=r,g=t}function e(){b.point=t}function r(){x[0]=f,x[1]=h,b.point=n,y=null}function i(n,e){if(y){var r=n-g;m+=xo(r)>180?r+(r>0?360:-360):r}else v=n,d=e;Na.point(n,e),t(n,e)}function u(){Na.lineStart()}function o(){i(v,d),Na.lineEnd(),xo(m)>Uo&&(f=-(h=180)),x[0]=f,x[1]=h,y=null}function a(n,t){return(t-=n)<0?t+360:t}function l(n,t){return n[0]-t[0]}function c(n,t){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n}var f,s,h,p,g,v,d,y,m,M,x,b={point:n,lineStart:e,lineEnd:r,polygonStart:function(){b.point=i,b.lineStart=u,b.lineEnd=o,m=0,Na.polygonStart()},polygonEnd:function(){Na.polygonEnd(),b.point=n,b.lineStart=e,b.lineEnd=r,0>ka?(f=-(h=180),s=-(p=90)):m>Uo?p=90:-Uo>m&&(s=-90),x[0]=f,x[1]=h}};return function(n){p=h=-(f=s=1/0),M=[],ao.geo.stream(n,b);t=M.length;if(t){M.sort(l);for(var r=1,u=[i=M[0]];t>r;++r)e=M[r],c(e[0],i)||c(e[1],i)?(a(i[0],e[1])>a(i[0],i[1])&&(i[1]=e[1]),a(e[0],i[1])>a(i[0],i[1])&&(i[0]=e[0])):u.push(i=e);for(var o,e,t,g=-1/0,r=0,i=u[t=u.length-1];t>=r;i=e,++r)e=u[r],(o=a(i[1],e[0]))>g&&(g=o,f=e[0],h=i[1])}return M=x=null,f===1/0||s===1/0?[[NaN,NaN],[NaN,NaN]]:[[f,s],[h,p]]}}(),ao.geo.centroid=function(n){Ea=Aa=Ca=za=La=qa=Ta=Ra=Da=Pa=Ua=0,ao.geo.stream(n,ja);var t=Da,e=Pa,r=Ua,i=t*t+e*e+r*r;return jo>i&&(t=qa,e=Ta,r=Ra,Uo>Aa&&(t=Ca,e=za,r=La),i=t*t+e*e+r*r,jo>i)?[NaN,NaN]:[Math.atan2(e,t)*Zo,tn(r/Math.sqrt(i))*Zo]};var Ea,Aa,Ca,za,La,qa,Ta,Ra,Da,Pa,Ua,ja={sphere:b,point:St,lineStart:Nt,lineEnd:Et,polygonStart:function(){ja.lineStart=At},polygonEnd:function(){ja.lineStart=Nt}},Fa=Rt(zt,function(n){var t,e=NaN,r=NaN,i=NaN;return{lineStart:function(){n.lineStart(),t=1},point:function(u,o){var a=u>0?Fo:-Fo,l=xo(u-e);xo(l-Fo)<Uo?(n.point(e,r=(r+o)/2>0?Io:-Io),n.point(i,r),n.lineEnd(),n.lineStart(),n.point(a,r),n.point(u,r),t=0):i!==a&&l>=Fo&&(xo(e-i)<Uo&&(e-=i*Uo),xo(u-a)<Uo&&(u-=a*Uo),r=function(n,t,e,r){var i,u,o=Math.sin(n-e);return xo(o)>Uo?Math.atan((Math.sin(t)*(u=Math.cos(r))*Math.sin(e)-Math.sin(r)*(i=Math.cos(t))*Math.sin(n))/(i*u*o)):(t+r)/2}(e,r,u,o),n.point(i,r),n.lineEnd(),n.lineStart(),n.point(a,r),t=0),n.point(e=u,r=o),i=a},lineEnd:function(){n.lineEnd(),e=r=NaN},clean:function(){return 2-t}}},function(n,t,e,r){var i;if(null==n)i=e*Io,r.point(-Fo,i),r.point(0,i),r.point(Fo,i),r.point(Fo,0),r.point(Fo,-i),r.point(0,-i),r.point(-Fo,-i),r.point(-Fo,0),r.point(-Fo,i);else if(xo(n[0]-t[0])>Uo){var u=n[0]<t[0]?Fo:-Fo;i=e*u/2,r.point(-u,i),r.point(0,i),r.point(u,i)}else r.point(t[0],t[1])},[-Fo,-Fo/2]),Ha=1e9;ao.geo.clipExtent=function(){var n,t,e,r,i,u,o={stream:function(n){return i&&(i.valid=!1),i=u(n),i.valid=!0,i},extent:function(a){return arguments.length?(u=Zt(n=+a[0][0],t=+a[0][1],e=+a[1][0],r=+a[1][1]),i&&(i.valid=!1,i=null),o):[[n,t],[e,r]]}};return o.extent([[0,0],[960,500]])},(ao.geo.conicEqualArea=function(){return Vt(Xt)}).raw=Xt,ao.geo.albers=function(){return ao.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},ao.geo.albersUsa=function(){function n(n){var u=n[0],o=n[1];return t=null,e(u,o),t||(r(u,o),t)||i(u,o),t}var t,e,r,i,u=ao.geo.albers(),o=ao.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a=ao.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(n,e){t=[n,e]}};return n.invert=function(n){var t=u.scale(),e=u.translate(),r=(n[0]-e[0])/t,i=(n[1]-e[1])/t;return(i>=.12&&.234>i&&r>=-.425&&-.214>r?o:i>=.166&&.234>i&&r>=-.214&&-.115>r?a:u).invert(n)},n.stream=function(n){var t=u.stream(n),e=o.stream(n),r=a.stream(n);return{point:function(n,i){t.point(n,i),e.point(n,i),r.point(n,i)},sphere:function(){t.sphere(),e.sphere(),r.sphere()},lineStart:function(){t.lineStart(),e.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),e.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),e.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),e.polygonEnd(),r.polygonEnd()}}},n.precision=function(t){return arguments.length?(u.precision(t),o.precision(t),a.precision(t),n):u.precision()},n.scale=function(t){return arguments.length?(u.scale(t),o.scale(.35*t),a.scale(t),n.translate(u.translate())):u.scale()},n.translate=function(t){if(!arguments.length)return u.translate();var c=u.scale(),f=+t[0],s=+t[1];return e=u.translate(t).clipExtent([[f-.455*c,s-.238*c],[f+.455*c,s+.238*c]]).stream(l).point,r=o.translate([f-.307*c,s+.201*c]).clipExtent([[f-.425*c+Uo,s+.12*c+Uo],[f-.214*c-Uo,s+.234*c-Uo]]).stream(l).point,i=a.translate([f-.205*c,s+.212*c]).clipExtent([[f-.214*c+Uo,s+.166*c+Uo],[f-.115*c-Uo,s+.234*c-Uo]]).stream(l).point,n},n.scale(1070)};var Oa,Ia,Ya,Za,Va,Xa,$a={point:b,lineStart:b,lineEnd:b,polygonStart:function(){Ia=0,$a.lineStart=$t},polygonEnd:function(){$a.lineStart=$a.lineEnd=$a.point=b,Oa+=xo(Ia/2)}},Ba={point:function(n,t){Ya>n&&(Ya=n),n>Va&&(Va=n),Za>t&&(Za=t),t>Xa&&(Xa=t)},lineStart:b,lineEnd:b,polygonStart:b,polygonEnd:b},Wa={point:Gt,lineStart:Kt,lineEnd:Qt,polygonStart:function(){Wa.lineStart=ne},polygonEnd:function(){Wa.point=Gt,Wa.lineStart=Kt,Wa.lineEnd=Qt}};ao.geo.path=function(){function n(n){return n&&("function"==typeof a&&u.pointRadius(+a.apply(this,arguments)),o&&o.valid||(o=i(u)),ao.geo.stream(n,o)),u.result()}function t(){return o=null,n}var e,r,i,u,o,a=4.5;return n.area=function(n){return Oa=0,ao.geo.stream(n,i($a)),Oa},n.centroid=function(n){return Ca=za=La=qa=Ta=Ra=Da=Pa=Ua=0,ao.geo.stream(n,i(Wa)),Ua?[Da/Ua,Pa/Ua]:Ra?[qa/Ra,Ta/Ra]:La?[Ca/La,za/La]:[NaN,NaN]},n.bounds=function(n){return Va=Xa=-(Ya=Za=1/0),ao.geo.stream(n,i(Ba)),[[Ya,Za],[Va,Xa]]},n.projection=function(n){return arguments.length?(i=(e=n)?n.stream||function(n){var t=ee(function(t,e){return n([t*Zo,e*Zo])});return function(n){return le(t(n))}}(n):m,t()):e},n.context=function(n){return arguments.length?(u=null==(r=n)?new function(){function n(n,t){o.push("M",n,",",t,u)}function t(n,t){o.push("M",n,",",t),a.point=e}function e(n,t){o.push("L",n,",",t)}function r(){a.point=n}function i(){o.push("Z")}var u=Jt(4.5),o=[],a={point:n,lineStart:function(){a.point=t},lineEnd:r,polygonStart:function(){a.lineEnd=i},polygonEnd:function(){a.lineEnd=r,a.point=n},pointRadius:function(n){return u=Jt(n),a},result:function(){if(o.length){var n=o.join("");return o=[],n}}};return a}:new function(n){function t(t,e){n.moveTo(t+o,e),n.arc(t,e,o,0,Ho)}function e(t,e){n.moveTo(t,e),a.point=r}function r(t,e){n.lineTo(t,e)}function i(){a.point=t}function u(){n.closePath()}var o=4.5,a={point:t,lineStart:function(){a.point=e},lineEnd:i,polygonStart:function(){a.lineEnd=u},polygonEnd:function(){a.lineEnd=i,a.point=t},pointRadius:function(n){return o=n,a},result:b};return a}(n),"function"!=typeof a&&u.pointRadius(a),t()):r},n.pointRadius=function(t){return arguments.length?(a="function"==typeof t?t:(u.pointRadius(+t),+t),n):a},n.projection(ao.geo.albersUsa()).context(null)},ao.geo.transform=function(n){return{stream:function(t){var e=new ie(t);for(var r in n)e[r]=n[r];return e}}},ie.prototype={point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},ao.geo.projection=oe,ao.geo.projectionMutator=ae,(ao.geo.equirectangular=function(){return oe(ce)}).raw=ce.invert=ce,ao.geo.rotation=function(n){function t(t){return t=n(t[0]*Yo,t[1]*Yo),t[0]*=Zo,t[1]*=Zo,t}return n=se(n[0]%360*Yo,n[1]*Yo,n.length>2?n[2]*Yo:0),t.invert=function(t){return t=n.invert(t[0]*Yo,t[1]*Yo),t[0]*=Zo,t[1]*=Zo,t},t},fe.invert=ce,ao.geo.circle=function(){function n(){var n="function"==typeof r?r.apply(this,arguments):r,t=se(-n[0]*Yo,-n[1]*Yo,0).invert,i=[];return e(null,null,1,{point:function(n,e){i.push(n=t(n,e)),n[0]*=Zo,n[1]*=Zo}}),{type:"Polygon",coordinates:[i]}}var t,e,r=[0,0],i=6;return n.origin=function(t){return arguments.length?(r=t,n):r},n.angle=function(r){return arguments.length?(e=ve((t=+r)*Yo,i*Yo),n):t},n.precision=function(r){return arguments.length?(e=ve(t*Yo,(i=+r)*Yo),n):i},n.angle(90)},ao.geo.distance=function(n,t){var e,r=(t[0]-n[0])*Yo,i=n[1]*Yo,u=t[1]*Yo,o=Math.sin(r),a=Math.cos(r),l=Math.sin(i),c=Math.cos(i),f=Math.sin(u),s=Math.cos(u);return Math.atan2(Math.sqrt((e=s*o)*e+(e=c*f-l*s*a)*e),l*f+c*s*a)},ao.geo.graticule=function(){function n(){return{type:"MultiLineString",coordinates:t()}}function t(){return ao.range(Math.ceil(u/d)*d,i,d).map(h).concat(ao.range(Math.ceil(c/y)*y,l,y).map(p)).concat(ao.range(Math.ceil(r/g)*g,e,g).filter(function(n){return xo(n%d)>Uo}).map(f)).concat(ao.range(Math.ceil(a/v)*v,o,v).filter(function(n){return xo(n%y)>Uo}).map(s))}var e,r,i,u,o,a,l,c,f,s,h,p,g=10,v=g,d=90,y=360,m=2.5;return n.lines=function(){return t().map(function(n){return{type:"LineString",coordinates:n}})},n.outline=function(){return{type:"Polygon",coordinates:[h(u).concat(p(l).slice(1),h(i).reverse().slice(1),p(c).reverse().slice(1))]}},n.extent=function(t){return arguments.length?n.majorExtent(t).minorExtent(t):n.minorExtent()},n.majorExtent=function(t){return arguments.length?(u=+t[0][0],i=+t[1][0],c=+t[0][1],l=+t[1][1],u>i&&(t=u,u=i,i=t),c>l&&(t=c,c=l,l=t),n.precision(m)):[[u,c],[i,l]]},n.minorExtent=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],a=+t[0][1],o=+t[1][1],r>e&&(t=r,r=e,e=t),a>o&&(t=a,a=o,o=t),n.precision(m)):[[r,a],[e,o]]},n.step=function(t){return arguments.length?n.majorStep(t).minorStep(t):n.minorStep()},n.majorStep=function(t){return arguments.length?(d=+t[0],y=+t[1],n):[d,y]},n.minorStep=function(t){return arguments.length?(g=+t[0],v=+t[1],n):[g,v]},n.precision=function(t){return arguments.length?(m=+t,f=ye(a,o,90),s=me(r,e,m),h=ye(c,l,90),p=me(u,i,m),n):m},n.majorExtent([[-180,-90+Uo],[180,90-Uo]]).minorExtent([[-180,-80-Uo],[180,80+Uo]])},ao.geo.greatArc=function(){function n(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),e||i.apply(this,arguments)]}}var t,e,r=Me,i=xe;return n.distance=function(){return ao.geo.distance(t||r.apply(this,arguments),e||i.apply(this,arguments))},n.source=function(e){return arguments.length?(r=e,t="function"==typeof e?null:e,n):r},n.target=function(t){return arguments.length?(i=t,e="function"==typeof t?null:t,n):i},n.precision=function(){return arguments.length?n:0},n},ao.geo.interpolate=function(n,t){return function(n,t,e,r){var i=Math.cos(t),u=Math.sin(t),o=Math.cos(r),a=Math.sin(r),l=i*Math.cos(n),c=i*Math.sin(n),f=o*Math.cos(e),s=o*Math.sin(e),h=2*Math.asin(Math.sqrt(on(r-t)+i*o*on(e-n))),p=1/Math.sin(h),g=h?function(n){var t=Math.sin(n*=h)*p,e=Math.sin(h-n)*p,r=e*l+t*f,i=e*c+t*s,o=e*u+t*a;return[Math.atan2(i,r)*Zo,Math.atan2(o,Math.sqrt(r*r+i*i))*Zo]}:function(){return[n*Zo,t*Zo]};return g.distance=h,g}(n[0]*Yo,n[1]*Yo,t[0]*Yo,t[1]*Yo)},ao.geo.length=function(n){return Ja=0,ao.geo.stream(n,Ga),Ja};var Ja,Ga={sphere:b,point:b,lineStart:function(){function n(n,i){var u=Math.sin(i*=Yo),o=Math.cos(i),a=xo((n*=Yo)-t),l=Math.cos(a);Ja+=Math.atan2(Math.sqrt((a=o*Math.sin(a))*a+(a=r*u-e*o*l)*a),e*u+r*o*l),t=n,e=u,r=o}var t,e,r;Ga.point=function(i,u){t=i*Yo,e=Math.sin(u*=Yo),r=Math.cos(u),Ga.point=n},Ga.lineEnd=function(){Ga.point=Ga.lineEnd=b}},lineEnd:b,polygonStart:b,polygonEnd:b},Ka=we(function(n){return Math.sqrt(2/(1+n))},function(n){return 2*Math.asin(n/2)});(ao.geo.azimuthalEqualArea=function(){return oe(Ka)}).raw=Ka;var Qa=we(function(n){var t=Math.acos(n);return t&&t/Math.sin(t)},m);(ao.geo.azimuthalEquidistant=function(){return oe(Qa)}).raw=Qa,(ao.geo.conicConformal=function(){return Vt(Se)}).raw=Se,(ao.geo.conicEquidistant=function(){return Vt(ke)}).raw=ke;var nl=we(function(n){return 1/n},Math.atan);(ao.geo.gnomonic=function(){return oe(nl)}).raw=nl,Ne.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-Io]},(ao.geo.mercator=function(){return Ee(Ne)}).raw=Ne;var tl=we(function(){return 1},Math.asin);(ao.geo.orthographic=function(){return oe(tl)}).raw=tl;var el=we(function(n){return 1/(1+n)},function(n){return 2*Math.atan(n)});(ao.geo.stereographic=function(){return oe(el)}).raw=el,Ae.invert=function(n,t){return[-t,2*Math.atan(Math.exp(n))-Io]},(ao.geo.transverseMercator=function(){var n=Ee(Ae),t=n.center,e=n.rotate;return n.center=function(n){return n?t([-n[1],n[0]]):(n=t(),[n[1],-n[0]])},n.rotate=function(n){return n?e([n[0],n[1],n.length>2?n[2]+90:90]):(n=e(),[n[0],n[1],n[2]-90])},e([0,0,90])}).raw=Ae,ao.geom={},ao.geom.hull=function(n){function t(n){if(n.length<3)return[];var t,i=En(e),u=En(r),o=n.length,a=[],l=[];for(t=0;o>t;t++)a.push([+i.call(this,n[t],t),+u.call(this,n[t],t),t]);for(a.sort(qe),t=0;o>t;t++)l.push([a[t][0],-a[t][1]]);var c=Le(a),f=Le(l),s=f[0]===c[0],h=f[f.length-1]===c[c.length-1],p=[];for(t=c.length-1;t>=0;--t)p.push(n[a[c[t]][2]]);for(t=+s;t<f.length-h;++t)p.push(n[a[f[t]][2]]);return p}var e=Ce,r=ze;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t)},ao.geom.polygon=function(n){return ko(n,rl),n};var rl=ao.geom.polygon.prototype=[];rl.area=function(){for(var n,t=-1,e=this.length,r=this[e-1],i=0;++t<e;)n=r,r=this[t],i+=n[1]*r[0]-n[0]*r[1];return.5*i},rl.centroid=function(n){var t,e,r=-1,i=this.length,u=0,o=0,a=this[i-1];for(arguments.length||(n=-1/(6*this.area()));++r<i;)t=a,a=this[r],e=t[0]*a[1]-a[0]*t[1],u+=(t[0]+a[0])*e,o+=(t[1]+a[1])*e;return[u*n,o*n]},rl.clip=function(n){for(var t,e,r,i,u,o,a=De(n),l=-1,c=this.length-De(this),f=this[c-1];++l<c;){for(t=n.slice(),n.length=0,i=this[l],u=t[(r=t.length-a)-1],e=-1;++e<r;)o=t[e],Te(o,f,i)?(Te(u,f,i)||n.push(Re(u,o,f,i)),n.push(o)):Te(u,f,i)&&n.push(Re(u,o,f,i)),u=o;a&&n.push(n[0]),f=i}return n};var il,ul,ol,al,ll,cl=[],fl=[];Ye.prototype.prepare=function(){for(var n,t=this.edges,e=t.length;e--;)(n=t[e].edge).b&&n.a||t.splice(e,1);return t.sort(Ve),t.length},tr.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},er.prototype={insert:function(n,t){var e,r,i;if(n){if(t.P=n,t.N=n.N,n.N&&(n.N.P=t),n.N=t,n.R){for(n=n.R;n.L;)n=n.L;n.L=t}else n.R=t;e=n}else this._?(n=or(this._),t.P=null,t.N=n,n.P=n.L=t,e=n):(t.P=t.N=null,this._=t,e=null);for(t.L=t.R=null,t.U=e,t.C=!0,n=t;e&&e.C;)r=e.U,e===r.L?(i=r.R)&&i.C?(e.C=i.C=!1,r.C=!0,n=r):(n===e.R&&(ir(this,e),n=e,e=n.U),e.C=!1,r.C=!0,ur(this,r)):(i=r.L)&&i.C?(e.C=i.C=!1,r.C=!0,n=r):(n===e.L&&(ur(this,e),n=e,e=n.U),e.C=!1,r.C=!0,ir(this,r)),e=n.U;this._.C=!1},remove:function(n){n.N&&(n.N.P=n.P),n.P&&(n.P.N=n.N),n.N=n.P=null;var t,e,r,i=n.U,u=n.L,o=n.R;if(e=u?o?or(o):u:o,i?i.L===n?i.L=e:i.R=e:this._=e,u&&o?(r=e.C,e.C=n.C,e.L=u,u.U=e,e!==o?(i=e.U,e.U=n.U,n=e.R,i.L=n,e.R=o,o.U=e):(e.U=i,i=e,n=e.R)):(r=n.C,n=e),n&&(n.U=i),!r){if(n&&n.C)return void(n.C=!1);do{if(n===this._)break;if(n===i.L){if((t=i.R).C&&(t.C=!1,i.C=!0,ir(this,i),t=i.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,ur(this,t),t=i.R),t.C=i.C,i.C=t.R.C=!1,ir(this,i),n=this._;break}}else if((t=i.L).C&&(t.C=!1,i.C=!0,ur(this,i),t=i.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,ir(this,t),t=i.L),t.C=i.C,i.C=t.L.C=!1,ur(this,i),n=this._;break}t.C=!0,n=i,i=i.U}while(!n.C);n&&(n.C=!1)}}},ao.geom.voronoi=function(n){function t(n){var t=new Array(n.length),r=a[0][0],i=a[0][1],u=a[1][0],o=a[1][1];return ar(e(n),a).cells.forEach(function(e,a){var l=e.edges,c=e.site;(t[a]=l.length?l.map(function(n){var t=n.start();return[t.x,t.y]}):c.x>=r&&c.x<=u&&c.y>=i&&c.y<=o?[[r,o],[u,o],[u,i],[r,i]]:[]).point=n[a]}),t}function e(n){return n.map(function(n,t){return{x:Math.round(u(n,t)/Uo)*Uo,y:Math.round(o(n,t)/Uo)*Uo,i:t}})}var r=Ce,i=ze,u=r,o=i,a=sl;return n?t(n):(t.links=function(n){return ar(e(n)).edges.filter(function(n){return n.l&&n.r}).map(function(t){return{source:n[t.l.i],target:n[t.r.i]}})},t.triangles=function(n){var t=[];return ar(e(n)).cells.forEach(function(e,r){for(var u,o=e.site,a=e.edges.sort(Ve),l=-1,c=a.length,f=a[c-1].edge,s=f.l===o?f.r:f.l;++l<c;)f,u=s,f=a[l].edge,s=f.l===o?f.r:f.l,r<u.i&&r<s.i&&cr(o,u,s)<0&&t.push([n[r],n[u.i],n[s.i]])}),t},t.x=function(n){return arguments.length?(u=En(r=n),t):r},t.y=function(n){return arguments.length?(o=En(i=n),t):i},t.clipExtent=function(n){return arguments.length?(a=null==n?sl:n,t):a===sl?null:a},t.size=function(n){return arguments.length?t.clipExtent(n&&[[0,0],n]):a===sl?null:a&&a[1]},t)};var sl=[[-1e6,-1e6],[1e6,1e6]];ao.geom.delaunay=function(n){return ao.geom.voronoi().triangles(n)},ao.geom.quadtree=function(n,t,e,r,i){function u(n){function u(n,t,e,r,i,u,o,a){if(!isNaN(e)&&!isNaN(r))if(n.leaf){var l=n.x,f=n.y;if(null!=l)if(xo(l-e)+xo(f-r)<.01)c(n,t,e,r,i,u,o,a);else{var s=n.point;n.x=n.y=n.point=null,c(n,s,l,f,i,u,o,a),c(n,t,e,r,i,u,o,a)}else n.x=e,n.y=r,n.point=t}else c(n,t,e,r,i,u,o,a)}function c(n,t,e,r,i,o,a,l){var c=.5*(i+a),f=.5*(o+l),s=e>=c,h=r>=f,p=h<<1|s;n.leaf=!1,n=n.nodes[p]||(n.nodes[p]={leaf:!0,nodes:[],point:null,x:null,y:null}),s?i=c:a=c,h?o=f:l=f,u(n,t,e,r,i,o,a,l)}var f,s,h,p,g,v,d,y,m,M=En(a),x=En(l);if(null!=t)v=t,d=e,y=r,m=i;else if(y=m=-(v=d=1/0),s=[],h=[],g=n.length,o)for(p=0;g>p;++p)(f=n[p]).x<v&&(v=f.x),f.y<d&&(d=f.y),f.x>y&&(y=f.x),f.y>m&&(m=f.y),s.push(f.x),h.push(f.y);else for(p=0;g>p;++p){var b=+M(f=n[p],p),_=+x(f,p);v>b&&(v=b),d>_&&(d=_),b>y&&(y=b),_>m&&(m=_),s.push(b),h.push(_)}var w=y-v,S=m-d;w>S?m=d+w:y=v+S;var k={leaf:!0,nodes:[],point:null,x:null,y:null};if(k.add=function(n){u(k,n,+M(n,++p),+x(n,p),v,d,y,m)},k.visit=function(n){pr(n,k,v,d,y,m)},k.find=function(n){return function(n,t,e,r,i,u,o){var a,l=1/0;return function c(n,f,s,h,p){if(!(f>u||s>o||r>h||i>p)){if(g=n.point){var g,v=t-n.x,d=e-n.y,y=v*v+d*d;if(l>y){var m=Math.sqrt(l=y);r=t-m,i=e-m,u=t+m,o=e+m,a=g}}for(var M=n.nodes,x=.5*(f+h),b=.5*(s+p),S=(e>=b)<<1|t>=x,k=S+4;k>S;++S)if(n=M[3&S])switch(3&S){case 0:c(n,f,s,x,b);break;case 1:c(n,x,s,h,b);break;case 2:c(n,f,b,x,p);break;case 3:c(n,x,b,h,p)}}}(n,r,i,u,o),a}(k,n[0],n[1],v,d,y,m)},p=-1,null==t){for(;++p<g;)u(k,n[p],s[p],h[p],v,d,y,m);--p}else n.forEach(k.add);return s=h=n=f=null,k}var o,a=Ce,l=ze;return(o=arguments.length)?(a=fr,l=sr,3===o&&(i=e,r=t,e=t=0),u(n)):(u.x=function(n){return arguments.length?(a=n,u):a},u.y=function(n){return arguments.length?(l=n,u):l},u.extent=function(n){return arguments.length?(null==n?t=e=r=i=null:(t=+n[0][0],e=+n[0][1],r=+n[1][0],i=+n[1][1]),u):null==t?null:[[t,e],[r,i]]},u.size=function(n){return arguments.length?(null==n?t=e=r=i=null:(t=e=0,r=+n[0],i=+n[1]),u):null==t?null:[r-t,i-e]},u)},ao.interpolateRgb=vr,ao.interpolateObject=dr,ao.interpolateNumber=yr,ao.interpolateString=mr;var hl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,pl=new RegExp(hl.source,"g");ao.interpolate=Mr,ao.interpolators=[function(n,t){var e=typeof t;return("string"===e?ua.has(t.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(t)?vr:mr:t instanceof an?vr:Array.isArray(t)?xr:"object"===e&&isNaN(t)?dr:yr)(n,t)}],ao.interpolateArray=xr;var gl=function(){return m},vl=ao.map({linear:gl,poly:function(n){return function(t){return Math.pow(t,n)}},quad:function(){return Sr},cubic:function(){return kr},sin:function(){return Ar},exp:function(){return Cr},circle:function(){return zr},elastic:function(n,t){var e;return arguments.length<2&&(t=.45),arguments.length?e=t/Ho*Math.asin(1/n):(n=1,e=t/4),function(r){return 1+n*Math.pow(2,-10*r)*Math.sin((r-e)*Ho/t)}},back:function(n){return n||(n=1.70158),function(t){return t*t*((n+1)*t-n)}},bounce:function(){return Tr}}),dl=ao.map({in:m,out:_r,"in-out":wr,"out-in":function(n){return wr(_r(n))}});ao.ease=function(n){var t=n.indexOf("-"),e=t>=0?n.slice(0,t):n,r=t>=0?n.slice(t+1):"in";return e=vl.get(e)||gl,r=dl.get(r)||m,function(n){return function(t){return 0>=t?0:t>=1?1:n(t)}}(r(e.apply(null,lo.call(arguments,1))))},ao.interpolateHcl=function(n,t){n=ao.hcl(n),t=ao.hcl(t);var e=n.h,r=n.c,i=n.l,u=t.h-e,o=t.c-r,a=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.c:r),isNaN(u)?(u=0,e=isNaN(e)?t.h:e):u>180?u-=360:-180>u&&(u+=360),function(n){return sn(e+u*n,r+o*n,i+a*n)+""}},ao.interpolateHsl=function(n,t){n=ao.hsl(n),t=ao.hsl(t);var e=n.h,r=n.s,i=n.l,u=t.h-e,o=t.s-r,a=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.s:r),isNaN(u)?(u=0,e=isNaN(e)?t.h:e):u>180?u-=360:-180>u&&(u+=360),function(n){return cn(e+u*n,r+o*n,i+a*n)+""}},ao.interpolateLab=function(n,t){n=ao.lab(n),t=ao.lab(t);var e=n.l,r=n.a,i=n.b,u=t.l-e,o=t.a-r,a=t.b-i;return function(n){return pn(e+u*n,r+o*n,i+a*n)+""}},ao.interpolateRound=Ur,ao.transform=function(n){var t=fo.createElementNS(ao.ns.prefix.svg,"g");return(ao.transform=function(n){if(null!=n){t.setAttribute("transform",n);var e=t.transform.baseVal.consolidate()}return new jr(e?e.matrix:yl)})(n)},jr.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var yl={a:1,b:0,c:0,d:1,e:0,f:0};ao.interpolateTransform=$r,ao.layout={},ao.layout.bundle=function(){return function(n){for(var t=[],e=-1,r=n.length;++e<r;)t.push(Jr(n[e]));return t}},ao.layout.chord=function(){function n(){var n,c,s,h,p,g={},v=[],d=ao.range(u),y=[];for(e=[],r=[],n=0,h=-1;++h<u;){for(c=0,p=-1;++p<u;)c+=i[h][p];v.push(c),y.push(ao.range(u)),n+=c}for(o&&d.sort(function(n,t){return o(v[n],v[t])}),a&&y.forEach(function(n,t){n.sort(function(n,e){return a(i[t][n],i[t][e])})}),n=(Ho-f*u)/n,c=0,h=-1;++h<u;){for(s=c,p=-1;++p<u;){var m=d[h],M=y[m][p],x=i[m][M],b=c,_=c+=x*n;g[m+"-"+M]={index:m,subindex:M,startAngle:b,endAngle:_,value:x}}r[m]={index:m,startAngle:s,endAngle:c,value:v[m]},c+=f}for(h=-1;++h<u;)for(p=h-1;++p<u;){var w=g[h+"-"+p],S=g[p+"-"+h];(w.value||S.value)&&e.push(w.value<S.value?{source:S,target:w}:{source:w,target:S})}l&&t()}function t(){e.sort(function(n,t){return l((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2)})}var e,r,i,u,o,a,l,c={},f=0;return c.matrix=function(n){return arguments.length?(u=(i=n)&&i.length,e=r=null,c):i},c.padding=function(n){return arguments.length?(f=n,e=r=null,c):f},c.sortGroups=function(n){return arguments.length?(o=n,e=r=null,c):o},c.sortSubgroups=function(n){return arguments.length?(a=n,e=null,c):a},c.sortChords=function(n){return arguments.length?(l=n,e&&t(),c):l},c.chords=function(){return e||n(),e},c.groups=function(){return r||n(),r},c},ao.layout.force=function(){function n(n){return function(t,e,r,i){if(t.point!==n){var u=t.cx-n.x,o=t.cy-n.y,a=i-e,l=u*u+o*o;if(l>a*a/y){if(v>l){c=t.charge/l;n.px-=u*c,n.py-=o*c}return!0}if(t.point&&l&&v>l){var c=t.pointCharge/l;n.px-=u*c,n.py-=o*c}}return!t.charge}}function t(n){n.px=ao.event.x,n.py=ao.event.y,l.resume()}var e,r,i,u,o,a,l={},c=ao.dispatch("start","tick","end"),f=[1,1],s=.9,h=ml,p=Ml,g=-30,v=xl,d=.1,y=.64,M=[],x=[];return l.tick=function(){if((i*=.99)<.005)return e=null,c.end({type:"end",alpha:i=0}),!0;var t,r,l,h,p,v,y,m,b,_=M.length,w=x.length;for(r=0;w>r;++r)l=x[r],h=l.source,p=l.target,m=p.x-h.x,b=p.y-h.y,(v=m*m+b*b)&&(v=i*o[r]*((v=Math.sqrt(v))-u[r])/v,m*=v,b*=v,p.x-=m*(y=h.weight+p.weight?h.weight/(h.weight+p.weight):.5),p.y-=b*y,h.x+=m*(y=1-y),h.y+=b*y);if((y=i*d)&&(m=f[0]/2,b=f[1]/2,r=-1,y))for(;++r<_;)l=M[r],l.x+=(m-l.x)*y,l.y+=(b-l.y)*y;if(g)for(ri(t=ao.geom.quadtree(M),i,a),r=-1;++r<_;)(l=M[r]).fixed||t.visit(n(l));for(r=-1;++r<_;)(l=M[r]).fixed?(l.x=l.px,l.y=l.py):(l.x-=(l.px-(l.px=l.x))*s,l.y-=(l.py-(l.py=l.y))*s);c.tick({type:"tick",alpha:i})},l.nodes=function(n){return arguments.length?(M=n,l):M},l.links=function(n){return arguments.length?(x=n,l):x},l.size=function(n){return arguments.length?(f=n,l):f},l.linkDistance=function(n){return arguments.length?(h="function"==typeof n?n:+n,l):h},l.distance=l.linkDistance,l.linkStrength=function(n){return arguments.length?(p="function"==typeof n?n:+n,l):p},l.friction=function(n){return arguments.length?(s=+n,l):s},l.charge=function(n){return arguments.length?(g="function"==typeof n?n:+n,l):g},l.chargeDistance=function(n){return arguments.length?(v=n*n,l):Math.sqrt(v)},l.gravity=function(n){return arguments.length?(d=+n,l):d},l.theta=function(n){return arguments.length?(y=n*n,l):Math.sqrt(y)},l.alpha=function(n){return arguments.length?(n=+n,i?n>0?i=n:(e.c=null,e.t=NaN,e=null,c.end({type:"end",alpha:i=0})):n>0&&(c.start({type:"start",alpha:i=n}),e=qn(l.tick)),l):i},l.start=function(){function n(n,r){if(!e){for(e=new Array(i),l=0;i>l;++l)e[l]=[];for(l=0;c>l;++l){var u=x[l];e[u.source.index].push(u.target),e[u.target.index].push(u.source)}}for(var o,a=e[t],l=-1,f=a.length;++l<f;)if(!isNaN(o=a[l][n]))return o;return Math.random()*r}var t,e,r,i=M.length,c=x.length,s=f[0],v=f[1];for(t=0;i>t;++t)(r=M[t]).index=t,r.weight=0;for(t=0;c>t;++t)"number"==typeof(r=x[t]).source&&(r.source=M[r.source]),"number"==typeof r.target&&(r.target=M[r.target]),++r.source.weight,++r.target.weight;for(t=0;i>t;++t)r=M[t],isNaN(r.x)&&(r.x=n("x",s)),isNaN(r.y)&&(r.y=n("y",v)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(u=[],"function"==typeof h)for(t=0;c>t;++t)u[t]=+h.call(this,x[t],t);else for(t=0;c>t;++t)u[t]=h;if(o=[],"function"==typeof p)for(t=0;c>t;++t)o[t]=+p.call(this,x[t],t);else for(t=0;c>t;++t)o[t]=p;if(a=[],"function"==typeof g)for(t=0;i>t;++t)a[t]=+g.call(this,M[t],t);else for(t=0;i>t;++t)a[t]=g;return l.resume()},l.resume=function(){return l.alpha(.1)},l.stop=function(){return l.alpha(0)},l.drag=function(){return r||(r=ao.behavior.drag().origin(m).on("dragstart.force",Qr).on("drag.force",t).on("dragend.force",ni)),arguments.length?void this.on("mouseover.force",ti).on("mouseout.force",ei).call(r):r},ao.rebind(l,c,"on")};var ml=20,Ml=1,xl=1/0;ao.layout.hierarchy=function(){function n(i){var u,o=[i],a=[];for(i.depth=0;null!=(u=o.pop());)if(a.push(u),(c=e.call(n,u,u.depth))&&(l=c.length)){for(var l,c,f;--l>=0;)o.push(f=c[l]),f.parent=u,f.depth=u.depth+1;r&&(u.value=0),u.children=c}else r&&(u.value=+r.call(n,u,u.depth)||0),delete u.children;return oi(i,function(n){var e,i;t&&(e=n.children)&&e.sort(t),r&&(i=n.parent)&&(i.value+=n.value)}),a}var t=ci,e=ai,r=li;return n.sort=function(e){return arguments.length?(t=e,n):t},n.children=function(t){return arguments.length?(e=t,n):e},n.value=function(t){return arguments.length?(r=t,n):r},n.revalue=function(t){return r&&(ui(t,function(n){n.children&&(n.value=0)}),oi(t,function(t){var e;t.children||(t.value=+r.call(n,t,t.depth)||0),(e=t.parent)&&(e.value+=t.value)})),t},n},ao.layout.partition=function(){function n(t,e,r,i){var u=t.children;if(t.x=e,t.y=t.depth*i,t.dx=r,t.dy=i,u&&(o=u.length)){var o,a,l,c=-1;for(r=t.value?r/t.value:0;++c<o;)n(a=u[c],e,l=a.value*r,i),e+=l}}function t(n){var e=n.children,r=0;if(e&&(i=e.length))for(var i,u=-1;++u<i;)r=Math.max(r,t(e[u]));return 1+r}function e(e,u){var o=r.call(this,e,u);return n(o[0],0,i[0],i[1]/t(o[0])),o}var r=ao.layout.hierarchy(),i=[1,1];return e.size=function(n){return arguments.length?(i=n,e):i},ii(e,r)},ao.layout.pie=function(){function n(o){var a,l=o.length,c=o.map(function(e,r){return+t.call(n,e,r)}),f=+("function"==typeof r?r.apply(this,arguments):r),s=("function"==typeof i?i.apply(this,arguments):i)-f,h=Math.min(Math.abs(s)/l,+("function"==typeof u?u.apply(this,arguments):u)),p=h*(0>s?-1:1),g=ao.sum(c),v=g?(s-l*p)/g:0,d=ao.range(l),y=[];return null!=e&&d.sort(e===bl?function(n,t){return c[t]-c[n]}:function(n,t){return e(o[n],o[t])}),d.forEach(function(n){y[n]={data:o[n],value:a=c[n],startAngle:f,endAngle:f+=a*v+p,padAngle:h}}),y}var t=Number,e=bl,r=0,i=Ho,u=0;return n.value=function(e){return arguments.length?(t=e,n):t},n.sort=function(t){return arguments.length?(e=t,n):e},n.startAngle=function(t){return arguments.length?(r=t,n):r},n.endAngle=function(t){return arguments.length?(i=t,n):i},n.padAngle=function(t){return arguments.length?(u=t,n):u},n};var bl={};ao.layout.stack=function(){function n(a,l){if(!(h=a.length))return a;var c=a.map(function(e,r){return t.call(n,e,r)}),f=c.map(function(t){return t.map(function(t,e){return[u.call(n,t,e),o.call(n,t,e)]})}),s=e.call(n,f,l);c=ao.permute(c,s),f=ao.permute(f,s);var h,p,g,v,d=r.call(n,f,l),y=c[0].length;for(g=0;y>g;++g)for(i.call(n,c[0][g],v=d[g],f[0][g][1]),p=1;h>p;++p)i.call(n,c[p][g],v+=f[p-1][g][1],f[p][g][1]);return a}var t=m,e=gi,r=vi,i=pi,u=si,o=hi;return n.values=function(e){return arguments.length?(t=e,n):t},n.order=function(t){return arguments.length?(e="function"==typeof t?t:_l.get(t)||gi,n):e},n.offset=function(t){return arguments.length?(r="function"==typeof t?t:wl.get(t)||vi,n):r},n.x=function(t){return arguments.length?(u=t,n):u},n.y=function(t){return arguments.length?(o=t,n):o},n.out=function(t){return arguments.length?(i=t,n):i},n};var _l=ao.map({"inside-out":function(n){var t,e,r=n.length,i=n.map(di),u=n.map(yi),o=ao.range(r).sort(function(n,t){return i[n]-i[t]}),a=0,l=0,c=[],f=[];for(t=0;r>t;++t)e=o[t],l>a?(a+=u[e],c.push(e)):(l+=u[e],f.push(e));return f.reverse().concat(c)},reverse:function(n){return ao.range(n.length).reverse()},default:gi}),wl=ao.map({silhouette:function(n){var t,e,r,i=n.length,u=n[0].length,o=[],a=0,l=[];for(e=0;u>e;++e){for(t=0,r=0;i>t;t++)r+=n[t][e][1];r>a&&(a=r),o.push(r)}for(e=0;u>e;++e)l[e]=(a-o[e])/2;return l},wiggle:function(n){var t,e,r,i,u,o,a,l,c,f=n.length,s=n[0],h=s.length,p=[];for(p[0]=l=c=0,e=1;h>e;++e){for(t=0,i=0;f>t;++t)i+=n[t][e][1];for(t=0,u=0,a=s[e][0]-s[e-1][0];f>t;++t){for(r=0,o=(n[t][e][1]-n[t][e-1][1])/(2*a);t>r;++r)o+=(n[r][e][1]-n[r][e-1][1])/a;u+=o*n[t][e][1]}p[e]=l-=i?u/i*a:0,c>l&&(c=l)}for(e=0;h>e;++e)p[e]-=c;return p},expand:function(n){var t,e,r,i=n.length,u=n[0].length,o=1/i,a=[];for(e=0;u>e;++e){for(t=0,r=0;i>t;t++)r+=n[t][e][1];if(r)for(t=0;i>t;t++)n[t][e][1]/=r;else for(t=0;i>t;t++)n[t][e][1]=o}for(e=0;u>e;++e)a[e]=0;return a},zero:vi});ao.layout.histogram=function(){function n(n,u){for(var o,a,l=[],c=n.map(e,this),f=r.call(this,c,u),s=i.call(this,f,c,u),u=-1,h=c.length,p=s.length-1,g=t?1:1/h;++u<p;)o=l[u]=[],o.dx=s[u+1]-(o.x=s[u]),o.y=0;if(p>0)for(u=-1;++u<h;)(a=c[u])>=f[0]&&a<=f[1]&&(o=l[ao.bisect(s,a,1,p)-1],o.y+=g,o.push(n[u]));return l}var t=!0,e=Number,r=bi,i=Mi;return n.value=function(t){return arguments.length?(e=t,n):e},n.range=function(t){return arguments.length?(r=En(t),n):r},n.bins=function(t){return arguments.length?(i="number"==typeof t?function(n){return xi(n,t)}:En(t),n):i},n.frequency=function(e){return arguments.length?(t=!!e,n):t},n},ao.layout.pack=function(){function n(n,u){var o=e.call(this,n,u),a=o[0],l=i[0],c=i[1],f=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(a.x=a.y=0,oi(a,function(n){n.r=+f(n.value)}),oi(a,Ni),r){var s=r*(t?1:Math.max(2*a.r/l,2*a.r/c))/2;oi(a,function(n){n.r+=s}),oi(a,Ni),oi(a,function(n){n.r-=s})}return Ci(a,l/2,c/2,t?1:1/Math.max(2*a.r/l,2*a.r/c)),o}var t,e=ao.layout.hierarchy().sort(_i),r=0,i=[1,1];return n.size=function(t){return arguments.length?(i=t,n):i},n.radius=function(e){return arguments.length?(t=null==e||"function"==typeof e?e:+e,n):t},n.padding=function(t){return arguments.length?(r=+t,n):r},ii(n,e)},ao.layout.tree=function(){function n(n,i){var f=o.call(this,n,i),s=f[0],h=function(n){for(var t,e={A:null,children:[n]},r=[e];null!=(t=r.pop());)for(var i,u=t.children,o=0,a=u.length;a>o;++o)r.push((u[o]=i={_:u[o],parent:t,children:(i=u[o].children)&&i.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=i);return e.children[0]}(s);if(oi(h,e),h.parent.m=-h.z,ui(h,r),c)ui(s,u);else{var p=s,g=s,v=s;ui(s,function(n){n.x<p.x&&(p=n),n.x>g.x&&(g=n),n.depth>v.depth&&(v=n)});var d=a(p,g)/2-p.x,y=l[0]/(g.x+a(g,p)/2+d),m=l[1]/(v.depth||1);ui(s,function(n){n.x=(n.x+d)*y,n.y=n.depth*m})}return f}function e(n){var t=n.children,e=n.parent.children,r=n.i?e[n.i-1]:null;if(t.length){!function(n){for(var t,e=0,r=0,i=n.children,u=i.length;--u>=0;)t=i[u],t.z+=e,t.m+=e,e+=t.s+(r+=t.c)}(n);var u=(t[0].z+t[t.length-1].z)/2;r?(n.z=r.z+a(n._,r._),n.m=n.z-u):n.z=u}else r&&(n.z=r.z+a(n._,r._));n.parent.A=function(n,t,e){if(t){for(var r,i=n,u=n,o=t,l=i.parent.children[0],c=i.m,f=u.m,s=o.m,h=l.m;o=Ti(o),i=qi(i),o&&i;)l=qi(l),u=Ti(u),u.a=n,(r=o.z+s-i.z-c+a(o._,i._))>0&&(Ri(Pi(o,n,e),n,r),c+=r,f+=r),s+=o.m,c+=i.m,h+=l.m,f+=u.m;o&&!Ti(u)&&(u.t=o,u.m+=s-f),i&&!qi(l)&&(l.t=i,l.m+=c-h,e=n)}return e}(n,r,n.parent.A||e[0])}function r(n){n._.x=n.z+n.parent.m,n.m+=n.parent.m}function u(n){n.x*=l[0],n.y=n.depth*l[1]}var o=ao.layout.hierarchy().sort(null).value(null),a=Li,l=[1,1],c=null;return n.separation=function(t){return arguments.length?(a=t,n):a},n.size=function(t){return arguments.length?(c=null==(l=t)?u:null,n):c?null:l},n.nodeSize=function(t){return arguments.length?(c=null==(l=t)?null:u,n):c?l:null},ii(n,o)},ao.layout.cluster=function(){function n(n,u){var o,a=t.call(this,n,u),l=a[0],c=0;oi(l,function(n){var t=n.children;t&&t.length?(n.x=function(n){return n.reduce(function(n,t){return n+t.x},0)/n.length}(t),n.y=function(n){return 1+ao.max(n,function(n){return n.y})}(t)):(n.x=o?c+=e(n,o):0,n.y=0,o=n)});var f=Fi(l),s=Hi(l),h=f.x-e(f,s)/2,p=s.x+e(s,f)/2;return oi(l,i?function(n){n.x=(n.x-l.x)*r[0],n.y=(l.y-n.y)*r[1]}:function(n){n.x=(n.x-h)/(p-h)*r[0],n.y=(1-(l.y?n.y/l.y:1))*r[1]}),a}var t=ao.layout.hierarchy().sort(null).value(null),e=Li,r=[1,1],i=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(i=null==(r=t),n):i?null:r},n.nodeSize=function(t){return arguments.length?(i=null!=(r=t),n):i?r:null},ii(n,t)},ao.layout.treemap=function(){function n(n,t){for(var e,r,i=-1,u=n.length;++i<u;)r=(e=n[i]).value*(0>t?0:t),e.area=isNaN(r)||0>=r?0:r}function t(e){var u=e.children;if(u&&u.length){var o,a,l,c=s(e),f=[],h=u.slice(),g=1/0,v="slice"===p?c.dx:"dice"===p?c.dy:"slice-dice"===p?1&e.depth?c.dy:c.dx:Math.min(c.dx,c.dy);for(n(h,c.dx*c.dy/e.value),f.area=0;(l=h.length)>0;)f.push(o=h[l-1]),f.area+=o.area,"squarify"!==p||(a=r(f,v))<=g?(h.pop(),g=a):(f.area-=f.pop().area,i(f,v,c,!1),v=Math.min(c.dx,c.dy),f.length=f.area=0,g=1/0);f.length&&(i(f,v,c,!0),f.length=f.area=0),u.forEach(t)}}function e(t){var r=t.children;if(r&&r.length){var u,o=s(t),a=r.slice(),l=[];for(n(a,o.dx*o.dy/t.value),l.area=0;u=a.pop();)l.push(u),l.area+=u.area,null!=u.z&&(i(l,u.z?o.dx:o.dy,o,!a.length),l.length=l.area=0);r.forEach(e)}}function r(n,t){for(var e,r=n.area,i=0,u=1/0,o=-1,a=n.length;++o<a;)(e=n[o].area)&&(u>e&&(u=e),e>i&&(i=e));return r*=r,t*=t,r?Math.max(t*i*g/r,r/(t*u*g)):1/0}function i(n,t,e,r){var i,u=-1,o=n.length,a=e.x,c=e.y,f=t?l(n.area/t):0;if(t==e.dx){for((r||f>e.dy)&&(f=e.dy);++u<o;)i=n[u],i.x=a,i.y=c,i.dy=f,a+=i.dx=Math.min(e.x+e.dx-a,f?l(i.area/f):0);i.z=!0,i.dx+=e.x+e.dx-a,e.y+=f,e.dy-=f}else{for((r||f>e.dx)&&(f=e.dx);++u<o;)i=n[u],i.x=a,i.y=c,i.dx=f,c+=i.dy=Math.min(e.y+e.dy-c,f?l(i.area/f):0);i.z=!1,i.dy+=e.y+e.dy-c,e.x+=f,e.dx-=f}}function u(r){var i=o||a(r),u=i[0];return u.x=u.y=0,u.value?(u.dx=c[0],u.dy=c[1]):u.dx=u.dy=0,o&&a.revalue(u),n([u],u.dx*u.dy/u.value),(o?e:t)(u),h&&(o=i),i}var o,a=ao.layout.hierarchy(),l=Math.round,c=[1,1],f=null,s=Oi,h=!1,p="squarify",g=.5*(1+Math.sqrt(5));return u.size=function(n){return arguments.length?(c=n,u):c},u.padding=function(n){function e(t){return Ii(t,n)}if(!arguments.length)return f;var r;return s=null==(f=n)?Oi:"function"==(r=typeof n)?function(t){var e=n.call(u,t,t.depth);return null==e?Oi(t):Ii(t,"number"==typeof e?[e,e,e,e]:e)}:"number"===r?(n=[n,n,n,n],e):e,u},u.round=function(n){return arguments.length?(l=n?Math.round:Number,u):l!=Number},u.sticky=function(n){return arguments.length?(h=n,o=null,u):h},u.ratio=function(n){return arguments.length?(g=n,u):g},u.mode=function(n){return arguments.length?(p=n+"",u):p},ii(u,a)},ao.random={normal:function(n,t){var e=arguments.length;return 2>e&&(t=1),1>e&&(n=0),function(){var e,r,i;do{e=2*Math.random()-1,r=2*Math.random()-1,i=e*e+r*r}while(!i||i>1);return n+t*e*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(){var n=ao.random.normal.apply(ao,arguments);return function(){return Math.exp(n())}},bates:function(n){var t=ao.random.irwinHall(n);return function(){return t()/n}},irwinHall:function(n){return function(){for(var t=0,e=0;n>e;e++)t+=Math.random();return t}}},ao.scale={};var Sl={floor:m,ceil:m};ao.scale.linear=function(){return Wi([0,1],[0,1],Mr,!1)};var kl={s:1,g:1,p:1,r:1,e:1};ao.scale.log=function(){return ru(ao.scale.linear().domain([0,1]),10,!0,[1,10])};var Nl=ao.format(".0e"),El={floor:function(n){return-Math.ceil(-n)},ceil:function(n){return-Math.floor(-n)}};ao.scale.pow=function(){return iu(ao.scale.linear(),1,[0,1])},ao.scale.sqrt=function(){return ao.scale.pow().exponent(.5)},ao.scale.ordinal=function(){return ou([],{t:"range",a:[[]]})},ao.scale.category10=function(){return ao.scale.ordinal().range(Al)},ao.scale.category20=function(){return ao.scale.ordinal().range(Cl)},ao.scale.category20b=function(){return ao.scale.ordinal().range(zl)},ao.scale.category20c=function(){return ao.scale.ordinal().range(Ll)};var Al=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(xn),Cl=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(xn),zl=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(xn),Ll=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(xn);ao.scale.quantile=function(){return au([],[])},ao.scale.quantize=function(){return lu(0,1,[0,1])},ao.scale.threshold=function(){return cu([.5],[0,1])},ao.scale.identity=function(){return fu([0,1])},ao.svg={},ao.svg.arc=function(){function n(){var n=Math.max(0,+e.apply(this,arguments)),c=Math.max(0,+r.apply(this,arguments)),f=o.apply(this,arguments)-Io,s=a.apply(this,arguments)-Io,h=Math.abs(s-f),p=f>s?0:1;if(n>c&&(g=c,c=n,n=g),h>=Oo)return t(c,p)+(n?t(n,1-p):"")+"Z";var g,v,d,y,m,M,x,b,_,w,S,k,N=0,E=0,A=[];if((y=(+l.apply(this,arguments)||0)/2)&&(d=u===ql?Math.sqrt(n*n+c*c):+u.apply(this,arguments),p||(E*=-1),c&&(E=tn(d/c*Math.sin(y))),n&&(N=tn(d/n*Math.sin(y)))),c){m=c*Math.cos(f+E),M=c*Math.sin(f+E),x=c*Math.cos(s-E),b=c*Math.sin(s-E);var C=Math.abs(s-f-2*E)<=Fo?0:1;if(E&&yu(m,M,x,b)===p^C){var z=(f+s)/2;m=c*Math.cos(z),M=c*Math.sin(z),x=b=null}}else m=M=0;if(n){_=n*Math.cos(s-N),w=n*Math.sin(s-N),S=n*Math.cos(f+N),k=n*Math.sin(f+N);var L=Math.abs(f-s+2*N)<=Fo?0:1;if(N&&yu(_,w,S,k)===1-p^L){var q=(f+s)/2;_=n*Math.cos(q),w=n*Math.sin(q),S=k=null}}else _=w=0;if(h>Uo&&(g=Math.min(Math.abs(c-n)/2,+i.apply(this,arguments)))>.001){v=c>n^p?0:1;var T=g,R=g;if(Fo>h){var D=null==S?[_,w]:null==x?[m,M]:Re([m,M],[S,k],[x,b],[_,w]),P=m-D[0],U=M-D[1],j=x-D[0],F=b-D[1],H=1/Math.sin(Math.acos((P*j+U*F)/(Math.sqrt(P*P+U*U)*Math.sqrt(j*j+F*F)))/2),O=Math.sqrt(D[0]*D[0]+D[1]*D[1]);R=Math.min(g,(n-O)/(H-1)),T=Math.min(g,(c-O)/(H+1))}if(null!=x){var I=mu(null==S?[_,w]:[S,k],[m,M],c,T,p),Y=mu([x,b],[_,w],c,T,p);g===T?A.push("M",I[0],"A",T,",",T," 0 0,",v," ",I[1],"A",c,",",c," 0 ",1-p^yu(I[1][0],I[1][1],Y[1][0],Y[1][1]),",",p," ",Y[1],"A",T,",",T," 0 0,",v," ",Y[0]):A.push("M",I[0],"A",T,",",T," 0 1,",v," ",Y[0])}else A.push("M",m,",",M);if(null!=S){var Z=mu([m,M],[S,k],n,-R,p),V=mu([_,w],null==x?[m,M]:[x,b],n,-R,p);g===R?A.push("L",V[0],"A",R,",",R," 0 0,",v," ",V[1],"A",n,",",n," 0 ",p^yu(V[1][0],V[1][1],Z[1][0],Z[1][1]),",",1-p," ",Z[1],"A",R,",",R," 0 0,",v," ",Z[0]):A.push("L",V[0],"A",R,",",R," 0 0,",v," ",Z[0])}else A.push("L",_,",",w)}else A.push("M",m,",",M),null!=x&&A.push("A",c,",",c," 0 ",C,",",p," ",x,",",b),A.push("L",_,",",w),null!=S&&A.push("A",n,",",n," 0 ",L,",",1-p," ",S,",",k);return A.push("Z"),A.join("")}function t(n,t){return"M0,"+n+"A"+n+","+n+" 0 1,"+t+" 0,"+-n+"A"+n+","+n+" 0 1,"+t+" 0,"+n}var e=hu,r=pu,i=su,u=ql,o=gu,a=vu,l=du;return n.innerRadius=function(t){return arguments.length?(e=En(t),n):e},n.outerRadius=function(t){return arguments.length?(r=En(t),n):r},n.cornerRadius=function(t){return arguments.length?(i=En(t),n):i},n.padRadius=function(t){return arguments.length?(u=t==ql?ql:En(t),n):u},n.startAngle=function(t){return arguments.length?(o=En(t),n):o},n.endAngle=function(t){return arguments.length?(a=En(t),n):a},n.padAngle=function(t){return arguments.length?(l=En(t),n):l},n.centroid=function(){var n=(+e.apply(this,arguments)+ +r.apply(this,arguments))/2,t=(+o.apply(this,arguments)+ +a.apply(this,arguments))/2-Io;return[Math.cos(t)*n,Math.sin(t)*n]},n};var ql="auto";ao.svg.line=function(){return Mu(m)};var Tl=ao.map({linear:xu,"linear-closed":bu,step:function(n){for(var t=0,e=n.length,r=n[0],i=[r[0],",",r[1]];++t<e;)i.push("H",(r[0]+(r=n[t])[0])/2,"V",r[1]);return e>1&&i.push("H",r[0]),i.join("")},"step-before":wu,"step-after":Su,basis:zu,"basis-open":function(n){if(n.length<4)return xu(n);for(var t,e=[],r=-1,i=n.length,u=[0],o=[0];++r<3;)t=n[r],u.push(t[0]),o.push(t[1]);for(e.push(Ru(Pl,u)+","+Ru(Pl,o)),--r;++r<i;)t=n[r],u.shift(),u.push(t[0]),o.shift(),o.push(t[1]),Du(e,u,o);return e.join("")},"basis-closed":function(n){for(var t,e,r=-1,i=n.length,u=i+4,o=[],a=[];++r<4;)e=n[r%i],o.push(e[0]),a.push(e[1]);for(t=[Ru(Pl,o),",",Ru(Pl,a)],--r;++r<u;)e=n[r%i],o.shift(),o.push(e[0]),a.shift(),a.push(e[1]),Du(t,o,a);return t.join("")},bundle:function(n,t){var e=n.length-1;if(e)for(var r,i,u=n[0][0],o=n[0][1],a=n[e][0]-u,l=n[e][1]-o,c=-1;++c<=e;)r=n[c],i=c/e,r[0]=t*r[0]+(1-t)*(u+i*a),r[1]=t*r[1]+(1-t)*(o+i*l);return zu(n)},cardinal:function(n,t){return n.length<3?xu(n):n[0]+Au(n,Cu(n,t))},"cardinal-open":function(n,t){return n.length<4?xu(n):n[1]+Au(n.slice(1,-1),Cu(n,t))},"cardinal-closed":function(n,t){return n.length<3?bu(n):n[0]+Au((n.push(n[0]),n),Cu([n[n.length-2]].concat(n,[n[1]]),t))},monotone:function(n){return n.length<3?xu(n):n[0]+Au(n,ju(n))}});Tl.forEach(function(n,t){t.key=n,t.closed=/-closed$/.test(n)});var Rl=[0,2/3,1/3,0],Dl=[0,1/3,2/3,0],Pl=[0,1/6,2/3,1/6];ao.svg.line.radial=function(){var n=Mu(Hu);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n},wu.reverse=Su,Su.reverse=wu,ao.svg.area=function(){return Ou(m)},ao.svg.area.radial=function(){var n=Ou(Hu);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n},ao.svg.chord=function(){function n(n,a){var l=t(this,u,n,a),c=t(this,o,n,a);return"M"+l.p0+r(l.r,l.p1,l.a1-l.a0)+(function(n,t){return n.a0==t.a0&&n.a1==t.a1}(l,c)?i(l.r,l.p1,l.r,l.p0):i(l.r,l.p1,c.r,c.p0)+r(c.r,c.p1,c.a1-c.a0)+i(c.r,c.p1,l.r,l.p0))+"Z"}function t(n,t,e,r){var i=t.call(n,e,r),u=a.call(n,i,r),o=l.call(n,i,r)-Io,f=c.call(n,i,r)-Io;return{r:u,a0:o,a1:f,p0:[u*Math.cos(o),u*Math.sin(o)],p1:[u*Math.cos(f),u*Math.sin(f)]}}function r(n,t,e){return"A"+n+","+n+" 0 "+ +(e>Fo)+",1 "+t}function i(n,t,e,r){return"Q 0,0 "+r}var u=Me,o=xe,a=Iu,l=gu,c=vu;return n.radius=function(t){return arguments.length?(a=En(t),n):a},n.source=function(t){return arguments.length?(u=En(t),n):u},n.target=function(t){return arguments.length?(o=En(t),n):o},n.startAngle=function(t){return arguments.length?(l=En(t),n):l},n.endAngle=function(t){return arguments.length?(c=En(t),n):c},n},ao.svg.diagonal=function(){function n(n,i){var u=t.call(this,n,i),o=e.call(this,n,i),a=(u.y+o.y)/2,l=[u,{x:u.x,y:a},{x:o.x,y:a},o];return"M"+(l=l.map(r))[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var t=Me,e=xe,r=Yu;return n.source=function(e){return arguments.length?(t=En(e),n):t},n.target=function(t){return arguments.length?(e=En(t),n):e},n.projection=function(t){return arguments.length?(r=t,n):r},n},ao.svg.diagonal.radial=function(){var n=ao.svg.diagonal(),t=Yu,e=n.projection;return n.projection=function(n){return arguments.length?e(function(n){return function(){var t=n.apply(this,arguments),e=t[0],r=t[1]-Io;return[e*Math.cos(r),e*Math.sin(r)]}}(t=n)):t},n},ao.svg.symbol=function(){function n(n,r){return(Ul.get(t.call(this,n,r))||$u)(e.call(this,n,r))}var t=Xu,e=Vu;return n.type=function(e){return arguments.length?(t=En(e),n):t},n.size=function(t){return arguments.length?(e=En(t),n):e},n};var Ul=ao.map({circle:$u,cross:function(n){var t=Math.sqrt(n/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(n){var t=Math.sqrt(n/(2*Fl)),e=t*Fl;return"M0,"+-t+"L"+e+",0 0,"+t+" "+-e+",0Z"},square:function(n){var t=Math.sqrt(n)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(n){var t=Math.sqrt(n/jl),e=t*jl/2;return"M0,"+e+"L"+t+","+-e+" "+-t+","+-e+"Z"},"triangle-up":function(n){var t=Math.sqrt(n/jl),e=t*jl/2;return"M0,"+-e+"L"+t+","+e+" "+-t+","+e+"Z"}});ao.svg.symbolTypes=Ul.keys();var jl=Math.sqrt(3),Fl=Math.tan(30*Yo);Co.transition=function(n){for(var t,e,r=Hl||++Zl,i=Ku(n),u=[],o=Ol||{time:Date.now(),ease:function(n){if(0>=n)return 0;if(n>=1)return 1;var t=n*n,e=t*n;return 4*(.5>n?e:3*(n-t)+e-.75)},delay:0,duration:250},a=-1,l=this.length;++a<l;){u.push(t=[]);for(var c=this[a],f=-1,s=c.length;++f<s;)(e=c[f])&&Qu(e,f,i,r,o),t.push(e)}return Wu(u,i,r)},Co.interrupt=function(n){return this.each(null==n?Il:Bu(Ku(n)))};var Hl,Ol,Il=Bu(Ku()),Yl=[],Zl=0;Yl.call=Co.call,Yl.empty=Co.empty,Yl.node=Co.node,Yl.size=Co.size,ao.transition=function(n,t){return n&&n.transition?Hl?n.transition(t):n:ao.selection().transition(n)},ao.transition.prototype=Yl,Yl.select=function(n){var t,e,r,i=this.id,u=this.namespace,o=[];n=A(n);for(var a=-1,l=this.length;++a<l;){o.push(t=[]);for(var c=this[a],f=-1,s=c.length;++f<s;)(r=c[f])&&(e=n.call(r,r.__data__,f,a))?("__data__"in r&&(e.__data__=r.__data__),Qu(e,f,u,i,r[u][i]),t.push(e)):t.push(null)}return Wu(o,u,i)},Yl.selectAll=function(n){var t,e,r,i,u,o=this.id,a=this.namespace,l=[];n=C(n);for(var c=-1,f=this.length;++c<f;)for(var s=this[c],h=-1,p=s.length;++h<p;)if(r=s[h]){u=r[a][o],e=n.call(r,r.__data__,h,c),l.push(t=[]);for(var g=-1,v=e.length;++g<v;)(i=e[g])&&Qu(i,g,a,o,u),t.push(i)}return Wu(l,a,o)},Yl.filter=function(n){var t,r,i=[];"function"!=typeof n&&(n=O(n));for(var u=0,o=this.length;o>u;u++){i.push(t=[]);for(var e,a=0,l=(e=this[u]).length;l>a;a++)(r=e[a])&&n.call(r,r.__data__,a,u)&&t.push(r)}return Wu(i,this.namespace,this.id)},Yl.tween=function(n,t){var e=this.id,r=this.namespace;return arguments.length<2?this.node()[r][e].tween.get(n):Y(this,null==t?function(t){t[r][e].tween.remove(n)}:function(i){i[r][e].tween.set(n,t)})},Yl.attr=function(n,t){if(arguments.length<2){for(t in n)this.attr(t,n[t]);return this}var o="transform"==n?$r:Mr,a=ao.ns.qualify(n);return Ju(this,"attr."+n,t,a.local?function(n){return null==n?function(){this.removeAttributeNS(a.space,a.local)}:(n+="",function(){var t,e=this.getAttributeNS(a.space,a.local);return e!==n&&(t=o(e,n),function(n){this.setAttributeNS(a.space,a.local,t(n))})})}:function(n){return null==n?function(){this.removeAttribute(a)}:(n+="",function(){var t,e=this.getAttribute(a);return e!==n&&(t=o(e,n),function(n){this.setAttribute(a,t(n))})})})},Yl.attrTween=function(n,t){var i=ao.ns.qualify(n);return this.tween("attr."+n,i.local?function(n,e){var r=t.call(this,n,e,this.getAttributeNS(i.space,i.local));return r&&function(n){this.setAttributeNS(i.space,i.local,r(n))}}:function(n,e){var r=t.call(this,n,e,this.getAttribute(i));return r&&function(n){this.setAttribute(i,r(n))}})},Yl.style=function(n,e,r){var o=arguments.length;if(3>o){if("string"!=typeof n){2>o&&(e="");for(r in n)this.style(r,n[r],e);return this}r=""}return Ju(this,"style."+n,e,function(e){return null==e?function(){this.style.removeProperty(n)}:(e+="",function(){var i,u=t(this).getComputedStyle(this,null).getPropertyValue(n);return u!==e&&(i=Mr(u,e),function(t){this.style.setProperty(n,i(t),r)})})})},Yl.styleTween=function(n,e,r){return arguments.length<3&&(r=""),this.tween("style."+n,function(i,u){var o=e.call(this,i,u,t(this).getComputedStyle(this,null).getPropertyValue(n));return o&&function(t){this.style.setProperty(n,o(t),r)}})},Yl.text=function(n){return Ju(this,"text",n,Gu)},Yl.remove=function(){var n=this.namespace;return this.each("end.transition",function(){var t;this[n].count<2&&(t=this.parentNode)&&t.removeChild(this)})},Yl.ease=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].ease:("function"!=typeof n&&(n=ao.ease.apply(ao,arguments)),Y(this,function(r){r[e][t].ease=n}))},Yl.delay=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].delay:Y(this,"function"==typeof n?function(r,i,u){r[e][t].delay=+n.call(r,r.__data__,i,u)}:(n=+n,function(r){r[e][t].delay=n}))},Yl.duration=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].duration:Y(this,"function"==typeof n?function(r,i,u){r[e][t].duration=Math.max(1,n.call(r,r.__data__,i,u))}:(n=Math.max(1,n),function(r){r[e][t].duration=n}))},Yl.each=function(n,t){var e=this.id,r=this.namespace;if(arguments.length<2){var i=Ol,u=Hl;try{Hl=e,Y(this,function(t,i,u){Ol=t[r][e],n.call(t,t.__data__,i,u)})}finally{Ol=i,Hl=u}}else Y(this,function(i){var u=i[r][e];(u.event||(u.event=ao.dispatch("start","end","interrupt"))).on(n,t)});return this},Yl.transition=function(){for(var n,e,r,i=this.id,u=++Zl,o=this.namespace,a=[],l=0,c=this.length;c>l;l++){a.push(n=[]);for(var t,f=0,s=(t=this[l]).length;s>f;f++)(e=t[f])&&(r=e[o][i],Qu(e,f,o,u,{time:r.time,ease:r.ease,delay:r.delay+r.duration,duration:r.duration})),n.push(e)}return Wu(a,o,u)},ao.svg.axis=function(){function n(n){n.each(function(){var n,c=ao.select(this),f=this.__chart__||e,s=this.__chart__=e.copy(),h=null==l?s.ticks?s.ticks.apply(s,a):s.domain():l,p=null==t?s.tickFormat?s.tickFormat.apply(s,a):m:t,g=c.selectAll(".tick").data(h,s),v=g.enter().insert("g",".domain").attr("class","tick").style("opacity",Uo),d=ao.transition(g.exit()).style("opacity",Uo).remove(),y=ao.transition(g.order()).style("opacity",1),M=Math.max(i,0)+o,x=Zi(s),b=c.selectAll(".domain").data([0]),_=(b.enter().append("path").attr("class","domain"),ao.transition(b));v.append("line"),v.append("text");var w,S,k,N,E=v.select("line"),A=y.select("line"),C=g.select("text").text(p),z=v.select("text"),L=y.select("text"),q="top"===r||"left"===r?-1:1;if("bottom"===r||"top"===r?(n=no,w="x",k="y",S="x2",N="y2",C.attr("dy",0>q?"0em":".71em").style("text-anchor","middle"),_.attr("d","M"+x[0]+","+q*u+"V0H"+x[1]+"V"+q*u)):(n=to,w="y",k="x",S="y2",N="x2",C.attr("dy",".32em").style("text-anchor",0>q?"end":"start"),_.attr("d","M"+q*u+","+x[0]+"H0V"+x[1]+"H"+q*u)),E.attr(N,q*i),z.attr(k,q*M),A.attr(S,0).attr(N,q*i),L.attr(w,0).attr(k,q*M),s.rangeBand){var T=s,R=T.rangeBand()/2;f=s=function(n){return T(n)+R}}else f.rangeBand?f=s:d.call(n,s,f);v.call(n,f,s),y.call(n,s,s)})}var t,e=ao.scale.linear(),r=Vl,i=6,u=6,o=3,a=[10],l=null;return n.scale=function(t){return arguments.length?(e=t,n):e},n.orient=function(t){return arguments.length?(r=t in Xl?t+"":Vl,n):r},n.ticks=function(){return arguments.length?(a=co(arguments),n):a},n.tickValues=function(t){return arguments.length?(l=t,n):l},n.tickFormat=function(e){return arguments.length?(t=e,n):t},n.tickSize=function(t){var e=arguments.length;return e?(i=+t,u=+arguments[e-1],n):i},n.innerTickSize=function(t){return arguments.length?(i=+t,n):i},n.outerTickSize=function(t){return arguments.length?(u=+t,n):u},n.tickPadding=function(t){return arguments.length?(o=+t,n):o},n.tickSubdivide=function(){return arguments.length&&n},n};var Vl="bottom",Xl={top:1,right:1,bottom:1,left:1};ao.svg.brush=function(){function n(t){t.each(function(){var t=ao.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",u).on("touchstart.brush",u),o=t.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),t.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var a=t.selectAll(".resize").data(v,m);a.exit().remove(),a.enter().append("g").attr("class",function(n){return"resize "+n}).style("cursor",function(n){return $l[n]}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null}).attr("y",function(n){return/^[ns]/.test(n)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),a.style("display",n.empty()?"none":null);var l,s=ao.transition(t),h=ao.transition(o);c&&(l=Zi(c),h.attr("x",l[0]).attr("width",l[1]-l[0]),r(s)),f&&(l=Zi(f),h.attr("y",l[0]).attr("height",l[1]-l[0]),i(s)),e(s)})}function e(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+s[+/e$/.test(n)]+","+h[+/^s/.test(n)]+")"})}function r(n){n.select(".extent").attr("x",s[0]),n.selectAll(".extent,.n>rect,.s>rect").attr("width",s[1]-s[0])}function i(n){n.select(".extent").attr("y",h[0]),n.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function u(){function d(){var n=ao.mouse(b),t=!1;x&&(n[0]+=x[0],n[1]+=x[1]),C||(ao.event.altKey?(M||(M=[(s[0]+s[1])/2,(h[0]+h[1])/2]),L[0]=s[+(n[0]<M[0])],L[1]=h[+(n[1]<M[1])]):M=null),E&&y(n,c,0)&&(r(k),t=!0),A&&y(n,f,1)&&(i(k),t=!0),t&&(e(k),w({type:"brush",mode:C?"move":"resize"}))}function y(n,t,e){var r,i,u=Zi(t),l=u[0],c=u[1],f=L[e],v=e?h:s,d=v[1]-v[0];return C&&(l-=f,c-=d+f),r=(e?g:p)?Math.max(l,Math.min(c,n[e])):n[e],C?i=(r+=f)+d:(M&&(f=Math.max(l,Math.min(c,2*M[e]-r))),r>f?(i=r,r=f):i=f),v[0]!=r||v[1]!=i?(e?a=null:o=null,v[0]=r,v[1]=i,!0):void 0}function m(){d(),k.style("pointer-events","all").selectAll(".resize").style("display",n.empty()?"none":null),ao.select("body").style("cursor",null),q.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),z(),w({type:"brushend"})}var M,x,b=this,_=ao.select(ao.event.target),w=l.of(b,arguments),k=ao.select(b),N=_.datum(),E=!/^(n|s)$/.test(N)&&c,A=!/^(e|w)$/.test(N)&&f,C=_.classed("extent"),z=W(b),L=ao.mouse(b),q=ao.select(t(b)).on("keydown.brush",function(){32==ao.event.keyCode&&(C||(M=null,L[0]-=s[1],L[1]-=h[1],C=2),S())}).on("keyup.brush",function(){32==ao.event.keyCode&&2==C&&(L[0]+=s[1],L[1]+=h[1],C=0,S())});if(ao.event.changedTouches?q.on("touchmove.brush",d).on("touchend.brush",m):q.on("mousemove.brush",d).on("mouseup.brush",m),k.interrupt().selectAll("*").interrupt(),C)L[0]=s[0]-L[0],L[1]=h[0]-L[1];else if(N){var T=+/w$/.test(N),R=+/^n/.test(N);x=[s[1-T]-L[0],h[1-R]-L[1]],L[0]=s[T],L[1]=h[R]}else ao.event.altKey&&(M=L.slice());k.style("pointer-events","none").selectAll(".resize").style("display",null),ao.select("body").style("cursor",_.style("cursor")),w({type:"brushstart"}),d()}var o,a,l=N(n,"brushstart","brush","brushend"),c=null,f=null,s=[0,0],h=[0,0],p=!0,g=!0,v=Bl[0];return n.event=function(n){n.each(function(){var n=l.of(this,arguments),t={x:s,y:h,i:o,j:a},e=this.__chart__||t;this.__chart__=t,Hl?ao.select(this).transition().each("start.brush",function(){o=e.i,a=e.j,s=e.x,h=e.y,n({type:"brushstart"})}).tween("brush:brush",function(){var e=xr(s,t.x),r=xr(h,t.y);return o=a=null,function(i){s=t.x=e(i),h=t.y=r(i),n({type:"brush",mode:"resize"})}}).each("end.brush",function(){o=t.i,a=t.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))})},n.x=function(t){return arguments.length?(c=t,v=Bl[!c<<1|!f],n):c},n.y=function(t){return arguments.length?(f=t,v=Bl[!c<<1|!f],n):f},n.clamp=function(t){return arguments.length?(c&&f?(p=!!t[0],g=!!t[1]):c?p=!!t:f&&(g=!!t),n):c&&f?[p,g]:c?p:f?g:null},n.extent=function(t){var e,r,i,u,l;return arguments.length?(c&&(e=t[0],r=t[1],f&&(e=e[0],r=r[0]),o=[e,r],c.invert&&(e=c(e),r=c(r)),e>r&&(l=e,e=r,r=l),e==s[0]&&r==s[1]||(s=[e,r])),f&&(i=t[0],u=t[1],c&&(i=i[1],u=u[1]),a=[i,u],f.invert&&(i=f(i),u=f(u)),i>u&&(l=i,i=u,u=l),i==h[0]&&u==h[1]||(h=[i,u])),n):(c&&(o?(e=o[0],r=o[1]):(e=s[0],r=s[1],c.invert&&(e=c.invert(e),r=c.invert(r)),e>r&&(l=e,e=r,r=l))),f&&(a?(i=a[0],u=a[1]):(i=h[0],u=h[1],f.invert&&(i=f.invert(i),u=f.invert(u)),i>u&&(l=i,i=u,u=l))),c&&f?[[e,i],[r,u]]:c?[e,r]:f&&[i,u])},n.clear=function(){return n.empty()||(s=[0,0],h=[0,0],o=a=null),n},n.empty=function(){return!!c&&s[0]==s[1]||!!f&&h[0]==h[1]},ao.rebind(n,l,"on")};var $l={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Bl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Wl=ga.format=xa.timeFormat,Jl=Wl.utc,Gl=Jl("%Y-%m-%dT%H:%M:%S.%LZ");Wl.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?eo:Gl,eo.parse=function(n){var t=new Date(n);return isNaN(t)?null:t},eo.toString=Gl.toString,ga.second=On(function(n){return new va(1e3*Math.floor(n/1e3))},function(n,t){n.setTime(n.getTime()+1e3*Math.floor(t))},function(n){return n.getSeconds()}),ga.seconds=ga.second.range,ga.seconds.utc=ga.second.utc.range,ga.minute=On(function(n){return new va(6e4*Math.floor(n/6e4))},function(n,t){n.setTime(n.getTime()+6e4*Math.floor(t))},function(n){return n.getMinutes()}),ga.minutes=ga.minute.range,ga.minutes.utc=ga.minute.utc.range,ga.hour=On(function(n){var t=n.getTimezoneOffset()/60;return new va(36e5*(Math.floor(n/36e5-t)+t))},function(n,t){n.setTime(n.getTime()+36e5*Math.floor(t))},function(n){return n.getHours()}),ga.hours=ga.hour.range,ga.hours.utc=ga.hour.utc.range,ga.month=On(function(n){return(n=ga.day(n)).setDate(1),n},function(n,t){n.setMonth(n.getMonth()+t)},function(n){return n.getMonth()}),ga.months=ga.month.range,ga.months.utc=ga.month.utc.range;var Kl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Ql=[[ga.second,1],[ga.second,5],[ga.second,15],[ga.second,30],[ga.minute,1],[ga.minute,5],[ga.minute,15],[ga.minute,30],[ga.hour,1],[ga.hour,3],[ga.hour,6],[ga.hour,12],[ga.day,1],[ga.day,2],[ga.week,1],[ga.month,1],[ga.month,3],[ga.year,1]],nc=Wl.multi([[".%L",function(n){return n.getMilliseconds()}],[":%S",function(n){return n.getSeconds()}],["%I:%M",function(n){return n.getMinutes()}],["%I %p",function(n){return n.getHours()}],["%a %d",function(n){return n.getDay()&&1!=n.getDate()}],["%b %d",function(n){return 1!=n.getDate()}],["%B",function(n){return n.getMonth()}],["%Y",zt]]),tc={range:function(n,t,e){return ao.range(Math.ceil(n/e)*e,+t,e).map(io)},floor:m,ceil:m};Ql.year=ga.year,ga.scale=function(){return ro(ao.scale.linear(),Ql,nc)};var ec=Ql.map(function(n){return[n[0].utc,n[1]]}),rc=Jl.multi([[".%L",function(n){return n.getUTCMilliseconds()}],[":%S",function(n){return n.getUTCSeconds()}],["%I:%M",function(n){return n.getUTCMinutes()}],["%I %p",function(n){return n.getUTCHours()}],["%a %d",function(n){return n.getUTCDay()&&1!=n.getUTCDate()}],["%b %d",function(n){return 1!=n.getUTCDate()}],["%B",function(n){return n.getUTCMonth()}],["%Y",zt]]);ec.year=ga.year.utc,ga.scale.utc=function(){return ro(ao.scale.linear(),ec,rc)},ao.text=An(function(n){return n.responseText}),ao.json=function(n,t){return Cn(n,"application/json",uo,t)},ao.html=function(n,t){return Cn(n,"text/html",oo,t)},ao.xml=An(function(n){return n.responseXML}),"function"==typeof define&&define.amd?(this.d3=ao,define(ao)):"object"==typeof module&&module.exports?module.exports=ao:this.d3=ao}(),function($){var o=$({});$.subscribe=function(){o.on.apply(o,arguments)},$.unsubscribe=function(){o.off.apply(o,arguments)},$.publish=function(){o.trigger.apply(o,arguments)}}(jQuery),function(f,n){"object"==typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(n):f.IPv6=n(f)}(this,function(f){var n=f&&f.IPv6;return{best:function(h){var k=(h=h.toLowerCase().split(":")).length,b=8;""===h[0]&&""===h[1]&&""===h[2]?(h.shift(),h.shift()):""===h[0]&&""===h[1]?h.shift():""===h[k-1]&&""===h[k-2]&&h.pop(),-1!==h[(k=h.length)-1].indexOf(".")&&(b=7);var q;for(q=0;q<k&&""!==h[q];q++);if(q<b)for(h.splice(q,1,"0000");h.length<b;)h.splice(q,0,"0000");for(q=0;q<b;q++){k=h[q].split("");for(var f=0;3>f&&("0"===k[0]&&1<k.length);f++)k.splice(0,1);h[q]=k.join("")}k=-1;var n=f=0,g=-1,p=!1;for(q=0;q<b;q++)p?"0"===h[q]?n+=1:(p=!1,n>f&&(k=g,f=n)):"0"===h[q]&&(p=!0,g=q,n=1);for(n>f&&(k=g,f=n),1<f&&h.splice(k,f,""),k=h.length,b="",""===h[0]&&(b=":"),q=0;q<k&&(b+=h[q],q!==k-1);q++)b+=":";return""===h[k-1]&&(b+=":"),b},noConflict:function(){return f.IPv6===this&&(f.IPv6=n),this}}}),function(f){function n(b){throw new RangeError(w[b])}function h(b,e){for(var g=b.length,h=[];g--;)h[g]=e(b[g]);return h}function k(b,e){var g=b.split("@"),f="";return 1<g.length&&(f=g[0]+"@",b=g[1]),b=b.replace(C,"."),g=b.split("."),g=h(g,e).join("."),f+g}function b(b){for(var f,a,e=[],g=0,h=b.length;g<h;)55296<=(f=b.charCodeAt(g++))&&56319>=f&&g<h?56320==(64512&(a=b.charCodeAt(g++)))?e.push(((1023&f)<<10)+(1023&a)+65536):(e.push(f),g--):e.push(f);return e}function q(b){return h(b,function(b){var e="";return 65535<b&&(b-=65536,e+=t(b>>>10&1023|55296),b=56320|1023&b),e+=t(b)}).join("")}function z(b,e){return b+22+75*(26>b)-((0!=e)<<5)}function u(b,g,h){var f=0;for(b=h?e(b/700):b>>1,b+=e(b/g);455<b;f+=36)b=e(b/35);return e(f+36*b/(b+38))}function g(b){var c,d,g=[],h=b.length,f=0,k=128,a=72,l=b.lastIndexOf("-");for(0>l&&(l=0),c=0;c<l;++c)128<=b.charCodeAt(c)&&n("not-basic"),g.push(b.charCodeAt(c));for(l=0<l?l+1:0;l<h;){c=f;var m=1;for(d=36;;d+=36){l>=h&&n("invalid-input");var x=b.charCodeAt(l++);(36<=(x=10>x-48?x-22:26>x-65?x-65:26>x-97?x-97:36)||x>e((2147483647-f)/m))&&n("overflow"),f+=x*m;var p=d<=a?1:d>=a+26?26:d-a;if(x<p)break;m>e(2147483647/(x=36-p))&&n("overflow"),m*=x}a=u(f-c,m=g.length+1,0==c),e(f/m)>2147483647-k&&n("overflow"),k+=e(f/m),f%=m,g.splice(f++,0,k)}return q(g)}function p(g){var h,f,k,p=[],a=(g=b(g)).length,c=128,d=0,l=72;for(k=0;k<a;++k){var m=g[k];128>m&&p.push(t(m))}for((h=f=p.length)&&p.push("-");h<a;){var x=2147483647;for(k=0;k<a;++k)(m=g[k])>=c&&m<x&&(x=m);var q=h+1;for(x-c>e((2147483647-d)/q)&&n("overflow"),d+=(x-c)*q,c=x,k=0;k<a;++k)if((m=g[k])<c&&2147483647<++d&&n("overflow"),m==c){var r=d;for(x=36;m=x<=l?1:x>=l+26?26:x-l,!(r<m);x+=36){var A=r-m;r=36-m,p.push(t(z(m+A%r,0))),r=e(A/r)}p.push(t(z(r,0))),l=u(d,q,h==f),d=0,++h}++d,++c}return p.join("")}var D="object"==typeof exports&&exports&&!exports.nodeType&&exports,A="object"==typeof module&&module&&!module.nodeType&&module,B="object"==typeof global&&global;B.global!==B&&B.window!==B&&B.self!==B||(f=B);var y,E=/^xn--/,r=/[^\x20-\x7E]/,C=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},e=Math.floor,t=String.fromCharCode,v={version:"1.3.2",ucs2:{decode:b,encode:q},decode:g,encode:p,toASCII:function(b){return k(b,function(b){return r.test(b)?"xn--"+p(b):b})},toUnicode:function(b){return k(b,function(b){return E.test(b)?g(b.slice(4).toLowerCase()):b})}};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return v});else if(D&&A)if(module.exports==D)A.exports=v;else for(y in v)v.hasOwnProperty(y)&&(D[y]=v[y]);else f.punycode=v}(this),function(f,n){"object"==typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(n):f.SecondLevelDomains=n(f)}(this,function(f){var n=f&&f.SecondLevelDomains,h={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(f){var b=f.lastIndexOf(".");if(0>=b||b>=f.length-1)return!1;var k=f.lastIndexOf(".",b-1);if(0>=k||k>=b-1)return!1;var n=h.list[f.slice(b+1)];return!!n&&0<=n.indexOf(" "+f.slice(k+1,b)+" ")},is:function(f){var b=f.lastIndexOf(".");if(0>=b||b>=f.length-1||0<=f.lastIndexOf(".",b-1))return!1;var k=h.list[f.slice(b+1)];return!!k&&0<=k.indexOf(" "+f.slice(0,b)+" ")},get:function(f){var b=f.lastIndexOf(".");if(0>=b||b>=f.length-1)return null;var k=f.lastIndexOf(".",b-1);if(0>=k||k>=b-1)return null;var n=h.list[f.slice(b+1)];return!n||0>n.indexOf(" "+f.slice(k+1,b)+" ")?null:f.slice(k+1)},noConflict:function(){return f.SecondLevelDomains===this&&(f.SecondLevelDomains=n),this}};return h}),function(f,n){"object"==typeof module&&module.exports?module.exports=n(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],n):f.URI=n(f.punycode,f.IPv6,f.SecondLevelDomains,f)}(this,function(f,n,h,k){function b(a,c){var d=1<=arguments.length,l=2<=arguments.length;if(!(this instanceof b))return d?l?new b(a,c):new b(a):new b;if(void 0===a){if(d)throw new TypeError("undefined is not a valid argument for URI");a="undefined"!=typeof location?location.href+"":""}if(null===a&&d)throw new TypeError("null is not a valid argument for URI");return this.href(a),void 0!==c?this.absoluteTo(c):this}function q(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function z(a){return void 0===a?"Undefined":String(Object.prototype.toString.call(a)).slice(8,-1)}function u(a){return"Array"===z(a)}function g(a,c){var b,d={};if("RegExp"===z(c))d=null;else if(u(c)){var m=0;for(b=c.length;m<b;m++)d[c[m]]=!0}else d[c]=!0;for(m=0,b=a.length;m<b;m++)(d&&void 0!==d[a[m]]||!d&&c.test(a[m]))&&(a.splice(m,1),b--,m--);return a}function p(a,c){var d;if(u(c)){var b=0;for(d=c.length;b<d;b++)if(!p(a,c[b]))return!1;return!0}var m=z(c);for(b=0,d=a.length;b<d;b++)if("RegExp"===m){if("string"==typeof a[b]&&a[b].match(c))return!0}else if(a[b]===c)return!0;return!1}function D(a,c){if(!u(a)||!u(c)||a.length!==c.length)return!1;a.sort(),c.sort();for(var d=0,b=a.length;d<b;d++)if(a[d]!==c[d])return!1;return!0}function A(a){return a.replace(/^\/+|\/+$/g,"")}function B(a){return escape(a)}function E(a){return encodeURIComponent(a).replace(/[!'()*]/g,B).replace(/\*/g,"%2A")}function r(a){return function(c,d){return void 0===c?this._parts[a]||"":(this._parts[a]=c||null,this.build(!d),this)}}function C(a,c){return function(d,b){return void 0===d?this._parts[a]||"":(null!==d&&(d+="").charAt(0)===c&&(d=d.substring(1)),this._parts[a]=d,this.build(!b),this)}}var w=k&&k.URI;b.version="1.19.0";var e=b.prototype,t=Object.prototype.hasOwnProperty;b._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:b.preventInvalidHostname,duplicateQueryParameters:b.duplicateQueryParameters,escapeQuerySpace:b.escapeQuerySpace}},b.preventInvalidHostname=!1,b.duplicateQueryParameters=!1,b.escapeQuerySpace=!0,b.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,b.idn_expression=/[^a-z0-9\._-]/i,b.punycode_expression=/(xn--)/i,b.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,b.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,b.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/gi,b.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u201e\u2018\u2019]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},b.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},b.hostProtocols=["http","https"],b.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,b.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},b.getDomAttribute=function(a){if(a&&a.nodeName){var c=a.nodeName.toLowerCase();if("input"!==c||"image"===a.type)return b.domAttributes[c]}},b.encode=E,b.decode=decodeURIComponent,b.iso8859=function(){b.encode=escape,b.decode=unescape},b.unicode=function(){b.encode=E,b.decode=decodeURIComponent},b.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},b.encodeQuery=function(a,c){var d=b.encode(a+"");return void 0===c&&(c=b.escapeQuerySpace),c?d.replace(/%20/g,"+"):d},b.decodeQuery=function(a,c){a+="",void 0===c&&(c=b.escapeQuerySpace);try{return b.decode(c?a.replace(/\+/g,"%20"):a)}catch(d){return a}};var v,y={encode:"encode",decode:"decode"},F=function(a,c){return function(d){try{return b[c](d+"").replace(b.characters[a][c].expression,function(d){return b.characters[a][c].map[d]})}catch(l){return d}}};for(v in y)b[v+"PathSegment"]=F("pathname",y[v]),b[v+"UrnPathSegment"]=F("urnpath",y[v]);b.decodePath=(y=function(a,c,d){return function(l){for(var m=d?function(a){return b[c](b[d](a))}:b[c],e=0,g=(l=(l+"").split(a)).length;e<g;e++)l[e]=m(l[e]);return l.join(a)}})("/","decodePathSegment"),b.decodeUrnPath=y(":","decodeUrnPathSegment"),b.recodePath=y("/","encodePathSegment","decode"),b.recodeUrnPath=y(":","encodeUrnPathSegment","decode"),b.encodeReserved=F("reserved","encode"),b.parse=function(a,c){c||(c={preventInvalidHostname:b.preventInvalidHostname});var d=a.indexOf("#");return-1<d&&(c.fragment=a.substring(d+1)||null,a=a.substring(0,d)),-1<(d=a.indexOf("?"))&&(c.query=a.substring(d+1)||null,a=a.substring(0,d)),"//"===a.substring(0,2)?(c.protocol=null,a=a.substring(2),a=b.parseAuthority(a,c)):-1<(d=a.indexOf(":"))&&(c.protocol=a.substring(0,d)||null,c.protocol&&!c.protocol.match(b.protocol_expression)?c.protocol=void 0:"//"===a.substring(d+1,d+3)?(a=a.substring(d+3),a=b.parseAuthority(a,c)):(a=a.substring(d+1),c.urn=!0)),c.path=a,c},b.parseHost=function(a,c){a||(a="");var d=(a=a.replace(/\\/g,"/")).indexOf("/");if(-1===d&&(d=a.length),"["===a.charAt(0)){var l=a.indexOf("]");c.hostname=a.substring(1,l)||null,c.port=a.substring(l+2,d)||null,"/"===c.port&&(c.port=null)}else{var m=a.indexOf(":");l=a.indexOf("/"),-1!==(m=a.indexOf(":",m+1))&&(-1===l||m<l)?(c.hostname=a.substring(0,d)||null,c.port=null):(l=a.substring(0,d).split(":"),c.hostname=l[0]||null,c.port=l[1]||null)}return c.hostname&&"/"!==a.substring(d).charAt(0)&&(d++,a="/"+a),c.preventInvalidHostname&&b.ensureValidHostname(c.hostname,c.protocol),c.port&&b.ensureValidPort(c.port),a.substring(d)||"/"},b.parseAuthority=function(a,c){return a=b.parseUserinfo(a,c),b.parseHost(a,c)},b.parseUserinfo=function(a,c){var d=a.indexOf("/"),l=a.lastIndexOf("@",-1<d?d:a.length-1);return-1<l&&(-1===d||l<d)?(d=a.substring(0,l).split(":"),c.username=d[0]?b.decode(d[0]):null,d.shift(),c.password=d[0]?b.decode(d.join(":")):null,a=a.substring(l+1)):(c.username=null,c.password=null),a},b.parseQuery=function(a,c){if(!a)return{};if(!(a=a.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var e,g,d={},l=a.split("&"),m=l.length,f=0;f<m;f++)e=l[f].split("="),g=b.decodeQuery(e.shift(),c),e=e.length?b.decodeQuery(e.join("="),c):null,t.call(d,g)?("string"!=typeof d[g]&&null!==d[g]||(d[g]=[d[g]]),d[g].push(e)):d[g]=e;return d},b.build=function(a){var c="";return a.protocol&&(c+=a.protocol+":"),a.urn||!c&&!a.hostname||(c+="//"),c+=b.buildAuthority(a)||"","string"==typeof a.path&&("/"!==a.path.charAt(0)&&"string"==typeof a.hostname&&(c+="/"),c+=a.path),"string"==typeof a.query&&a.query&&(c+="?"+a.query),"string"==typeof a.fragment&&a.fragment&&(c+="#"+a.fragment),c},b.buildHost=function(a){var c="";return a.hostname?(c=b.ip6_expression.test(a.hostname)?c+"["+a.hostname+"]":c+a.hostname,a.port&&(c+=":"+a.port),c):""},b.buildAuthority=function(a){return b.buildUserinfo(a)+b.buildHost(a)},b.buildUserinfo=function(a){var c="";return a.username&&(c+=b.encode(a.username)),a.password&&(c+=":"+b.encode(a.password)),c&&(c+="@"),c},b.buildQuery=function(a,c,d){var m,e,l="";for(m in a)if(t.call(a,m)&&m)if(u(a[m])){var g={},f=0;for(e=a[m].length;f<e;f++)void 0!==a[m][f]&&void 0===g[a[m][f]+""]&&(l+="&"+b.buildQueryParameter(m,a[m][f],d),!0!==c&&(g[a[m][f]+""]=!0))}else void 0!==a[m]&&(l+="&"+b.buildQueryParameter(m,a[m],d));return l.substring(1)},b.buildQueryParameter=function(a,c,d){return b.encodeQuery(a,d)+(null!==c?"="+b.encodeQuery(c,d):"")},b.addQuery=function(a,c,d){if("object"==typeof c)for(var l in c)t.call(c,l)&&b.addQuery(a,l,c[l]);else{if("string"!=typeof c)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");void 0===a[c]?a[c]=d:("string"==typeof a[c]&&(a[c]=[a[c]]),u(d)||(d=[d]),a[c]=(a[c]||[]).concat(d))}},b.setQuery=function(a,c,d){if("object"==typeof c)for(var l in c)t.call(c,l)&&b.setQuery(a,l,c[l]);else{if("string"!=typeof c)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");a[c]=void 0===d?null:d}},b.removeQuery=function(a,c,d){var l;if(u(c))for(d=0,l=c.length;d<l;d++)a[c[d]]=void 0;else if("RegExp"===z(c))for(l in a)c.test(l)&&(a[l]=void 0);else if("object"==typeof c)for(l in c)t.call(c,l)&&b.removeQuery(a,l,c[l]);else{if("string"!=typeof c)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==d?"RegExp"===z(d)?!u(a[c])&&d.test(a[c])?a[c]=void 0:a[c]=g(a[c],d):a[c]!==String(d)||u(d)&&1!==d.length?u(a[c])&&(a[c]=g(a[c],d)):a[c]=void 0:a[c]=void 0}},b.hasQuery=function(a,c,d,l){switch(z(c)){case"String":break;case"RegExp":for(var m in a)if(t.call(a,m)&&c.test(m)&&(void 0===d||b.hasQuery(a,m,d)))return!0;return!1;case"Object":for(var e in c)if(t.call(c,e)&&!b.hasQuery(a,e,c[e]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(z(d)){case"Undefined":return c in a;case"Boolean":return a=!(u(a[c])?!a[c].length:!a[c]),d===a;case"Function":return!!d(a[c],c,a);case"Array":return!!u(a[c])&&(l?p:D)(a[c],d);case"RegExp":return u(a[c])?!!l&&p(a[c],d):!(!a[c]||!a[c].match(d));case"Number":d=String(d);case"String":return u(a[c])?!!l&&p(a[c],d):a[c]===d;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},b.joinPaths=function(){for(var a=[],c=[],d=0,l=0;l<arguments.length;l++){var m=new b(arguments[l]);a.push(m),m=m.segment();for(var e=0;e<m.length;e++)"string"==typeof m[e]&&c.push(m[e]),m[e]&&d++}return c.length&&d?(c=new b("").segment(c),""!==a[0].path()&&"/"!==a[0].path().slice(0,1)||c.path("/"+c.path()),c.normalize()):new b("")},b.commonPath=function(a,c){var b,d=Math.min(a.length,c.length);for(b=0;b<d;b++)if(a.charAt(b)!==c.charAt(b)){b--;break}return 1>b?a.charAt(0)===c.charAt(0)&&"/"===a.charAt(0)?"/":"":("/"===a.charAt(b)&&"/"===c.charAt(b)||(b=a.substring(0,b).lastIndexOf("/")),a.substring(0,b+1))},b.withinString=function(a,c,d){d||(d={});var l=d.start||b.findUri.start,m=d.end||b.findUri.end,e=d.trim||b.findUri.trim,g=d.parens||b.findUri.parens,f=/[a-z0-9-]=["']?$/i;for(l.lastIndex=0;;){var h=l.exec(a);if(!h)break;var k=h.index;if(d.ignoreHtml){var p=a.slice(Math.max(k-3,0),k);if(p&&f.test(p))continue}var n=k+a.slice(k).search(m);for(p=a.slice(k,n),n=-1;;){var r=g.exec(p);if(!r)break;n=Math.max(n,r.index+r[0].length)}(p=-1<n?p.slice(0,n)+p.slice(n).replace(e,""):p.replace(e,"")).length<=h[0].length||d.ignore&&d.ignore.test(p)||(n=k+p.length,void 0===(h=c(p,k,n,a))?l.lastIndex=n:(h=String(h),a=a.slice(0,k)+h+a.slice(n),l.lastIndex=k+h.length))}return l.lastIndex=0,a},b.ensureValidHostname=function(a,c){var d=!!a,l=!1;if(c&&(l=p(b.hostProtocols,c)),l&&!d)throw new TypeError("Hostname cannot be empty, if protocol is "+c);if(a&&a.match(b.invalid_hostname_characters)){if(!f)throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(f.toASCII(a).match(b.invalid_hostname_characters))throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-:_]')}},b.ensureValidPort=function(a){if(a){var c=Number(a);if(!(/^[0-9]+$/.test(c)&&0<c&&65536>c))throw new TypeError('Port "'+a+'" is not a valid port')}},b.noConflict=function(a){return a?(a={URI:this.noConflict()},k.URITemplate&&"function"==typeof k.URITemplate.noConflict&&(a.URITemplate=k.URITemplate.noConflict()),k.IPv6&&"function"==typeof k.IPv6.noConflict&&(a.IPv6=k.IPv6.noConflict()),k.SecondLevelDomains&&"function"==typeof k.SecondLevelDomains.noConflict&&(a.SecondLevelDomains=k.SecondLevelDomains.noConflict()),a):(k.URI===this&&(k.URI=w),this)},e.build=function(a){return!0===a?this._deferred_build=!0:(void 0===a||this._deferred_build)&&(this._string=b.build(this._parts),this._deferred_build=!1),this},e.clone=function(){return new b(this)},e.valueOf=e.toString=function(){return this.build(!1)._string},e.protocol=r("protocol"),e.username=r("username"),e.password=r("password"),e.hostname=r("hostname"),e.port=r("port"),e.query=C("query","?"),e.fragment=C("fragment","#"),e.search=function(a,c){var b=this.query(a,c);return"string"==typeof b&&b.length?"?"+b:b},e.hash=function(a,c){var b=this.fragment(a,c);return"string"==typeof b&&b.length?"#"+b:b},e.pathname=function(a,c){if(void 0===a||!0===a){var d=this._parts.path||(this._parts.hostname?"/":"");return a?(this._parts.urn?b.decodeUrnPath:b.decodePath)(d):d}return this._parts.path=this._parts.urn?a?b.recodeUrnPath(a):"":a?b.recodePath(a):"/",this.build(!c),this},e.path=e.pathname,e.href=function(a,c){var d;if(void 0===a)return this.toString();this._string="",this._parts=b._parts();var l=a instanceof b,e="object"==typeof a&&(a.hostname||a.path||a.pathname);if(a.nodeName&&(e=b.getDomAttribute(a),a=a[e]||"",e=!1),!l&&e&&void 0!==a.pathname&&(a=a.toString()),"string"==typeof a||a instanceof String)this._parts=b.parse(String(a),this._parts);else{if(!l&&!e)throw new TypeError("invalid input");for(d in l=l?a._parts:a)t.call(this._parts,d)&&(this._parts[d]=l[d])}return this.build(!c),this},e.is=function(a){var c=!1,d=!1,e=!1,m=!1,g=!1,f=!1,k=!1,p=!this._parts.urn;switch(this._parts.hostname&&(p=!1,d=b.ip4_expression.test(this._parts.hostname),e=b.ip6_expression.test(this._parts.hostname),c=d||e,g=(m=!c)&&h&&h.has(this._parts.hostname),f=m&&b.idn_expression.test(this._parts.hostname),k=m&&b.punycode_expression.test(this._parts.hostname)),a.toLowerCase()){case"relative":return p;case"absolute":return!p;case"domain":case"name":return m;case"sld":return g;case"ip":return c;case"ip4":case"ipv4":case"inet4":return d;case"ip6":case"ipv6":case"inet6":return e;case"idn":return f;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return k}return null};var G=e.protocol,H=e.port,I=e.hostname;e.protocol=function(a,c){if(a&&!(a=a.replace(/:(\/\/)?$/,"")).match(b.protocol_expression))throw new TypeError('Protocol "'+a+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return G.call(this,a,c)},e.scheme=e.protocol,e.port=function(a,c){return this._parts.urn?void 0===a?"":this:(void 0!==a&&(0===a&&(a=null),a&&(":"===(a+="").charAt(0)&&(a=a.substring(1)),b.ensureValidPort(a))),H.call(this,a,c))},e.hostname=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a){var d={preventInvalidHostname:this._parts.preventInvalidHostname};if("/"!==b.parseHost(a,d))throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');a=d.hostname,this._parts.preventInvalidHostname&&b.ensureValidHostname(a,this._parts.protocol)}return I.call(this,a,c)},e.origin=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){var d=this.protocol();return this.authority()?(d?d+"://":"")+this.authority():""}return d=b(a),this.protocol(d.protocol()).authority(d.authority()).build(!c),this},e.host=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a)return this._parts.hostname?b.buildHost(this._parts):"";if("/"!==b.parseHost(a,this._parts))throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');return this.build(!c),this},e.authority=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a)return this._parts.hostname?b.buildAuthority(this._parts):"";if("/"!==b.parseAuthority(a,this._parts))throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');return this.build(!c),this},e.userinfo=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){var d=b.buildUserinfo(this._parts);return d?d.substring(0,d.length-1):d}return"@"!==a[a.length-1]&&(a+="@"),b.parseUserinfo(a,this._parts),this.build(!c),this},e.resource=function(a,c){if(void 0===a)return this.path()+this.search()+this.hash();var d=b.parse(a);return this._parts.path=d.path,this._parts.query=d.query,this._parts.fragment=d.fragment,this.build(!c),this},e.subdomain=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var d=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,d)||""}if(d=this._parts.hostname.length-this.domain().length,d=this._parts.hostname.substring(0,d),d=new RegExp("^"+q(d)),a&&"."!==a.charAt(a.length-1)&&(a+="."),-1!==a.indexOf(":"))throw new TypeError("Domains cannot contain colons");return a&&b.ensureValidHostname(a,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(d,a),this.build(!c),this},e.domain=function(a,c){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(c=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var d=this._parts.hostname.match(/\./g);return d&&2>d.length?this._parts.hostname:(d=this._parts.hostname.length-this.tld(c).length-1,d=this._parts.hostname.lastIndexOf(".",d-1)+1,this._parts.hostname.substring(d)||"")}if(!a)throw new TypeError("cannot set domain empty");if(-1!==a.indexOf(":"))throw new TypeError("Domains cannot contain colons");return b.ensureValidHostname(a,this._parts.protocol),!this._parts.hostname||this.is("IP")?this._parts.hostname=a:(d=new RegExp(q(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(d,a)),this.build(!c),this},e.tld=function(a,c){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(c=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var b=this._parts.hostname.lastIndexOf(".");return b=this._parts.hostname.substring(b+1),!0!==c&&h&&h.list[b.toLowerCase()]?h.get(this._parts.hostname)||b:b}if(!a)throw new TypeError("cannot set TLD empty");if(a.match(/[^a-zA-Z0-9-]/)){if(!h||!h.is(a))throw new TypeError('TLD "'+a+'" contains characters other than [A-Z0-9]');b=new RegExp(q(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(b,a)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");b=new RegExp(q(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(b,a)}return this.build(!c),this},e.directory=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var d=this._parts.path.length-this.filename().length-1;return d=this._parts.path.substring(0,d)||(this._parts.hostname?"/":""),a?b.decodePath(d):d}return d=this._parts.path.length-this.filename().length,d=this._parts.path.substring(0,d),d=new RegExp("^"+q(d)),this.is("relative")||(a||(a="/"),"/"!==a.charAt(0)&&(a="/"+a)),a&&"/"!==a.charAt(a.length-1)&&(a+="/"),a=b.recodePath(a),this._parts.path=this._parts.path.replace(d,a),this.build(!c),this},e.filename=function(a,c){if(this._parts.urn)return void 0===a?"":this;if("string"!=typeof a){if(!this._parts.path||"/"===this._parts.path)return"";var d=this._parts.path.lastIndexOf("/");return d=this._parts.path.substring(d+1),a?b.decodePathSegment(d):d}d=!1,"/"===a.charAt(0)&&(a=a.substring(1)),a.match(/\.?\//)&&(d=!0);var e=new RegExp(q(this.filename())+"$");return a=b.recodePath(a),this._parts.path=this._parts.path.replace(e,a),d?this.normalizePath(c):this.build(!c),this},e.suffix=function(a,c){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path||"/"===this._parts.path)return"";var d=this.filename(),e=d.lastIndexOf(".");return-1===e?"":(d=d.substring(e+1),d=/^[a-z0-9%]+$/i.test(d)?d:"",a?b.decodePathSegment(d):d)}if("."===a.charAt(0)&&(a=a.substring(1)),d=this.suffix())e=a?new RegExp(q(d)+"$"):new RegExp(q("."+d)+"$");else{if(!a)return this;this._parts.path+="."+b.recodePath(a)}return e&&(a=b.recodePath(a),this._parts.path=this._parts.path.replace(e,a)),this.build(!c),this},e.segment=function(a,c,b){var d=this._parts.urn?":":"/",e=this.path(),g="/"===e.substring(0,1);if(e=e.split(d),void 0!==a&&"number"!=typeof a&&(b=c,c=a,a=void 0),void 0!==a&&"number"!=typeof a)throw Error('Bad segment "'+a+'", must be 0-based integer');if(g&&e.shift(),0>a&&(a=Math.max(e.length+a,0)),void 0===c)return void 0===a?e:e[a];if(null===a||void 0===e[a])if(u(c)){e=[],a=0;for(var f=c.length;a<f;a++)(c[a].length||e.length&&e[e.length-1].length)&&(e.length&&!e[e.length-1].length&&e.pop(),e.push(A(c[a])))}else(c||"string"==typeof c)&&(c=A(c),""===e[e.length-1]?e[e.length-1]=c:e.push(c));else c?e[a]=A(c):e.splice(a,1);return g&&e.unshift(""),this.path(e.join(d),b)},e.segmentCoded=function(a,c,d){var e;if("number"!=typeof a&&(d=c,c=a,a=void 0),void 0===c){if(a=this.segment(a,c,d),u(a)){var g=0;for(e=a.length;g<e;g++)a[g]=b.decode(a[g])}else a=void 0!==a?b.decode(a):void 0;return a}if(u(c))for(g=0,e=c.length;g<e;g++)c[g]=b.encode(c[g]);else c="string"==typeof c||c instanceof String?b.encode(c):c;return this.segment(a,c,d)};var J=e.query;return e.query=function(a,c){if(!0===a)return b.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof a){var d=b.parseQuery(this._parts.query,this._parts.escapeQuerySpace),e=a.call(this,d);return this._parts.query=b.buildQuery(e||d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!c),this}return void 0!==a&&"string"!=typeof a?(this._parts.query=b.buildQuery(a,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!c),this):J.call(this,a,c)},e.setQuery=function(a,c,d){var e=b.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof a||a instanceof String)e[a]=void 0!==c?c:null;else{if("object"!=typeof a)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var g in a)t.call(a,g)&&(e[g]=a[g])}return this._parts.query=b.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(d=c),this.build(!d),this},e.addQuery=function(a,c,d){var e=b.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return b.addQuery(e,a,void 0===c?null:c),this._parts.query=b.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(d=c),this.build(!d),this},e.removeQuery=function(a,c,d){var e=b.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return b.removeQuery(e,a,c),this._parts.query=b.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(d=c),this.build(!d),this},e.hasQuery=function(a,c,d){var e=b.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return b.hasQuery(e,a,c,d)},e.setSearch=e.setQuery,e.addSearch=e.addQuery,e.removeSearch=e.removeQuery,e.hasSearch=e.hasQuery,e.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},e.normalizeProtocol=function(a){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!a)),this},e.normalizeHostname=function(a){return this._parts.hostname&&(this.is("IDN")&&f?this._parts.hostname=f.toASCII(this._parts.hostname):this.is("IPv6")&&n&&(this._parts.hostname=n.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!a)),this},e.normalizePort=function(a){return"string"==typeof this._parts.protocol&&this._parts.port===b.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a)),this},e.normalizePath=function(a){var c=this._parts.path;if(!c)return this;if(this._parts.urn)return this._parts.path=b.recodeUrnPath(this._parts.path),this.build(!a),this;if("/"===this._parts.path)return this;var d="";if("/"!==(c=b.recodePath(c)).charAt(0)){var e=!0;c="/"+c}for("/.."!==c.slice(-3)&&"/."!==c.slice(-2)||(c+="/"),c=c.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),e&&(d=c.substring(1).match(/^(\.\.\/)+/)||"")&&(d=d[0]);;){var g=c.search(/\/\.\.(\/|$)/);if(-1===g)break;if(0!==g){var f=c.substring(0,g).lastIndexOf("/");-1===f&&(f=g),c=c.substring(0,f)+c.substring(g+3)}else c=c.substring(3)}return e&&this.is("relative")&&(c=d+c.substring(1)),this._parts.path=c,this.build(!a),this},e.normalizePathname=e.normalizePath,e.normalizeQuery=function(a){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(b.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!a)),this},e.normalizeFragment=function(a){return this._parts.fragment||(this._parts.fragment=null,this.build(!a)),this},e.normalizeSearch=e.normalizeQuery,e.normalizeHash=e.normalizeFragment,e.iso8859=function(){var a=b.encode,c=b.decode;b.encode=escape,b.decode=decodeURIComponent;try{this.normalize()}finally{b.encode=a,b.decode=c}return this},e.unicode=function(){var a=b.encode,c=b.decode;b.encode=E,b.decode=unescape;try{this.normalize()}finally{b.encode=a,b.decode=c}return this},e.readable=function(){var a=this.clone();a.username("").password("").normalize();var c="";if(a._parts.protocol&&(c+=a._parts.protocol+"://"),a._parts.hostname&&(a.is("punycode")&&f?(c+=f.toUnicode(a._parts.hostname),a._parts.port&&(c+=":"+a._parts.port)):c+=a.host()),a._parts.hostname&&a._parts.path&&"/"!==a._parts.path.charAt(0)&&(c+="/"),c+=a.path(!0),a._parts.query){for(var d="",e=0,g=a._parts.query.split("&"),h=g.length;e<h;e++){var k=(g[e]||"").split("=");d+="&"+b.decodeQuery(k[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==k[1]&&(d+="="+b.decodeQuery(k[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}c+="?"+d.substring(1)}return c+=b.decodeQuery(a.hash(),!0)},e.absoluteTo=function(a){var e,g,c=this.clone(),d=["protocol","username","password","hostname","port"];if(this._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");if(a instanceof b||(a=new b(a)),c._parts.protocol)return c;if(c._parts.protocol=a._parts.protocol,this._parts.hostname)return c;for(e=0;g=d[e];e++)c._parts[g]=a._parts[g];return c._parts.path?(".."===c._parts.path.substring(-2)&&(c._parts.path+="/"),"/"!==c.path().charAt(0)&&(d=(d=a.directory())?d:0===a.path().indexOf("/")?"/":"",c._parts.path=(d?d+"/":"")+c._parts.path,c.normalizePath())):(c._parts.path=a._parts.path,c._parts.query||(c._parts.query=a._parts.query)),c.build(),c},e.relativeTo=function(a){var c=this.clone().normalize();if(c._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");a=new b(a).normalize();var d=c._parts,e=a._parts,g=c.path();if(a=a.path(),"/"!==g.charAt(0))throw Error("URI is already relative");if("/"!==a.charAt(0))throw Error("Cannot calculate a URI relative to another relative URI");return d.protocol===e.protocol&&(d.protocol=null),d.username!==e.username||d.password!==e.password||null!==d.protocol||null!==d.username||null!==d.password||d.hostname!==e.hostname||d.port!==e.port?c.build():(d.hostname=null,d.port=null,g===a?(d.path="",c.build()):(g=b.commonPath(g,a))?(e=e.path.substring(g.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../"),d.path=e+d.path.substring(g.length)||"./",c.build()):c.build())},e.equals=function(a){var c=this.clone(),d=new b(a);a={};var e;if(c.normalize(),d.normalize(),c.toString()===d.toString())return!0;var g=c.query(),f=d.query();if(c.query(""),d.query(""),c.toString()!==d.toString()||g.length!==f.length)return!1;c=b.parseQuery(g,this._parts.escapeQuerySpace),f=b.parseQuery(f,this._parts.escapeQuerySpace);for(e in c)if(t.call(c,e)){if(u(c[e])){if(!D(c[e],f[e]))return!1}else if(c[e]!==f[e])return!1;a[e]=!0}for(e in f)if(t.call(f,e)&&!a[e])return!1;return!0},e.preventInvalidHostname=function(a){return this._parts.preventInvalidHostname=!!a,this},e.duplicateQueryParameters=function(a){return this._parts.duplicateQueryParameters=!!a,this},e.escapeQuerySpace=function(a){return this._parts.escapeQuerySpace=!!a,this},b}),function(f,n){"object"==typeof module&&module.exports?module.exports=n(require("./URI")):"function"==typeof define&&define.amd?define(["./URI"],n):f.URITemplate=n(f.URI,f)}(this,function(f,n){function h(b){return h._cache[b]?h._cache[b]:this instanceof h?(this.expression=b,h._cache[b]=this,this):new h(b)}function k(b){this.data=b,this.cache={}}var b=n&&n.URITemplate,q=Object.prototype.hasOwnProperty,z=h.prototype,u={"":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encode"},"+":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},"#":{prefix:"#",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},".":{prefix:".",separator:".",named:!1,empty_name_separator:!1,encode:"encode"},"/":{prefix:"/",separator:"/",named:!1,empty_name_separator:!1,encode:"encode"},";":{prefix:";",separator:";",named:!0,empty_name_separator:!1,encode:"encode"},"?":{prefix:"?",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"},"&":{prefix:"&",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"}};return h._cache={},h.EXPRESSION_PATTERN=/\{([^a-zA-Z0-9%_]?)([^\}]+)(\}|$)/g,h.VARIABLE_PATTERN=/^([^*:.](?:\.?[^*:.])*)((\*)|:(\d+))?$/,h.VARIABLE_NAME_PATTERN=/[^a-zA-Z0-9%_.]/,h.LITERAL_PATTERN=/[<>{}"`^| \\]/,h.expand=function(b,f,k){var g=u[b.operator],p=g.named?"Named":"Unnamed";b=b.variables;var r,q,n=[];for(q=0;r=b[q];q++){var w=f.get(r.name);if(0===w.type&&k&&k.strict)throw Error('Missing expansion value for variable "'+r.name+'"');if(w.val.length){if(1<w.type&&r.maxlength)throw Error('Invalid expression: Prefix modifier not applicable to variable "'+r.name+'"');n.push(h["expand"+p](w,g,r.explode,r.explode&&g.separator||",",r.maxlength,r.name))}else w.type&&n.push("")}return n.length?g.prefix+n.join(g.separator):""},h.expandNamed=function(b,h,k,n,q,u){var g="",p=h.encode;h=h.empty_name_separator;var t,A=!b[p].length,e=2===b.type?"":f[p](u),y=0;for(t=b.val.length;y<t;y++){if(q){var v=f[p](b.val[y][1].substring(0,q));2===b.type&&(e=f[p](b.val[y][0].substring(0,q)))}else A?(v=f[p](b.val[y][1]),2===b.type?(e=f[p](b.val[y][0]),b[p].push([e,v])):b[p].push([void 0,v])):(v=b[p][y][1],2===b.type&&(e=b[p][y][0]));g&&(g+=n),k?g+=e+(h||v?"=":"")+v:(y||(g+=f[p](u)+(h||v?"=":"")),2===b.type&&(g+=e+","),g+=v)}return g},h.expandUnnamed=function(b,h,k,n,q){var g="",p=h.encode;h=h.empty_name_separator;var w,A=!b[p].length,e=0;for(w=b.val.length;e<w;e++){if(q)var t=f[p](b.val[e][1].substring(0,q));else A?(t=f[p](b.val[e][1]),b[p].push([2===b.type?f[p](b.val[e][0]):void 0,t])):t=b[p][e][1];if(g&&(g+=n),2===b.type){g+=q?f[p](b.val[e][0].substring(0,q)):b[p][e][0],g=k?g+(h||t?"=":""):g+","}g+=t}return g},h.noConflict=function(){return n.URITemplate===h&&(n.URITemplate=b),h},z.expand=function(b,f){var g="";this.parts&&this.parts.length||this.parse(),b instanceof k||(b=new k(b));for(var p=0,n=this.parts.length;p<n;p++)g+="string"==typeof this.parts[p]?this.parts[p]:h.expand(this.parts[p],b,f);return g},z.parse=function(){var b=this.expression,f=h.EXPRESSION_PATTERN,k=h.VARIABLE_PATTERN,n=h.VARIABLE_NAME_PATTERN,q=h.LITERAL_PATTERN,z=[],r=0,C=function(b){if(b.match(q))throw Error('Invalid Literal "'+b+'"');return b};for(f.lastIndex=0;;){var w=f.exec(b);if(null===w){z.push(C(b.substring(r)));break}if(z.push(C(b.substring(r,w.index))),r=w.index+w[0].length,!u[w[1]])throw Error('Unknown Operator "'+w[1]+'" in "'+w[0]+'"');if(!w[3])throw Error('Unclosed Expression "'+w[0]+'"');for(var e=w[2].split(","),t=0,y=e.length;t<y;t++){var v=e[t].match(k);if(null===v)throw Error('Invalid Variable "'+e[t]+'" in "'+w[0]+'"');if(v[1].match(n))throw Error('Invalid Variable Name "'+v[1]+'" in "'+w[0]+'"');e[t]={name:v[1],explode:!!v[3],maxlength:v[4]&&parseInt(v[4],10)}}if(!e.length)throw Error('Expression Missing Variable(s) "'+w[0]+'"');z.push({expression:w[0],operator:w[1],variables:e})}return z.length||z.push(C(b)),this.parts=z,this},k.prototype.get=function(b){var f=this.data,g={type:0,val:[],encode:[],encodeReserved:[]};if(void 0!==this.cache[b])return this.cache[b];if(this.cache[b]=g,void 0!==(f="[object Function]"===String(Object.prototype.toString.call(f))?f(b):"[object Function]"===String(Object.prototype.toString.call(f[b]))?f[b](b):f[b])&&null!==f)if("[object Array]"===String(Object.prototype.toString.call(f))){var h=0;for(b=f.length;h<b;h++)void 0!==f[h]&&null!==f[h]&&g.val.push([void 0,String(f[h])]);g.val.length&&(g.type=3)}else if("[object Object]"===String(Object.prototype.toString.call(f))){for(h in f)q.call(f,h)&&void 0!==f[h]&&null!==f[h]&&g.val.push([h,String(f[h])]);g.val.length&&(g.type=2)}else g.type=1,g.val.push([void 0,String(f)]);return g},f.expand=function(b,k){var g=new h(b).expand(k);return new f(g)},h}),function(r,v,f){function w(a,b,g){a.addEventListener?a.addEventListener(b,g,!1):a.attachEvent("on"+b,g)}function A(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return p[a.which]?p[a.which]:t[a.which]?t[a.which]:String.fromCharCode(a.which).toLowerCase()}function x(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function B(a,b){var g,c,d,f=[];for("+"===(g=a)?g=["+"]:(g=g.replace(/\+{2}/g,"+plus"),g=g.split("+")),d=0;d<g.length;++d)c=g[d],C[c]&&(c=C[c]),b&&"keypress"!=b&&D[c]&&(c=D[c],f.push("shift")),x(c)&&f.push(c);if(g=c,!(d=b)){if(!n){n={};for(var q in p)95<q&&112>q||p.hasOwnProperty(q)&&(n[p[q]]=q)}d=n[g]?"keydown":"keypress"}return"keypress"==d&&f.length&&(d="keydown"),{key:c,modifiers:f,action:d}}function E(a,b){return null!==a&&a!==v&&(a===b||E(a.parentNode,b))}function c(a){function b(a){a=a||{};var l,b=!1;for(l in n)a[l]?b=!0:n[l]=0;b||(y=!1)}function g(a,b,u,e,c,g){var l,m,k=[],f=u.type;if(!h._callbacks[a])return[];for("keyup"==f&&x(a)&&(b=[a]),l=0;l<h._callbacks[a].length;++l)if(m=h._callbacks[a][l],(e||!m.seq||n[m.seq]==m.level)&&f==m.action){var d;(d="keypress"==f&&!u.metaKey&&!u.ctrlKey)||(d=m.modifiers,d=b.sort().join(",")===d.sort().join(",")),d&&(d=e&&m.seq==e&&m.level==g,(!e&&m.combo==c||d)&&h._callbacks[a].splice(l,1),k.push(m))}return k}function f(a,b,c,e){h.stopCallback(b,b.target||b.srcElement,c,e)||!1!==a(b,c)||(b.preventDefault?b.preventDefault():b.returnValue=!1,b.stopPropagation?b.stopPropagation():b.cancelBubble=!0)}function d(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=A(a);b&&("keyup"==a.type&&z===b?z=!1:h.handleKey(b,function(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}(a),a))}function p(a,c,u,e){function l(c){return function(){y=c,++n[a],clearTimeout(r),r=setTimeout(b,1e3)}}function g(c){f(u,c,a),"keyup"!==e&&(z=A(c)),setTimeout(b,10)}for(var d=n[a]=0;d<c.length;++d){var m=d+1===c.length?g:l(e||B(c[d+1]).action);q(c[d],m,e,a,d)}}function q(a,b,c,e,d){h._directMap[a+":"+c]=b;var f=(a=a.replace(/\s+/g," ")).split(" ");1<f.length?p(a,f,b,c):(c=B(a,c),h._callbacks[c.key]=h._callbacks[c.key]||[],g(c.key,c.modifiers,{type:c.action},e,a,d),h._callbacks[c.key][e?"unshift":"push"]({callback:b,modifiers:c.modifiers,action:c.action,seq:e,level:d,combo:a}))}var h=this;if(a=a||v,!(h instanceof c))return new c(a);h.target=a,h._callbacks={},h._directMap={};var r,n={},z=!1,t=!1,y=!1;h._handleKey=function(a,c,d){var k,e=g(a,c,d);c={};var h=0,l=!1;for(k=0;k<e.length;++k)e[k].seq&&(h=Math.max(h,e[k].level));for(k=0;k<e.length;++k)e[k].seq?e[k].level==h&&(l=!0,c[e[k].seq]=1,f(e[k].callback,d,e[k].combo,e[k].seq)):l||f(e[k].callback,d,e[k].combo);e="keypress"==d.type&&t,d.type!=y||x(a)||e||b(c),t=l&&"keydown"==d.type},h._bindMultiple=function(a,b,c){for(var d=0;d<a.length;++d)q(a[d],b,c)},w(a,"keypress",d),w(a,"keydown",d),w(a,"keyup",d)}if(r){var n,p={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},t={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},D={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},C={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"};for(f=1;20>f;++f)p[111+f]="f"+f;for(f=0;9>=f;++f)p[f+96]=f.toString();c.prototype.bind=function(a,b,c){return a=a instanceof Array?a:[a],this._bindMultiple.call(this,a,b,c),this},c.prototype.unbind=function(a,b){return this.bind.call(this,a,function(){},b)},c.prototype.trigger=function(a,b){return this._directMap[a+":"+b]&&this._directMap[a+":"+b]({},a),this},c.prototype.reset=function(){return this._callbacks={},this._directMap={},this},c.prototype.stopCallback=function(a,b){return!(-1<(" "+b.className+" ").indexOf(" mousetrap ")||E(b,this.target))&&("INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable)},c.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},c.addKeycodes=function(a){for(var b in a)a.hasOwnProperty(b)&&(p[b]=a[b]);n=null},c.init=function(){var b,a=c(v);for(b in a)"_"!==b.charAt(0)&&(c[b]=function(b){return function(){return a[b].apply(a,arguments)}}(b))},c.init(),r.Mousetrap=c,"undefined"!=typeof module&&module.exports&&(module.exports=c),"function"==typeof define&&define.amd&&define(function(){return c})}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null);var Isfahan=function(configObject){function calculateLayout(node){var children=node.children;if(children&&children.length){for(var n,rect=pad(node),group=(node.type,[]),remaining=children.slice();(n=remaining.length)>0;)group.push(remaining[n-1]),remaining.pop();!function(group,groupType,rect){var o,i=-1,row="row"!==groupType,n=group.length,x=rect.x,y=rect.y,offset=0;for(;++i<n;)o=group[n-(i+1)],d=function(node,row,rect,group,n){var divisor,old=!1,dimension=row?"dy":"dx",total=rect[dimension];{if(group.forEach(function(item){void 0===!item[dimension]&&(old=!0)}),old){console.log("preserved");var sum=group.reduce(function(previousValue,currentValue,index,array){return previousValue[dimension]+currentValue[dimension]});return console.log("sum: "+sum),divisor=node[dimension]/sum*total,console.log("divisor: "+divisor),divisor}return n}}(o,row,rect,group,n),o.id=void 0!==o.id?o.id:genUuid(),o.x=row?x:x+offset,o.y=row?y+offset:y,o.dx=row?rect.dx:rect.dx/d,o.dy=row?rect.dy/d:rect.dy,offset+=row?o.dy:o.dx}(group,node.type,rect),children.forEach(function(child,index){child.address=node.address.concat("."+child.type+(index+1))}),children.forEach(calculateLayout)}}function isfahan(configObject){var nodes=hierarchy(configObject.layoutDescription),root=nodes[0];return size=function(containerSelector){return[jQuery(containerSelector).width(),jQuery(containerSelector).height()]}(configObject.containerSelector),root.x=0,root.y=0,root.dx=containerSize(containerId)[0],root.dy=containerSize(containerId)[1],root.address=root.type+"1",root.id=root.id||genUuid(),calculateLayout(root),isfahan.padding(padding),nodes=nodes.map(function(node){return merge(node,pad(node))})}function genUuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})}function d3_layout_cellPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy}}function d3_layout_cellPad(node,padding){var x=node.x+padding[3],y=node.y+padding[0],dx=node.dx-padding[1]-padding[3],dy=node.dy-padding[0]-padding[2];return dx<0&&(x+=dx/2,dx=0),dy<0&&(y+=dy/2,dy=0),{x:x,y:y,dx:dx,dy:dy}}function merge(target,source){"object"!=typeof target&&(target={});for(var property in source)if(source.hasOwnProperty(property)){var sourceProperty=source[property];if("object"==typeof sourceProperty){target[property]=util.merge(target[property],sourceProperty);continue}target[property]=sourceProperty}for(var a=2,l=arguments.length;a<l;a++)merge(target,arguments[a]);return target}var containerSize=function(containerId){return[document.getElementById(containerId).offsetWidth,document.getElementById(containerId).offsetHeight]},containerId=configObject.containerId,pad=d3_layout_cellPadNull,round=Math.round,padding=configObject.padding,hierarchy=d3.layout.hierarchy();configObject.layoutDescription;return isfahan.size=function(x){return arguments.length?(containerSize=x,isfahan):containerSize},isfahan.round=function(x){return arguments.length?(round=x?Math.round:Number,isfahan):round!=Number},isfahan.padding=function(x){function padConstant(node){return d3_layout_cellPad(node,x)}if(!arguments.length)return padding;var type;return pad=null==(padding=x)?d3_layout_cellPadNull:"function"==(type=typeof x)?function(node){var p=x.call(isfahan,node,node.depth);return console.log(p),null==p?d3_layout_cellPadNull(node):d3_layout_cellPad(node,"number"==typeof p?[p,p,p,p]:p)}:"number"===type?(x=[x,x,x,x],padConstant):padConstant,isfahan},isfahan(configObject)},paper=function(t,e){var i=(t=t||require("./node/window.js")).window,n=t.document,r=new function(){function t(t,e,r,s,a){function u(n,u){"string"==typeof(u=u||(u=o(e,n))&&(u.get?u:u.value))&&"#"===u[0]&&(u=t[u.substring(1)]||u);var c,f="function"==typeof u,d=u,_=a||f&&!u.base?u&&u.get?n in t:t[n]:null;a&&_||(f&&_&&(u.base=_),f&&!1!==s&&(c=n.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(l[c[3].toLowerCase()+c[4]]=c[2]),d&&!f&&d.get&&"function"==typeof d.get&&i.isPlainObject(d)||(d={value:d,writable:!0}),(o(t,n)||{configurable:!0}).configurable&&(d.configurable=!0,d.enumerable=r),h(t,n,d))}var l={};if(e){for(var c in e)e.hasOwnProperty(c)&&!n.test(c)&&u(c);for(var c in l){var f=l[c],d=t["set"+f],_=t["get"+f]||d&&t["is"+f];!_||!0!==s&&0!==_.length||u(c,{get:_,set:d})}}return t}function i(){for(var t=0,e=arguments.length;t<e;t++){var i=arguments[t];i&&c(this,i)}return this}var n=/^(statics|enumerable|beans|preserve)$/,r=[],s=r.slice,a=Object.create,o=Object.getOwnPropertyDescriptor,h=Object.defineProperty,u=r.forEach||function(t,e){for(var i=0,n=this.length;i<n;i++)t.call(e,this[i],i,this)},c=Object.assign||function(t){for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}return t},f=function(t,e,i){if(t){var n=o(t,"length");(n&&"number"==typeof n.value?u:function(t,e){for(var i in this)this.hasOwnProperty(i)&&t.call(e,this[i],i,this)}).call(t,e,i=i||t)}return i};return t(i,{inject:function(e){if(e){var i=!0===e.statics?e:e.statics,n=e.beans,r=e.preserve;i!==e&&t(this.prototype,e,e.enumerable,n,r),t(this,i,!0,n,r)}for(var s=1,a=arguments.length;s<a;s++)this.inject(arguments[s]);return this},extend:function(){for(var e,i,n,r=this,s=0,o=arguments.length;s<o&&(!e||!i);s++)n=arguments[s],e=e||n.initialize,i=i||n.prototype;return e=e||function(){r.apply(this,arguments)},i=e.prototype=i||a(this.prototype),h(i,"constructor",{value:e,writable:!0,configurable:!0}),t(e,this,!0),arguments.length&&this.inject.apply(e,arguments),e.base=r,e}},!0).inject({initialize:i,set:i,inject:function(){for(var e=0,i=arguments.length;e<i;e++){var n=arguments[e];n&&t(this,n,n.enumerable,n.beans,n.preserve)}return this},extend:function(){var t=a(this);return t.inject.apply(t,arguments)},each:function(t,e){return f(this,t,e)},clone:function(){return new this.constructor(this)},statics:{set:c,each:f,create:a,define:h,describe:o,clone:function(t){return c(new t.constructor,t)},isPlainObject:function(t){var e=null!=t&&t.constructor;return e&&(e===Object||e===i||"Object"===e.name)},pick:function(t,i){return t!==e?t:i},slice:function(t,e,i){return s.call(t,e,i)}}})};"undefined"!=typeof module&&(module.exports=r),r.inject({toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+r.each(this,function(t,e){if(!/^_/.test(e)){var i=typeof t;this.push(e+": "+("number"===i?h.instance.number(t):"string"===i?"'"+t+"'":t))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(t){return r.importJSON(t,this)},exportJSON:function(t){return r.exportJSON(this,t)},toJSON:function(){return r.serialize(this)},set:function(t,e){return t&&r.filter(this,t,e,this._prioritize),this},statics:{exports:{enumerable:!0},extend:function nt(){var t=nt.base.apply(this,arguments),e=t.prototype._class;return e&&!r.exports[e]&&(r.exports[e]=t),t},equals:function(t,e){if(t===e)return!0;if(t&&t.equals)return t.equals(e);if(e&&e.equals)return e.equals(t);if(t&&e&&"object"==typeof t&&"object"==typeof e){if(Array.isArray(t)&&Array.isArray(e)){if((i=t.length)!==e.length)return!1;for(;i--;)if(!r.equals(t[i],e[i]))return!1}else{var n=Object.keys(t),i=n.length;if(i!==Object.keys(e).length)return!1;for(;i--;){var s=n[i];if(!e.hasOwnProperty(s)||!r.equals(t[s],e[s]))return!1}}return!0}return!1},read:function(t,i,n,s){if(this===r){var a=this.peek(t,i);return t.__index++,a}var o=this.prototype,h=o._readIndex,u=i||h&&t.__index||0,l=t.length,c=t[u];return s=s||l-u,c instanceof this||n&&n.readNull&&null==c&&s<=1?(h&&(t.__index=u+1),c&&n&&n.clone?c.clone():c):(c=r.create(o),h&&(c.__read=!0),c=c.initialize.apply(c,u>0||u+s<l?r.slice(t,u,u+s):t)||c,h&&(t.__index=u+c.__read,c.__read=e),c)},peek:function(t,e){return t[t.__index=e||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readList:function(t,e,i,n){for(var r,s=[],a=e||0,o=n?a+n:t.length,h=a;h<o;h++)s.push(Array.isArray(r=t[h])?this.read(r,0,i):this.read(t,h,i,1));return s},readNamed:function(t,i,n,s,a){var o=this.getNamed(t,i),h=o!==e;if(h){var u=t._filtered;u||(u=t._filtered=r.create(t[0]),u._unfiltered=t[0]),u[i]=e}return this.read(h?[o]:t,n,s,a)},getNamed:function(t,i){var n=t[0];if(t._hasObject===e&&(t._hasObject=1===t.length&&r.isPlainObject(n)),t._hasObject)return i?n[i]:t._filtered||n},hasNamed:function(t,e){return!!this.getNamed(t,e)},filter:function(t,i,n,r){function s(r){if(!(n&&r in n||a&&r in a)){var s=i[r];s!==e&&(t[r]=s)}}var a;if(r){for(var o,h={},u=0,l=r.length;u<l;u++)(o=r[u])in i&&(s(o),h[o]=!0);a=h}return Object.keys(i._unfiltered||i).forEach(s),t},isPlainValue:function(t,e){return r.isPlainObject(t)||Array.isArray(t)||e&&"string"==typeof t},serialize:function(t,e,i,n){e=e||{};var s,a=!n;if(a&&(e.formatter=new h(e.precision),n={length:0,definitions:{},references:{},add:function(t,e){var i="#"+t._id,n=this.references[i];if(!n){this.length++;var r=e.call(t),s=t._class;s&&r[0]!==s&&r.unshift(s),this.definitions[i]=r,n=this.references[i]=[i]}return n}}),t&&t._serialize){s=t._serialize(e,n);var o=t._class;!o||t._compactSerialize||!a&&i||s[0]===o||s.unshift(o)}else if(Array.isArray(t)){s=[];for(var u=0,l=t.length;u<l;u++)s[u]=r.serialize(t[u],e,i,n)}else if(r.isPlainObject(t)){s={};for(var c=Object.keys(t),u=0,l=c.length;u<l;u++){var f=c[u];s[f]=r.serialize(t[f],e,i,n)}}else s="number"==typeof t?e.formatter.number(t,e.precision):t;return a&&n.length>0?[["dictionary",n.definitions],s]:s},deserialize:function(t,e,i,n,s){var a=t,o=!i,h=o&&t&&t.length&&"dictionary"===t[0][0];if(i=i||{},Array.isArray(t)){var u=t[0],l="dictionary"===u;if(1==t.length&&/^#/.test(u))return i.dictionary[u];a=[];for(var c=(u=r.exports[u])?1:0,f=t.length;c<f;c++)a.push(r.deserialize(t[c],e,i,l,h));if(u){var d=a;e?a=e(u,d,o||s):(a=r.create(u.prototype),u.apply(a,d))}}else if(r.isPlainObject(t)){a={},n&&(i.dictionary=a);for(var _ in t)a[_]=r.deserialize(t[_],e,i)}return h?a[1]:a},exportJSON:function(t,e){var i=r.serialize(t,e);return e&&!1===e.asString?i:JSON.stringify(i)},importJSON:function(t,e){return r.deserialize("string"==typeof t?JSON.parse(t):t,function(t,i,n){var s=n&&e&&e.constructor===t,a=s?e:r.create(t.prototype);if(1===i.length&&a instanceof w&&(s||!(a instanceof b))){var o=i[0];r.isPlainObject(o)&&(o.insert=!1)}return(s?a.set:t).apply(a,i),s&&(e=null),a})},splice:function(t,i,n,r){var s=i&&i.length,a=n===e;(n=a?t.length:n)>t.length&&(n=t.length);for(o=0;o<s;o++)i[o]._index=n+o;if(a)return t.push.apply(t,i),[];var h=[n,r];i&&h.push.apply(h,i);for(var u=t.splice.apply(t,h),o=0,l=u.length;o<l;o++)u[o]._index=e;for(var o=n+s,l=t.length;o<l;o++)t[o]._index=o;return u},capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},camelize:function(t){return t.replace(/-(.)/g,function(t,e){return e.toUpperCase()})},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var s={on:function(t,e){if("string"!=typeof t)r.each(t,function(t,e){this.on(e,t)},this);else{var i=this._eventTypes,n=i&&i[t],s=this._callbacks=this._callbacks||{};-1===(s=s[t]=s[t]||[]).indexOf(e)&&(s.push(e),n&&n.install&&1===s.length&&n.install.call(this,t))}return this},off:function(t,e){if("string"==typeof t){var i,n=this._eventTypes,s=n&&n[t],a=this._callbacks&&this._callbacks[t];return a&&(!e||-1!==(i=a.indexOf(e))&&1===a.length?(s&&s.uninstall&&s.uninstall.call(this,t),delete this._callbacks[t]):-1!==i&&a.splice(i,1)),this}r.each(t,function(t,e){this.off(e,t)},this)},once:function(t,e){return this.on(t,function(){e.apply(this,arguments),this.off(t,e)})},emit:function(t,e){var i=this._callbacks&&this._callbacks[t];if(!i)return!1;var n=r.slice(arguments,1),s=e&&e.target&&!e.currentTarget;i=i.slice(),s&&(e.currentTarget=this);for(var a=0,o=i.length;a<o;a++)if(!1===i[a].apply(this,n)){e&&e.stop&&e.stop();break}return s&&delete e.currentTarget,!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var e=this._eventTypes,i=this._callbacks,n=t?"install":"uninstall";if(e)for(var r in i)if(i[r].length>0){var s=e[r],a=s&&s[n];a&&a.call(this,r)}},statics:{inject:function rt(t){var e=t._events;if(e){var i={};r.each(e,function(e,n){var s="string"==typeof e,a=s?e:n,o=r.capitalize(a),h=a.substring(2).toLowerCase();i[h]=s?{}:e,a="_"+a,t["get"+o]=function(){return this[a]},t["set"+o]=function(t){var e=this[a];e&&this.off(h,e),t&&this.on(h,t),this[a]=t}}),t._eventTypes=i}return rt.base.apply(this,arguments)}}},a=r.extend({_class:"PaperScope",initialize:function st(){paper=this,this.settings=new r({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this.palettes=[],this._id=st._id++,st._scopes[this._id]=this;var e=st.prototype;if(!this.support){var i=Q.getContext(1,1)||{};e.support={nativeDash:"setLineDash"in i||"mozDash"in i,nativeBlendModes:tt.nativeModes},Q.release(i)}if(!this.agent){var n=t.navigator.userAgent.toLowerCase(),s=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(n)||[])[0],a="darwin"===s?"mac":s,o=e.agent=e.browser={platform:a};a&&(o[a]=!0),n.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(t,e,i,n,r){if(!o.chrome){var s="opera"===e?n:/^(node|trident)$/.test(e)?r:i;o.version=s,o.versionNumber=parseFloat(s),e="trident"===e?"msie":e,o.name=e,o[e]=!0}}),o.chrome&&delete o.webkit,o.atom&&delete o.chrome}},version:"0.10.3",getView:function(){var t=this.project;return t&&t._view},getPaper:function(){return this},execute:function(t,e){paper.PaperScript.execute(t,this,e),U.updateFocus()},install:function(t){var e=this;r.each(["project","view","tool"],function(i){r.define(t,i,{configurable:!0,get:function(){return e[i]}})});for(var i in this)!/^_/.test(i)&&this[i]&&(t[i]=this[i])},setup:function(t){return paper=this,this.project=new y(t),this},createCanvas:function(t,e){return Q.getCanvas(t,e)},activate:function(){paper=this},clear:function(){for(var t=this.projects,e=this.tools,i=this.palettes,n=t.length-1;n>=0;n--)t[n].remove();for(n=e.length-1;n>=0;n--)e[n].remove();for(n=i.length-1;n>=0;n--)i[n].remove()},remove:function(){this.clear(),delete a._scopes[this._id]},statics:new function(){function t(t){return t+="Attribute",function(e,i){return e[t](i)||e[t]("data-paper-"+i)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),o=r.extend(s,{initialize:function(t){this._scope=paper,this._index=this._scope[this._list].push(this)-1,!t&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];return t&&t!==this&&t.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(r.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),h=r.extend({initialize:function(t){this.precision=r.pick(t,5),this.multiplier=Math.pow(10,this.precision)},number:function(t){return this.precision<16?Math.round(t*this.multiplier)/this.multiplier:t},pair:function(t,e,i){return this.number(t)+(i||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});h.instance=new h;var u=new function(){function t(t,e,i){return t<e?e:t>i?i:t}function e(t,e,i){function n(t){var e=134217729*t,n=t-e+e;return[n,t-n]}var r=e*e-t*i,a=e*e+t*i;if(3*s(r)<a){var o=n(t),h=n(e),u=n(i),l=e*e,f=t*i;r=l-f+(h[0]*h[0]-l+2*h[0]*h[1]+h[1]*h[1]-(o[0]*u[0]-f+o[0]*u[1]+o[1]*u[0]+o[1]*u[1]))}return r}function i(){var t=Math.max.apply(Math,arguments);return t&&(t<1e-8||t>1e8)?o(2,-Math.round(h(t))):0}var n=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],r=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],s=Math.abs,a=Math.sqrt,o=Math.pow,h=Math.log2||function(t){return Math.log(t)*Math.LOG2E},l=1e-12,c=1.12e-16;return{EPSILON:l,MACHINE_EPSILON:c,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,KAPPA:4*(a(2)-1)/3,isZero:function(t){return t>=-l&&t<=l},clamp:t,integrate:function(t,e,i,s){for(var a=n[s-2],o=r[s-2],h=.5*(i-e),u=h+e,l=0,c=s+1>>1,f=1&s?o[l++]*t(u):0;l<c;){var d=h*a[l];f+=o[l++]*(t(u+d)+t(u-d))}return h*f},findRoot:function(e,i,n,r,a,o,h){for(var u=0;u<o;u++){var l=e(n),c=l/i(n),f=n-c;if(s(c)<h){n=f;break}l>0?(a=n,n=f<=r?.5*(r+a):f):(r=n,n=f>=a?.5*(r+a):f)}return t(n,r,a)},solveQuadratic:function(n,r,o,h,u,f){var d,_=1/0;if(s(n)<l){if(s(r)<l)return s(o)<l?-1:0;d=-o/r}else{var g=e(n,r*=-.5,o);if(g&&s(g)<c){var v=i(s(n),s(r),s(o));v&&(n*=v,r*=v,o*=v,g=e(n,r,o))}if(g>=-c){var p=g<0?0:a(g),m=r+(r<0?-p:p);0===m?(d=o/n,_=-d):(d=m/n,_=o/m)}}var y=0,w=null==u,x=u-l,b=f+l;return isFinite(d)&&(w||d>x&&d<b)&&(h[y++]=w?d:t(d,u,f)),_!==d&&isFinite(_)&&(w||_>x&&_<b)&&(h[y++]=w?_:t(_,u,f)),y},solveCubic:function(e,n,r,h,f,d,_){function g(t){var i=e*(v=t);y=(i+(p=i+n))*v+(m=p*v+r),w=m*v+h}var v,p,m,y,w,x=i(s(e),s(n),s(r),s(h));if(x&&(e*=x,n*=x,r*=x,h*=x),s(e)<l)e=n,p=r,m=h,v=1/0;else if(s(h)<l)p=n,m=r,v=0;else{g(-n/e/3);var b=w/e,C=o(s(b),1/3),S=b<0?-1:1,P=-y/e,I=P>0?1.324717957244746*Math.max(C,a(P)):C,M=v-S*I;if(M!==v){do{g(M),M=0===y?v:v-w/y/(1+c)}while(S*M>S*v);s(e)*v*v>s(h/v)&&(m=-h/v,p=(m-r)/v)}}var T=u.solveQuadratic(e,p,m,f,d,_),z=null==d;return isFinite(v)&&(0===T||T>0&&v!==f[0]&&v!==f[1])&&(z||v>d-l&&v<_+l)&&(f[T++]=z?v:t(v,d,_)),T}}},l={_id:1,_pools:{},get:function(t){if(t){var e=this._pools[t];return e||(e=this._pools[t]={_id:1}),e._id++}return this._id++}},c=r.extend({_class:"Point",_readIndex:!0,initialize:function(t,e){var i=typeof t,n=this.__read,r=0;if("number"===i){var s="number"==typeof e;this._set(t,s?e:t),n&&(r=s?2:1)}else if("undefined"===i||null===t)this._set(0,0),n&&(r=null===t?1:0);else{var a="string"===i?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(a)?this._set(+a[0],+(a.length>1?a[1]:a[0])):"x"in a?this._set(a.x||0,a.y||0):"width"in a?this._set(a.width||0,a.height||0):"angle"in a?(this._set(a.length||0,0),this.setAngle(a.angle||0)):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new c(this.x,this.y)},toString:function(){var t=h.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){if(this.isZero()){var e=this._angle||0;this._set(Math.cos(e)*t,Math.sin(e)*t)}else{var i=t/this.getLength();u.isZero(i)&&this.getAngle(),this._set(this.x*i,this.y*i)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=c.read(arguments),e=this.getLength()*t.getLength();if(u.isZero(e))return NaN;var i=this.dot(t)/e;return Math.acos(i<-1?-1:i>1?1:i)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){if(this._angle=t,!this.isZero()){var e=this.getLength();this._set(Math.cos(t)*e,Math.sin(t)*e)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var t=c.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=c.read(arguments),e=t.x-this.x,i=t.y-this.y,n=e*e+i*i;return r.read(arguments)?n:Math.sqrt(n)},normalize:function(t){t===e&&(t=1);var i=this.getLength(),n=0!==i?t/i:0,r=new c(this.x*n,this.y*n);return n>=0&&(r._angle=this._angle),r},rotate:function(t,e){if(0===t)return this.clone();t=t*Math.PI/180;var i=e?this.subtract(e):this,n=Math.sin(t),r=Math.cos(t);return i=new c(i.x*r-i.y*n,i.x*n+i.y*r),e?i.add(e):i},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=c.read(arguments);return new c(this.x+t.x,this.y+t.y)},subtract:function(){var t=c.read(arguments);return new c(this.x-t.x,this.y-t.y)},multiply:function(){var t=c.read(arguments);return new c(this.x*t.x,this.y*t.y)},divide:function(){var t=c.read(arguments);return new c(this.x/t.x,this.y/t.y)},modulo:function(){var t=c.read(arguments);return new c(this.x%t.x,this.y%t.y)},negate:function(){return new c(-this.x,-this.y)},isInside:function(){return g.read(arguments).contains(this)},isClose:function(){var t=c.read(arguments),e=r.read(arguments);return this.getDistance(t)<=e},isCollinear:function(){var t=c.read(arguments);return c.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=c.read(arguments);return c.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){var t=u.isZero;return t(this.x)&&t(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(t){return this.x*(t>1&&t<4?-1:1)>=0&&this.y*(t>2?-1:1)>=0},dot:function(){var t=c.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=c.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=c.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new c(t.x*e,t.y*e)},statics:{min:function(){var t=c.read(arguments),e=c.read(arguments);return new c(Math.min(t.x,e.x),Math.min(t.y,e.y))},max:function(){var t=c.read(arguments),e=c.read(arguments);return new c(Math.max(t.x,e.x),Math.max(t.y,e.y))},random:function(){return new c(Math.random(),Math.random())},isCollinear:function(t,e,i,n){return Math.abs(t*n-e*i)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))},isOrthogonal:function(t,e,i,n){return Math.abs(t*i+e*n)<=1e-8*Math.sqrt((t*t+e*e)*(i*i+n*n))}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new c(e(this.x),e(this.y))}},{})),f=c.extend({initialize:function(t,e,i,n){this._x=t,this._y=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._x=t,this._y=e,i||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner.changeSelection(this._getSelection(),t)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),d=r.extend({_class:"Size",_readIndex:!0,initialize:function(t,e){var i=typeof t,n=this.__read,r=0;if("number"===i){var s="number"==typeof e;this._set(t,s?e:t),n&&(r=s?2:1)}else if("undefined"===i||null===t)this._set(0,0),n&&(r=null===t?1:0);else{var a="string"===i?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(a)?this._set(+a[0],+(a.length>1?a[1]:a[0])):"width"in a?this._set(a.width||0,a.height||0):"x"in a?this._set(a.x||0,a.y||0):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.width=t,this.height=e,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new d(this.width,this.height)},toString:function(){var t=h.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.width),e.number(this.height)]},add:function(){var t=d.read(arguments);return new d(this.width+t.width,this.height+t.height)},subtract:function(){var t=d.read(arguments);return new d(this.width-t.width,this.height-t.height)},multiply:function(){var t=d.read(arguments);return new d(this.width*t.width,this.height*t.height)},divide:function(){var t=d.read(arguments);return new d(this.width/t.width,this.height/t.height)},modulo:function(){var t=d.read(arguments);return new d(this.width%t.width,this.height%t.height)},negate:function(){return new d(-this.width,-this.height)},isZero:function(){var t=u.isZero;return t(this.width)&&t(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,e){return new d(Math.min(t.width,e.width),Math.min(t.height,e.height))},max:function(t,e){return new d(Math.max(t.width,e.width),Math.max(t.height,e.height))},random:function(){return new d(Math.random(),Math.random())}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new d(e(this.width),e(this.height))}},{})),_=d.extend({initialize:function(t,e,i,n){this._width=t,this._height=e,this._owner=i,this._setter=n},_set:function(t,e,i){return this._width=t,this._height=e,i||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),g=r.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(t,i,n,s){var a,o=typeof t;if("number"===o?(this._set(t,i,n,s),a=4):"undefined"===o||null===t?(this._set(0,0,0,0),a=null===t?1:0):1===arguments.length&&(Array.isArray(t)?(this._set.apply(this,t),a=1):t.x!==e||t.width!==e?(this._set(t.x||0,t.y||0,t.width||0,t.height||0),a=1):t.from===e&&t.to===e&&(this._set(0,0,0,0),r.filter(this,t),a=1)),a===e){var h,u,l=c.readNamed(arguments,"from"),f=r.peek(arguments),_=l.x,g=l.y;if(f&&f.x!==e||r.hasNamed(arguments,"to")){var v=c.readNamed(arguments,"to");h=v.x-_,u=v.y-g,h<0&&(_=v.x,h=-h),u<0&&(g=v.y,u=-u)}else{var p=d.read(arguments);h=p.width,u=p.height}this._set(_,g,h,u),a=arguments.__index}return this.__read&&(this.__read=a),this},set:"#initialize",_set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},clone:function(){return new g(this.x,this.y,this.width,this.height)},equals:function(t){var e=r.isPlainValue(t)?g.read(arguments):t;return e===this||e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height||!1},toString:function(){var t=h.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y),e.number(this.width),e.number(this.height)]},getPoint:function(t){return new(t?c:f)(this.x,this.y,this,"setPoint")},setPoint:function(){var t=c.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){return new(t?d:_)(this.width,this.height,this,"setSize")},setSize:function(){var t=d.read(arguments);this._fixX&&(this.x+=(this.width-t.width)*this._fixX),this._fixY&&(this.y+=(this.height-t.height)*this._fixY),this.width=t.width,this.height=t.height,this._fixW=1,this._fixH=1},getLeft:function(){return this.x},setLeft:function(t){this._fixW||(this.width-=t-this.x),this.x=t,this._fixX=0},getTop:function(){return this.y},setTop:function(t){this._fixH||(this.height-=t-this.y),this.y=t,this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(t){this._fixX!==e&&1!==this._fixX&&(this._fixW=0),this._fixW?this.x=t-this.width:this.width=t-this.x,this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(t){this._fixY!==e&&1!==this._fixY&&(this._fixH=0),this._fixH?this.y=t-this.height:this.height=t-this.y,this._fixY=1},getCenterX:function(){return this.x+.5*this.width},setCenterX:function(t){this.x=t-.5*this.width,this._fixX=.5},getCenterY:function(){return this.y+.5*this.height},setCenterY:function(t){this.y=t-.5*this.height,this._fixY=.5},getCenter:function(t){return new(t?c:f)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=c.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(t){return t&&t.width!==e||4===(Array.isArray(t)?t:arguments).length?this._containsRectangle(g.read(arguments)):this._containsPoint(c.read(arguments))},_containsPoint:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e<=this.x+this.width&&i<=this.y+this.height},_containsRectangle:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e+t.width<=this.x+this.width&&i+t.height<=this.y+this.height},intersects:function(){var t=g.read(arguments);return t.x+t.width>this.x&&t.y+t.height>this.y&&t.x<this.x+this.width&&t.y<this.y+this.height},touches:function(){var t=g.read(arguments);return t.x+t.width>=this.x&&t.y+t.height>=this.y&&t.x<=this.x+this.width&&t.y<=this.y+this.height},intersect:function(){var t=g.read(arguments),e=Math.max(this.x,t.x),i=Math.max(this.y,t.y),n=Math.min(this.x+this.width,t.x+t.width),r=Math.min(this.y+this.height,t.y+t.height);return new g(e,i,n-e,r-i)},unite:function(){var t=g.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);return new g(e,i,n-e,r-i)},include:function(){var t=c.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x),r=Math.max(this.y+this.height,t.y);return new g(e,i,n-e,r-i)},expand:function(){var t=d.read(arguments),e=t.width,i=t.height;return new g(this.x-e/2,this.y-i/2,this.width+e,this.height+i)},scale:function(t,i){return this.expand(this.width*t-this.width,this.height*(i===e?t:i)-this.height)}},r.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(t,e){var i=t.join(""),n=/^[RL]/.test(i);e>=4&&(t[1]+=n?"Y":"X");var r=t[n?0:1],s=t[n?1:0],a="get"+r,o="get"+s,h="set"+r,u="set"+s,d="set"+i;this["get"+i]=function(t){return new(t?c:f)(this[a](),this[o](),this,d)},this[d]=function(){var t=c.read(arguments);this[h](t.x),this[u](t.y)}},{beans:!0})),v=g.extend({initialize:function(t,e,i,n,r,s){this._set(t,e,i,n,!0),this._owner=r,this._setter=s},_set:function(t,e,i,n,r){return this._x=t,this._y=e,this._width=i,this._height=n,r||this._owner[this._setter](this),this}},new function(){var t=g.prototype;return r.each(["x","y","width","height"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._dontNotify||this._owner[this._setter](this)}},r.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(e){var i="set"+e;this[i]=function(){this._dontNotify=!0,t[i].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(t){var e=this._owner;e.changeSelection&&e.changeSelection(2,t)}}))}),p=r.extend({_class:"Matrix",initialize:function at(t,e){var i=arguments.length,n=!0;if(i>=6?this._set.apply(this,arguments):1===i||2===i?t instanceof at?this._set(t._a,t._b,t._c,t._d,t._tx,t._ty,e):Array.isArray(t)?this._set.apply(this,e?t.concat([e]):t):n=!1:i?n=!1:this.reset(),!n)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(t,e,i,n,r,s,a){return this._a=t,this._b=e,this._c=i,this._d=n,this._tx=r,this._ty=s,a||this._changed(),this},_serialize:function(t,e){return r.serialize(this.getValues(),t,!0,e)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(9))},clone:function(){return new p(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty},toString:function(){var t=h.instance;return"[["+[t.number(this._a),t.number(this._c),t.number(this._tx)].join(", ")+"], ["+[t.number(this._b),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,e){var i=this._owner;return!!i&&(i.transform(null,!0,r.pick(t,!0),e),this.isIdentity())},translate:function(){var t=c.read(arguments),e=t.x,i=t.y;return this._tx+=e*this._a+i*this._c,this._ty+=e*this._b+i*this._d,this._changed(),this},scale:function(){var t=c.read(arguments),e=c.read(arguments,0,{readNull:!0});return e&&this.translate(e),this._a*=t.x,this._b*=t.x,this._c*=t.y,this._d*=t.y,e&&this.translate(e.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var e=c.read(arguments,1),i=e.x,n=e.y,r=Math.cos(t),s=Math.sin(t),a=i-i*r+n*s,o=n-i*s-n*r,h=this._a,u=this._b,l=this._c,f=this._d;return this._a=r*h+s*l,this._b=r*u+s*f,this._c=-s*h+r*l,this._d=-s*u+r*f,this._tx+=a*h+o*l,this._ty+=a*u+o*f,this._changed(),this},shear:function(){var t=c.read(arguments),e=c.read(arguments,0,{readNull:!0});e&&this.translate(e);var i=this._a,n=this._b;return this._a+=t.y*this._c,this._b+=t.y*this._d,this._c+=t.x*i,this._d+=t.x*n,e&&this.translate(e.negate()),this._changed(),this},skew:function(){var t=c.read(arguments),e=c.read(arguments,0,{readNull:!0}),i=Math.PI/180,n=new c(Math.tan(t.x*i),Math.tan(t.y*i));return this.shear(n,e)},append:function(t){if(t){var e=this._a,i=this._b,n=this._c,r=this._d,s=t._a,a=t._c,o=t._b,h=t._d,u=t._tx,l=t._ty;this._a=s*e+o*n,this._c=a*e+h*n,this._b=s*i+o*r,this._d=a*i+h*r,this._tx+=u*e+l*n,this._ty+=u*i+l*r,this._changed()}return this},prepend:function(t){if(t){var e=this._a,i=this._b,n=this._c,r=this._d,s=this._tx,a=this._ty,o=t._a,h=t._c,u=t._b,l=t._d,c=t._tx,f=t._ty;this._a=o*e+h*i,this._c=o*n+h*r,this._b=u*e+l*i,this._d=u*n+l*r,this._tx=o*s+h*a+c,this._ty=u*s+l*a+f,this._changed()}return this},appended:function(t){return this.clone().append(t)},prepended:function(t){return this.clone().prepend(t)},invert:function(){var t=this._a,e=this._b,i=this._c,n=this._d,r=this._tx,s=this._ty,a=t*n-e*i,o=null;return a&&!isNaN(a)&&isFinite(r)&&isFinite(s)&&(this._a=n/a,this._b=-e/a,this._c=-i/a,this._d=t/a,this._tx=(i*s-n*r)/a,this._ty=(e*r-t*s)/a,o=this),o},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new p(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var t=this._a*this._d-this._c*this._b;return t&&!isNaN(t)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(t,e,i){return arguments.length<3?this._transformPoint(c.read(arguments)):this._transformCoordinates(t,e,i)},_transformPoint:function(t,e,i){var n=t.x,r=t.y;return e||(e=new c),e._set(n*this._a+r*this._c+this._tx,n*this._b+r*this._d+this._ty,i)},_transformCoordinates:function(t,e,i){for(var n=0,r=2*i;n<r;n+=2){var s=t[n],a=t[n+1];e[n]=s*this._a+a*this._c+this._tx,e[n+1]=s*this._b+a*this._d+this._ty}return e},_transformCorners:function(t){var e=t.x,i=t.y,n=e+t.width,r=i+t.height,s=[e,i,n,i,n,r,e,r];return this._transformCoordinates(s,s,4)},_transformBounds:function(t,e,i){for(var n=this._transformCorners(t),r=n.slice(0,2),s=r.slice(),a=2;a<8;a++){var o=n[a],h=1&a;o<r[h]?r[h]=o:o>s[h]&&(s[h]=o)}return e||(e=new g),e._set(r[0],r[1],s[0]-r[0],s[1]-r[1],i)},inverseTransform:function(){return this._inverseTransform(c.read(arguments))},_inverseTransform:function(t,e,i){var n=this._a,r=this._b,s=this._c,a=this._d,o=this._tx,h=this._ty,u=n*a-r*s,l=null;if(u&&!isNaN(u)&&isFinite(o)&&isFinite(h)){var f=t.x-this._tx,d=t.y-this._ty;e||(e=new c),l=e._set((f*a-d*s)/u,(d*n-f*r)/u,i)}return l},decompose:function(){var t,e,i,n=this._a,r=this._b,s=this._c,a=this._d,o=n*a-r*s,h=Math.sqrt,u=Math.atan2,l=180/Math.PI;if(0!==n||0!==r){var f=h(n*n+r*r);t=Math.acos(n/f)*(r>0?1:-1),e=[f,o/f],i=[u(n*s+r*a,f*f),0]}else if(0!==s||0!==a){var d=h(s*s+a*a);t=Math.asin(s/d)*(a>0?1:-1),e=[o/d,d],i=[0,u(n*s+r*a,d*d)]}else t=0,i=e=[0,0];return{translation:this.getTranslation(),rotation:t*l,scaling:new c(e),skewing:new c(i[0]*l,i[1]*l)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new c(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},applyToContext:function(t){this.isIdentity()||t.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},r.each(["a","b","c","d","tx","ty"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._changed()}},{})),m=r.extend({_class:"Line",initialize:function(t,e,i,n,r){var s=!1;arguments.length>=4?(this._px=t,this._py=e,this._vx=i,this._vy=n,s=r):(this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,s=i),s||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new c(this._px,this._py)},getVector:function(){return new c(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return m.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return m.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(m.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0))},isCollinear:function(t){return c.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return c.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,i,n,r,s,a,o,h,l){h||(i-=t,n-=e,a-=r,o-=s);var f=i*o-n*a;if(!u.isZero(f)){var d=t-r,_=e-s,g=(a*_-o*d)/f,v=(i*_-n*d)/f,m=-1e-12,y=1+1e-12;if(l||m<g&&g<y&&m<v&&v<y)return l||(g=g<=0?0:g>=1?1:g),new c(t+g*i,e+g*n)}},getSide:function(t,e,i,n,r,s,a,o){a||(i-=t,n-=e);var h=r-t,c=h*n-(s-e)*i;return!o&&u.isZero(c)&&(c=(h*i+h*i)/(i*i+n*n))>=0&&c<=1&&(c=0),c<0?-1:c>0?1:0},getSignedDistance:function(t,e,i,n,r,s,a){return a||(i-=t,n-=e),0===i?n>0?r-t:t-r:0===n?i<0?s-e:e-s:((r-t)*n-(s-e)*i)/Math.sqrt(i*i+n*n)},getDistance:function(t,e,i,n,r,s,a){return Math.abs(m.getSignedDistance(t,e,i,n,r,s,a))}}}),y=o.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(t){o.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new V(null,null,this),this._view=U.create(this,t||Q.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(t,e){return r.serialize(this._children,t,!0,e)},_changed:function(t,e){if(1&t){var i=this._view;i&&(i._needsUpdate=!0,!i._requested&&i._autoUpdate&&i.requestUpdate())}var n=this._changes;if(n&&e){var r=this._changesById,s=e._id,a=r[s];a?a.flags|=t:n.push(r[s]={item:e,flags:t})}},clear:function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e].remove()},isEmpty:function(){return!this._children.length},remove:function ot(){return!!ot.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.set(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new b({project:this,insert:!0})},getSymbolDefinitions:function(){var t=[],e={};return this.getItems({class:P,match:function(i){var n=i._definition,r=n._id;return e[r]||(e[r]=!0,t.push(n)),!1}}),t},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var t=this._selectionItems,e=[];for(var i in t){var n=t[i],r=n._selection;1&r&&n.isInserted()?e.push(n):r||this._updateSelection(n)}return e},_updateSelection:function(t){var e=t._id,i=this._selectionItems;t._selection?i[e]!==t&&(this._selectionCount++,i[e]=t):i[e]===t&&(this._selectionCount--,delete i[e])},selectAll:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)t[e].setFullySelected(!0)},deselectAll:function(){var t=this._selectionItems;for(var e in t)t[e].setFullySelected(!1)},addLayer:function(t){return this.insertLayer(e,t)},insertLayer:function(t,e){if(e instanceof b){e._remove(!1,!0),r.splice(this._children,[e],t,0),e._setProject(this,!0);var i=e._name;i&&e.setName(i),this._changes&&e._changed(5),this._activeLayer||(this._activeLayer=e)}else e=null;return e},_insertItem:function(t,i,n){return i=this.insertLayer(t,i)||(this._activeLayer||this._insertItem(e,new b(w.NO_INSERT),!0)).insertChild(t,i),n&&i.activate&&i.activate(),i},getItems:function(t){return w._getItems(this,t)},getItem:function(t){return w._getItems(this,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var e=this._activeLayer;return r.importJSON(t,e&&e.isEmpty()&&e)},removeOn:function(t){var e=this._removeSets;if(e){"mouseup"===t&&(e.mousedrag=null);var i=e[t];if(i){for(var n in i){var r=i[n];for(var s in e){var a=e[s];a&&a!=i&&delete a[r._id]}r.remove()}e[t]=null}}},draw:function(t,e,i){this._updateVersion++,t.save(),e.applyToContext(t);for(var n=this._children,s=new r({offset:new c(0,0),pixelRatio:i,viewMatrix:e.isIdentity()?null:e,matrices:[new p],updateMatrix:!0}),a=0,o=n.length;a<o;a++)n[a].draw(t,s);if(t.restore(),this._selectionCount>0){t.save(),t.strokeWidth=1;var h=this._selectionItems,u=this._scope.settings.handleSize,l=this._updateVersion;for(var f in h)h[f]._drawSelection(t,e,u,h,l);t.restore()}}}),w=r.extend(s,{statics:{extend:function ht(t){return t._serializeFields&&(t._serializeFields=r.set({},this.prototype._serializeFields,t._serializeFields)),ht.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new p,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var t=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return r.each(t,function(t){this._events[t]={install:function(t){this.getView()._countItemEvent(t,1)},uninstall:function(t){this.getView()._countItemEvent(t,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:t}})},{initialize:function(){},_initialize:function(t,i){var n=t&&r.isPlainObject(t),s=n&&!0===t.internal,a=this._matrix=new p,o=n&&t.project||paper.project,h=paper.settings;return this._id=s?null:l.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&h.applyMatrix,i&&a.translate(i),a._owner=this,this._style=new V(o._currentStyle,this,o),s||n&&!1===t.insert||!h.insertItems&&(!n||!0!==t.insert)?this._setProject(o):(n&&t.parent||o)._insertItem(e,this,!0),n&&t!==w.NO_INSERT&&this.set(t,{internal:!0,insert:!0,project:!0,parent:!0}),n},_serialize:function(t,e){function i(i){for(var a in i){var o=s[a];r.equals(o,"leading"===a?1.2*i.fontSize:i[a])||(n[a]=r.serialize(o,t,"data"!==a,e))}}var n={},s=this;return i(this._serializeFields),this instanceof x||i(this._style._defaults),[this._class,n]},_changed:function(t){var i=this._symbol,n=this._parent||i,r=this._project;8&t&&(this._bounds=this._position=this._decomposed=this._globalMatrix=e),n&&40&t&&w._clearBoundsCache(n),2&t&&w._clearBoundsCache(this),r&&r._changed(t,this),i&&i._changed(t)},getId:function(){return this._id},getName:function(){return this._name},setName:function(t){if(this._name&&this._removeNamed(),t===+t+"")throw new Error("Names consisting only of numbers are not supported.");var i=this._getOwner();if(t&&i){var n=i._children,r=i._namedChildren;(r[t]=r[t]||[]).push(this),t in n||(n[t]=this)}this._name=t||e,this._changed(128)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},r.each(["locked","visible","blendMode","opacity","guide"],function(t){var e=r.capitalize(t),t="_"+t;this["get"+e]=function(){return this[t]},this["set"+e]=function(e){e!=this[t]&&(this[t]=e,this._changed("_locked"===t?128:129))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(t){if(t!==this._selection){this._selection=t;var e=this._project;e&&(e._updateSelection(this),this._changed(129))}},changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,i=t.length;e<i;e++)if(t[e].isSelected())return!0;return!!(1&this._selection)},setSelected:function(t){if(this._selectChildren)for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setSelected(t);this.changeSelection(1,t)},isFullySelected:function(){var t=this._children,e=!!(1&this._selection);if(t&&e){for(var i=0,n=t.length;i<n;i++)if(!t[i].isFullySelected())return!1;return!0}return e},setFullySelected:function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++)e[i].setFullySelected(t);this.changeSelection(1,t)},isClipMask:function(){return this._clipMask},setClipMask:function(t){this._clipMask!=(t=!!t)&&(this._clipMask=t,t&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(129),this._parent&&this._parent._changed(1024))},getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(t){var e=this._position,i=t?c:f;if(!e){var n=this._pivot;e=this._position=n?this._matrix._transformPoint(n):this.getBounds().getCenter(!0)}return new i(e.x,e.y,this,"setPosition")},setPosition:function(){this.translate(c.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(){var t=this._pivot;return t?new f(t.x,t.y,this,"setPivot"):null},setPivot:function(){this._pivot=c.read(arguments,0,{clone:!0,readNull:!0}),this._position=e}},r.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(t,e){this[e]=function(e){return this.getBounds(e,t)}},{beans:!0,getBounds:function(t,e){var i=e||t instanceof p,n=r.set({},i?e:t,this._boundsOptions);n.stroke&&!this.getStrokeScaling()||(n.cacheItem=this);var s=this._getCachedBounds(i&&t,n);return arguments.length?s:new v(s.x,s.y,s.width,s.height,this,"setBounds")},setBounds:function(){var t=g.read(arguments),e=this.getBounds(),i=this._matrix,n=new p,r=t.getCenter();n.translate(r),t.width==e.width&&t.height==e.height||(i.isInvertible()||(i.set(i._backup||(new p).translate(i.getTranslation())),e=this.getBounds()),n.scale(0!==e.width?t.width/e.width:0,0!==e.height?t.height/e.height:0)),r=e.getCenter(),n.translate(-r.x,-r.y),this.transform(n)},_getBounds:function(t,e){var i=this._children;return i&&i.length?(w._updateBoundsCache(this,e.cacheItem),w._getBounds(i,t,e)):new g},_getCachedBounds:function(t,e){t=t&&t._orNullIfIdentity();var i=e.internal,n=e.cacheItem,r=i?null:this._matrix._orNullIfIdentity(),s=n&&(!t||t.equals(r))&&[e.stroke?1:0,e.handle?1:0,i?1:0].join("");if(w._updateBoundsCache(this._parent||this._symbol,n),s&&this._bounds&&s in this._bounds)return this._bounds[s].rect.clone();var a=this._getBounds(t||r,e);return s&&(this._bounds||(this._bounds={}),this._bounds[s]={rect:a.clone(),internal:e.internal}),a},_getStrokeMatrix:function(t,e){var i=this.getStrokeScaling()?null:e&&e.internal?this:this._parent||this._symbol&&this._symbol._item,n=i?i.getViewMatrix().invert():t;return n&&n._shiftless()},statics:{_updateBoundsCache:function(t,e){if(t&&e){var i=e._id,n=t._boundsCache=t._boundsCache||{ids:{},list:[]};n.ids[i]||(n.list.push(e),n.ids[i]=e)}},_clearBoundsCache:function(t){var i=t._boundsCache;if(i){t._bounds=t._position=t._boundsCache=e;for(var n=0,r=i.list,s=r.length;n<s;n++){var a=r[n];a!==t&&(a._bounds=a._position=e,a._boundsCache&&w._clearBoundsCache(a))}}},_getBounds:function(t,e,i){var n=1/0,r=-n,s=n,a=r;i=i||{};for(var o=0,h=t.length;o<h;o++){var u=t[o];if(u._visible&&!u.isEmpty()){var l=u._getCachedBounds(e&&e.appended(u._matrix),i);n=Math.min(l.x,n),s=Math.min(l.y,s),r=Math.max(l.x+l.width,r),a=Math.max(l.y+l.height,a)}}return isFinite(n)?new g(n,s,r-n,a-s):new g}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var t=this._decompose();return t?t.rotation:0},setRotation:function(t){var e=this.getRotation();if(null!=e&&null!=t){var i=this._decomposed;this.rotate(t-e),i&&(i.rotation=t,this._decomposed=i)}},getScaling:function(){var t=this._decompose(),e=t&&t.scaling;return new f(e?e.x:1,e?e.y:1,this,"setScaling")},setScaling:function(){var t=this.getScaling(),e=c.read(arguments,0,{clone:!0,readNull:!0});if(t&&e&&!t.equals(e)){var i=this._decomposed;this.scale(e.x/t.x,e.y/t.y),i&&(i.scaling=e,this._decomposed=i)}},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},getGlobalMatrix:function(t){var e=this._globalMatrix,i=this._project._updateVersion;if(e&&e._updateVersion!==i&&(e=null),!e){e=this._globalMatrix=this._matrix.clone();var n=this._parent;n&&e.prepend(n.getGlobalMatrix(!0)),e._updateVersion=i}return t?e:e.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._setProject(t);e=!0}e&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function ut(t){ut.base.call(this,t);for(var e=this._children,i=0,n=e&&e.length;i<n;i++)e[i]._installEvents(t)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof b)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var t=this._getOwner();return t&&t._children[this._index+1]||null},getPreviousSibling:function(){var t=this._getOwner();return t&&t._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return r.equals(this._children,t._children)},clone:function(t){var i=new this.constructor(w.NO_INSERT),n=this._children,s=r.pick(t?t.insert:e,t===e||!0===t),a=r.pick(t?t.deep:e,!0);n&&i.copyAttributes(this),n&&!a||i.copyContent(this),n||i.copyAttributes(this),s&&i.insertAbove(this);var o=this._name,h=this._parent;if(o&&h){for(var n=h._children,u=o,l=1;n[o];)o=u+" "+l++;o!==u&&i.setName(o)}return i},copyContent:function(t){for(var e=t._children,i=0,n=e&&e.length;i<n;i++)this.addChild(e[i].clone(!1),!0)},copyAttributes:function(t,e){this.setStyle(t._style);for(var i=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],n=0,s=i.length;n<s;n++){var a=i[n];t.hasOwnProperty(a)&&(this[a]=t[a])}e||this._matrix.set(t._matrix,!0),this.setApplyMatrix(t._applyMatrix),this.setPivot(t._pivot),this.setSelection(t._selection);var o=t._data,h=t._name;this._data=o?r.clone(o):null,h&&this.setName(h)},rasterize:function(t,i){var n=this.getStrokeBounds(),s=(t||this.getView().getResolution())/72,a=n.getTopLeft().floor(),o=n.getBottomRight().ceil(),h=new d(o.subtract(a)),u=new S(w.NO_INSERT);if(!h.isZero()){var l=Q.getCanvas(h.multiply(s)),c=l.getContext("2d"),f=(new p).scale(s).translate(a.negate());c.save(),f.applyToContext(c),this.draw(c,new r({matrices:[f]})),c.restore(),u.setCanvas(l)}return u.transform((new p).translate(a.add(h.divide(2))).scale(1/s)),(i===e||i)&&u.insertAbove(this),u},contains:function(){return!!this._contains(this._matrix._inverseTransform(c.read(arguments)))},_contains:function(t){var e=this._children;if(e){for(var i=e.length-1;i>=0;i--)if(e[i].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return g.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new L.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){return t instanceof w&&this._asPathItem().getIntersections(t._asPathItem(),null,e,!0).length>0}},new function(){function t(){return this._hitTest(c.read(arguments),M.getOptions(arguments))}function e(){var t=c.read(arguments),e=M.getOptions(arguments),i=[];return this._hitTest(t,r.set({all:i},e)),i}function i(t,e,i,n){var r=this._children;if(r)for(var s=r.length-1;s>=0;s--){var a=r[s],o=a!==n&&a._hitTest(t,e,i);if(o&&!e.all)return o}return null}return y.inject({hitTest:t,hitTestAll:e,_hitTest:i}),{hitTest:t,hitTestAll:e,_hitTestChildren:i}},{_hitTest:function(t,e,i){function n(t){return t&&_&&!_(t)&&(t=null),t&&e.all&&e.all.push(t),t}function s(e,i){var n=l["get"+i]();if(t.subtract(n).divide(u).length<=1)return new M(e,g,{name:r.hyphenate(i),point:n})}if(this._locked||!this._visible||this._guide&&!e.guides||this.isEmpty())return null;var a=this._matrix,o=i?i.appended(a):this.getGlobalMatrix().prepend(this.getView()._matrix),h=Math.max(e.tolerance,1e-12),u=e._tolerancePadding=new d(L._getStrokePadding(h,a.inverted()._shiftless()));if(!(t=a._inverseTransform(t))||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(u.multiply(2))._containsPoint(t))return null;var l,c,f=!(e.guides&&!this._guide||e.selected&&!this.isSelected()||e.type&&e.type!==r.hyphenate(this._class)||e.class&&!(this instanceof e.class)),_=e.match,g=this;if(f&&(e.center||e.bounds)&&this._parent){if(l=this.getInternalBounds(),e.center&&(c=s("center","Center")),!c&&e.bounds)for(var v=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],p=0;p<8&&!c;p++)c=s("bounds",v[p]);c=n(c)}return c||(c=this._hitTestChildren(t,e,o)||f&&n(this._hitTestSelf(t,e,o,this.getStrokeScaling()?null:o.inverted()._shiftless()))||null),c&&c.point&&(c.point=a.transform(c.point)),c},_hitTestSelf:function(t,e){if(e.fill&&this.hasFill()&&this._contains(t))return new M("fill",this)},matches:function(t,e){function i(t,e){for(var n in t)if(t.hasOwnProperty(n)){var s=t[n],a=e[n];if(r.isPlainObject(s)&&r.isPlainObject(a)){if(!i(s,a))return!1}else if(!r.equals(s,a))return!1}return!0}var n=typeof t;if("object"===n){for(var s in t)if(t.hasOwnProperty(s)&&!this.matches(s,t[s]))return!1;return!0}if("function"===n)return t(this);if("match"===t)return e(this);var a=/^(empty|editable)$/.test(t)?this["is"+r.capitalize(t)]():"type"===t?r.hyphenate(this._class):this[t];if("class"===t){if("function"==typeof e)return this instanceof e;a=this._class}if("function"==typeof e)return!!e(a);if(e){if(e.test)return e.test(a);if(r.isPlainObject(e))return i(e,a)}return r.equals(a,e)},getItems:function(t){return w._getItems(this,t,this._matrix)},getItem:function(t){return w._getItems(this,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function lt(t,e,i,n,s){if(!n){var a="object"==typeof e&&e,o=a&&a.overlapping,h=a&&a.inside,l=(u=o||h)&&g.read([u]);n={items:[],recursive:a&&!1!==a.recursive,inside:!!h,overlapping:!!o,rect:l,path:o&&new L.Rectangle({rectangle:l,insert:!1})},a&&(e=r.filter({},e,{recursive:!0,inside:!0,overlapping:!0}))}var c=t._children,f=n.items;i=(l=n.rect)&&(i||new p);for(var d=0,_=c&&c.length;d<_;d++){var v=c[d],m=i&&i.appended(v._matrix),y=!0;if(l){var u=v.getBounds(m);if(!l.intersects(u))continue;l.contains(u)||n.overlapping&&(u.contains(l)||n.path.intersects(v,m))||(y=!1)}if(y&&v.matches(e)&&(f.push(v),s))break;if(!1!==n.recursive&&lt(v,e,m,n,s),s&&f.length>0)break}return f}}},{importJSON:function(t){var e=r.importJSON(t,this);return e!==this?this.addChild(e):e},addChild:function(t){return this.insertChild(e,t)},insertChild:function(t,e){var i=e?this.insertChildren(t,[e]):null;return i&&i[0]},addChildren:function(t){return this.insertChildren(this._children.length,t)},insertChildren:function(t,e){var i=this._children;if(i&&e&&e.length>0){for(n=(e=r.slice(e)).length-1;n>=0;n--){(s=e[n])?s._remove(!1,!0):e.splice(n,1)}r.splice(i,e,t,0);for(var a=this._project,o=a._changes,n=0,h=e.length;n<h;n++){var s=e[n],u=s._name;s._parent=this,s._setProject(a,!0),u&&s.setName(u),o&&this._changed(5)}this._changed(11)}else e=null;return e},_insertItem:"#insertChild",_insertAt:function(t,e){var i=t&&t._getOwner(),n=t!==this&&i?this:null;return n&&(n._remove(!1,!0),i._insertItem(t._index+e,n)),n},insertAbove:function(t){return this._insertAt(t,1)},insertBelow:function(t){return this._insertAt(t,0)},sendToBack:function(){var t=this._getOwner();return t?t._insertItem(0,this):null},bringToFront:function(){var t=this._getOwner();return t?t._insertItem(e,this):null},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",copyTo:function(t){return t._insertItem(e,this.clone(!1))},reduce:function(t){var e=this._children;if(e&&1===e.length){var i=e[0].reduce(t);return this._parent?(i.insertAbove(this),this.remove()):i.remove(),i}return this},_removeNamed:function(){var t=this._getOwner();if(t){var e=t._children,i=t._namedChildren,n=this._name,r=i[n],s=r?r.indexOf(this):-1;-1!==s&&(e[n]==this&&delete e[n],r.splice(s,1),r.length?e[n]=r[0]:delete i[n])}},_remove:function(t,e){var i=this._getOwner(),n=this._project,s=this._index;return!!i&&(this._name&&this._removeNamed(),null!=s&&(n._activeLayer===this&&(n._activeLayer=this.getNextSibling()||this.getPreviousSibling()),r.splice(i._children,null,s,1)),this._installEvents(!1),t&&n._changes&&this._changed(5),e&&i._changed(11,this),this._parent=null,!0)},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){var e=t&&t.insertBelow(this);return e&&this.remove(),e},removeChildren:function(t,e){if(!this._children)return null;t=t||0,e=r.pick(e,this._children.length);for(var i=r.splice(this._children,null,t,e-t),n=i.length-1;n>=0;n--)i[n]._remove(!0,!1);return i.length>0&&this._changed(11),i},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;t<e;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(){var t=this._children;return!t||!t.length},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function e(t){var e=[];do{e.unshift(t)}while(t=t._parent);return e}for(var i=e(this),n=e(t),r=0,s=Math.min(i.length,n.length);r<s;r++)if(i[r]!=n[r])return i[r]._index<n[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e===t)return!0;return!1},isAncestor:function(t){return!!t&&t.isDescendant(this)},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?r:c).read(arguments),n=c.read(arguments,0,{readNull:!0});return this.transform((new p)[t](i,n||this.getPosition(!0)))}},{translate:function(){var t=new p;return this.transform(t.translate.apply(t,arguments))},transform:function(t,e,i,n){t&&t.isIdentity()&&(t=null);var r=this._matrix,s=(e||this._applyMatrix)&&(!r.isIdentity()||t||e&&i&&this._children);if(!t&&!s)return this;if(t&&(!t.isInvertible()&&r.isInvertible()&&(r._backup=r.getValues()),r.prepend(t)),s=s&&this._transformContent(r,i,n)){var a=this._pivot,o=this._style,h=o.getFillColor(!0),u=o.getStrokeColor(!0);a&&r._transformPoint(a,a,!0),h&&h.transform(r),u&&u.transform(r),r.reset(!0),n&&this._canApplyMatrix&&(this._applyMatrix=!0)}var l=this._bounds,c=this._position;this._changed(9);var f=l&&t&&t.decompose();if(f&&!f.shearing&&f.rotation%90==0){for(var d in l){var _=l[d];if(s||!_.internal){g=_.rect;t._transformBounds(g,g)}}var g,v=this._boundsGetter;(g=l[v&&v.getBounds||v||"getBounds"])&&(this._position=g.getCenter(!0)),this._bounds=l}else t&&c&&(this._position=t._transformPoint(c,c));return this},_transformContent:function(t,e,i){var n=this._children;if(n){for(var r=0,s=n.length;r<s;r++)n[r].transform(t,!0,e,i);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(c.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(c.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(c.read(arguments))},localToParent:function(){return this._matrix._transformPoint(c.read(arguments))},fitBounds:function(t,e){t=g.read(arguments);var i=this.getBounds(),n=i.height/i.width,r=t.height/t.width,s=(e?n>r:n<r)?t.width/i.width:t.height/i.height,a=new g(new c,new d(i.width*s,i.height*s));a.setCenter(t.getCenter()),this.setBounds(a)}}),{_setStyles:function(t,e,i){var n=this._style;if(n.hasFill()&&(t.fillStyle=n.getFillColor().toCanvasStyle(t)),n.hasStroke()){t.strokeStyle=n.getStrokeColor().toCanvasStyle(t),t.lineWidth=n.getStrokeWidth();var r=n.getStrokeJoin(),s=n.getStrokeCap(),a=n.getMiterLimit();if(r&&(t.lineJoin=r),s&&(t.lineCap=s),a&&(t.miterLimit=a),paper.support.nativeDash){var o=n.getDashArray(),h=n.getDashOffset();o&&o.length&&("setLineDash"in t?(t.setLineDash(o),t.lineDashOffset=h):(t.mozDash=o,t.mozDashOffset=h))}}if(n.hasShadow()){var u=e.pixelRatio||1,l=i._shiftless().prepend((new p).scale(u,u)),f=l.transform(new c(n.getShadowBlur(),0)),d=l.transform(this.getShadowOffset());t.shadowColor=n.getShadowColor().toCanvasStyle(t),t.shadowBlur=f.getLength(),t.shadowOffsetX=d.x,t.shadowOffsetY=d.y}},draw:function(t,e,i){var n=this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var r=e.matrices,s=e.viewMatrix,a=this._matrix,o=r[r.length-1].appended(a);if(o.isInvertible()){s=s?s.appended(o):o,r.push(o),e.updateMatrix&&(o._updateVersion=n,this._globalMatrix=o);var h,u,l,c=this._blendMode,f=this._opacity,d="normal"===c,_=tt.nativeModes[c],g=d&&1===f||e.dontStart||e.clip||(_||d&&f<1)&&this._canComposite(),v=e.pixelRatio||1;if(!g){var p=this.getStrokeBounds(s);if(!p.width||!p.height)return;l=e.offset,u=e.offset=p.getTopLeft().floor(),h=t,t=Q.getContext(p.getSize().ceil().add(1).multiply(v)),1!==v&&t.scale(v,v)}t.save();var m=i?i.appended(a):this._canScaleStroke&&!this.getStrokeScaling(!0)&&s,y=!g&&e.clipItem,w=!m||y;if(g?(t.globalAlpha=f,_&&(t.globalCompositeOperation=c)):w&&t.translate(-u.x,-u.y),w&&(g?a:s).applyToContext(t),y&&e.clipItem.draw(t,e.extend({clip:!0})),m){t.setTransform(v,0,0,v,0,0);var x=e.offset;x&&t.translate(-x.x,-x.y)}this._draw(t,e,s,m),t.restore(),r.pop(),e.clip&&!e.dontFinish&&t.clip(),g||(tt.process(c,t,h,f,u.subtract(l).multiply(v)),Q.release(t),e.offset=l)}}},_isUpdated:function(t){var e=this._parent;if(e instanceof N)return e._isUpdated(t);var i=this._updateVersion===t;return!i&&e&&e._visible&&e._isUpdated(t)&&(this._updateVersion=t,i=!0),i},_drawSelection:function(t,e,i,n,r){var s=this._selection,a=1&s,o=2&s||a&&this._selectBounds,h=4&s;if(this._drawSelected||(a=!1),(a||o||h)&&this._isUpdated(r)){var u,l=this.getSelectedColor(!0)||(u=this.getLayer())&&u.getSelectedColor(!0),c=e.appended(this.getGlobalMatrix(!0)),f=i/2;if(t.strokeStyle=t.fillStyle=l?l.toCanvasStyle(t):"#009dec",a&&this._drawSelected(t,c,n),h){var d=this.getPosition(!0),_=d.x,g=d.y;t.beginPath(),t.arc(_,g,f,0,2*Math.PI,!0),t.stroke();for(var v=[[0,-1],[1,0],[0,1],[-1,0]],p=f,m=i+1,y=0;y<4;y++){var w=v[y],x=w[0],b=w[1];t.moveTo(_+x*p,g+b*p),t.lineTo(_+x*m,g+b*m),t.stroke()}}if(o){var C=c._transformCorners(this.getInternalBounds());t.beginPath();for(y=0;y<8;y++)t[y?"lineTo":"moveTo"](C[y],C[++y]);t.closePath(),t.stroke();for(y=0;y<8;y++)t.fillRect(C[y]-f,C[++y]-f,i,i)}}},_canComposite:function(){return!1}},r.each(["down","drag","up","move"],function(t){this["removeOn"+r.capitalize(t)]=function(){var e={};return e[t]=!0,this.removeOn(e)}},{removeOn:function(t){for(var e in t)if(t[e]){var i="mouse"+e,n=this._project,r=n._removeSets=n._removeSets||{};r[i]=r[i]||{},r[i][this._id]=this}return this}})),x=w.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function ct(t){ct.base.call(this,t),1026&t&&(this._clipItem=e)},_getClipItem:function(){var t=this._clipItem;if(t===e){t=null;for(var i=this._children,n=0,r=i.length;n<r;n++)if(i[n]._clipMask){t=i[n];break}this._clipItem=t}return t},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var e=this.getFirstChild();e&&e.setClipMask(t)},_getBounds:function ft(t,e){var i=this._getClipItem();return i?i._getCachedBounds(t&&t.appended(i._matrix),r.set({},e,{stroke:!1})):ft.base.call(this,t,e)},_hitTestChildren:function dt(t,e,i){var n=this._getClipItem();return(!n||n.contains(t))&&dt.base.call(this,t,e,i,n)},_draw:function(t,e){var i=e.clip,n=!i&&this._getClipItem();e=e.extend({clipItem:n,clip:!1}),i?(t.beginPath(),e.dontStart=e.dontFinish=!0):n&&n.draw(t,e.extend({clip:!0}));for(var r=this._children,s=0,a=r.length;s<a;s++){var o=r[s];o!==n&&o.draw(t,e)}}}),b=x.extend({_class:"Layer",initialize:function(){x.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function _t(){return this._parent?_t.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),C=w.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(t){this._initialize(t)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&r.equals(this._radius,t._radius)},copyContent:function(t){this.setType(t._type),this.setSize(t._size),this.setRadius(t._radius)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new _(t.width,t.height,this,"setSize")},setSize:function(){var t=d.read(arguments);if(this._size){if(!this._size.equals(t)){var e=this._type,i=t.width,n=t.height;"rectangle"===e?this._radius.set(d.min(this._radius,t.divide(2))):"circle"===e?(i=n=(i+n)/2,this._radius=i/2):"ellipse"===e&&this._radius._set(i/2,n/2),this._size._set(i,n),this._changed(9)}}else this._size=t.clone()},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new _(t.width,t.height,this,"setRadius")},setRadius:function(t){var e=this._type;if("circle"===e){if(t===this._radius)return;i=2*t;this._radius=t,this._size._set(i,i)}else if(t=d.read(arguments),this._radius){if(this._radius.equals(t))return;if(this._radius.set(t),"rectangle"===e){var i=d.max(this._size,t.multiply(2));this._size.set(i)}else"ellipse"===e&&this._size._set(2*t.width,2*t.height)}else this._radius=t.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var i=new(L[r.capitalize(this._type)])({center:new c,size:this._size,radius:this._radius,insert:!1});return i.copyAttributes(this),paper.settings.applyMatrix&&i.setApplyMatrix(!0),(t===e||t)&&i.insertAbove(this),i},toShape:"#clone",_draw:function(t,e,i,n){var r=this._style,s=r.hasFill(),a=r.hasStroke(),o=e.dontFinish||e.clip,h=!n;if(s||a||o){var u=this._type,l=this._radius,c="circle"===u;if(e.dontStart||t.beginPath(),h&&c)t.arc(0,0,l,0,2*Math.PI,!0);else{var f=c?l:l.width,d=c?l:l.height,_=this._size,g=_.width,v=_.height;if(h&&"rectangle"===u&&0===f&&0===d)t.rect(-g/2,-v/2,g,v);else{var p=g/2,m=v/2,y=.44771525016920644,w=f*y,x=d*y,b=[-p,-m+d,-p,-m+x,-p+w,-m,-p+f,-m,p-f,-m,p-w,-m,p,-m+x,p,-m+d,p,m-d,p,m-x,p-w,m,p-f,m,-p+f,m,-p+w,m,-p,m-x,-p,m-d];n&&n.transform(b,b,32),t.moveTo(b[0],b[1]),t.bezierCurveTo(b[2],b[3],b[4],b[5],b[6],b[7]),p!==f&&t.lineTo(b[8],b[9]),t.bezierCurveTo(b[10],b[11],b[12],b[13],b[14],b[15]),m!==d&&t.lineTo(b[16],b[17]),t.bezierCurveTo(b[18],b[19],b[20],b[21],b[22],b[23]),p!==f&&t.lineTo(b[24],b[25]),t.bezierCurveTo(b[26],b[27],b[28],b[29],b[30],b[31])}}t.closePath()}o||!s&&!a||(this._setStyles(t,e,i),s&&(t.fill(r.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),a&&t.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,e){var i=new g(this._size).setCenter(0,0),n=this._style,r=e.stroke&&n.hasStroke()&&n.getStrokeWidth();return t&&(i=t._transformBounds(i)),r?i.expand(L._getStrokePadding(r,this._getStrokeMatrix(t,e))):i}},new function(){function t(t,e,i){var n=t._radius;if(!n.isZero())for(var r=t._size.divide(2),s=1;s<=4;s++){var a=new c(s>1&&s<4?-1:1,s>2?-1:1),o=a.multiply(r),h=o.subtract(a.multiply(n));if(new g(i?o.add(a.multiply(i)):o,h).contains(e))return{point:h,quadrant:s}}}function e(t,e,i,n){var r=t.divide(e);return(!n||r.isInQuadrant(n))&&r.subtract(r.normalize()).multiply(e).divide(i).length<=1}return{_contains:function i(e){if("rectangle"===this._type){var n=t(this,e);return n?e.subtract(n.point).divide(this._radius).getLength()<=1:i.base.call(this,e)}return e.divide(this.size).getLength()<=.5},_hitTestSelf:function n(i,r,s,a){var o=!1,h=this._style,u=r.stroke&&h.hasStroke(),l=r.fill&&h.hasFill();if(u||l){var c=this._type,f=this._radius,d=u?h.getStrokeWidth()/2:0,_=r._tolerancePadding.add(L._getStrokePadding(d,!h.getStrokeScaling()&&a));if("rectangle"===c){var v=_.multiply(2),p=t(this,i,v);if(p)o=e(i.subtract(p.point),f,_,p.quadrant);else{var m=new g(this._size).setCenter(0,0),y=m.expand(v),w=m.expand(v.negate());o=y._containsPoint(i)&&!w._containsPoint(i)}}else o=e(i,f,_)}return o?new M(u?"stroke":"fill",this):n.base.apply(this,arguments)}}},{statics:new function(){function t(t,e,i,n,s){var a=new C(r.getNamed(s));return a._type=t,a._size=i,a._radius=n,a.translate(e)}return{Circle:function(){var e=c.readNamed(arguments,"center"),i=r.readNamed(arguments,"radius");return t("circle",e,new d(2*i),i,arguments)},Rectangle:function(){var e=g.readNamed(arguments,"rectangle"),i=d.min(d.readNamed(arguments,"radius"),e.getSize(!0).divide(2));return t("rectangle",e.getCenter(!0),e.getSize(!0),i,arguments)},Ellipse:function(){var e=C._readEllipse(arguments),i=e.radius;return t("ellipse",e.center,i.multiply(2),i,arguments)},_readEllipse:function(t){var e,i;if(r.hasNamed(t,"radius"))e=c.readNamed(t,"center"),i=d.readNamed(t,"radius");else{var n=g.readNamed(t,"rectangle");e=n.getCenter(!0),i=n.getSize(!0).divide(2)}return{center:e,radius:i}}}}}),S=w.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],initialize:function(t,i){if(!this._initialize(t,i!==e&&c.read(arguments,1))){var r="string"==typeof t?n.getElementById(t):t;r?this.setImage(r):this.setSource(t)}this._size||(this._size=new d,this._loaded=!1)},_equals:function(t){return this.getSource()===t.getSource()},copyContent:function(t){var e=t._image,i=t._canvas;if(e)this._setImage(e);else if(i){var n=Q.getCanvas(t._size);n.getContext("2d").drawImage(i,0,0),this._setImage(n)}this._crossOrigin=t._crossOrigin},getSize:function(){var t=this._size;return new _(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(){var t=d.read(arguments);if(!t.equals(this._size))if(t.width>0&&t.height>0){var e=this.getElement();this._setImage(Q.getCanvas(t)),e&&this.getContext(!0).drawImage(e,0,0,t.width,t.height)}else this._canvas&&Q.release(this._canvas),this._size=t.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},getLoaded:function(){return this._loaded},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,e=new c(0,0).transform(t),i=new c(1,0).transform(t).subtract(e),n=new c(0,1).transform(t).subtract(e);return new d(72/i.getLength(),72/n.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){function e(t){var e=i.getView(),n=t&&t.type||"load";e&&i.responds(n)&&(paper=e._scope,i.emit(n,new G(t)))}var i=this;this._setImage(t),this._loaded?setTimeout(e,0):t&&Z.add(t,{load:function(n){i._setImage(t),e(n)},error:e})},_setImage:function(t){this._canvas&&Q.release(this._canvas),t&&t.getContext?(this._image=null,this._canvas=t,this._loaded=!0):(this._image=t,this._canvas=null,this._loaded=!!(t&&t.src&&t.complete)),this._size=new d(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(521)},getCanvas:function(){if(!this._canvas){var t=Q.getContext(this._size);try{this._image&&t.drawImage(this._image,0,0),this._canvas=t.canvas}catch(e){Q.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){return this._context||(this._context=this.getCanvas().getContext("2d")),t&&(this._image=null,this._changed(513)),this._context},setContext:function(t){this._context=t},getSource:function(){var t=this._image;return t&&t.src||this.toDataURL()},setSource:function(e){var i=new t.Image,n=this._crossOrigin;n&&(i.crossOrigin=n),i.src=e,this.setImage(i)},getCrossOrigin:function(){var t=this._image;return t&&t.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){this._crossOrigin=t;var e=this._image;e&&(e.crossOrigin=t)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=g.read(arguments),e=Q.getContext(t.getSize());return e.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),e.canvas},getSubRaster:function(){var t=g.read(arguments),e=new S(w.NO_INSERT);return e._setImage(this.getSubCanvas(t)),e.translate(t.getCenter().subtract(this.getSize().divide(2))),e._matrix.prepend(this._matrix),e.insertAbove(this),e},toDataURL:function(){var t=this._image,e=t&&t.src;if(/^data:/.test(e))return e;var i=this.getCanvas();return i?i.toDataURL.apply(i,arguments):null},drawImage:function(t){var e=c.read(arguments,1);this.getContext(!0).drawImage(t,e.x,e.y)},getAverageColor:function(t){var e,i;if(t?t instanceof A?(i=t,e=t.getBounds()):"object"==typeof t&&("width"in t?e=new g(t):"x"in t&&(e=new g(t.x-.5,t.y-.5,1,1))):e=this.getBounds(),!e)return null;var s=Math.min(e.width,32),a=Math.min(e.height,32),o=S._sampleContext;o?o.clearRect(0,0,33,33):o=S._sampleContext=Q.getContext(new d(32)),o.save();var h=(new p).scale(s/e.width,a/e.height).translate(-e.x,-e.y);h.applyToContext(o),i&&i.draw(o,new r({clip:!0,matrices:[h]})),this._matrix.applyToContext(o);var u=this.getElement(),l=this._size;u&&o.drawImage(u,-l.width/2,-l.height/2),o.restore();for(var c=o.getImageData(.5,.5,Math.ceil(s),Math.ceil(a)).data,f=[0,0,0],_=0,v=0,m=c.length;v<m;v+=4){var y=c[v+3];_+=y,y/=255,f[0]+=c[v]*y,f[1]+=c[v+1]*y,f[2]+=c[v+2]*y}for(v=0;v<3;v++)f[v]/=_;return _?F.read(f):null},getPixel:function(){var t=c.read(arguments),e=this.getContext().getImageData(t.x,t.y,1,1).data;return new F("rgb",[e[0]/255,e[1]/255,e[2]/255],e[3]/255)},setPixel:function(){var t=c.read(arguments),e=F.read(arguments),i=e._convert("rgb"),n=e._alpha,r=this.getContext(!0),s=r.createImageData(1,1),a=s.data;a[0]=255*i[0],a[1]=255*i[1],a[2]=255*i[2],a[3]=null!=n?255*n:255,r.putImageData(s,t.x,t.y)},createImageData:function(){var t=d.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=g.read(arguments);return t.isEmpty()&&(t=new g(this._size)),this.getContext().getImageData(t.x,t.y,t.width,t.height)},setImageData:function(t){var e=c.read(arguments,1);this.getContext(!0).putImageData(t,e.x,e.y)},_getBounds:function(t,e){var i=new g(this._size).setCenter(0,0);return t?t._transformBounds(i):i},_hitTestSelf:function(t){if(this._contains(t)){var e=this;return new M("pixel",e,{offset:t.add(e._size.divide(2)).round(),color:{get:function(){return e.getPixel(this.offset)}}})}},_draw:function(t){var e=this.getElement();e&&(t.globalAlpha=this._opacity,t.drawImage(e,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),P=w.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(t,i){this._initialize(t,i!==e&&c.read(arguments,1))||this.setDefinition(t instanceof I?t:new I(t))},_equals:function(t){return this._definition===t._definition},copyContent:function(t){this.setDefinition(t._definition)},getDefinition:function(){return this._definition},setDefinition:function(t){this._definition=t,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(t,e){var i=this._definition._item;return i._getCachedBounds(i._matrix.prepended(t),e)},_hitTestSelf:function(t,e,i,n){var r=this._definition._item._hitTest(t,e,i);return r&&(r.item=this),r},_draw:function(t,e){this._definition._item.draw(t,e)}}),I=r.extend({_class:"SymbolDefinition",initialize:function(t,e){this._id=l.get(),this.project=paper.project,t&&this.setItem(t,e)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._class,this._item],t,!1,e)})},_changed:function(t){8&t&&w._clearBoundsCache(this),1&t&&this.project._changed(t)},getItem:function(){return this._item},setItem:function(t,e){t._symbol&&(t=t.clone()),this._item&&(this._item._symbol=null),this._item=t,t.remove(),t.setSelected(!1),e||t.setPosition(new c),t._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(t){return new P(this,t)},clone:function(){return new I(this._item.clone(!1))},equals:function(t){return t===this||t&&this._item.equals(t._item)||!1}}),M=r.extend({_class:"HitResult",initialize:function(t,e,i){this.type=t,this.item=e,i&&(i.enumerable=!0,this.inject(i))},statics:{getOptions:function(t){var e=t&&r.read(t);return r.set({type:null,tolerance:paper.settings.hitTolerance,fill:!e,stroke:!e,segments:!e,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1},e)}}}),T=r.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(t,i,n,r,s,a){var o,h,u,l,c=arguments.length;c>0&&(null==t||"object"==typeof t?1===c&&t&&"point"in t?(o=t.point,h=t.handleIn,u=t.handleOut,l=t.selection):(o=t,h=i,u=n,l=r):(o=[t,i],h=n!==e?[n,r]:null,u=s!==e?[s,a]:null)),new z(o,this,"_point"),new z(h,this,"_handleIn"),new z(u,this,"_handleOut"),l&&this.setSelection(l)},_serialize:function(t,e){var i=this._point,n=this._selection,s=n||this.hasHandles()?[i,this._handleIn,this._handleOut]:i;return n&&s.push(n),r.serialize(s,t,!0,e)},_changed:function(t){var e=this._path;if(e){var i,n=e._curves,r=this._index;n&&(t&&t!==this._point&&t!==this._handleIn||!(i=r>0?n[r-1]:e._closed?n[n.length-1]:null)||i._changed(),t&&t!==this._point&&t!==this._handleOut||!(i=n[r])||i._changed()),e._changed(25)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(c.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(c.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(c.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var t=this._handleIn,e=this._handleOut;return!t.isZero()&&!e.isZero()&&t.isCollinear(e)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(t){var e=this._selection,i=this._path;this._selection=t=t||0,i&&t!==e&&(i._updateSelection(this,e,t),i._changed(129))},changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){return!!(7&this._selection)},setSelected:function(t){this.changeSelection(7,t)},getIndex:function(){return this._index!==e?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;return t?(e>0&&!t._closed&&e===t._segments.length-1&&e--,t.getCurves()[e]||null):null},getLocation:function(){var t=this.getCurve();return t?new O(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},smooth:function(t,i,n){var r=t||{},s=r.type,a=r.factor,o=this.getPrevious(),h=this.getNext(),u=(o||this)._point,l=this._point,f=(h||this)._point,d=u.getDistance(l),_=l.getDistance(f);if(s&&"catmull-rom"!==s){if("geometric"!==s)throw new Error("Smoothing method '"+s+"' not supported.");if(o&&h){var g=u.subtract(f),v=a===e?.4:a,p=v*d/(d+_);i||this.setHandleIn(g.multiply(p)),n||this.setHandleOut(g.multiply(p-v))}}else{var m=a===e?.5:a,y=Math.pow(d,m),w=y*y,x=Math.pow(_,m),b=x*x;if(!i&&o){var C=2*b+3*x*y+w,S=3*x*(x+y);this.setHandleIn(0!==S?new c((b*u._x+C*l._x-w*f._x)/S-l._x,(b*u._y+C*l._y-w*f._y)/S-l._y):new c)}if(!n&&h){var C=2*w+3*y*x+b,S=3*y*(y+x);this.setHandleOut(0!==S?new c((w*f._x+C*l._x-b*u._x)/S-l._x,(w*f._y+C*l._y-b*u._y)/S-l._y):new c)}}},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,i=t.clone();t.set(e),e.set(i)},reversed:function(){return new T(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new T(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];return this._handleIn.isZero()||t.push("handleIn: "+this._handleIn),this._handleOut.isZero()||t.push("handleOut: "+this._handleOut),"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},interpolate:function(t,e,i){var n=1-i,r=i,s=t._point,a=e._point,o=t._handleIn,h=e._handleIn,u=e._handleOut,l=t._handleOut;this._point._set(n*s._x+r*a._x,n*s._y+r*a._y,!0),this._handleIn._set(n*o._x+r*h._x,n*o._y+r*h._y,!0),this._handleOut._set(n*l._x+r*u._x,n*l._y+r*u._y,!0),this._changed()},_transformCoordinates:function(t,e,i){var n=this._point,r=i&&this._handleIn.isZero()?null:this._handleIn,s=i&&this._handleOut.isZero()?null:this._handleOut,a=n._x,o=n._y,h=2;return e[0]=a,e[1]=o,r&&(e[h++]=r._x+a,e[h++]=r._y+o),s&&(e[h++]=s._x+a,e[h++]=s._y+o),t&&(t._transformCoordinates(e,e,h/2),a=e[0],o=e[1],i?(n._x=a,n._y=o,h=2,r&&(r._x=e[h++]-a,r._y=e[h++]-o),s&&(s._x=e[h++]-a,s._y=e[h++]-o)):(r||(e[h++]=a,e[h++]=o),s||(e[h++]=a,e[h++]=o))),e}}),z=c.extend({initialize:function(t,i,n){var r,s,a;if(t)if((r=t[0])!==e)s=t[1];else{var o=t;(r=o.x)===e&&(o=c.read(arguments),r=o.x),s=o.y,a=o.selected}else r=s=0;this._x=r,this._y=s,this._owner=i,i[n]=this,a&&this.setSelected(!0)},_set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){var t=u.isZero;return t(this._x)&&t(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner.changeSelection(this._getSelection(),t)},_getSelection:function(){var t=this._owner;return this===t._point?1:this===t._handleIn?2:this===t._handleOut?4:0}}),k=r.extend({_class:"Curve",beans:!0,initialize:function(t,e,i,n,r,s,a,o){var h,u,l,c,f,d,_=arguments.length;3===_?(this._path=t,h=e,u=i):_?1===_?"segment1"in t?(h=new T(t.segment1),u=new T(t.segment2)):"point1"in t?(l=t.point1,f=t.handle1,d=t.handle2,c=t.point2):Array.isArray(t)&&(l=[t[0],t[1]],c=[t[6],t[7]],f=[t[2]-t[0],t[3]-t[1]],d=[t[4]-t[6],t[5]-t[7]]):2===_?(h=new T(t),u=new T(e)):4===_?(l=t,f=e,d=i,c=n):8===_&&(l=[t,e],c=[a,o],f=[i-t,n-e],d=[r-a,s-o]):(h=new T,u=new T),this._segment1=h||new T(l,null,f),this._segment2=u||new T(c,d,null)},_serialize:function(t,e){return r.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0,e)},_changed:function(){this._length=this._bounds=e},clone:function(){return new k(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},classify:function(){return k.classify(this.getValues())},remove:function(){var t=!1;if(this._path){var e=this._segment2,i=e._handleOut;(t=e.remove())&&this._segment1._handleOut.set(i)}return t},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(c.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(c.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(c.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(c.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return k.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],i=0;i<8;i+=2)e.push(new c(t[i],t[i+1]));return e}},{getLength:function(){return null==this._length&&(this._length=k.getLength(this.getValues(),0,1)),this._length},getArea:function(){return k.getArea(this.getValues())},getLine:function(){return new m(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new k(k.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return k.getLength(this.getValues(),t,e)},divideAt:function(t){return this.divideAtTime(t&&t.curve===this?t.time:this.getTimeAt(t))},divideAtTime:function(t,e){var r=null;if(t>=1e-8&&t<=1-1e-8){var s=k.subdivide(this.getValues(),t),a=s[0],o=s[1],h=e||this.hasHandles(),u=this._segment1,l=this._segment2,f=this._path;h&&(u._handleOut._set(a[2]-a[0],a[3]-a[1]),l._handleIn._set(o[4]-o[6],o[5]-o[7]));var d=a[6],_=a[7],g=new T(new c(d,_),h&&new c(a[4]-d,a[5]-_),h&&new c(o[2]-d,o[3]-_));f?(f.insert(u._index+1,g),r=this.getNext()):(this._segment2=g,this._changed(),r=new k(g,l))}return r},splitAt:function(t){var e=this._path;return e?e.splitAt(t):null},splitAtTime:function(t){return this.splitAt(this.getLocationAtTime(t))},divide:function(t,i){return this.divideAtTime(t===e?.5:i?t:this.getTimeAt(t))},split:function(t,i){return this.splitAtTime(t===e?.5:i?t:this.getTimeAt(t))},reversed:function(){return new k(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(t,e,i,n){var r=t._point,s=t._handleOut,a=e._handleIn,o=e._point,h=r.x,u=r.y,l=o.x,c=o.y,f=n?[h,u,h,u,l,c,l,c]:[h,u,h+s._x,u+s._y,l+a._x,c+a._y,l,c];return i&&i._transformCoordinates(f,f,4),f},subdivide:function(t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],h=t[5],u=t[6],l=t[7];i===e&&(i=.5);var c=1-i,f=c*n+i*s,d=c*r+i*a,_=c*s+i*o,g=c*a+i*h,v=c*o+i*u,p=c*h+i*l,m=c*f+i*_,y=c*d+i*g,w=c*_+i*v,x=c*g+i*p,b=c*m+i*w,C=c*y+i*x;return[[n,r,f,d,m,y,b,C],[b,C,w,x,v,p,u,l]]},getMonoCurves:function(t,e){var i=[],n=e?0:1,r=t[n+0],s=t[n+2],a=t[n+4],o=t[n+6];if(r>=s==s>=a&&s>=a==a>=o||k.isStraight(t))i.push(t);else{var h=3*(s-a)-r+o,l=2*(r+a)-4*s,c=s-r,_=[],g=u.solveQuadratic(h,l,c,_,1e-8,1-1e-8);if(g){_.sort();var v=_[0],p=k.subdivide(t,v);i.push(p[0]),g>1&&(v=(_[1]-v)/(1-v),p=k.subdivide(p[1],v),i.push(p[0])),i.push(p[1])}else i.push(t)}return i},solveCubic:function(t,e,i,n,r,s){var a=t[e],o=t[e+2],h=t[e+4],l=t[e+6],c=0;if(!(a<i&&l<i&&o<i&&h<i||a>i&&l>i&&o>i&&h>i)){var f=3*(o-a),d=3*(h-o)-f,_=l-a-f-d;c=u.solveCubic(_,d,f,a-i,n,r,s)}return c},getTimeOf:function(t,e){var i=new c(t[0],t[1]),n=new c(t[6],t[7]),s=1e-7;if(null===(e.isClose(i,1e-12)?0:e.isClose(n,1e-12)?1:null))for(var o=[e.x,e.y],h=[],u=0;u<2;u++)for(var l=k.solveCubic(t,u,o[u],h,0,1),f=0;f<l;f++){var d=h[f];if(e.isClose(k.getPoint(t,d),s))return d}return e.isClose(i,s)?0:e.isClose(n,s)?1:null},getNearestTime:function(t,e){function i(i){if(i>=0&&i<=1){var n=e.getDistance(k.getPoint(t,i),!0);if(n<d)return d=n,_=i,!0}}if(k.isStraight(t)){var n=t[0],r=t[1],o=t[6]-n,h=t[7]-r,u=o*o+h*h;if(0===u)return 0;var l=((e.x-n)*o+(e.y-r)*h)/u;return l<1e-12?0:l>.999999999999?1:k.getTimeOf(t,new c(n+l*o,r+l*h))}for(var d=1/0,_=0,g=0;g<=100;g++)i(g/100);for(var v=.005;v>1e-8;)i(_-v)||i(_+v)||(v/=2);return _},getPart:function(t,e,i){var n=e>i;if(n){var r=e;e=i,i=r}return e>0&&(t=k.subdivide(t,e)[1]),i<1&&(t=k.subdivide(t,(i-e)/(1-e))[0]),n?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},isFlatEnough:function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],o=t[5],h=t[6],u=t[7],l=3*r-2*i-h,c=3*s-2*n-u,f=3*a-2*h-i,d=3*o-2*u-n;return Math.max(l*l,f*f)+Math.max(c*c,d*d)<=16*e*e},getArea:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],h=t[7];return 3*((h-i)*(n+s)-(o-e)*(r+a)+r*(e-s)-n*(i-a)+h*(s+e/3)-o*(a+i/3))/20},getBounds:function(t){for(var e=t.slice(0,2),i=e.slice(),n=[0,0],r=0;r<2;r++)k._addBounds(t[r],t[r+2],t[r+4],t[r+6],r,0,e,i,n);return new g(e[0],e[1],i[0]-e[0],i[1]-e[1])},_addBounds:function(t,e,i,n,r,s,a,o,h){function l(t,e){var i=t-e,n=t+e;i<a[r]&&(a[r]=i),n>o[r]&&(o[r]=n)}s/=2;var c=a[r]-s,f=o[r]+s;if(t<c||e<c||i<c||n<c||t>f||e>f||i>f||n>f)if(e<t!=e<n&&i<t!=i<n)l(t,s),l(n,s);else{var d=3*(e-i)-t+n,_=2*(t+i)-4*e,g=e-t,v=u.solveQuadratic(d,_,g,h);l(n,0);for(var y=0;y<v;y++){var w=h[y],x=1-w;1e-8<=w&&w<=1-1e-8&&l(x*x*x*t+3*x*x*w*e+3*x*w*w*i+w*w*w*n,s)}}}}},r.each(["getBounds","getStrokeBounds","getHandleBounds"],function(t){this[t]=function(){this._bounds||(this._bounds={});var e=this._bounds[t];return e||(e=this._bounds[t]=L[t]([this._segment1,this._segment2],!1,this._path)),e.clone()}},{}),r.each({isStraight:function(t,e,i,n){if(e.isZero()&&i.isZero())return!0;var r=n.subtract(t);if(r.isZero())return!1;if(r.isCollinear(e)&&r.isCollinear(i)){var s=new m(t,n);if(s.getDistance(t.add(e))<1e-7&&s.getDistance(n.add(i))<1e-7){var o=r.dot(r),h=r.dot(e)/o,u=r.dot(i)/o;return h>=0&&h<=1&&u<=0&&u>=-1}}return!1},isLinear:function(t,e,i,n){var r=n.subtract(t).divide(3);return e.equals(r)&&i.negate().equals(r)}},function(t,e){this[e]=function(e){var i=this._segment1,n=this._segment2;return t(i._point,i._handleOut,n._handleIn,n._point,e)},this.statics[e]=function(e,i){var n=e[0],r=e[1],s=e[6],a=e[7];return t(new c(n,r),new c(e[2]-n,e[3]-r),new c(e[4]-s,e[5]-a),new c(s,a),i)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(t){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(t||0)},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(t,e){return this.getLocationAtTime(e?t:this.getTimeAt(t))},getLocationAtTime:function(t){return null!=t&&t>=0&&t<=1?new O(this,t):null},getTimeAt:function(t,e){return k.getTimeAt(this.getValues(),t,e)},getParameterAt:"#getTimeAt",getOffsetAtTime:function(t){return this.getPartLength(0,t)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(c.read(arguments)))},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getTimeOf:function(){return k.getTimeOf(this.getValues(),c.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var t=c.read(arguments),e=this.getValues(),i=k.getNearestTime(e,t),n=k.getPoint(e,i);return new O(this,i,n,null,t.getDistance(n))},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return r.each(t,function(t){this[t+"At"]=function(e,i){var n=this.getValues();return k[t](n,i?e:k.getTimeAt(n,e))},this[t+"AtTime"]=function(e){return k[t](this.getValues(),e)}},{statics:{_evaluateMethods:t}})},new function(){function t(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],u=9*(n-s)+3*(t[6]-e),l=6*(e+s)-12*n,c=3*(n-e),f=9*(r-a)+3*(t[7]-i),d=6*(i+a)-12*r,_=3*(r-i);return function(t){var e=(u*t+l)*t+c,i=(f*t+d)*t+_;return Math.sqrt(e*e+i*i)}}function i(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function n(t,e,i,n){if(null==e||e<0||e>1)return null;var r=t[0],s=t[1],a=t[2],o=t[3],h=t[4],l=t[5],f=t[6],d=t[7],_=u.isZero;_(a-r)&&_(o-s)&&(a=r,o=s),_(h-f)&&_(l-d)&&(h=f,l=d);var g,v,p=3*(a-r),m=3*(h-a)-p,y=f-r-p-m,w=3*(o-s),x=3*(l-o)-w,b=d-s-w-x;if(0===i)g=0===e?r:1===e?f:((y*e+m)*e+p)*e+r,v=0===e?s:1===e?d:((b*e+x)*e+w)*e+s;else{var C=1e-8,S=1-C;if(e<C?(g=p,v=w):e>S?(g=3*(f-h),v=3*(d-l)):(g=(3*y*e+2*m)*e+p,v=(3*b*e+2*x)*e+w),n){0===g&&0===v&&(e<C||e>S)&&(g=h-a,v=l-o);var P=Math.sqrt(g*g+v*v);P&&(g/=P,v/=P)}if(3===i){var h=6*y*e+2*m,l=6*b*e+2*x,I=Math.pow(g*g+v*v,1.5);g=0!==I?(g*l-v*h)/I:0,v=0}}return 2===i?new c(v,-g):new c(g,v)}return{statics:{classify:function(t){function i(t,i,n){var r=i!==e,s=r&&i>0&&i<1,a=r&&n>0&&n<1;return!r||(s||a)&&("loop"!==t||s&&a)||(t="arch",s=a=!1),{type:t,roots:s||a?s&&a?i<n?[i,n]:[n,i]:[s?i:n]:null}}var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],d=s*(r-c)+a*(l-n)+n*c-r*l,g=3*(o*(a-r)+h*(n-s)+s*r-a*n),v=g-d,p=v-d+(n*(c-h)+r*(o-l)+l*h-c*o),m=Math.sqrt(p*p+v*v+g*g),y=0!==m?1/m:0,w=u.isZero,x="serpentine";if(p*=y,v*=y,g*=y,w(p))return w(v)?i(w(g)?"line":"quadratic"):i(x,g/(3*v));var b=3*v*v-4*p*g;if(w(b))return i("cusp",v/(2*p));var C=b>0?Math.sqrt(b/3):Math.sqrt(-b),S=2*p;return i(b>0?x:"loop",(v+C)/S,(v-C)/S)},getLength:function(n,r,s,a){if(r===e&&(r=0),s===e&&(s=1),k.isStraight(n)){var o=n;s<1&&(o=k.subdivide(o,s)[0],r/=s),r>0&&(o=k.subdivide(o,r)[1]);var h=o[6]-o[0],l=o[7]-o[1];return Math.sqrt(h*h+l*l)}return u.integrate(a||t(n),r,s,i(r,s))},getTimeAt:function(n,r,s){if(s===e&&(s=r<0?1:0),0===r)return s;var o=Math.abs,l=r>0,c=l?s:0,f=l?1:s,d=t(n),_=k.getLength(n,c,f,d),g=o(r)-_;if(o(g)<1e-12)return l?f:c;if(g>1e-12)return null;var v=r/_,p=0;return u.findRoot(function(t){return p+=u.integrate(d,s,t,i(s,t)),s=t,p-r},d,s+v,c,f,32,1e-12)},getPoint:function(t,e){return n(t,e,0,!1)},getTangent:function(t,e){return n(t,e,1,!0)},getWeightedTangent:function(t,e){return n(t,e,1,!1)},getNormal:function(t,e){return n(t,e,2,!0)},getWeightedNormal:function(t,e){return n(t,e,2,!1)},getCurvature:function(t,e){return n(t,e,3,!1).x},getPeaks:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],l=3*n-e-3*s+t[6],c=3*e-6*n+3*s,f=-3*e+3*n,d=3*r-i-3*a+t[7],_=3*i-6*r+3*a,g=-3*i+3*r,m=[];return u.solveCubic(9*(l*l+d*d),9*(l*c+_*d),2*(c*c+_*_)+3*(f*l+g*d),f*c+_*g,m,1e-8,1-1e-8),m.sort()}}}},new function(){function t(t,e,i,n,r,s,a,o,h){var u=!h&&i.getPrevious()===s,l=!h&&i!==s&&i.getNext()===s,c=1e-8,f=1-c;if(null==n&&(n=i.getTimeOf(r)),null!==n&&n>=(u?c:0)&&n<=(l?f:1)&&(null==a&&(a=s.getTimeOf(o)),null!==a&&a>=(l?c:0)&&a<=(u?f:1))){var d=new O(i,n,r||i.getPointAtTime(n),h),_=new O(s,a,o||s.getPointAtTime(a),h);d._intersection=_,_._intersection=d,e&&!e(d)||O.insert(t,d,!0)}}function e(r,s,a,o,h,u,l,c,f,d,_,g,v){if(++f>=4096||++c>=40)return f;var p,y,x=s[0],b=s[1],C=s[6],S=s[7],P=m.getSignedDistance,I=P(x,b,C,S,s[2],s[3]),M=P(x,b,C,S,s[4],s[5]),T=I*M>0?.75:4/9,z=T*Math.min(0,I,M),O=T*Math.max(0,I,M),A=P(x,b,C,S,r[0],r[1]),L=P(x,b,C,S,r[2],r[3]),N=P(x,b,C,S,r[4],r[5]),B=P(x,b,C,S,r[6],r[7]),j=function(t,e,i,n){var r,s=[0,t],a=[1/3,e],o=[2/3,i],h=[1,n],u=e-(2*t+n)/3,l=i-(t+2*n)/3;if(u*l<0)r=[[s,a,h],[s,o,h]];else{var c=u/l;r=[c>=2?[s,a,h]:c<=.5?[s,o,h]:[s,a,o,h],[s,h]]}return(u||l)<0?r.reverse():r}(A,L,N,B),E=j[0],D=j[1];if(0===I&&0===M&&0===A&&0===L&&0===N&&0===B||null==(p=n(E,D,z,O))||null==(y=n(E.reverse(),D.reverse(),z,O)))return f;var F=d+(_-d)*p,R=d+(_-d)*y;if(Math.max(v-g,R-F)<1e-9){var q=(F+R)/2,V=(g+v)/2;t(h,u,l?o:a,l?V:q,null,l?a:o,l?q:V,null)}else if(r=k.getPart(r,p,y),y-p>.8)if(R-F>v-g){q=(F+R)/2;f=e(s,(H=k.subdivide(r,.5))[0],o,a,h,u,!l,c,f,g,v,F,q),f=e(s,H[1],o,a,h,u,!l,c,f,g,v,q,R)}else{var H=k.subdivide(s,.5),V=(g+v)/2;f=e(H[0],r,o,a,h,u,!l,c,f,g,V,F,R),f=e(H[1],r,o,a,h,u,!l,c,f,V,v,F,R)}else f=v-g>=1e-9?e(s,r,o,a,h,u,!l,c,f,g,v,F,R):e(r,s,a,o,h,u,l,c,f,F,R,g,v);return f}function n(t,e,i,n){return t[0][1]<i?r(t,!0,i):e[0][1]>n?r(e,!1,n):t[0][0]}function r(t,e,i){for(var n=t[0][0],r=t[0][1],s=1,a=t.length;s<a;s++){var o=t[s][0],h=t[s][1];if(e?h>=i:h<=i)return h===i?o:n+(i-r)*(o-n)/(h-r);n=o,r=h}return null}function s(t,e,i,n,r){var s=u.isZero;if(s(n)&&s(r)){var a=k.getTimeOf(t,new c(e,i));return null===a?[]:[a]}for(var o=Math.atan2(-r,n),h=Math.sin(o),l=Math.cos(o),f=[],d=[],_=0;_<8;_+=2){var g=t[_]-e,v=t[_+1]-i;f.push(g*l-v*h,g*h+v*l)}return k.solveCubic(f,1,0,d,0,1),d}function a(e,i,n,r,a,o,h){for(var u=i[0],l=i[1],d=s(e,u,l,i[6]-u,i[7]-l),_=0,g=d.length;_<g;_++){var v=d[_],p=k.getPoint(e,v),m=k.getTimeOf(i,p);if(null!==m){var y=k.getPoint(i,m);t(a,o,h?r:n,h?m:v,h?y:p,h?n:r,h?v:m,h?p:y)}}}function o(e,i,n,r,s,a){var o=m.intersect(e[0],e[1],e[6],e[7],i[0],i[1],i[6],i[7]);o&&t(s,a,n,null,o,r,null,o)}function h(i,n,r,s,h,u){var l=1e-12,c=Math.min,f=Math.max;if(f(i[0],i[2],i[4],i[6])+l>c(n[0],n[2],n[4],n[6])&&c(i[0],i[2],i[4],i[6])-l<f(n[0],n[2],n[4],n[6])&&f(i[1],i[3],i[5],i[7])+l>c(n[1],n[3],n[5],n[7])&&c(i[1],i[3],i[5],i[7])-l<f(n[1],n[3],n[5],n[7])){var _=d(i,n);if(_)for(var g=0;g<2;g++){var v=_[g];t(h,u,r,v[0],null,s,v[1],null,!0)}else{var p=k.isStraight(i),m=k.isStraight(n),w=p&&!m;(p&&m?o:p||m?a:e)(w?n:i,w?i:n,w?s:r,w?r:s,h,u,w,0,0,0,1,0,1)}}return h}function l(e,i,n,r){var s=k.classify(e);if("loop"===s.type){var a=s.roots;t(n,r,i,a[0],null,i,a[1],null)}return n}function d(t,e){function i(t){var e=t[6]-t[0],i=t[7]-t[1];return e*e+i*i}var n=Math.abs,r=m.getDistance,a=1e-7,o=k.isStraight(t),h=k.isStraight(e),u=o&&h,l=i(t)<i(e),f=l?e:t,d=l?t:e,_=f[0],g=f[1],v=f[6]-_,p=f[7]-g;if(r(_,g,v,p,d[0],d[1],!0)<a&&r(_,g,v,p,d[6],d[7],!0)<a)!u&&r(_,g,v,p,f[2],f[3],!0)<a&&r(_,g,v,p,f[4],f[5],!0)<a&&r(_,g,v,p,d[2],d[3],!0)<a&&r(_,g,v,p,d[4],d[5],!0)<a&&(o=h=u=!0);else if(u)return null;if(o^h)return null;for(var y=[t,e],w=[],x=0;x<4&&w.length<2;x++){var b=1&x,C=1^b,S=x>>1,P=k.getTimeOf(y[b],new c(y[C][S?6:0],y[C][S?7:1]));if(null!=P){var I=b?[S,P]:[P,S];(!w.length||n(I[0]-w[0][0])>1e-8&&n(I[1]-w[0][1])>1e-8)&&w.push(I)}if(x>2&&!w.length)break}if(2!==w.length)w=null;else if(!u){var M=k.getPart(t,w[0][0],w[1][0]),T=k.getPart(e,w[0][1],w[1][1]);(n(T[2]-M[2])>a||n(T[3]-M[3])>a||n(T[4]-M[4])>a||n(T[5]-M[5])>a)&&(w=null)}return w}return{getIntersections:function(t){var e=this.getValues(),i=t&&t!==this&&t.getValues();return i?h(e,i,this,t,[]):l(e,this,[])},statics:{getOverlaps:d,getIntersections:function(t,e,i,n,r,s){var a=!e;a&&(e=t);for(var o,u,c=t.length,f=e.length,d=[],_=[],g=0;g<f;g++)d[g]=e[g].getValues(r);for(g=0;g<c;g++){var v=t[g],p=a?d[g]:v.getValues(n),m=v.getPath();m!==u&&(u=m,o=[],_.push(o)),a&&l(p,v,o,i);for(var y=a?g+1:0;y<f;y++){if(s&&o.length)return o;h(p,d[y],v,e[y],o,i)}}o=[];for(var g=0,w=_.length;g<w;g++)o.push.apply(o,_[g]);return o},getCurveLineIntersections:s}}}),O=r.extend({_class:"CurveLocation",initialize:function(t,e,i,n,r){if(e>=.99999999){var s=t.getNext();s&&(e=0,t=s)}this._setCurve(t),this._time=e,this._point=i||t.getPointAtTime(e),this._overlap=n,this._distance=r,this._intersection=this._next=this._previous=null},_setCurve:function(t){var e=t._path;this._path=e,this._version=e?e._version:0,this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){this._setCurve(t.getCurve()),this._segment=t,this._time=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t=this._segment;if(!t){var e=this.getCurve(),i=this.getTime();0===i?t=e._segment1:1===i?t=e._segment2:null!=i&&(t=e.getPartLength(0,i)<e.getPartLength(i,1)?e._segment1:e._segment2),this._segment=t}return t},getCurve:function(){function t(t){var e=t&&t.getCurve();if(e&&null!=(i._time=e.getTimeOf(i._point)))return i._setCurve(e),e}var e=this._path,i=this;return e&&e._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null),this._curve||t(this._segment)||t(this._segment1)||t(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getTime:function(){var t=this.getCurve(),e=this._time;return t&&null==e?this._time=t.getTimeOf(this._point):e},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var t=this._offset;if(null==t){t=0;var e=this.getPath(),i=this.getIndex();if(e&&null!=i)for(var n=e.getCurves(),r=0;r<i;r++)t+=n[r].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t=this._curveOffset;if(null==t){var e=this.getCurve(),i=this.getTime();this._curveOffset=t=null!=i&&e&&e.getPartLength(0,i)}return t},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t=this.getCurve(),e=t&&t.divideAtTime(this.getTime());return e&&this._setSegment(e._segment1),e},split:function(){var t=this.getCurve(),e=t._path,i=t&&t.splitAtTime(this.getTime());return i&&this._setSegment(e.getLastSegment()),i},equals:function(t,e){var i=this===t;if(!i&&t instanceof O){var n=this.getCurve(),r=t.getCurve(),s=n._path;if(s===r._path){var o=Math.abs,u=o(this.getOffset()-t.getOffset()),l=!e&&this._intersection,c=!e&&t._intersection;i=(u<1e-7||s&&o(s.getLength()-u)<1e-7)&&(!l&&!c||l&&c&&l.equals(c,!0))}}return i},toString:function(){var t=[],e=this.getPoint(),i=h.instance;e&&t.push("point: "+e);var n=this.getIndex();null!=n&&t.push("index: "+n);var r=this.getTime();return null!=r&&t.push("time: "+i.number(r)),null!=this._distance&&t.push("distance: "+i.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){var t=this._intersection;if(t&&this.getTangent().isCollinear(t.getTangent())){var e=this.getCurve(),i=t.getCurve();return!(e.isStraight()&&i.isStraight()&&e.getLine().intersect(i.getLine()))}return!1},isCrossing:function(){function t(t,e){var i=t.getValues(),n=k.classify(i).roots||k.getPeaks(i),r=n.length,s=e&&r>1?n[r-1]:r>0?n[0]:.5;d.push(k.getLength(i,e?s:0,e?1:s)/2)}function e(t,e,i){return e<i?t>e&&t<i:t>e||t<i}var i=this._intersection;if(!i)return!1;var n=this.getTime(),r=i.getTime(),s=1e-8,a=1-s,o=n>=s&&n<=a,h=r>=s&&r<=a;if(o&&h)return!this.isTouching();var u=this.getCurve(),l=n<s?u.getPrevious():u,c=i.getCurve(),f=r<s?c.getPrevious():c;if(n>a&&(u=u.getNext()),r>a&&(c=c.getNext()),!(l&&u&&f&&c))return!1;var d=[];o||(t(l,!0),t(u,!1)),h||(t(f,!0),t(c,!1));var _=this.getPoint(),g=Math.min.apply(Math,d),v=o?u.getTangentAtTime(n):u.getPointAt(g).subtract(_),p=o?v.negate():l.getPointAt(-g).subtract(_),m=h?c.getTangentAtTime(r):c.getPointAt(g).subtract(_),y=h?m.negate():f.getPointAt(-g).subtract(_),w=p.getAngle(),x=v.getAngle(),b=y.getAngle(),C=m.getAngle();return!!(o?e(w,b,C)^e(x,b,C)&&e(w,C,b)^e(x,C,b):e(b,w,x)^e(C,w,x)&&e(b,x,w)^e(C,x,w))},hasOverlap:function(){return!!this._overlap}},r.each(k._evaluateMethods,function(t){var e=t+"At";this[t]=function(){var t=this.getCurve(),i=this.getTime();return null!=i&&t&&t[e](i,!0)}},{preserve:!0}),new function(){function t(t,e,i){function n(i,n){for(var s=i+n;s>=-1&&s<=r;s+=n){var a=t[(s%r+r)%r];if(!e.getPoint().isClose(a.getPoint(),1e-7))break;if(e.equals(a))return a}return null}for(var r=t.length,s=0,a=r-1;s<=a;){var o,h=s+a>>>1,u=t[h];if(i&&(o=e.equals(u)?u:n(h,-1)||n(h,1)))return e._overlap&&(o._overlap=o._intersection._overlap=!0),o;var l=e.getPath(),c=u.getPath();(l!==c?l._id-c._id:e.getIndex()+e.getTime()-(u.getIndex()+u.getTime()))<0?a=h-1:s=h+1}return t.splice(s,0,e),e}return{statics:{insert:t,expand:function(e){for(var i=e.slice(),n=e.length-1;n>=0;n--)t(i,e[n]._intersection,!1);return i}}}}),A=w.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(t){var e,i,n;if(r.isPlainObject(t)?(i=t.segments,e=t.pathData):Array.isArray(t)?i=t:"string"==typeof t&&(e=t),i){var s=i[0];n=s&&Array.isArray(s[0])}else e&&(n=(e.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(e));return new(n?N:L)(t)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse()},setPathData:function(t){function e(t,e){var i=+n[t];return o&&(i+=h[e]),i}function i(t){return new c(e(t,"x"),e(t+1,"y"))}var n,r,s,a=t&&t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),o=!1,h=new c,u=new c;this.clear();for(var l=0,f=a&&a.length;l<f;l++){var _=a[l],g=_[0],v=g.toLowerCase(),p=(n=_.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&n.length;switch(o=g===v,"z"!==r||/[mz]/.test(v)||this.moveTo(h),v){case"m":case"l":for(var m="m"===v,y=0;y<p;y+=2)this[m?"moveTo":"lineTo"](h=i(y)),m&&(u=h,m=!1);s=h;break;case"h":case"v":var w="h"===v?"x":"y";h=h.clone();for(y=0;y<p;y++)h[w]=e(y,w),this.lineTo(h);s=h;break;case"c":for(y=0;y<p;y+=6)this.cubicCurveTo(i(y),s=i(y+2),h=i(y+4));break;case"s":for(y=0;y<p;y+=4)this.cubicCurveTo(/[cs]/.test(r)?h.multiply(2).subtract(s):h,s=i(y),h=i(y+2)),r=v;break;case"q":for(y=0;y<p;y+=4)this.quadraticCurveTo(s=i(y),h=i(y+2));break;case"t":for(y=0;y<p;y+=2)this.quadraticCurveTo(s=/[qt]/.test(r)?h.multiply(2).subtract(s):h,h=i(y)),r=v;break;case"a":for(y=0;y<p;y+=7)this.arcTo(h=i(y+5),new d(+n[y],+n[y+1]),+n[y+2],+n[y+4],+n[y+3]);break;case"z":this.closePath(1e-12),h=u}r=v}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){var e=t.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(t):{};return e.onPath||!!("evenodd"===this.getFillRule()?1&e.windingL||1&e.windingR:e.winding)},getIntersections:function(t,e,i,n){var r=this===t||!t,s=this._matrix._orNullIfIdentity(),a=r?s:(i||t._matrix)._orNullIfIdentity();return r||this.getBounds(s).touches(t.getBounds(a))?k.getIntersections(this.getCurves(),!r&&t.getCurves(),e,s,a,n):[]},getCrossings:function(t){return this.getIntersections(t,function(t){return t.hasOverlap()||t.isCrossing()})},getNearestLocation:function(){for(var t=c.read(arguments),e=this.getCurves(),i=1/0,n=null,r=0,s=e.length;r<s;r++){var a=e[r].getNearestLocation(t);a._distance<i&&(i=a._distance,n=a)}return n},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t},interpolate:function(t,e,i){var n=!this._children,r=n?"_segments":"_children",s=t[r],a=e[r],o=this[r];if(!s||!a||s.length!==a.length)throw new Error("Invalid operands in interpolate() call: "+t+", "+e);var h=o.length,u=a.length;if(h<u)for(var l=n?T:L,c=h;c<u;c++)this.add(new l);else h>u&&this[n?"removeSegments":"removeChildren"](u,h);for(c=0;c<u;c++)o[c].interpolate(s[c],a[c],i);n&&(this.setClosed(t._closed),this._changed(9))},compare:function(t){var e=!1;if(t){var i=this._children||[this],n=t._children?t._children.slice():[t],r=i.length,s=n.length,a=[],o=0;e=!0;for(var h=r-1;h>=0&&e;h--){var u=i[h];e=!1;for(var l=s-1;l>=0&&!e;l--)u.compare(n[l])&&(a[l]||(a[l]=!0,o++),e=!0)}e=e&&o===s}return e}}),L=A.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(t){this._closed=!1,this._segments=[],this._version=0;var i=Array.isArray(t)?"object"==typeof t[0]?t:arguments:!t||t.size!==e||t.x===e&&t.point===e?null:arguments;i&&i.length>0?this.setSegments(i):(this._curves=e,this._segmentSelection=0,i||"string"!=typeof t||(this.setPathData(t),t=null)),this._initialize(!i&&t)},_equals:function(t){return this._closed===t._closed&&r.equals(this._segments,t._segments)},copyContent:function(t){this.setSegments(t._segments),this._closed=t._closed},_changed:function gt(t){if(gt.base.call(this,t),8&t){if(this._length=this._area=e,16&t)this._version++;else if(this._curves)for(var i=0,n=this._curves.length;i<n;i++)this._curves[i]._changed()}else 32&t&&(this._bounds=e)},getStyle:function(){var t=this._parent;return(t instanceof N?t:this)._style},getSegments:function(){return this._segments},setSegments:function(t){var i=this.isFullySelected(),n=t&&t.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=e,n){var r=t[n-1];"boolean"==typeof r&&(this.setClosed(r),n--),this._add(T.readList(t,0,{},n))}i&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t){var i=this._countCurves();t=this._curves=new Array(i);for(var n=0;n<i;n++)t[n]=new k(this,e[n],e[n+1]||e[0])}return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){if(this._closed!=(t=!!t)){if(this._closed=t,this._curves){var e=this._curves.length=this._countCurves();t&&(this._curves[e-1]=new k(this,this._segments[e-1],this._segments[0]))}this._changed(25)}}},{beans:!0,getPathData:function(t,e){function i(e,i){if(e._transformCoordinates(t,g),n=g[0],r=g[1],v)p.push("M"+_.pair(n,r)),v=!1;else if(o=g[2],u=g[3],o===n&&u===r&&l===s&&c===a){if(!i){var h=n-s,f=r-a;p.push(0===h?"v"+_.number(f):0===f?"h"+_.number(h):"l"+_.pair(h,f))}}else p.push("c"+_.pair(l-s,c-a)+" "+_.pair(o-s,u-a)+" "+_.pair(n-s,r-a));s=n,a=r,l=g[4],c=g[5]}var n,r,s,a,o,u,l,c,f=this._segments,d=f.length,_=new h(e),g=new Array(6),v=!0,p=[];if(!d)return"";for(var m=0;m<d;m++)i(f[m]);return this._closed&&d>0&&(i(f[0],!0),p.push("z")),p.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(t){for(var e=this._segments,i=new Array(6),n=0,r=e.length;n<r;n++)e[n]._transformCoordinates(t,i,!0);return!0},_add:function(t,e){for(var i=this._segments,n=this._curves,r=t.length,s=null==e,e=s?i.length:e,a=0;a<r;a++){var o=t[a];o._path&&(o=t[a]=o.clone()),o._path=this,o._index=e+a,o._selection&&this._updateSelection(o,0,o._selection)}if(s)i.push.apply(i,t);else{i.splice.apply(i,[e,0].concat(t));for(var a=e+r,h=i.length;a<h;a++)i[a]._index=a}if(n){var u=this._countCurves(),l=e>0&&e+r-1===u?e-1:e,c=l,f=Math.min(l+r,u);t._curves&&(n.splice.apply(n,[l,0].concat(t._curves)),c+=t._curves.length);for(a=c;a<f;a++)n.splice(a,0,new k(this,null,null));this._adjustCurves(l,f)}return this._changed(25),t},_adjustCurves:function(t,e){for(var i,n=this._segments,r=this._curves,s=t;s<e;s++)i=r[s],i._path=this,i._segment1=n[s],i._segment2=n[s+1]||n[0],i._changed();(i=r[this._closed&&!t?n.length-1:t-1])&&(i._segment2=n[t]||n[0],i._changed()),(i=r[e])&&(i._segment1=n[e],i._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&t>0?t-1:t},add:function(t){return arguments.length>1&&"number"!=typeof t?this._add(T.readList(arguments)):this._add([T.read(arguments)])[0]},insert:function(t,e){return arguments.length>2&&"number"!=typeof e?this._add(T.readList(arguments,1),t):this._add([T.read(arguments,1)],t)[0]},addSegment:function(){return this._add([T.read(arguments)])[0]},insertSegment:function(t){return this._add([T.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(T.readList(t))},insertSegments:function(t,e){return this._add(T.readList(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,e,i){t=t||0,e=r.pick(e,this._segments.length);var n=this._segments,s=this._curves,a=n.length,o=n.splice(t,e-t),h=o.length;if(!h)return o;for(u=0;u<h;u++){var l=o[u];l._selection&&this._updateSelection(l,l._selection,0),l._index=l._path=null}for(var u=t,c=n.length;u<c;u++)n[u]._index=u;if(s){for(var f=t>0&&e===a+(this._closed?1:0)?t-1:t,u=(s=s.splice(f,h)).length-1;u>=0;u--)s[u]._path=null;i&&(o._curves=s.slice(1)),this._adjustCurves(f,f)}return this._changed(25),o},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();this._length=e}return this._length},getArea:function(){var t=this._area;if(null==t){var e=this._segments,i=this._closed;t=0;for(var n=0,r=e.length;n<r;n++){var s=n+1===r;t+=k.getArea(k.getValues(e[n],e[s?0:n+1],null,s&&!i))}this._area=t}return t},isFullySelected:function(){var t=this._segments.length;return this.isSelected()&&t>0&&this._segmentSelection===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelection:function vt(t){1&t||this._selectSegments(!1),vt.base.call(this,t)},_selectSegments:function(t){var e=this._segments,i=e.length,n=t?7:0;this._segmentSelection=n*i;for(var r=0;r<i;r++)e[r]._selection=n},_updateSelection:function(t,e,i){t._selection=i;(this._segmentSelection+=i-e)>0&&this.setSelected(!0)},divideAt:function(t){var e,i=this.getLocationAt(t);return i&&(e=i.getCurve().divideAt(i.getCurveOffset()))?e._segment1:null},splitAt:function(t){var e=this.getLocationAt(t),i=e&&e.index,n=e&&e.time;n>1-1e-8&&(i++,n=0);var a=this.getCurves();if(i>=0&&i<a.length){n>=1e-8&&a[i++].divideAtTime(n);var o,h=this.removeSegments(i,this._segments.length,!0);return this._closed?(this.setClosed(!1),o=this):((o=new L(w.NO_INSERT)).insertAbove(this),o.copyAttributes(this)),o._add(h,0),this.addSegment(h[0]),o}return null},split:function(t,i){var n,r=i===e?t:(n=this.getCurves()[t])&&n.getLocationAtTime(i);return null!=r?this.splitAt(r):null},join:function(t,e){var i=e||0;if(t&&t!==this){var n=t._segments,r=this.getLastSegment(),s=t.getLastSegment();if(!s)return this;r&&r._point.isClose(s._point,i)&&t.reverse();var a=t.getFirstSegment();if(r&&r._point.isClose(a._point,i))r.setHandleOut(a._handleOut),this._add(n.slice(1));else{var o=this.getFirstSegment();o&&o._point.isClose(a._point,i)&&t.reverse(),s=t.getLastSegment(),o&&o._point.isClose(s._point,i)?(o.setHandleIn(s._handleIn),this._add(n.slice(0,n.length-1),0)):this._add(n.slice())}t._closed&&this._add([n[0]]),t.remove()}var h=this.getFirstSegment(),u=this.getLastSegment();return h!==u&&h._point.isClose(u._point,i)&&(h.setHandleIn(u._handleIn),u.remove(),this.setClosed(!0)),this},reduce:function(t){for(var e=this.getCurves(),i=t&&t.simplify,n=i?1e-7:0,r=e.length-1;r>=0;r--){var s=e[r];!s.hasHandles()&&(!s.hasLength(n)||i&&s.isCollinear(s.getNext()))&&s.remove()}return this},reverse:function(){this._segments.reverse();for(var t=0,e=this._segments.length;t<e;t++){var i=this._segments[t],n=i._handleIn;i._handleIn=i._handleOut,i._handleOut=n,i._index=t}this._curves=null,this._changed(9)},flatten:function(t){for(var i=new B(this,t||.25,256,!0).parts,n=i.length,r=[],s=0;s<n;s++)r.push(new T(i[s].curve.slice(0,2)));!this._closed&&n>0&&r.push(new T(i[n-1].curve.slice(6))),this.setSegments(r)},simplify:function(t){var e=new j(this).fit(t||2.5);return e&&this.setSegments(e),!!e},smooth:function(t){function i(t,e){var i=t&&t.index;if(null!=i){var r=t.path;if(r&&r!==n)throw new Error(t._class+" "+i+" of "+r+" is not part of "+n);e&&t instanceof k&&i++}else i="number"==typeof t?t:e;return Math.min(i<0&&h?i%o:i<0?i+o:i,o-1)}var n=this,r=t||{},s=r.type||"asymmetric",a=this._segments,o=a.length,h=this._closed,u=h&&r.from===e&&r.to===e,l=i(r.from,0),c=i(r.to,o-1);if(l>c)if(h)l-=o;else{var f=l;l=c,c=f}if(/^(?:asymmetric|continuous)$/.test(s)){var d="asymmetric"===s,_=Math.min,g=c-l+1,v=g-1,p=u?_(g,4):1,m=p,y=p,w=[];if(h||(m=_(1,l),y=_(1,o-c-1)),(v+=m+y)<=1)return;for(var x=0,b=l-m;x<=v;x++,b++)w[x]=a[(b<0?b+o:b)%o]._point;for(var C=w[0]._x+2*w[1]._x,S=w[0]._y+2*w[1]._y,P=2,I=v-1,M=[C],T=[S],z=[P],O=[],A=[],x=1;x<v;x++){var L=x<I,B=L?4:d?2:7,j=L?4:d?3:8,E=L?2:d?0:1,D=(L?1:d?1:2)/P;P=z[x]=B-D,C=M[x]=j*w[x]._x+E*w[x+1]._x-D*C,S=T[x]=j*w[x]._y+E*w[x+1]._y-D*S}O[I]=M[I]/z[I],A[I]=T[I]/z[I];for(x=v-2;x>=0;x--)O[x]=(M[x]-O[x+1])/z[x],A[x]=(T[x]-A[x+1])/z[x];O[v]=(3*w[v]._x-O[I])/2,A[v]=(3*w[v]._y-A[I])/2;for(var x=m,F=v-y,b=l;x<=F;x++,b++){var R=a[b<0?b+o:b],q=R._point,V=O[x]-q._x,H=A[x]-q._y;(u||x<F)&&R.setHandleOut(V,H),(u||x>m)&&R.setHandleIn(-V,-H)}}else for(x=l;x<=c;x++)a[x<0?x+o:x].smooth(r,!u&&x===l,!u&&x===c)},toShape:function(t){function i(t,e){var i=c[t],n=i.getNext(),r=c[e],s=r.getNext();return i._handleOut.isZero()&&n._handleIn.isZero()&&r._handleOut.isZero()&&s._handleIn.isZero()&&n._point.subtract(i._point).isCollinear(s._point.subtract(r._point))}function r(t){var e=c[t],i=e.getNext(),n=e._handleOut,r=i._handleIn,s=.5522847498307936;if(n.isOrthogonal(r)){var a=e._point,o=i._point,h=new m(a,n,!0).intersect(new m(o,r,!0),!0);return h&&u.isZero(n.getLength()/h.subtract(a).getLength()-s)&&u.isZero(r.getLength()/h.subtract(o).getLength()-s)}return!1}function s(t,e){return c[t]._point.getDistance(c[e]._point)}if(!this._closed)return null;var a,o,h,l,c=this._segments;if(!this.hasHandles()&&4===c.length&&i(0,2)&&i(1,3)&&function(t){var e=c[t],i=e.getPrevious(),n=e.getNext();return i._handleOut.isZero()&&e._handleIn.isZero()&&e._handleOut.isZero()&&n._handleIn.isZero()&&e._point.subtract(i._point).isOrthogonal(n._point.subtract(e._point))}(1)?(a=C.Rectangle,o=new d(s(0,3),s(0,1)),l=c[1]._point.add(c[2]._point).divide(2)):8===c.length&&r(0)&&r(2)&&r(4)&&r(6)&&i(1,5)&&i(3,7)?(a=C.Rectangle,o=new d(s(1,6),s(0,3)),h=o.subtract(new d(s(0,7),s(1,2))).divide(2),l=c[3]._point.add(c[4]._point).divide(2)):4===c.length&&r(0)&&r(1)&&r(2)&&r(3)&&(u.isZero(s(0,2)-s(1,3))?(a=C.Circle,h=s(0,2)/2):(a=C.Ellipse,h=new d(s(2,0)/2,s(3,1)/2)),l=c[1]._point),a){var f=this.getPosition(!0),_=new a({center:f,size:o,radius:h,insert:!1});return _.copyAttributes(this,!0),_._matrix.prepend(this._matrix),_.rotate(l.subtract(f).getAngle()+90),(t===e||t)&&_.insertAbove(this),_}return null},toPath:"#clone",compare:function pt(t){if(!t||t instanceof N)return pt.base.call(this,t);var e=this.getCurves(),i=t.getCurves(),n=e.length,r=i.length;if(!n||!r)return n==r;for(var s,a,o=e[0].getValues(),h=[],u=0,l=0,c=0;c<r;c++){f=i[c].getValues();h.push(f);if(d=k.getOverlaps(o,f)){s=!c&&d[0][0]>0?r-1:c,a=d[0][1];break}}for(var _,g=Math.abs,f=h[s];o&&f;){var d=k.getOverlaps(o,f);if(d){if(g(d[0][0]-l)<1e-8){1===(l=d[1][0])&&(o=++u<n?e[u].getValues():null,l=0);var m=d[0][1];if(g(m-a)<1e-8){if(_||(_=[s,m]),1===(a=d[1][1])&&(++s>=r&&(s=0),f=h[s]||i[s].getValues(),a=0),!o)return _[0]===s&&_[1]===a;continue}}}break}return!1},_hitTestSelf:function(t,e,i,n){function r(e,i){return t.subtract(e).divide(i).length<=1}function s(t,i,n){if(!e.selected||i.isSelected()){var s=t._point;if(i!==s&&(i=i.add(s)),r(i,x))return new M(n,g,{segment:t,point:i})}}function a(t,i){return(i||e.segments)&&s(t,t._point,"segment")||!i&&e.handles&&(s(t,t._handleIn,"handle-in")||s(t,t._handleOut,"handle-out"))}function o(t){f.add(t)}function h(e){var i=y||e._index>0&&e._index<m-1;if("round"===(i?u:l))return r(e._point,x);if(f=new L({internal:!0,closed:!0}),i?e.isSmooth()||L._addBevelJoin(e,u,P,c,null,n,o,!0):"square"===l&&L._addSquareCap(e,l,P,null,n,o,!0),!f.isEmpty()){var s;return f.contains(t)||(s=f.getNearestLocation(t))&&r(s.getPoint(),w)}}var u,l,c,f,d,_,g=this,v=this.getStyle(),p=this._segments,m=p.length,y=this._closed,w=e._tolerancePadding,x=w,b=e.stroke&&v.hasStroke(),C=e.fill&&v.hasFill(),S=e.curves,P=b?v.getStrokeWidth()/2:C&&e.tolerance>0||S?0:null;if(null!==P&&(P>0?(u=v.getStrokeJoin(),l=v.getStrokeCap(),c=v.getMiterLimit(),x=x.add(L._getStrokePadding(P,n))):u=l="round"),!e.ends||e.segments||y){if(e.segments||e.handles)for(I=0;I<m;I++)if(_=a(p[I]))return _}else if(_=a(p[0],!0)||a(p[m-1],!0))return _;if(null!==P){if(d=this.getNearestLocation(t)){var T=d.getTime();0===T||1===T&&m>1?h(d.getSegment())||(d=null):r(d.getPoint(),x)||(d=null)}if(!d&&"miter"===u&&m>1)for(var I=0;I<m;I++){var z=p[I];if(t.getDistance(z._point)<=c*P&&h(z)){d=z.getLocation();break}}}return!d&&C&&this._contains(t)||d&&!b&&!S?new M("fill",this):d?new M(b?"stroke":"curve",this,{location:d,point:d.getPoint()}):null}},r.each(k._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this.getLocationAt(e);return i&&i[t]()}},{beans:!1,getLocationOf:function(){for(var t=c.read(arguments),e=this.getCurves(),i=0,n=e.length;i<n;i++){var r=e[i].getLocationOf(t);if(r)return r}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t){if("number"==typeof t){for(var e=this.getCurves(),i=0,n=0,r=e.length;n<r;n++){var s=i,a=e[n];if((i+=a.getLength())>t)return a.getLocationAt(t-s)}if(e.length>0&&t<=this.getLength())return new O(e[e.length-1],1)}else if(t&&t.getPath&&t.getPath()===this)return t;return null}}),new function(){function e(t,e,i){function n(e){if(i)e._transformCoordinates(i,_),r=_[0],s=_[1];else{var n=e._point;r=n._x,s=n._y}if(g)t.moveTo(r,s),g=!1;else{if(i)h=_[2],u=_[3];else{f=e._handleIn;h=r+f._x,u=s+f._y}h===r&&u===s&&l===a&&c===o?t.lineTo(r,s):t.bezierCurveTo(l,c,h,u,r,s)}if(a=r,o=s,i)l=_[4],c=_[5];else{var f=e._handleOut;l=a+f._x,c=o+f._y}}for(var r,s,a,o,h,u,l,c,f=e._segments,d=f.length,_=new Array(6),g=!0,v=0;v<d;v++)n(f[v]);e._closed&&d>0&&n(f[0])}return{_draw:function(t,i,n,r){function s(t){return c[(t%f+f)%f]}var a=i.dontStart,o=i.dontFinish||i.clip,h=this.getStyle(),u=h.hasFill(),l=h.hasStroke(),c=h.getDashArray(),f=!paper.support.nativeDash&&l&&c&&c.length;if(a||t.beginPath(),(u||l&&!f||o)&&(e(t,this,r),this._closed&&t.closePath()),!o&&(u||l)&&(this._setStyles(t,i,n),u&&(t.fill(h.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),l)){if(f){a||t.beginPath();var d,_=new B(this,.25,32,!1,r),g=_.length,v=-h.getDashOffset(),p=0;for(v%=g;v>0;)v-=s(p--)+s(p--);for(;v<g;)d=v+s(p++),(v>0||d>0)&&_.drawPart(t,Math.max(v,0),Math.max(d,0)),v=d+s(p++)}t.stroke()}},_drawSelected:function(i,n){i.beginPath(),e(i,this,n),i.stroke(),function(t,e,i,n){function r(e){var i=h[e],n=h[e+1];s==i&&a==n||(t.beginPath(),t.moveTo(s,a),t.lineTo(i,n),t.stroke(),t.beginPath(),t.arc(i,n,o,0,2*Math.PI,!0),t.fill())}for(var s,a,o=n/2,h=new Array(6),u=0,l=e.length;u<l;u++){var c=e[u],f=c._selection;if(c._transformCoordinates(i,h),s=h[0],a=h[1],2&f&&r(2),4&f&&r(4),t.fillRect(s-o,a-o,n,n),!(1&f)){var d=t.fillStyle;t.fillStyle="#ffffff",t.fillRect(s-o+1,a-o+1,n-2,n-2),t.fillStyle=d}}}(i,this._segments,n,paper.settings.handleSize)}}},new function(){function t(t){var e=t._segments;if(!e.length)throw new Error("Use a moveTo() command first");return e[e.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new T(c.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new T(c.read(arguments))])},cubicCurveTo:function(){var e=c.read(arguments),i=c.read(arguments),n=c.read(arguments),r=t(this);r.setHandleOut(e.subtract(r._point)),this._add([new T(n,i.subtract(n))])},quadraticCurveTo:function(){var e=c.read(arguments),i=c.read(arguments),n=t(this)._point;this.cubicCurveTo(e.add(n.subtract(e).multiply(1/3)),e.add(i.subtract(e).multiply(1/3)),i)},curveTo:function(){var e=c.read(arguments),i=c.read(arguments),n=r.pick(r.read(arguments),.5),s=1-n,a=t(this)._point,o=e.subtract(a.multiply(s*s)).subtract(i.multiply(n*n)).divide(2*n*s);if(o.isNaN())throw new Error("Cannot put a curve through points with parameter = "+n);this.quadraticCurveTo(o,i)},arcTo:function(){var i,n,s,a,o=Math.abs,h=Math.sqrt,l=t(this),f=l._point,_=c.read(arguments),g=r.peek(arguments);if("boolean"==typeof(v=r.pick(g,!0)))var y=f.add(_).divide(2),e=y.add(y.subtract(f).rotate(v?-90:90));else if(r.remain(arguments)<=2)e=_,_=c.read(arguments);else{var w=d.read(arguments),x=u.isZero;if(x(w.width)||x(w.height))return this.lineTo(_);var b=r.read(arguments),v=!!r.read(arguments),C=!!r.read(arguments),y=f.add(_).divide(2),P=(S=f.subtract(y).rotate(-b)).x,I=S.y,M=o(w.width),z=o(w.height),k=M*M,O=z*z,A=P*P,L=I*I,N=h(A/k+L/O);if(N>1&&(M*=N,z*=N,k=M*M,O=z*z),N=(k*O-k*L-O*A)/(k*L+O*A),o(N)<1e-12&&(N=0),N<0)throw new Error("Cannot create an arc with the given arguments");i=new c(M*I/z,-z*P/M).multiply((C===v?-1:1)*h(N)).rotate(b).add(y),n=(s=(a=(new p).translate(i).rotate(b).scale(M,z))._inverseTransform(f)).getDirectedAngle(a._inverseTransform(_)),!v&&n>0?n-=360:v&&n<0&&(n+=360)}if(e){var B=new m(f.add(e).divide(2),e.subtract(f).rotate(90),!0),j=new m(e.add(_).divide(2),_.subtract(e).rotate(90),!0),E=new m(f,_),D=E.getSide(e);if(!(i=B.intersect(j,!0))){if(!D)return this.lineTo(_);throw new Error("Cannot create an arc with the given arguments")}n=(s=f.subtract(i)).getDirectedAngle(_.subtract(i));var F=E.getSide(i);0===F?n=D*o(n):D===F&&(n+=n<0?360:-360)}for(var q=o(n),V=q>=360?4:Math.ceil((q-1e-12)/90),H=n/V,Z=H*Math.PI/360,U=4/3*Math.sin(Z)/(1+Math.cos(Z)),W=[],G=0;G<=V;G++){var S=_,J=null;if(G<V&&(J=s.rotate(90).multiply(U),a?(S=a._transformPoint(s),J=a._transformPoint(s.add(J)).subtract(S)):S=i.add(s)),G){var X=s.rotate(-90).multiply(U);a&&(X=a._transformPoint(s.add(X)).subtract(S)),W.push(new T(S,X,J))}else l.setHandleOut(J);s=s.rotate(H)}this._add(W)},lineBy:function(){var e=c.read(arguments),i=t(this)._point;this.lineTo(i.add(e))},curveBy:function(){var e=c.read(arguments),i=c.read(arguments),n=r.read(arguments),s=t(this)._point;this.curveTo(s.add(e),s.add(i),n)},cubicCurveBy:function(){var e=c.read(arguments),i=c.read(arguments),n=c.read(arguments),r=t(this)._point;this.cubicCurveTo(r.add(e),r.add(i),r.add(n))},quadraticCurveBy:function(){var e=c.read(arguments),i=c.read(arguments),n=t(this)._point;this.quadraticCurveTo(n.add(e),n.add(i))},arcBy:function(){var e=t(this)._point,i=e.add(c.read(arguments)),n=r.pick(r.peek(arguments),!0);"boolean"==typeof n?this.arcTo(i,n):this.arcTo(i,e.add(c.read(arguments)))},closePath:function(t){this.setClosed(!0),this.join(this,t)}}},{_getBounds:function(t,e){var i=e.handle?"getHandleBounds":e.stroke?"getStrokeBounds":"getBounds";return L[i](this._segments,this._closed,this,t,e)},statics:{getBounds:function(t,e,i,n,r,s){function a(t){t._transformCoordinates(n,h);for(var e=0;e<2;e++)k._addBounds(u[e],u[e+4],h[e+2],h[e],e,s?s[e]:0,l,c,f);var i=u;u=h,h=i}var o=t[0];if(!o)return new g;for(var h=new Array(6),u=o._transformCoordinates(n,new Array(6)),l=u.slice(0,2),c=l.slice(),f=new Array(2),d=1,_=t.length;d<_;d++)a(t[d]);return e&&a(o),new g(l[0],l[1],c[0]-l[0],c[1]-l[1])},getStrokeBounds:function(t,e,i,n,r){function s(t){v=v.include(t)}function a(t){v=v.unite(x.setCenter(t._point.transform(n)))}function o(t,e){"round"===e||t.isSmooth()?a(t):L._addBevelJoin(t,e,p,w,n,f,s)}function h(t,e){"round"===e?a(t):L._addSquareCap(t,e,p,n,f,s)}var u=i.getStyle(),l=u.hasStroke(),c=u.getStrokeWidth(),f=l&&i._getStrokeMatrix(n,r),_=l&&L._getStrokePadding(c,f),v=L.getBounds(t,e,i,n,r,_);if(!l)return v;for(var p=c/2,m=u.getStrokeJoin(),y=u.getStrokeCap(),w=u.getMiterLimit(),x=new g(new d(_)),b=t.length-(e?0:1),C=1;C<b;C++)o(t[C],m);return e?o(t[0],m):b>0&&(h(t[0],y),h(t[t.length-1],y)),v},_getStrokePadding:function(t,e){if(!e)return[t,t];var i=new c(t,0).transform(e),n=new c(0,t).transform(e),r=i.getAngleInRadians(),s=i.getLength(),a=n.getLength(),o=Math.sin(r),h=Math.cos(r),u=Math.tan(r),l=Math.atan2(a*u,s),f=Math.atan2(a,u*s);return[Math.abs(s*Math.cos(l)*h+a*Math.sin(l)*o),Math.abs(a*Math.sin(f)*h+s*Math.cos(f)*o)]},_addBevelJoin:function(t,e,i,n,r,s,a,o){var h=t.getCurve(),u=h.getPrevious(),l=h.getPoint1().transform(r),f=u.getNormalAtTime(1).multiply(i).transform(s),d=h.getNormalAtTime(0).multiply(i).transform(s);if(f.getDirectedAngle(d)<0&&(f=f.negate(),d=d.negate()),o&&a(l),a(l.add(f)),"miter"===e){var _=new m(l.add(f),new c(-f.y,f.x),!0).intersect(new m(l.add(d),new c(-d.y,d.x),!0),!0);_&&l.getDistance(_)<=n*i&&a(_)}a(l.add(d))},_addSquareCap:function(t,e,i,n,r,s,a){var o=t._point.transform(n),h=t.getLocation(),u=h.getNormal().multiply(i).transform(r);"square"===e&&(a&&(s(o.subtract(u)),s(o.add(u))),o=o.add(u.rotate(0===h.getTime()?-90:90))),s(o.add(u)),s(o.subtract(u))},getHandleBounds:function(t,e,i,n,r){var s,a,o=i.getStyle();if(r.stroke&&o.hasStroke()){var u=i._getStrokeMatrix(n,r),l=o.getStrokeWidth()/2,c=l;"miter"===o.getStrokeJoin()&&(c=l*o.getMiterLimit()),"square"===o.getStrokeCap()&&(c=Math.max(c,l*Math.SQRT2)),s=L._getStrokePadding(l,u),a=L._getStrokePadding(c,u)}for(var f=new Array(6),d=1/0,_=-d,v=d,p=_,m=0,y=t.length;m<y;m++){t[m]._transformCoordinates(n,f);for(var x=0;x<6;x+=2){var b=x?s:a,C=b?b[0]:0,S=b?b[1]:0,P=f[x],I=f[x+1],M=P-C,T=P+C,z=I-S,k=I+S;M<d&&(d=M),T>_&&(_=T),z<v&&(v=z),k>p&&(p=k)}}return new g(d,v,_-d,p-v)}}});L.inject({statics:new function(){function t(t,e,i){var n=r.getNamed(i),s=new L(n&&!1===n.insert&&w.NO_INSERT);return s._add(t),s._closed=e,s.set(n)}function e(e,i,r){for(var s=new Array(4),a=0;a<4;a++){var o=n[a];s[a]=new T(o._point.multiply(i).add(e),o._handleIn.multiply(i),o._handleOut.multiply(i))}return t(s,!0,r)}var i=.5522847498307936,n=[new T([-1,0],[0,i],[0,-i]),new T([0,-1],[-i,0],[i,0]),new T([1,0],[0,-i],[0,i]),new T([0,1],[i,0],[-i,0])];return{Line:function(){return t([new T(c.readNamed(arguments,"from")),new T(c.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var t=c.readNamed(arguments,"center"),i=r.readNamed(arguments,"radius");return e(t,new d(i),arguments)},Rectangle:function(){var e,n=g.readNamed(arguments,"rectangle"),r=d.readNamed(arguments,"radius",0,{readNull:!0}),s=n.getBottomLeft(!0),a=n.getTopLeft(!0),o=n.getTopRight(!0),h=n.getBottomRight(!0);if(!r||r.isZero())e=[new T(s),new T(a),new T(o),new T(h)];else{var u=(r=d.min(r,n.getSize(!0).divide(2))).width,l=r.height,c=u*i,f=l*i;e=[new T(s.add(u,0),null,[-c,0]),new T(s.subtract(0,l),[0,f]),new T(a.add(0,l),null,[0,-f]),new T(a.add(u,0),[-c,0],null),new T(o.subtract(u,0),null,[c,0]),new T(o.add(0,l),[0,-f],null),new T(h.subtract(0,l),null,[0,f]),new T(h.subtract(u,0),[c,0])]}return t(e,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=C._readEllipse(arguments);return e(t.center,t.radius,arguments)},Oval:"#Ellipse",Arc:function(){var t=c.readNamed(arguments,"from"),e=c.readNamed(arguments,"through"),i=c.readNamed(arguments,"to"),n=r.getNamed(arguments),s=new L(n&&!1===n.insert&&w.NO_INSERT);return s.moveTo(t),s.arcTo(e,i),s.set(n)},RegularPolygon:function(){for(var e=c.readNamed(arguments,"center"),i=r.readNamed(arguments,"sides"),n=r.readNamed(arguments,"radius"),s=360/i,a=i%3==0,o=new c(0,a?-n:n),h=a?-1:.5,u=new Array(i),l=0;l<i;l++)u[l]=new T(e.add(o.rotate((l+h)*s)));return t(u,!0,arguments)},Star:function(){for(var e=c.readNamed(arguments,"center"),i=2*r.readNamed(arguments,"points"),n=r.readNamed(arguments,"radius1"),s=r.readNamed(arguments,"radius2"),a=360/i,o=new c(0,-1),h=new Array(i),u=0;u<i;u++)h[u]=new T(e.add(o.rotate(a*u).multiply(u%2?s:n)));return t(h,!0,arguments)}}}});var N=A.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function mt(t,e){var i=e,n=i[0];n&&"number"==typeof n[0]&&(i=[i]);for(var s=e.length-1;s>=0;s--){var a=i[s];i!==e||a instanceof L||(i=r.slice(i)),Array.isArray(a)?i[s]=new L({segments:a,insert:!1}):a instanceof N&&(i.splice.apply(i,[s,1].concat(a.removeChildren())),a.remove())}return mt.base.call(this,t,i)},reduce:function yt(t){for(var e=this._children,i=e.length-1;i>=0;i--){(n=e[i].reduce(t)).isEmpty()&&n.remove()}if(!e.length){var n=new L(w.NO_INSERT);return n.copyAttributes(this),n.insertAbove(this),this.remove(),n}return yt.base.call(this)},isClosed:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)if(!t[e]._closed)return!1;return!0},setClosed:function(t){for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setClosed(t)},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)e.push.apply(e,t[i].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getLastCurve()},getArea:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getArea();return e},getLength:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();return e},getPathData:function(t,e){for(var i=this._children,n=[],r=0,s=i.length;r<s;r++){var a=i[r],o=a._matrix;n.push(a.getPathData(t&&!o.isIdentity()?t.appended(o):t,e))}return n.join("")},_hitTestChildren:function wt(t,e,i){return wt.base.call(this,t,e.class===L||"path"===e.type?e:r.set({},e,{fill:!1}),i)},_draw:function(t,e,i,n){var r=this._children;if(r.length){e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var s=0,a=r.length;s<a;s++)r[s].draw(t,e,n);if(!e.clip){this._setStyles(t,e,i);var o=this._style;o.hasFill()&&(t.fill(o.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),o.hasStroke()&&t.stroke()}}},_drawSelected:function(t,e,i){for(var n=this._children,r=0,s=n.length;r<s;r++){var a=n[r],o=a._matrix;i[a._id]||a._drawSelected(t,o.isIdentity()?e:e.appended(o))}}},new function(){function t(t,e){var i=t._children;if(e&&!i.length)throw new Error("Use a moveTo() command first");return i[i.length-1]}return r.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(e){this[e]=function(){var i=t(this,!0);i[e].apply(i,arguments)}},{moveTo:function(){var e=t(this),i=e&&e.isEmpty()?e:new L(w.NO_INSERT);i!==e&&this.addChild(i),i.moveTo.apply(i,arguments)},moveBy:function(){var e=t(this,!0),i=e&&e.getLastSegment(),n=c.read(arguments);this.moveTo(i?n.add(i._point):n)},closePath:function(e){t(this,!0).closePath(e)}})},r.each(["reverse","flatten","simplify","smooth"],function(t){this[t]=function(e){for(var i,n=this._children,r=0,s=n.length;r<s;r++)i=n[r][t](e)||i;return i}},{}));A.inject(new function(){function t(t,e){var i=t.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);return e?i.resolveCrossings().reorient("nonzero"===i.getFillRule(),!0):i}function i(t,e,i,n,r,s){var a=new t(w.NO_INSERT);return a.addChildren(e,!0),i&&(a=a.reduce({simplify:!0})),s&&!1===s.insert||a.insertAbove(r&&n.isSibling(r)&&n.getIndex()<r.getIndex()?r:n),a.copyAttributes(n,!0),a}function n(e,n,r,a){function o(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];w.push.apply(w,n._segments),x.push.apply(x,n.getCurves()),n._overlapsOnly=!0}}if(a&&a.stroke&&/^(subtract|intersect)$/.test(r))return s(e,n,"subtract"===r);var u=t(e,!0),c=n&&e!==n&&t(n,!0),_=p[r];_[r]=!0,c&&(_.subtract||_.exclude)^c.isClockwise()^u.isClockwise()&&c.reverse();var g,v=l(O.expand(u.getCrossings(c))),m=u._children||[u],y=c&&(c._children||[c]),w=[],x=[];if(v.length){o(m),y&&o(y);for(var b=0,C=v.length;b<C;b++)f(v[b]._segment,u,c,x,_);for(var b=0,C=w.length;b<C;b++){var S=w[b],P=S._intersection;S._winding||f(S,u,c,x,_),P&&P._overlap||(S._path._overlapsOnly=!1)}g=d(w,_)}else g=h(y?m.concat(y):m.slice(),function(t){return!!_[t]});return i(N,g,!0,e,n,a)}function s(e,n,r){function s(t){if(o.contains(t.getPointAt(t.getLength()/2))^r)return u.unshift(t),!0}for(var a=t(e),o=t(n),h=a.getCrossings(o),u=[],l=h.length-1;l>=0;l--){var c=h[l].split();c&&(s(c)&&c.getFirstSegment().setHandleIn(0,0),a.getLastSegment().setHandleOut(0,0))}return s(a),i(x,u,!1,e,n)}function a(t,e){for(var i=t;i;){if(i===e)return;i=i._previous}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._previous;)e=e._previous;t._next=e,e._previous=t}}function o(t){for(var e=t.length-1;e>=0;e--)t[e].clearHandles()}function h(t,e,i){var n=t&&t.length;if(n){var s=r.each(t,function(t,e){this[t._id]={container:null,winding:t.isClockwise()?1:-1,index:e}},{}),a=t.slice().sort(function(t,e){return v(e.getArea())-v(t.getArea())}),o=a[0];null==i&&(i=o.isClockwise());for(var h=0;h<n;h++){for(var u=a[h],l=s[u._id],c=u.getInteriorPoint(),f=0,d=h-1;d>=0;d--){var _=a[d];if(_.contains(c)){var g=s[_._id];f=g.winding,l.winding+=f,l.container=g.exclude?g.container:_;break}}if(e(l.winding)===e(f))l.exclude=!0,t[l.index]=null;else{var p=l.container;u.setClockwise(p?!p.isClockwise():i)}}}return t}function l(t,e,i){function n(t){return t._path._id+"."+t._segment1._index}for(var r,s,h,u=e&&[],l=1e-8,f=!1,d=i||[],_=i&&{},g=(i&&i.length)-1;g>=0;g--){(v=i[g])._path&&(_[n(v)]=!0)}for(g=t.length-1;g>=0;g--){var p,m=t[g],y=m._time,w=y,x=e&&!e(m),v=m._curve;if(v&&(v!==s?(f=!v.hasHandles()||_&&_[n(v)],r=[],h=null,s=v):h>=l&&(y/=h)),x)r&&r.push(m);else{if(e&&u.unshift(m),h=w,y<l)p=v._segment1;else if(y>.99999999)p=v._segment2;else{var b=v.divideAtTime(y,!0);f&&d.push(v,b),p=b._segment1;for(var C=r.length-1;C>=0;C--){var S=r[C];S._time=(S._time-y)/(1-y)}}m._setSegment(p);var P=p._intersection,I=m._intersection;if(P){a(P,I);for(var M=P;M;)a(M._intersection,P),M=M._next}else p._intersection=I}}return i||o(d),u||t}function c(t,e,i,n,r){function s(s){var a=s[l+0],h=s[l+6];if(!(p<_(a,h)||p>g(a,h))){var f=s[u+0],v=s[u+2],m=s[u+4],M=s[u+6];if(a===h)return void((f<x&&M>w||M<x&&f>w)&&(S=!0));var T=p===a?0:p===h?1:w>g(f,v,m,M)||x<_(f,v,m,M)?1:1===k.solveCubic(s,l,p,I,0,1)?I[0]:.5,z=0===T?f:1===T?M:k.getPoint(s,T)[i?"y":"x"],O=a>h?1:-1,A=o[l]>o[l+6]?1:-1,L=o[u+6];return p!==a?(z<w?b+=O:z>x?C+=O:S=!0,z>d-y&&z<d+y&&(P/=2)):(O!==A?f<w?b+=O:f>x&&(C+=O):f!=L&&(L<x&&z>x?(C+=O,S=!0):L>w&&z<w&&(b+=O,S=!0)),P=0),o=s,!r&&z>w&&z<x&&0===k.getTangent(s,T)[i?"x":"y"]&&c(t,e,i?0:1,n,!0)}}function a(t){var e=t[l+0],n=t[l+2],r=t[l+4],a=t[l+6];if(p<=g(e,n,r,a)&&p>=_(e,n,r,a))for(var o,h=t[u+0],c=t[u+2],f=t[u+4],d=t[u+6],v=w>g(h,c,f,d)||x<_(h,c,f,d)?[t]:k.getMonoCurves(t,i),m=0,y=v.length;m<y;m++)if(o=s(v[m]))return o}for(var o,h,u=i?1:0,l=1^u,f=[t.x,t.y],d=f[u],p=f[l],y=1e-6,w=d-1e-9,x=d+1e-9,b=0,C=0,S=!1,P=1,I=[],M=0,T=e.length;M<T;M++){var z,O=e[M],A=O._path,L=O.getValues();if(!(M&&e[M-1]._path===A||(o=null,A._closed||(h=k.getValues(A.getLastCurve().getSegment2(),O.getSegment1(),null,!n))[l]!==h[l+6]&&(o=h),o))){o=L;for(var N=A.getLastCurve();N&&N!==O;){var B=N.getValues();if(B[l]!==B[l+6]){o=B;break}N=N.getPrevious()}}if(z=a(L))return z;if(M+1===T||e[M+1]._path!==A){if(h&&(z=a(h)))return z;h=null}}return b=v(b),C=v(C),{winding:g(b,C),windingL:b,windingR:C,quality:P,onPath:S}}function f(t,e,i,n,r){var a=[],o=t,h=0;do{f=(l=t.getCurve()).getLength();a.push({segment:t,curve:l,length:f}),h+=f,t=t.getNext()}while(t&&!t._intersection&&t!==o);for(var d=[.5,.25,.75],_={winding:0,quality:0},s=_,m=0;m<d.length&&s.quality<.5;m++)for(var f=h*d[m],y=0,w=a.length;y<w;y++){var x=a[y],b=x.length;if(f<=b){var l=x.curve,C=l._path,S=C._parent,P=u.clamp(l.getTimeAt(f),1e-8,1-1e-8),I=l.getPointAtTime(P),M=v(l.getTangentAtTime(P).normalize().y)<Math.SQRT1_2?1:0;S instanceof N&&(C=S);var T=r.subtract&&i&&(C===e&&i._getWinding(I,M,!0).winding||C===i&&!e._getWinding(I,M,!0).winding)?_:c(I,n,M,!0);T.quality>s.quality&&(s=T);break}f-=b}for(y=a.length-1;y>=0;y--)a[y].segment._winding=s}function d(t,e){function i(t){var i;return!(!t||t._visited||e&&(!e[(i=t._winding||{}).winding]||e.unite&&2===i.winding&&i.windingL&&i.windingR))}function n(t){if(t)for(var e=0,i=a.length;e<i;e++)if(t===a[e])return!0;return!1}function r(t){for(var e=t._segments,i=0,n=e.length;i<n;i++)e[i]._visited=!0}function s(t,e){function r(r,s){for(;r&&r!==s;){var o=r._segment,u=o._path,l=o.getNext()||u&&u.getFirstSegment(),c=l&&l._intersection;o!==t&&(n(o)||n(l)||l&&i(o)&&(i(l)||c&&i(c._segment)))&&h.push(o),e&&a.push(o),r=r._next}}var s=t._intersection,o=s,h=[];if(e&&(a=[t]),s){for(r(s);s&&s._prev;)s=s._prev;r(s,o)}return h}var a,o=[];t.sort(function(t,e){var i=t._intersection,n=e._intersection,r=!(!i||!i._overlap),s=!(!n||!n._overlap),a=t._path,o=e._path;return r^s?r?1:-1:!i^!n?i?1:-1:a!==o?a._id-o._id:t._index-e._index});for(var h=0,u=t.length;h<u;h++){var l,c,f,d=t[h],_=i(d),g=null,v=!1,p=!0,m=[];if(_&&d._path._overlapsOnly){var y=d._path,x=d._intersection._segment._path;y.compare(x)&&(y.getArea()&&o.push(y.clone(!1)),r(y),r(x),_=!1)}for(;_;){var b=!g,C=s(d,b),S=C.shift(),P=!(v=!b&&(n(d)||n(S)))&&S;if(b&&(g=new L(w.NO_INSERT),l=null),v){(d.isFirst()||d.isLast())&&(p=d._path._closed),d._visited=!0;break}if(P&&l&&(m.push(l),l=null),l||(P&&C.push(d),l={start:g._segments.length,crossings:C,visited:c=[],handleIn:f}),P&&(d=S),!i(d)){g.removeSegments(l.start);for(var I=0,M=c.length;I<M;I++)c[I]._visited=!1;c.length=0;do{(d=l&&l.crossings.shift())||(l=m.pop())&&(c=l.visited,f=l.handleIn)}while(l&&!i(d));if(!d)break}var z=d.getNext();g.add(new T(d._point,f,z&&d._handleOut)),d._visited=!0,c.push(d),d=z||d._path.getFirstSegment(),f=z&&z._handleIn}v&&(p&&(g.firstSegment.setHandleIn(f),g.setClosed(p)),0!==g.getArea()&&o.push(g))}return o}var _=Math.min,g=Math.max,v=Math.abs,p={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};return{_getWinding:function(t,e,i){return c(t,this.getCurves(),e,i)},unite:function(t,e){return n(this,t,"unite",e)},intersect:function(t,e){return n(this,t,"intersect",e)},subtract:function(t){return n(this,t,"subtract")},exclude:function(t,e){return n(this,t,"exclude",e)},divide:function(t,e){return i(x,[this.subtract(t,e),this.intersect(t,e)],!0,this,t,e)},resolveCrossings:function(){function t(t){var e=t&&t._intersection;return e&&e._overlap}var e=this._children,i=e||[this],n=!1,s=!1,a=this.getIntersections(null,function(t){return t.hasOverlap()&&(n=!0)||t.isCrossing()&&(s=!0)}),h=n&&s&&[];if(a=O.expand(a),n)for(var u=l(a,function(t){return t.hasOverlap()},h),c=u.length-1;c>=0;c--){var f=u[c]._segment,_=f.getPrevious(),g=f.getNext();t(_)&&t(g)&&(f.remove(),_._handleOut._set(0,0),g._handleIn._set(0,0),_===f||_.getCurve().hasLength()||(g._handleIn.set(_._handleIn),_.remove()))}s&&(l(a,n&&function(t){var e=t.getCurve(),i=t.getSegment(),n=t._intersection,r=n._curve,s=n._segment;return!!(e&&r&&e._path&&r._path)||(i&&(i._intersection=null),void(s&&(s._intersection=null)))},h),h&&o(h),i=d(r.each(i,function(t){this.push.apply(this,t._segments)},[])));var v,p=i.length;return p>1&&e?(i!==e&&this.setChildren(i),v=this):1!==p||e||(i[0]!==this&&this.setSegments(i[0].removeSegments()),v=this),v||((v=new N(w.NO_INSERT)).addChildren(i),(v=v.reduce()).copyAttributes(this),this.replaceWith(v)),v},reorient:function(t,i){var n=this._children;return n&&n.length?this.setChildren(h(this.removeChildren(),function(e){return!!(t?e:1&e)},i)):i!==e&&this.setClockwise(i),this},getInteriorPoint:function(){var e=this.getBounds().getCenter(!0);if(!this.contains(e)){for(var i=this.getCurves(),n=e.y,r=[],s=[],a=0,o=i.length;a<o;a++){var h=i[a].getValues(),u=h[1],l=h[3],c=h[5],f=h[7];if(n>=_(u,l,c,f)&&n<=g(u,l,c,f))for(var d=k.getMonoCurves(h),v=0,p=d.length;v<p;v++){var m=d[v],y=m[1],w=m[7];if(y!==w&&(n>=y&&n<=w||n>=w&&n<=y)){var x=n===y?m[0]:n===w?m[6]:1===k.solveCubic(m,1,n,s,0,1)?k.getPoint(m,s[0]).x:(m[0]+m[6])/2;r.push(x)}}}r.length>1&&(r.sort(function(t,e){return t-e}),e.x=(r[0]+r[1])/2)}return e}}});var B=r.extend({_class:"PathFlattener",initialize:function(t,e,i,n,r){function s(t,e){var i=k.getValues(t,e,r);h.push(i),a(i,t._index,0,1)}function a(t,i,r,s){if(!(s-r>c)||n&&k.isStraight(t)||k.isFlatEnough(t,e||.25)){var o=t[6]-t[0],h=t[7]-t[1],f=Math.sqrt(o*o+h*h);f>0&&(l+=f,u.push({offset:l,curve:t,index:i,time:s}))}else{var d=k.subdivide(t,.5),_=(r+s)/2;a(d[0],i,r,_),a(d[1],i,_,s)}}for(var o,h=[],u=[],l=0,c=1/(i||32),f=t._segments,d=f[0],_=1,g=f.length;_<g;_++)o=f[_],s(d,o),d=o;t._closed&&s(o,f[0]),this.curves=h,this.parts=u,this.length=l,this.index=0},_get:function(t){for(var e,i=this.parts,n=i.length,r=this.index;e=r,r&&!(i[--r].offset<t););for(;e<n;e++){var s=i[e];if(s.offset>=t){this.index=e;var a=i[e-1],o=a&&a.index===s.index?a.time:0,h=a?a.offset:0;return{index:s.index,time:o+(s.time-o)*(t-h)/(s.offset-h)}}}return{index:i[n-1].index,time:1}},drawPart:function(t,e,i){for(var n=this._get(e),r=this._get(i),s=n.index,a=r.index;s<=a;s++){var o=k.getPart(this.curves[s],s===n.index?n.time:0,s===r.index?r.time:1);s===n.index&&t.moveTo(o[0],o[1]),t.bezierCurveTo.apply(t,o.slice(2))}}},r.each(k._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this._get(e);return k[t](this.curves[i.index],i.time)}},{})),j=r.extend({initialize:function(t){for(var e,i=this.points=[],n=t._segments,r=t._closed,s=0,a=n.length;s<a;s++){var o=n[s].point;e&&e.equals(o)||i.push(e=o.clone())}r&&(i.unshift(i[i.length-1]),i.push(i[1])),this.closed=r},fit:function(t){var e=this.points,i=e.length,n=null;return i>0&&(n=[new T(e[0])],i>1&&(this.fitCubic(n,t,0,i-1,e[1].subtract(e[0]),e[i-2].subtract(e[i-1])),this.closed&&(n.shift(),n.pop()))),n},fitCubic:function(t,e,i,n,r,s){var a=this.points;if(n-i!=1){for(var l,c=this.chordLengthParameterize(i,n),f=Math.max(e,e*e),d=!0,_=0;_<=4;_++){var g=this.generateBezier(i,n,c,r,s),v=this.findMaxError(i,n,g,c);if(v.error<e&&d)return void this.addCurve(t,g);if(l=v.index,v.error>=f)break;d=this.reparameterize(i,n,c,g),f=v.error}var p=a[l-1].subtract(a[l+1]);this.fitCubic(t,e,i,l,r,p),this.fitCubic(t,e,l,n,p.negate(),s)}else{var o=a[i],h=a[n],u=o.getDistance(h)/3;this.addCurve(t,[o,o.add(r.normalize(u)),h.add(s.normalize(u)),h])}},addCurve:function(t,e){t[t.length-1].setHandleOut(e[1].subtract(e[0])),t.push(new T(e[3],e[2].subtract(e[3])))},generateBezier:function(t,e,i,n,r){for(var s=1e-12,a=Math.abs,o=this.points,h=o[t],u=o[e],l=[[0,0],[0,0]],c=[0,0],f=0,d=e-t+1;f<d;f++){var _=i[f],g=1-_,v=3*_*g,p=g*g*g,m=v*g,y=v*_,w=_*_*_,x=n.normalize(m),b=r.normalize(y),C=o[t+f].subtract(h.multiply(p+m)).subtract(u.multiply(y+w));l[0][0]+=x.dot(x),l[0][1]+=x.dot(b),l[1][0]=l[0][1],l[1][1]+=b.dot(b),c[0]+=x.dot(C),c[1]+=b.dot(C)}var S,P,I=l[0][0]*l[1][1]-l[1][0]*l[0][1];if(a(I)>s){var M=l[0][0]*c[1]-l[1][0]*c[0];S=(c[0]*l[1][1]-c[1]*l[0][1])/I,P=M/I}else{var z=l[0][0]+l[0][1],k=l[1][0]+l[1][1];S=P=a(z)>s?c[0]/z:a(k)>s?c[1]/k:0}var O,A,L=u.getDistance(h),N=s*L;if(S<N||P<N)S=P=L/3;else{var B=u.subtract(h);O=n.normalize(S),A=r.normalize(P),O.dot(B)-A.dot(B)>L*L&&(S=P=L/3,O=A=null)}return[h,h.add(O||n.normalize(S)),u.add(A||r.normalize(P)),u]},reparameterize:function(t,e,i,n){for(r=t;r<=e;r++)i[r-t]=this.findRoot(n,this.points[r],i[r-t]);for(var r=1,s=i.length;r<s;r++)if(i[r]<=i[r-1])return!1;return!0},findRoot:function(t,e,i){for(var n=[],r=[],s=0;s<=2;s++)n[s]=t[s+1].subtract(t[s]).multiply(3);for(s=0;s<=1;s++)r[s]=n[s+1].subtract(n[s]).multiply(2);var a=this.evaluate(3,t,i),o=this.evaluate(2,n,i),h=this.evaluate(1,r,i),l=a.subtract(e),c=o.dot(o)+l.dot(h);return u.isZero(c)?i:i-l.dot(o)/c},evaluate:function(t,e,i){for(var n=e.slice(),r=1;r<=t;r++)for(var s=0;s<=t-r;s++)n[s]=n[s].multiply(1-i).add(n[s+1].multiply(i));return n[0]},chordLengthParameterize:function(t,e){for(var i=[0],n=t+1;n<=e;n++)i[n-t]=i[n-t-1]+this.points[n].getDistance(this.points[n-1]);for(var n=1,r=e-t;n<=r;n++)i[n]/=i[r];return i},findMaxError:function(t,e,i,n){for(var r=Math.floor((e-t+1)/2),s=0,a=t+1;a<e;a++){var h=this.evaluate(3,i,n[a-t]).subtract(this.points[a]),u=h.x*h.x+h.y*h.y;u>=s&&(s=u,r=a)}return{error:s,index:r}}}),E=w.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(t){this._content="",this._lines=[];var i=t&&r.isPlainObject(t)&&t.x===e&&t.y===e;this._initialize(i&&t,!i&&c.read(arguments))},_equals:function(t){return this._content===t._content},copyContent:function(t){this.setContent(t._content)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),D=E.extend({_class:"PointText",initialize:function(){E.apply(this,arguments)},getPoint:function(){var t=this._matrix.getTranslation();return new f(t.x,t.y,this,"setPoint")},setPoint:function(){var t=c.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t,e,i){if(this._content){this._setStyles(t,e,i);var n=this._lines,r=this._style,s=r.hasFill(),a=r.hasStroke(),o=r.getLeading(),h=t.shadowColor;t.font=r.getFontStyle(),t.textAlign=r.getJustification();for(var u=0,l=n.length;u<l;u++){t.shadowColor=h;var c=n[u];s&&(t.fillText(c,0,0),t.shadowColor="rgba(0,0,0,0)"),a&&t.strokeText(c,0,0),t.translate(0,o)}}},_getBounds:function(t,e){var i=this._style,n=this._lines,r=n.length,s=i.getJustification(),a=i.getLeading(),o=this.getView().getTextWidth(i.getFontStyle(),n),h=0;"left"!==s&&(h-=o/("center"===s?2:1));var u=new g(h,r?-.75*a:0,o,r*a);return t?t._transformBounds(u,u):u}}),F=r.extend(new function(){function t(t){var n,r=t.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/);if(r){n=[0,0,0];for(s=0;s<3;s++){o=r[s+1];n[s]=parseInt(1==o.length?o+o:o,16)/255}}else if(r=t.match(/^rgba?\((.*)\)$/))for(var s=0,h=(n=r[1].split(",")).length;s<h;s++){var o=+n[s];n[s]=s<3?o/255:o}else if(i){var u=a[t];if(!u){e||(e=Q.getContext(1,1),e.globalCompositeOperation="copy"),e.fillStyle="rgba(0,0,0,0)",e.fillStyle=t,e.fillRect(0,0,1,1);var l=e.getImageData(0,0,1,1).data;u=a[t]=[l[0]/255,l[1]/255,l[2]/255]}n=u.slice()}else n=[0,0,0];return n}var e,n={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},s={},a={},o=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],u={"rgb-hsb":function(t,e,i){var n=Math.max(t,e,i),s=n-Math.min(t,e,i);return[0===s?0:60*(n==t?(e-i)/s+(e<i?6:0):n==e?(i-t)/s+2:(t-e)/s+4),0===n?0:s/n,n]},"hsb-rgb":function(t,e,i){t=(t/60%6+6)%6;var n=Math.floor(t),r=t-n,s=[i,i*(1-e),i*(1-e*r),i*(1-e*(1-r))];return[s[(n=o[n])[0]],s[n[1]],s[n[2]]]},"rgb-hsl":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),s=n-r,a=0===s,h=(n+r)/2;return[a?0:60*(n==t?(e-i)/s+(e<i?6:0):n==e?(i-t)/s+2:(t-e)/s+4),a?0:h<.5?s/(n+r):s/(2-n-r),h]},"hsl-rgb":function(t,e,i){if(t=(t/360%1+1)%1,0===e)return[i,i,i];for(var n=[t+1/3,t,t-1/3],r=i<.5?i*(1+e):i+e-i*e,s=2*i-r,a=[],o=0;o<3;o++){var h=n[o];h<0&&(h+=1),h>1&&(h-=1),a[o]=6*h<1?s+6*(r-s)*h:2*h<1?r:3*h<2?s+(r-s)*(2/3-h)*6:s}return a},"rgb-gray":function(t,e,i){return[.2989*t+.587*e+.114*i]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return r.each(n,function(t,e){s[e]=[],r.each(t,function(t,i){var a=r.capitalize(t),o=/^(hue|saturation)$/.test(t),h=s[e][i]="gradient"===t?function(t){var e=this._components[0];return t=R.read(Array.isArray(t)?t:arguments,0,{readNull:!0}),e!==t&&(e&&e._removeOwner(this),t&&t._addOwner(this)),t}:"gradient"===e?function(){return c.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:t};this["get"+a]=function(){return this._type===e||o&&/^hs[bl]$/.test(this._type)?this._components[i]:this._convert(e)[i]},this["set"+a]=function(t){this._type===e||o&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(e),this._properties=n[e],this._type=e),this._components[i]=h.call(this,t),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function l(e){var i,a,o,h,u=arguments,c=this.__read,f=0;Array.isArray(e)&&(u=e,e=u[0]);var d=null!=e&&typeof e;if("string"===d&&e in n&&(i=e,e=u[1],Array.isArray(e)?(a=e,o=u[2]):(c&&(f=1),u=r.slice(u,1),d=typeof e)),!a){if(h="number"===d?u:"object"===d&&null!=e.length?e:null){i||(i=h.length>=3?"rgb":"gray");var _=n[i].length;o=h[_],c&&(f+=h===arguments?_+(null!=o?1:0):1),h.length>_&&(h=r.slice(h,0,_))}else if("string"===d)i="rgb",4===(a=t(e)).length&&(o=a[3],a.length--);else if("object"===d)if(e.constructor===l){if(i=e._type,a=e._components.slice(),o=e._alpha,"gradient"===i)for(var g=1,v=a.length;g<v;g++){var p=a[g];p&&(a[g]=p.clone())}}else if(e.constructor===R)i="gradient",h=u;else{var m=n[i="hue"in e?"lightness"in e?"hsl":"hsb":"gradient"in e||"stops"in e||"radial"in e?"gradient":"gray"in e?"gray":"rgb"],y=s[i];this._components=a=[];for(var g=0,v=m.length;g<v;g++){null==(w=e[m[g]])&&!g&&"gradient"===i&&"stops"in e&&(w={stops:e.stops,radial:e.radial}),null!=(w=y[g].call(this,w))&&(a[g]=w)}o=e.alpha}c&&i&&(f=1)}if(this._type=i||"rgb",!a){this._components=a=[];for(var g=0,v=(y=s[this._type]).length;g<v;g++){var w=y[g].call(this,h&&h[g]);null!=w&&(a[g]=w)}}return this._components=a,this._properties=n[this._type],this._alpha=o,c&&(this.__read=f),this},set:"#initialize",_serialize:function(t,e){var i=this.getComponents();return r.serialize(/^(gray|rgb)$/.test(this._type)?i:[this._type].concat(i),t,!0,e)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(65)},_convert:function(t){var e;return this._type===t?this._components.slice():(e=u[this._type+"-"+t])?e.apply(this,this._components):u["rgb-"+t].apply(this,u[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new F(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=n[t],this._type=t},getComponents:function(){var t=this._components.slice();return null!=this._alpha&&t.push(this._alpha),t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var e=r.isPlainValue(t,!0)?F.read(arguments):t;return e===this||e&&this._class===e._class&&this._type===e._type&&this.getAlpha()===e.getAlpha()&&r.equals(this._components,e._components)||!1},toString:function(){for(var t=this._properties,e=[],i="gradient"===this._type,n=h.instance,r=0,s=t.length;r<s;r++){var a=this._components[r];null!=a&&e.push(t[r]+": "+(i?a:n.number(a)))}return null!=this._alpha&&e.push("alpha: "+n.number(this._alpha)),"{ "+e.join(", ")+" }"},toCSS:function(t){function e(t){return Math.round(255*(t<0?0:t>1?1:t))}var i=this._convert("rgb"),n=t||null==this._alpha?1:this._alpha;return i=[e(i[0]),e(i[1]),e(i[2])],n<1&&i.push(n<0?0:n),t?"#"+((1<<24)+(i[0]<<16)+(i[1]<<8)+i[2]).toString(16).slice(1):(4==i.length?"rgba(":"rgb(")+i.join(",")+")"},toCanvasStyle:function(t){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var e,i=this._components,n=i[0],r=n._stops,s=i[1],a=i[2];if(n._radial){var o=a.getDistance(s),h=i[3];if(h){var u=h.subtract(s);u.getLength()>o&&(h=s.add(u.normalize(o-.1)))}var l=h||s;e=t.createRadialGradient(l.x,l.y,0,s.x,s.y,o)}else e=t.createLinearGradient(s.x,s.y,a.x,a.y);for(var c=0,f=r.length;c<f;c++){var d=r[c],_=d._offset;e.addColorStop(null==_?c/(f-1):_,d._color.toCanvasStyle())}return this._canvasStyle=e},transform:function(t){if("gradient"===this._type){for(var e=this._components,i=1,n=e.length;i<n;i++){var r=e[i];t._transformPoint(r,r,!0)}this._changed()}},statics:{_types:n,random:function(){var t=Math.random;return new F(t(),t(),t())}}})},new function(){return r.each({add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e}},function(t,e){this[e]=function(e){e=F.read(arguments);for(var i=this._type,n=this._components,r=e._convert(i),s=0,a=n.length;s<a;s++)r[s]=t(n[s],r[s]);return new F(i,r,null!=this._alpha?t(this._alpha,e.getAlpha()):null)}},{})}),R=r.extend({_class:"Gradient",initialize:function(t,e){this._id=l.get(),t&&r.isPlainObject(t)&&(this.set(t),t=e=null),null==this._stops&&this.setStops(t||["white","black"]),null==this._radial&&this.setRadial("string"==typeof e&&"radial"===e||e||!1)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._stops,this._radial],t,!0,e)})},_changed:function(){for(var t=0,e=this._owners&&this._owners.length;t<e;t++)this._owners[t]._changed()},_addOwner:function(t){this._owners||(this._owners=[]),this._owners.push(t)},_removeOwner:function(t){var i=this._owners?this._owners.indexOf(t):-1;-1!=i&&(this._owners.splice(i,1),this._owners.length||(this._owners=e))},clone:function(){for(var t=[],e=0,i=this._stops.length;e<i;e++)t[e]=this._stops[e].clone();return new R(t,this._radial)},getStops:function(){return this._stops},setStops:function(t){if(t.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var i=this._stops;if(i)for(var n=0,r=i.length;n<r;n++)i[n]._owner=e;for(var n=0,r=(i=this._stops=q.readList(t,0,{clone:!0})).length;n<r;n++)i[n]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class){var e=this._stops,i=t._stops,n=e.length;if(n===i.length){for(var r=0;r<n;r++)if(!e[r].equals(i[r]))return!1;return!0}}return!1}}),q=r.extend({_class:"GradientStop",initialize:function(t,i){var n=t,r=i;"object"==typeof t&&i===e&&(Array.isArray(t)&&"number"!=typeof t[0]?(n=t[0],r=t[1]):("color"in t||"offset"in t||"rampPoint"in t)&&(n=t.color,r=t.offset||t.rampPoint||0)),this.setColor(n),this.setOffset(r)},clone:function(){return new q(this._color.clone(),this._offset)},_serialize:function(t,e){var i=this._color,n=this._offset;return r.serialize(null==n?[i]:[i,n],t,!0,e)},_changed:function(){this._owner&&this._owner._changed(65)},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){var t=F.read(arguments,0,{clone:!0});t&&(t._owner=this),this._color=t,this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._offset==t._offset||!1}}),V=r.extend(new function(){var t={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new c,selectedColor:null},i=r.set({},t,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),n=r.set({},i,{fillColor:new F}),s={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},a={beans:!0},o={_class:"Style",beans:!0,initialize:function(e,r,s){this._values={},this._owner=r,this._project=r&&r._project||s||paper.project,this._defaults=!r||r instanceof x?i:r instanceof E?n:t,e&&this.set(e)}};return r.each(i,function(t,i){var n=/Color$/.test(i),h="shadowOffset"===i,u=r.capitalize(i),l=s[i],f="set"+u,d="get"+u;o[f]=function(t){var r=this._owner,s=r&&r._children;if(s&&s.length>0&&!(r instanceof N))for(var a=0,o=s.length;a<o;a++)s[a]._style[f](t);else if(i in this._defaults){var h=this._values[i];h!==t&&(n&&(h&&h._owner!==e&&(h._owner=e),t&&t.constructor===F&&(t._owner&&(t=t.clone()),t._owner=r)),this._values[i]=t,r&&r._changed(l||65))}},o[d]=function(t){var a=this._owner,o=a&&a._children;if(i in this._defaults&&(!o||!o.length||t||a instanceof N)){var s;if((s=this._values[i])===e)(s=this._defaults[i])&&s.clone&&(s=s.clone());else{var u=n?F:h?c:null;!u||s&&s.constructor===u||(this._values[i]=s=u.read([s],0,{readNull:!0,clone:!0}),s&&n&&(s._owner=a))}}else if(o)for(var l=0,f=o.length;l<f;l++){var _=o[l]._style[d]();if(l){if(!r.equals(s,_))return e}else s=_}return s},a[d]=function(t){return this._style[d](t)},a[f]=function(t){this._style[f](t)}}),r.each({Font:"FontFamily",WindingRule:"FillRule"},function(t,e){var i="get"+e,n="set"+e;o[i]=a[i]="#get"+t,o[n]=a[n]="#set"+t}),w.inject(a),o},{set:function(t){this._values={};var e=t instanceof V,i=e?t._values:t;if(i)for(var n in i)if(n in this._defaults){var r=i[n];this[n]=r&&e&&r.clone?r.clone():r}},equals:function(t){function i(t,i,n){var s=t._values,a=i._values,o=i._defaults;for(var h in s){var u=s[h],l=a[h];if(!(n&&h in a||r.equals(u,l===e?o[h]:l)))return!1}return!0}return t===this||t&&this._class===t._class&&i(this,t)&&i(t,this,!0)||!1},hasFill:function(){var t=this.getFillColor();return!!t&&t.alpha>0},hasStroke:function(){var t=this.getStrokeColor();return!!t&&t.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var t=this.getShadowColor();return!!t&&t.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var t=this.getFontSize();return this.getFontWeight()+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function xt(){var t=xt.base.call(this),e=this.getFontSize();return/pt|em|%|px/.test(e)&&(e=this.getView().getPixelSize(e)),null!=t?t:1.2*e}}),H=new function(){function t(t,e,i,n){for(var r=["","webkit","moz","Moz","ms","o"],s=e[0].toUpperCase()+e.substring(1),a=0;a<6;a++){var o=r[a],h=o?o+s:e;if(h in t){if(!i)return t[h];t[h]=n;break}}}return{getStyles:function(t){var e=t&&9!==t.nodeType?t.ownerDocument:t,i=e&&e.defaultView;return i&&i.getComputedStyle(t,"")},getBounds:function(t,e){var i,n=t.ownerDocument,r=n.body,s=n.documentElement;try{i=t.getBoundingClientRect()}catch(a){i={left:0,top:0,width:0,height:0}}var o=i.left-(s.clientLeft||r.clientLeft||0),h=i.top-(s.clientTop||r.clientTop||0);if(!e){var u=n.defaultView;o+=u.pageXOffset||s.scrollLeft||r.scrollLeft,h+=u.pageYOffset||s.scrollTop||r.scrollTop}return new g(o,h,i.width,i.height)},getViewportBounds:function(t){var e=t.ownerDocument,i=e.defaultView,n=e.documentElement;return new g(0,0,i.innerWidth||n.clientWidth,i.innerHeight||n.clientHeight)},getOffset:function(t,e){return H.getBounds(t,e).getPoint()},getSize:function(t){return H.getBounds(t,!0).getSize()},isInvisible:function(t){return H.getSize(t).equals(new d(0,0))},isInView:function(t){return!H.isInvisible(t)&&H.getViewportBounds(t).intersects(H.getBounds(t,!0))},isInserted:function(t){return n.body.contains(t)},getPrefixed:function(e,i){return e&&t(e,i)},setPrefixed:function(e,i,n){if("object"==typeof i)for(var r in i)t(e,r,!0,i[r]);else t(e,i,!0,n)}}},Z={add:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,a=r.length;s<a;s++)t.addEventListener(r[s],n,!1)},remove:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,a=r.length;s<a;s++)t.removeEventListener(r[s],n,!1)},getPoint:function(t){var e=t.targetTouches?t.targetTouches.length?t.targetTouches[0]:t.changedTouches[0]:t;return new c(e.pageX||e.clientX+n.documentElement.scrollLeft,e.pageY||e.clientY+n.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,e){return Z.getPoint(t).subtract(H.getOffset(e||Z.getTarget(t)))}};Z.requestAnimationFrame=new function(){function t(){var e=s;s=[];for(var i=0,a=e.length;i<a;i++)e[i]();(r=n&&s.length)&&n(t)}var e,n=H.getPrefixed(i,"requestAnimationFrame"),r=!1,s=[];return function(i){s.push(i),n?r||(n(t),r=!0):e||(e=setInterval(t,1e3/60))}};var U=r.extend(s,{_class:"View",initialize:function bt(t,e){function r(t){return e[t]||parseInt(e.getAttribute(t),10)}function s(){var t=H.getSize(e);return t.isNaN()||t.isZero()?new d(r("width"),r("height")):t}var o;if(i&&e){this._id=e.getAttribute("id"),null==this._id&&e.setAttribute("id",this._id="view-"+bt._id++),Z.add(e,this._viewEvents);var h="none";if(H.setPrefixed(e.style,{userDrag:h,userSelect:h,touchCallout:h,contentZooming:h,tapHighlightColor:"rgba(0,0,0,0)"}),a.hasAttribute(e,"resize")){var u=this;Z.add(i,this._windowEvents={resize:function(){u.setViewSize(s())}})}if(o=s(),a.hasAttribute(e,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var l=this._stats.domElement,c=l.style,f=H.getOffset(e);c.position="absolute",c.left=f.x+"px",c.top=f.y+"px",n.body.appendChild(l)}}else o=new d(e),e=null;this._project=t,this._scope=t._scope,this._element=e,this._pixelRatio||(this._pixelRatio=i&&i.devicePixelRatio||1),this._setElementSize(o.width,o.height),this._viewSize=o,bt._views.push(this),bt._viewsById[this._id]=this,(this._matrix=new p)._owner=this,bt._focused||(bt._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!paper.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;U._focused===this&&(U._focused=null),U._views.splice(U._views.indexOf(this),1),delete U._viewsById[this._id];var t=this._project;return t._view===this&&(t._view=null),Z.remove(this._element,this._viewEvents),Z.remove(i,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:r.each(w._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(t){this[t]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(t){this._autoUpdate=t,t&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var t=this;Z.requestAnimationFrame(function(){if(t._requested=!1,t._animate){t.requestUpdate();var e=t._element;H.getPrefixed(n,"hidden")&&"true"!==a.getAttribute(e,"keepalive")||!H.isInView(e)||t._handleFrame()}t._autoUpdate&&t.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){paper=this._scope;var t=Date.now()/1e3,e=this._last?t-this._last:0;this._last=t,this.emit("frame",new r({delta:e,time:this._time+=e,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(t,e){var i=this._frameItems;e?(i[t._id]={item:t,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete i[t._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(t){for(var e in this._frameItems){var i=this._frameItems[e];i.item.emit("frame",new r(t,{time:i.time+=t.delta,count:i.count++}))}},_changed:function(){this._project._changed(2049),this._bounds=this._decomposed=e},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new _(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=d.read(arguments),e=t.subtract(this._viewSize);e.isZero()||(this._setElementSize(t.width,t.height),this._viewSize.set(t),this._changed(),this.emit("resize",{size:t,delta:e}),this._autoUpdate&&this.update())},_setElementSize:function(t,e){var i=this._element;i&&(i.width!==t&&(i.width=t),i.height!==e&&(i.height=e))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new g(new c,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return H.isInView(this._element)},isInserted:function(){return H.isInserted(this._element)},getPixelSize:function(t){var e,i=this._element;if(i){var r=i.parentNode,s=n.createElement("div");s.style.fontSize=t,r.appendChild(s),e=parseFloat(H.getStyles(s).fontSize),r.removeChild(s)}else e=parseFloat(e);return e},getTextWidth:function(t,e){return 0}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?r:c).read(arguments),n=c.read(arguments,0,{readNull:!0});return this.transform((new p)[t](i,n||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var t=new p;return this.transform(t.translate.apply(t,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=c.read(arguments);this.translate(this.getCenter().subtract(t))},getZoom:function(){var t=this._decompose(),e=t&&t.scaling;return e?(e.x+e.y)/2:0},setZoom:function(t){this.transform((new p).scale(t/this.getZoom(),this.getCenter()))},getRotation:function(){var t=this._decompose();return t&&t.rotation},setRotation:function(t){var e=this.getRotation();null!=e&&null!=t&&this.rotate(t-e)},getScaling:function(){var t=this._decompose(),i=t&&t.scaling;return i?new f(i.x,i.y,this,"setScaling"):e},setScaling:function(){var t=this.getScaling(),e=c.read(arguments,0,{clone:!0,readNull:!0});t&&e&&this.scale(e.x/t.x,e.y/t.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},transform:function(t){this._matrix.append(t)},scrollBy:function(){this.translate(c.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(c.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(c.read(arguments))},getEventPoint:function(t){return this.viewToProject(Z.getOffset(t,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,e){n&&"string"==typeof e&&(e=n.getElementById(e));return new(i?W:U)(t,e)}}},new function(){function t(t){var e=Z.getTarget(t);return e.getAttribute&&U._viewsById[e.getAttribute("id")]}function e(){var t=U._focused;if(!t||!t.isVisible())for(var e=0,i=U._views.length;e<i;e++)if((t=U._views[e]).isVisible()){U._focused=h=t;break}}function r(t,e,i){t._handleMouseEvent("mousemove",e,i)}function s(t,e,i,n,r,s,a){function o(t,i){if(t.responds(i)){if(h||(h=new $(i,n,r,e||t,s?r.subtract(s):null)),t.emit(i,h)&&(I=!0,h.prevented&&(M=!0),h.stopped))return u=!0}else{var a=T[i];if(a)return o(t,a)}}for(var h,u=!1;t&&t!==a&&!o(t,i);)t=t._parent;return u}function a(t,e,i,n,r,a){return t._project.removeOn(i),M=I=!1,b&&s(b,null,i,n,r,a)||e&&e!==b&&!e.isDescendant(b)&&s(e,null,T[i]||i,n,r,a,b)||s(t,b||e||t,i,n,r,a)}if(i){var o,h,u,l,c,f=!1,d=!1,_=i.navigator;_.pointerEnabled||_.msPointerEnabled?(u="pointerdown MSPointerDown",l="pointermove MSPointerMove",c="pointerup pointercancel MSPointerUp MSPointerCancel"):(u="touchstart",l="touchmove",c="touchend touchcancel","ontouchstart"in i&&_.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(u+=" mousedown",l+=" mousemove",c+=" mouseup"));var g={},v={mouseout:function(t){var e=U._focused,i=Z.getRelatedTarget(t);if(e&&(!i||"HTML"===i.nodeName)){var n=Z.getOffset(t,e._element),s=n.x,a=Math.abs,o=a(s),u=o-(1<<25);n.x=a(u)<o?u*(s<0?-1:1):s,r(e,t,e.viewToProject(n))}},scroll:e};g[u]=function(e){var i=U._focused=t(e);f||(f=!0,i._handleMouseEvent("mousedown",e))},v[l]=function(i){var n=U._focused;if(!d){var s=t(i);s?n!==s&&(n&&r(n,i),o||(o=n),n=U._focused=h=s):h&&h===n&&(o&&!o.isInserted()&&(o=null),n=U._focused=o,o=null,e())}n&&r(n,i)},v[u]=function(){d=!0},v[c]=function(t){var e=U._focused;e&&f&&e._handleMouseEvent("mouseup",t),d=f=!1},Z.add(n,v),Z.add(i,{load:e});var p,m,y,w,x,b,C,S,P,I=!1,M=!1,T={doubleclick:"click",mousedrag:"mousemove"},z=!1,k={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:g,_handleMouseEvent:function(t,e,i){function n(t){return r.virtual[t]||l.responds(t)||u&&u.responds(t)}var r=this._itemEvents,o=r.native[t],h="mousemove"===t,u=this._scope.tool,l=this;h&&f&&n("mousedrag")&&(t="mousedrag"),i||(i=this.getEventPoint(e));var c=this.getBounds().contains(i),d=o&&c&&l._project.hitTest(i,{tolerance:0,fill:!0,stroke:!0}),_=d&&d.item||null,g=!1,v={};v[t.substr(5)]=!0,o&&_!==x&&(x&&s(x,null,"mouseleave",e,i),_&&s(_,null,"mouseenter",e,i),x=_),z^c&&(s(this,null,c?"mouseenter":"mouseleave",e,i),p=c?this:null,g=!0),!c&&!v.drag||i.equals(y)||(a(this,_,h?t:"mousemove",e,i,y),g=!0),z=c,(v.down&&c||v.up&&m)&&(a(this,_,t,e,i,m),v.down?(P=_===C&&Date.now()-S<300,w=C=_,b=!M&&_,m=i):v.up&&(M||_!==w||(S=Date.now(),a(this,_,P?"doubleclick":"click",e,i,m),P=!1),w=b=null),z=!1,g=!0),y=i,g&&u&&(I=u._handleMouseEvent(t,e,i,v)||I),(I&&!v.move||v.down&&n("mouseup"))&&e.preventDefault()},_handleKeyEvent:function(t,e,i,n){function r(r){r.responds(t)&&(paper=a,r.emit(t,s=s||new J(t,e,i,n)))}var s,a=this._scope,o=a.tool;this.isVisible()&&(r(this),o&&o.responds(t)&&r(o))},_countItemEvent:function(t,e){var i=this._itemEvents,n=i.native,r=i.virtual;for(var s in k)n[s]=(n[s]||0)+(k[s][t]||0)*e;r[t]=(r[t]||0)+e},statics:{updateFocus:e}}}}),W=U.extend({_class:"CanvasView",initialize:function(t,e){if(!(e instanceof i.HTMLCanvasElement)){var n=d.read(arguments,1);if(n.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+r.slice(arguments,1));e=Q.getCanvas(n)}var s=this._context=e.getContext("2d");if(s.save(),this._pixelRatio=1,!/^off|false$/.test(a.getAttribute(e,"hidpi"))){var o=i.devicePixelRatio||1,h=H.getPrefixed(s,"backingStorePixelRatio")||1;this._pixelRatio=o/h}U.call(this,t,e),this._needsUpdate=!0},remove:function Ct(){return this._context.restore(),Ct.base.call(this)},_setElementSize:function St(t,e){var i=this._pixelRatio;if(St.base.call(this,t*i,e*i),1!==i){var n=this._element,r=this._context;if(!a.hasAttribute(n,"resize")){var s=n.style;s.width=t+"px",s.height=e+"px"}r.restore(),r.save(),r.scale(i,i)}},getPixelSize:function Pt(t){var e,i=paper.agent;if(i&&i.firefox)e=Pt.base.call(this,t);else{var n=this._context,r=n.font;n.font=t+" serif",e=parseFloat(n.font),n.font=r}return e},getTextWidth:function(t,e){var i=this._context,n=i.font,r=0;i.font=t;for(var s=0,a=e.length;s<a;s++)r=Math.max(r,i.measureText(e[s]).width);return i.font=n,r},update:function(){if(!this._needsUpdate)return!1;var t=this._project,e=this._context,i=this._viewSize;return e.clearRect(0,0,i.width+1,i.height+1),t&&t.draw(e,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),G=r.extend({_class:"Event",initialize:function(t){this.event=t,this.type=t&&t.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return X.modifiers}}),J=G.extend({_class:"KeyEvent",initialize:function(t,e,i,n){this.type=t,this.event=e,this.key=i,this.character=n},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),X=new function(){function t(t){var e=t.key||t.keyIdentifier;return e=/^U\+/.test(e)?String.fromCharCode(parseInt(e.substr(2),16)):/^Arrow[A-Z]/.test(e)?e.substr(5):"Unidentified"===e?String.fromCharCode(t.keyCode):e,o[e]||(e.length>1?r.hyphenate(e):e.toLowerCase())}function e(t,i,n,a){var o,h=U._focused;if(u[i]=t,t?l[i]=n:delete l[i],i.length>1&&(o=r.camelize(i))in c){c[o]=t;var f=paper&&paper.agent;if("meta"===o&&f&&f.mac)if(t)s={};else{for(var d in s)d in l&&e(!1,d,s[d],a);s=null}}else t&&s&&(s[i]=n);h&&h._handleKeyEvent(t?"keydown":"keyup",a,i,n)}var s,a,o={"\t":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},h={tab:"\t",space:" ",enter:"\r"},u={},l={},c=new r({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var t=paper&&paper.agent;return t&&t.mac?this.meta:this.control}}});return Z.add(n,{keydown:function(i){var n=t(i),r=paper&&paper.agent;n.length>1||r&&r.chrome&&(i.altKey||r.mac&&i.metaKey||!r.mac&&i.ctrlKey)?e(!0,n,h[n]||(n.length>1?"":n),i):a=n},keypress:function(i){if(a){var n=t(i),r=i.charCode,s=r>=32?String.fromCharCode(r):n.length>1?"":n;n!==a&&(n=s.toLowerCase()),e(!0,n,s,i),a=null}},keyup:function(i){var n=t(i);n in l&&e(!1,n,l[n],i)}}),Z.add(i,{blur:function(t){for(var i in l)e(!1,i,l[i],t)}}),{modifiers:c,isDown:function(t){return!!u[t]}}},$=G.extend({_class:"MouseEvent",initialize:function(t,e,i,n,r){this.type=t,this.event=e,this.point=i,this.target=n,this.delta=r},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Y=G.extend({_class:"ToolEvent",_item:null,initialize:function(t,e,i){this.tool=t,this.type=e,this.event=i},_choosePoint:function(t,e){return t||(e?e.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var e=t.item,i=e._parent;/^(Group|CompoundPath)$/.test(i._class);)e=i,i=i._parent;this._item=e}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),K=(o.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(t){o.call(this),this._moveCount=-1,this._downCount=-1,this.set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){this._minDistance=t,null!=t&&null!=this._maxDistance&&t>this._maxDistance&&(this._maxDistance=t)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance&&(this._minDistance=t)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_handleMouseEvent:function(t,e,i,n){function r(t,e){var r=i,s=a?c._point:c._downPoint||r;if(a){if(c._moveCount&&r.equals(s))return!1;if(s&&(null!=t||null!=e)){var o=r.subtract(s),h=o.getLength();if(h<(t||0))return!1;e&&(r=s.add(o.normalize(Math.min(h,e))))}c._moveCount++}return c._point=r,c._lastPoint=s||r,n.down&&(c._moveCount=-1,c._downPoint=r,c._downCount++),!0}function s(){o&&(l=c.emit(t,new Y(c,t,e))||l)}paper=this._scope,n.drag&&!this.responds(t)&&(t="mousemove");var a=n.move||n.drag,o=this.responds(t),h=this.minDistance,u=this.maxDistance,l=!1,c=this;if(n.down)r(),s();else if(n.up)r(null,u),s();else if(o)for(;r(h,u);)s();return l}}),{request:function(e){var i=new t.XMLHttpRequest;return i.open((e.method||"get").toUpperCase(),e.url,r.pick(e.async,!0)),e.mimeType&&i.overrideMimeType(e.mimeType),i.onload=function(){var t=i.status;0===t||200===t?e.onLoad&&e.onLoad.call(i,i.responseText):i.onerror()},i.onerror=function(){var t=i.status,n='Could not load "'+e.url+'" (Status: '+t+")";if(!e.onError)throw new Error(n);e.onError(n,t)},i.send(null)}}),Q={canvases:[],getCanvas:function(t,e){if(!i)return null;var r,s=!0;"object"==typeof t&&(e=t.height,t=t.width),this.canvases.length?r=this.canvases.pop():(r=n.createElement("canvas"),s=!1);var a=r.getContext("2d");if(!a)throw new Error("Canvas "+r+" is unable to provide a 2D context.");return r.width===t&&r.height===e?s&&a.clearRect(0,0,t+1,e+1):(r.width=t,r.height=e),a.save(),r},getContext:function(t,e){var i=this.getCanvas(t,e);return i?i.getContext("2d"):null},release:function(t){var e=t&&t.canvas?t.canvas:t;e&&e.getContext&&(e.getContext("2d").restore(),this.canvases.push(e))}},tt=new function(){function t(t,e,i){return.2989*t+.587*e+.114*i}function e(e,i,n,r){var s=r-t(e,i,n),r=t(d=e+s,_=i+s,g=n+s),a=v(d,_,g),o=p(d,_,g);if(a<0){var h=r-a;d=r+(d-r)*r/h,_=r+(_-r)*r/h,g=r+(g-r)*r/h}if(o>255){var u=255-r,l=o-r;d=r+(d-r)*u/l,_=r+(_-r)*u/l,g=r+(g-r)*u/l}}function i(t,e,i){return p(t,e,i)-v(t,e,i)}function n(t,e,i,n){var r,s=[t,e,i],a=p(t,e,i),o=v(t,e,i);r=0===v(o=o===t?0:o===e?1:2,a=a===t?0:a===e?1:2)?1===p(o,a)?2:1:0,s[a]>s[o]?(s[r]=(s[r]-s[o])*n/(s[a]-s[o]),s[a]=n):s[r]=s[a]=0,s[o]=0,d=s[0],_=s[1],g=s[2]}var s,a,o,h,u,l,c,f,d,_,g,v=Math.min,p=Math.max,m=Math.abs,y={multiply:function(){d=u*s/255,_=l*a/255,g=c*o/255},screen:function(){d=u+s-u*s/255,_=l+a-l*a/255,g=c+o-c*o/255},overlay:function(){d=u<128?2*u*s/255:255-2*(255-u)*(255-s)/255,_=l<128?2*l*a/255:255-2*(255-l)*(255-a)/255,g=c<128?2*c*o/255:255-2*(255-c)*(255-o)/255},"soft-light":function(){var t=s*u/255;d=t+u*(255-(255-u)*(255-s)/255-t)/255,_=(t=a*l/255)+l*(255-(255-l)*(255-a)/255-t)/255,g=(t=o*c/255)+c*(255-(255-c)*(255-o)/255-t)/255},"hard-light":function(){d=s<128?2*s*u/255:255-2*(255-s)*(255-u)/255,_=a<128?2*a*l/255:255-2*(255-a)*(255-l)/255,g=o<128?2*o*c/255:255-2*(255-o)*(255-c)/255},"color-dodge":function(){d=0===u?0:255===s?255:v(255,255*u/(255-s)),_=0===l?0:255===a?255:v(255,255*l/(255-a)),g=0===c?0:255===o?255:v(255,255*c/(255-o))},"color-burn":function(){d=255===u?255:0===s?0:p(0,255-255*(255-u)/s),_=255===l?255:0===a?0:p(0,255-255*(255-l)/a),g=255===c?255:0===o?0:p(0,255-255*(255-c)/o)},darken:function(){d=u<s?u:s,_=l<a?l:a,g=c<o?c:o},lighten:function(){d=u>s?u:s,_=l>a?l:a,g=c>o?c:o},difference:function(){(d=u-s)<0&&(d=-d),(_=l-a)<0&&(_=-_),(g=c-o)<0&&(g=-g)},exclusion:function(){d=u+s*(255-u-u)/255,_=l+a*(255-l-l)/255,g=c+o*(255-c-c)/255},hue:function(){n(s,a,o,i(u,l,c)),e(d,_,g,t(u,l,c))},saturation:function(){n(u,l,c,i(s,a,o)),e(d,_,g,t(u,l,c))},luminosity:function(){e(u,l,c,t(s,a,o))},color:function(){e(s,a,o,t(u,l,c))},add:function(){d=v(u+s,255),_=v(l+a,255),g=v(c+o,255)},subtract:function(){d=p(u-s,0),_=p(l-a,0),g=p(c-o,0)},average:function(){d=(u+s)/2,_=(l+a)/2,g=(c+o)/2},negation:function(){d=255-m(255-s-u),_=255-m(255-a-l),g=255-m(255-o-c)}},w=this.nativeModes=r.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(t){this[t]=!0},{}),x=Q.getContext(1,1);x&&(r.each(y,function(t,e){var i="darken"===e,n=!1;x.save();try{x.fillStyle=i?"#300":"#a00",x.fillRect(0,0,1,1),x.globalCompositeOperation=e,x.globalCompositeOperation===e&&(x.fillStyle=i?"#a00":"#300",x.fillRect(0,0,1,1),n=x.getImageData(0,0,1,1).data[0]!==i?170:51)}catch(r){}x.restore(),w[e]=n}),Q.release(x)),this.process=function(t,e,i,n,r){var v=e.canvas,p="normal"===t;if(p||w[t])i.save(),i.setTransform(1,0,0,1,0,0),i.globalAlpha=n,p||(i.globalCompositeOperation=t),i.drawImage(v,r.x,r.y),i.restore();else{var m=y[t];if(!m)return;for(var x=i.getImageData(r.x,r.y,v.width,v.height),b=x.data,C=e.getImageData(0,0,v.width,v.height).data,S=0,P=b.length;S<P;S+=4){s=C[S],u=b[S],a=C[S+1],l=b[S+1],o=C[S+2],c=b[S+2],h=C[S+3],f=b[S+3],m();var I=h*n/255,M=1-I;b[S]=I*d+M*u,b[S+1]=I*_+M*l,b[S+2]=I*g+M*c,b[S+3]=h*n+M*f}i.putImageData(x,r.x,r.y)}}},et=new function(){function i(t,e,i){for(var n in e){var r=e[n],s=o[n];"number"==typeof r&&i&&(r=i.number(r)),s?t.setAttributeNS(s,n,r):t.setAttribute(n,r)}return t}var r="http://www.w3.org/2000/svg",s="http://www.w3.org/2000/xmlns",a="http://www.w3.org/1999/xlink",o={href:a,xlink:s,xmlns:s+"/","xmlns:xlink":s+"/"};return{svg:r,xmlns:s,xlink:a,create:function(t,e,s){return i(n.createElementNS(r,t),e,s)},get:function(t,e){var i=o[e],n=i?t.getAttributeNS(i,e):t.getAttribute(e);return"null"===n?null:n},set:i}},it=r.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(t,e){return!e&&(t instanceof A||t instanceof C||t instanceof E)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(t,e){var i=r.capitalize(e),n=t[2];this[e]={type:t[1],property:e,attribute:t[0],toSVG:n,fromSVG:n&&r.each(n,function(t,e){this[t]=e},{}),exportFilter:t[3],get:"get"+i,set:"set"+i}},{});return new function(){function e(t,e,i){var n=new r,s=t.getTranslation();if(e){var a=(t=t._shiftless())._inverseTransform(s);n[i?"cx":"x"]=a.x,n[i?"cy":"y"]=a.y,s=null}if(!t.isIdentity()){var o=t.decompose();if(o){var h=[],l=o.rotation,c=o.scaling,f=o.skewing;s&&!s.isZero()&&h.push("translate("+S.point(s)+")"),l&&h.push("rotate("+S.number(l)+")"),u.isZero(c.x-1)&&u.isZero(c.y-1)||h.push("scale("+S.point(c)+")"),f&&f.x&&h.push("skewX("+S.number(f.x)+")"),f&&f.y&&h.push("skewY("+S.number(f.y)+")"),n.transform=h.join(" ")}else n.transform="matrix("+t.getValues().join(",")+")"}return n}function i(t,i){for(var n=e(t._matrix),r=t._children,s=et.create("g",n,S),a=0,o=r.length;a<o;a++){var h=r[a],u=b(h,i);if(u)if(h.isClipMask()){var l=et.create("clipPath");l.appendChild(u),m(h,l,"clip"),et.set(s,{"clip-path":"url(#"+l.id+")"})}else s.appendChild(u)}return s}function a(t){var i=t._type,n=t._radius,r=e(t._matrix,!0,"rectangle"!==i);if("rectangle"===i){i="rect";var s=t._size,a=s.width,o=s.height;r.x-=a/2,r.y-=o/2,r.width=a,r.height=o,n.isZero()&&(n=null)}return n&&("circle"===i?r.r=n:(r.rx=n.width,r.ry=n.height)),et.create(i,r,S)}function _(t,e,i){var n={},s=!i&&t.getParent(),a=[];return null!=t._name&&(n.id=t._name),r.each(it,function(e){var i=e.get,o=e.type,h=t[i]();if(e.exportFilter?e.exportFilter(t,h):!s||!r.equals(s[i](),h)){if("color"===o&&null!=h){var u=h.getAlpha();u<1&&(n[e.attribute+"-opacity"]=u)}"style"===o?a.push(e.attribute+": "+h):n[e.attribute]=null==h?"none":"color"===o?h.gradient?function(t){var e=v(t,"color");if(!e){var i,n=t.getGradient(),r=n._radial,s=t.getOrigin(),a=t.getDestination();if(r){i={cx:s.x,cy:s.y,r:s.getDistance(a)};var o=t.getHighlight();o&&(i.fx=o.x,i.fy=o.y)}else i={x1:s.x,y1:s.y,x2:a.x,y2:a.y};i.gradientUnits="userSpaceOnUse",e=et.create((r?"radial":"linear")+"Gradient",i,S);for(var h=n._stops,u=0,l=h.length;u<l;u++){var c=h[u],f=c._color,d=f.getAlpha(),_=c._offset;i={offset:null==_?u/(l-1):_},f&&(i["stop-color"]=f.toCSS(!0)),d<1&&(i["stop-opacity"]=d),e.appendChild(et.create("stop",i,S))}m(t,e,"color")}return"url(#"+e.id+")"}(h):h.toCSS(!0):"array"===o?h.join(","):"lookup"===o?e.toSVG[h]:h}}),a.length&&(n.style=a.join(";")),1===n.opacity&&delete n.opacity,t._visible||(n.visibility="hidden"),et.set(e,n,S)}function v(t,e){return P||(P={ids:{},svgs:{}}),t&&P.svgs[e+"-"+(t._id||t.__id||(t.__id=l.get("svg")))]}function m(t,e,i){P||v();var n=P.ids[i]=(P.ids[i]||0)+1;e.id=i+"-"+n,P.svgs[i+"-"+(t._id||t.__id)]=e}function x(e,i){var n=e,r=null;if(P){n="svg"===e.nodeName.toLowerCase()&&e;for(var s in P.svgs)r||(n||(n=et.create("svg")).appendChild(e),r=n.insertBefore(et.create("defs"),n.firstChild)),r.appendChild(P.svgs[s]);P=null}return i.asString?(new t.XMLSerializer).serializeToString(n):n}function b(t,e,i){var n=I[t._class],r=n&&n(t,e);if(r){var s=e.onExport;s&&(r=s(t,r,e)||r);var a=JSON.stringify(t._data);a&&"{}"!==a&&"null"!==a&&r.setAttribute("data-paper-data",a)}return r&&_(t,r,i)}function C(t){return t||(t={}),S=new h(t.precision),t}var S,P,I={Group:i,Layer:i,Raster:function(t,i){var n=e(t._matrix,!0),r=t.getSize(),s=t.getImage();return n.x-=r.width/2,n.y-=r.height/2,n.width=r.width,n.height=r.height,n.href=!1===i.embedImages&&s&&s.src||t.toDataURL(),et.create("image",n,S)},Path:function(t,i){var n=i.matchShapes;if(n){var r=t.toShape(!1);if(r)return a(r)}var s,o=t._segments,h=o.length,u=e(t._matrix);if(n&&h>=2&&!t.hasHandles())if(h>2){s=t._closed?"polygon":"polyline";for(var l=[],c=0;c<h;c++)l.push(S.point(o[c]._point));u.points=l.join(" ")}else{s="line";var f=o[0]._point,d=o[1]._point;u.set({x1:f.x,y1:f.y,x2:d.x,y2:d.y})}else s="path",u.d=t.getPathData(null,i.precision);return et.create(s,u,S)},Shape:a,CompoundPath:function(t,i){var n=e(t._matrix),r=t.getPathData(null,i.precision);return r&&(n.d=r),et.create("path",n,S)},SymbolItem:function(t,i){var n=e(t._matrix,!0),r=t._definition,s=v(r,"symbol"),a=r._item,o=a.getBounds();return s||((s=et.create("symbol",{viewBox:S.rectangle(o)})).appendChild(b(a,i)),m(r,s,"symbol")),n.href="#"+s.id,n.x+=o.x,n.y+=o.y,n.width=o.width,n.height=o.height,n.overflow="visible",et.create("use",n,S)},PointText:function(t){var i=et.create("text",e(t._matrix,!0),S);return i.textContent=t._content,i}};w.inject({exportSVG:function(t){return t=C(t),x(b(this,t,!0),t)}}),y.inject({exportSVG:function(t){t=C(t);var i=this._children,n=this.getView(),s=r.pick(t.bounds,"view"),a=t.matrix||"view"===s&&n._matrix,o=a&&p.read([a]),h="view"===s?new g([0,0],n.getViewSize()):"content"===s?w._getBounds(i,o,{stroke:!0}):g.read([s],0,{readNull:!0}),u={version:"1.1",xmlns:et.svg,"xmlns:xlink":et.xlink};h&&(u.width=h.width,u.height=h.height,(h.x||h.y)&&(u.viewBox=S.rectangle(h)));var l=et.create("svg",u,S),c=l;o&&!o.isIdentity()&&(c=l.appendChild(et.create("g",e(o),S)));for(var f=0,d=i.length;f<d;f++)c.appendChild(b(i[f],t,!0));return x(l,t)}})},new function(){function s(t,e,i,n,r){var s=et.get(t,e),a=null==s?n?null:i?"":0:i?s:parseFloat(s);return/%\s*$/.test(s)?a/100*(r?1:k[/x|^width/.test(e)?"width":"height"]):a}function a(t,e,i,n,r){return e=s(t,e||"x",!1,n,r),i=s(t,i||"y",!1,n,r),!n||null!=e&&null!=i?new c(e,i):null}function o(t,e,i,n,r){return e=s(t,e||"width",!1,n,r),i=s(t,i||"height",!1,n,r),!n||null!=e&&null!=i?new d(e,i):null}function h(t,e,i){return"none"===t?null:"number"===e?parseFloat(t):"array"===e?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===e?M(t)||t:"lookup"===e?i[t]:t}function u(t,e,i,n){var r=t.childNodes,s="clippath"===e,a="defs"===e,o=new x,h=o._project,u=h._currentStyle,l=[];if(s||a||(o=P(o,t,n),h._currentStyle=o._style.clone()),n)for(var c=t.querySelectorAll("defs"),f=0,d=c.length;f<d;f++)T(c[f],i,!1);for(var f=0,d=r.length;f<d;f++){var _,g=r[f];1!==g.nodeType||/^defs$/i.test(g.nodeName)||!(_=T(g,i,!1))||_ instanceof I||l.push(_)}return o.addChildren(l),s&&(o=P(o.reduce(),t,n)),h._currentStyle=u,(s||a)&&(o.remove(),o=null),o}function l(t,e){for(var i=t.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),n=[],r=0,s=i.length;r<s;r+=2)n.push(new c(parseFloat(i[r]),parseFloat(i[r+1])));var a=new L(n);return"polygon"===e&&a.closePath(),a}function _(t,e){var i,n=(s(t,"href",!0)||"").substring(1),r="radialgradient"===e;if(n)(i=O[n].getGradient())._radial^r&&(i=i.clone(),i._radial=r);else{for(var o=t.childNodes,h=[],u=0,l=o.length;u<l;u++){var c=o[u];1===c.nodeType&&h.push(P(new q,c))}i=new R(h,r)}var f,d,_,g="userSpaceOnUse"!==s(t,"gradientUnits",!0);r?(f=a(t,"cx","cy",!1,g),d=f.add(s(t,"r",!1,!1,g),0),_=a(t,"fx","fy",!0,g)):(f=a(t,"x1","y1",!1,g),d=a(t,"x2","y2",!1,g));return P(new F(i,f,d,_),t)._scaleToBounds=g,null}function v(t,e,i,n){if(t.transform){for(var r=(n.getAttribute(i)||"").split(/\)\s*/g),s=new p,a=0,o=r.length;a<o;a++){var h=r[a];if(!h)break;for(var u=h.split(/\(\s*/),l=u[0],c=u[1].split(/[\s,]+/g),f=0,d=c.length;f<d;f++)c[f]=parseFloat(c[f]);switch(l){case"matrix":s.append(new p(c[0],c[1],c[2],c[3],c[4],c[5]));break;case"rotate":s.rotate(c[0],c[1],c[2]);break;case"translate":s.translate(c[0],c[1]);break;case"scale":s.scale(c);break;case"skewX":s.skew(c[0],0);break;case"skewY":s.skew(0,c[0])}}t.transform(s)}}function m(t,e,i){var n="fill-opacity"===i?"getFillColor":"getStrokeColor",r=t[n]&&t[n]();r&&r.setAlpha(parseFloat(e))}function b(t,i,n){var s=t.attributes[i],a=s&&s.value;if(!a){var o=r.camelize(i);(a=t.style[o])||n.node[o]===n.parent[o]||(a=n.node[o])}return a?"none"===a?null:a:e}function P(t,i,n){var s=i.parentNode,a={node:H.getStyles(i)||{},parent:!n&&!/^defs$/i.test(s.tagName)&&H.getStyles(s)||{}};return r.each(B,function(n,r){var s=b(i,r,a);t=s!==e&&n(t,s,r,i,a)||t}),t}function M(t){var e=t&&t.match(/\((?:["'#]*)([^"')]+)/),n=e&&e[1],r=n&&O[i?n.replace(i.location.href.split("#")[0]+"#",""):n];return r&&r._scaleToBounds&&(r=r.clone(),r._scaleToBounds=!0),r}function T(t,e,i){var s,a,h,u=t.nodeName.toLowerCase(),l="#document"!==u,c=n.body;i&&l&&(k=o(t,null,null,!0)||paper.getView().getSize(),s=et.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),a=t.parentNode,h=t.nextSibling,s.appendChild(t),c.appendChild(s));var f=paper.settings,d=f.applyMatrix,_=f.insertItems;f.applyMatrix=!1,f.insertItems=!1;var g=N[u],v=g&&g(t,u,e,i)||null;if(f.insertItems=_,f.applyMatrix=d,v){!l||v instanceof x||(v=P(v,t,i));var p=e.onImport,m=l&&t.getAttribute("data-paper-data");p&&(v=p(t,v,e)||v),e.expandShapes&&v instanceof C&&(v.remove(),v=v.toPath()),m&&(v._data=JSON.parse(m))}return s&&(c.removeChild(s),a&&(h?a.insertBefore(t,h):a.appendChild(t))),i&&(O={},v&&r.pick(e.applyMatrix,d)&&v.matrix.apply(!0,!0)),v}function z(i,r,s){function a(n){try{var a="object"==typeof n?n:(new t.DOMParser).parseFromString(n,"image/svg+xml");if(!a.nodeName)throw a=null,new Error("Unsupported SVG source: "+i);paper=h,u=T(a,r,!0),r&&!1===r.insert||s._insertItem(e,u);var l=r.onLoad;l&&l(u,n)}catch(c){o(c)}}function o(t,e){var i=r.onError;if(!i)throw new Error(t);i(t,e)}if(!i)return null;r="function"==typeof r?{onLoad:r}:r||{};var h=paper,u=null;if("string"!=typeof i||/^.*</.test(i)){if("undefined"!=typeof File&&i instanceof File){var l=new FileReader;return l.onload=function(){a(l.result)},l.onerror=function(){o(l.error)},l.readAsText(i)}a(i)}else{var c=n.getElementById(i);c?a(c):K.request({url:i,async:!0,onLoad:a,onError:o})}return u}var k,O={},N={"#document":function(t,e,i,n){for(var r=t.childNodes,s=0,a=r.length;s<a;s++){var o=r[s];if(1===o.nodeType)return T(o,i,n)}},g:u,svg:u,clippath:u,polygon:l,polyline:l,path:function(t){return A.create(t.getAttribute("d"))},lineargradient:_,radialgradient:_,image:function(t){var e=new S(s(t,"href",!0));return e.on("load",function(){var e=o(t);this.setSize(e);var i=this._matrix._transformPoint(a(t).add(e.divide(2)));this.translate(i)}),e},symbol:function(t,e,i,n){return new I(u(t,e,i,n),!0)},defs:u,use:function(t){var e=(s(t,"href",!0)||"").substring(1),i=O[e],n=a(t);return i?i instanceof I?i.place(n):i.clone().translate(n):null},circle:function(t){return new C.Circle(a(t,"cx","cy"),s(t,"r"))},ellipse:function(t){return new C.Ellipse({center:a(t,"cx","cy"),radius:o(t,"rx","ry")})},rect:function(t){return new C.Rectangle(new g(a(t),o(t)),o(t,"rx","ry"))},line:function(t){return new L.Line(a(t,"x1","y1"),a(t,"x2","y2"))},text:function(t){var e=new D(a(t).add(a(t,"dx","dy")));return e.setContent(t.textContent.trim()||""),e}},B=r.set(r.each(it,function(t){this[t.attribute]=function(e,i){if(e[t.set]&&(e[t.set](h(i,t.type,t.fromSVG)),"color"===t.type)){var n=e[t.get]();if(n){if(n._scaleToBounds){var r=e.getBounds();n.transform((new p).translate(r.getPoint()).scale(r.getSize()))}e instanceof C&&n.transform((new p).translate(e.getPosition(!0).negate()))}}}},{}),{id:function(t,e){O[e]=t,t.setName&&t.setName(e)},"clip-path":function(t,e){var i=M(e);if(i){if((i=i.clone()).setClipMask(!0),!(t instanceof x))return new x(i,t);t.insertChild(0,i)}},gradientTransform:v,transform:v,"fill-opacity":m,"stroke-opacity":m,visibility:function(t,e){t.setVisible&&t.setVisible("visible"===e)},display:function(t,e){t.setVisible&&t.setVisible(null!==e)},"stop-color":function(t,e){t.setColor&&t.setColor(e)},"stop-opacity":function(t,e){t._color&&t._color.setAlpha(parseFloat(e))},offset:function(t,e){if(t.setOffset){var i=e.match(/(.*)%$/);t.setOffset(i?i[1]/100:parseFloat(e))}},viewBox:function(t,e,i,n,r){var s,u=new g(h(e,"array")),l=o(n,null,null,!0);if(t instanceof x){var c=l?l.divide(u.getSize()):1,a=(new p).scale(c).translate(u.getPoint().negate());s=t}else t instanceof I&&(l&&u.setSize(l),s=t._item);if(s){if("visible"!==b(n,"overflow",r)){var f=new C.Rectangle(u);f.setClipMask(!0),s.addChild(f)}a&&s.transform(a)}}});w.inject({importSVG:function(t,e){return z(t,e,this)}}),y.inject({importSVG:function(t,e){return this.activate(),z(t,e,this)}})},(paper=new(a.inject(r.exports,{enumerable:!0,Base:r,Numerical:u,Key:X,DomEvent:Z,DomElement:H,document:n,window:i,Symbol:I,PlacedSymbol:P}))).agent.node&&require("./node/extend.js")(paper),"function"==typeof define&&define.amd?define("paper",paper):"object"==typeof module&&module&&(module.exports=paper),paper}.call(this,"object"==typeof self?self:null);!function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports&&"object"==typeof module?module.exports=factory(require("jquery")):factory(jQuery)}(function($,undefined){"use strict";function paletteTemplate(p,color,className,opts){for(var html=[],i=0;i<p.length;i++){var current=p[i];if(current){var tiny=tinycolor(current),c=tiny.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";c+=tinycolor.equals(color,current)?" sp-thumb-active":"";var formattedString=tiny.toString(opts.preferredFormat||"rgb"),swatchStyle=rgbaSupport?"background-color:"+tiny.toRgbString():"filter:"+tiny.toFilter();html.push('<span title="'+formattedString+'" data-color="'+tiny.toRgbString()+'" class="'+c+'"><span class="sp-thumb-inner" style="'+swatchStyle+';" /></span>')}else{html.push($("<div />").append($('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",opts.noColorSelectedText)).html())}}return"<div class='sp-cf "+className+"'>"+html.join("")+"</div>"}function spectrum(element,o){function applyOptions(){if(opts.showPaletteOnly&&(opts.showPalette=!0),toggleButton.text(opts.showPaletteOnly?opts.togglePaletteMoreText:opts.togglePaletteLessText),opts.palette){palette=opts.palette.slice(0),paletteArray=$.isArray(palette[0])?palette:[palette],paletteLookup={};for(var i=0;i<paletteArray.length;i++)for(var j=0;j<paletteArray[i].length;j++){var rgb=tinycolor(paletteArray[i][j]).toRgbString();paletteLookup[rgb]=!0}}container.toggleClass("sp-flat",flat),container.toggleClass("sp-input-disabled",!opts.showInput),container.toggleClass("sp-alpha-enabled",opts.showAlpha),container.toggleClass("sp-clear-enabled",allowEmpty),container.toggleClass("sp-buttons-disabled",!opts.showButtons),container.toggleClass("sp-palette-buttons-disabled",!opts.togglePaletteOnly),container.toggleClass("sp-palette-disabled",!opts.showPalette),container.toggleClass("sp-palette-only",opts.showPaletteOnly),container.toggleClass("sp-initial-disabled",!opts.showInitial),container.addClass(opts.className).addClass(opts.containerClassName),reflow()}function updateSelectionPaletteFromStorage(){if(localStorageKey&&window.localStorage){try{var oldPalette=window.localStorage[localStorageKey].split(",#");oldPalette.length>1&&(delete window.localStorage[localStorageKey],$.each(oldPalette,function(i,c){addColorToSelectionPalette(c)}))}catch(e){}try{selectionPalette=window.localStorage[localStorageKey].split(";")}catch(e){}}}function addColorToSelectionPalette(color){if(showSelectionPalette){var rgb=tinycolor(color).toRgbString();if(!paletteLookup[rgb]&&-1===$.inArray(rgb,selectionPalette))for(selectionPalette.push(rgb);selectionPalette.length>maxSelectionSize;)selectionPalette.shift();if(localStorageKey&&window.localStorage)try{window.localStorage[localStorageKey]=selectionPalette.join(";")}catch(e){}}}function drawPalette(){var currentColor=get(),html=$.map(paletteArray,function(palette,i){return paletteTemplate(palette,currentColor,"sp-palette-row sp-palette-row-"+i,opts)});updateSelectionPaletteFromStorage(),selectionPalette&&html.push(paletteTemplate(function(){var unique=[];if(opts.showPalette)for(var i=0;i<selectionPalette.length;i++){var rgb=tinycolor(selectionPalette[i]).toRgbString();paletteLookup[rgb]||unique.push(selectionPalette[i])}return unique.reverse().slice(0,opts.maxSelectionSize)}(),currentColor,"sp-palette-row sp-palette-row-selection",opts)),paletteContainer.html(html.join(""))}function drawInitial(){if(opts.showInitial){var initial=colorOnShow,current=get();initialColorContainer.html(paletteTemplate([initial,current],current,"sp-palette-row-initial",opts))}}function dragStart(){(dragHeight<=0||dragWidth<=0||slideHeight<=0)&&reflow(),isDragging=!0,container.addClass(draggingClass),shiftMovementDirection=null,boundElement.trigger("dragstart.spectrum",[get()])}function dragStop(){isDragging=!1,container.removeClass(draggingClass),boundElement.trigger("dragstop.spectrum",[get()])}function setFromTextInput(){var value=textInput.val();if(null!==value&&""!==value||!allowEmpty){var tiny=tinycolor(value);tiny.isValid()?(set(tiny),updateOriginalInput(!0)):textInput.addClass("sp-validation-error")}else set(null),updateOriginalInput(!0)}function toggle(){visible?hide():show()}function show(){var event=$.Event("beforeShow.spectrum");visible?reflow():(boundElement.trigger(event,[get()]),!1===callbacks.beforeShow(get())||event.isDefaultPrevented()||(!function(){for(var i=0;i<spectrums.length;i++)spectrums[i]&&spectrums[i].hide()}(),visible=!0,$(doc).bind("keydown.spectrum",onkeydown),$(doc).bind("click.spectrum",clickout),$(window).bind("resize.spectrum",resize),replacer.addClass("sp-active"),container.removeClass("sp-hidden"),reflow(),updateUI(),colorOnShow=get(),drawInitial(),callbacks.show(colorOnShow),boundElement.trigger("show.spectrum",[colorOnShow])))}function onkeydown(e){27===e.keyCode&&hide()}function clickout(e){2!=e.button&&(isDragging||(clickoutFiresChange?updateOriginalInput(!0):revert(),hide()))}function hide(){visible&&!flat&&(visible=!1,$(doc).unbind("keydown.spectrum",onkeydown),$(doc).unbind("click.spectrum",clickout),$(window).unbind("resize.spectrum",resize),replacer.removeClass("sp-active"),container.addClass("sp-hidden"),callbacks.hide(get()),boundElement.trigger("hide.spectrum",[get()]))}function revert(){set(colorOnShow,!0)}function set(color,ignoreFormatChange){if(tinycolor.equals(color,get()))updateUI();else{var newColor,newHsv;!color&&allowEmpty?isEmpty=!0:(isEmpty=!1,newHsv=(newColor=tinycolor(color)).toHsv(),currentHue=newHsv.h%360/360,currentSaturation=newHsv.s,currentValue=newHsv.v,currentAlpha=newHsv.a),updateUI(),newColor&&newColor.isValid()&&!ignoreFormatChange&&(currentPreferredFormat=opts.preferredFormat||newColor.getFormat())}}function get(opts){return opts=opts||{},allowEmpty&&isEmpty?null:tinycolor.fromRatio({h:currentHue,s:currentSaturation,v:currentValue,a:Math.round(100*currentAlpha)/100},{format:opts.format||currentPreferredFormat})}function move(){updateUI(),callbacks.move(get()),boundElement.trigger("move.spectrum",[get()])}function updateUI(){textInput.removeClass("sp-validation-error"),updateHelperLocations();var flatColor=tinycolor.fromRatio({h:currentHue,s:1,v:1});dragger.css("background-color",flatColor.toHexString());var format=currentPreferredFormat;currentAlpha<1&&(0!==currentAlpha||"name"!==format)&&("hex"!==format&&"hex3"!==format&&"hex6"!==format&&"name"!==format||(format="rgb"));var realColor=get({format:format}),displayColor="";if(previewElement.removeClass("sp-clear-display"),previewElement.css("background-color","transparent"),!realColor&&allowEmpty)previewElement.addClass("sp-clear-display");else{var realHex=realColor.toHexString(),realRgb=realColor.toRgbString();if(rgbaSupport||1===realColor.alpha?previewElement.css("background-color",realRgb):(previewElement.css("background-color","transparent"),previewElement.css("filter",realColor.toFilter())),opts.showAlpha){var rgb=realColor.toRgb();rgb.a=0;var realAlpha=tinycolor(rgb).toRgbString(),gradient="linear-gradient(left, "+realAlpha+", "+realHex+")";IE?alphaSliderInner.css("filter",tinycolor(realAlpha).toFilter({gradientType:1},realHex)):(alphaSliderInner.css("background","-webkit-"+gradient),alphaSliderInner.css("background","-moz-"+gradient),alphaSliderInner.css("background","-ms-"+gradient),alphaSliderInner.css("background","linear-gradient(to right, "+realAlpha+", "+realHex+")"))}displayColor=realColor.toString(format)}opts.showInput&&textInput.val(displayColor),opts.showPalette&&drawPalette(),drawInitial()}function updateHelperLocations(){var s=currentSaturation,v=currentValue;if(allowEmpty&&isEmpty)alphaSlideHelper.hide(),slideHelper.hide(),dragHelper.hide();else{alphaSlideHelper.show(),slideHelper.show(),dragHelper.show();var dragX=s*dragWidth,dragY=dragHeight-v*dragHeight;dragX=Math.max(-dragHelperHeight,Math.min(dragWidth-dragHelperHeight,dragX-dragHelperHeight)),dragY=Math.max(-dragHelperHeight,Math.min(dragHeight-dragHelperHeight,dragY-dragHelperHeight)),dragHelper.css({top:dragY+"px",left:dragX+"px"});var alphaX=currentAlpha*alphaWidth;alphaSlideHelper.css({left:alphaX-alphaSlideHelperWidth/2+"px"});var slideY=currentHue*slideHeight;slideHelper.css({top:slideY-slideHelperHeight+"px"})}}function updateOriginalInput(fireCallback){var color=get(),displayColor="",hasChanged=!tinycolor.equals(color,colorOnShow);color&&(displayColor=color.toString(currentPreferredFormat),addColorToSelectionPalette(color)),isInput&&boundElement.val(displayColor),fireCallback&&hasChanged&&(callbacks.change(color),boundElement.trigger("change",[color]))}function reflow(){visible&&(dragWidth=dragger.width(),dragHeight=dragger.height(),dragHelperHeight=dragHelper.height(),slideWidth=slider.width(),slideHeight=slider.height(),slideHelperHeight=slideHelper.height(),alphaWidth=alphaSlider.width(),alphaSlideHelperWidth=alphaSlideHelper.width(),flat||(container.css("position","absolute"),opts.offset?container.offset(opts.offset):container.offset(function(picker,input){var dpWidth=picker.outerWidth(),dpHeight=picker.outerHeight(),inputHeight=input.outerHeight(),doc=picker[0].ownerDocument,docElem=doc.documentElement,viewWidth=docElem.clientWidth+$(doc).scrollLeft(),viewHeight=docElem.clientHeight+$(doc).scrollTop(),offset=input.offset();return offset.top+=inputHeight,offset.left-=Math.min(offset.left,offset.left+dpWidth>viewWidth&&viewWidth>dpWidth?Math.abs(offset.left+dpWidth-viewWidth):0),offset.top-=Math.min(offset.top,offset.top+dpHeight>viewHeight&&viewHeight>dpHeight?Math.abs(dpHeight+inputHeight-0):0),offset}(container,offsetElement))),updateHelperLocations(),opts.showPalette&&drawPalette(),boundElement.trigger("reflow.spectrum"))}function disable(){hide(),disabled=!0,boundElement.attr("disabled",!0),offsetElement.addClass("sp-disabled")}var opts=function(o,callbackContext){var opts=$.extend({},defaultOpts,o);return opts.callbacks={move:bind(opts.move,callbackContext),change:bind(opts.change,callbackContext),show:bind(opts.show,callbackContext),hide:bind(opts.hide,callbackContext),beforeShow:bind(opts.beforeShow,callbackContext)},opts}(o,element),flat=opts.flat,showSelectionPalette=opts.showSelectionPalette,localStorageKey=opts.localStorageKey,theme=opts.theme,callbacks=opts.callbacks,resize=function(func,wait,debounce){var timeout;return function(){var context=this,args=arguments;debounce&&clearTimeout(timeout),!debounce&&timeout||(timeout=setTimeout(function(){timeout=null,func.apply(context,args)},wait))}}(reflow,10),visible=!1,isDragging=!1,dragWidth=0,dragHeight=0,dragHelperHeight=0,slideHeight=0,slideWidth=0,alphaWidth=0,alphaSlideHelperWidth=0,slideHelperHeight=0,currentHue=0,currentSaturation=0,currentValue=0,currentAlpha=1,palette=[],paletteArray=[],paletteLookup={},selectionPalette=opts.selectionPalette.slice(0),maxSelectionSize=opts.maxSelectionSize,draggingClass="sp-dragging",shiftMovementDirection=null,doc=element.ownerDocument,boundElement=(doc.body,$(element)),disabled=!1,container=$(markup,doc).addClass(theme),pickerContainer=container.find(".sp-picker-container"),dragger=container.find(".sp-color"),dragHelper=container.find(".sp-dragger"),slider=container.find(".sp-hue"),slideHelper=container.find(".sp-slider"),alphaSliderInner=container.find(".sp-alpha-inner"),alphaSlider=container.find(".sp-alpha"),alphaSlideHelper=container.find(".sp-alpha-handle"),textInput=container.find(".sp-input"),paletteContainer=container.find(".sp-palette"),initialColorContainer=container.find(".sp-initial"),cancelButton=container.find(".sp-cancel"),clearButton=container.find(".sp-clear"),chooseButton=container.find(".sp-choose"),toggleButton=container.find(".sp-palette-toggle"),isInput=boundElement.is("input"),isInputTypeColor=isInput&&"color"===boundElement.attr("type")&&inputTypeColorSupport(),shouldReplace=isInput&&!flat,replacer=shouldReplace?$(replaceInput).addClass(theme).addClass(opts.className).addClass(opts.replacerClassName):$([]),offsetElement=shouldReplace?replacer:boundElement,previewElement=replacer.find(".sp-preview-inner"),initialColor=opts.color||isInput&&boundElement.val(),colorOnShow=!1,currentPreferredFormat=opts.preferredFormat,clickoutFiresChange=!opts.showButtons||opts.clickoutFiresChange,isEmpty=!initialColor,allowEmpty=opts.allowEmpty&&!isInputTypeColor;!function(){function paletteElementClick(e){return e.data&&e.data.ignore?(set($(e.target).closest(".sp-thumb-el").data("color")),move()):(set($(e.target).closest(".sp-thumb-el").data("color")),move(),updateOriginalInput(!0),opts.hideAfterPaletteSelect&&hide()),!1}if(IE&&container.find("*:not(input)").attr("unselectable","on"),applyOptions(),shouldReplace&&boundElement.after(replacer).hide(),allowEmpty||clearButton.hide(),flat)boundElement.after(container).hide();else{var appendTo="parent"===opts.appendTo?boundElement.parent():$(opts.appendTo);1!==appendTo.length&&(appendTo=$("body")),appendTo.append(container)}updateSelectionPaletteFromStorage(),offsetElement.bind("click.spectrum touchstart.spectrum",function(e){disabled||toggle(),e.stopPropagation(),$(e.target).is("input")||e.preventDefault()}),(boundElement.is(":disabled")||!0===opts.disabled)&&disable(),container.click(stopPropagation),textInput.change(setFromTextInput),textInput.bind("paste",function(){setTimeout(setFromTextInput,1)}),textInput.keydown(function(e){13==e.keyCode&&setFromTextInput()}),cancelButton.text(opts.cancelText),cancelButton.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),revert(),hide()}),clearButton.attr("title",opts.clearText),clearButton.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),isEmpty=!0,move(),flat&&updateOriginalInput(!0)}),chooseButton.text(opts.chooseText),chooseButton.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),IE&&textInput.is(":focus")&&textInput.trigger("change"),textInput.hasClass("sp-validation-error")||(updateOriginalInput(!0),hide())}),toggleButton.text(opts.showPaletteOnly?opts.togglePaletteMoreText:opts.togglePaletteLessText),toggleButton.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),opts.showPaletteOnly=!opts.showPaletteOnly,opts.showPaletteOnly||flat||container.css("left","-="+(pickerContainer.outerWidth(!0)+5)),applyOptions()}),draggable(alphaSlider,function(dragX,dragY,e){currentAlpha=dragX/alphaWidth,isEmpty=!1,e.shiftKey&&(currentAlpha=Math.round(10*currentAlpha)/10),move()},dragStart,dragStop),draggable(slider,function(dragX,dragY){currentHue=parseFloat(dragY/slideHeight),isEmpty=!1,opts.showAlpha||(currentAlpha=1),move()},dragStart,dragStop),draggable(dragger,function(dragX,dragY,e){if(e.shiftKey){if(!shiftMovementDirection){var oldDragX=currentSaturation*dragWidth,oldDragY=dragHeight-currentValue*dragHeight,furtherFromX=Math.abs(dragX-oldDragX)>Math.abs(dragY-oldDragY);shiftMovementDirection=furtherFromX?"x":"y"}}else shiftMovementDirection=null;var setValue=!shiftMovementDirection||"y"===shiftMovementDirection;(!shiftMovementDirection||"x"===shiftMovementDirection)&&(currentSaturation=parseFloat(dragX/dragWidth)),setValue&&(currentValue=parseFloat((dragHeight-dragY)/dragHeight)),isEmpty=!1,opts.showAlpha||(currentAlpha=1),move()},dragStart,dragStop),initialColor?(set(initialColor),updateUI(),currentPreferredFormat=opts.preferredFormat||tinycolor(initialColor).format,addColorToSelectionPalette(initialColor)):updateUI(),flat&&show();var paletteEvent=IE?"mousedown.spectrum":"click.spectrum touchstart.spectrum";paletteContainer.delegate(".sp-thumb-el",paletteEvent,paletteElementClick),initialColorContainer.delegate(".sp-thumb-el:nth-child(1)",paletteEvent,{ignore:!0},paletteElementClick)}();var spect={show:show,hide:hide,toggle:toggle,reflow:reflow,option:function(optionName,optionValue){return optionName===undefined?$.extend({},opts):optionValue===undefined?opts[optionName]:(opts[optionName]=optionValue,"preferredFormat"===optionName&&(currentPreferredFormat=opts.preferredFormat),void applyOptions())},enable:function(){disabled=!1,boundElement.attr("disabled",!1),offsetElement.removeClass("sp-disabled")},disable:disable,offset:function(coord){opts.offset=coord,reflow()},set:function(c){set(c),updateOriginalInput()},get:get,destroy:function(){boundElement.show(),offsetElement.unbind("click.spectrum touchstart.spectrum"),container.remove(),replacer.remove(),spectrums[spect.id]=null},container:container};return spect.id=spectrums.push(spect)-1,spect}function noop(){}function stopPropagation(e){e.stopPropagation()}function bind(func,obj){var slice=Array.prototype.slice,args=slice.call(arguments,2);return function(){return func.apply(obj,args.concat(slice.call(arguments)))}}function draggable(element,onmove,onstart,onstop){function prevent(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function move(e){if(dragging){if(IE&&doc.documentMode<9&&!e.button)return stop();var t0=e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches[0],pageX=t0&&t0.pageX||e.pageX,pageY=t0&&t0.pageY||e.pageY,dragX=Math.max(0,Math.min(pageX-offset.left,maxWidth)),dragY=Math.max(0,Math.min(pageY-offset.top,maxHeight));hasTouch&&prevent(e),onmove.apply(element,[dragX,dragY,e])}}function stop(){dragging&&($(doc).unbind(duringDragEvents),$(doc.body).removeClass("sp-dragging"),setTimeout(function(){onstop.apply(element,arguments)},0)),dragging=!1}onmove=onmove||function(){},onstart=onstart||function(){},onstop=onstop||function(){};var doc=document,dragging=!1,offset={},maxHeight=0,maxWidth=0,hasTouch="ontouchstart"in window,duringDragEvents={};duringDragEvents.selectstart=prevent,duringDragEvents.dragstart=prevent,duringDragEvents["touchmove mousemove"]=move,duringDragEvents["touchend mouseup"]=stop,$(element).bind("touchstart mousedown",function(e){(e.which?3==e.which:2==e.button)||dragging||!1!==onstart.apply(element,arguments)&&(dragging=!0,maxHeight=$(element).height(),maxWidth=$(element).width(),offset=$(element).offset(),$(doc).bind(duringDragEvents),$(doc.body).addClass("sp-dragging"),move(e),prevent(e))})}function inputTypeColorSupport(){return $.fn.spectrum.inputTypeColorSupport()}var defaultOpts={beforeShow:noop,move:noop,change:noop,show:noop,hide:noop,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},spectrums=[],IE=!!/msie/i.exec(window.navigator.userAgent),rgbaSupport=function(){function contains(str,substr){return!!~(""+str).indexOf(substr)}var style=document.createElement("div").style;return style.cssText="background-color:rgba(0,0,0,.5)",contains(style.backgroundColor,"rgba")||contains(style.backgroundColor,"hsla")}(),replaceInput=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),markup=function(){var gradientFix="";if(IE)for(var i=1;i<=6;i++)gradientFix+="<div class='sp-"+i+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",gradientFix,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();$.fn.spectrum=function(opts,extra){if("string"==typeof opts){var returnValue=this,args=Array.prototype.slice.call(arguments,1);return this.each(function(){var spect=spectrums[$(this).data("spectrum.id")];if(spect){var method=spect[opts];if(!method)throw new Error("Spectrum: no such method: '"+opts+"'");"get"==opts?returnValue=spect.get():"container"==opts?returnValue=spect.container:"option"==opts?returnValue=spect.option.apply(spect,args):"destroy"==opts?(spect.destroy(),$(this).removeData("spectrum.id")):method.apply(spect,args)}}),returnValue}return this.spectrum("destroy").each(function(){var spect=spectrum(this,$.extend({},opts,$(this).data()));$(this).data("spectrum.id",spect.id)})},$.fn.spectrum.load=!0,$.fn.spectrum.loadOpts={},$.fn.spectrum.draggable=draggable,$.fn.spectrum.defaults=defaultOpts,$.fn.spectrum.inputTypeColorSupport=function inputTypeColorSupport(){if(void 0===inputTypeColorSupport._cachedResult){var colorInput=$("<input type='color'/>")[0];inputTypeColorSupport._cachedResult="color"===colorInput.type&&""!==colorInput.value}return inputTypeColorSupport._cachedResult},$.spectrum={},$.spectrum.localization={},$.spectrum.palettes={},$.fn.spectrum.processNativeColorInputs=function(){var colorInputs=$("input[type=color]");colorInputs.length&&!inputTypeColorSupport()&&colorInputs.spectrum({preferredFormat:"hex6"})},function(){function inputToRGB(color){var rgb={r:0,g:0,b:0},a=1,ok=!1,format=!1;return"string"==typeof color&&(color=function(color){color=color.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var named=!1;if(names[color])color=names[color],named=!0;else if("transparent"==color)return{r:0,g:0,b:0,a:0,format:"name"};var match;if(match=matchers.rgb.exec(color))return{r:match[1],g:match[2],b:match[3]};if(match=matchers.rgba.exec(color))return{r:match[1],g:match[2],b:match[3],a:match[4]};if(match=matchers.hsl.exec(color))return{h:match[1],s:match[2],l:match[3]};if(match=matchers.hsla.exec(color))return{h:match[1],s:match[2],l:match[3],a:match[4]};if(match=matchers.hsv.exec(color))return{h:match[1],s:match[2],v:match[3]};if(match=matchers.hsva.exec(color))return{h:match[1],s:match[2],v:match[3],a:match[4]};if(match=matchers.hex8.exec(color))return{a:function(h){return parseIntFromHex(h)/255}(match[1]),r:parseIntFromHex(match[2]),g:parseIntFromHex(match[3]),b:parseIntFromHex(match[4]),format:named?"name":"hex8"};if(match=matchers.hex6.exec(color))return{r:parseIntFromHex(match[1]),g:parseIntFromHex(match[2]),b:parseIntFromHex(match[3]),format:named?"name":"hex"};if(match=matchers.hex3.exec(color))return{r:parseIntFromHex(match[1]+""+match[1]),g:parseIntFromHex(match[2]+""+match[2]),b:parseIntFromHex(match[3]+""+match[3]),format:named?"name":"hex"};return!1}(color)),"object"==typeof color&&(color.hasOwnProperty("r")&&color.hasOwnProperty("g")&&color.hasOwnProperty("b")?(rgb=function(r,g,b){return{r:255*bound01(r,255),g:255*bound01(g,255),b:255*bound01(b,255)}}(color.r,color.g,color.b),ok=!0,format="%"===String(color.r).substr(-1)?"prgb":"rgb"):color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("v")?(color.s=convertToPercentage(color.s),color.v=convertToPercentage(color.v),rgb=function(h,s,v){h=6*bound01(h,360),s=bound01(s,100),v=bound01(v,100);var i=math.floor(h),f=h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s),mod=i%6;return{r:255*[v,q,p,p,t,v][mod],g:255*[t,v,v,q,p,p][mod],b:255*[p,p,t,v,v,q][mod]}}(color.h,color.s,color.v),ok=!0,format="hsv"):color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("l")&&(color.s=convertToPercentage(color.s),color.l=convertToPercentage(color.l),rgb=function(h,s,l){function hue2rgb(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p}var r,g,b;h=bound01(h,360),s=bound01(s,100),l=bound01(l,100);if(0===s)r=g=b=l;else{var q=l<.5?l*(1+s):l+s-l*s,p=2*l-q;r=hue2rgb(p,q,h+1/3),g=hue2rgb(p,q,h),b=hue2rgb(p,q,h-1/3)}return{r:255*r,g:255*g,b:255*b}}(color.h,color.s,color.l),ok=!0,format="hsl"),color.hasOwnProperty("a")&&(a=color.a)),a=boundAlpha(a),{ok:ok,format:color.format||format,r:mathMin(255,mathMax(rgb.r,0)),g:mathMin(255,mathMax(rgb.g,0)),b:mathMin(255,mathMax(rgb.b,0)),a:a}}function rgbToHsl(r,g,b){r=bound01(r,255),g=bound01(g,255),b=bound01(b,255);var h,s,max=mathMax(r,g,b),min=mathMin(r,g,b),l=(max+min)/2;if(max==min)h=s=0;else{var d=max-min;switch(s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:h,s:s,l:l}}function rgbToHsv(r,g,b){r=bound01(r,255),g=bound01(g,255),b=bound01(b,255);var h,s,max=mathMax(r,g,b),min=mathMin(r,g,b),d=max-min;if(s=0===max?0:d/max,max==min)h=0;else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:h,s:s,v:max}}function rgbToHex(r,g,b,allow3Char){var hex=[pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))];return allow3Char&&hex[0].charAt(0)==hex[0].charAt(1)&&hex[1].charAt(0)==hex[1].charAt(1)&&hex[2].charAt(0)==hex[2].charAt(1)?hex[0].charAt(0)+hex[1].charAt(0)+hex[2].charAt(0):hex.join("")}function rgbaToHex(r,g,b,a){return[pad2(function(d){return Math.round(255*parseFloat(d)).toString(16)}(a)),pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))].join("")}function desaturate(color,amount){amount=0===amount?0:amount||10;var hsl=tinycolor(color).toHsl();return hsl.s-=amount/100,hsl.s=clamp01(hsl.s),tinycolor(hsl)}function saturate(color,amount){amount=0===amount?0:amount||10;var hsl=tinycolor(color).toHsl();return hsl.s+=amount/100,hsl.s=clamp01(hsl.s),tinycolor(hsl)}function greyscale(color){return tinycolor(color).desaturate(100)}function lighten(color,amount){amount=0===amount?0:amount||10;var hsl=tinycolor(color).toHsl();return hsl.l+=amount/100,hsl.l=clamp01(hsl.l),tinycolor(hsl)}function brighten(color,amount){amount=0===amount?0:amount||10;var rgb=tinycolor(color).toRgb();return rgb.r=mathMax(0,mathMin(255,rgb.r-mathRound(-amount/100*255))),rgb.g=mathMax(0,mathMin(255,rgb.g-mathRound(-amount/100*255))),rgb.b=mathMax(0,mathMin(255,rgb.b-mathRound(-amount/100*255))),tinycolor(rgb)}function darken(color,amount){amount=0===amount?0:amount||10;var hsl=tinycolor(color).toHsl();return hsl.l-=amount/100,hsl.l=clamp01(hsl.l),tinycolor(hsl)}function spin(color,amount){var hsl=tinycolor(color).toHsl(),hue=(mathRound(hsl.h)+amount)%360;return hsl.h=hue<0?360+hue:hue,tinycolor(hsl)}function complement(color){var hsl=tinycolor(color).toHsl();return hsl.h=(hsl.h+180)%360,tinycolor(hsl)}function triad(color){var hsl=tinycolor(color).toHsl(),h=hsl.h;return[tinycolor(color),tinycolor({h:(h+120)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+240)%360,s:hsl.s,l:hsl.l})]}function tetrad(color){var hsl=tinycolor(color).toHsl(),h=hsl.h;return[tinycolor(color),tinycolor({h:(h+90)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+180)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+270)%360,s:hsl.s,l:hsl.l})]}function splitcomplement(color){var hsl=tinycolor(color).toHsl(),h=hsl.h;return[tinycolor(color),tinycolor({h:(h+72)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+216)%360,s:hsl.s,l:hsl.l})]}function analogous(color,results,slices){results=results||6,slices=slices||30;var hsl=tinycolor(color).toHsl(),part=360/slices,ret=[tinycolor(color)];for(hsl.h=(hsl.h-(part*results>>1)+720)%360;--results;)hsl.h=(hsl.h+part)%360,ret.push(tinycolor(hsl));return ret}function monochromatic(color,results){results=results||6;for(var hsv=tinycolor(color).toHsv(),h=hsv.h,s=hsv.s,v=hsv.v,ret=[],modification=1/results;results--;)ret.push(tinycolor({h:h,s:s,v:v})),v=(v+modification)%1;return ret}function boundAlpha(a){return a=parseFloat(a),(isNaN(a)||a<0||a>1)&&(a=1),a}function bound01(n,max){(function(n){return"string"==typeof n&&-1!=n.indexOf(".")&&1===parseFloat(n)})(n)&&(n="100%");var processPercent=function(n){return"string"==typeof n&&-1!=n.indexOf("%")}(n);return n=mathMin(max,mathMax(0,parseFloat(n))),processPercent&&(n=parseInt(n*max,10)/100),math.abs(n-max)<1e-6?1:n%max/parseFloat(max)}function clamp01(val){return mathMin(1,mathMax(0,val))}function parseIntFromHex(val){return parseInt(val,16)}function pad2(c){return 1==c.length?"0"+c:""+c}function convertToPercentage(n){return n<=1&&(n=100*n+"%"),n}var trimLeft=/^[\s,#]+/,trimRight=/\s+$/,tinyCounter=0,math=Math,mathRound=math.round,mathMin=math.min,mathMax=math.max,mathRandom=math.random,tinycolor=function(color,opts){if(color=color||"",opts=opts||{},color instanceof tinycolor)return color;if(!(this instanceof tinycolor))return new tinycolor(color,opts);var rgb=inputToRGB(color);this._originalInput=color,this._r=rgb.r,this._g=rgb.g,this._b=rgb.b,this._a=rgb.a,this._roundA=mathRound(100*this._a)/100,this._format=opts.format||rgb.format,this._gradientType=opts.gradientType,this._r<1&&(this._r=mathRound(this._r)),this._g<1&&(this._g=mathRound(this._g)),this._b<1&&(this._b=mathRound(this._b)),this._ok=rgb.ok,this._tc_id=tinyCounter++};tinycolor.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var rgb=this.toRgb();return(299*rgb.r+587*rgb.g+114*rgb.b)/1e3},setAlpha:function(value){return this._a=boundAlpha(value),this._roundA=mathRound(100*this._a)/100,this},toHsv:function(){var hsv=rgbToHsv(this._r,this._g,this._b);return{h:360*hsv.h,s:hsv.s,v:hsv.v,a:this._a}},toHsvString:function(){var hsv=rgbToHsv(this._r,this._g,this._b),h=mathRound(360*hsv.h),s=mathRound(100*hsv.s),v=mathRound(100*hsv.v);return 1==this._a?"hsv("+h+", "+s+"%, "+v+"%)":"hsva("+h+", "+s+"%, "+v+"%, "+this._roundA+")"},toHsl:function(){var hsl=rgbToHsl(this._r,this._g,this._b);return{h:360*hsl.h,s:hsl.s,l:hsl.l,a:this._a}},toHslString:function(){var hsl=rgbToHsl(this._r,this._g,this._b),h=mathRound(360*hsl.h),s=mathRound(100*hsl.s),l=mathRound(100*hsl.l);return 1==this._a?"hsl("+h+", "+s+"%, "+l+"%)":"hsla("+h+", "+s+"%, "+l+"%, "+this._roundA+")"},toHex:function(allow3Char){return rgbToHex(this._r,this._g,this._b,allow3Char)},toHexString:function(allow3Char){return"#"+this.toHex(allow3Char)},toHex8:function(){return rgbaToHex(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:mathRound(this._r),g:mathRound(this._g),b:mathRound(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+mathRound(this._r)+", "+mathRound(this._g)+", "+mathRound(this._b)+")":"rgba("+mathRound(this._r)+", "+mathRound(this._g)+", "+mathRound(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:mathRound(100*bound01(this._r,255))+"%",g:mathRound(100*bound01(this._g,255))+"%",b:mathRound(100*bound01(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+mathRound(100*bound01(this._r,255))+"%, "+mathRound(100*bound01(this._g,255))+"%, "+mathRound(100*bound01(this._b,255))+"%)":"rgba("+mathRound(100*bound01(this._r,255))+"%, "+mathRound(100*bound01(this._g,255))+"%, "+mathRound(100*bound01(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1)},toFilter:function(secondColor){var hex8String="#"+rgbaToHex(this._r,this._g,this._b,this._a),secondHex8String=hex8String,gradientType=this._gradientType?"GradientType = 1, ":"";if(secondColor){secondHex8String=tinycolor(secondColor).toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+gradientType+"startColorstr="+hex8String+",endColorstr="+secondHex8String+")"},toString:function(format){var formatSet=!!format;format=format||this._format;var formattedString=!1,hasAlpha=this._a<1&&this._a>=0;return formatSet||!hasAlpha||"hex"!==format&&"hex6"!==format&&"hex3"!==format&&"name"!==format?("rgb"===format&&(formattedString=this.toRgbString()),"prgb"===format&&(formattedString=this.toPercentageRgbString()),"hex"!==format&&"hex6"!==format||(formattedString=this.toHexString()),"hex3"===format&&(formattedString=this.toHexString(!0)),"hex8"===format&&(formattedString=this.toHex8String()),"name"===format&&(formattedString=this.toName()),"hsl"===format&&(formattedString=this.toHslString()),"hsv"===format&&(formattedString=this.toHsvString()),formattedString||this.toHexString()):"name"===format&&0===this._a?this.toName():this.toRgbString()},_applyModification:function(fn,args){var color=fn.apply(null,[this].concat([].slice.call(args)));return this._r=color._r,this._g=color._g,this._b=color._b,this.setAlpha(color._a),this},lighten:function(){return this._applyModification(lighten,arguments)},brighten:function(){return this._applyModification(brighten,arguments)},darken:function(){return this._applyModification(darken,arguments)},desaturate:function(){return this._applyModification(desaturate,arguments)},saturate:function(){return this._applyModification(saturate,arguments)},greyscale:function(){return this._applyModification(greyscale,arguments)},spin:function(){return this._applyModification(spin,arguments)},_applyCombination:function(fn,args){return fn.apply(null,[this].concat([].slice.call(args)))},analogous:function(){return this._applyCombination(analogous,arguments)},complement:function(){return this._applyCombination(complement,arguments)},monochromatic:function(){return this._applyCombination(monochromatic,arguments)},splitcomplement:function(){return this._applyCombination(splitcomplement,arguments)},triad:function(){return this._applyCombination(triad,arguments)},tetrad:function(){return this._applyCombination(tetrad,arguments)}},tinycolor.fromRatio=function(color,opts){if("object"==typeof color){var newColor={};for(var i in color)color.hasOwnProperty(i)&&(newColor[i]="a"===i?color[i]:convertToPercentage(color[i]));color=newColor}return tinycolor(color,opts)},tinycolor.equals=function(color1,color2){return!(!color1||!color2)&&tinycolor(color1).toRgbString()==tinycolor(color2).toRgbString()},tinycolor.random=function(){return tinycolor.fromRatio({r:mathRandom(),g:mathRandom(),b:mathRandom()})},tinycolor.mix=function(color1,color2,amount){amount=0===amount?0:amount||50;var w1,rgb1=tinycolor(color1).toRgb(),rgb2=tinycolor(color2).toRgb(),p=amount/100,w=2*p-1,a=rgb2.a-rgb1.a,w2=1-(w1=((w1=w*a==-1?w:(w+a)/(1+w*a))+1)/2),rgba={r:rgb2.r*w1+rgb1.r*w2,g:rgb2.g*w1+rgb1.g*w2,b:rgb2.b*w1+rgb1.b*w2,a:rgb2.a*p+rgb1.a*(1-p)};return tinycolor(rgba)},tinycolor.readability=function(color1,color2){var c1=tinycolor(color1),c2=tinycolor(color2),rgb1=c1.toRgb(),rgb2=c2.toRgb(),brightnessA=c1.getBrightness(),brightnessB=c2.getBrightness(),colorDiff=Math.max(rgb1.r,rgb2.r)-Math.min(rgb1.r,rgb2.r)+Math.max(rgb1.g,rgb2.g)-Math.min(rgb1.g,rgb2.g)+Math.max(rgb1.b,rgb2.b)-Math.min(rgb1.b,rgb2.b);return{brightness:Math.abs(brightnessA-brightnessB),color:colorDiff}},tinycolor.isReadable=function(color1,color2){var readability=tinycolor.readability(color1,color2);return readability.brightness>125&&readability.color>500},tinycolor.mostReadable=function(baseColor,colorList){for(var bestColor=null,bestScore=0,bestIsReadable=!1,i=0;i<colorList.length;i++){var readability=tinycolor.readability(baseColor,colorList[i]),readable=readability.brightness>125&&readability.color>500,score=readability.brightness/125*3+readability.color/500;(readable&&!bestIsReadable||readable&&bestIsReadable&&score>bestScore||!readable&&!bestIsReadable&&score>bestScore)&&(bestIsReadable=readable,bestScore=score,bestColor=tinycolor(colorList[i]))}return bestColor};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=function(o){var flipped={};for(var i in o)o.hasOwnProperty(i)&&(flipped[o[i]]=i);return flipped}(names),matchers=function(){var CSS_UNIT="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",PERMISSIVE_MATCH3="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",PERMISSIVE_MATCH4="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?";return{rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hsva:new RegExp("hsva"+PERMISSIVE_MATCH4),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();window.tinycolor=tinycolor}(),$(function(){$.fn.spectrum.load&&$.fn.spectrum.processNativeColorInputs()})}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.i18next=e()}(this,function(){"use strict";function t(t){return null==t?"":""+t}function n(t,e,n){function o(t){return t&&t.indexOf("###")>-1?t.replace(/###/g,"."):t}for(var r="string"!=typeof e?[].concat(e):e.split(".");r.length>1;){if(!t)return{};var i=o(r.shift());!t[i]&&n&&(t[i]=new n),t=t[i]}return t?{obj:t,k:o(r.shift())}:{}}function o(t,e,o){var r=n(t,e,Object);r.obj[r.k]=o}function r(t,e,o,r){var i=n(t,e,Object),a=i.obj,s=i.k;a[s]=a[s]||[],r&&(a[s]=a[s].concat(o)),r||a[s].push(o)}function i(t,e){var o=n(t,e),r=o.obj,i=o.k;if(r)return r[i]}function a(t,e,n){for(var o in e)o in t?"string"==typeof t[o]||t[o]instanceof String||"string"==typeof e[o]||e[o]instanceof String?n&&(t[o]=e[o]):a(t[o],e[o],n):t[o]=e[o];return t}function s(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function u(t){return"string"==typeof t?t.replace(/[&<>"'\/]/g,function(t){return R[t]}):t}function l(t){return t.interpolation={unescapeSuffix:"HTML"},t.interpolation.prefix=t.interpolationPrefix||"__",t.interpolation.suffix=t.interpolationSuffix||"__",t.interpolation.escapeValue=t.escapeInterpolation||!1,t.interpolation.nestingPrefix=t.reusePrefix||"$t(",t.interpolation.nestingSuffix=t.reuseSuffix||")",t}function f(t){return(t.interpolationPrefix||t.interpolationSuffix||t.escapeInterpolation)&&(t=l(t)),t.nsSeparator=t.nsseparator,t.keySeparator=t.keyseparator,t.returnObjects=t.returnObjectTrees,t}function h(t){return t.charAt(0).toUpperCase()+t.slice(1)}function b(t){return"string"==typeof t.ns&&(t.ns=[t.ns]),"string"==typeof t.fallbackLng&&(t.fallbackLng=[t.fallbackLng]),"string"==typeof t.fallbackNS&&(t.fallbackNS=[t.fallbackNS]),t.whitelist&&t.whitelist.indexOf("cimode")<0&&t.whitelist.push("cimode"),t}function m(){}var x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k=(function(){function t(t){this.value=t}function e(e){function o(n,i){try{var a=e[n](i),s=a.value;s instanceof t?Promise.resolve(s.value).then(function(t){o("next",t)},function(t){o("throw",t)}):r(a.done?"return":"normal",a.value)}catch(t){r("throw",t)}}function r(t,e){switch(t){case"return":i.resolve({value:e,done:!0});break;case"throw":i.reject(e);break;default:i.resolve({value:e,done:!1})}(i=i.next)?o(i.key,i.arg):a=null}var i,a;this._invoke=function(t,e){return new Promise(function(n,r){var s={key:t,arg:e,resolve:n,reject:r,next:null};a?a=a.next=s:(i=a=s,o(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),S=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},w=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},O=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},N=function(){return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{!o&&s.return&&s.return()}finally{if(r)throw i}}return n}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),L={type:"logger",log:function(t){this._output("log",t)},warn:function(t){this._output("warn",t)},error:function(t){this._output("error",t)},_output:function(t,e){console&&console[t]&&console[t].apply(console,Array.prototype.slice.call(e))}},C=new(function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};k(this,t),this.init(e,n)}return t.prototype.init=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=e.prefix||"i18next:",this.logger=t||L,this.options=e,this.debug=!1!==e.debug},t.prototype.setDebug=function(t){this.debug=t},t.prototype.log=function(){this.forward(arguments,"log","",!0)},t.prototype.warn=function(){this.forward(arguments,"warn","",!0)},t.prototype.error=function(){this.forward(arguments,"error","")},t.prototype.deprecate=function(){this.forward(arguments,"warn","WARNING DEPRECATED: ",!0)},t.prototype.forward=function(t,e,n,o){o&&!this.debug||("string"==typeof t[0]&&(t[0]=n+this.prefix+" "+t[0]),this.logger[e](t))},t.prototype.create=function(e){return new t(this.logger,S({prefix:this.prefix+":"+e+":"},this.options))},t}()),P=function(){function t(){k(this,t),this.observers={}}return t.prototype.on=function(t,e){var n=this;t.split(" ").forEach(function(t){n.observers[t]=n.observers[t]||[],n.observers[t].push(e)})},t.prototype.off=function(t,e){var n=this;this.observers[t]&&this.observers[t].forEach(function(){if(e){var o=n.observers[t].indexOf(e);o>-1&&n.observers[t].splice(o,1)}else delete n.observers[t]})},t.prototype.emit=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];this.observers[t]&&this.observers[t].forEach(function(t){t.apply(void 0,n)}),this.observers["*"]&&this.observers["*"].forEach(function(e){var o;e.apply(e,(o=[t]).concat.apply(o,n))})},t}(),R={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},E=function(t){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};k(this,e);var r=O(this,t.call(this));return r.data=n,r.options=o,r}return w(e,t),e.prototype.addNamespaces=function(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)},e.prototype.removeNamespaces=function(t){var e=this.options.ns.indexOf(t);e>-1&&this.options.ns.splice(e,1)},e.prototype.getResource=function(t,e,n){var r=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).keySeparator||this.options.keySeparator;void 0===r&&(r=".");var a=[t,e];return n&&"string"!=typeof n&&(a=a.concat(n)),n&&"string"==typeof n&&(a=a.concat(r?n.split(r):n)),t.indexOf(".")>-1&&(a=t.split(".")),i(this.data,a)},e.prototype.addResource=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},a=this.options.keySeparator;void 0===a&&(a=".");var s=[t,e];n&&(s=s.concat(a?n.split(a):n)),t.indexOf(".")>-1&&(s=t.split("."),r=e,e=s[1]),this.addNamespaces(e),o(this.data,s,r),i.silent||this.emit("added",t,e,n,r)},e.prototype.addResources=function(t,e,n){for(var o in n)"string"==typeof n[o]&&this.addResource(t,e,o,n[o],{silent:!0});this.emit("added",t,e,n)},e.prototype.addResourceBundle=function(t,e,n,r,s){var u=[t,e];t.indexOf(".")>-1&&(u=t.split("."),r=n,n=e,e=u[1]),this.addNamespaces(e);var l=i(this.data,u)||{};r?a(l,n,s):l=S({},l,n),o(this.data,u,l),this.emit("added",t,e,n)},e.prototype.removeResourceBundle=function(t,e){this.hasResourceBundle(t,e)&&delete this.data[t][e],this.removeNamespaces(e),this.emit("removed",t,e)},e.prototype.hasResourceBundle=function(t,e){return void 0!==this.getResource(t,e)},e.prototype.getResourceBundle=function(t,e){return e||(e=this.options.defaultNS),"v1"===this.options.compatibilityAPI?S({},this.getResource(t,e)):this.getResource(t,e)},e.prototype.toJSON=function(){return this.data},e}(P),_={processors:{},addPostProcessor:function(t){this.processors[t.name]=t},handle:function(t,e,n,o,r){var i=this;return t.forEach(function(t){i.processors[t]&&(e=i.processors[t].process(e,n,o,r))}),e}},A=function(t){function n(o){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};k(this,n);var i=O(this,t.call(this));return function(t,e,n){t.forEach(function(t){e[t]&&(n[t]=e[t])})}(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector"],o,i),i.options=r,i.logger=C.create("translator"),i}return w(n,t),n.prototype.changeLanguage=function(t){t&&(this.language=t)},n.prototype.exists=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};return"v1"===this.options.compatibilityAPI&&(e=f(e)),void 0!==this.resolve(t,e)},n.prototype.extractFromKey=function(t,e){var n=e.nsSeparator||this.options.nsSeparator;void 0===n&&(n=":");var o=e.ns||this.options.defaultNS;if(n&&t.indexOf(n)>-1){var r=t.split(n);o=r[0],t=r[1]}return"string"==typeof o&&(o=[o]),{key:t,namespaces:o}},n.prototype.translate=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==(void 0===e?"undefined":x(e))?e=this.options.overloadTranslationOptionHandler(arguments):"v1"===this.options.compatibilityAPI&&(e=f(e)),void 0===t||null===t||""===t)return"";"number"==typeof t&&(t=String(t)),"string"==typeof t&&(t=[t]);var n=e.lng||this.language;if(n&&"cimode"===n.toLowerCase())return t[t.length-1];var o=e.keySeparator||this.options.keySeparator||".",r=this.extractFromKey(t[t.length-1],e),i=r.key,a=r.namespaces,s=a[a.length-1],u=this.resolve(t,e),l=Object.prototype.toString.apply(u),p=void 0!==e.joinArrays?e.joinArrays:this.options.joinArrays;if(u&&"string"!=typeof u&&["[object Number]","[object Function]","[object RegExp]"].indexOf(l)<0&&(!p||"[object Array]"!==l)){if(!e.returnObjects&&!this.options.returnObjects)return this.logger.warn("accessing an object - but returnObjects options is not enabled!"),this.options.returnedObjectHandler?this.options.returnedObjectHandler(i,u,e):"key '"+i+" ("+this.language+")' returned an object instead of string.";var g="[object Array]"===l?[]:{};for(var h in u)g[h]=this.translate(""+i+o+h,S({joinArrays:!1,ns:a},e));u=g}else if(p&&"[object Array]"===l)(u=u.join(p))&&(u=this.extendTranslation(u,i,e));else{var d=!1,v=!1;if(this.isValidLookup(u)||void 0===e.defaultValue||(d=!0,u=e.defaultValue),this.isValidLookup(u)||(v=!0,u=i),v||d){this.logger.log("missingKey",n,s,i,u);var y=[],b=this.languageUtils.getFallbackCodes(this.options.fallbackLng,e.lng||this.language);if("fallback"===this.options.saveMissingTo&&b&&b[0])for(var m=0;m<b.length;m++)y.push(b[m]);else"all"===this.options.saveMissingTo?y=this.languageUtils.toResolveHierarchy(e.lng||this.language):y.push(e.lng||this.language);this.options.saveMissing&&(this.options.missingKeyHandler?this.options.missingKeyHandler(y,s,i,u):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(y,s,i,u)),this.emit("missingKey",y,s,i,u)}u=this.extendTranslation(u,i,e),v&&u===i&&this.options.appendNamespaceToMissingKey&&(u=s+":"+i),v&&this.options.parseMissingKeyHandler&&(u=this.options.parseMissingKeyHandler(u))}return u},n.prototype.extendTranslation=function(t,e,n){var o=this;n.interpolation&&this.interpolator.init(S({},n,{interpolation:S({},this.options.interpolation,n.interpolation)}));var r=n.replace&&"string"!=typeof n.replace?n.replace:n;this.options.interpolation.defaultVariables&&(r=S({},this.options.interpolation.defaultVariables,r)),t=this.interpolator.interpolate(t,r,this.language),t=this.interpolator.nest(t,function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return o.translate.apply(o,e)},n),n.interpolation&&this.interpolator.reset();var i=n.postProcess||this.options.postProcess,a="string"==typeof i?[i]:i;return void 0!==t&&a&&a.length&&!1!==n.applyPostProcessor&&(t=_.handle(a,t,e,n,this)),t},n.prototype.resolve=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=void 0;return"string"==typeof t&&(t=[t]),t.forEach(function(t){if(!e.isValidLookup(o)){var r=e.extractFromKey(t,n),i=r.key,a=r.namespaces;e.options.fallbackNS&&(a=a.concat(e.options.fallbackNS));var s=void 0!==n.count&&"string"!=typeof n.count,u=void 0!==n.context&&"string"==typeof n.context&&""!==n.context,l=n.lngs?n.lngs:e.languageUtils.toResolveHierarchy(n.lng||e.language);a.forEach(function(t){e.isValidLookup(o)||l.forEach(function(r){if(!e.isValidLookup(o)){var a=i,l=[a],c=void 0;s&&(c=e.pluralResolver.getSuffix(r,n.count)),s&&u&&l.push(a+c),u&&l.push(a+=""+e.options.contextSeparator+n.context),s&&l.push(a+=c);for(var p=void 0;p=l.pop();)e.isValidLookup(o)||(o=e.getResource(r,t,p,n))}})})}}),o},n.prototype.isValidLookup=function(t){return!(void 0===t||!this.options.returnNull&&null===t||!this.options.returnEmptyString&&""===t)},n.prototype.getResource=function(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.resourceStore.getResource(t,e,n,o)},n}(P),M=function(){function t(e){k(this,t),this.options=e,this.whitelist=this.options.whitelist||!1,this.logger=C.create("languageUtils")}return t.prototype.getLanguagePartFromCode=function(t){if(t.indexOf("-")<0)return t;var n=t.split("-");return this.formatLanguageCode(["NB-NO","NN-NO","nb-NO","nn-NO","nb-no","nn-no"].indexOf(t)>-1?n[1].toLowerCase():n[0])},t.prototype.getScriptPartFromCode=function(t){if(t.indexOf("-")<0)return null;var e=t.split("-");return 2===e.length?null:(e.pop(),this.formatLanguageCode(e.join("-")))},t.prototype.getLanguagePartFromCode=function(t){if(t.indexOf("-")<0)return t;var n=t.split("-");return this.formatLanguageCode(["NB-NO","NN-NO","nb-NO","nn-NO","nb-no","nn-no"].indexOf(t)>-1?n[1].toLowerCase():n[0])},t.prototype.formatLanguageCode=function(t){if("string"==typeof t&&t.indexOf("-")>-1){var e=["hans","hant","latn","cyrl","cans","mong","arab"],n=t.split("-");return this.options.lowerCaseLng?n=n.map(function(t){return t.toLowerCase()}):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),e.indexOf(n[1].toLowerCase())>-1&&(n[1]=h(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),e.indexOf(n[1].toLowerCase())>-1&&(n[1]=h(n[1].toLowerCase())),e.indexOf(n[2].toLowerCase())>-1&&(n[2]=h(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t},t.prototype.isWhitelisted=function(t,e){return("languageOnly"===this.options.load||this.options.nonExplicitWhitelist&&!e)&&(t=this.getLanguagePartFromCode(t)),!this.whitelist||!this.whitelist.length||this.whitelist.indexOf(t)>-1},t.prototype.getFallbackCodes=function(t,e){if(!t)return[];if("string"==typeof t&&(t=[t]),"[object Array]"===Object.prototype.toString.apply(t))return t;var n=t[e];return n||(n=t[this.getScriptPartFromCode(e)]),n||(n=t[this.formatLanguageCode(e)]),n||(n=t.default),n||[]},t.prototype.toResolveHierarchy=function(t,e){var n=this,o=this.getFallbackCodes(e||this.options.fallbackLng||[],t),r=[],i=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&(n.isWhitelisted(t,e)?r.push(t):n.logger.warn("rejecting non-whitelisted language code: "+t))};return"string"==typeof t&&t.indexOf("-")>-1?("languageOnly"!==this.options.load&&i(this.formatLanguageCode(t),!0),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&i(this.getScriptPartFromCode(t),!0),"currentOnly"!==this.options.load&&i(this.getLanguagePartFromCode(t))):"string"==typeof t&&i(this.formatLanguageCode(t)),o.forEach(function(t){r.indexOf(t)<0&&i(n.formatLanguageCode(t))}),r},t}(),T=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","tg","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","es_ar","et","eu","fi","fo","fur","fy","gl","gu","ha","he","hi","hu","hy","ia","it","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt","pt_br","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","id","ja","jbo","ka","kk","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21}],H={1:function(t){return Number(t>1)},2:function(t){return Number(1!=t)},3:function(t){return 0},4:function(t){return Number(t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2)},5:function(t){return Number(0===t?0:1==t?1:2==t?2:t%100>=3&&t%100<=10?3:t%100>=11?4:5)},6:function(t){return Number(1==t?0:t>=2&&t<=4?1:2)},7:function(t){return Number(1==t?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2)},8:function(t){return Number(1==t?0:2==t?1:8!=t&&11!=t?2:3)},9:function(t){return Number(t>=2)},10:function(t){return Number(1==t?0:2==t?1:t<7?2:t<11?3:4)},11:function(t){return Number(1==t||11==t?0:2==t||12==t?1:t>2&&t<20?2:3)},12:function(t){return Number(t%10!=1||t%100==11)},13:function(t){return Number(0!==t)},14:function(t){return Number(1==t?0:2==t?1:3==t?2:3)},15:function(t){return Number(t%10==1&&t%100!=11?0:t%10>=2&&(t%100<10||t%100>=20)?1:2)},16:function(t){return Number(t%10==1&&t%100!=11?0:0!==t?1:2)},17:function(t){return Number(1==t||t%10==1?0:1)},18:function(t){return Number(0==t?0:1==t?1:2)},19:function(t){return Number(1==t?0:0===t||t%100>1&&t%100<11?1:t%100>10&&t%100<20?2:3)},20:function(t){return Number(1==t?0:0===t||t%100>0&&t%100<20?1:2)},21:function(t){return Number(t%100==1?1:t%100==2?2:t%100==3||t%100==4?3:0)}},V=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};k(this,t),this.languageUtils=e,this.options=n,this.logger=C.create("pluralResolver"),this.rules=function(){var t={};return T.forEach(function(e){e.lngs.forEach(function(n){return t[n]={numbers:e.nr,plurals:H[e.fc]}})}),t}()}return t.prototype.addRule=function(t,e){this.rules[t]=e},t.prototype.getRule=function(t){return this.rules[this.languageUtils.getLanguagePartFromCode(t)]},t.prototype.needsPlural=function(t){var e=this.getRule(t);return!(e&&e.numbers.length<=1)},t.prototype.getSuffix=function(t,e){var n=this,o=this.getRule(t);if(!o)return this.logger.warn("no plural rule found for: "+t),"";var r=function(){if(1===o.numbers.length)return{v:""};var t=o.noAbs?o.plurals(e):o.plurals(Math.abs(e)),r=o.numbers[t];2===o.numbers.length&&1===o.numbers[0]&&(2===r?r="plural":1===r&&(r=""));var i=function(){return n.options.prepend&&r.toString()?n.options.prepend+r.toString():r.toString()};return"v1"===n.options.compatibilityJSON?1===r?{v:""}:"number"==typeof r?{v:"_plural_"+r.toString()}:{v:i()}:"v2"===n.options.compatibilityJSON||2===o.numbers.length&&1===o.numbers[0]?{v:i()}:2===o.numbers.length&&1===o.numbers[0]?{v:i()}:{v:n.options.prepend&&t.toString()?n.options.prepend+t.toString():t.toString()}}();return"object"===(void 0===r?"undefined":x(r))?r.v:void 0},t}(),U=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};k(this,e),this.logger=C.create("interpolator"),this.init(t,!0)}return e.prototype.init=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};arguments[1]&&(this.options=t,this.format=t.interpolation&&t.interpolation.format||function(t){return t},this.escape=t.interpolation&&t.interpolation.escape||u),t.interpolation||(t.interpolation={escapeValue:!0});var n=t.interpolation;this.escapeValue=void 0===n.escapeValue||n.escapeValue,this.prefix=n.prefix?s(n.prefix):n.prefixEscaped||"{{",this.suffix=n.suffix?s(n.suffix):n.suffixEscaped||"}}",this.formatSeparator=n.formatSeparator?s(n.formatSeparator):n.formatSeparator||",",this.unescapePrefix=n.unescapeSuffix?"":n.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":n.unescapeSuffix||"",this.nestingPrefix=n.nestingPrefix?s(n.nestingPrefix):n.nestingPrefixEscaped||s("$t("),this.nestingSuffix=n.nestingSuffix?s(n.nestingSuffix):n.nestingSuffixEscaped||s(")"),this.resetRegExp()},e.prototype.reset=function(){this.options&&this.init(this.options)},e.prototype.resetRegExp=function(){var t=this.prefix+"(.+?)"+this.suffix;this.regexp=new RegExp(t,"g");var e=this.prefix+this.unescapePrefix+"(.+?)"+this.unescapeSuffix+this.suffix;this.regexpUnescape=new RegExp(e,"g");var n=this.nestingPrefix+"(.+?)"+this.nestingSuffix;this.nestingRegexp=new RegExp(n,"g")},e.prototype.interpolate=function(e,n,o){function r(t){return t.replace(/\$/g,"$$$$")}var a=this,s=void 0,u=void 0,l=function(t){if(t.indexOf(a.formatSeparator)<0)return i(n,t);var e=t.split(a.formatSeparator),r=e.shift().trim(),s=e.join(a.formatSeparator).trim();return a.format(i(n,r),s,o)};for(this.resetRegExp();s=this.regexpUnescape.exec(e);){var c=l(s[1].trim());e=e.replace(s[0],c),this.regexpUnescape.lastIndex=0}for(;s=this.regexp.exec(e);)"string"!=typeof(u=l(s[1].trim()))&&(u=t(u)),u||(this.logger.warn("missed to pass in variable "+s[1]+" for interpolating "+e),u=""),u=r(this.escapeValue?this.escape(u):u),e=e.replace(s[0],u),this.regexp.lastIndex=0;return e},e.prototype.nest=function(e,n){function o(t){return t.replace(/\$/g,"$$$$")}function r(t){if(t.indexOf(",")<0)return t;var e=t.split(",");t=e.shift();var n=e.join(",");n=(n=this.interpolate(n,l)).replace(/'/g,'"');try{l=JSON.parse(n)}catch(e){this.logger.error("failed parsing options string in nesting for key "+t,e)}return t}var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=void 0,s=void 0,l=JSON.parse(JSON.stringify(i));for(l.applyPostProcessor=!1;a=this.nestingRegexp.exec(e);)"string"!=typeof(s=n(r.call(this,a[1].trim()),l))&&(s=t(s)),s||(this.logger.warn("missed to pass in variable "+a[1]+" for interpolating "+e),s=""),s=o(this.escapeValue?u(s):s),e=e.replace(a[0],s),this.regexp.lastIndex=0;return e},e}(),F=function(t){function e(n,o,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};k(this,e);var a=O(this,t.call(this));return a.backend=n,a.store=o,a.services=r,a.options=i,a.logger=C.create("backendConnector"),a.state={},a.queue=[],a.backend&&a.backend.init&&a.backend.init(r,i.backend,i),a}return w(e,t),e.prototype.queueLoad=function(t,e,n){var o=this,r=[],i=[],a=[],s=[];return t.forEach(function(t){var n=!0;e.forEach(function(e){var a=t+"|"+e;o.store.hasResourceBundle(t,e)?o.state[a]=2:o.state[a]<0||(1===o.state[a]?i.indexOf(a)<0&&i.push(a):(o.state[a]=1,n=!1,i.indexOf(a)<0&&i.push(a),r.indexOf(a)<0&&r.push(a),s.indexOf(e)<0&&s.push(e)))}),n||a.push(t)}),(r.length||i.length)&&this.queue.push({pending:i,loaded:{},errors:[],callback:n}),{toLoad:r,pending:i,toLoadLanguages:a,toLoadNamespaces:s}},e.prototype.loaded=function(t,e,n){var o=this,i=t.split("|"),a=N(i,2),s=a[0],u=a[1];e&&this.emit("failedLoading",s,u,e),n&&this.store.addResourceBundle(s,u,n),this.state[t]=e?-1:2,this.queue.forEach(function(n){r(n.loaded,[s],u),function(t,e){for(var n=t.indexOf(e);-1!==n;)t.splice(n,1),n=t.indexOf(e)}(n.pending,t),e&&n.errors.push(e),0!==n.pending.length||n.done||(o.emit("loaded",n.loaded),n.errors.length?n.callback(n.errors):n.callback(),n.done=!0)}),this.queue=this.queue.filter(function(t){return!t.done})},e.prototype.read=function(t,e,n,o,r,i){var a=this;return o||(o=0),r||(r=250),t.length?void this.backend[n](t,e,function(s,u){return s&&u&&o<5?void setTimeout(function(){a.read.call(a,t,e,n,++o,2*r,i)},r):void i(s,u)}):i(null,{})},e.prototype.load=function(t,e,n){var o=this;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();var r=S({},this.backend.options,this.options.backend);"string"==typeof t&&(t=this.services.languageUtils.toResolveHierarchy(t)),"string"==typeof e&&(e=[e]);var a=this.queueLoad(t,e,n);return a.toLoad.length?void(r.allowMultiLoading&&this.backend.readMulti?this.read(a.toLoadLanguages,a.toLoadNamespaces,"readMulti",null,null,function(t,e){t&&o.logger.warn("loading namespaces "+a.toLoadNamespaces.join(", ")+" for languages "+a.toLoadLanguages.join(", ")+" via multiloading failed",t),!t&&e&&o.logger.log("loaded namespaces "+a.toLoadNamespaces.join(", ")+" for languages "+a.toLoadLanguages.join(", ")+" via multiloading",e),a.toLoad.forEach(function(n){var r=n.split("|"),a=N(r,2),s=a[0],u=a[1],l=i(e,[s,u]);if(l)o.loaded(n,t,l);else{var c="loading namespace "+u+" for language "+s+" via multiloading failed";o.loaded(n,c),o.logger.error(c)}})}):a.toLoad.forEach(function(e){(function(t){var e=this,n=t.split("|"),o=N(n,2),r=o[0],i=o[1];this.read(r,i,"read",null,null,function(n,o){n&&e.logger.warn("loading namespace "+i+" for language "+r+" failed",n),!n&&o&&e.logger.log("loaded namespace "+i+" for language "+r,o),e.loaded(t,n,o)})}).call(o,e)})):void(a.pending.length||n())},e.prototype.reload=function(t,e){var n=this;this.backend||this.logger.warn("No backend was added via i18next.use. Will not load resources.");var o=S({},this.backend.options,this.options.backend);"string"==typeof t&&(t=this.services.languageUtils.toResolveHierarchy(t)),"string"==typeof e&&(e=[e]),o.allowMultiLoading&&this.backend.readMulti?this.read(t,e,"readMulti",null,null,function(o,r){o&&n.logger.warn("reloading namespaces "+e.join(", ")+" for languages "+t.join(", ")+" via multiloading failed",o),!o&&r&&n.logger.log("reloaded namespaces "+e.join(", ")+" for languages "+t.join(", ")+" via multiloading",r),t.forEach(function(t){e.forEach(function(e){var a=i(r,[t,e]);if(a)n.loaded(t+"|"+e,o,a);else{var s="reloading namespace "+e+" for language "+t+" via multiloading failed";n.loaded(t+"|"+e,s),n.logger.error(s)}})})}):t.forEach(function(t){e.forEach(function(e){(function(t){var e=this,n=t.split("|"),o=N(n,2),r=o[0],i=o[1];this.read(r,i,"read",null,null,function(n,o){n&&e.logger.warn("reloading namespace "+i+" for language "+r+" failed",n),!n&&o&&e.logger.log("reloaded namespace "+i+" for language "+r,o),e.loaded(t,n,o)})}).call(n,t+"|"+e)})})},e.prototype.saveMissing=function(t,e,n,o){this.backend&&this.backend.create&&this.backend.create(t,e,n,o),t&&t[0]&&this.store.addResource(t[0],e,n,o)},e}(P),I=function(t){function e(n,o,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};k(this,e);var a=O(this,t.call(this));return a.cache=n,a.store=o,a.services=r,a.options=i,a.logger=C.create("cacheConnector"),a.cache&&a.cache.init&&a.cache.init(r,i.cache,i),a}return w(e,t),e.prototype.load=function(t,e,n){var o=this;if(!this.cache)return n&&n();var r=S({},this.cache.options,this.options.cache);"string"==typeof t&&(t=this.services.languageUtils.toResolveHierarchy(t)),"string"==typeof e&&(e=[e]),r.enabled?this.cache.load(t,function(e,r){if(e&&o.logger.error("loading languages "+t.join(", ")+" from cache failed",e),r)for(var i in r)for(var a in r[i])if("i18nStamp"!==a){var s=r[i][a];s&&o.store.addResourceBundle(i,a,s)}n&&n()}):n&&n()},e.prototype.save=function(){this.cache&&this.options.cache&&this.options.cache.enabled&&this.cache.save(this.store.data)},e}(P);return new(function(t){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments[1];k(this,e);var r=O(this,t.call(this));return r.options=b(n),r.services={},r.logger=C,r.modules={},o&&!r.isInitialized&&r.init(n,o),r}return w(e,t),e.prototype.init=function(t,e){function n(t){if(t)return"function"==typeof t?new t:t}var o=this;if("function"==typeof t&&(e=t,t={}),t||(t={}),"v1"===t.compatibilityAPI?this.options=S({},{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,load:"all",preload:!1,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",saveMissing:!1,saveMissingTo:"fallback",missingKeyHandler:!1,postProcess:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:function(){},parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,overloadTranslationOptionHandler:function(t){return{defaultValue:t[1]}},interpolation:{escapeValue:!0,format:function(t,e,n){return t},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",defaultVariables:void 0}},b(function(t){return t.resStore&&(t.resources=t.resStore),t.ns&&t.ns.defaultNs?(t.defaultNS=t.ns.defaultNs,t.ns=t.ns.namespaces):t.defaultNS=t.ns||"translation",t.fallbackToDefaultNS&&t.defaultNS&&(t.fallbackNS=t.defaultNS),t.saveMissing=t.sendMissing,t.saveMissingTo=t.sendMissingTo||"current",t.returnNull=!t.fallbackOnNull,t.returnEmptyString=!t.fallbackOnEmpty,t.returnObjects=t.returnObjectTrees,t.joinArrays="\n",t.returnedObjectHandler=t.objectTreeKeyHandler,t.parseMissingKeyHandler=t.parseMissingKey,t.appendNamespaceToMissingKey=!0,t.nsSeparator=t.nsseparator,t.keySeparator=t.keyseparator,"sprintf"===t.shortcutFunction&&(t.overloadTranslationOptionHandler=function(t){for(var e=[],n=1;n<t.length;n++)e.push(t[n]);return{postProcess:"sprintf",sprintf:e}}),t.whitelist=t.lngWhitelist,t.preload=t.preload,"current"===t.load&&(t.load="currentOnly"),"unspecific"===t.load&&(t.load="languageOnly"),t.backend=t.backend||{},t.backend.loadPath=t.resGetPath||"locales/__lng__/__ns__.json",t.backend.addPath=t.resPostPath||"locales/add/__lng__/__ns__",t.backend.allowMultiLoading=t.dynamicLoad,t.cache=t.cache||{},t.cache.prefix="res_",t.cache.expirationTime=6048e5,t.cache.enabled=!!t.useLocalStorage,(t=l(t)).defaultVariables&&(t.interpolation.defaultVariables=t.defaultVariables),t}(t)),{}):"v1"===t.compatibilityJSON?this.options=S({},{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,load:"all",preload:!1,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",saveMissing:!1,saveMissingTo:"fallback",missingKeyHandler:!1,postProcess:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:function(){},parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,overloadTranslationOptionHandler:function(t){return{defaultValue:t[1]}},interpolation:{escapeValue:!0,format:function(t,e,n){return t},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",defaultVariables:void 0}},b(function(t){return t=l(t),t.joinArrays="\n",t}(t)),{}):this.options=S({},{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,load:"all",preload:!1,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",saveMissing:!1,saveMissingTo:"fallback",missingKeyHandler:!1,postProcess:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:function(){},parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,overloadTranslationOptionHandler:function(t){return{defaultValue:t[1]}},interpolation:{escapeValue:!0,format:function(t,e,n){return t},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",defaultVariables:void 0}},this.options,b(t)),e||(e=m),!this.options.isClone){this.modules.logger?C.init(n(this.modules.logger),this.options):C.init(null,this.options);var r=new M(this.options);this.store=new E(this.options.resources,this.options);var i=this.services;i.logger=C,i.resourceStore=this.store,i.resourceStore.on("added removed",function(t,e){i.cacheConnector.save()}),i.languageUtils=r,i.pluralResolver=new V(r,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON}),i.interpolator=new U(this.options),i.backendConnector=new F(n(this.modules.backend),i.resourceStore,i,this.options),i.backendConnector.on("*",function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];o.emit.apply(o,[t].concat(n))}),i.backendConnector.on("loaded",function(t){i.cacheConnector.save()}),i.cacheConnector=new I(n(this.modules.cache),i.resourceStore,i,this.options),i.cacheConnector.on("*",function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];o.emit.apply(o,[t].concat(n))}),this.modules.languageDetector&&(i.languageDetector=n(this.modules.languageDetector),i.languageDetector.init(i,this.options.detection,this.options)),this.translator=new A(this.services,this.options),this.translator.on("*",function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];o.emit.apply(o,[t].concat(n))})}["getResource","addResource","addResources","addResourceBundle","removeResourceBundle","hasResourceBundle","getResourceBundle"].forEach(function(t){o[t]=function(){return this.store[t].apply(this.store,arguments)}}),"v1"===this.options.compatibilityAPI&&function(t){t.lng=function(){return C.deprecate("i18next.lng() can be replaced by i18next.language for detected language or i18next.languages for languages ordered by translation lookup."),t.services.languageUtils.toResolveHierarchy(t.language)[0]},t.preload=function(e,n){C.deprecate("i18next.preload() can be replaced with i18next.loadLanguages()"),t.loadLanguages(e,n)},t.setLng=function(e,n,o){return C.deprecate("i18next.setLng() can be replaced with i18next.changeLanguage() or i18next.getFixedT() to get a translation function with fixed language or namespace."),"function"==typeof n&&(o=n,n={}),n||(n={}),!0===n.fixLng&&o?o(null,t.getFixedT(e)):void t.changeLanguage(e,o)},t.addPostProcessor=function(e,n){C.deprecate("i18next.addPostProcessor() can be replaced by i18next.use({ type: 'postProcessor', name: 'name', process: fc })"),t.use({type:"postProcessor",name:e,process:n})}}(this);var s=function(){o.changeLanguage(o.options.lng,function(t,n){o.isInitialized=!0,o.emit("initialized",o.options),o.logger.log("initialized",o.options),e(t,n)})};return this.options.resources||!this.options.initImmediate?s():setTimeout(s,0),this},e.prototype.loadResources=function(t){var e=this;if(t||(t=m),this.options.resources)t(null);else{var n=function(){if(e.language&&"cimode"===e.language.toLowerCase())return{v:t()};var n=[],o=function(t){e.services.languageUtils.toResolveHierarchy(t).forEach(function(t){n.indexOf(t)<0&&n.push(t)})};o(e.language),e.options.preload&&e.options.preload.forEach(function(t){o(t)}),e.services.cacheConnector.load(n,e.options.ns,function(){e.services.backendConnector.load(n,e.options.ns,t)})}();if("object"===(void 0===n?"undefined":x(n)))return n.v}},e.prototype.reloadResources=function(t,e){t||(t=this.languages),e||(e=this.options.ns),this.services.backendConnector.reload(t,e)},e.prototype.use=function(t){return"backend"===t.type&&(this.modules.backend=t),"cache"===t.type&&(this.modules.cache=t),("logger"===t.type||t.log&&t.warn&&t.warn)&&(this.modules.logger=t),"languageDetector"===t.type&&(this.modules.languageDetector=t),"postProcessor"===t.type&&_.addPostProcessor(t),this},e.prototype.changeLanguage=function(t,e){var n=this,o=function(o){t&&(n.emit("languageChanged",t),n.logger.log("languageChanged",t)),e&&e(o,function(){for(var t=arguments.length,e=Array(t),o=0;o<t;o++)e[o]=arguments[o];return n.t.apply(n,e)})};!t&&this.services.languageDetector&&(t=this.services.languageDetector.detect()),t&&(this.language=t,this.languages=this.services.languageUtils.toResolveHierarchy(t),this.translator.changeLanguage(t),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage(t)),this.loadResources(function(t){o(t)})},e.prototype.getFixedT=function(t,e){var n=this,o=function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=S({},o);return r.lng=r.lng||t.lng,r.ns=r.ns||t.ns,n.t(e,r)};return o.lng=t,o.ns=e,o},e.prototype.t=function(){return this.translator&&this.translator.translate.apply(this.translator,arguments)},e.prototype.exists=function(){return this.translator&&this.translator.exists.apply(this.translator,arguments)},e.prototype.setDefaultNamespace=function(t){this.options.defaultNS=t},e.prototype.loadNamespaces=function(t,e){var n=this;return this.options.ns?("string"==typeof t&&(t=[t]),t.forEach(function(t){n.options.ns.indexOf(t)<0&&n.options.ns.push(t)}),void this.loadResources(e)):e&&e()},e.prototype.loadLanguages=function(t,e){"string"==typeof t&&(t=[t]);var n=this.options.preload||[],o=t.filter(function(t){return n.indexOf(t)<0});return o.length?(this.options.preload=n.concat(o),void this.loadResources(e)):e()},e.prototype.dir=function(t){if(t||(t=this.language),!t)return"rtl";return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"].indexOf(this.services.languageUtils.getLanguagePartFromCode(t))>=0?"rtl":"ltr"},e.prototype.createInstance=function(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments[1])},e.prototype.cloneInstance=function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments[1],r=new e(S({},n,this.options,{isClone:!0}),o);return["store","services","language"].forEach(function(e){r[e]=t[e]}),r.translator=new A(r.services,r.options),r.translator.on("*",function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];r.emit.apply(r,[t].concat(n))}),r},e}(P))}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.i18nextBrowserLanguageDetector=t()}(this,function(){"use strict";function e(e){return a.call(i.call(arguments,1),function(t){if(t)for(var o in t)void 0===e[o]&&(e[o]=t[o])}),e}var o={};o.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o.createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}();var n=[],a=n.forEach,i=n.slice,r_create=function(e,t,o,n){var a=void 0;if(o){var i=new Date;i.setTime(i.getTime()+60*o*1e3),a="; expires="+i.toGMTString()}else a="";n=n?"domain="+n+";":"",document.cookie=e+"="+t+a+";"+n+"path=/"},r_read=function(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var a=o[n];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return a.substring(t.length,a.length)}return null},u={name:"cookie",lookup:function(e){var t=void 0;if(e.lookupCookie&&"undefined"!=typeof document){var o=r_read(e.lookupCookie);o&&(t=o)}return t},cacheUserLanguage:function(e,t){t.lookupCookie&&"undefined"!=typeof document&&r_create(t.lookupCookie,e,t.cookieMinutes,t.cookieDomain)}},c={name:"querystring",lookup:function(e){var t=void 0;if("undefined"!=typeof window)for(var o=window.location.search.substring(1),n=o.split("&"),a=0;a<n.length;a++){var i=n[a].indexOf("=");if(i>0){n[a].substring(0,i)===e.lookupQuerystring&&(t=n[a].substring(i+1))}}return t}},l=void 0;try{l="undefined"!==window&&null!==window.localStorage;var s="i18next.translate.boo";window.localStorage.setItem(s,"foo"),window.localStorage.removeItem(s)}catch(g){l=!1}var f={name:"localStorage",lookup:function(e){var t=void 0;if(e.lookupLocalStorage&&l){var o=window.localStorage.getItem(e.lookupLocalStorage);o&&(t=o)}return t},cacheUserLanguage:function(e,t){t.lookupLocalStorage&&l&&window.localStorage.setItem(t.lookupLocalStorage,e)}},d={name:"navigator",lookup:function(e){var t=[];if("undefined"!=typeof navigator){if(navigator.languages)for(var o=0;o<navigator.languages.length;o++)t.push(navigator.languages[o]);navigator.userLanguage&&t.push(navigator.userLanguage),navigator.language&&t.push(navigator.language)}return t.length>0?t:void 0}},v={name:"htmlTag",lookup:function(e){var t=void 0,o=e.htmlTag||("undefined"!=typeof document?document.documentElement:null);return o&&"function"==typeof o.getAttribute&&(t=o.getAttribute("lang")),t}},h=function(){function n(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];o.classCallCheck(this,n),this.type="languageDetector",this.detectors={},this.init(e,t)}return o.createClass(n,[{key:"init",value:function(o){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];this.services=o,this.options=e(n,this.options||{},{order:["querystring","cookie","localStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",caches:["localStorage"]}),this.i18nOptions=a,this.addDetector(u),this.addDetector(c),this.addDetector(f),this.addDetector(d),this.addDetector(v)}},{key:"addDetector",value:function(e){this.detectors[e.name]=e}},{key:"detect",value:function(e){var t=this;e||(e=this.options.order);var o=[];e.forEach(function(e){if(t.detectors[e]){var n=t.detectors[e].lookup(t.options);n&&"string"==typeof n&&(n=[n]),n&&(o=o.concat(n))}});var n=void 0;return o.forEach(function(e){if(!n){var o=t.services.languageUtils.formatLanguageCode(e);t.services.languageUtils.isWhitelisted(o)&&(n=o)}}),n||this.i18nOptions.fallbackLng[0]}},{key:"cacheUserLanguage",value:function(e,t){var o=this;t||(t=this.options.caches),t&&t.forEach(function(t){o.detectors[t]&&o.detectors[t].cacheUserLanguage(e,o.options)})}}]),n}();return h.type="languageDetector",h}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.i18nextXHRBackend=e()}(this,function(){"use strict";function e(t,e){if(e&&"object"===(void 0===e?"undefined":l(e))){var n="",o=encodeURIComponent;for(var i in e)n+="&"+o(i)+"="+o(e[i]);if(!n)return t;t=t+(-1!==t.indexOf("?")?"&":"?")+n.slice(1)}return t}function n(t,n,o,i,a){i&&"object"===(void 0===i?"undefined":l(i))&&(a||(i._t=new Date),i=e("",i).slice(1)),n.queryStringParams&&(t=e(t,n.queryStringParams));try{var r;(r=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0")).open(i?"POST":"GET",t,1),n.crossDomain||r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.withCredentials=!!n.withCredentials,i&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.overrideMimeType&&r.overrideMimeType("application/json");var s=n.customHeaders;if(s)for(var u in s)r.setRequestHeader(u,s[u]);r.onreadystatechange=function(){r.readyState>3&&o&&o(r.responseText,r)},r.send(i)}catch(t){console&&console.log(t)}}function i(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"locales/add/{{lng}}/{{ns}}",allowMultiLoading:!1,parse:JSON.parse,crossDomain:!1,ajax:n}}var a=[],r=a.forEach,s=a.slice,l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,e),this.init(t,n),this.type="backend"}return u(e,[{key:"init",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.services=e,this.options=function(t){return r.call(s.call(arguments,1),function(e){if(e)for(var n in e)void 0===t[n]&&(t[n]=e[n])}),t}(n,this.options||{},i())}},{key:"readMulti",value:function(t,e,n){var o=this.options.loadPath;"function"==typeof this.options.loadPath&&(o=this.options.loadPath(t,e));var i=this.services.interpolator.interpolate(o,{lng:t.join("+"),ns:e.join("+")});this.loadUrl(i,n)}},{key:"read",value:function(t,e,n){var o=this.options.loadPath;"function"==typeof this.options.loadPath&&(o=this.options.loadPath([t],[e]));var i=this.services.interpolator.interpolate(o,{lng:t,ns:e});this.loadUrl(i,n)}},{key:"loadUrl",value:function(t,e){var n=this;this.options.ajax(t,this.options,function(o,i){if(i.status>=500&&i.status<600)return e("failed loading "+t,!0);if(i.status>=400&&i.status<500)return e("failed loading "+t,!1);var a=void 0,r=void 0;try{a=n.options.parse(o,t)}catch(e){r="failed parsing "+t+" to json"}if(r)return e(r,!1);e(null,a)})}},{key:"create",value:function(t,e,n,o){var i=this;"string"==typeof t&&(t=[t]);var a={};a[n]=o||"",t.forEach(function(t){var n=i.services.interpolator.interpolate(i.options.addPath,{lng:t,ns:e});i.options.ajax(n,i.options,function(t,e){},a)})}}]),e}();return c.type="backend",c}),function($){var methods={init:function(options){var o=$.extend({items:1,itemsOnPage:1,pages:0,displayedPages:5,edges:2,currentPage:0,hrefTextPrefix:"#page-",hrefTextSuffix:"",prevText:"Prev",nextText:"Next",ellipseText:"&hellip;",ellipsePageSet:!0,cssStyle:"light-theme",listStyle:"",labelMap:[],selectOnClick:!0,nextAtFront:!1,invertPageOrder:!1,useStartEdge:!0,useEndEdge:!0,onPageClick:function(pageNumber,event){},onInit:function(){}},options||{}),self=this;return o.pages=o.pages?o.pages:Math.ceil(o.items/o.itemsOnPage)?Math.ceil(o.items/o.itemsOnPage):1,o.currentPage?o.currentPage=o.currentPage-1:o.currentPage=o.invertPageOrder?o.pages-1:0,o.halfDisplayed=o.displayedPages/2,this.each(function(){self.addClass(o.cssStyle+" simple-pagination").data("pagination",o),methods._draw.call(self)}),o.onInit(),this},selectPage:function(page){return methods._selectPage.call(this,page-1),this},prevPage:function(){var o=this.data("pagination");return o.invertPageOrder?o.currentPage<o.pages-1&&methods._selectPage.call(this,o.currentPage+1):o.currentPage>0&&methods._selectPage.call(this,o.currentPage-1),this},nextPage:function(){var o=this.data("pagination");return o.invertPageOrder?o.currentPage>0&&methods._selectPage.call(this,o.currentPage-1):o.currentPage<o.pages-1&&methods._selectPage.call(this,o.currentPage+1),this},getPagesCount:function(){return this.data("pagination").pages},setPagesCount:function(count){this.data("pagination").pages=count},getCurrentPage:function(){return this.data("pagination").currentPage+1},destroy:function(){return this.empty(),this},drawPage:function(page){var o=this.data("pagination");return o.currentPage=page-1,this.data("pagination",o),methods._draw.call(this),this},redraw:function(){return methods._draw.call(this),this},disable:function(){var o=this.data("pagination");return o.disabled=!0,this.data("pagination",o),methods._draw.call(this),this},enable:function(){var o=this.data("pagination");return o.disabled=!1,this.data("pagination",o),methods._draw.call(this),this},updateItems:function(newItems){var o=this.data("pagination");o.items=newItems,o.pages=methods._getPages(o),this.data("pagination",o),methods._draw.call(this)},updateItemsOnPage:function(itemsOnPage){var o=this.data("pagination");return o.itemsOnPage=itemsOnPage,o.pages=methods._getPages(o),this.data("pagination",o),methods._selectPage.call(this,0),this},getItemsOnPage:function(){return this.data("pagination").itemsOnPage},_draw:function(){var i,tagName,o=this.data("pagination"),interval=methods._getInterval(o);methods.destroy.call(this);var $panel="UL"===(tagName="function"==typeof this.prop?this.prop("tagName"):this.attr("tagName"))?this:$("<ul"+(o.listStyle?' class="'+o.listStyle+'"':"")+"></ul>").appendTo(this);if(o.prevText&&methods._appendItem.call(this,o.invertPageOrder?o.currentPage+1:o.currentPage-1,{text:o.prevText,classes:"prev"}),o.nextText&&o.nextAtFront&&methods._appendItem.call(this,o.invertPageOrder?o.currentPage-1:o.currentPage+1,{text:o.nextText,classes:"next"}),o.invertPageOrder){if(interval.end<o.pages&&o.edges>0){if(o.useStartEdge){begin=Math.max(o.pages-o.edges,interval.end);for(i=o.pages-1;i>=begin;i--)methods._appendItem.call(this,i)}o.pages-o.edges>interval.end&&o.pages-o.edges-interval.end!=1?$panel.append('<li class="disabled"><span class="ellipse">'+o.ellipseText+"</span></li>"):o.pages-o.edges-interval.end==1&&methods._appendItem.call(this,interval.end)}}else if(interval.start>0&&o.edges>0){if(o.useStartEdge){end=Math.min(o.edges,interval.start);for(i=0;i<end;i++)methods._appendItem.call(this,i)}o.edges<interval.start&&interval.start-o.edges!=1?$panel.append('<li class="disabled"><span class="ellipse">'+o.ellipseText+"</span></li>"):interval.start-o.edges==1&&methods._appendItem.call(this,o.edges)}if(o.invertPageOrder)for(i=interval.end-1;i>=interval.start;i--)methods._appendItem.call(this,i);else for(i=interval.start;i<interval.end;i++)methods._appendItem.call(this,i);if(o.invertPageOrder){if(interval.start>0&&o.edges>0&&(o.edges<interval.start&&interval.start-o.edges!=1?$panel.append('<li class="disabled"><span class="ellipse">'+o.ellipseText+"</span></li>"):interval.start-o.edges==1&&methods._appendItem.call(this,o.edges),o.useEndEdge)){var end;for(i=(end=Math.min(o.edges,interval.start))-1;i>=0;i--)methods._appendItem.call(this,i)}}else if(interval.end<o.pages&&o.edges>0&&(o.pages-o.edges>interval.end&&o.pages-o.edges-interval.end!=1?$panel.append('<li class="disabled"><span class="ellipse">'+o.ellipseText+"</span></li>"):o.pages-o.edges-interval.end==1&&methods._appendItem.call(this,interval.end),o.useEndEdge)){var begin;for(i=begin=Math.max(o.pages-o.edges,interval.end);i<o.pages;i++)methods._appendItem.call(this,i)}o.nextText&&!o.nextAtFront&&methods._appendItem.call(this,o.invertPageOrder?o.currentPage-1:o.currentPage+1,{text:o.nextText,classes:"next"}),o.ellipsePageSet&&!o.disabled&&methods._ellipseClick.call(this,$panel)},_getPages:function(o){return Math.ceil(o.items/o.itemsOnPage)||1},_getInterval:function(o){return{start:Math.ceil(o.currentPage>o.halfDisplayed?Math.max(Math.min(o.currentPage-o.halfDisplayed,o.pages-o.displayedPages),0):0),end:Math.ceil(o.currentPage>o.halfDisplayed?Math.min(o.currentPage+o.halfDisplayed,o.pages):Math.min(o.displayedPages,o.pages))}},_appendItem:function(pageIndex,opts){var options,$link,self=this,o=self.data("pagination"),$linkWrapper=$("<li></li>"),$ul=self.find("ul");options={text:(pageIndex=pageIndex<0?0:pageIndex<o.pages?pageIndex:o.pages-1)+1,classes:""},o.labelMap.length&&o.labelMap[pageIndex]&&(options.text=o.labelMap[pageIndex]),options=$.extend(options,opts||{}),pageIndex==o.currentPage||o.disabled?(o.disabled||"prev"===options.classes||"next"===options.classes?$linkWrapper.addClass("disabled"):$linkWrapper.addClass("active"),$link=$('<span class="current">'+options.text+"</span>")):($link=$('<a href="'+o.hrefTextPrefix+(pageIndex+1)+o.hrefTextSuffix+'" class="page-link">'+options.text+"</a>")).click(function(event){return methods._selectPage.call(self,pageIndex,event)}),options.classes&&$link.addClass(options.classes),$linkWrapper.append($link),$ul.length?$ul.append($linkWrapper):self.append($linkWrapper)},_selectPage:function(pageIndex,event){var o=this.data("pagination");return o.currentPage=pageIndex,o.selectOnClick&&methods._draw.call(this),o.onPageClick(pageIndex+1,event)},_ellipseClick:function($panel){var self=this,o=this.data("pagination"),$ellip=$panel.find(".ellipse");$ellip.addClass("clickable").parent().removeClass("disabled"),$ellip.click(function(event){if(!o.disable){var $this=$(this),val=(parseInt($this.parent().prev().text(),10)||0)+1;$this.html('<input type="number" min="1" max="'+o.pages+'" step="1" value="'+val+'">').find("input").focus().click(function(event){event.stopPropagation()}).keyup(function(event){var val=$(this).val();13===event.which&&""!==val?val>0&&val<=o.pages&&methods._selectPage.call(self,val-1):27===event.which&&$ellip.empty().html(o.ellipseText)}).bind("blur",function(event){var val=$(this).val();return""!==val&&methods._selectPage.call(self,val-1),$ellip.empty().html(o.ellipseText),!1})}return!1})}};$.fn.pagination=function(method){return methods[method]&&"_"!=method.charAt(0)?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.pagination"):methods.init.apply(this,arguments)}}(jQuery),function(e,t,n){function r(e,t){return typeof e===t}function a(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):b?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}function s(e,t){return!!~(""+e).indexOf(t)}function l(e){return e.replace(/([a-z])-([a-z])/g,function(e,t,n){return t+n.toUpperCase()}).replace(/^-/,"")}function u(e,t){return function(){return e.apply(t,arguments)}}function f(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()}).replace(/^ms-/,"-ms-")}function p(e,n,r,o){var i,s,l,u,c="modernizr",f=a("div"),p=function(){var e=t.body;return e||(e=a(b?"svg":"body"),e.fake=!0),e}();if(parseInt(r,10))for(;r--;)l=a("div"),l.id=o?o[r]:c+(r+1),f.appendChild(l);return i=a("style"),i.type="text/css",i.id="s"+c,(p.fake?p:f).appendChild(i),p.appendChild(f),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(t.createTextNode(e)),f.id=c,p.fake&&(p.style.background="",p.style.overflow="hidden",u=C.style.overflow,C.style.overflow="hidden",C.appendChild(p)),s=n(f,e),p.fake?(p.parentNode.removeChild(p),C.style.overflow=u,C.offsetHeight):f.parentNode.removeChild(f),!!s}function m(t,r){var o=t.length;if("CSS"in e&&"supports"in e.CSS){for(;o--;)if(e.CSS.supports(f(t[o]),r))return!0;return!1}if("CSSSupportsRule"in e){for(var i=[];o--;)i.push("("+f(t[o])+":"+r+")");return i=i.join(" or "),p("@supports ("+i+") { #modernizr { position: absolute; } }",function(e){return"absolute"==getComputedStyle(e,null).position})}return n}function h(e,t,o,i){function u(){f&&(delete z.style,delete z.modElem)}if(i=!r(i,"undefined")&&i,!r(o,"undefined")){var c=m(e,o);if(!r(c,"undefined"))return c}for(var f,d,p,h,v,g=["modernizr","tspan","samp"];!z.style&&g.length;)f=!0,z.modElem=a(g.shift()),z.style=z.modElem.style;for(p=e.length,d=0;p>d;d++)if(h=e[d],v=z.style[h],s(h,"-")&&(h=l(h)),z.style[h]!==n){if(i||r(o,"undefined"))return u(),"pfx"!=t||h;try{z.style[h]=o}catch(y){}if(z.style[h]!=v)return u(),"pfx"!=t||h}return u(),!1}function v(e,t,n,o,i){var a=e.charAt(0).toUpperCase()+e.slice(1),s=(e+" "+T.join(a+" ")+a).split(" ");return r(t,"string")||r(t,"undefined")?h(s,t,o,i):(s=(e+" "+j.join(a+" ")+a).split(" "),function(e,t,n){var o;for(var i in e)if(e[i]in t)return!1===n?e[i]:(o=t[e[i]],r(o,"function")?u(o,n||t):o);return!1}(s,t,n))}function g(e,t,r){return v(e,n,n,t,r)}var y=[],E=[],S={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout(function(){t(n[e])},0)},addTest:function(e,t,n){E.push({name:e,fn:t,options:n})},addAsyncTest:function(e){E.push({name:null,fn:e})}},Modernizr=function(){};Modernizr.prototype=S,Modernizr=new Modernizr;var C=t.documentElement,b="svg"===C.nodeName.toLowerCase(),x=S._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];S._prefixes=x;var w="CSS"in e&&"supports"in e.CSS,_="supportsCSS"in e;Modernizr.addTest("supports",w||_),b||function(e,t){function n(e,t){var n=e.createElement("p"),r=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",r.insertBefore(n.lastChild,r.firstChild)}function r(){var e=w.elements;return"string"==typeof e?e.split(" "):e}function i(e){var t=x[e[C]];return t||(t={},b++,e[C]=b,x[b]=t),t}function a(e,n,r){if(n||(n=t),v)return n.createElement(e);r||(r=i(n));var o;return!(o=r.cache[e]?r.cache[e].cloneNode():S.test(e)?(r.cache[e]=r.createElem(e)).cloneNode():r.createElem(e)).canHaveChildren||E.test(e)||o.tagUrn?o:r.frag.appendChild(o)}function l(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return w.shivMethods?a(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+r().join().replace(/[\w\-:]+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(w,t.frag)}function u(e){e||(e=t);var r=i(e);return!w.shivCSS||h||r.hasCSS||(r.hasCSS=!!n(e,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),v||l(e,r),e}function c(e){for(var t,n=e.getElementsByTagName("*"),o=n.length,i=RegExp("^(?:"+r().join("|")+")$","i"),a=[];o--;)t=n[o],i.test(t.nodeName)&&a.push(t.applyElement(function(e){for(var t,n=e.attributes,r=n.length,o=e.ownerDocument.createElement(N+":"+e.nodeName);r--;)(t=n[r]).specified&&o.setAttribute(t.nodeName,t.nodeValue);return o.style.cssText=e.style.cssText,o}(t)));return a}function d(e){for(var t,n=e.split("{"),o=n.length,i=RegExp("(^|[\\s,>+~])("+r().join("|")+")(?=[[\\s,>+~#.:]|$)","gi"),a="$1"+N+"\\:$2";o--;)t=n[o]=n[o].split("}"),t[t.length-1]=t[t.length-1].replace(i,a),n[o]=t.join("}");return n.join("{")}function m(e){function t(){clearTimeout(a._removeSheetTimer),r&&r.removeNode(!0),r=null}var r,o,a=i(e),s=e.namespaces,l=e.parentWindow;return!T||e.printShived?e:(void 0===s[N]&&s.add(N),l.attachEvent("onbeforeprint",function(){t();for(var i,a,s,l=e.styleSheets,u=[],f=l.length,p=Array(f);f--;)p[f]=l[f];for(;s=p.pop();)if(!s.disabled&&_.test(s.media)){try{i=s.imports,a=i.length}catch(m){a=0}for(f=0;a>f;f++)p.push(i[f]);try{u.push(s.cssText)}catch(m){}}u=d(u.reverse().join("")),o=c(e),r=n(e,u)}),l.attachEvent("onafterprint",function(){(function(e){for(var t=e.length;t--;)e[t].removeNode()})(o),clearTimeout(a._removeSheetTimer),a._removeSheetTimer=setTimeout(t,500)}),e.printShived=!0,e)}var h,v,y=e.html5||{},E=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,S=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,C="_html5shiv",b=0,x={};!function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",h="hidden"in e,v=1==e.childNodes.length||function(){t.createElement("a");var e=t.createDocumentFragment();return void 0===e.cloneNode||void 0===e.createDocumentFragment||void 0===e.createElement}()}catch(n){h=!0,v=!0}}();var w={elements:y.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output picture progress section summary template time video",version:"3.7.3",shivCSS:!1!==y.shivCSS,supportsUnknownElements:v,shivMethods:!1!==y.shivMethods,type:"default",shivDocument:u,createElement:a,createDocumentFragment:function(e,n){if(e||(e=t),v)return e.createDocumentFragment();for(var o=(n=n||i(e)).frag.cloneNode(),a=0,s=r(),l=s.length;l>a;a++)o.createElement(s[a]);return o},addElements:function(e,t){var n=w.elements;"string"!=typeof n&&(n=n.join(" ")),"string"!=typeof e&&(e=e.join(" ")),w.elements=n+" "+e,u(t)}};e.html5=w,u(t);var _=/^$|\b(?:all|print)\b/,N="html5shiv",T=!v&&function(){var n=t.documentElement;return!(void 0===t.namespaces||void 0===t.parentWindow||void 0===n.applyElement||void 0===n.removeNode||void 0===e.attachEvent)}();w.type+=" print",w.shivPrint=m,m(t),"object"==typeof module&&module.exports&&(module.exports=w)}(void 0!==e?e:this,t);var N="Moz O ms Webkit",T=S._config.usePrefixes?N.split(" "):[];S._cssomPrefixes=T;var j=S._config.usePrefixes?N.toLowerCase().split(" "):[];S._domPrefixes=j;var k={elem:a("modernizr")};Modernizr._q.push(function(){delete k.elem});var z={style:k.elem.style};Modernizr._q.unshift(function(){delete z.style}),S.testAllProps=v,S.testAllProps=g,Modernizr.addTest("cssfilters",function(){if(Modernizr.supports)return g("filter","blur(2px)");var e=a("a");return e.style.cssText=x.join("filter:blur(2px); "),!!e.style.length&&(t.documentMode===n||t.documentMode>9)}),function(){var e,t,n,o,i,a,s;for(var l in E)if(E.hasOwnProperty(l)){if(e=[],(t=E[l]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(o=r(t.fn,"function")?t.fn():t.fn,i=0;i<e.length;i++)a=e[i],1===(s=a.split(".")).length?Modernizr[s[0]]=o:(!Modernizr[s[0]]||Modernizr[s[0]]instanceof Boolean||(Modernizr[s[0]]=new Boolean(Modernizr[s[0]])),Modernizr[s[0]][s[1]]=o),y.push((o?"":"no-")+s.join("-"))}}(),function(e){var t=C.className,n=Modernizr._config.classPrefix||"";if(b&&(t=t.baseVal),Modernizr._config.enableJSClass){var r=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");t=t.replace(r,"$1"+n+"js$2")}Modernizr._config.enableClasses&&(t+=" "+n+e.join(" "+n),b?C.className.baseVal=t:C.className=t)}(y),delete S.addTest,delete S.addAsyncTest;for(var P=0;P<Modernizr._q.length;P++)Modernizr._q[P]();e.Modernizr=Modernizr}(window,document),function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).sanitizeHtml=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function each(obj,cb){obj&&Object.keys(obj).forEach(function(key){cb(obj[key],key)})}function has(obj,key){return{}.hasOwnProperty.call(obj,key)}function sanitizeHtml(html,options,_recursing){function escapeHtml(s){return"string"!=typeof s&&(s+=""),s.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;")}var result="";options?(options=extend(sanitizeHtml.defaults,options)).parser?options.parser=extend(htmlParserDefaults,options.parser):options.parser=htmlParserDefaults:(options=sanitizeHtml.defaults).parser=htmlParserDefaults;var allowedAttributesMap,allowedAttributesGlobMap,nonTextTagsArray=options.nonTextTags||["script","style","textarea"];options.allowedAttributes&&(allowedAttributesMap={},allowedAttributesGlobMap={},each(options.allowedAttributes,function(attributes,tag){allowedAttributesMap[tag]=[];var globRegex=[];attributes.forEach(function(name){name.indexOf("*")>=0?globRegex.push(quoteRegexp(name).replace(/\\\*/g,".*")):allowedAttributesMap[tag].push(name)}),allowedAttributesGlobMap[tag]=new RegExp("^("+globRegex.join("|")+")$")}));var allowedClassesMap={};each(options.allowedClasses,function(classes,tag){allowedAttributesMap&&(has(allowedAttributesMap,tag)||(allowedAttributesMap[tag]=[]),allowedAttributesMap[tag].push("class")),allowedClassesMap[tag]=classes});var transformTagsAll,transformTagsMap={};each(options.transformTags,function(transform,tag){var transFun;"function"==typeof transform?transFun=transform:"string"==typeof transform&&(transFun=sanitizeHtml.simpleTransform(transform)),"*"===tag?transformTagsAll=transFun:transformTagsMap[tag]=transFun});var depth=0,stack=[],skipMap={},transformMap={},skipText=!1,skipTextDepth=0,parser=new htmlparser.Parser({onopentag:function(name,attribs){if(skipText)skipTextDepth++;else{var frame=new function(tag,attribs){var that=this;this.tag=tag,this.attribs=attribs||{},this.tagPosition=result.length,this.text="",this.updateParentNodeText=function(){stack.length&&(stack[stack.length-1].text+=that.text)}}(name,attribs);stack.push(frame);var transformedTag,skip=!1,hasText=!!frame.text;has(transformTagsMap,name)&&(transformedTag=transformTagsMap[name](name,attribs),frame.attribs=attribs=transformedTag.attribs,void 0!==transformedTag.text&&(frame.innerText=transformedTag.text),name!==transformedTag.tagName&&(frame.name=name=transformedTag.tagName,transformMap[depth]=transformedTag.tagName)),transformTagsAll&&(transformedTag=transformTagsAll(name,attribs),frame.attribs=attribs=transformedTag.attribs,name!==transformedTag.tagName&&(frame.name=name=transformedTag.tagName,transformMap[depth]=transformedTag.tagName)),options.allowedTags&&-1===options.allowedTags.indexOf(name)&&(skip=!0,-1!==nonTextTagsArray.indexOf(name)&&(skipText=!0,skipTextDepth=1),skipMap[depth]=!0),depth++,skip||(result+="<"+name,(!allowedAttributesMap||has(allowedAttributesMap,name)||allowedAttributesMap["*"])&&each(attribs,function(value,a){if(!allowedAttributesMap||has(allowedAttributesMap,name)&&-1!==allowedAttributesMap[name].indexOf(a)||allowedAttributesMap["*"]&&-1!==allowedAttributesMap["*"].indexOf(a)||has(allowedAttributesGlobMap,name)&&allowedAttributesGlobMap[name].test(a)||allowedAttributesGlobMap["*"]&&allowedAttributesGlobMap["*"].test(a)){if(("href"===a||"src"===a)&&function(name,href){var matches=(href=(href=href.replace(/[\x00-\x20]+/g,"")).replace(/<\!\-\-.*?\-\-\>/g,"")).match(/^([a-zA-Z]+)\:/);if(!matches)return!1;var scheme=matches[1].toLowerCase();return has(options.allowedSchemesByTag,name)?-1===options.allowedSchemesByTag[name].indexOf(scheme):!options.allowedSchemes||-1===options.allowedSchemes.indexOf(scheme)}(name,value))return void delete frame.attribs[a];if("class"===a&&!(value=function(classes,allowed){return allowed?(classes=classes.split(/\s+/)).filter(function(clss){return-1!==allowed.indexOf(clss)}).join(" "):classes}(value,allowedClassesMap[name])).length)return void delete frame.attribs[a];result+=" "+a,value.length&&(result+='="'+escapeHtml(value)+'"')}else delete frame.attribs[a]}),-1!==options.selfClosing.indexOf(name)?result+=" />":(result+=">",!frame.innerText||hasText||options.textFilter||(result+=frame.innerText)))}},ontext:function(text){if(!skipText){var tag,lastFrame=stack[stack.length-1];if(lastFrame&&(tag=lastFrame.tag,text=void 0!==lastFrame.innerText?lastFrame.innerText:text),"script"===tag||"style"===tag)result+=text;else{var escaped=escapeHtml(text);options.textFilter?result+=options.textFilter(escaped):result+=escaped}if(stack.length){stack[stack.length-1].text+=text}}},onclosetag:function(name){if(skipText){if(--skipTextDepth)return;skipText=!1}var frame=stack.pop();if(frame){if(skipText=!1,depth--,skipMap[depth])return delete skipMap[depth],void frame.updateParentNodeText();transformMap[depth]&&(name=transformMap[depth],delete transformMap[depth]),options.exclusiveFilter&&options.exclusiveFilter(frame)?result=result.substr(0,frame.tagPosition):(frame.updateParentNodeText(),-1===options.selfClosing.indexOf(name)&&(result+="</"+name+">"))}}},options.parser);return parser.write(html),parser.end(),result}var htmlparser=require("htmlparser2"),extend=require("xtend"),quoteRegexp=require("regexp-quote");module.exports=sanitizeHtml;var htmlParserDefaults={decodeEntities:!0};sanitizeHtml.defaults={allowedTags:["h3","h4","h5","h6","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre"],allowedAttributes:{a:["href","name","target"],img:["src"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto"],allowedSchemesByTag:{}},sanitizeHtml.simpleTransform=function(newTagName,newAttribs,merge){return merge=void 0===merge||merge,newAttribs=newAttribs||{},function(tagName,attribs){var attrib;if(merge)for(attrib in newAttribs)attribs[attrib]=newAttribs[attrib];else attribs=newAttribs;return{tagName:newTagName,attribs:attribs}}}},{htmlparser2:36,"regexp-quote":59,xtend:60}],2:[function(require,module,exports){},{}],3:[function(require,module,exports){(function(global){"use strict";function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(that=new Uint8Array(length)).__proto__=Buffer.prototype:(null===that&&(that=new Buffer(length)),that.length=length),that}function Buffer(arg,encodingOrOffset,length){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(arg,encodingOrOffset,length);if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}function from(that,value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer?function(that,array,byteOffset,length){if(array.byteLength,byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);Buffer.TYPED_ARRAY_SUPPORT?(that=array).__proto__=Buffer.prototype:that=fromArrayLike(that,array);return that}(that,value,encodingOrOffset,length):"string"==typeof value?function(that,string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");if(!Buffer.isEncoding(encoding))throw new TypeError('"encoding" must be a valid string encoding');var length=0|byteLength(string,encoding),actual=(that=createBuffer(that,length)).write(string,encoding);actual!==length&&(that=that.slice(0,actual));return that}(that,value,encodingOrOffset):function(that,obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length);return 0===(that=createBuffer(that,len)).length?that:(obj.copy(that,0,0,len),that)}if(obj){if("undefined"!=typeof ArrayBuffer&&obj.buffer instanceof ArrayBuffer||"length"in obj)return"number"!=typeof obj.length||function(val){return val!=val}(obj.length)?createBuffer(that,0):fromArrayLike(that,obj);if("Buffer"===obj.type&&isArray(obj.data))return fromArrayLike(that,obj.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(that,value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(that,size){if(assertSize(size),that=createBuffer(that,size<0?0:0|checked(size)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<size;++i)that[i]=0;return that}function fromArrayLike(that,array){var length=array.length<0?0:0|checked(array.length);that=createBuffer(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer))return string.byteLength;"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if(end>>>=0,start>>>=0,end<=start)return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return function(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0);(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=function(n){return n<16?"0"+n.toString(16):n.toString(16)}(buf[i]);return out}(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}(this,start,end);case"latin1":case"binary":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}(this,start,end);case"base64":return function(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset=+byteOffset,isNaN(byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;if(strLen%2!=0)throw new TypeError("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}(res)}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){value<0&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){value<0&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function(str){if((str=function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}(str).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}var base64=require("base64-js"),ieee754=require("ieee754"),isArray=require("isarray");exports.Buffer=Buffer,exports.SlowBuffer=function(length){return+length!=length&&(length=0),Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}(),exports.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(arr){return arr.__proto__=Buffer.prototype,arr},Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(size,fill,encoding){return function(that,size,fill,encoding){return assertSize(size),size<=0?createBuffer(that,size):void 0!==fill?"string"==typeof encoding?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill):createBuffer(that,size)}(null,size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)},Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(start>>>=0,end>>>=0,thisStart>>>=0,thisEnd>>>=0,this===target)return 0;for(var x=thisEnd-thisStart,y=end-start,len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset|=0,isFinite(length)?(length|=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,start<0?(start+=len)<0&&(start=0):start>len&&(start=len),end<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT)(newBuf=this.subarray(start,end)).__proto__=Buffer.prototype;else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;i<sliceLen;++i)newBuf[i]=this[i+start]}return newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,byteLength|=0,!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0)}var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,byteLength|=0,!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0)}var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),1===val.length){var code=val.charCodeAt(0);code<256&&(val=code)}if(void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0);var i;if("number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString()),len=bytes.length;for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":4,ieee754:5,isarray:6}],4:[function(require,module,exports){"use strict";function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}function encodeChunk(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output.push(tripletToBase64(tmp));return output.join("")}exports.toByteArray=function(b64){var i,j,l,tmp,placeHolders,arr,len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");placeHolders="="===b64[len-2]?2:"="===b64[len-1]?1:0,arr=new Arr(3*len/4-placeHolders),l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[L++]=tmp>>16&255,arr[L++]=tmp>>8&255,arr[L++]=255&tmp;return 2===placeHolders?(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[L++]=255&tmp):1===placeHolders&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[L++]=tmp>>8&255,arr[L++]=255&tmp),arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,output="",parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));return 1===extraBytes?(tmp=uint8[len-1],output+=lookup[tmp>>2],output+=lookup[tmp<<4&63],output+="=="):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],output+=lookup[tmp>>10],output+=lookup[tmp>>4&63],output+=lookup[tmp<<2&63],output+="="),parts.push(output),parts.join("")};var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array;!function(){for(var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}()},{}],5:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],6:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],7:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!function(arg){return"number"==typeof arg}(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((er=arguments[1])instanceof Error)throw er;var err=new Error('Uncaught, unspecified "error" event. ('+er+")");throw err.context=er,err}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),len=(listeners=handler.slice()).length,i=0;i<len;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace()),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else if(listeners)for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){return this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)}},{}],8:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],9:[function(require,module,exports){function isBuffer(obj){return!!obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}module.exports=function(obj){return null!=obj&&(isBuffer(obj)||function(obj){return"function"==typeof obj.readFloatLE&&"function"==typeof obj.slice&&isBuffer(obj.slice(0,0))}(obj)||!!obj._isBuffer)}},{}],10:[function(require,module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],11:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":12}],12:[function(require,module,exports){"use strict";function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options),Writable.call(this,options),options&&!1===options.readable&&(this.readable=!1),options&&!1===options.writable&&(this.writable=!1),this.allowHalfOpen=!0,options&&!1===options.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||processNextTick(onEndNT,this)}function onEndNT(self){self.end()}var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};module.exports=Duplex;var processNextTick=require("process-nextick-args"),util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}},{"./_stream_readable":14,"./_stream_writable":16,"core-util-is":19,inherits:8,"process-nextick-args":21}],13:[function(require,module,exports){"use strict";function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}module.exports=PassThrough;var Transform=require("./_stream_transform"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":15,"core-util-is":19,inherits:8}],14:[function(require,module,exports){(function(process){"use strict";function ReadableState(options,stream){Duplex=Duplex||require("./_stream_duplex"),options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=options.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){if(Duplex=Duplex||require("./_stream_duplex"),!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this),this.readable=!0,options&&"function"==typeof options.read&&(this._read=options.read),Stream.call(this)}function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=function(state,chunk){var er=null;Buffer.isBuffer(chunk)||"string"==typeof chunk||null===chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk"));return er}(state,chunk);if(er)stream.emit("error",er);else if(null===chunk)state.reading=!1,function(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,emitReadable(stream)}(stream,state);else if(state.objectMode||chunk&&chunk.length>0)if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var _e=new Error("stream.unshift() after end event");stream.emit("error",_e)}else{var skipAdd;!state.decoder||addToFront||encoding||(chunk=state.decoder.write(chunk),skipAdd=!state.objectMode&&0===chunk.length),addToFront||(state.reading=!1),skipAdd||(state.flowing&&0===state.length&&!state.sync?(stream.emit("data",chunk),stream.read(0)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream))),function(stream,state){state.readingMore||(state.readingMore=!0,processNextTick(maybeReadMore_,stream,state))}(stream,state)}else addToFront||(state.reading=!1);return function(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}(state)}function howMuchToRead(n,state){return n<=0||0===state.length&&state.ended?0:state.objectMode?1:n!=n?state.flowing&&state.length?state.buffer.head.data.length:state.length:(n>state.highWaterMark&&(state.highWaterMark=function(n){return n>=MAX_HWM?n=MAX_HWM:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}(n)),n<=state.length?n:state.ended?state.length:(state.needReadable=!0,0))}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,state.sync?processNextTick(emitReadable_,stream):emitReadable_(stream))}function emitReadable_(stream){debug("emit readable"),stream.emit("readable"),flow(stream)}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(debug("maybeReadMore read 0"),stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function nReadingNextTick(self){debug("readable nexttick read 0"),self.read(0)}function resume_(stream,state){state.reading||(debug("resume read 0"),stream.read(0)),state.resumeScheduled=!1,state.awaitDrain=0,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;for(debug("flow",state.flowing);state.flowing&&null!==stream.read(););}function fromList(n,state){if(0===state.length)return null;var ret;return state.objectMode?ret=state.buffer.shift():!n||n>=state.length?(ret=state.decoder?state.buffer.join(""):1===state.buffer.length?state.buffer.head.data:state.buffer.concat(state.length),state.buffer.clear()):ret=function(n,list,hasStrings){var ret;n<list.head.data.length?(ret=list.head.data.slice(0,n),list.head.data=list.head.data.slice(n)):ret=n===list.head.data.length?list.shift():hasStrings?function(n,list){var p=list.head,c=1,ret=p.data;n-=ret.length;for(;p=p.next;){var str=p.data,nb=n>str.length?str.length:n;if(nb===str.length?ret+=str:ret+=str.slice(0,n),0===(n-=nb)){nb===str.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=str.slice(nb));break}++c}return list.length-=c,ret}(n,list):function(n,list){var ret=bufferShim.allocUnsafe(n),p=list.head,c=1;p.data.copy(ret),n-=p.data.length;for(;p=p.next;){var buf=p.data,nb=n>buf.length?buf.length:n;if(buf.copy(ret,ret.length-n,0,nb),0===(n-=nb)){nb===buf.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=buf.slice(nb));break}++c}return list.length-=c,ret}(n,list);return ret}(n,state.buffer,state.decoder),ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');state.endEmitted||(state.ended=!0,processNextTick(endReadableNT,state,stream))}function endReadableNT(state,stream){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++)if(xs[i]===x)return i;return-1}module.exports=Readable;var processNextTick=require("process-nextick-args"),isArray=require("isarray");Readable.ReadableState=ReadableState;require("events").EventEmitter;var Stream,EElistenerCount=function(emitter,type){return emitter.listeners(type).length};!function(){try{Stream=require("stream")}catch(_){}finally{Stream||(Stream=require("events").EventEmitter)}}();var Buffer=require("buffer").Buffer,bufferShim=require("buffer-shims"),util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util"),debug=void 0;debug=debugUtil&&debugUtil.debuglog?debugUtil.debuglog("stream"):function(){};var StringDecoder,BufferList=require("./internal/streams/BufferList");util.inherits(Readable,Stream);var Duplex;Readable.prototype.push=function(chunk,encoding){var state=this._readableState;return state.objectMode||"string"!=typeof chunk||(encoding=encoding||state.defaultEncoding)!==state.encoding&&(chunk=bufferShim.from(chunk,encoding),encoding=""),readableAddChunk(this,state,chunk,encoding,!1)},Readable.prototype.unshift=function(chunk){return readableAddChunk(this,this._readableState,chunk,"",!0)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(enc){return StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc,this};var MAX_HWM=8388608;Readable.prototype.read=function(n){debug("read",n),n=parseInt(n,10);var state=this._readableState,nOrig=n;if(0!==n&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return debug("read: emitReadable",state.length,state.ended),0===state.length&&state.ended?endReadable(this):emitReadable(this),null;if(0===(n=howMuchToRead(n,state))&&state.ended)return 0===state.length&&endReadable(this),null;var doRead=state.needReadable;debug("need readable",doRead),(0===state.length||state.length-n<state.highWaterMark)&&debug("length less than watermark",doRead=!0),state.ended||state.reading?debug("reading or ended",doRead=!1):doRead&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1,state.reading||(n=howMuchToRead(nOrig,state)));var ret;return null===(ret=n>0?fromList(n,state):null)?(state.needReadable=!0,n=0):state.length-=n,0===state.length&&(state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&endReadable(this)),null!==ret&&this.emit("data",ret),ret},Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){function onunpipe(readable){debug("onunpipe"),readable===src&&cleanup()}function onend(){debug("onend"),dest.end()}function cleanup(){debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",cleanup),src.removeListener("data",ondata),cleanedUp=!0,!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain()}function ondata(chunk){debug("ondata"),increasedAwaitDrain=!1;!1!==dest.write(chunk)||increasedAwaitDrain||((1===state.pipesCount&&state.pipes===dest||state.pipesCount>1&&-1!==indexOf(state.pipes,dest))&&!cleanedUp&&(debug("false write response, pause",src._readableState.awaitDrain),src._readableState.awaitDrain++,increasedAwaitDrain=!0),src.pause())}function onerror(er){debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===EElistenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}function unpipe(){debug("unpipe"),src.unpipe(dest)}var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var endFn=(!pipeOpts||!1!==pipeOpts.end)&&dest!==process.stdout&&dest!==process.stderr?onend:cleanup;state.endEmitted?processNextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=function(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EElistenerCount(src,"data")&&(state.flowing=!0,flow(src))}}(src);dest.on("drain",ondrain);var cleanedUp=!1,increasedAwaitDrain=!1;return src.on("data",ondata),function(emitter,event,fn){if("function"==typeof emitter.prependListener)return emitter.prependListener(event,fn);emitter._events&&emitter._events[event]?isArray(emitter._events[event])?emitter._events[event].unshift(fn):emitter._events[event]=[fn,emitter._events[event]]:emitter.on(event,fn)}(dest,"error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState;if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var _i=0;_i<len;_i++)dests[_i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);return-1===i?this:(state.pipes.splice(i,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"===ev)!1!==this._readableState.flowing&&this.resume();else if("readable"===ev){var state=this._readableState;state.endEmitted||state.readableListening||(state.readableListening=state.needReadable=!0,state.emittedReadable=!1,state.reading?state.length&&emitReadable(this):processNextTick(nReadingNextTick,this))}return res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!0,function(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,processNextTick(resume_,stream,state))}(this,state)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(stream){var state=this._readableState,paused=!1,self=this;stream.on("end",function(){if(debug("wrapped end"),state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&self.push(chunk)}self.push(null)}),stream.on("data",function(chunk){if(debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),(!state.objectMode||null!==chunk&&void 0!==chunk)&&(state.objectMode||chunk&&chunk.length)){self.push(chunk)||(paused=!0,stream.pause())}});for(var i in stream)void 0===this[i]&&"function"==typeof stream[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));return function(xs,f){for(var i=0,l=xs.length;i<l;i++)f(xs[i],i)}(["error","close","destroy","pause","resume"],function(ev){stream.on(ev,self.emit.bind(self,ev))}),self._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList}).call(this,require("_process"))},{"./_stream_duplex":12,"./internal/streams/BufferList":17,_process:10,buffer:3,"buffer-shims":18,"core-util-is":19,events:7,inherits:8,isarray:20,"process-nextick-args":21,"string_decoder/":28,util:2}],15:[function(require,module,exports){"use strict";function TransformState(stream){this.afterTransform=function(er,data){return function(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null,ts.writecb=null,null!==data&&void 0!==data&&stream.push(data);cb(er);var rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=!0,this._readableState.sync=!1,options&&("function"==typeof options.transform&&(this._transform=options.transform),"function"==typeof options.flush&&(this._flush=options.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(er){done(stream,er)}):done(stream)})}function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState,ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}module.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("Not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;null!==ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0}},{"./_stream_duplex":12,"core-util-is":19,inherits:8}],16:[function(require,module,exports){(function(process){"use strict";function nop(){}function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex"),options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var noDecode=!1===options.decodeStrings;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){!function(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(function(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}(state),er)!function(stream,state,sync,er,cb){--state.pendingcb,sync?processNextTick(cb,er):cb(er);stream._writableState.errorEmitted=!0,stream.emit("error",er)}(stream,state,sync,er,cb);else{var finished=needFinish(state);finished||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(stream,state),sync?asyncWrite(afterWrite,stream,state,finished,cb):afterWrite(stream,state,finished,cb)}}(stream,er)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(options){if(Duplex=Duplex||require("./_stream_duplex"),!(this instanceof Writable||this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this),this.writable=!0,options&&("function"==typeof options.write&&(this._write=options.write),"function"==typeof options.writev&&(this._writev=options.writev)),Stream.call(this)}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=function(state,chunk,encoding){return state.objectMode||!1===state.decodeStrings||"string"!=typeof chunk||(chunk=bufferShim.from(chunk,encoding)),chunk}(state,chunk,encoding),Buffer.isBuffer(chunk)&&(encoding="buffer");var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(ret||(state.needDrain=!0),state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new function(chunk,encoding,cb){this.chunk=chunk,this.encoding=encoding,this.callback=cb,this.next=null}(chunk,encoding,cb),last?last.next=state.lastBufferedRequest:state.bufferedRequest=state.lastBufferedRequest,state.bufferedRequestCount+=1}else doWrite(stream,state,!1,len,chunk,encoding,cb);return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function afterWrite(stream,state,finished,cb){finished||function(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount,buffer=new Array(l),holder=state.corkedRequestsFree;holder.entry=entry;for(var count=0;entry;)buffer[count]=entry,entry=entry.next,count+=1;doWrite(stream,state,!0,state.length,buffer,"",holder.finish),state.pendingcb++,state.lastBufferedRequest=null,holder.next?(state.corkedRequestsFree=holder.next,holder.next=null):state.corkedRequestsFree=new CorkedRequest(state)}else{for(;entry;){var chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback;if(doWrite(stream,state,!1,state.objectMode?1:chunk.length,chunk,encoding,cb),entry=entry.next,state.writing)break}null===entry&&(state.lastBufferedRequest=null)}state.bufferedRequestCount=0,state.bufferedRequest=entry,state.bufferProcessing=!1}function needFinish(state){return state.ending&&0===state.length&&null===state.bufferedRequest&&!state.finished&&!state.writing}function prefinish(stream,state){state.prefinished||(state.prefinished=!0,stream.emit("prefinish"))}function finishMaybe(stream,state){var need=needFinish(state);return need&&(0===state.pendingcb?(prefinish(stream,state),state.finished=!0,stream.emit("finish")):prefinish(stream,state)),need}function CorkedRequest(state){var _this=this;this.next=null,this.entry=null,this.finish=function(err){var entry=_this.entry;for(_this.entry=null;entry;){var cb=entry.callback;state.pendingcb--,cb(err),entry=entry.next}state.corkedRequestsFree?state.corkedRequestsFree.next=_this:state.corkedRequestsFree=_this}}module.exports=Writable;var processNextTick=require("process-nextick-args"),asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream,internalUtil={deprecate:require("util-deprecate")};!function(){try{Stream=require("stream")}catch(_){}finally{Stream||(Stream=require("events").EventEmitter)}}();var Buffer=require("buffer").Buffer,bufferShim=require("buffer-shims");util.inherits(Writable,Stream);WritableState.prototype.getBuffer=function(){for(var current=this.bufferedRequest,out=[];current;)out.push(current),current=current.next;return out},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(_){}}();var Duplex;Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1;return"function"==typeof encoding&&(cb=encoding,encoding=null),Buffer.isBuffer(chunk)?encoding="buffer":encoding||(encoding=state.defaultEncoding),"function"!=typeof cb&&(cb=nop),state.ended?function(stream,cb){var er=new Error("write after end");stream.emit("error",er),processNextTick(cb,er)}(this,cb):function(stream,state,chunk,cb){var valid=!0,er=!1;return null===chunk?er=new TypeError("May not write null values to stream"):Buffer.isBuffer(chunk)||"string"==typeof chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er&&(stream.emit("error",er),processNextTick(cb,er),valid=!1),valid}(this,state,chunk,cb)&&(state.pendingcb++,ret=writeOrBuffer(this,state,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.finished||state.bufferProcessing||!state.bufferedRequest||clearBuffer(this,state))},Writable.prototype.setDefaultEncoding=function(encoding){if("string"==typeof encoding&&(encoding=encoding.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);return this._writableState.defaultEncoding=encoding,this},Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,chunk=null,encoding=null):"function"==typeof encoding&&(cb=encoding,encoding=null),null!==chunk&&void 0!==chunk&&this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||state.finished||function(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?processNextTick(cb):stream.once("finish",cb)),state.ended=!0,stream.writable=!1}(this,state,cb)}}).call(this,require("_process"))},{"./_stream_duplex":12,_process:10,buffer:3,"buffer-shims":18,"core-util-is":19,events:7,inherits:8,"process-nextick-args":21,"util-deprecate":22}],17:[function(require,module,exports){"use strict";function BufferList(){this.head=null,this.tail=null,this.length=0}require("buffer").Buffer;var bufferShim=require("buffer-shims");module.exports=BufferList,BufferList.prototype.push=function(v){var entry={data:v,next:null};this.length>0?this.tail.next=entry:this.head=entry,this.tail=entry,++this.length},BufferList.prototype.unshift=function(v){var entry={data:v,next:this.head};0===this.length&&(this.tail=entry),this.head=entry,++this.length},BufferList.prototype.shift=function(){if(0!==this.length){var ret=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,ret}},BufferList.prototype.clear=function(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function(s){if(0===this.length)return"";for(var p=this.head,ret=""+p.data;p=p.next;)ret+=s+p.data;return ret},BufferList.prototype.concat=function(n){if(0===this.length)return bufferShim.alloc(0);if(1===this.length)return this.head.data;for(var ret=bufferShim.allocUnsafe(n>>>0),p=this.head,i=0;p;)p.data.copy(ret,i),i+=p.data.length,p=p.next;return ret}},{buffer:3,"buffer-shims":18}],18:[function(require,module,exports){(function(global){"use strict";var buffer=require("buffer"),Buffer=buffer.Buffer,SlowBuffer=buffer.SlowBuffer,MAX_LEN=buffer.kMaxLength||2147483647;exports.alloc=function(size,fill,encoding){if("function"==typeof Buffer.alloc)return Buffer.alloc(size,fill,encoding);if("number"==typeof encoding)throw new TypeError("encoding must not be number");if("number"!=typeof size)throw new TypeError("size must be a number");if(size>MAX_LEN)throw new RangeError("size is too large");var enc=encoding,_fill=fill;void 0===_fill&&(enc=void 0,_fill=0);var buf=new Buffer(size);if("string"==typeof _fill)for(var fillBuf=new Buffer(_fill,enc),flen=fillBuf.length,i=-1;++i<size;)buf[i]=fillBuf[i%flen];else buf.fill(_fill);return buf},exports.allocUnsafe=function(size){if("function"==typeof Buffer.allocUnsafe)return Buffer.allocUnsafe(size);if("number"!=typeof size)throw new TypeError("size must be a number");if(size>MAX_LEN)throw new RangeError("size is too large");return new Buffer(size)},exports.from=function(value,encodingOrOffset,length){if("function"==typeof Buffer.from&&(!global.Uint8Array||Uint8Array.from!==Buffer.from))return Buffer.from(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('"value" argument must not be a number');if("string"==typeof value)return new Buffer(value,encodingOrOffset);if("undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer){var offset=encodingOrOffset;if(1===arguments.length)return new Buffer(value);void 0===offset&&(offset=0);var len=length;if(void 0===len&&(len=value.byteLength-offset),offset>=value.byteLength)throw new RangeError("'offset' is out of bounds");if(len>value.byteLength-offset)throw new RangeError("'length' is out of bounds");return new Buffer(value.slice(offset,offset+len))}if(Buffer.isBuffer(value)){var out=new Buffer(value.length);return value.copy(out,0,0,value.length),out}if(value){if(Array.isArray(value)||"undefined"!=typeof ArrayBuffer&&value.buffer instanceof ArrayBuffer||"length"in value)return new Buffer(value);if("Buffer"===value.type&&Array.isArray(value.data))return new Buffer(value.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},exports.allocUnsafeSlow=function(size){if("function"==typeof Buffer.allocUnsafeSlow)return Buffer.allocUnsafeSlow(size);if("number"!=typeof size)throw new TypeError("size must be a number");if(size>=MAX_LEN)throw new RangeError("size is too large");return new SlowBuffer(size)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{buffer:3}],19:[function(require,module,exports){(function(Buffer){function objectToString(o){return Object.prototype.toString.call(o)}exports.isArray=function(arg){return Array.isArray?Array.isArray(arg):"[object Array]"===objectToString(arg)},exports.isBoolean=function(arg){return"boolean"==typeof arg},exports.isNull=function(arg){return null===arg},exports.isNullOrUndefined=function(arg){return null==arg},exports.isNumber=function(arg){return"number"==typeof arg},exports.isString=function(arg){return"string"==typeof arg},exports.isSymbol=function(arg){return"symbol"==typeof arg},exports.isUndefined=function(arg){return void 0===arg},exports.isRegExp=function(re){return"[object RegExp]"===objectToString(re)},exports.isObject=function(arg){return"object"==typeof arg&&null!==arg},exports.isDate=function(d){return"[object Date]"===objectToString(d)},exports.isError=function(e){return"[object Error]"===objectToString(e)||e instanceof Error},exports.isFunction=function(arg){return"function"==typeof arg},exports.isPrimitive=function(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg},exports.isBuffer=Buffer.isBuffer}).call(this,{isBuffer:require("../../../../insert-module-globals/node_modules/is-buffer/index.js")})},{"../../../../insert-module-globals/node_modules/is-buffer/index.js":9}],20:[function(require,module,exports){arguments[4][6][0].apply(exports,arguments)},{dup:6}],21:[function(require,module,exports){(function(process){"use strict";!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?module.exports=function(fn,arg1,arg2,arg3){if("function"!=typeof fn)throw new TypeError('"callback" argument must be a function');var args,i,len=arguments.length;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function(){fn.call(null,arg1)});case 3:return process.nextTick(function(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function(){fn.call(null,arg1,arg2,arg3)});default:for(args=new Array(len-1),i=0;i<args.length;)args[i++]=arguments[i];return process.nextTick(function(){fn.apply(null,args)})}}:module.exports=process.nextTick}).call(this,require("_process"))},{_process:10}],22:[function(require,module,exports){(function(global){function config(name){try{if(!global.localStorage)return!1}catch(_){return!1}var val=global.localStorage[name];return null!=val&&"true"===String(val).toLowerCase()}module.exports=function(fn,msg){if(config("noDeprecation"))return fn;var warned=!1;return function(){if(!warned){if(config("throwDeprecation"))throw new Error(msg);config("traceDeprecation")?console.trace(msg):console.warn(msg),warned=!0}return fn.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],23:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":13}],24:[function(require,module,exports){(function(process){var Stream=function(){try{return require("stream")}catch(_){}}();(exports=module.exports=require("./lib/_stream_readable.js")).Stream=Stream||exports,exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js"),!process.browser&&"disable"===process.env.READABLE_STREAM&&Stream&&(module.exports=Stream)}).call(this,require("_process"))},{"./lib/_stream_duplex.js":12,"./lib/_stream_passthrough.js":13,"./lib/_stream_readable.js":14,"./lib/_stream_transform.js":15,"./lib/_stream_writable.js":16,_process:10}],25:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":15}],26:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":16}],27:[function(require,module,exports){function Stream(){EE.call(this)}module.exports=Stream;var EE=require("events").EventEmitter;require("inherits")(Stream,EE),Stream.Readable=require("readable-stream/readable.js"),Stream.Writable=require("readable-stream/writable.js"),Stream.Duplex=require("readable-stream/duplex.js"),Stream.Transform=require("readable-stream/transform.js"),Stream.PassThrough=require("readable-stream/passthrough.js"),Stream.Stream=Stream,Stream.prototype.pipe=function(dest,options){function ondata(chunk){dest.writable&&!1===dest.write(chunk)&&source.pause&&source.pause()}function ondrain(){source.readable&&source.resume&&source.resume()}function onend(){didOnEnd||(didOnEnd=!0,dest.end())}function onclose(){didOnEnd||(didOnEnd=!0,"function"==typeof dest.destroy&&dest.destroy())}function onerror(er){if(cleanup(),0===EE.listenerCount(this,"error"))throw er}function cleanup(){source.removeListener("data",ondata),dest.removeListener("drain",ondrain),source.removeListener("end",onend),source.removeListener("close",onclose),source.removeListener("error",onerror),dest.removeListener("error",onerror),source.removeListener("end",cleanup),source.removeListener("close",cleanup),dest.removeListener("close",cleanup)}var source=this;source.on("data",ondata),dest.on("drain",ondrain),dest._isStdio||options&&!1===options.end||(source.on("end",onend),source.on("close",onclose));var didOnEnd=!1;return source.on("error",onerror),dest.on("error",onerror),source.on("end",cleanup),source.on("close",cleanup),dest.on("close",cleanup),dest.emit("pipe",source),dest}},{events:7,inherits:8,"readable-stream/duplex.js":11,"readable-stream/passthrough.js":23,"readable-stream/readable.js":24,"readable-stream/transform.js":25,"readable-stream/writable.js":26}],28:[function(require,module,exports){function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3,this.charLength=this.charReceived?3:0}var Buffer=require("buffer").Buffer,isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},StringDecoder=exports.StringDecoder=function(encoding){switch(this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,""),function(encoding){if(encoding&&!isBufferEncoding(encoding))throw new Error("Unknown encoding: "+encoding)}(encoding),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0};StringDecoder.prototype.write=function(buffer){for(var charStr="";this.charLength;){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;if(buffer.copy(this.charBuffer,this.charReceived,0,available),this.charReceived+=available,this.charReceived<this.charLength)return"";buffer=buffer.slice(available,buffer.length);if(!((charCode=(charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(charStr.length-1))>=55296&&charCode<=56319)){if(this.charReceived=this.charLength=0,0===buffer.length)return charStr;break}this.charLength+=this.surrogateSize,charStr=""}this.detectIncompleteChar(buffer);end=buffer.length;this.charLength&&(buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end),end-=this.charReceived);var end=(charStr+=buffer.toString(this.encoding,0,end)).length-1,charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;return this.charLength+=size,this.charReceived+=size,this.charBuffer.copy(this.charBuffer,size,0,size),buffer.copy(this.charBuffer,0,0,size),charStr.substring(0,end)}return charStr},StringDecoder.prototype.detectIncompleteChar=function(buffer){for(var i=buffer.length>=3?3:buffer.length;i>0;i--){var c=buffer[buffer.length-i];if(1==i&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i},StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length&&(res=this.write(buffer)),this.charReceived){var cr=this.charReceived,buf=this.charBuffer,enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res}},{buffer:3}],29:[function(require,module,exports){function CollectingHandler(cbs){this._cbs=cbs||{},this.events=[]}module.exports=CollectingHandler;var EVENTS=require("./").EVENTS;Object.keys(EVENTS).forEach(function(name){if(0===EVENTS[name])CollectingHandler.prototype[name="on"+name]=function(){this.events.push([name]),this._cbs[name]&&this._cbs[name]()};else if(1===EVENTS[name])CollectingHandler.prototype[name="on"+name]=function(a){this.events.push([name,a]),this._cbs[name]&&this._cbs[name](a)};else{if(2!==EVENTS[name])throw Error("wrong number of arguments");CollectingHandler.prototype[name="on"+name]=function(a,b){this.events.push([name,a,b]),this._cbs[name]&&this._cbs[name](a,b)}}}),CollectingHandler.prototype.onreset=function(){this.events=[],this._cbs.onreset&&this._cbs.onreset()},CollectingHandler.prototype.restart=function(){this._cbs.onreset&&this._cbs.onreset();for(var i=0,len=this.events.length;i<len;i++)if(this._cbs[this.events[i][0]]){var num=this.events[i].length;1===num?this._cbs[this.events[i][0]]():2===num?this._cbs[this.events[i][0]](this.events[i][1]):this._cbs[this.events[i][0]](this.events[i][1],this.events[i][2])}}},{"./":36}],30:[function(require,module,exports){function FeedHandler(callback,options){this.init(callback,options)}function getElements(what,where){return DomUtils.getElementsByTagName(what,where,!0)}function getOneElement(what,where){return DomUtils.getElementsByTagName(what,where,!0,1)[0]}function fetch(what,where,recurse){return DomUtils.getText(DomUtils.getElementsByTagName(what,where,recurse,1)).trim()}function addConditionally(obj,prop,what,where,recurse){var tmp=fetch(what,where,recurse);tmp&&(obj[prop]=tmp)}var index=require("./index.js"),DomHandler=index.DomHandler,DomUtils=index.DomUtils;require("inherits")(FeedHandler,DomHandler),FeedHandler.prototype.init=DomHandler;var isValidFeed=function(value){return"rss"===value||"feed"===value||"rdf:RDF"===value};FeedHandler.prototype.onend=function(){var tmp,childs,feed={},feedRoot=getOneElement(isValidFeed,this.dom);feedRoot&&("feed"===feedRoot.name?(childs=feedRoot.children,feed.type="atom",addConditionally(feed,"id","id",childs),addConditionally(feed,"title","title",childs),(tmp=getOneElement("link",childs))&&(tmp=tmp.attribs)&&(tmp=tmp.href)&&(feed.link=tmp),addConditionally(feed,"description","subtitle",childs),(tmp=fetch("updated",childs))&&(feed.updated=new Date(tmp)),addConditionally(feed,"author","email",childs,!0),feed.items=getElements("entry",childs).map(function(item){var tmp,entry={};return item=item.children,addConditionally(entry,"id","id",item),addConditionally(entry,"title","title",item),(tmp=getOneElement("link",item))&&(tmp=tmp.attribs)&&(tmp=tmp.href)&&(entry.link=tmp),(tmp=fetch("summary",item)||fetch("content",item))&&(entry.description=tmp),(tmp=fetch("updated",item))&&(entry.pubDate=new Date(tmp)),entry})):(childs=getOneElement("channel",feedRoot.children).children,feed.type=feedRoot.name.substr(0,3),feed.id="",addConditionally(feed,"title","title",childs),addConditionally(feed,"link","link",childs),addConditionally(feed,"description","description",childs),(tmp=fetch("lastBuildDate",childs))&&(feed.updated=new Date(tmp)),addConditionally(feed,"author","managingEditor",childs,!0),feed.items=getElements("item",feedRoot.children).map(function(item){var tmp,entry={};return item=item.children,addConditionally(entry,"id","guid",item),addConditionally(entry,"title","title",item),addConditionally(entry,"link","link",item),addConditionally(entry,"description","description",item),(tmp=fetch("pubDate",item))&&(entry.pubDate=new Date(tmp)),entry}))),this.dom=feed,DomHandler.prototype._handleCallback.call(this,feedRoot?null:Error("couldn't find root of feed"))},module.exports=FeedHandler},{"./index.js":36,inherits:58}],31:[function(require,module,exports){function Parser(cbs,options){this._options=options||{},this._cbs=cbs||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._stack=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,this._options.Tokenizer&&(Tokenizer=this._options.Tokenizer),this._tokenizer=new Tokenizer(this._options,this),this._cbs.onparserinit&&this._cbs.onparserinit(this)}var Tokenizer=require("./Tokenizer.js"),formTags={input:!0,option:!0,optgroup:!0,select:!0,button:!0,datalist:!0,textarea:!0},openImpliesClose={tr:{tr:!0,th:!0,td:!0},th:{th:!0},td:{thead:!0,th:!0,td:!0},body:{head:!0,link:!0,script:!0},li:{li:!0},p:{p:!0},h1:{p:!0},h2:{p:!0},h3:{p:!0},h4:{p:!0},h5:{p:!0},h6:{p:!0},select:formTags,input:formTags,output:formTags,button:formTags,datalist:formTags,textarea:formTags,option:{option:!0},optgroup:{optgroup:!0}},voidElements={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,path:!0,circle:!0,ellipse:!0,line:!0,rect:!0,use:!0,stop:!0,polyline:!0,polygon:!0},re_nameEnd=/\s|\//;require("inherits")(Parser,require("events").EventEmitter),Parser.prototype._updatePosition=function(initialOffset){null===this.endIndex?this._tokenizer._sectionStart<=initialOffset?this.startIndex=0:this.startIndex=this._tokenizer._sectionStart-initialOffset:this.startIndex=this.endIndex+1,this.endIndex=this._tokenizer.getAbsoluteIndex()},Parser.prototype.ontext=function(data){this._updatePosition(1),this.endIndex--,this._cbs.ontext&&this._cbs.ontext(data)},Parser.prototype.onopentagname=function(name){if(this._lowerCaseTagNames&&(name=name.toLowerCase()),this._tagname=name,!this._options.xmlMode&&name in openImpliesClose)for(var el;(el=this._stack[this._stack.length-1])in openImpliesClose[name];this.onclosetag(el));!this._options.xmlMode&&name in voidElements||this._stack.push(name),this._cbs.onopentagname&&this._cbs.onopentagname(name),this._cbs.onopentag&&(this._attribs={})},Parser.prototype.onopentagend=function(){this._updatePosition(1),this._attribs&&(this._cbs.onopentag&&this._cbs.onopentag(this._tagname,this._attribs),this._attribs=null),!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in voidElements&&this._cbs.onclosetag(this._tagname),this._tagname=""},Parser.prototype.onclosetag=function(name){if(this._updatePosition(1),this._lowerCaseTagNames&&(name=name.toLowerCase()),!this._stack.length||name in voidElements&&!this._options.xmlMode)this._options.xmlMode||"br"!==name&&"p"!==name||(this.onopentagname(name),this._closeCurrentTag());else{var pos=this._stack.lastIndexOf(name);if(-1!==pos)if(this._cbs.onclosetag)for(pos=this._stack.length-pos;pos--;)this._cbs.onclosetag(this._stack.pop());else this._stack.length=pos;else"p"!==name||this._options.xmlMode||(this.onopentagname(name),this._closeCurrentTag())}},Parser.prototype.onselfclosingtag=function(){this._options.xmlMode||this._options.recognizeSelfClosing?this._closeCurrentTag():this.onopentagend()},Parser.prototype._closeCurrentTag=function(){var name=this._tagname;this.onopentagend(),this._stack[this._stack.length-1]===name&&(this._cbs.onclosetag&&this._cbs.onclosetag(name),this._stack.pop())},Parser.prototype.onattribname=function(name){this._lowerCaseAttributeNames&&(name=name.toLowerCase()),this._attribname=name},Parser.prototype.onattribdata=function(value){this._attribvalue+=value},Parser.prototype.onattribend=function(){this._cbs.onattribute&&this._cbs.onattribute(this._attribname,this._attribvalue),this._attribs&&!Object.prototype.hasOwnProperty.call(this._attribs,this._attribname)&&(this._attribs[this._attribname]=this._attribvalue),this._attribname="",this._attribvalue=""},Parser.prototype._getInstructionName=function(value){var idx=value.search(re_nameEnd),name=idx<0?value:value.substr(0,idx);return this._lowerCaseTagNames&&(name=name.toLowerCase()),name},Parser.prototype.ondeclaration=function(value){if(this._cbs.onprocessinginstruction){var name=this._getInstructionName(value);this._cbs.onprocessinginstruction("!"+name,"!"+value)}},Parser.prototype.onprocessinginstruction=function(value){if(this._cbs.onprocessinginstruction){var name=this._getInstructionName(value);this._cbs.onprocessinginstruction("?"+name,"?"+value)}},Parser.prototype.oncomment=function(value){this._updatePosition(4),this._cbs.oncomment&&this._cbs.oncomment(value),this._cbs.oncommentend&&this._cbs.oncommentend()},Parser.prototype.oncdata=function(value){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(),this._cbs.ontext&&this._cbs.ontext(value),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+value+"]]")},Parser.prototype.onerror=function(err){this._cbs.onerror&&this._cbs.onerror(err)},Parser.prototype.onend=function(){if(this._cbs.onclosetag)for(var i=this._stack.length;i>0;this._cbs.onclosetag(this._stack[--i]));this._cbs.onend&&this._cbs.onend()},Parser.prototype.reset=function(){this._cbs.onreset&&this._cbs.onreset(),this._tokenizer.reset(),this._tagname="",this._attribname="",this._attribs=null,this._stack=[],this._cbs.onparserinit&&this._cbs.onparserinit(this)},Parser.prototype.parseComplete=function(data){this.reset(),this.end(data)},Parser.prototype.write=function(chunk){this._tokenizer.write(chunk)},Parser.prototype.end=function(chunk){this._tokenizer.end(chunk)},Parser.prototype.pause=function(){this._tokenizer.pause()},Parser.prototype.resume=function(){this._tokenizer.resume()},Parser.prototype.parseChunk=Parser.prototype.write,Parser.prototype.done=Parser.prototype.end,module.exports=Parser},{"./Tokenizer.js":34,events:7,inherits:58}],32:[function(require,module,exports){function ProxyHandler(cbs){this._cbs=cbs||{}}module.exports=ProxyHandler;var EVENTS=require("./").EVENTS;Object.keys(EVENTS).forEach(function(name){if(0===EVENTS[name])ProxyHandler.prototype[name="on"+name]=function(){this._cbs[name]&&this._cbs[name]()};else if(1===EVENTS[name])ProxyHandler.prototype[name="on"+name]=function(a){this._cbs[name]&&this._cbs[name](a)};else{if(2!==EVENTS[name])throw Error("wrong number of arguments");ProxyHandler.prototype[name="on"+name]=function(a,b){this._cbs[name]&&this._cbs[name](a,b)}}})},{"./":36}],33:[function(require,module,exports){function Stream(options){Parser.call(this,new Cbs(this),options)}function Cbs(scope){this.scope=scope}module.exports=Stream;var Parser=require("./WritableStream.js");require("inherits")(Stream,Parser),Stream.prototype.readable=!0;var EVENTS=require("../").EVENTS;Object.keys(EVENTS).forEach(function(name){if(0===EVENTS[name])Cbs.prototype["on"+name]=function(){this.scope.emit(name)};else if(1===EVENTS[name])Cbs.prototype["on"+name]=function(a){this.scope.emit(name,a)};else{if(2!==EVENTS[name])throw Error("wrong number of arguments!");Cbs.prototype["on"+name]=function(a,b){this.scope.emit(name,a,b)}}})},{"../":36,"./WritableStream.js":35,inherits:58}],34:[function(require,module,exports){function whitespace(c){return" "===c||"\n"===c||"\t"===c||"\f"===c||"\r"===c}function ifElseState(upper,SUCCESS,FAILURE){var lower=upper.toLowerCase();return upper===lower?function(c){c===lower?this._state=SUCCESS:(this._state=FAILURE,this._index--)}:function(c){c===lower||c===upper?this._state=SUCCESS:(this._state=FAILURE,this._index--)}}function consumeSpecialNameChar(upper,NEXT_STATE){var lower=upper.toLowerCase();return function(c){c===lower||c===upper?this._state=NEXT_STATE:(this._state=IN_TAG_NAME,this._index--)}}function Tokenizer(options,cbs){this._state=TEXT,this._buffer="",this._sectionStart=0,this._index=0,this._bufferOffset=0,this._baseState=TEXT,this._special=SPECIAL_NONE,this._cbs=cbs,this._running=!0,this._ended=!1,this._xmlMode=!(!options||!options.xmlMode),this._decodeEntities=!(!options||!options.decodeEntities)}module.exports=Tokenizer;var decodeCodePoint=require("entities/lib/decode_codepoint.js"),entityMap=require("entities/maps/entities.json"),legacyMap=require("entities/maps/legacy.json"),xmlMap=require("entities/maps/xml.json"),i=0,TEXT=i++,BEFORE_TAG_NAME=i++,IN_TAG_NAME=i++,IN_SELF_CLOSING_TAG=i++,BEFORE_CLOSING_TAG_NAME=i++,IN_CLOSING_TAG_NAME=i++,AFTER_CLOSING_TAG_NAME=i++,BEFORE_ATTRIBUTE_NAME=i++,IN_ATTRIBUTE_NAME=i++,AFTER_ATTRIBUTE_NAME=i++,BEFORE_ATTRIBUTE_VALUE=i++,IN_ATTRIBUTE_VALUE_DQ=i++,IN_ATTRIBUTE_VALUE_SQ=i++,IN_ATTRIBUTE_VALUE_NQ=i++,BEFORE_DECLARATION=i++,IN_DECLARATION=i++,IN_PROCESSING_INSTRUCTION=i++,BEFORE_COMMENT=i++,IN_COMMENT=i++,AFTER_COMMENT_1=i++,AFTER_COMMENT_2=i++,BEFORE_CDATA_1=i++,BEFORE_CDATA_2=i++,BEFORE_CDATA_3=i++,BEFORE_CDATA_4=i++,BEFORE_CDATA_5=i++,BEFORE_CDATA_6=i++,IN_CDATA=i++,AFTER_CDATA_1=i++,AFTER_CDATA_2=i++,BEFORE_SPECIAL=i++,BEFORE_SPECIAL_END=i++,BEFORE_SCRIPT_1=i++,BEFORE_SCRIPT_2=i++,BEFORE_SCRIPT_3=i++,BEFORE_SCRIPT_4=i++,BEFORE_SCRIPT_5=i++,AFTER_SCRIPT_1=i++,AFTER_SCRIPT_2=i++,AFTER_SCRIPT_3=i++,AFTER_SCRIPT_4=i++,AFTER_SCRIPT_5=i++,BEFORE_STYLE_1=i++,BEFORE_STYLE_2=i++,BEFORE_STYLE_3=i++,BEFORE_STYLE_4=i++,AFTER_STYLE_1=i++,AFTER_STYLE_2=i++,AFTER_STYLE_3=i++,AFTER_STYLE_4=i++,BEFORE_ENTITY=i++,BEFORE_NUMERIC_ENTITY=i++,IN_NAMED_ENTITY=i++,IN_NUMERIC_ENTITY=i++,IN_HEX_ENTITY=i++,j=0,SPECIAL_NONE=j++,SPECIAL_SCRIPT=j++,SPECIAL_STYLE=j++;Tokenizer.prototype._stateText=function(c){"<"===c?(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._state=BEFORE_TAG_NAME,this._sectionStart=this._index):this._decodeEntities&&this._special===SPECIAL_NONE&&"&"===c&&(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._baseState=TEXT,this._state=BEFORE_ENTITY,this._sectionStart=this._index)},Tokenizer.prototype._stateBeforeTagName=function(c){"/"===c?this._state=BEFORE_CLOSING_TAG_NAME:"<"===c?(this._cbs.ontext(this._getSection()),this._sectionStart=this._index):">"===c||this._special!==SPECIAL_NONE||whitespace(c)?this._state=TEXT:"!"===c?(this._state=BEFORE_DECLARATION,this._sectionStart=this._index+1):"?"===c?(this._state=IN_PROCESSING_INSTRUCTION,this._sectionStart=this._index+1):(this._state=this._xmlMode||"s"!==c&&"S"!==c?IN_TAG_NAME:BEFORE_SPECIAL,this._sectionStart=this._index)},Tokenizer.prototype._stateInTagName=function(c){("/"===c||">"===c||whitespace(c))&&(this._emitToken("onopentagname"),this._state=BEFORE_ATTRIBUTE_NAME,this._index--)},Tokenizer.prototype._stateBeforeCloseingTagName=function(c){whitespace(c)||(">"===c?this._state=TEXT:this._special!==SPECIAL_NONE?"s"===c||"S"===c?this._state=BEFORE_SPECIAL_END:(this._state=TEXT,this._index--):(this._state=IN_CLOSING_TAG_NAME,this._sectionStart=this._index))},Tokenizer.prototype._stateInCloseingTagName=function(c){(">"===c||whitespace(c))&&(this._emitToken("onclosetag"),this._state=AFTER_CLOSING_TAG_NAME,this._index--)},Tokenizer.prototype._stateAfterCloseingTagName=function(c){">"===c&&(this._state=TEXT,this._sectionStart=this._index+1)},Tokenizer.prototype._stateBeforeAttributeName=function(c){">"===c?(this._cbs.onopentagend(),this._state=TEXT,this._sectionStart=this._index+1):"/"===c?this._state=IN_SELF_CLOSING_TAG:whitespace(c)||(this._state=IN_ATTRIBUTE_NAME,this._sectionStart=this._index)},Tokenizer.prototype._stateInSelfClosingTag=function(c){">"===c?(this._cbs.onselfclosingtag(),this._state=TEXT,this._sectionStart=this._index+1):whitespace(c)||(this._state=BEFORE_ATTRIBUTE_NAME,this._index--)},Tokenizer.prototype._stateInAttributeName=function(c){("="===c||"/"===c||">"===c||whitespace(c))&&(this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=AFTER_ATTRIBUTE_NAME,this._index--)},Tokenizer.prototype._stateAfterAttributeName=function(c){"="===c?this._state=BEFORE_ATTRIBUTE_VALUE:"/"===c||">"===c?(this._cbs.onattribend(),this._state=BEFORE_ATTRIBUTE_NAME,this._index--):whitespace(c)||(this._cbs.onattribend(),this._state=IN_ATTRIBUTE_NAME,this._sectionStart=this._index)},Tokenizer.prototype._stateBeforeAttributeValue=function(c){'"'===c?(this._state=IN_ATTRIBUTE_VALUE_DQ,this._sectionStart=this._index+1):"'"===c?(this._state=IN_ATTRIBUTE_VALUE_SQ,this._sectionStart=this._index+1):whitespace(c)||(this._state=IN_ATTRIBUTE_VALUE_NQ,this._sectionStart=this._index,this._index--)},Tokenizer.prototype._stateInAttributeValueDoubleQuotes=function(c){'"'===c?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=BEFORE_ATTRIBUTE_NAME):this._decodeEntities&&"&"===c&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=BEFORE_ENTITY,this._sectionStart=this._index)},Tokenizer.prototype._stateInAttributeValueSingleQuotes=function(c){"'"===c?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=BEFORE_ATTRIBUTE_NAME):this._decodeEntities&&"&"===c&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=BEFORE_ENTITY,this._sectionStart=this._index)},Tokenizer.prototype._stateInAttributeValueNoQuotes=function(c){whitespace(c)||">"===c?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=BEFORE_ATTRIBUTE_NAME,this._index--):this._decodeEntities&&"&"===c&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=BEFORE_ENTITY,this._sectionStart=this._index)},Tokenizer.prototype._stateBeforeDeclaration=function(c){this._state="["===c?BEFORE_CDATA_1:"-"===c?BEFORE_COMMENT:IN_DECLARATION},Tokenizer.prototype._stateInDeclaration=function(c){">"===c&&(this._cbs.ondeclaration(this._getSection()),this._state=TEXT,this._sectionStart=this._index+1)},Tokenizer.prototype._stateInProcessingInstruction=function(c){">"===c&&(this._cbs.onprocessinginstruction(this._getSection()),this._state=TEXT,this._sectionStart=this._index+1)},Tokenizer.prototype._stateBeforeComment=function(c){"-"===c?(this._state=IN_COMMENT,this._sectionStart=this._index+1):this._state=IN_DECLARATION},Tokenizer.prototype._stateInComment=function(c){"-"===c&&(this._state=AFTER_COMMENT_1)},Tokenizer.prototype._stateAfterComment1=function(c){this._state="-"===c?AFTER_COMMENT_2:IN_COMMENT},Tokenizer.prototype._stateAfterComment2=function(c){">"===c?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=TEXT,this._sectionStart=this._index+1):"-"!==c&&(this._state=IN_COMMENT)},Tokenizer.prototype._stateBeforeCdata1=ifElseState("C",BEFORE_CDATA_2,IN_DECLARATION),Tokenizer.prototype._stateBeforeCdata2=ifElseState("D",BEFORE_CDATA_3,IN_DECLARATION),Tokenizer.prototype._stateBeforeCdata3=ifElseState("A",BEFORE_CDATA_4,IN_DECLARATION),Tokenizer.prototype._stateBeforeCdata4=ifElseState("T",BEFORE_CDATA_5,IN_DECLARATION),Tokenizer.prototype._stateBeforeCdata5=ifElseState("A",BEFORE_CDATA_6,IN_DECLARATION),Tokenizer.prototype._stateBeforeCdata6=function(c){"["===c?(this._state=IN_CDATA,this._sectionStart=this._index+1):(this._state=IN_DECLARATION,this._index--)},Tokenizer.prototype._stateInCdata=function(c){"]"===c&&(this._state=AFTER_CDATA_1)},Tokenizer.prototype._stateAfterCdata1=function(char,SUCCESS){return function(c){c===char&&(this._state=SUCCESS)}}("]",AFTER_CDATA_2),Tokenizer.prototype._stateAfterCdata2=function(c){">"===c?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=TEXT,this._sectionStart=this._index+1):"]"!==c&&(this._state=IN_CDATA)},Tokenizer.prototype._stateBeforeSpecial=function(c){"c"===c||"C"===c?this._state=BEFORE_SCRIPT_1:"t"===c||"T"===c?this._state=BEFORE_STYLE_1:(this._state=IN_TAG_NAME,this._index--)},Tokenizer.prototype._stateBeforeSpecialEnd=function(c){this._special!==SPECIAL_SCRIPT||"c"!==c&&"C"!==c?this._special!==SPECIAL_STYLE||"t"!==c&&"T"!==c?this._state=TEXT:this._state=AFTER_STYLE_1:this._state=AFTER_SCRIPT_1},Tokenizer.prototype._stateBeforeScript1=consumeSpecialNameChar("R",BEFORE_SCRIPT_2),Tokenizer.prototype._stateBeforeScript2=consumeSpecialNameChar("I",BEFORE_SCRIPT_3),Tokenizer.prototype._stateBeforeScript3=consumeSpecialNameChar("P",BEFORE_SCRIPT_4),Tokenizer.prototype._stateBeforeScript4=consumeSpecialNameChar("T",BEFORE_SCRIPT_5),Tokenizer.prototype._stateBeforeScript5=function(c){("/"===c||">"===c||whitespace(c))&&(this._special=SPECIAL_SCRIPT),this._state=IN_TAG_NAME,this._index--},Tokenizer.prototype._stateAfterScript1=ifElseState("R",AFTER_SCRIPT_2,TEXT),Tokenizer.prototype._stateAfterScript2=ifElseState("I",AFTER_SCRIPT_3,TEXT),Tokenizer.prototype._stateAfterScript3=ifElseState("P",AFTER_SCRIPT_4,TEXT),Tokenizer.prototype._stateAfterScript4=ifElseState("T",AFTER_SCRIPT_5,TEXT),Tokenizer.prototype._stateAfterScript5=function(c){">"===c||whitespace(c)?(this._special=SPECIAL_NONE,this._state=IN_CLOSING_TAG_NAME,this._sectionStart=this._index-6,this._index--):this._state=TEXT},Tokenizer.prototype._stateBeforeStyle1=consumeSpecialNameChar("Y",BEFORE_STYLE_2),Tokenizer.prototype._stateBeforeStyle2=consumeSpecialNameChar("L",BEFORE_STYLE_3),Tokenizer.prototype._stateBeforeStyle3=consumeSpecialNameChar("E",BEFORE_STYLE_4),Tokenizer.prototype._stateBeforeStyle4=function(c){("/"===c||">"===c||whitespace(c))&&(this._special=SPECIAL_STYLE),this._state=IN_TAG_NAME,this._index--},Tokenizer.prototype._stateAfterStyle1=ifElseState("Y",AFTER_STYLE_2,TEXT),Tokenizer.prototype._stateAfterStyle2=ifElseState("L",AFTER_STYLE_3,TEXT),Tokenizer.prototype._stateAfterStyle3=ifElseState("E",AFTER_STYLE_4,TEXT),Tokenizer.prototype._stateAfterStyle4=function(c){">"===c||whitespace(c)?(this._special=SPECIAL_NONE,this._state=IN_CLOSING_TAG_NAME,this._sectionStart=this._index-5,this._index--):this._state=TEXT},Tokenizer.prototype._stateBeforeEntity=ifElseState("#",BEFORE_NUMERIC_ENTITY,IN_NAMED_ENTITY),Tokenizer.prototype._stateBeforeNumericEntity=ifElseState("X",IN_HEX_ENTITY,IN_NUMERIC_ENTITY),Tokenizer.prototype._parseNamedEntityStrict=function(){if(this._sectionStart+1<this._index){var entity=this._buffer.substring(this._sectionStart+1,this._index),map=this._xmlMode?xmlMap:entityMap;map.hasOwnProperty(entity)&&(this._emitPartial(map[entity]),this._sectionStart=this._index+1)}},Tokenizer.prototype._parseLegacyEntity=function(){var start=this._sectionStart+1,limit=this._index-start;for(limit>6&&(limit=6);limit>=2;){var entity=this._buffer.substr(start,limit);if(legacyMap.hasOwnProperty(entity))return this._emitPartial(legacyMap[entity]),void(this._sectionStart+=limit+1);limit--}},Tokenizer.prototype._stateInNamedEntity=function(c){";"===c?(this._parseNamedEntityStrict(),this._sectionStart+1<this._index&&!this._xmlMode&&this._parseLegacyEntity(),this._state=this._baseState):(c<"a"||c>"z")&&(c<"A"||c>"Z")&&(c<"0"||c>"9")&&(this._xmlMode||this._sectionStart+1===this._index||(this._baseState!==TEXT?"="!==c&&this._parseNamedEntityStrict():this._parseLegacyEntity()),this._state=this._baseState,this._index--)},Tokenizer.prototype._decodeNumericEntity=function(offset,base){var sectionStart=this._sectionStart+offset;if(sectionStart!==this._index){var entity=this._buffer.substring(sectionStart,this._index),parsed=parseInt(entity,base);this._emitPartial(decodeCodePoint(parsed)),this._sectionStart=this._index}else this._sectionStart--;this._state=this._baseState},Tokenizer.prototype._stateInNumericEntity=function(c){";"===c?(this._decodeNumericEntity(2,10),this._sectionStart++):(c<"0"||c>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(2,10),this._index--)},Tokenizer.prototype._stateInHexEntity=function(c){";"===c?(this._decodeNumericEntity(3,16),this._sectionStart++):(c<"a"||c>"f")&&(c<"A"||c>"F")&&(c<"0"||c>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(3,16),this._index--)},Tokenizer.prototype._cleanup=function(){this._sectionStart<0?(this._buffer="",this._index=0,this._bufferOffset+=this._index):this._running&&(this._state===TEXT?(this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._buffer="",this._bufferOffset+=this._index,this._index=0):this._sectionStart===this._index?(this._buffer="",this._bufferOffset+=this._index,this._index=0):(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart),this._sectionStart=0)},Tokenizer.prototype.write=function(chunk){this._ended&&this._cbs.onerror(Error(".write() after done!")),this._buffer+=chunk,this._parse()},Tokenizer.prototype._parse=function(){for(;this._index<this._buffer.length&&this._running;){var c=this._buffer.charAt(this._index);this._state===TEXT?this._stateText(c):this._state===BEFORE_TAG_NAME?this._stateBeforeTagName(c):this._state===IN_TAG_NAME?this._stateInTagName(c):this._state===BEFORE_CLOSING_TAG_NAME?this._stateBeforeCloseingTagName(c):this._state===IN_CLOSING_TAG_NAME?this._stateInCloseingTagName(c):this._state===AFTER_CLOSING_TAG_NAME?this._stateAfterCloseingTagName(c):this._state===IN_SELF_CLOSING_TAG?this._stateInSelfClosingTag(c):this._state===BEFORE_ATTRIBUTE_NAME?this._stateBeforeAttributeName(c):this._state===IN_ATTRIBUTE_NAME?this._stateInAttributeName(c):this._state===AFTER_ATTRIBUTE_NAME?this._stateAfterAttributeName(c):this._state===BEFORE_ATTRIBUTE_VALUE?this._stateBeforeAttributeValue(c):this._state===IN_ATTRIBUTE_VALUE_DQ?this._stateInAttributeValueDoubleQuotes(c):this._state===IN_ATTRIBUTE_VALUE_SQ?this._stateInAttributeValueSingleQuotes(c):this._state===IN_ATTRIBUTE_VALUE_NQ?this._stateInAttributeValueNoQuotes(c):this._state===BEFORE_DECLARATION?this._stateBeforeDeclaration(c):this._state===IN_DECLARATION?this._stateInDeclaration(c):this._state===IN_PROCESSING_INSTRUCTION?this._stateInProcessingInstruction(c):this._state===BEFORE_COMMENT?this._stateBeforeComment(c):this._state===IN_COMMENT?this._stateInComment(c):this._state===AFTER_COMMENT_1?this._stateAfterComment1(c):this._state===AFTER_COMMENT_2?this._stateAfterComment2(c):this._state===BEFORE_CDATA_1?this._stateBeforeCdata1(c):this._state===BEFORE_CDATA_2?this._stateBeforeCdata2(c):this._state===BEFORE_CDATA_3?this._stateBeforeCdata3(c):this._state===BEFORE_CDATA_4?this._stateBeforeCdata4(c):this._state===BEFORE_CDATA_5?this._stateBeforeCdata5(c):this._state===BEFORE_CDATA_6?this._stateBeforeCdata6(c):this._state===IN_CDATA?this._stateInCdata(c):this._state===AFTER_CDATA_1?this._stateAfterCdata1(c):this._state===AFTER_CDATA_2?this._stateAfterCdata2(c):this._state===BEFORE_SPECIAL?this._stateBeforeSpecial(c):this._state===BEFORE_SPECIAL_END?this._stateBeforeSpecialEnd(c):this._state===BEFORE_SCRIPT_1?this._stateBeforeScript1(c):this._state===BEFORE_SCRIPT_2?this._stateBeforeScript2(c):this._state===BEFORE_SCRIPT_3?this._stateBeforeScript3(c):this._state===BEFORE_SCRIPT_4?this._stateBeforeScript4(c):this._state===BEFORE_SCRIPT_5?this._stateBeforeScript5(c):this._state===AFTER_SCRIPT_1?this._stateAfterScript1(c):this._state===AFTER_SCRIPT_2?this._stateAfterScript2(c):this._state===AFTER_SCRIPT_3?this._stateAfterScript3(c):this._state===AFTER_SCRIPT_4?this._stateAfterScript4(c):this._state===AFTER_SCRIPT_5?this._stateAfterScript5(c):this._state===BEFORE_STYLE_1?this._stateBeforeStyle1(c):this._state===BEFORE_STYLE_2?this._stateBeforeStyle2(c):this._state===BEFORE_STYLE_3?this._stateBeforeStyle3(c):this._state===BEFORE_STYLE_4?this._stateBeforeStyle4(c):this._state===AFTER_STYLE_1?this._stateAfterStyle1(c):this._state===AFTER_STYLE_2?this._stateAfterStyle2(c):this._state===AFTER_STYLE_3?this._stateAfterStyle3(c):this._state===AFTER_STYLE_4?this._stateAfterStyle4(c):this._state===BEFORE_ENTITY?this._stateBeforeEntity(c):this._state===BEFORE_NUMERIC_ENTITY?this._stateBeforeNumericEntity(c):this._state===IN_NAMED_ENTITY?this._stateInNamedEntity(c):this._state===IN_NUMERIC_ENTITY?this._stateInNumericEntity(c):this._state===IN_HEX_ENTITY?this._stateInHexEntity(c):this._cbs.onerror(Error("unknown _state"),this._state),this._index++}this._cleanup()},Tokenizer.prototype.pause=function(){this._running=!1},Tokenizer.prototype.resume=function(){this._running=!0,this._index<this._buffer.length&&this._parse(),this._ended&&this._finish()},Tokenizer.prototype.end=function(chunk){this._ended&&this._cbs.onerror(Error(".end() after done!")),chunk&&this.write(chunk),this._ended=!0,this._running&&this._finish()},Tokenizer.prototype._finish=function(){this._sectionStart<this._index&&this._handleTrailingData(),this._cbs.onend()},Tokenizer.prototype._handleTrailingData=function(){var data=this._buffer.substr(this._sectionStart);this._state===IN_CDATA||this._state===AFTER_CDATA_1||this._state===AFTER_CDATA_2?this._cbs.oncdata(data):this._state===IN_COMMENT||this._state===AFTER_COMMENT_1||this._state===AFTER_COMMENT_2?this._cbs.oncomment(data):this._state!==IN_NAMED_ENTITY||this._xmlMode?this._state!==IN_NUMERIC_ENTITY||this._xmlMode?this._state!==IN_HEX_ENTITY||this._xmlMode?this._state!==IN_TAG_NAME&&this._state!==BEFORE_ATTRIBUTE_NAME&&this._state!==BEFORE_ATTRIBUTE_VALUE&&this._state!==AFTER_ATTRIBUTE_NAME&&this._state!==IN_ATTRIBUTE_NAME&&this._state!==IN_ATTRIBUTE_VALUE_SQ&&this._state!==IN_ATTRIBUTE_VALUE_DQ&&this._state!==IN_ATTRIBUTE_VALUE_NQ&&this._state!==IN_CLOSING_TAG_NAME&&this._cbs.ontext(data):(this._decodeNumericEntity(3,16),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._decodeNumericEntity(2,10),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._parseLegacyEntity(),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData()))},Tokenizer.prototype.reset=function(){Tokenizer.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},Tokenizer.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},Tokenizer.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},Tokenizer.prototype._emitToken=function(name){this._cbs[name](this._getSection()),this._sectionStart=-1},Tokenizer.prototype._emitPartial=function(value){this._baseState!==TEXT?this._cbs.onattribdata(value):this._cbs.ontext(value)}},{"entities/lib/decode_codepoint.js":52,"entities/maps/entities.json":55,"entities/maps/legacy.json":56,"entities/maps/xml.json":57}],35:[function(require,module,exports){function Stream(cbs,options){var parser=this._parser=new Parser(cbs,options),decoder=this._decoder=new StringDecoder;WritableStream.call(this,{decodeStrings:!1}),this.once("finish",function(){parser.end(decoder.end())})}module.exports=Stream;var Parser=require("./Parser.js"),WritableStream=require("stream").Writable||require("readable-stream").Writable,StringDecoder=require("string_decoder").StringDecoder,Buffer=require("buffer").Buffer;require("inherits")(Stream,WritableStream),WritableStream.prototype._write=function(chunk,encoding,cb){chunk instanceof Buffer&&(chunk=this._decoder.write(chunk)),this._parser.write(chunk),cb()}},{"./Parser.js":31,buffer:3,inherits:58,"readable-stream":2,stream:27,string_decoder:28}],36:[function(require,module,exports){function defineProp(name,value){return delete module.exports[name],module.exports[name]=value,value}var Parser=require("./Parser.js"),DomHandler=require("domhandler");module.exports={Parser:Parser,Tokenizer:require("./Tokenizer.js"),ElementType:require("domelementtype"),DomHandler:DomHandler,get FeedHandler(){return defineProp("FeedHandler",require("./FeedHandler.js"))},get Stream(){return defineProp("Stream",require("./Stream.js"))},get WritableStream(){return defineProp("WritableStream",require("./WritableStream.js"))},get ProxyHandler(){return defineProp("ProxyHandler",require("./ProxyHandler.js"))},get DomUtils(){return defineProp("DomUtils",require("domutils"))},get CollectingHandler(){return defineProp("CollectingHandler",require("./CollectingHandler.js"))},DefaultHandler:DomHandler,get RssHandler(){return defineProp("RssHandler",this.FeedHandler)},parseDOM:function(data,options){var handler=new DomHandler(options);return new Parser(handler,options).end(data),handler.dom},parseFeed:function(feed,options){var handler=new module.exports.FeedHandler(options);return new Parser(handler,options).end(feed),handler.dom},createDomStream:function(cb,options,elementCb){var handler=new DomHandler(cb,options,elementCb);return new Parser(handler,options)},EVENTS:{attribute:2,cdatastart:0,cdataend:0,text:1,processinginstruction:2,comment:1,commentend:0,closetag:1,opentag:2,opentagname:1,error:1,end:0}}},{"./CollectingHandler.js":29,"./FeedHandler.js":30,"./Parser.js":31,"./ProxyHandler.js":32,"./Stream.js":33,"./Tokenizer.js":34,"./WritableStream.js":35,domelementtype:37,domhandler:38,domutils:41}],37:[function(require,module,exports){module.exports={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",Doctype:"doctype",isTag:function(elem){return"tag"===elem.type||"script"===elem.type||"style"===elem.type}}},{}],38:[function(require,module,exports){function DomHandler(callback,options,elementCB){"object"==typeof callback?(elementCB=options,options=callback,callback=null):"function"==typeof options&&(elementCB=options,options=defaultOpts),this._callback=callback,this._options=options||defaultOpts,this._elementCB=elementCB,this.dom=[],this._done=!1,this._tagStack=[],this._parser=this._parser||null}var ElementType=require("domelementtype"),re_whitespace=/\s+/g,NodePrototype=require("./lib/node"),ElementPrototype=require("./lib/element"),defaultOpts={normalizeWhitespace:!1,withStartIndices:!1};DomHandler.prototype.onparserinit=function(parser){this._parser=parser},DomHandler.prototype.onreset=function(){DomHandler.call(this,this._callback,this._options,this._elementCB)},DomHandler.prototype.onend=function(){this._done||(this._done=!0,this._parser=null,this._handleCallback(null))},DomHandler.prototype._handleCallback=DomHandler.prototype.onerror=function(error){if("function"==typeof this._callback)this._callback(error,this.dom);else if(error)throw error},DomHandler.prototype.onclosetag=function(){var elem=this._tagStack.pop();this._elementCB&&this._elementCB(elem)},DomHandler.prototype._addDomElement=function(element){var parent=this._tagStack[this._tagStack.length-1],siblings=parent?parent.children:this.dom,previousSibling=siblings[siblings.length-1];element.next=null,this._options.withStartIndices&&(element.startIndex=this._parser.startIndex),this._options.withDomLvl1&&(element.__proto__="tag"===element.type?ElementPrototype:NodePrototype),previousSibling?(element.prev=previousSibling,previousSibling.next=element):element.prev=null,siblings.push(element),element.parent=parent||null},DomHandler.prototype.onopentag=function(name,attribs){var element={type:"script"===name?ElementType.Script:"style"===name?ElementType.Style:ElementType.Tag,name:name,attribs:attribs,children:[]};this._addDomElement(element),this._tagStack.push(element)},DomHandler.prototype.ontext=function(data){var lastTag,normalize=this._options.normalizeWhitespace||this._options.ignoreWhitespace;!this._tagStack.length&&this.dom.length&&(lastTag=this.dom[this.dom.length-1]).type===ElementType.Text?normalize?lastTag.data=(lastTag.data+data).replace(re_whitespace," "):lastTag.data+=data:this._tagStack.length&&(lastTag=this._tagStack[this._tagStack.length-1])&&(lastTag=lastTag.children[lastTag.children.length-1])&&lastTag.type===ElementType.Text?normalize?lastTag.data=(lastTag.data+data).replace(re_whitespace," "):lastTag.data+=data:(normalize&&(data=data.replace(re_whitespace," ")),this._addDomElement({data:data,type:ElementType.Text}))},DomHandler.prototype.oncomment=function(data){var lastTag=this._tagStack[this._tagStack.length-1];if(lastTag&&lastTag.type===ElementType.Comment)lastTag.data+=data;else{var element={data:data,type:ElementType.Comment};this._addDomElement(element),this._tagStack.push(element)}},DomHandler.prototype.oncdatastart=function(){var element={children:[{data:"",type:ElementType.Text}],type:ElementType.CDATA};this._addDomElement(element),this._tagStack.push(element)},DomHandler.prototype.oncommentend=DomHandler.prototype.oncdataend=function(){this._tagStack.pop()},DomHandler.prototype.onprocessinginstruction=function(name,data){this._addDomElement({name:name,data:data,type:ElementType.Directive})},module.exports=DomHandler},{"./lib/element":39,"./lib/node":40,domelementtype:37}],39:[function(require,module,exports){var NodePrototype=require("./node"),ElementPrototype=module.exports=Object.create(NodePrototype),domLvl1={tagName:"name"};Object.keys(domLvl1).forEach(function(key){var shorthand=domLvl1[key];Object.defineProperty(ElementPrototype,key,{get:function(){return this[shorthand]||null},set:function(val){return this[shorthand]=val,val}})})},{"./node":40}],40:[function(require,module,exports){var NodePrototype=module.exports={get firstChild(){var children=this.children;return children&&children[0]||null},get lastChild(){var children=this.children;return children&&children[children.length-1]||null},get nodeType(){return nodeTypes[this.type]||nodeTypes.element}},domLvl1={tagName:"name",childNodes:"children",parentNode:"parent",previousSibling:"prev",nextSibling:"next",nodeValue:"data"},nodeTypes={element:1,text:3,cdata:4,comment:8};Object.keys(domLvl1).forEach(function(key){var shorthand=domLvl1[key];Object.defineProperty(NodePrototype,key,{get:function(){return this[shorthand]||null},set:function(val){return this[shorthand]=val,val}})})},{}],41:[function(require,module,exports){var DomUtils=module.exports;[require("./lib/stringify"),require("./lib/traversal"),require("./lib/manipulation"),require("./lib/querying"),require("./lib/legacy"),require("./lib/helpers")].forEach(function(ext){Object.keys(ext).forEach(function(key){DomUtils[key]=ext[key].bind(DomUtils)})})},{"./lib/helpers":42,"./lib/legacy":43,"./lib/manipulation":44,"./lib/querying":45,"./lib/stringify":46,"./lib/traversal":47}],42:[function(require,module,exports){exports.removeSubsets=function(nodes){for(var node,ancestor,replace,idx=nodes.length;--idx>-1;){for(node=ancestor=nodes[idx],nodes[idx]=null,replace=!0;ancestor;){if(nodes.indexOf(ancestor)>-1){replace=!1,nodes.splice(idx,1);break}ancestor=ancestor.parent}replace&&(nodes[idx]=node)}return nodes};var POSITION_DISCONNECTED=1,POSITION_PRECEDING=2,POSITION_FOLLOWING=4,POSITION_CONTAINS=8,POSITION_CONTAINED_BY=16,comparePos=exports.compareDocumentPosition=function(nodeA,nodeB){var current,sharedParent,siblings,aSibling,bSibling,idx,aParents=[],bParents=[];if(nodeA===nodeB)return 0;for(current=nodeA;current;)aParents.unshift(current),current=current.parent;for(current=nodeB;current;)bParents.unshift(current),current=current.parent;for(idx=0;aParents[idx]===bParents[idx];)idx++;return 0===idx?POSITION_DISCONNECTED:(sharedParent=aParents[idx-1],siblings=sharedParent.children,aSibling=aParents[idx],bSibling=bParents[idx],siblings.indexOf(aSibling)>siblings.indexOf(bSibling)?sharedParent===nodeB?POSITION_FOLLOWING|POSITION_CONTAINED_BY:POSITION_FOLLOWING:sharedParent===nodeA?POSITION_PRECEDING|POSITION_CONTAINS:POSITION_PRECEDING)};exports.uniqueSort=function(nodes){var node,position,idx=nodes.length;for(nodes=nodes.slice();--idx>-1;)node=nodes[idx],(position=nodes.indexOf(node))>-1&&position<idx&&nodes.splice(idx,1);return nodes.sort(function(a,b){var relative=comparePos(a,b);return relative&POSITION_PRECEDING?-1:relative&POSITION_FOLLOWING?1:0}),nodes}},{}],43:[function(require,module,exports){function getAttribCheck(attrib,value){return"function"==typeof value?function(elem){return elem.attribs&&value(elem.attribs[attrib])}:function(elem){return elem.attribs&&elem.attribs[attrib]===value}}function combineFuncs(a,b){return function(elem){return a(elem)||b(elem)}}var ElementType=require("domelementtype"),isTag=exports.isTag=ElementType.isTag;exports.testElement=function(options,element){for(var key in options)if(options.hasOwnProperty(key)){if("tag_name"===key){if(!isTag(element)||!options.tag_name(element.name))return!1}else if("tag_type"===key){if(!options.tag_type(element.type))return!1}else if("tag_contains"===key){if(isTag(element)||!options.tag_contains(element.data))return!1}else if(!element.attribs||!options[key](element.attribs[key]))return!1}else;return!0};var Checks={tag_name:function(name){return"function"==typeof name?function(elem){return isTag(elem)&&name(elem.name)}:"*"===name?isTag:function(elem){return isTag(elem)&&elem.name===name}},tag_type:function(type){return"function"==typeof type?function(elem){return type(elem.type)}:function(elem){return elem.type===type}},tag_contains:function(data){return"function"==typeof data?function(elem){return!isTag(elem)&&data(elem.data)}:function(elem){return!isTag(elem)&&elem.data===data}}};exports.getElements=function(options,element,recurse,limit){var funcs=Object.keys(options).map(function(key){var value=options[key];return key in Checks?Checks[key](value):getAttribCheck(key,value)});return 0===funcs.length?[]:this.filter(funcs.reduce(combineFuncs),element,recurse,limit)},exports.getElementById=function(id,element,recurse){return Array.isArray(element)||(element=[element]),this.findOne(getAttribCheck("id",id),element,!1!==recurse)},exports.getElementsByTagName=function(name,element,recurse,limit){return this.filter(Checks.tag_name(name),element,recurse,limit)},exports.getElementsByTagType=function(type,element,recurse,limit){return this.filter(Checks.tag_type(type),element,recurse,limit)}},{domelementtype:37}],44:[function(require,module,exports){exports.removeElement=function(elem){if(elem.prev&&(elem.prev.next=elem.next),elem.next&&(elem.next.prev=elem.prev),elem.parent){var childs=elem.parent.children;childs.splice(childs.lastIndexOf(elem),1)}},exports.replaceElement=function(elem,replacement){var prev=replacement.prev=elem.prev;prev&&(prev.next=replacement);var next=replacement.next=elem.next;next&&(next.prev=replacement);var parent=replacement.parent=elem.parent;if(parent){var childs=parent.children;childs[childs.lastIndexOf(elem)]=replacement}},exports.appendChild=function(elem,child){if(child.parent=elem,1!==elem.children.push(child)){var sibling=elem.children[elem.children.length-2];sibling.next=child,child.prev=sibling,child.next=null}},exports.append=function(elem,next){var parent=elem.parent,currNext=elem.next;if(next.next=currNext,next.prev=elem,elem.next=next,next.parent=parent,currNext){if(currNext.prev=next,parent){var childs=parent.children;childs.splice(childs.lastIndexOf(currNext),0,next)}}else parent&&parent.children.push(next)},exports.prepend=function(elem,prev){var parent=elem.parent;if(parent){var childs=parent.children;childs.splice(childs.lastIndexOf(elem),0,prev)}elem.prev&&(elem.prev.next=prev),prev.parent=parent,prev.prev=elem.prev,prev.next=elem,elem.prev=prev}},{}],45:[function(require,module,exports){function find(test,elems,recurse,limit){for(var childs,result=[],i=0,j=elems.length;i<j&&!(test(elems[i])&&(result.push(elems[i]),--limit<=0))&&(childs=elems[i].children,!(recurse&&childs&&childs.length>0&&(childs=find(test,childs,recurse,limit),result=result.concat(childs),(limit-=childs.length)<=0)));i++);return result}function findOne(test,elems){for(var elem=null,i=0,l=elems.length;i<l&&!elem;i++)isTag(elems[i])&&(test(elems[i])?elem=elems[i]:elems[i].children.length>0&&(elem=findOne(test,elems[i].children)));return elem}function existsOne(test,elems){for(var i=0,l=elems.length;i<l;i++)if(isTag(elems[i])&&(test(elems[i])||elems[i].children.length>0&&existsOne(test,elems[i].children)))return!0;return!1}function findAll(test,elems){for(var result=[],i=0,j=elems.length;i<j;i++)isTag(elems[i])&&(test(elems[i])&&result.push(elems[i]),elems[i].children.length>0&&(result=result.concat(findAll(test,elems[i].children))));return result}var isTag=require("domelementtype").isTag;module.exports={filter:function(test,element,recurse,limit){return Array.isArray(element)||(element=[element]),"number"==typeof limit&&isFinite(limit)||(limit=1/0),find(test,element,!1!==recurse,limit)},find:find,findOneChild:function(test,elems){for(var i=0,l=elems.length;i<l;i++)if(test(elems[i]))return elems[i];return null},findOne:findOne,existsOne:existsOne,findAll:findAll}},{domelementtype:37}],46:[function(require,module,exports){function getText(elem){return Array.isArray(elem)?elem.map(getText).join(""):isTag(elem)||elem.type===ElementType.CDATA?getText(elem.children):elem.type===ElementType.Text?elem.data:""}var ElementType=require("domelementtype"),getOuterHTML=require("dom-serializer"),isTag=ElementType.isTag;module.exports={getInnerHTML:function(elem,opts){return elem.children?elem.children.map(function(elem){return getOuterHTML(elem,opts)}).join(""):""},getOuterHTML:getOuterHTML,getText:getText}},{"dom-serializer":48,domelementtype:37}],47:[function(require,module,exports){var getChildren=exports.getChildren=function(elem){return elem.children},getParent=exports.getParent=function(elem){return elem.parent};exports.getSiblings=function(elem){var parent=getParent(elem);return parent?getChildren(parent):[elem]},exports.getAttributeValue=function(elem,name){return elem.attribs&&elem.attribs[name]},exports.hasAttrib=function(elem,name){return!!elem.attribs&&hasOwnProperty.call(elem.attribs,name)},exports.getName=function(elem){return elem.name}},{}],48:[function(require,module,exports){function renderTag(elem,opts){"svg"===elem.name&&(opts={decodeEntities:opts.decodeEntities,xmlMode:!0});var tag="<"+elem.name,attribs=function(attributes,opts){if(attributes){var value,output="";for(var key in attributes)value=attributes[key],output&&(output+=" "),!value&&booleanAttributes[key]?output+=key:output+=key+'="'+(opts.decodeEntities?entities.encodeXML(value):value)+'"';return output}}(elem.attribs,opts);return attribs&&(tag+=" "+attribs),!opts.xmlMode||elem.children&&0!==elem.children.length?(tag+=">",elem.children&&(tag+=render(elem.children,opts)),singleTag[elem.name]&&!opts.xmlMode||(tag+="</"+elem.name+">")):tag+="/>",tag}var ElementType=require("domelementtype"),entities=require("entities"),booleanAttributes={__proto__:null,allowfullscreen:!0,async:!0,autofocus:!0,autoplay:!0,checked:!0,controls:!0,default:!0,defer:!0,disabled:!0,hidden:!0,ismap:!0,loop:!0,multiple:!0,muted:!0,open:!0,readonly:!0,required:!0,reversed:!0,scoped:!0,seamless:!0,selected:!0,typemustmatch:!0},unencodedElements={__proto__:null,style:!0,script:!0,xmp:!0,iframe:!0,noembed:!0,noframes:!0,plaintext:!0,noscript:!0},singleTag={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},render=module.exports=function(dom,opts){Array.isArray(dom)||dom.cheerio||(dom=[dom]),opts=opts||{};for(var output="",i=0;i<dom.length;i++){var elem=dom[i];"root"===elem.type?output+=render(elem.children,opts):ElementType.isTag(elem)?output+=renderTag(elem,opts):elem.type===ElementType.Directive?output+=function(elem){return"<"+elem.data+">"}(elem):elem.type===ElementType.Comment?output+=function(elem){return"\x3c!--"+elem.data+"--\x3e"}(elem):elem.type===ElementType.CDATA?output+=function(elem){return"<![CDATA["+elem.children[0].data+"]]>"}(elem):output+=function(elem,opts){var data=elem.data||"";return!opts.decodeEntities||elem.parent&&elem.parent.name in unencodedElements||(data=entities.encodeXML(data)),data}(elem,opts)}return output}},{domelementtype:49,entities:50}],49:[function(require,module,exports){module.exports={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",isTag:function(elem){return"tag"===elem.type||"script"===elem.type||"style"===elem.type}}},{}],50:[function(require,module,exports){var encode=require("./lib/encode.js"),decode=require("./lib/decode.js");exports.decode=function(data,level){return(!level||level<=0?decode.XML:decode.HTML)(data)},exports.decodeStrict=function(data,level){return(!level||level<=0?decode.XML:decode.HTMLStrict)(data)},exports.encode=function(data,level){return(!level||level<=0?encode.XML:encode.HTML)(data)},exports.encodeXML=encode.XML,exports.encodeHTML4=exports.encodeHTML5=exports.encodeHTML=encode.HTML,exports.decodeXML=exports.decodeXMLStrict=decode.XML,exports.decodeHTML4=exports.decodeHTML5=exports.decodeHTML=decode.HTML,exports.decodeHTML4Strict=exports.decodeHTML5Strict=exports.decodeHTMLStrict=decode.HTMLStrict,exports.escape=encode.escape},{"./lib/decode.js":51,"./lib/encode.js":53}],51:[function(require,module,exports){function getStrictDecoder(map){var keys=Object.keys(map).join("|"),replace=getReplacer(map);keys+="|#[xX][\\da-fA-F]+|#\\d+";var re=new RegExp("&(?:"+keys+");","g");return function(str){return String(str).replace(re,replace)}}function sorter(a,b){return a<b?1:-1}function getReplacer(map){return function(str){return"#"===str.charAt(1)?decodeCodePoint("X"===str.charAt(2)||"x"===str.charAt(2)?parseInt(str.substr(3),16):parseInt(str.substr(2),10)):map[str.slice(1,-1)]}}var entityMap=require("../maps/entities.json"),legacyMap=require("../maps/legacy.json"),xmlMap=require("../maps/xml.json"),decodeCodePoint=require("./decode_codepoint.js"),decodeXMLStrict=getStrictDecoder(xmlMap),decodeHTMLStrict=getStrictDecoder(entityMap),decodeHTML=function(){function replacer(str){return";"!==str.substr(-1)&&(str+=";"),replace(str)}for(var legacy=Object.keys(legacyMap).sort(sorter),keys=Object.keys(entityMap).sort(sorter),i=0,j=0;i<keys.length;i++)legacy[j]===keys[i]?(keys[i]+=";?",j++):keys[i]+=";";var re=new RegExp("&(?:"+keys.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),replace=getReplacer(entityMap);return function(str){return String(str).replace(re,replacer)}}();module.exports={XML:decodeXMLStrict,HTML:decodeHTML,HTMLStrict:decodeHTMLStrict}},{"../maps/entities.json":55,"../maps/legacy.json":56,"../maps/xml.json":57,"./decode_codepoint.js":52}],52:[function(require,module,exports){var decodeMap=require("../maps/decode.json");module.exports=function(codePoint){if(codePoint>=55296&&codePoint<=57343||codePoint>1114111)return"�";codePoint in decodeMap&&(codePoint=decodeMap[codePoint]);var output="";return codePoint>65535&&(codePoint-=65536,output+=String.fromCharCode(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),output+=String.fromCharCode(codePoint)}},{"../maps/decode.json":54}],53:[function(require,module,exports){function getInverseObj(obj){return Object.keys(obj).sort().reduce(function(inverse,name){return inverse[obj[name]]="&"+name+";",inverse},{})}function getInverseReplacer(inverse){var single=[],multiple=[];return Object.keys(inverse).forEach(function(k){1===k.length?single.push("\\"+k):multiple.push(k)}),multiple.unshift("["+single.join("")+"]"),new RegExp(multiple.join("|"),"g")}function singleCharReplacer(c){return"&#x"+c.charCodeAt(0).toString(16).toUpperCase()+";"}function astralReplacer(c){return"&#x"+(1024*(c.charCodeAt(0)-55296)+c.charCodeAt(1)-56320+65536).toString(16).toUpperCase()+";"}function getInverse(inverse,re){function func(name){return inverse[name]}return function(data){return data.replace(re,func).replace(re_astralSymbols,astralReplacer).replace(re_nonASCII,singleCharReplacer)}}var inverseXML=getInverseObj(require("../maps/xml.json")),xmlReplacer=getInverseReplacer(inverseXML);exports.XML=getInverse(inverseXML,xmlReplacer);var inverseHTML=getInverseObj(require("../maps/entities.json")),htmlReplacer=getInverseReplacer(inverseHTML);exports.HTML=getInverse(inverseHTML,htmlReplacer);var re_nonASCII=/[^\0-\x7F]/g,re_astralSymbols=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,re_xmlChars=getInverseReplacer(inverseXML);exports.escape=function(data){return data.replace(re_xmlChars,singleCharReplacer).replace(re_astralSymbols,astralReplacer).replace(re_nonASCII,singleCharReplacer)}},{"../maps/entities.json":55,"../maps/xml.json":57}],54:[function(require,module,exports){module.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},{}],55:[function(require,module,exports){module.exports={Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",amp:"&",AMP:"&",andand:"⩕",And:"⩓",and:"∧",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angmsd:"∡",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",apacir:"⩯",ap:"≈",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxHd:"╤",boxhD:"╥",boxHD:"╦",boxhu:"┴",boxHu:"╧",boxhU:"╨",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsolb:"⧅",bsol:"\\",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",capand:"⩄",capbrcup:"⩉",capcap:"⩋",cap:"∩",Cap:"⋒",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:"𝔠",Cfr:"ℭ",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cir:"○",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cup:"∪",Cup:"⋓",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",Darr:"↡",dArr:"⇓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",ddagger:"‡",ddarr:"⇊",DD:"ⅅ",dd:"ⅆ",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrowBar:"⤓",downarrow:"↓",DownArrow:"↓",Downarrow:"⇓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVectorBar:"⥖",DownLeftVector:"↽",DownRightTeeVector:"⥟",DownRightVectorBar:"⥗",DownRightVector:"⇁",DownTeeArrow:"↧",DownTee:"⊤",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",Ecirc:"Ê",ecirc:"ê",ecir:"≖",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",edot:"ė",eDot:"≑",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp13:" ",emsp14:" ",emsp:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",ge:"≥",gE:"≧",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",gescc:"⪩",ges:"⩾",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gla:"⪥",gl:"≷",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",gtcc:"⪧",gtcir:"⩺",gt:">",GT:">",Gt:"≫",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",harrcir:"⥈",harr:"↔",hArr:"⇔",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"𝔥",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",ifr:"𝔦",Ifr:"ℑ",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",Im:"ℑ",imof:"⊷",imped:"Ƶ",Implies:"⇒",incare:"℅",in:"∈",infin:"∞",infintie:"⧝",inodot:"ı",intcal:"⊺",int:"∫",Int:"∬",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larrb:"⇤",larrbfs:"⤟",larr:"←",Larr:"↞",lArr:"⇐",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",latail:"⤙",lAtail:"⤛",lat:"⪫",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",LeftArrowBar:"⇤",leftarrow:"←",LeftArrow:"←",Leftarrow:"⇐",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVectorBar:"⥙",LeftDownVector:"⇃",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTeeArrow:"↤",LeftTee:"⊣",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangleBar:"⧏",LeftTriangle:"⊲",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVectorBar:"⥘",LeftUpVector:"↿",LeftVectorBar:"⥒",LeftVector:"↼",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",lescc:"⪨",les:"⩽",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",llarr:"⇇",ll:"≪",Ll:"⋘",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoustache:"⎰",lmoust:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftrightarrow:"⟷",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longmapsto:"⟼",longrightarrow:"⟶",LongRightArrow:"⟶",Longrightarrow:"⟹",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",ltcc:"⪦",ltcir:"⩹",lt:"<",LT:"<",Lt:"≪",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",midast:"*",midcir:"⫰",mid:"∣",middot:"·",minusb:"⊟",minus:"−",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natural:"♮",naturals:"ℕ",natur:"♮",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",ne:"≠",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nlE:"≦̸",nle:"≰",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangleBar:"⧏̸",NotLeftTriangle:"⋪",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangleBar:"⧐̸",NotRightTriangle:"⋫",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",nparallel:"∦",npar:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",nprec:"⊀",npreceq:"⪯̸",npre:"⪯̸",nrarrc:"⤳̸",nrarr:"↛",nrArr:"⇏",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",Ocirc:"Ô",ocirc:"ô",ocir:"⊚",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",orarr:"↻",Or:"⩔",or:"∨",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",otimesas:"⨶",Otimes:"⨷",otimes:"⊗",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",para:"¶",parallel:"∥",par:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plus:"+",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",prap:"⪷",Pr:"⪻",pr:"≺",prcue:"≼",precapprox:"⪷",prec:"≺",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",pre:"⪯",prE:"⪳",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportional:"∝",Proportion:"∷",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarr:"→",Rarr:"↠",rArr:"⇒",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",Re:"ℜ",rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"𝔯",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrowBar:"⇥",rightarrow:"→",RightArrow:"→",Rightarrow:"⇒",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVectorBar:"⥕",RightDownVector:"⇂",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTeeArrow:"↦",RightTee:"⊢",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangleBar:"⧐",RightTriangle:"⊳",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVectorBar:"⥔",RightUpVector:"↾",RightVectorBar:"⥓",RightVector:"⇀",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoustache:"⎱",rmoust:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",scap:"⪸",Scaron:"Š",scaron:"š",Sc:"⪼",sc:"≻",sccue:"≽",sce:"⪰",scE:"⪴",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdotb:"⊡",sdot:"⋅",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",solbar:"⌿",solb:"⧄",sol:"/",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squ:"□",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succapprox:"⪸",succ:"≻",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup1:"¹",sup2:"²",sup3:"³",sup:"⊃",Sup:"⋑",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",therefore:"∴",Therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",ThinSpace:" ",thinsp:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",timesbar:"⨱",timesb:"⊠",times:"×",timesd:"⨰",tint:"∭",toea:"⤨",topbot:"⌶",topcir:"⫱",top:"⊤",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",uarr:"↑",Uarr:"↟",uArr:"⇑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrowBar:"⤒",uparrow:"↑",UpArrow:"↑",Uparrow:"⇑",UpArrowDownArrow:"⇅",updownarrow:"↕",UpDownArrow:"↕",Updownarrow:"⇕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTeeArrow:"↥",UpTee:"⊥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",Vcy:"В",vcy:"в",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",veebar:"⊻",vee:"∨",Vee:"⋁",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xharr:"⟷",xhArr:"⟺",Xi:"Ξ",xi:"ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",yuml:"ÿ",Yuml:"Ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",zfr:"𝔷",Zfr:"ℨ",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}},{}],56:[function(require,module,exports){module.exports={Aacute:"Á",aacute:"á",Acirc:"Â",acirc:"â",acute:"´",AElig:"Æ",aelig:"æ",Agrave:"À",agrave:"à",amp:"&",AMP:"&",Aring:"Å",aring:"å",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",brvbar:"¦",Ccedil:"Ç",ccedil:"ç",cedil:"¸",cent:"¢",copy:"©",COPY:"©",curren:"¤",deg:"°",divide:"÷",Eacute:"É",eacute:"é",Ecirc:"Ê",ecirc:"ê",Egrave:"È",egrave:"è",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",frac12:"½",frac14:"¼",frac34:"¾",gt:">",GT:">",Iacute:"Í",iacute:"í",Icirc:"Î",icirc:"î",iexcl:"¡",Igrave:"Ì",igrave:"ì",iquest:"¿",Iuml:"Ï",iuml:"ï",laquo:"«",lt:"<",LT:"<",macr:"¯",micro:"µ",middot:"·",nbsp:" ",not:"¬",Ntilde:"Ñ",ntilde:"ñ",Oacute:"Ó",oacute:"ó",Ocirc:"Ô",ocirc:"ô",Ograve:"Ò",ograve:"ò",ordf:"ª",ordm:"º",Oslash:"Ø",oslash:"ø",Otilde:"Õ",otilde:"õ",Ouml:"Ö",ouml:"ö",para:"¶",plusmn:"±",pound:"£",quot:'"',QUOT:'"',raquo:"»",reg:"®",REG:"®",sect:"§",shy:"­",sup1:"¹",sup2:"²",sup3:"³",szlig:"ß",THORN:"Þ",thorn:"þ",times:"×",Uacute:"Ú",uacute:"ú",Ucirc:"Û",ucirc:"û",Ugrave:"Ù",ugrave:"ù",uml:"¨",Uuml:"Ü",uuml:"ü",Yacute:"Ý",yacute:"ý",yen:"¥",yuml:"ÿ"}},{}],57:[function(require,module,exports){module.exports={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}},{}],58:[function(require,module,exports){arguments[4][8][0].apply(exports,arguments)},{dup:8}],59:[function(require,module,exports){module.exports=function(string){return string.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}},{}],60:[function(require,module,exports){module.exports=function(){for(var target={},i=0;i<arguments.length;i++){var source=arguments[i];for(var key in source)hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var hasOwnProperty=Object.prototype.hasOwnProperty},{}]},{},[1])(1)}),function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?exports.iiifEventedCanvas=factory():root.iiifEventedCanvas=factory()}(this,function(){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.i=function(value){return value},__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=4)}([function(module,exports){var ImageResource=function(config){"use strict";this.id=config.id,this.label=config.label||"No Label",this.needed=config.needed||!1,this.visible=config.visible||!1,this.clipRegion=config.clipRegion,this.opacity=config.opacity||1,this.bounds=config.bounds||{x:0,y:0,width:1,height:1},this.zIndex=config.zIndex,this.tileSource=config.tileSource,this.thumbUrl=config.thumbUrl,this.dynamic=config.dynamic||!1,this.imageType=config.imageType||"main",this.status="initialized",this.parent=config.parent,this.dispatcher=config.parent.dispatcher};ImageResource.prototype={show:function(timeout){this.needed||this.setNeeded(!0),this.visible=!0,this.dispatcher.emit("image-show",this)},hide:function(timeout){this.visible=!1,this.dispatcher.emit("image-hide",this)},getVisible:function(){return this.visible},setNeeded:function(needed){this.needed=needed,needed&&this.dispatcher.emit("image-needed",this)},getThumbnailNeeded:function(){return this.needed},getFullNeeded:function(){return this.needed},setOpacity:function(opacity){this.opacity=opacity,this.visible&&this.dispatcher.emit("image-opacity-updated",this)},getOpacity:function(){return this.opacity},getImageType:function(){return this.imageType},getLocalBounds:function(){return this.bounds},getGlobalBounds:function(){return{x:this.parent.bounds.x+this.parent.bounds.width*this.bounds.x,y:this.parent.bounds.y+this.parent.bounds.width*this.bounds.y,width:this.parent.bounds.width*this.bounds.width,height:this.parent.bounds.height*this.bounds.height}},containsGlobalPoint:function(point){var bounds=this.getGlobalBounds(),rectRight=bounds.x+bounds.width,rectBottom=bounds.y+bounds.height;return bounds.x<=point.x&&rectRight>=point.x&&bounds.y<=point.y&&rectBottom>=point.y},setStatus:function(status){this.status=status,this.dispatcher.emit("image-status-updated",this)},getStatus:function(){return this.status},remove:function(){this.dispatcher.emit("image-removed",this)},moveToIndex:function(index){this.parent.moveToIndex(this,index)},moveToBottom:function(){this.parent.moveToBottom(this)},moveToTop:function(image){this.parent.moveToTop(this)},insertAboveIndex:function(image,index){this.parent.insertAboveIndex(this,index)},insertBelowIndex:function(image,index){this.parent.insertBelowIndex(this,index)},insertAboveResource:function(image,resource){this.parent.insertAboveResource(this,resource)},insertBelowResource:function(image,resource){this.parent.insertBelowResource(this,resource)},moveUpOne:function(image){this.parent.moveUpOne(this)},moveDownOne:function(image){this.parent.moveDownOne(this)}},module.exports=ImageResource},function(module,exports,__webpack_require__){"use strict";var ImageResource=__webpack_require__(0),getThumbUrl=function(resource,width){var serviceVersion;serviceVersion="http://iiif.io/api/image/2/context.json"==resource["@context"]?"2.0":"1.1";var buildResourceSize=function(){return"/full/"+width+",/"},id=resource["@id"];if(id.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)$/))return id.replace("/full/full/",buildResourceSize());var format=function(mimeType){switch(mimeType){case"image/jpeg":case"image/jpg":return"jpg";case"image/png":return"png";case"image/gif":return"gif";default:throw"Unsupported image format for LegacyTileSource."}}(resource.format);return resource.service["@id"]+buildResourceSize()+"0/"+("2.0"===serviceVersion?"default":"native")+"."+format},getThumbLevel=function(resource,width,height){var scaleFactor=200/width,scaledWidth=width*scaleFactor,scaledHeight=height*scaleFactor;return resource.default?getThumbLevel(resource.default,scaledWidth,scaledHeight):{url:getThumbUrl(resource,scaledWidth),height:height,width:width}},makeThumbnailConfig=function(resource,parent){var bounds=parent.getBounds();return{tileSource:{type:"legacy-image-pyramid",levels:[getThumbLevel(resource,bounds.width,bounds.height)]},parent:parent,imageType:"thumbnail",dynamic:!1,zIndex:9999}},ThumbnailFactory=function(canvas,parent){if(canvas.thumbnail)return new ImageResource(makeThumbnailConfig(canvas.thumbnail,parent));if(canvas.images)try{var config=makeThumbnailConfig(canvas.images[0].resource,parent);return new ImageResource(config)}catch(error){if("Unsupported image format for LegacyTileSource."==error)return"A thumbnail cannot be built for this object";throw error}};ThumbnailFactory.getThumbUrl=getThumbUrl,module.exports=ThumbnailFactory},function(module,exports,__webpack_require__){__webpack_require__(0);var ImageResourceFactory=__webpack_require__(3),ThumbnailFactory=__webpack_require__(1),CanvasObject=function(config){"use strict";var self=this;this.dispatcher=config.dispatcher,this.id=config.canvas["@id"],this.label=config.canvas.label,this.canvas=config.canvas,this.clipRegion=config.clipRegion,this.opacity=config.opacity||1,this.index=config.index,this.bounds={x:config.x||0,y:config.y||0,height:config.canvas.height,width:config.canvas.width},this.viewingHint=config.canvas.viewingHint,this.images=[],config.canvas.images&&config.canvas.images.forEach(function(image){var imageResources=ImageResourceFactory(image,self);imageResources&&(self.images=self.images.concat(imageResources))}),this.thumbnailResource=ThumbnailFactory(this.canvas,self)};CanvasObject.prototype={containsPoint:function(point){var rectRight=this.bounds.x+this.bounds.width,rectBottom=this.bounds.y+this.bounds.height;return this.bounds.x<=point.x&&rectRight>=point.x&&this.bounds.y<=point.y&&rectBottom>=point.y},getVisibleImages:function(){return this.images.filter(function(image){return!0===image.visible})},getAlternateImages:function(){return this.images.filter(function(image){return"alternate"===image.imageType})},getMainImages:function(){return this.images.filter(function(image){return"main"===image.imageType})},getImageById:function(id){return this.images.filter(function(image){return image.id===id})[0]},getThumbnailResource:function(){return this.thumbnailResource},setBounds:function(x,y,width,height){this.bounds.x=x,this.bounds.y=y,this.bounds.width=width,this.bounds.height=height,this.dispatcher.emit("canvas-position-updated",this)},getBounds:function(){var self=this;return{x:this.bounds.x,y:this.bounds.y,width:this.bounds.width,height:this.bounds.height,getTopLeft:function(){return{x:self.bounds.x,y:self.bounds.y}}}},canvasToWorldCoordinates:function(canvasRegion){var scaleFactor=this.bounds.width/this.canvas.width;return{x:this.bounds.x+canvasRegion.x*scaleFactor,y:this.bounds.y+canvasRegion.y*scaleFactor,width:canvasRegion.width*scaleFactor,height:canvasRegion.height*scaleFactor}},getAspectRatio:function(){return this.bounds.width/this.bounds.height},getThumbnailNeeded:function(){return this.thumbnailNeeded},setThumbnailNeeded:function(needed){this.thumbnailNeeded=needed,needed&&(this.thumbnailResource.setNeeded(!0),this.dispatcher.emit("canvas-thumbnail-needed",this))},show:function(timeout){var self=this;this.needed||this.setNeeded(!0),this.visible=!0,this.getMainImages().forEach(function(image){image.show(),self.dispatcher.on("image-status-updated",function(){"drawn"===image.getStatus()&&self.thumbnailResource.remove()})}),this.dispatcher.emit("canvas-show",this)},hide:function(timeout){this.visible=!1,this.dispatcher.emit("canvas-hide",this)},getVisible:function(){return this.visible},setNeeded:function(needed){this.needed=needed,needed&&this.dispatcher.emit("canvas-needed",this)},getNeeded:function(){return this.needed},getOpacity:function(){return this.opacity},setOpacity:function(opacity){this.opacity=opacity,this.images.forEach(function(image){image.updateOpacity()})},_floatImagesToBottom:function(){var i=0;for(i;i<this.images;i++)this.images[i].zIndex=i,this.images[i].updateItemIndex()},moveToIndex:function(image,index){this._floatImagesToBottom();var oldIndex=this.images.indexOf(image);if(index!==oldIndex&&-1!==oldIndex){if(index>=this.images.length)throw new Error("Index bigger than number of images.");image.zIndex=index,this.images.splice(oldIndex,1),this.images.splice(index,0,image),image.updateItemIndex()}},moveToBottom:function(image){this.moveToIndex(image,0)},moveToTop:function(image){this.moveToIndex(image,this.images.length-1)},insertAboveIndex:function(image,index){0!==index&&this.moveToIndex(image,index-1)},insertBelowIndex:function(image,index){index<this.images.length-1&&this.moveToIndex(image,index+1)},insertAboveResource:function(image,resource){this.insertAboveIndex(image,this.images.indexOf(resource))},insertBelowResource:function(image,resource){this.insertBelowIndex(image,this.images.indexOf(resource))},moveUpOne:function(image){this.insertAboveResource(image,image)},moveDownOne:function(image){this.insertBelowResource(image,image)}},module.exports=CanvasObject},function(module,exports,__webpack_require__){var ImageResource=__webpack_require__(0),ThumbnailFactory=__webpack_require__(1),_getRectFromStringArray=function(arr){var rectArray=arr.map(function(number){return parseInt(number,10)});return{x:rectArray[0],y:rectArray[1],width:rectArray[2],height:rectArray[3]}},_getSegmentFromUrl=function(url){var urlParts=url.split("#"),segment=null;if(urlParts.length>1){var bounds=urlParts[1].split("=");segment=_getRectFromStringArray(bounds[1].split(","))}return segment},_buildImageConfig=function(resource){if("rdf:nil"!=resource){if(resource.full)return _buildImageConfig(resource.full);var isDynamic=!!resource.service&&("http://iiif.io/api/image/2/context.json"==resource.service["@context"]||"https://iiif.io/api/image/2/context.json"==resource.service["@context"]||"http://iiif.io/api/image/1/context.json"==resource.service["@context"]||"https://iiif.io/api/image/1/context.json"==resource.service["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"==resource.service["@context"]),idObj=resource;isDynamic&&(idObj=resource.service);var id=idObj["@id"];return{id:id.replace(/[^a-z0-9-_]+/gi,"")+Math.floor(1e3*Math.random()),label:resource.label,tileSource:isDynamic?id.replace(/\/+$/,"")+"/info.json":{type:"image",url:id},clipRegion:_getSegmentFromUrl(id),dynamic:isDynamic,thumbUrl:ThumbnailFactory.getThumbUrl(resource,200)}}};module.exports=function(image,parent){var resourceType=image.resource["@type"],_makeImageFromConfig=function(config){if(config){config.parent=parent;var bounds=_getSegmentFromUrl(image.on);return bounds&&(config.imageType="detail",config.bounds=function(bounds){return{x:bounds.x/parent.bounds.width,y:bounds.y/parent.bounds.width,width:bounds.width/parent.bounds.width,height:bounds.height/parent.bounds.height}}(bounds)),new ImageResource(config)}};switch(resourceType){case"dctypes:Image":case"dcTypes:Image":case"dcterms:Image":case"dcTerms:Image":var config=_buildImageConfig(image.resource,parent);return _makeImageFromConfig(config);case"oa:Choice":return function(resource){var _buildImageChoice=function(item,type){var config=_buildImageConfig(item);return config&&(config.imageType=type),config},configs=[],choice=_buildImageChoice(resource.default,"main");return choice&&configs.push(choice),resource.item.forEach(function(item){var choice=_buildImageChoice(item,"alternate");choice&&configs.push(choice)}),configs}(image.resource).map(function(config){return _makeImageFromConfig(config)});case"oa:SpecificResource":var resource=image.resource;if((config=_buildImageConfig(resource))&&resource.selector&&resource.selector.region){var clipArray=resource.selector.region.split(",");config.clipRegion=_getRectFromStringArray(clipArray)}return _makeImageFromConfig(config);default:throw new Error("Cannot create an image from type "+resourceType)}}},function(module,exports,__webpack_require__){var CanvasObject=__webpack_require__(2);module.exports=CanvasObject}])}),function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?exports.manifestLayout=factory():root.manifestLayout=factory()}(this,function(){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports){module.exports=function(options){function pruneCanvas(canvas,index){return{id:canvas["@id"],label:canvas.label,height:canvas.height,width:canvas.width,aspectRatio:canvas.width/canvas.height,selected:canvas["@id"]===selectedCanvas,sequencePosition:index}}function fitHeight(canvas,canvasHeight){canvas.aspectRatio;var scaleFactor=canvasHeight/canvas.height;return canvas.height=canvasHeight,canvas.width=canvas.width*scaleFactor,canvas}function frame(canvas,padding){return canvas.localX=padding.left,canvas.localY=padding.top,{width:canvas.width+padding.left+padding.right,height:canvas.height+padding.top+padding.bottom,canvas:canvas}}function bindCanvases(canvases,viewingMode,viewingDirection,framePadding,facingCanvasPadding){if("paged"!==viewingMode){if("continuous"===viewingMode){var boundPagePadding={top:framePadding.top,bottom:framePadding.bottom,left:0,right:0};return canvases.map(function(canvas){return frame(canvas,boundPagePadding)})}return canvases.map(function(canvas){return frame(canvas,framePadding)})}var pages=canvases.filter(function(canvas){return"non-paged"!==canvas.viewingHint});return"left-to-right"===viewingDirection?pages.map(function(canvas,index){var boundPagePadding;return 0===index?(boundPagePadding={top:framePadding.top,bottom:framePadding.bottom,left:framePadding.left,right:framePadding.right},boundPagePadding.left=canvas.width+facingCanvasPadding/100*canvas.width,frame(canvas,boundPagePadding)):(index+1)%2==0?(boundPagePadding={top:framePadding.top,bottom:framePadding.bottom,left:framePadding.left,right:canvas.width*facingCanvasPadding/100/2},frame(canvas,boundPagePadding)):(boundPagePadding={top:framePadding.top,bottom:framePadding.bottom,left:canvas.width*facingCanvasPadding/100/2,right:framePadding.right},frame(canvas,boundPagePadding))}):"right-to-left"===viewingDirection?pages.map(function(canvas,index){var boundPagePadding;return 0===index?(boundPagePadding={top:framePadding.top,bottom:framePadding.bottom,left:framePadding.left,right:canvas.width*facingCanvasPadding/100/2},boundPagePadding.left=canvas.width+facingCanvasPadding/100*canvas.width,frame(canvas,boundPagePadding)):(index+1)%2==0?(boundPagePadding={top:framePadding.top,bottom:framePadding.bottom,left:framePadding.left,right:canvas.width*facingCanvasPadding/100/2},frame(canvas,boundPagePadding)):(boundPagePadding={top:framePadding.top,bottom:framePadding.bottom,left:canvas.width*facingCanvasPadding/100/2,right:framePadding.right},frame(canvas,boundPagePadding))}):void 0}function updateCanvases(frames){return frames.forEach(function(frame){frame.canvas.x=frame.x+frame.canvas.localX,frame.canvas.y=frame.y+frame.canvas.localY}),frames}function overviewLayout(){var frames=bindCanvases(canvases.map(pruneCanvas).map(function(canvas){return fitHeight(canvas,canvasHeight)}),viewingMode,viewingDirection,framePadding,facingCanvasPadding);return(frames=updateCanvases(frames=function(frames){return frames.map(function(frame){return frame.x=frame.x+containerWidth*viewport.padding.left/100,frame.y=frame.y+containerHeight*viewport.padding.top/100,frame})}(function(frames,lineWidth){var lines=new Lines(lineWidth,frames);return frames.map(function(frame){var lineStats=lines.addItem(frame);return frame.x=lineStats.x,frame.y=lineStats.y,frame.canvas.x=frame.x+frame.canvas.localX,frame.canvas.y=frame.y+frame.canvas.localY,frame})}(frames,viewport.paddedWidth)))).filter(function(frame){return frame.canvas.selected})[0].vantage=function(frames){var selectedFrameCenter,selectedFrame=frames.filter(function(frame){return frame.canvas.selected})[0],vantage=padVantage({x:0,y:0,width:viewport.paddedWidth,height:viewport.paddedHeight});if(selectedFrame){var selectedVantageTop=(selectedFrameCenter=function(frame){return{x:frame.x+frame.width/2,y:frame.y+frame.height/2}}(selectedFrame)).y-vantage.height/2;return vantage.x=0,vantage.y=selectedVantageTop<0?0:selectedVantageTop,vantage}return vantage}(frames),frames}function intermediateLayoutHorizontal(frames){var selectedFrame=frames.filter(function(frame){return frame.canvas.selected})[0],facingCanvas=getFacingCanvas(selectedFrame.canvas,frames),canvasPosition=selectedFrame.canvas.sequencePosition;return selectedFrame.vantage=getVantageForCanvas(selectedFrame.canvas,facingCanvas),"continuous"!==viewingMode&&frames.forEach(function(frame,index,allFrames){if(frame.y===selectedFrame.y&&frame.canvas.id!==selectedFrame.canvas.id){if("paged"===viewingMode&&frame.canvas.id===facingCanvas.id)return;"left-to-right"===viewingDirection?frame.x=index<canvasPosition?frame.x-(selectedFrame.vantage.leftMargin+framePadding.left):frame.x+(selectedFrame.vantage.rightMargin+framePadding.right):"right-to-left"===viewingDirection&&(frame.x=index>canvasPosition?frame.x-(selectedFrame.vantage.leftMargin+framePadding.left):frame.x+(selectedFrame.vantage.rightMargin+framePadding.right))}else frame.y>selectedFrame.y?frame.y=frame.y+(selectedFrame.vantage.bottomMargin+framePadding.bottom):frame.y<selectedFrame.y&&(frame.y=frame.y-(selectedFrame.vantage.topMargin+framePadding.top))}),frames=updateCanvases(frames)}function getVantageForCanvas(selectedCanvas,facingCanvas){var combinedCanvasWidths,x,pairHeight,selectionBoundingBox={};if("paged"===viewingMode){var selectionIndex=selectedCanvas.sequencePosition;0===selectionIndex?(combinedCanvasWidths=2*selectedCanvas.width,x=selectedCanvas.x-selectedCanvas.width,pairHeight=selectedCanvas.height):selectionIndex%2==0?(combinedCanvasWidths=selectedCanvas.width+facingCanvas.width,combinedCanvasWidths+=facingCanvasPadding/100*combinedCanvasWidths,x=facingCanvas.x,pairHeight=Math.max(selectedCanvas.height,facingCanvas.height)):(combinedCanvasWidths=selectedCanvas.width+facingCanvas.width,combinedCanvasWidths+=facingCanvasPadding/100*combinedCanvasWidths,x=selectedCanvas.x,pairHeight=Math.max(selectedCanvas.height,facingCanvas.height)),selectionBoundingBox={x:x,y:selectedCanvas.y,width:combinedCanvasWidths,height:pairHeight}}else x=selectedCanvas.x,selectionBoundingBox={x:selectedCanvas.x,y:selectedCanvas.y,width:selectedCanvas.width,height:selectedCanvas.height};return function(boundingBox){var vantageWidth,vantageHeight,horizontalMargin,verticalMargin,boundingBoxAspectRatio=boundingBox.width/boundingBox.height;return viewport.paddedAspectRatio>=boundingBoxAspectRatio?(vantageHeight=100*boundingBox.height/90,vantageWidth=vantageHeight*viewport.paddedAspectRatio):(vantageWidth=100*boundingBox.width/90,vantageHeight=vantageWidth/viewport.paddedAspectRatio),horizontalMargin=(vantageWidth-boundingBox.width)/2,verticalMargin=(vantageHeight-boundingBox.height)/2,padVantage({x:boundingBox.x-horizontalMargin,y:boundingBox.y-verticalMargin,width:vantageWidth,height:vantageHeight,topMargin:verticalMargin,bottomMargin:verticalMargin,leftMargin:horizontalMargin,rightMargin:horizontalMargin})}(selectionBoundingBox)}function padVantage(vantage){var horizontalPaddingRatio=viewport.padding.left+viewport.padding.right,verticalPaddingRatio=viewport.padding.top+viewport.padding.bottom,paddedVantageWidth=100*vantage.width/(100-horizontalPaddingRatio),paddedVantageHeight=100*vantage.height/(100-verticalPaddingRatio);return{x:vantage.x-paddedVantageWidth*(viewport.padding.left/100),y:vantage.y-paddedVantageHeight*(viewport.padding.top/100),width:paddedVantageWidth,height:paddedVantageHeight,topMargin:vantage.topMargin+paddedVantageHeight*viewport.padding.top/100,bottomMargin:vantage.bottomMargin+paddedVantageHeight*viewport.padding.bottom/100,leftMargin:vantage.leftMargin+paddedVantageWidth*(viewport.padding.left/100),rightMargin:vantage.rightMargin+paddedVantageWidth*(viewport.padding.right/100)}}function getFacingCanvas(canvas,frames){var selectedIndex;return frames.forEach(function(frame,index){frame.canvas.id===canvas.id&&(selectedIndex=index)}),0===selectedIndex?canvas.id:selectedIndex===frames.length-1?frames[selectedIndex].canvas:(selectedIndex+1)%2==0?frames[selectedIndex+1].canvas:frames[selectedIndex-1].canvas}options.maxCanvasHeight,options.maxCanvasWidth,options.minCanvasWidth,options.minCanvasHeight;var canvasHeight=options.canvasHeight*options.scaleFactor||100,framePadding=(options.canvasWidth,options.scaleFactor,options.scaleFactor,options.columns,{top:options.framePadding.top||0,bottom:options.framePadding.bottom||0,left:options.framePadding.left||0,right:options.framePadding.right||0}),facingCanvasPadding=options.facingCanvasPadding,containerHeight=(options.minimumImageGap,options.height),containerWidth=options.width,canvases=options.canvases,selectedCanvas=options.selectedCanvas,viewingDirection=(options.framingStrategy,options.viewingDirection||"left-to-right"),viewingMode=options.viewingMode||"individuals",viewport=(options.viewingMode,function(width,height,viewportPadding){var horizontalMargin,verticalMargin,viewport={padding:options.viewportPadding||{top:0,left:0,right:0,bottom:0},width:width,height:height,aspectRatio:width/height};return horizontalMargin=viewport.padding.left+viewport.padding.right,verticalMargin=viewport.padding.top+viewport.padding.bottom,viewport.paddedWidth=width-width*(horizontalMargin/100),viewport.paddedHeight=height-height*(verticalMargin/100),viewport.paddedAspectRatio=viewport.paddedWidth/viewport.paddedHeight,viewport}(containerWidth,containerHeight)),Lines=function(lineWidth,frames){this.x=0,this.y=0,this.lineWidth=lineWidth,this.frames=frames};Lines.prototype={_getFacingFrame:function(index){var type=function(index){return 0===index?"firstPage":index%2==0?"rightPage":"leftPage"}(index);return"leftPage"===type?this.frames[index+1]:"rightPage"===type?this.frames[index-1]:null},addItem:function(frame){var output,lineItemWidth=frame.width;if("paged"===viewingMode){var facingFrame=this._getFacingFrame(frame.canvas.sequencePosition);facingFrame&&(facingFrame.canvas.sequencePosition>frame.canvas.sequencePosition?lineItemWidth+=facingFrame.width:lineItemWidth=0)}return"left-to-right"===viewingDirection&&(this.x+lineItemWidth>this.lineWidth&&(this.x=0,this.y+=frame.height),output={x:this.x,y:this.y},this.x+=frame.width),"right-to-left"===viewingDirection&&(this.x-lineItemWidth>this.lineWidth&&(this.x=0,this.y+=frame.height),output={x:this.lineWidth-(this.x-lineItemWidth),y:this.y},this.x+=frame.width),output}};return{overview:overviewLayout,intermediate:function(){return intermediateLayoutHorizontal(overviewLayout())},detail:function(){return function(){var frames=bindCanvases(canvases.map(pruneCanvas).map(function(canvas){return fitHeight(canvas,canvasHeight)}),viewingMode,viewingDirection,framePadding,facingCanvasPadding),x=0;return"left-to-right"===viewingDirection?(frames.forEach(function(frame){frame.x=x,frame.y=0,x+=frame.width}),updateCanvases(frames),frames=intermediateLayoutHorizontal(frames)):"right-to-left"===viewingDirection&&(frames.reverse().forEach(function(frame){frame.x=x,frame.y=0,x+=frame.width}),updateCanvases(frames),frames=intermediateLayoutHorizontal(frames.reverse())),frames}()},viewport:viewport}}}])}),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){var b=function(){if(a&&a.fn&&a.fn.select2&&a.fn.select2.amd)b=a.fn.select2.amd;var b;return function(){if(!b||!b.requirejs){b?c=b:b={};var a,c,d;!function(b){function e(a,b){return v.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=b&&b.split("/"),p=t.map,q=p&&p["*"]||{};if(a){for(g=(a=a.split("/")).length-1,t.nodeIdCompat&&x.test(a[g])&&(a[g]=a[g].replace(x,"")),"."===a[0].charAt(0)&&o&&(n=o.slice(0,o.length-1),a=n.concat(a)),k=0;k<a.length;k++)if("."===(m=a[k]))a.splice(k,1),k-=1;else if(".."===m){if(0===k||1===k&&".."===a[2]||".."===a[k-1])continue;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}if((o||q)&&p){for(k=(c=a.split("/")).length;k>0;k-=1){if(d=c.slice(0,k).join("/"),o)for(l=o.length;l>0;l-=1)if((e=p[o.slice(0,l).join("/")])&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&q&&q[d]&&(i=q[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,c){return function(){var d=w.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),o.apply(b,d.concat([a,c]))}}function i(a){return function(b){r[a]=b}}function j(a){if(e(s,a)){var c=s[a];delete s[a],u[a]=!0,n.apply(b,c)}if(!e(r,a)&&!e(u,a))throw new Error("No "+a);return r[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return a?k(a):[]}var n,o,p,q,r={},s={},t={},u={},v=Object.prototype.hasOwnProperty,w=[].slice,x=/\.js$/;p=function(a,b){var c,d=k(a),e=d[0],g=b[1];return a=d[1],e&&(e=f(e,g),c=j(e)),e?a=c&&c.normalize?c.normalize(a,function(a){return function(b){return f(b,a)}}(g)):f(a,g):(a=f(a,g),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},q={require:function(a){return g(a)},exports:function(a){var b=r[a];return void 0!==b?b:r[a]={}},module:function(a){return{id:a,uri:"",exports:r[a],config:function(a){return function(){return t&&t.config&&t.config[a]||{}}}(a)}}},n=function(a,c,d,f){var h,k,m,n,o,t,v,w=[],x=typeof d;if(f=f||a,t=l(f),"undefined"===x||"function"===x){for(c=!c.length&&d.length?["require","exports","module"]:c,o=0;o<c.length;o+=1)if(n=p(c[o],t),"require"===(k=n.f))w[o]=q.require(a);else if("exports"===k)w[o]=q.exports(a),v=!0;else if("module"===k)h=w[o]=q.module(a);else if(e(r,k)||e(s,k)||e(u,k))w[o]=j(k);else{if(!n.p)throw new Error(a+" missing "+k);n.p.load(n.n,g(f,!0),i(k),{}),w[o]=r[k]}m=d?d.apply(r[a],w):void 0,a&&(h&&h.exports!==b&&h.exports!==r[a]?r[a]=h.exports:m===b&&v||(r[a]=m))}else a&&(r[a]=d)},a=c=o=function(a,c,d,e,f){if("string"==typeof a)return q[a]?q[a](c):j(p(a,l(c)).f);if(!a.splice){if((t=a).deps&&o(t.deps,t.callback),!c)return;c.splice?(a=c,c=d,d=null):a=b}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?n(b,a,c,d):setTimeout(function(){n(b,a,c,d)},4),o},o.config=function(a){return o(a)},a._defined=r,(d=function(a,b,c){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");b.splice||(c=b,b=[]),e(r,a)||e(s,a)||(s[a]=[a,b,c])}).amd={jQuery:!0}}(),b.requirejs=a,b.require=c,b.define=d}}(),b.define("almond",function(){}),b.define("jquery",[],function(){var b=a||$;return null==b&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),b}),b.define("select2/utils",["jquery"],function(a){function b(a){var b=a.prototype,c=[];for(var d in b)"function"==typeof b[d]&&"constructor"!==d&&c.push(d);return c}var c={};c.Extend=function(a,b){function c(){this.constructor=a}var d={}.hasOwnProperty;for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},c.Decorate=function(a,c){function d(){var b=Array.prototype.unshift,d=c.prototype.constructor.length,e=a.prototype.constructor;d>0&&(b.call(arguments,a.prototype.constructor),e=c.prototype.constructor),e.apply(this,arguments)}var f=b(c),g=b(a);c.displayName=a.displayName,d.prototype=new function(){this.constructor=d};for(var h=0;h<g.length;h++){var i=g[h];d.prototype[i]=a.prototype[i]}for(var j=function(a){var b=function(){};a in d.prototype&&(b=d.prototype[a]);var e=c.prototype[a];return function(){return Array.prototype.unshift.call(arguments,b),e.apply(this,arguments)}},k=0;k<f.length;k++){var l=f[k];d.prototype[l]=j(l)}return d};var d=function(){this.listeners={}};return d.prototype.on=function(a,b){this.listeners=this.listeners||{},a in this.listeners?this.listeners[a].push(b):this.listeners[a]=[b]},d.prototype.trigger=function(a){var b=Array.prototype.slice,c=b.call(arguments,1);this.listeners=this.listeners||{},null==c&&(c=[]),0===c.length&&c.push({}),c[0]._type=a,a in this.listeners&&this.invoke(this.listeners[a],b.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},d.prototype.invoke=function(a,b){for(var c=0,d=a.length;c<d;c++)a[c].apply(this,b)},c.Observable=d,c.generateChars=function(a){for(var b="",c=0;c<a;c++)b+=Math.floor(36*Math.random()).toString(36);return b},c.bind=function(a,b){return function(){a.apply(b,arguments)}},c._convertData=function(a){for(var b in a){var c=b.split("-"),d=a;if(1!==c.length){for(var e=0;e<c.length;e++){var f=c[e];(f=f.substring(0,1).toLowerCase()+f.substring(1))in d||(d[f]={}),e==c.length-1&&(d[f]=a[b]),d=d[f]}delete a[b]}}return a},c.hasScroll=function(b,c){var d=a(c),e=c.style.overflowX,f=c.style.overflowY;return(e!==f||"hidden"!==f&&"visible"!==f)&&("scroll"===e||"scroll"===f||d.innerHeight()<c.scrollHeight||d.innerWidth()<c.scrollWidth)},c.escapeMarkup=function(a){var b={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof a?a:String(a).replace(/[&<>"'\/\\]/g,function(a){return b[a]})},c.appendMany=function(b,c){if("1.7"===a.fn.jquery.substr(0,3)){var d=a();a.map(c,function(a){d=d.add(a)}),c=d}b.append(c)},c}),b.define("select2/results",["jquery","./utils"],function(a,b){function c(a,b,d){this.$element=a,this.data=d,this.options=b,c.__super__.constructor.call(this)}return b.Extend(c,b.Observable),c.prototype.render=function(){var b=a('<ul class="select2-results__options" role="tree"></ul>');return this.options.get("multiple")&&b.attr("aria-multiselectable","true"),this.$results=b,b},c.prototype.clear=function(){this.$results.empty()},c.prototype.displayMessage=function(b){var c=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var d=a('<li role="treeitem" aria-live="assertive" class="select2-results__option"></li>'),e=this.options.get("translations").get(b.message);d.append(c(e(b.args))),d[0].className+=" select2-results__message",this.$results.append(d)},c.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},c.prototype.append=function(a){this.hideLoading();var b=[];if(null!=a.results&&0!==a.results.length){a.results=this.sort(a.results);for(var c=0;c<a.results.length;c++){var d=a.results[c],e=this.option(d);b.push(e)}this.$results.append(b)}else 0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"})},c.prototype.position=function(a,b){b.find(".select2-results").append(a)},c.prototype.sort=function(a){return this.options.get("sorter")(a)},c.prototype.highlightFirstItem=function(){var a=this.$results.find(".select2-results__option[aria-selected]"),b=a.filter("[aria-selected=true]");b.length>0?b.first().trigger("mouseenter"):a.first().trigger("mouseenter"),this.ensureHighlightVisible()},c.prototype.setClasses=function(){var b=this;this.data.current(function(c){var d=a.map(c,function(a){return a.id.toString()});b.$results.find(".select2-results__option[aria-selected]").each(function(){var b=a(this),c=a.data(this,"data"),e=""+c.id;null!=c.element&&c.element.selected||null==c.element&&a.inArray(e,d)>-1?b.attr("aria-selected","true"):b.attr("aria-selected","false")})})},c.prototype.showLoading=function(a){this.hideLoading();var c={disabled:!0,loading:!0,text:this.options.get("translations").get("searching")(a)},d=this.option(c);d.className+=" loading-results",this.$results.prepend(d)},c.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},c.prototype.option=function(b){var c=document.createElement("li");c.className="select2-results__option";var d={role:"treeitem","aria-selected":"false"};b.disabled&&(delete d["aria-selected"],d["aria-disabled"]="true"),null==b.id&&delete d["aria-selected"],null!=b._resultId&&(c.id=b._resultId),b.title&&(c.title=b.title),b.children&&(d.role="group",d["aria-label"]=b.text,delete d["aria-selected"]);for(var e in d){var f=d[e];c.setAttribute(e,f)}if(b.children){var g=a(c),h=document.createElement("strong");h.className="select2-results__group",a(h),this.template(b,h);for(var i=[],j=0;j<b.children.length;j++){var k=b.children[j],l=this.option(k);i.push(l)}var m=a("<ul></ul>",{class:"select2-results__options select2-results__options--nested"});m.append(i),g.append(h),g.append(m)}else this.template(b,c);return a.data(c,"data",b),c},c.prototype.bind=function(b,c){var d=this,e=b.id+"-results";this.$results.attr("id",e),b.on("results:all",function(a){d.clear(),d.append(a.data),b.isOpen()&&(d.setClasses(),d.highlightFirstItem())}),b.on("results:append",function(a){d.append(a.data),b.isOpen()&&d.setClasses()}),b.on("query",function(a){d.hideMessages(),d.showLoading(a)}),b.on("select",function(){b.isOpen()&&(d.setClasses(),d.highlightFirstItem())}),b.on("unselect",function(){b.isOpen()&&(d.setClasses(),d.highlightFirstItem())}),b.on("open",function(){d.$results.attr("aria-expanded","true"),d.$results.attr("aria-hidden","false"),d.setClasses(),d.ensureHighlightVisible()}),b.on("close",function(){d.$results.attr("aria-expanded","false"),d.$results.attr("aria-hidden","true"),d.$results.removeAttr("aria-activedescendant")}),b.on("results:toggle",function(){var a=d.getHighlightedResults();0!==a.length&&a.trigger("mouseup")}),b.on("results:select",function(){var a=d.getHighlightedResults();if(0!==a.length){var b=a.data("data");"true"==a.attr("aria-selected")?d.trigger("close",{}):d.trigger("select",{data:b})}}),b.on("results:previous",function(){var a=d.getHighlightedResults(),b=d.$results.find("[aria-selected]"),c=b.index(a);if(0!==c){var e=c-1;0===a.length&&(e=0);var f=b.eq(e);f.trigger("mouseenter");var g=d.$results.offset().top,h=f.offset().top,i=d.$results.scrollTop()+(h-g);0===e?d.$results.scrollTop(0):h-g<0&&d.$results.scrollTop(i)}}),b.on("results:next",function(){var a=d.getHighlightedResults(),b=d.$results.find("[aria-selected]"),e=b.index(a)+1;if(!(e>=b.length)){var f=b.eq(e);f.trigger("mouseenter");var g=d.$results.offset().top+d.$results.outerHeight(!1),h=f.offset().top+f.outerHeight(!1),i=d.$results.scrollTop()+h-g;0===e?d.$results.scrollTop(0):h>g&&d.$results.scrollTop(i)}}),b.on("results:focus",function(a){a.element.addClass("select2-results__option--highlighted")}),b.on("results:message",function(a){d.displayMessage(a)}),a.fn.mousewheel&&this.$results.on("mousewheel",function(a){var b=d.$results.scrollTop(),c=d.$results.get(0).scrollHeight-b+a.deltaY,e=a.deltaY>0&&b-a.deltaY<=0,f=a.deltaY<0&&c<=d.$results.height();e?(d.$results.scrollTop(0),a.preventDefault(),a.stopPropagation()):f&&(d.$results.scrollTop(d.$results.get(0).scrollHeight-d.$results.height()),a.preventDefault(),a.stopPropagation())}),this.$results.on("mouseup",".select2-results__option[aria-selected]",function(b){var c=a(this),e=c.data("data");"true"!==c.attr("aria-selected")?d.trigger("select",{originalEvent:b,data:e}):d.options.get("multiple")?d.trigger("unselect",{originalEvent:b,data:e}):d.trigger("close",{})}),this.$results.on("mouseenter",".select2-results__option[aria-selected]",function(b){var c=a(this).data("data");d.getHighlightedResults().removeClass("select2-results__option--highlighted"),d.trigger("results:focus",{data:c,element:a(this)})})},c.prototype.getHighlightedResults=function(){return this.$results.find(".select2-results__option--highlighted")},c.prototype.destroy=function(){this.$results.remove()},c.prototype.ensureHighlightVisible=function(){var a=this.getHighlightedResults();if(0!==a.length){var c=this.$results.find("[aria-selected]").index(a),d=this.$results.offset().top,e=a.offset().top,f=this.$results.scrollTop()+(e-d),g=e-d;f-=2*a.outerHeight(!1),c<=2?this.$results.scrollTop(0):(g>this.$results.outerHeight()||g<0)&&this.$results.scrollTop(f)}},c.prototype.template=function(b,c){var d=this.options.get("templateResult"),e=this.options.get("escapeMarkup"),f=d(b,c);null==f?c.style.display="none":"string"==typeof f?c.innerHTML=e(f):a(c).append(f)},c}),b.define("select2/keys",[],function(){return{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46}}),b.define("select2/selection/base",["jquery","../utils","../keys"],function(a,b,c){function d(a,b){this.$element=a,this.options=b,d.__super__.constructor.call(this)}return b.Extend(d,b.Observable),d.prototype.render=function(){var b=a('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=this.$element.data("old-tabindex")?this._tabindex=this.$element.data("old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),b.attr("title",this.$element.attr("title")),b.attr("tabindex",this._tabindex),this.$selection=b,b},d.prototype.bind=function(a,b){var d=this,e=(a.id,a.id+"-results");this.container=a,this.$selection.on("focus",function(a){d.trigger("focus",a)}),this.$selection.on("blur",function(a){d._handleBlur(a)}),this.$selection.on("keydown",function(a){d.trigger("keypress",a),a.which===c.SPACE&&a.preventDefault()}),a.on("results:focus",function(a){d.$selection.attr("aria-activedescendant",a.data._resultId)}),a.on("selection:update",function(a){d.update(a.data)}),a.on("open",function(){d.$selection.attr("aria-expanded","true"),d.$selection.attr("aria-owns",e),d._attachCloseHandler(a)}),a.on("close",function(){d.$selection.attr("aria-expanded","false"),d.$selection.removeAttr("aria-activedescendant"),d.$selection.removeAttr("aria-owns"),d.$selection.focus(),d._detachCloseHandler(a)}),a.on("enable",function(){d.$selection.attr("tabindex",d._tabindex)}),a.on("disable",function(){d.$selection.attr("tabindex","-1")})},d.prototype._handleBlur=function(b){var c=this;window.setTimeout(function(){document.activeElement==c.$selection[0]||a.contains(c.$selection[0],document.activeElement)||c.trigger("blur",b)},1)},d.prototype._attachCloseHandler=function(b){a(document.body).on("mousedown.select2."+b.id,function(b){var d=a(b.target).closest(".select2");a(".select2.select2-container--open").each(function(){var b=a(this);this!=d[0]&&b.data("element").select2("close")})})},d.prototype._detachCloseHandler=function(b){a(document.body).off("mousedown.select2."+b.id)},d.prototype.position=function(a,b){b.find(".selection").append(a)},d.prototype.destroy=function(){this._detachCloseHandler(this.container)},d.prototype.update=function(a){throw new Error("The `update` method must be defined in child classes.")},d}),b.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(a,b,c,d){function e(){e.__super__.constructor.apply(this,arguments)}return c.Extend(e,b),e.prototype.render=function(){var a=e.__super__.render.call(this);return a.addClass("select2-selection--single"),a.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),a},e.prototype.bind=function(a,b){var c=this;e.__super__.bind.apply(this,arguments);var d=a.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",d),this.$selection.attr("aria-labelledby",d),this.$selection.on("mousedown",function(a){1===a.which&&c.trigger("toggle",{originalEvent:a})}),this.$selection.on("focus",function(a){}),this.$selection.on("blur",function(a){}),a.on("focus",function(b){a.isOpen()||c.$selection.focus()}),a.on("selection:update",function(a){c.update(a.data)})},e.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},e.prototype.display=function(a,b){var c=this.options.get("templateSelection");return this.options.get("escapeMarkup")(c(a,b))},e.prototype.selectionContainer=function(){return a("<span></span>")},e.prototype.update=function(a){if(0!==a.length){var b=a[0],c=this.$selection.find(".select2-selection__rendered"),d=this.display(b,c);c.empty().append(d),c.prop("title",b.title||b.text)}else this.clear()},e}),b.define("select2/selection/multiple",["jquery","./base","../utils"],function(a,b,c){function d(a,b){d.__super__.constructor.apply(this,arguments)}return c.Extend(d,b),d.prototype.render=function(){var a=d.__super__.render.call(this);return a.addClass("select2-selection--multiple"),a.html('<ul class="select2-selection__rendered"></ul>'),a},d.prototype.bind=function(b,c){var e=this;d.__super__.bind.apply(this,arguments),this.$selection.on("click",function(a){e.trigger("toggle",{originalEvent:a})}),this.$selection.on("click",".select2-selection__choice__remove",function(b){if(!e.options.get("disabled")){var f=a(this).parent().data("data");e.trigger("unselect",{originalEvent:b,data:f})}})},d.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},d.prototype.display=function(a,b){var c=this.options.get("templateSelection");return this.options.get("escapeMarkup")(c(a,b))},d.prototype.selectionContainer=function(){return a('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>')},d.prototype.update=function(a){if(this.clear(),0!==a.length){for(var b=[],d=0;d<a.length;d++){var e=a[d],f=this.selectionContainer(),g=this.display(e,f);f.append(g),f.prop("title",e.title||e.text),f.data("data",e),b.push(f)}var h=this.$selection.find(".select2-selection__rendered");c.appendMany(h,b)}},d}),b.define("select2/selection/placeholder",["../utils"],function(a){function b(a,b,c){this.placeholder=this.normalizePlaceholder(c.get("placeholder")),a.call(this,b,c)}return b.prototype.normalizePlaceholder=function(a,b){return"string"==typeof b&&(b={id:"",text:b}),b},b.prototype.createPlaceholder=function(a,b){var c=this.selectionContainer();return c.html(this.display(b)),c.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),c},b.prototype.update=function(a,b){var c=1==b.length&&b[0].id!=this.placeholder.id;if(b.length>1||c)return a.call(this,b);this.clear();var d=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(d)},b}),b.define("select2/selection/allowClear",["jquery","../keys"],function(a,b){function c(){}return c.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",function(a){d._handleClear(a)}),b.on("keypress",function(a){d._handleKeyboardClear(a,b)})},c.prototype._handleClear=function(a,b){if(!this.options.get("disabled")){var c=this.$selection.find(".select2-selection__clear");if(0!==c.length){b.stopPropagation();for(var d=c.data("data"),e=0;e<d.length;e++){var f={data:d[e]};if(this.trigger("unselect",f),f.prevented)return}this.$element.val(this.placeholder.id).trigger("change"),this.trigger("toggle",{})}}},c.prototype._handleKeyboardClear=function(a,c,d){d.isOpen()||c.which!=b.DELETE&&c.which!=b.BACKSPACE||this._handleClear(c)},c.prototype.update=function(b,c){if(b.call(this,c),!(this.$selection.find(".select2-selection__placeholder").length>0||0===c.length)){var d=a('<span class="select2-selection__clear">&times;</span>');d.data("data",c),this.$selection.find(".select2-selection__rendered").prepend(d)}},c}),b.define("select2/selection/search",["jquery","../utils","../keys"],function(a,b,c){function d(a,b,c){a.call(this,b,c)}return d.prototype.render=function(b){var c=a('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="textbox" aria-autocomplete="list" /></li>');this.$searchContainer=c,this.$search=c.find("input");var d=b.call(this);return this._transferTabIndex(),d},d.prototype.bind=function(a,b,d){var e=this;a.call(this,b,d),b.on("open",function(){e.$search.trigger("focus")}),b.on("close",function(){e.$search.val(""),e.$search.removeAttr("aria-activedescendant"),e.$search.trigger("focus")}),b.on("enable",function(){e.$search.prop("disabled",!1),e._transferTabIndex()}),b.on("disable",function(){e.$search.prop("disabled",!0)}),b.on("focus",function(a){e.$search.trigger("focus")}),b.on("results:focus",function(a){e.$search.attr("aria-activedescendant",a.id)}),this.$selection.on("focusin",".select2-search--inline",function(a){e.trigger("focus",a)}),this.$selection.on("focusout",".select2-search--inline",function(a){e._handleBlur(a)}),this.$selection.on("keydown",".select2-search--inline",function(a){if(a.stopPropagation(),e.trigger("keypress",a),e._keyUpPrevented=a.isDefaultPrevented(),a.which===c.BACKSPACE&&""===e.$search.val()){var b=e.$searchContainer.prev(".select2-selection__choice");if(b.length>0){var d=b.data("data");e.searchRemoveChoice(d),a.preventDefault()}}});var f=document.documentMode,g=f&&f<=11;this.$selection.on("input.searchcheck",".select2-search--inline",function(a){g?e.$selection.off("input.search input.searchcheck"):e.$selection.off("keyup.search")}),this.$selection.on("keyup.search input.search",".select2-search--inline",function(a){if(g&&"input"===a.type)e.$selection.off("input.search input.searchcheck");else{var b=a.which;b!=c.SHIFT&&b!=c.CTRL&&b!=c.ALT&&b!=c.TAB&&e.handleSearch(a)}})},d.prototype._transferTabIndex=function(a){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},d.prototype.createPlaceholder=function(a,b){this.$search.attr("placeholder",b.text)},d.prototype.update=function(a,b){var c=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),a.call(this,b),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch(),c&&this.$search.focus()},d.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var a=this.$search.val();this.trigger("query",{term:a})}this._keyUpPrevented=!1},d.prototype.searchRemoveChoice=function(a,b){this.trigger("unselect",{data:b}),this.$search.val(b.text),this.handleSearch()},d.prototype.resizeSearch=function(){this.$search.css("width","25px");var a="";a=""!==this.$search.attr("placeholder")?this.$selection.find(".select2-selection__rendered").innerWidth():.75*(this.$search.val().length+1)+"em",this.$search.css("width",a)},d}),b.define("select2/selection/eventRelay",["jquery"],function(a){function b(){}return b.prototype.bind=function(b,c,d){var e=this,f=["open","opening","close","closing","select","selecting","unselect","unselecting"],g=["opening","closing","selecting","unselecting"];b.call(this,c,d),c.on("*",function(b,c){if(-1!==a.inArray(b,f)){c=c||{};var d=a.Event("select2:"+b,{params:c});e.$element.trigger(d),-1!==a.inArray(b,g)&&(c.prevented=d.isDefaultPrevented())}})},b}),b.define("select2/translation",["jquery","require"],function(a,b){function c(a){this.dict=a||{}}return c.prototype.all=function(){return this.dict},c.prototype.get=function(a){return this.dict[a]},c.prototype.extend=function(b){this.dict=a.extend({},b.all(),this.dict)},c._cache={},c.loadPath=function(a){if(!(a in c._cache)){var d=b(a);c._cache[a]=d}return new c(c._cache[a])},c}),b.define("select2/diacritics",[],function(){return{"Ⓐ":"A","Ａ":"A","À":"A","Á":"A","Â":"A","Ầ":"A","Ấ":"A","Ẫ":"A","Ẩ":"A","Ã":"A","Ā":"A","Ă":"A","Ằ":"A","Ắ":"A","Ẵ":"A","Ẳ":"A","Ȧ":"A","Ǡ":"A","Ä":"A","Ǟ":"A","Ả":"A","Å":"A","Ǻ":"A","Ǎ":"A","Ȁ":"A","Ȃ":"A","Ạ":"A","Ậ":"A","Ặ":"A","Ḁ":"A","Ą":"A","Ⱥ":"A","Ɐ":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ⓑ":"B","Ｂ":"B","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ɓ":"B","Ⓒ":"C","Ｃ":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ç":"C","Ḉ":"C","Ƈ":"C","Ȼ":"C","Ꜿ":"C","Ⓓ":"D","Ｄ":"D","Ḋ":"D","Ď":"D","Ḍ":"D","Ḑ":"D","Ḓ":"D","Ḏ":"D","Đ":"D","Ƌ":"D","Ɗ":"D","Ɖ":"D","Ꝺ":"D","Ǳ":"DZ","Ǆ":"DZ","ǲ":"Dz","ǅ":"Dz","Ⓔ":"E","Ｅ":"E","È":"E","É":"E","Ê":"E","Ề":"E","Ế":"E","Ễ":"E","Ể":"E","Ẽ":"E","Ē":"E","Ḕ":"E","Ḗ":"E","Ĕ":"E","Ė":"E","Ë":"E","Ẻ":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ẹ":"E","Ệ":"E","Ȩ":"E","Ḝ":"E","Ę":"E","Ḙ":"E","Ḛ":"E","Ɛ":"E","Ǝ":"E","Ⓕ":"F","Ｆ":"F","Ḟ":"F","Ƒ":"F","Ꝼ":"F","Ⓖ":"G","Ｇ":"G","Ǵ":"G","Ĝ":"G","Ḡ":"G","Ğ":"G","Ġ":"G","Ǧ":"G","Ģ":"G","Ǥ":"G","Ɠ":"G","Ꞡ":"G","Ᵹ":"G","Ꝿ":"G","Ⓗ":"H","Ｈ":"H","Ĥ":"H","Ḣ":"H","Ḧ":"H","Ȟ":"H","Ḥ":"H","Ḩ":"H","Ḫ":"H","Ħ":"H","Ⱨ":"H","Ⱶ":"H","Ɥ":"H","Ⓘ":"I","Ｉ":"I","Ì":"I","Í":"I","Î":"I","Ĩ":"I","Ī":"I","Ĭ":"I","İ":"I","Ï":"I","Ḯ":"I","Ỉ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ị":"I","Į":"I","Ḭ":"I","Ɨ":"I","Ⓙ":"J","Ｊ":"J","Ĵ":"J","Ɉ":"J","Ⓚ":"K","Ｋ":"K","Ḱ":"K","Ǩ":"K","Ḳ":"K","Ķ":"K","Ḵ":"K","Ƙ":"K","Ⱪ":"K","Ꝁ":"K","Ꝃ":"K","Ꝅ":"K","Ꞣ":"K","Ⓛ":"L","Ｌ":"L","Ŀ":"L","Ĺ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ļ":"L","Ḽ":"L","Ḻ":"L","Ł":"L","Ƚ":"L","Ɫ":"L","Ⱡ":"L","Ꝉ":"L","Ꝇ":"L","Ꞁ":"L","Ǉ":"LJ","ǈ":"Lj","Ⓜ":"M","Ｍ":"M","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ɯ":"M","Ⓝ":"N","Ｎ":"N","Ǹ":"N","Ń":"N","Ñ":"N","Ṅ":"N","Ň":"N","Ṇ":"N","Ņ":"N","Ṋ":"N","Ṉ":"N","Ƞ":"N","Ɲ":"N","Ꞑ":"N","Ꞥ":"N","Ǌ":"NJ","ǋ":"Nj","Ⓞ":"O","Ｏ":"O","Ò":"O","Ó":"O","Ô":"O","Ồ":"O","Ố":"O","Ỗ":"O","Ổ":"O","Õ":"O","Ṍ":"O","Ȭ":"O","Ṏ":"O","Ō":"O","Ṑ":"O","Ṓ":"O","Ŏ":"O","Ȯ":"O","Ȱ":"O","Ö":"O","Ȫ":"O","Ỏ":"O","Ő":"O","Ǒ":"O","Ȍ":"O","Ȏ":"O","Ơ":"O","Ờ":"O","Ớ":"O","Ỡ":"O","Ở":"O","Ợ":"O","Ọ":"O","Ộ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Ɔ":"O","Ɵ":"O","Ꝋ":"O","Ꝍ":"O","Ƣ":"OI","Ꝏ":"OO","Ȣ":"OU","Ⓟ":"P","Ｐ":"P","Ṕ":"P","Ṗ":"P","Ƥ":"P","Ᵽ":"P","Ꝑ":"P","Ꝓ":"P","Ꝕ":"P","Ⓠ":"Q","Ｑ":"Q","Ꝗ":"Q","Ꝙ":"Q","Ɋ":"Q","Ⓡ":"R","Ｒ":"R","Ŕ":"R","Ṙ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṛ":"R","Ṝ":"R","Ŗ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꝛ":"R","Ꞧ":"R","Ꞃ":"R","Ⓢ":"S","Ｓ":"S","ẞ":"S","Ś":"S","Ṥ":"S","Ŝ":"S","Ṡ":"S","Š":"S","Ṧ":"S","Ṣ":"S","Ṩ":"S","Ș":"S","Ş":"S","Ȿ":"S","Ꞩ":"S","Ꞅ":"S","Ⓣ":"T","Ｔ":"T","Ṫ":"T","Ť":"T","Ṭ":"T","Ț":"T","Ţ":"T","Ṱ":"T","Ṯ":"T","Ŧ":"T","Ƭ":"T","Ʈ":"T","Ⱦ":"T","Ꞇ":"T","Ꜩ":"TZ","Ⓤ":"U","Ｕ":"U","Ù":"U","Ú":"U","Û":"U","Ũ":"U","Ṹ":"U","Ū":"U","Ṻ":"U","Ŭ":"U","Ü":"U","Ǜ":"U","Ǘ":"U","Ǖ":"U","Ǚ":"U","Ủ":"U","Ů":"U","Ű":"U","Ǔ":"U","Ȕ":"U","Ȗ":"U","Ư":"U","Ừ":"U","Ứ":"U","Ữ":"U","Ử":"U","Ự":"U","Ụ":"U","Ṳ":"U","Ų":"U","Ṷ":"U","Ṵ":"U","Ʉ":"U","Ⓥ":"V","Ｖ":"V","Ṽ":"V","Ṿ":"V","Ʋ":"V","Ꝟ":"V","Ʌ":"V","Ꝡ":"VY","Ⓦ":"W","Ｗ":"W","Ẁ":"W","Ẃ":"W","Ŵ":"W","Ẇ":"W","Ẅ":"W","Ẉ":"W","Ⱳ":"W","Ⓧ":"X","Ｘ":"X","Ẋ":"X","Ẍ":"X","Ⓨ":"Y","Ｙ":"Y","Ỳ":"Y","Ý":"Y","Ŷ":"Y","Ỹ":"Y","Ȳ":"Y","Ẏ":"Y","Ÿ":"Y","Ỷ":"Y","Ỵ":"Y","Ƴ":"Y","Ɏ":"Y","Ỿ":"Y","Ⓩ":"Z","Ｚ":"Z","Ź":"Z","Ẑ":"Z","Ż":"Z","Ž":"Z","Ẓ":"Z","Ẕ":"Z","Ƶ":"Z","Ȥ":"Z","Ɀ":"Z","Ⱬ":"Z","Ꝣ":"Z","ⓐ":"a","ａ":"a","ẚ":"a","à":"a","á":"a","â":"a","ầ":"a","ấ":"a","ẫ":"a","ẩ":"a","ã":"a","ā":"a","ă":"a","ằ":"a","ắ":"a","ẵ":"a","ẳ":"a","ȧ":"a","ǡ":"a","ä":"a","ǟ":"a","ả":"a","å":"a","ǻ":"a","ǎ":"a","ȁ":"a","ȃ":"a","ạ":"a","ậ":"a","ặ":"a","ḁ":"a","ą":"a","ⱥ":"a","ɐ":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ⓑ":"b","ｂ":"b","ḃ":"b","ḅ":"b","ḇ":"b","ƀ":"b","ƃ":"b","ɓ":"b","ⓒ":"c","ｃ":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ç":"c","ḉ":"c","ƈ":"c","ȼ":"c","ꜿ":"c","ↄ":"c","ⓓ":"d","ｄ":"d","ḋ":"d","ď":"d","ḍ":"d","ḑ":"d","ḓ":"d","ḏ":"d","đ":"d","ƌ":"d","ɖ":"d","ɗ":"d","ꝺ":"d","ǳ":"dz","ǆ":"dz","ⓔ":"e","ｅ":"e","è":"e","é":"e","ê":"e","ề":"e","ế":"e","ễ":"e","ể":"e","ẽ":"e","ē":"e","ḕ":"e","ḗ":"e","ĕ":"e","ė":"e","ë":"e","ẻ":"e","ě":"e","ȅ":"e","ȇ":"e","ẹ":"e","ệ":"e","ȩ":"e","ḝ":"e","ę":"e","ḙ":"e","ḛ":"e","ɇ":"e","ɛ":"e","ǝ":"e","ⓕ":"f","ｆ":"f","ḟ":"f","ƒ":"f","ꝼ":"f","ⓖ":"g","ｇ":"g","ǵ":"g","ĝ":"g","ḡ":"g","ğ":"g","ġ":"g","ǧ":"g","ģ":"g","ǥ":"g","ɠ":"g","ꞡ":"g","ᵹ":"g","ꝿ":"g","ⓗ":"h","ｈ":"h","ĥ":"h","ḣ":"h","ḧ":"h","ȟ":"h","ḥ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ħ":"h","ⱨ":"h","ⱶ":"h","ɥ":"h","ƕ":"hv","ⓘ":"i","ｉ":"i","ì":"i","í":"i","î":"i","ĩ":"i","ī":"i","ĭ":"i","ï":"i","ḯ":"i","ỉ":"i","ǐ":"i","ȉ":"i","ȋ":"i","ị":"i","į":"i","ḭ":"i","ɨ":"i","ı":"i","ⓙ":"j","ｊ":"j","ĵ":"j","ǰ":"j","ɉ":"j","ⓚ":"k","ｋ":"k","ḱ":"k","ǩ":"k","ḳ":"k","ķ":"k","ḵ":"k","ƙ":"k","ⱪ":"k","ꝁ":"k","ꝃ":"k","ꝅ":"k","ꞣ":"k","ⓛ":"l","ｌ":"l","ŀ":"l","ĺ":"l","ľ":"l","ḷ":"l","ḹ":"l","ļ":"l","ḽ":"l","ḻ":"l","ſ":"l","ł":"l","ƚ":"l","ɫ":"l","ⱡ":"l","ꝉ":"l","ꞁ":"l","ꝇ":"l","ǉ":"lj","ⓜ":"m","ｍ":"m","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ɯ":"m","ⓝ":"n","ｎ":"n","ǹ":"n","ń":"n","ñ":"n","ṅ":"n","ň":"n","ṇ":"n","ņ":"n","ṋ":"n","ṉ":"n","ƞ":"n","ɲ":"n","ŉ":"n","ꞑ":"n","ꞥ":"n","ǌ":"nj","ⓞ":"o","ｏ":"o","ò":"o","ó":"o","ô":"o","ồ":"o","ố":"o","ỗ":"o","ổ":"o","õ":"o","ṍ":"o","ȭ":"o","ṏ":"o","ō":"o","ṑ":"o","ṓ":"o","ŏ":"o","ȯ":"o","ȱ":"o","ö":"o","ȫ":"o","ỏ":"o","ő":"o","ǒ":"o","ȍ":"o","ȏ":"o","ơ":"o","ờ":"o","ớ":"o","ỡ":"o","ở":"o","ợ":"o","ọ":"o","ộ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","ɔ":"o","ꝋ":"o","ꝍ":"o","ɵ":"o","ƣ":"oi","ȣ":"ou","ꝏ":"oo","ⓟ":"p","ｐ":"p","ṕ":"p","ṗ":"p","ƥ":"p","ᵽ":"p","ꝑ":"p","ꝓ":"p","ꝕ":"p","ⓠ":"q","ｑ":"q","ɋ":"q","ꝗ":"q","ꝙ":"q","ⓡ":"r","ｒ":"r","ŕ":"r","ṙ":"r","ř":"r","ȑ":"r","ȓ":"r","ṛ":"r","ṝ":"r","ŗ":"r","ṟ":"r","ɍ":"r","ɽ":"r","ꝛ":"r","ꞧ":"r","ꞃ":"r","ⓢ":"s","ｓ":"s","ß":"s","ś":"s","ṥ":"s","ŝ":"s","ṡ":"s","š":"s","ṧ":"s","ṣ":"s","ṩ":"s","ș":"s","ş":"s","ȿ":"s","ꞩ":"s","ꞅ":"s","ẛ":"s","ⓣ":"t","ｔ":"t","ṫ":"t","ẗ":"t","ť":"t","ṭ":"t","ț":"t","ţ":"t","ṱ":"t","ṯ":"t","ŧ":"t","ƭ":"t","ʈ":"t","ⱦ":"t","ꞇ":"t","ꜩ":"tz","ⓤ":"u","ｕ":"u","ù":"u","ú":"u","û":"u","ũ":"u","ṹ":"u","ū":"u","ṻ":"u","ŭ":"u","ü":"u","ǜ":"u","ǘ":"u","ǖ":"u","ǚ":"u","ủ":"u","ů":"u","ű":"u","ǔ":"u","ȕ":"u","ȗ":"u","ư":"u","ừ":"u","ứ":"u","ữ":"u","ử":"u","ự":"u","ụ":"u","ṳ":"u","ų":"u","ṷ":"u","ṵ":"u","ʉ":"u","ⓥ":"v","ｖ":"v","ṽ":"v","ṿ":"v","ʋ":"v","ꝟ":"v","ʌ":"v","ꝡ":"vy","ⓦ":"w","ｗ":"w","ẁ":"w","ẃ":"w","ŵ":"w","ẇ":"w","ẅ":"w","ẘ":"w","ẉ":"w","ⱳ":"w","ⓧ":"x","ｘ":"x","ẋ":"x","ẍ":"x","ⓨ":"y","ｙ":"y","ỳ":"y","ý":"y","ŷ":"y","ỹ":"y","ȳ":"y","ẏ":"y","ÿ":"y","ỷ":"y","ẙ":"y","ỵ":"y","ƴ":"y","ɏ":"y","ỿ":"y","ⓩ":"z","ｚ":"z","ź":"z","ẑ":"z","ż":"z","ž":"z","ẓ":"z","ẕ":"z","ƶ":"z","ȥ":"z","ɀ":"z","ⱬ":"z","ꝣ":"z","Ά":"Α","Έ":"Ε","Ή":"Η","Ί":"Ι","Ϊ":"Ι","Ό":"Ο","Ύ":"Υ","Ϋ":"Υ","Ώ":"Ω","ά":"α","έ":"ε","ή":"η","ί":"ι","ϊ":"ι","ΐ":"ι","ό":"ο","ύ":"υ","ϋ":"υ","ΰ":"υ","ω":"ω","ς":"σ"}}),b.define("select2/data/base",["../utils"],function(a){function b(a,c){b.__super__.constructor.call(this)}return a.Extend(b,a.Observable),b.prototype.current=function(a){throw new Error("The `current` method must be defined in child classes.")},b.prototype.query=function(a,b){throw new Error("The `query` method must be defined in child classes.")},b.prototype.bind=function(a,b){},b.prototype.destroy=function(){},b.prototype.generateResultId=function(b,c){var d=b.id+"-result-";return d+=a.generateChars(4),null!=c.id?d+="-"+c.id.toString():d+="-"+a.generateChars(4),d},b}),b.define("select2/data/select",["./base","../utils","jquery"],function(a,b,c){function d(a,b){this.$element=a,this.options=b,d.__super__.constructor.call(this)}return b.Extend(d,a),d.prototype.current=function(a){var b=[],d=this;this.$element.find(":selected").each(function(){var a=c(this),e=d.item(a);b.push(e)}),a(b)},d.prototype.select=function(a){var b=this;if(a.selected=!0,c(a.element).is("option"))return a.element.selected=!0,void this.$element.trigger("change");if(this.$element.prop("multiple"))this.current(function(d){var e=[];(a=[a]).push.apply(a,d);for(var f=0;f<a.length;f++){var g=a[f].id;-1===c.inArray(g,e)&&e.push(g)}b.$element.val(e),b.$element.trigger("change")});else{var d=a.id;this.$element.val(d),this.$element.trigger("change")}},d.prototype.unselect=function(a){var b=this;if(this.$element.prop("multiple")){if(a.selected=!1,c(a.element).is("option"))return a.element.selected=!1,void this.$element.trigger("change");this.current(function(d){for(var e=[],f=0;f<d.length;f++){var g=d[f].id;g!==a.id&&-1===c.inArray(g,e)&&e.push(g)}b.$element.val(e),b.$element.trigger("change")})}},d.prototype.bind=function(a,b){var c=this;this.container=a,a.on("select",function(a){c.select(a.data)}),a.on("unselect",function(a){c.unselect(a.data)})},d.prototype.destroy=function(){this.$element.find("*").each(function(){c.removeData(this,"data")})},d.prototype.query=function(a,b){var d=[],e=this;this.$element.children().each(function(){var b=c(this);if(b.is("option")||b.is("optgroup")){var f=e.item(b),g=e.matches(a,f);null!==g&&d.push(g)}}),b({results:d})},d.prototype.addOptions=function(a){b.appendMany(this.$element,a)},d.prototype.option=function(a){var b;a.children?(b=document.createElement("optgroup"),b.label=a.text):void 0!==(b=document.createElement("option")).textContent?b.textContent=a.text:b.innerText=a.text,void 0!==a.id&&(b.value=a.id),a.disabled&&(b.disabled=!0),a.selected&&(b.selected=!0),a.title&&(b.title=a.title);var d=c(b),e=this._normalizeItem(a);return e.element=b,c.data(b,"data",e),d},d.prototype.item=function(a){var b={};if(null!=(b=c.data(a[0],"data")))return b;if(a.is("option"))b={id:a.val(),text:a.text(),disabled:a.prop("disabled"),selected:a.prop("selected"),title:a.prop("title")};else if(a.is("optgroup")){b={text:a.prop("label"),children:[],title:a.prop("title")};for(var d=a.children("option"),e=[],f=0;f<d.length;f++){var g=c(d[f]),h=this.item(g);e.push(h)}b.children=e}return b=this._normalizeItem(b),b.element=a[0],c.data(a[0],"data",b),b},d.prototype._normalizeItem=function(a){c.isPlainObject(a)||(a={id:a,text:a});return null!=(a=c.extend({},{text:""},a)).id&&(a.id=a.id.toString()),null!=a.text&&(a.text=a.text.toString()),null==a._resultId&&a.id&&null!=this.container&&(a._resultId=this.generateResultId(this.container,a)),c.extend({},{selected:!1,disabled:!1},a)},d.prototype.matches=function(a,b){return this.options.get("matcher")(a,b)},d}),b.define("select2/data/array",["./select","../utils","jquery"],function(a,b,c){function d(a,b){var c=b.get("data")||[];d.__super__.constructor.call(this,a,b),this.addOptions(this.convertToOptions(c))}return b.Extend(d,a),d.prototype.select=function(a){var b=this.$element.find("option").filter(function(b,c){return c.value==a.id.toString()});0===b.length&&(b=this.option(a),this.addOptions(b)),d.__super__.select.call(this,a)},d.prototype.convertToOptions=function(a){function d(a){return function(){return c(this).val()==a.id}}for(var e=this,f=this.$element.find("option"),g=f.map(function(){return e.item(c(this)).id}).get(),h=[],i=0;i<a.length;i++){var j=this._normalizeItem(a[i]);if(c.inArray(j.id,g)>=0){var k=f.filter(d(j)),l=this.item(k),m=c.extend(!0,{},j,l),n=this.option(m);k.replaceWith(n)}else{var o=this.option(j);if(j.children){var p=this.convertToOptions(j.children);b.appendMany(o,p)}h.push(o)}}return h},d}),b.define("select2/data/ajax",["./array","../utils","jquery"],function(a,b,c){function d(a,b){this.ajaxOptions=this._applyDefaults(b.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),d.__super__.constructor.call(this,a,b)}return b.Extend(d,a),d.prototype._applyDefaults=function(a){var b={data:function(a){return c.extend({},a,{q:a.term})},transport:function(a,b,d){var e=c.ajax(a);return e.then(b),e.fail(d),e}};return c.extend({},b,a,!0)},d.prototype.processResults=function(a){return a},d.prototype.query=function(a,b){function d(){var d=f.transport(f,function(d){var f=e.processResults(d,a);e.options.get("debug")&&window.console&&console.error&&(f&&f.results&&c.isArray(f.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),b(f)},function(){d.status&&"0"===d.status||e.trigger("results:message",{message:"errorLoading"})});e._request=d}var e=this;null!=this._request&&(c.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var f=c.extend({type:"GET"},this.ajaxOptions);"function"==typeof f.url&&(f.url=f.url.call(this.$element,a)),"function"==typeof f.data&&(f.data=f.data.call(this.$element,a)),this.ajaxOptions.delay&&null!=a.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(d,this.ajaxOptions.delay)):d()},d}),b.define("select2/data/tags",["jquery"],function(a){function b(b,c,d){var e=d.get("tags"),f=d.get("createTag");void 0!==f&&(this.createTag=f);var g=d.get("insertTag");if(void 0!==g&&(this.insertTag=g),b.call(this,c,d),a.isArray(e))for(var h=0;h<e.length;h++){var i=e[h],j=this._normalizeItem(i),k=this.option(j);this.$element.append(k)}}return b.prototype.query=function(a,b,c){function d(a,f){for(var g=a.results,h=0;h<g.length;h++){var i=g[h],j=null!=i.children&&!d({results:i.children},!0);if((i.text||"").toUpperCase()===(b.term||"").toUpperCase()||j)return!f&&(a.data=g,void c(a))}if(f)return!0;var k=e.createTag(b);if(null!=k){var l=e.option(k);l.attr("data-select2-tag",!0),e.addOptions([l]),e.insertTag(g,k)}a.results=g,c(a)}var e=this;this._removeOldTags(),null!=b.term&&null==b.page?a.call(this,b,d):a.call(this,b,c)},b.prototype.createTag=function(b,c){var d=a.trim(c.term);return""===d?null:{id:d,text:d}},b.prototype.insertTag=function(a,b,c){b.unshift(c)},b.prototype._removeOldTags=function(b){this._lastTag,this.$element.find("option[data-select2-tag]").each(function(){this.selected||a(this).remove()})},b}),b.define("select2/data/tokenizer",["jquery"],function(a){function b(a,b,c){var d=c.get("tokenizer");void 0!==d&&(this.tokenizer=d),a.call(this,b,c)}return b.prototype.bind=function(a,b,c){a.call(this,b,c),this.$search=b.dropdown.$search||b.selection.$search||c.find(".select2-search__field")},b.prototype.query=function(b,c,d){var g=this;c.term=c.term||"";var h=this.tokenizer(c,this.options,function(b){var c=g._normalizeItem(b);if(!g.$element.find("option").filter(function(){return a(this).val()===c.id}).length){var d=g.option(c);d.attr("data-select2-tag",!0),g._removeOldTags(),g.addOptions([d])}!function(a){g.trigger("select",{data:a})}(c)});h.term!==c.term&&(this.$search.length&&(this.$search.val(h.term),this.$search.focus()),c.term=h.term),b.call(this,c,d)},b.prototype.tokenizer=function(b,c,d,e){for(var f=d.get("tokenSeparators")||[],g=c.term,h=0,i=this.createTag||function(a){return{id:a.term,text:a.term}};h<g.length;){var j=g[h];if(-1!==a.inArray(j,f)){var k=g.substr(0,h),m=i(a.extend({},c,{term:k}));null!=m?(e(m),g=g.substr(h+1)||"",h=0):h++}else h++}return{term:g}},b}),b.define("select2/data/minimumInputLength",[],function(){function a(a,b,c){this.minimumInputLength=c.get("minimumInputLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){b.term=b.term||"",b.term.length<this.minimumInputLength?this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:b.term,params:b}}):a.call(this,b,c)},a}),b.define("select2/data/maximumInputLength",[],function(){function a(a,b,c){this.maximumInputLength=c.get("maximumInputLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){b.term=b.term||"",this.maximumInputLength>0&&b.term.length>this.maximumInputLength?this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:b.term,params:b}}):a.call(this,b,c)},a}),b.define("select2/data/maximumSelectionLength",[],function(){function a(a,b,c){this.maximumSelectionLength=c.get("maximumSelectionLength"),a.call(this,b,c)}return a.prototype.query=function(a,b,c){var d=this;this.current(function(e){var f=null!=e?e.length:0;d.maximumSelectionLength>0&&f>=d.maximumSelectionLength?d.trigger("results:message",{message:"maximumSelected",args:{maximum:d.maximumSelectionLength}}):a.call(d,b,c)})},a}),b.define("select2/dropdown",["jquery","./utils"],function(a,b){function c(a,b){this.$element=a,this.options=b,c.__super__.constructor.call(this)}return b.Extend(c,b.Observable),c.prototype.render=function(){var b=a('<span class="select2-dropdown"><span class="select2-results"></span></span>');return b.attr("dir",this.options.get("dir")),this.$dropdown=b,b},c.prototype.bind=function(){},c.prototype.position=function(a,b){},c.prototype.destroy=function(){this.$dropdown.remove()},c}),b.define("select2/dropdown/search",["jquery","../utils"],function(a,b){function c(){}return c.prototype.render=function(b){var c=b.call(this),d=a('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="textbox" /></span>');return this.$searchContainer=d,this.$search=d.find("input"),c.prepend(d),c},c.prototype.bind=function(b,c,d){var e=this;b.call(this,c,d),this.$search.on("keydown",function(a){e.trigger("keypress",a),e._keyUpPrevented=a.isDefaultPrevented()}),this.$search.on("input",function(b){a(this).off("keyup")}),this.$search.on("keyup input",function(a){e.handleSearch(a)}),c.on("open",function(){e.$search.attr("tabindex",0),e.$search.focus(),window.setTimeout(function(){e.$search.focus()},0)}),c.on("close",function(){e.$search.attr("tabindex",-1),e.$search.val("")}),c.on("focus",function(){c.isOpen()||e.$search.focus()}),c.on("results:all",function(a){null!=a.query.term&&""!==a.query.term||(e.showSearch(a)?e.$searchContainer.removeClass("select2-search--hide"):e.$searchContainer.addClass("select2-search--hide"))})},c.prototype.handleSearch=function(a){if(!this._keyUpPrevented){var b=this.$search.val();this.trigger("query",{term:b})}this._keyUpPrevented=!1},c.prototype.showSearch=function(a,b){return!0},c}),b.define("select2/dropdown/hidePlaceholder",[],function(){function a(a,b,c,d){this.placeholder=this.normalizePlaceholder(c.get("placeholder")),a.call(this,b,c,d)}return a.prototype.append=function(a,b){b.results=this.removePlaceholder(b.results),a.call(this,b)},a.prototype.normalizePlaceholder=function(a,b){return"string"==typeof b&&(b={id:"",text:b}),b},a.prototype.removePlaceholder=function(a,b){for(var c=b.slice(0),d=b.length-1;d>=0;d--){var e=b[d];this.placeholder.id===e.id&&c.splice(d,1)}return c},a}),b.define("select2/dropdown/infiniteScroll",["jquery"],function(a){function b(a,b,c,d){this.lastParams={},a.call(this,b,c,d),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return b.prototype.append=function(a,b){this.$loadingMore.remove(),this.loading=!1,a.call(this,b),this.showLoadingMore(b)&&this.$results.append(this.$loadingMore)},b.prototype.bind=function(b,c,d){var e=this;b.call(this,c,d),c.on("query",function(a){e.lastParams=a,e.loading=!0}),c.on("query:append",function(a){e.lastParams=a,e.loading=!0}),this.$results.on("scroll",function(){var b=a.contains(document.documentElement,e.$loadingMore[0]);!e.loading&&b&&e.$results.offset().top+e.$results.outerHeight(!1)+50>=e.$loadingMore.offset().top+e.$loadingMore.outerHeight(!1)&&e.loadMore()})},b.prototype.loadMore=function(){this.loading=!0;var b=a.extend({},{page:1},this.lastParams);b.page++,this.trigger("query:append",b)},b.prototype.showLoadingMore=function(a,b){return b.pagination&&b.pagination.more},b.prototype.createLoadingMore=function(){var b=a('<li class="select2-results__option select2-results__option--load-more"role="treeitem" aria-disabled="true"></li>'),c=this.options.get("translations").get("loadingMore");return b.html(c(this.lastParams)),b},b}),b.define("select2/dropdown/attachBody",["jquery","../utils"],function(a,b){function c(b,c,d){this.$dropdownParent=d.get("dropdownParent")||a(document.body),b.call(this,c,d)}return c.prototype.bind=function(a,b,c){var d=this,e=!1;a.call(this,b,c),b.on("open",function(){d._showDropdown(),d._attachPositioningHandler(b),e||(e=!0,b.on("results:all",function(){d._positionDropdown(),d._resizeDropdown()}),b.on("results:append",function(){d._positionDropdown(),d._resizeDropdown()}))}),b.on("close",function(){d._hideDropdown(),d._detachPositioningHandler(b)}),this.$dropdownContainer.on("mousedown",function(a){a.stopPropagation()})},c.prototype.destroy=function(a){a.call(this),this.$dropdownContainer.remove()},c.prototype.position=function(a,b,c){b.attr("class",c.attr("class")),b.removeClass("select2"),b.addClass("select2-container--open"),b.css({position:"absolute",top:-999999}),this.$container=c},c.prototype.render=function(b){var c=a("<span></span>"),d=b.call(this);return c.append(d),this.$dropdownContainer=c,c},c.prototype._hideDropdown=function(a){this.$dropdownContainer.detach()},c.prototype._attachPositioningHandler=function(c,d){var e=this,f="scroll.select2."+d.id,g="resize.select2."+d.id,h="orientationchange.select2."+d.id,i=this.$container.parents().filter(b.hasScroll);i.each(function(){a(this).data("select2-scroll-position",{x:a(this).scrollLeft(),y:a(this).scrollTop()})}),i.on(f,function(b){var c=a(this).data("select2-scroll-position");a(this).scrollTop(c.y)}),a(window).on(f+" "+g+" "+h,function(a){e._positionDropdown(),e._resizeDropdown()})},c.prototype._detachPositioningHandler=function(c,d){var e="scroll.select2."+d.id,f="resize.select2."+d.id,g="orientationchange.select2."+d.id;this.$container.parents().filter(b.hasScroll).off(e),a(window).off(e+" "+f+" "+g)},c.prototype._positionDropdown=function(){var b=a(window),c=this.$dropdown.hasClass("select2-dropdown--above"),d=this.$dropdown.hasClass("select2-dropdown--below"),e=null,f=this.$container.offset();f.bottom=f.top+this.$container.outerHeight(!1);var g={height:this.$container.outerHeight(!1)};g.top=f.top,g.bottom=f.top+g.height;var h_height=this.$dropdown.outerHeight(!1),i_top=b.scrollTop(),i_bottom=b.scrollTop()+b.height(),j=i_top<f.top-h_height,k=i_bottom>f.bottom+h_height,l={left:f.left,top:g.bottom},m=this.$dropdownParent;"static"===m.css("position")&&(m=m.offsetParent());var n=m.offset();l.top-=n.top,l.left-=n.left,c||d||(e="below"),k||!j||c?!j&&k&&c&&(e="below"):e="above",("above"==e||c&&"below"!==e)&&(l.top=g.top-n.top-h_height),null!=e&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+e),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+e)),this.$dropdownContainer.css(l)},c.prototype._resizeDropdown=function(){var a={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(a.minWidth=a.width,a.position="relative",a.width="auto"),this.$dropdown.css(a)},c.prototype._showDropdown=function(a){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},c}),b.define("select2/dropdown/minimumResultsForSearch",[],function(){function a(b){for(var c=0,d=0;d<b.length;d++){var e=b[d];e.children?c+=a(e.children):c++}return c}function b(a,b,c,d){this.minimumResultsForSearch=c.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),a.call(this,b,c,d)}return b.prototype.showSearch=function(b,c){return!(a(c.data.results)<this.minimumResultsForSearch)&&b.call(this,c)},b}),b.define("select2/dropdown/selectOnClose",[],function(){function a(){}return a.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),b.on("close",function(a){d._handleSelectOnClose(a)})},a.prototype._handleSelectOnClose=function(a,b){if(b&&null!=b.originalSelect2Event){var c=b.originalSelect2Event;if("select"===c._type||"unselect"===c._type)return}var d=this.getHighlightedResults();if(!(d.length<1)){var e=d.data("data");null!=e.element&&e.element.selected||null==e.element&&e.selected||this.trigger("select",{data:e})}},a}),b.define("select2/dropdown/closeOnSelect",[],function(){function a(){}return a.prototype.bind=function(a,b,c){var d=this;a.call(this,b,c),b.on("select",function(a){d._selectTriggered(a)}),b.on("unselect",function(a){d._selectTriggered(a)})},a.prototype._selectTriggered=function(a,b){var c=b.originalEvent;c&&c.ctrlKey||this.trigger("close",{originalEvent:c,originalSelect2Event:b})},a}),b.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(a){var b=a.input.length-a.maximum,c="Please delete "+b+" character";return 1!=b&&(c+="s"),c},inputTooShort:function(a){return"Please enter "+(a.minimum-a.input.length)+" or more characters"},loadingMore:function(){return"Loading more results…"},maximumSelected:function(a){var b="You can only select "+a.maximum+" item";return 1!=a.maximum&&(b+="s"),b},noResults:function(){return"No results found"},searching:function(){return"Searching…"}}}),b.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){function D(){this.reset()}return D.prototype.apply=function(l){if(null==(l=a.extend(!0,{},this.defaults,l)).dataAdapter){if(null!=l.ajax?l.dataAdapter=o:null!=l.data?l.dataAdapter=n:l.dataAdapter=m,l.minimumInputLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,r)),l.maximumInputLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,s)),l.maximumSelectionLength>0&&(l.dataAdapter=j.Decorate(l.dataAdapter,t)),l.tags&&(l.dataAdapter=j.Decorate(l.dataAdapter,p)),null==l.tokenSeparators&&null==l.tokenizer||(l.dataAdapter=j.Decorate(l.dataAdapter,q)),null!=l.query){var C=b(l.amdBase+"compat/query");l.dataAdapter=j.Decorate(l.dataAdapter,C)}if(null!=l.initSelection){var D=b(l.amdBase+"compat/initSelection");l.dataAdapter=j.Decorate(l.dataAdapter,D)}}if(null==l.resultsAdapter&&(l.resultsAdapter=c,null!=l.ajax&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,x)),null!=l.placeholder&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,w)),l.selectOnClose&&(l.resultsAdapter=j.Decorate(l.resultsAdapter,A))),null==l.dropdownAdapter){if(l.multiple)l.dropdownAdapter=u;else{var E=j.Decorate(u,v);l.dropdownAdapter=E}if(0!==l.minimumResultsForSearch&&(l.dropdownAdapter=j.Decorate(l.dropdownAdapter,z)),l.closeOnSelect&&(l.dropdownAdapter=j.Decorate(l.dropdownAdapter,B)),null!=l.dropdownCssClass||null!=l.dropdownCss||null!=l.adaptDropdownCssClass){var F=b(l.amdBase+"compat/dropdownCss");l.dropdownAdapter=j.Decorate(l.dropdownAdapter,F)}l.dropdownAdapter=j.Decorate(l.dropdownAdapter,y)}if(null==l.selectionAdapter){if(l.multiple?l.selectionAdapter=e:l.selectionAdapter=d,null!=l.placeholder&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,f)),l.allowClear&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,g)),l.multiple&&(l.selectionAdapter=j.Decorate(l.selectionAdapter,h)),null!=l.containerCssClass||null!=l.containerCss||null!=l.adaptContainerCssClass){var G=b(l.amdBase+"compat/containerCss");l.selectionAdapter=j.Decorate(l.selectionAdapter,G)}l.selectionAdapter=j.Decorate(l.selectionAdapter,i)}if("string"==typeof l.language)if(l.language.indexOf("-")>0){var I=l.language.split("-")[0];l.language=[l.language,I]}else l.language=[l.language];if(a.isArray(l.language)){var J=new k;l.language.push("en");for(var K=l.language,L=0;L<K.length;L++){var M=K[L],N={};try{N=k.loadPath(M)}catch(a){try{M=this.defaults.amdLanguageBase+M,N=k.loadPath(M)}catch(a){l.debug&&window.console&&console.warn&&console.warn('Select2: The language file for "'+M+'" could not be automatically loaded. A fallback will be used instead.');continue}}J.extend(N)}l.translations=J}else{var O=k.loadPath(this.defaults.amdLanguageBase+"en"),P=new k(l.language);P.extend(O),l.translations=P}return l},D.prototype.reset=function(){function b(a){return a.replace(/[^\u0000-\u007E]/g,function(a){return l[a]||a})}function c(d,e){if(""===a.trim(d.term))return e;if(e.children&&e.children.length>0){for(var f=a.extend(!0,{},e),g=e.children.length-1;g>=0;g--)null==c(d,e.children[g])&&f.children.splice(g,1);return f.children.length>0?f:c(d,f)}var h=b(e.text).toUpperCase(),i=b(d.term).toUpperCase();return h.indexOf(i)>-1?e:null}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:j.escapeMarkup,language:C,matcher:c,minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,sorter:function(a){return a},templateResult:function(a){return a.text},templateSelection:function(a){return a.text},theme:"default",width:"resolve"}},D.prototype.set=function(b,c){var e={};e[a.camelCase(b)]=c;var f=j._convertData(e);a.extend(this.defaults,f)},new D}),b.define("select2/options",["require","jquery","./defaults","./utils"],function(a,b,c,d){function e(b,e){if(this.options=b,null!=e&&this.fromElement(e),this.options=c.apply(this.options),e&&e.is("input")){var f=a(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=d.Decorate(this.options.dataAdapter,f)}}return e.prototype.fromElement=function(a){var c=["select2"];null==this.options.multiple&&(this.options.multiple=a.prop("multiple")),null==this.options.disabled&&(this.options.disabled=a.prop("disabled")),null==this.options.language&&(a.prop("lang")?this.options.language=a.prop("lang").toLowerCase():a.closest("[lang]").prop("lang")&&(this.options.language=a.closest("[lang]").prop("lang"))),null==this.options.dir&&(a.prop("dir")?this.options.dir=a.prop("dir"):a.closest("[dir]").prop("dir")?this.options.dir=a.closest("[dir]").prop("dir"):this.options.dir="ltr"),a.prop("disabled",this.options.disabled),a.prop("multiple",this.options.multiple),a.data("select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),a.data("data",a.data("select2Tags")),a.data("tags",!0)),a.data("ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),a.attr("ajax--url",a.data("ajaxUrl")),a.data("ajax--url",a.data("ajaxUrl")));var e={};e=b.fn.jquery&&"1."==b.fn.jquery.substr(0,2)&&a[0].dataset?b.extend(!0,{},a[0].dataset,a.data()):a.data();var f=b.extend(!0,{},e);f=d._convertData(f);for(var g in f)b.inArray(g,c)>-1||(b.isPlainObject(this.options[g])?b.extend(this.options[g],f[g]):this.options[g]=f[g]);return this},e.prototype.get=function(a){return this.options[a]},e.prototype.set=function(a,b){this.options[a]=b},e}),b.define("select2/core",["jquery","./options","./utils","./keys"],function(a,b,c,d){var e=function(a,c){null!=a.data("select2")&&a.data("select2").destroy(),this.$element=a,this.id=this._generateId(a),c=c||{},this.options=new b(c,a),e.__super__.constructor.call(this);var d=a.attr("tabindex")||0;a.data("old-tabindex",d),a.attr("tabindex","-1");var f=this.options.get("dataAdapter");this.dataAdapter=new f(a,this.options);var g=this.render();this._placeContainer(g);var h=this.options.get("selectionAdapter");this.selection=new h(a,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,g);var i=this.options.get("dropdownAdapter");this.dropdown=new i(a,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,g);var j=this.options.get("resultsAdapter");this.results=new j(a,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var k=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current(function(a){k.trigger("selection:update",{data:a})}),a.addClass("select2-hidden-accessible"),a.attr("aria-hidden","true"),this._syncAttributes(),a.data("select2",this)};return c.Extend(e,c.Observable),e.prototype._generateId=function(a){var b="";return b=null!=a.attr("id")?a.attr("id"):null!=a.attr("name")?a.attr("name")+"-"+c.generateChars(2):c.generateChars(4),b=b.replace(/(:|\.|\[|\]|,)/g,""),b="select2-"+b},e.prototype._placeContainer=function(a){a.insertAfter(this.$element);var b=this._resolveWidth(this.$element,this.options.get("width"));null!=b&&a.css("width",b)},e.prototype._resolveWidth=function(a,b){var c=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==b){var d=this._resolveWidth(a,"style");return null!=d?d:this._resolveWidth(a,"element")}if("element"==b){var e=a.outerWidth(!1);return e<=0?"auto":e+"px"}if("style"==b){var f=a.attr("style");if("string"!=typeof f)return null;for(var g=f.split(";"),h=0,i=g.length;h<i;h+=1){var k=g[h].replace(/\s/g,"").match(c);if(null!==k&&k.length>=1)return k[1]}return null}return b},e.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},e.prototype._registerDomEvents=function(){var b=this;this.$element.on("change.select2",function(){b.dataAdapter.current(function(a){b.trigger("selection:update",{data:a})})}),this.$element.on("focus.select2",function(a){b.trigger("focus",a)}),this._syncA=c.bind(this._syncAttributes,this),this._syncS=c.bind(this._syncSubtree,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._syncA);var d=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=d?(this._observer=new d(function(c){a.each(c,b._syncA),a.each(c,b._syncS)}),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})):this.$element[0].addEventListener&&(this.$element[0].addEventListener("DOMAttrModified",b._syncA,!1),this.$element[0].addEventListener("DOMNodeInserted",b._syncS,!1),this.$element[0].addEventListener("DOMNodeRemoved",b._syncS,!1))},e.prototype._registerDataEvents=function(){var a=this;this.dataAdapter.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerSelectionEvents=function(){var b=this,c=["toggle","focus"];this.selection.on("toggle",function(){b.toggleDropdown()}),this.selection.on("focus",function(a){b.focus(a)}),this.selection.on("*",function(d,e){-1===a.inArray(d,c)&&b.trigger(d,e)})},e.prototype._registerDropdownEvents=function(){var a=this;this.dropdown.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerResultsEvents=function(){var a=this;this.results.on("*",function(b,c){a.trigger(b,c)})},e.prototype._registerEvents=function(){var a=this;this.on("open",function(){a.$container.addClass("select2-container--open")}),this.on("close",function(){a.$container.removeClass("select2-container--open")}),this.on("enable",function(){a.$container.removeClass("select2-container--disabled")}),this.on("disable",function(){a.$container.addClass("select2-container--disabled")}),this.on("blur",function(){a.$container.removeClass("select2-container--focus")}),this.on("query",function(b){a.isOpen()||a.trigger("open",{}),this.dataAdapter.query(b,function(c){a.trigger("results:all",{data:c,query:b})})}),this.on("query:append",function(b){this.dataAdapter.query(b,function(c){a.trigger("results:append",{data:c,query:b})})}),this.on("keypress",function(b){var c=b.which;a.isOpen()?c===d.ESC||c===d.TAB||c===d.UP&&b.altKey?(a.close(),b.preventDefault()):c===d.ENTER?(a.trigger("results:select",{}),b.preventDefault()):c===d.SPACE&&b.ctrlKey?(a.trigger("results:toggle",{}),b.preventDefault()):c===d.UP?(a.trigger("results:previous",{}),b.preventDefault()):c===d.DOWN&&(a.trigger("results:next",{}),b.preventDefault()):(c===d.ENTER||c===d.SPACE||c===d.DOWN&&b.altKey)&&(a.open(),b.preventDefault())})},e.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.options.get("disabled")?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},e.prototype._syncSubtree=function(a,b){var c=!1,d=this;if(!a||!a.target||"OPTION"===a.target.nodeName||"OPTGROUP"===a.target.nodeName){if(b)if(b.addedNodes&&b.addedNodes.length>0)for(var e=0;e<b.addedNodes.length;e++){b.addedNodes[e].selected&&(c=!0)}else b.removedNodes&&b.removedNodes.length>0&&(c=!0);else c=!0;c&&this.dataAdapter.current(function(a){d.trigger("selection:update",{data:a})})}},e.prototype.trigger=function(a,b){var c=e.__super__.trigger,d={open:"opening",close:"closing",select:"selecting",unselect:"unselecting"};if(void 0===b&&(b={}),a in d){var f=d[a],g={prevented:!1,name:a,args:b};if(c.call(this,f,g),g.prevented)return void(b.prevented=!0)}c.call(this,a,b)},e.prototype.toggleDropdown=function(){this.options.get("disabled")||(this.isOpen()?this.close():this.open())},e.prototype.open=function(){this.isOpen()||this.trigger("query",{})},e.prototype.close=function(){this.isOpen()&&this.trigger("close",{})},e.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},e.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},e.prototype.focus=function(a){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},e.prototype.enable=function(a){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),null!=a&&0!==a.length||(a=[!0]);var b=!a[0];this.$element.prop("disabled",b)},e.prototype.data=function(){this.options.get("debug")&&arguments.length>0&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var a=[];return this.dataAdapter.current(function(b){a=b}),a},e.prototype.val=function(b){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==b||0===b.length)return this.$element.val();var c=b[0];a.isArray(c)&&(c=a.map(c,function(a){return a.toString()})),this.$element.val(c).trigger("change")},e.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._syncA),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&(this.$element[0].removeEventListener("DOMAttrModified",this._syncA,!1),this.$element[0].removeEventListener("DOMNodeInserted",this._syncS,!1),this.$element[0].removeEventListener("DOMNodeRemoved",this._syncS,!1)),this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",this.$element.data("old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},e.prototype.render=function(){var b=a('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return b.attr("dir",this.options.get("dir")),this.$container=b,this.$container.addClass("select2-container--"+this.options.get("theme")),b.data("element",this.$element),b},e}),b.define("select2/compat/utils",["jquery"],function(a){return{syncCssClasses:function(b,c,d){var e,f,g=[];(e=a.trim(b.attr("class")))&&(e=""+e,a(e.split(/\s+/)).each(function(){0===this.indexOf("select2-")&&g.push(this)})),(e=a.trim(c.attr("class")))&&(e=""+e,a(e.split(/\s+/)).each(function(){0!==this.indexOf("select2-")&&null!=(f=d(this))&&g.push(f)})),b.attr("class",g.join(" "))}}}),b.define("select2/compat/containerCss",["jquery","./utils"],function(a,b){function d(){}return d.prototype.render=function(d){var e=d.call(this),f=this.options.get("containerCssClass")||"";a.isFunction(f)&&(f=f(this.$element));var g=this.options.get("adaptContainerCssClass");if(g=g||function(a){return null},-1!==f.indexOf(":all:")){f=f.replace(":all:","");var h=g;g=function(a){var b=h(a);return null!=b?b+" "+a:a}}var i=this.options.get("containerCss")||{};return a.isFunction(i)&&(i=i(this.$element)),b.syncCssClasses(e,this.$element,g),e.css(i),e.addClass(f),e},d}),b.define("select2/compat/dropdownCss",["jquery","./utils"],function(a,b){function d(){}return d.prototype.render=function(d){var e=d.call(this),f=this.options.get("dropdownCssClass")||"";a.isFunction(f)&&(f=f(this.$element));var g=this.options.get("adaptDropdownCssClass");if(g=g||function(a){return null},-1!==f.indexOf(":all:")){f=f.replace(":all:","");var h=g;g=function(a){var b=h(a);return null!=b?b+" "+a:a}}var i=this.options.get("dropdownCss")||{};return a.isFunction(i)&&(i=i(this.$element)),b.syncCssClasses(e,this.$element,g),e.css(i),e.addClass(f),e},d}),b.define("select2/compat/initSelection",["jquery"],function(a){function b(a,b,c){c.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `initSelection` option has been deprecated in favor of a custom data adapter that overrides the `current` method. This method is now called multiple times instead of a single time when the instance is initialized. Support will be removed for the `initSelection` option in future versions of Select2"),this.initSelection=c.get("initSelection"),this._isInitialized=!1,a.call(this,b,c)}return b.prototype.current=function(b,c){var d=this;this._isInitialized?b.call(this,c):this.initSelection.call(null,this.$element,function(b){d._isInitialized=!0,a.isArray(b)||(b=[b]),c(b)})},b}),b.define("select2/compat/inputData",["jquery"],function(a){function b(a,b,c){this._currentData=[],this._valueSeparator=c.get("valueSeparator")||",","hidden"===b.prop("type")&&c.get("debug")&&console&&console.warn&&console.warn("Select2: Using a hidden input with Select2 is no longer supported and may stop working in the future. It is recommended to use a `<select>` element instead."),a.call(this,b,c)}return b.prototype.current=function(b,c){function d(b,c){var e=[];return b.selected||-1!==a.inArray(b.id,c)?(b.selected=!0,e.push(b)):b.selected=!1,b.children&&e.push.apply(e,d(b.children,c)),e}for(var e=[],f=0;f<this._currentData.length;f++){var g=this._currentData[f];e.push.apply(e,d(g,this.$element.val().split(this._valueSeparator)))}c(e)},b.prototype.select=function(b,c){if(this.options.get("multiple")){var d=this.$element.val();d+=this._valueSeparator+c.id,this.$element.val(d),this.$element.trigger("change")}else this.current(function(b){a.map(b,function(a){a.selected=!1})}),this.$element.val(c.id),this.$element.trigger("change")},b.prototype.unselect=function(a,b){var c=this;b.selected=!1,this.current(function(a){for(var d=[],e=0;e<a.length;e++){var f=a[e];b.id!=f.id&&d.push(f.id)}c.$element.val(d.join(c._valueSeparator)),c.$element.trigger("change")})},b.prototype.query=function(a,b,c){for(var d=[],e=0;e<this._currentData.length;e++){var f=this._currentData[e],g=this.matches(b,f);null!==g&&d.push(g)}c({results:d})},b.prototype.addOptions=function(b,c){var d=a.map(c,function(b){return a.data(b[0],"data")});this._currentData.push.apply(this._currentData,d)},b}),b.define("select2/compat/matcher",["jquery"],function(a){return function(b){return function(c,d){var e=a.extend(!0,{},d);if(null==c.term||""===a.trim(c.term))return e;if(d.children){for(var f=d.children.length-1;f>=0;f--){var g=d.children[f];b(c.term,g.text,g)||e.children.splice(f,1)}if(e.children.length>0)return e}return b(c.term,d.text,d)?e:null}}}),b.define("select2/compat/query",[],function(){function a(a,b,c){c.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `query` option has been deprecated in favor of a custom data adapter that overrides the `query` method. Support will be removed for the `query` option in future versions of Select2."),a.call(this,b,c)}return a.prototype.query=function(a,b,c){b.callback=c,this.options.get("query").call(null,b)},a}),b.define("select2/dropdown/attachContainer",[],function(){function a(a,b,c){a.call(this,b,c)}return a.prototype.position=function(a,b,c){c.find(".dropdown-wrapper").append(b),b.addClass("select2-dropdown--below"),c.addClass("select2-container--below")},a}),b.define("select2/dropdown/stopPropagation",[],function(){function a(){}return a.prototype.bind=function(a,b,c){a.call(this,b,c);this.$dropdown.on(["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"].join(" "),function(a){a.stopPropagation()})},a}),b.define("select2/selection/stopPropagation",[],function(){function a(){}return a.prototype.bind=function(a,b,c){a.call(this,b,c);this.$selection.on(["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"].join(" "),function(a){a.stopPropagation()})},a}),function(c){"function"==typeof b.define&&b.define.amd?b.define("jquery-mousewheel",["jquery"],c):"object"==typeof exports?module.exports=c:c(a)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||n<f)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120==0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),b.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults"],function(a,b,c,d){if(null==a.fn.select2){var e=["open","close","destroy"];a.fn.select2=function(b){if("object"==typeof(b=b||{}))return this.each(function(){var d=a.extend(!0,{},b);new c(a(this),d)}),this;if("string"==typeof b){var d,f=Array.prototype.slice.call(arguments,1);return this.each(function(){var c=a(this).data("select2");null==c&&window.console&&console.error&&console.error("The select2('"+b+"') method was called on an element that is not using Select2."),d=c[b].apply(c,f)}),a.inArray(b,e)>-1?this:d}throw new Error("Invalid arguments for Select2: "+b)}}return null==a.fn.select2.defaults&&(a.fn.select2.defaults=d),c}),{define:b.define,require:b.require}}(),c=b.require("jquery.select2");return a.fn.select2.amd=b,c}),function(global){function Mirador(config){return this instanceof Mirador?(function(containerId){var container=jQuery("#"+containerId);container.hasClass("mirador-container")||container.addClass("mirador-container")}(config.id),this.eventEmitter=new Mirador.EventEmitter,this.saveController=new Mirador.SaveController(jQuery.extend(!0,{},config,{eventEmitter:this.eventEmitter})),this.viewer=new Mirador.Viewer({state:this.saveController,eventEmitter:this.eventEmitter}),this):new Mirador(config)}global.Mirador=global.Mirador||Mirador}(window),Mirador.Handlebars=Handlebars.create(),Mirador.DEFAULT_SETTINGS={workspaceType:"singleObject",saveSession:!1,workspaces:{singleObject:{label:"Single Object",addNew:!1,move:!1,iconClass:"image"},compare:{label:"Compare",iconClass:"columns"},bookReading:{defaultWindowOptions:{},label:"Book Reading",addNew:!0,move:!1,iconClass:"book"}},manifests:[],data:[],layout:"1x1",openManifestsPage:!1,preserveManifestOrder:!1,windowSettings:{availableViews:["ThumbnailsView","ImageView","ScrollView","BookView"],viewType:"ImageView",bottomPanel:!0,bottomPanelVisible:!0,sidePanel:!0,sidePanelOptions:{toc:!0,annotations:!1,tocTabAvailable:!0,layersTabAvailable:!1,searchTabAvailable:!1,annotationTabAvailable:!1},sidePanelVisible:!0,overlay:!0,canvasControls:{annotations:{annotationLayer:!0,annotationCreation:!0,annotationState:"off",annotationRefresh:!1},imageManipulation:{manipulationLayer:!0,controls:{rotate:!0,brightness:!0,contrast:!0,saturate:!0,grayscale:!0,invert:!0,mirror:!1}}},fullScreen:!0,displayLayout:!0,layoutOptions:{newObject:!0,close:!0,slotRight:!0,slotLeft:!0,slotAbove:!0,slotBelow:!0}},windowObjects:[],autoHideControls:!0,fadeDuration:400,timeoutDuration:3e3,availableAnnotationModes:[],availableAnnotationDrawingTools:["Rectangle","Ellipse","Freehand","Polygon","Pin"],availableAnnotationStylePickers:["StrokeColor","FillColor","StrokeType"],drawingToolsSettings:{doubleClickReactionTime:300,strokeColor:"deepSkyBlue",fillColor:"deepSkyBlue",fillColorAlpha:0,shapeHandleSize:10,fixedShapeSize:10,newlyCreatedShapeStrokeWidthFactor:5,hoverColor:"yellow"},availableExternalCommentsPanel:!1,shapeHandleSize:10,availableCanvasTools:[],mainMenuSettings:{show:!0,buttons:{bookmark:!1,layout:!0,options:!1,fullScreenViewer:!0}},workspacePanelSettings:{maxRows:5,maxColumns:5,preserveWindows:!0},showAddFromURLBox:!0,buildPath:"build/mirador/",i18nPath:"locales/",imagesPath:"images/",annotationEndpoint:{},annotationBodyEditor:{module:"TinyMCEAnnotationBodyEditor",options:{config:{plugins:"image link media directionality",toolbar:"bold italic | bullist numlist | link image media | removeformat | ltr rtl",tags:[]}}},jsonStorageEndpoint:{name:"JSONBlob API Endpoint",module:"JSONBlobAPI",options:{ssl:!0,port:"443",host:"jsonblob.com"}},manifestsPanel:{name:"Classic Mirador Manifests Panel",module:"ManifestsPanel",options:{}},sharingEndpoint:{url:"",storeId:123,APIKey:"23983hf98j3f9283jf2983fj"},lockController:{lockProfile:"lazyZoom",notifyMaxMin:!0}},function($){$.Viewer=function(options){jQuery.extend(!0,this,{id:null,data:null,element:null,canvas:null,workspaceType:null,layout:null,workspace:null,mainMenu:null,workspaceAutoSave:null,windowSize:{},resizeRatio:{},currentWorkspaceVisible:!0,state:null,eventEmitter:null,overlayStates:{workspacePanelVisible:!1,manifestsPanelVisible:!1,optionsPanelVisible:!1,bookmarkPanelVisible:!1},manifests:[]},options),this.id=this.state.getStateProperty("id"),this.data=this.state.getStateProperty("data"),this.element=this.element||jQuery("#"+this.id),options.availableAnnotationDrawingTools&&options.availableAnnotationDrawingTools.length>0&&(this.availableAnnotationDrawingTools=options.availableAnnotationDrawingTools),this.data&&this.init()},$.Viewer.prototype={init:function(){var i18nextOptions={fallbackLng:"en",load:"unspecific",debug:!1,backend:{loadPath:this.state.getStateProperty("buildPath")+this.state.getStateProperty("i18nPath")+"{{lng}}/{{ns}}.json"}},configuredLanguage=this.state.getStateProperty("language");configuredLanguage&&(i18nextOptions.lng=configuredLanguage),i18next.use(i18nextXHRBackend).use(i18nextBrowserLanguageDetector).init(i18nextOptions,this.setupViewer.bind(this))},setupViewer:function(){var backgroundImage=this.state.getStateProperty("buildPath")+this.state.getStateProperty("imagesPath")+"debut_dark.png";this.element.css("background-color","#333").css("background-image","url("+backgroundImage+")").css("background-position","left top").css("background-repeat","repeat"),$.Handlebars.registerHelper("t",function(i18n_key){var result=i18next.t(i18n_key);return new $.Handlebars.SafeString(result)});var showMainMenu=!1;jQuery.each(this.state.getStateProperty("mainMenuSettings").buttons,function(key,value){value&&(showMainMenu=!0)}),this.state.getStateProperty("mainMenuSettings").userButtons&&this.state.getStateProperty("mainMenuSettings").userButtons.length>0&&(showMainMenu=!0),this.state.getStateProperty("mainMenuSettings").userLogo&&!jQuery.isEmptyObject(this.state.getStateProperty("mainMenuSettings").userLogo)&&(showMainMenu=!0),!1===this.state.getStateProperty("mainMenuSettings").show&&(showMainMenu=!1),showMainMenu&&(this.mainMenu=new $.MainMenu({appendTo:this.element,state:this.state,eventEmitter:this.eventEmitter}),this.eventEmitter.publish("mainMenuInitialized")),this.canvas=jQuery("<div/>").addClass("mirador-viewer").appendTo(this.element),showMainMenu||this.canvas.css("top","0px"),this.layout="string"!=typeof this.state.getStateProperty("layout")?JSON.stringify(this.state.getStateProperty("layout")):this.state.getStateProperty("layout"),this.workspace=new $.Workspace({layoutDescription:"{"===this.layout.charAt(0)?JSON.parse(this.layout):$.layoutDescriptionFromGridString(this.layout),appendTo:this.element.find(".mirador-viewer"),state:this.state,eventEmitter:this.eventEmitter}),this.workspacePanel=new $.WorkspacePanel({appendTo:this.element.find(".mirador-viewer"),state:this.state,eventEmitter:this.eventEmitter}),this.manifestsPanel=new($[this.state.getStateProperty("manifestsPanel").module])(jQuery.extend({},this.state.getStateProperty("manifestsPanel").options,{appendTo:this.element.find(".mirador-viewer"),state:this.state,eventEmitter:this.eventEmitter})),showMainMenu&&this.state.getStateProperty("mainMenuSettings").buttons.bookmark&&(this.bookmarkPanel=new $.BookmarkPanel({appendTo:this.element.find(".mirador-viewer"),state:this.state,eventEmitter:this.eventEmitter})),this.set("currentWorkspaceVisible",!0),this.bindEvents(),this.listenForActions(),this.getManifestsData(),0===this.state.getStateProperty("windowObjects").length&&this.state.getStateProperty("openManifestsPage")&&this.workspace.slots[0].addItem()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("manifestReceived",function(event,newManifest){if(_this.state.getStateProperty("windowObjects")){var check=jQuery.grep(_this.state.getStateProperty("windowObjects"),function(object,index){return object.loadedManifest===newManifest.uri});jQuery.each(check,function(index,config){_this.loadManifestFromConfig(config)})}}),_this.eventEmitter.subscribe("TOGGLE_WORKSPACE_PANEL",function(event){_this.toggleWorkspacePanel()}),_this.eventEmitter.subscribe("TOGGLE_BOOKMARK_PANEL",function(event){_this.toggleBookmarkPanel()}),_this.eventEmitter.subscribe("TOGGLE_FULLSCREEN",function(event){$.fullscreenElement()?($.exitFullscreen(),_this.eventEmitter.publish("ENABLE_WINDOW_FULLSCREEN")):($.enterFullscreen(_this.element[0]),_this.eventEmitter.publish("DISABLE_WINDOW_FULLSCREEN"))}),jQuery(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){_this.eventEmitter.publish("MAINMENU_FULLSCREEN_BUTTON"),$.fullscreenElement()||_this.eventEmitter.publish("ENABLE_WINDOW_FULLSCREEN")}),_this.eventEmitter.subscribe("TOGGLE_LOAD_WINDOW",function(event){_this.toggleLoadWindow()}),_this.eventEmitter.subscribe("ADD_MANIFEST_FROM_URL",function(event,url,location){_this.addManifestFromUrl(url,location)}),_this.eventEmitter.subscribe("TOGGLE_OVERLAYS_FALSE",function(event){jQuery.each(_this.overlayStates,function(oState,value){_this.set(oState,!1,{parent:"overlayStates"})})})},bindEvents:function(){},get:function(prop,parent){return parent?this[parent][prop]:this[prop]},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value,this.eventEmitter.publish(prop+".set",value)},toggleOverlay:function(state){var _this=this;jQuery.each(this.overlayStates,function(oState,value){state!==oState&&_this.set(oState,!1,{parent:"overlayStates"})});var currentState=this.get(state,"overlayStates");this.set(state,!currentState,{parent:"overlayStates"})},toggleLoadWindow:function(){this.toggleOverlay("manifestsPanelVisible")},toggleWorkspacePanel:function(){this.toggleOverlay("workspacePanelVisible")},toggleBookmarkPanel:function(){this.toggleOverlay("bookmarkPanelVisible")},getManifestsData:function(){var _this=this;_this.data.forEach(function(manifest){if(manifest.hasOwnProperty("manifestContent")){var content=manifest.manifestContent;_this.addManifestFromUrl(content["@id"],manifest.location?manifest.location:"",content)}else if(manifest.hasOwnProperty("manifestUri")){var url=manifest.manifestUri;_this.addManifestFromUrl(url,manifest.location?manifest.location:"",null)}else if(manifest.hasOwnProperty("collectionContent")){var collectionContent=manifest.collectionContent;_this.addCollectionFromUrl(collectionContent["@id"],manifest.location?manifest.location:"",collectionContent)}else if(manifest.hasOwnProperty("collectionUri")){var collectionUrl=manifest.collectionUri;_this.addCollectionFromUrl(collectionUrl,manifest.location?manifest.location:"",null)}})},hasWidgets:function(collection){return void 0!==collection.widgets&&collection.widgets&&!jQuery.isEmptyObject(collection.widgets)&&collection.widgets.length>0},addManifestFromUrl:function(url,location,content){var manifest,_this=this;_this.state.getStateProperty("manifests")[url]||(manifest=new $.Manifest(url,location,content),_this.eventEmitter.publish("manifestQueued",manifest,location),manifest.request.done(function(){_this.eventEmitter.publish("manifestReceived",manifest)}))},addCollectionFromUrl:function(url,location,content){var collection,_this=this;_this.state.getStateProperty("manifests")[url]||(collection=new $.Collection(url,location,content),_this.eventEmitter.publish("manifestQueued",collection,location),collection.request.done(function(){_this.eventEmitter.publish("collectionReceived",[collection,url,null])}))},loadManifestFromConfig:function(options){var windowConfig=jQuery.extend(!0,{},options);this.eventEmitter.publish("DELETE_FROM_CONFIG",options),this.eventEmitter.publish("ADD_WINDOW",windowConfig)}}}(Mirador),function($){$.Workspace=function(options){jQuery.extend(!0,this,{workspaceSlotCls:"slot",focusedSlot:null,slots:[],windows:[],appendTo:null,layoutDescription:null,state:null,eventEmitter:null},options);var uid=$.genUUID();this.element=this.element||jQuery('<div class="workspace-container" id="workspace-'+uid+'">'),this.init()},$.Workspace.prototype={init:function(){this.element.appendTo(this.appendTo),this.calculateLayout(),this.bindEvents(),this.listenForActions()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("resizeMirador",function(event){_this.calculateLayout()}),_this.eventEmitter.subscribe("manifestQueued",function(event,manifestPromise){var targetSlot;if(_this.state.getStateProperty("windowObjects"))_this.state.getStateProperty("windowObjects").forEach(function(windowConfig,index){targetSlot=windowConfig.slotAddress?_this.getSlotFromAddress(windowConfig.slotAddress):_this.focusedSlot||_this.slots.filter(function(slot){return!!slot.hasOwnProperty("window")})[0]})}),_this.eventEmitter.subscribe("REMOVE_WINDOW",function(event,windowId){_this.removeWindow(windowId)}),_this.eventEmitter.subscribe("REMOVE_NODE",function(event,node){_this.removeNode(node)}),_this.eventEmitter.subscribe("ADD_SLOT_ITEM",function(event,slot){_this.addItem(slot)}),_this.eventEmitter.subscribe("ADD_WINDOW",function(event,windowConfig){_this.addWindow(windowConfig)}),_this.eventEmitter.subscribe("SPLIT_RIGHT",function(event,slot){_this.splitRight(slot)}),_this.eventEmitter.subscribe("SPLIT_LEFT",function(event,slot){_this.splitLeft(slot)}),_this.eventEmitter.subscribe("SPLIT_DOWN",function(event,slot){_this.splitDown(slot)}),_this.eventEmitter.subscribe("SPLIT_UP",function(event,slot){_this.splitUp(slot)}),_this.eventEmitter.subscribe("RESET_WORKSPACE_LAYOUT",function(event,options){_this.resetLayout(options.layoutDescription)})},bindEvents:function(){var _this=this;d3.select(window).on("resize",function(event){_this.calculateLayout()})},get:function(prop,parent){return parent?this[parent][prop]:this[prop]},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value,this.eventEmitter.publish(prop+".set",value)},calculateLayout:function(resetting){function cell(){this.style("left",function(d){return d.x+"px"}).style("top",function(d){return d.y+"px"}).style("width",function(d){return Math.max(0,d.dx)+"px"}).style("height",function(d){return Math.max(0,d.dy)+"px"})}var layout,_this=this;_this.layout=layout=new Isfahan({containerId:_this.element.attr("id"),layoutDescription:_this.layoutDescription,configuration:null,padding:3});var data=layout.filter(function(d){return!d.children}),divs=d3.select("#"+_this.element.attr("id")).selectAll(".layout-slot").data(data,function(d){return d.id});divs.call(cell).each(function(d){_this.slots.forEach(function(slot){slot.slotID===d.id&&(slot.layoutAddress=d.address)})}),divs.enter().append("div").attr("class","layout-slot").attr("data-layout-slot-id",function(d){return d.id}).call(cell).each(function(d){var appendTo=_this.element.children("div").filter('[data-layout-slot-id="'+d.id+'"]')[0];_this.slots.push(new $.Slot({slotID:d.id,layoutAddress:d.address,focused:!0,appendTo:appendTo,state:_this.state,eventEmitter:_this.eventEmitter}))}),divs.exit().remove("div").each(function(d){var slot=_this.slots.reduce(function(map,temp_slot){return d.id===temp_slot.slotID&&(map[d.id]=temp_slot),map},{})[d.id];slot&&slot.window&&!resetting&&_this.eventEmitter.publish("REMOVE_WINDOW",slot.window.id),slot.window=null,_this.slots.splice(_this.slots.indexOf(slot),1)});var root=jQuery.grep(_this.layout,function(node){return!node.parent})[0];_this.eventEmitter.publish("layoutChanged",root),_this.eventEmitter.publish("slotsUpdated",{slots:_this.slots}),_this.slots.length<=1?_this.eventEmitter.publish("HIDE_REMOVE_SLOT"):_this.eventEmitter.publish("SHOW_REMOVE_SLOT")},split:function(targetSlot,direction){function addSibling(node,indexDifference){if(nodeIsNotRoot){var siblingIndex=nodeIndex+indexDifference,newSibling=_this.newNode(node.type,node);return node.parent.children.splice(siblingIndex,0,newSibling),_this.layout.push(newSibling),newSibling}node.type="row"===node.type?"column":"row",mutateAndAdd(node,indexDifference)}function mutateAndAdd(node,indexDifference){var newParent=_this.newNode(node.type,node.parent);node.type="row"===node.type?"column":"row",newSibling=_this.newNode(node.type,newParent),newParent.children=[],newParent.children.push(node),newParent.children.splice(indexDifference,0,newSibling),nodeIsNotRoot&&(newParent.parent=node.parent,newParent.parent.children[nodeIndex]=newParent),node.parent=newParent,_this.layout.push(newParent,newSibling)}var _this=this,node=jQuery.grep(_this.layout,function(node){return node.id===targetSlot.slotID})[0];nodeIndex=node.parent?node.parent.children.indexOf(node):0,nodeIsNotRoot=node.parent,"column"===node.type?"r"===direction||"l"===direction?(indexDifference="r"===direction?1:0,addSibling(node,indexDifference)):(indexDifference="d"===direction?1:0,mutateAndAdd(node,indexDifference)):"r"===direction||"l"===direction?(indexDifference="r"===direction?1:0,mutateAndAdd(node,indexDifference)):(indexDifference="d"===direction?1:0,addSibling(node,indexDifference));var root=jQuery.grep(_this.layout,function(node){return!node.parent})[0];_this.layoutDescription=root,_this.calculateLayout()},splitRight:function(targetSlot){this.split(targetSlot,"r")},splitLeft:function(targetSlot){this.split(targetSlot,"l")},splitUp:function(targetSlot){this.split(targetSlot,"u")},splitDown:function(targetSlot){this.split(targetSlot,"d")},removeNode:function(targetSlot){var remainingNode,node=jQuery.grep(this.layout,function(node){return node.id===targetSlot.slotID})[0],nodeIndex=node.parent.children.indexOf(node),root=jQuery.grep(this.layout,function(node){return!node.parent})[0];2===node.parent.children.length?(node.parent.children.splice(nodeIndex,1),(remainingNode=node.parent.children[0]).parent.id=remainingNode.id,delete node.parent):1===node.parent.children.length||node.parent.children.splice(nodeIndex,1),this.layoutDescription=root,this.calculateLayout(),this.eventEmitter.publish("slotRemoved",targetSlot)},newNode:function(type,parent){return void 0===parent?{type:type,id:$.genUUID()}:{type:type,id:$.genUUID(),parent:parent}},getSlotFromAddress:function(address){return this.slots.filter(function(slot){return slot.layoutAddress===address})[0]},resetLayout:function(layoutDescription){this.layoutDescription=layoutDescription,this.calculateLayout(!0),this.placeWindows()},placeWindows:function(){var _this=this;_this.windows.length>_this.slots.length&&_this.windows.slice(0,_this.windows.length-_this.slots.length).forEach(function(removedWindow){_this.eventEmitter.publish("REMOVE_WINDOW",removedWindow.id)}),_this.windows.forEach(function(window){var slot=_this.getAvailableSlot();slot.window=window,window.update({id:window.id,slotAddress:slot.layoutAddress,state:_this.state,appendTo:slot.element,canvasID:window.canvasID,viewType:window.viewType})})},getAvailableSlot:function(){return this.slots.filter(function(slot){return!slot.window})[0]},clearSlot:function(slotId){this.slots[slotId].windowElement&&this.slots[slotId].windowElement.remove(),this.slots[slotId].window=null},addItem:function(slot){this.focusedSlot=slot,this.eventEmitter.publish("TOGGLE_LOAD_WINDOW")},addWindow:function(windowConfig){var newWindow,targetSlot;this.eventEmitter.publish("TOGGLE_OVERLAYS_FALSE"),targetSlot=windowConfig.slotAddress?this.getSlotFromAddress(windowConfig.slotAddress):this.focusedSlot||this.getAvailableSlot(),windowConfig.appendTo=targetSlot.element,windowConfig.state=this.state,windowConfig.eventEmitter=this.eventEmitter,targetSlot.window&&this.eventEmitter.publish("REMOVE_WINDOW",targetSlot.window.id),windowConfig.slotAddress=targetSlot.layoutAddress,windowConfig.id=windowConfig.id||$.genUUID(),this.eventEmitter.publish("windowSlotAdded",{id:windowConfig.id,slotAddress:windowConfig.slotAddress});var mergedConfig=jQuery.extend(!0,{},this.state.getStateProperty("windowSettings"),windowConfig);mergedConfig.hasOwnProperty("loadedManifest")&&(mergedConfig.manifest=this.state.getStateProperty("manifests")[mergedConfig.loadedManifest],delete mergedConfig.loadedManifest),mergedConfig.hasOwnProperty("bottomPanel")&&(mergedConfig.bottomPanelAvailable=mergedConfig.bottomPanel,delete mergedConfig.bottomPanel),mergedConfig.hasOwnProperty("sidePanel")&&(mergedConfig.sidePanelAvailable=mergedConfig.sidePanel,delete mergedConfig.sidePanel),windowConfig.state.currentConfig.hasOwnProperty("sidePanelOptions")&&jQuery.extend(mergedConfig.sidePanelOptions,windowConfig.state.currentConfig.sidePanelOptions),mergedConfig.hasOwnProperty("overlay")&&(mergedConfig.overlayAvailable=mergedConfig.overlay,delete mergedConfig.overlay),newWindow=new $.Window(mergedConfig),this.windows.push(newWindow),targetSlot.window=newWindow,this.eventEmitter.publish("windowAdded",{id:windowConfig.id,slotAddress:windowConfig.slotAddress})},removeWindow:function(windowId){this.windows=this.windows.filter(function(window){return window.id!==windowId}),this.eventEmitter.publish("windowRemoved",windowId)}}}(Mirador),function($){$.BookmarkPanel=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,state:null,eventEmitter:null},options),this.init()},$.BookmarkPanel.prototype={init:function(){this.element=jQuery(this.template()).appendTo(this.appendTo);var jsonStorageEndpoint=this.state.getStateProperty("jsonStorageEndpoint"),saveModule=jsonStorageEndpoint.module,saveOptions=jsonStorageEndpoint.options;this.storageModule=new $[saveModule](saveOptions),this.bindEvents(),this.listenForActions()},bindEvents:function(){},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("bookmarkPanelVisible.set",function(_,stateValue){_this.onPanelVisible(_,stateValue)}),_this.eventEmitter.subscribe("saveControllerConfigUpdated",function(){_this.onConfigUpdated()})},onPanelVisible:function(_,stateValue){stateValue?this.show():this.hide()},onConfigUpdated:function(){var _this=this;_this.storageModule.save(_this.state.cleanup(_this.state.currentConfig)).then(function(blobId){var bookmarkURL=window.location.href.replace(window.location.hash,"")+"?json="+blobId;_this.element.find("#share-url").val(bookmarkURL).focus().select()})},hide:function(){jQuery(this.element).hide({effect:"slide",direction:"up",duration:300,easing:"swing"})},show:function(){jQuery(this.element).show({effect:"slide",direction:"up",duration:300,easing:"swing"})},template:$.Handlebars.compile(['<div id="bookmark-panel">','<h3>{{t "bookmarkTitle"}}</h3>',"<span>",'{{t "url"}}: <input id="share-url" type="text"></input>','<a href="javascript:;" class="mirador-btn mirador-icon-copy" data-clipboard-target="share-url"><i class="fa fa-files-o fa-lg"></i></a>',"</span>","</div>"].join(""))}}(Mirador),function($){$.CollectionTreeManifestsPanel=function(options){jQuery.extend(!0,this,{element:null,listItems:null,appendTo:null,manifestListItems:[],manifestListElement:null,manifestLoadStatusIndicator:null,treeElement:null,expectedThings:[],preloadedManifests:[],userManifests:[],nodeManifests:{},nodeCollections:{},nodeIdToUri:{},uriToNodeId:{},nodeChildren:{},unexpandedNodes:{},topCollectionsUris:{},treeQueue:[],resultsWidth:0,state:null,eventEmitter:null},options);this.init()},$.CollectionTreeManifestsPanel.prototype={init:function(){var _this=this;this.element=jQuery(this.template({showURLBox:this.state.getStateProperty("showAddFromURLBox")})).appendTo(this.appendTo),this.manifestListElement=this.element.find("ul"),jQuery.each(this.state.currentConfig.data,function(_,v){v.hasOwnProperty("manifestUri")&&_this.preloadedManifests.push(v.manifestUri)}),this.expectedThings=this.preloadedManifests,this.treeElement=jQuery("#collection-tree").jstree({core:{data:[{id:"preload",text:i18next.t("preloadedManifests"),icon:"fa fa-suitcase",state:{selected:!0},children:[]},{id:"user",text:i18next.t("myManifests"),icon:"fa fa-user",children:[]}],themes:{dots:!1},check_callback:!0,multiple:!1}}).on("select_node.jstree",function(event,data){_this.changeNode(data.node)}).on("open_node.jstree",function(event,data){_this.expandNode(data.node)}).on("ready.jstree",function(){var theQueue=_this.treeQueue.slice(0);delete _this.treeQueue,jQuery.each(theQueue,function(_,v){4==v.length?_this.onCollectionReceived.apply(_this,v):_this.onCollectionNotReceived.apply(_this,v)})});var clone=this.element.clone().css("visibility","hidden").css("display","block").appendTo(this.appendTo);this.resultsWidth=clone.find(".member-select-results").outerWidth(),this.controlsHeight=clone.find(".manifest-panel-controls").outerHeight(),this.paddingListElement=this.controlsHeight,this.manifestListElement.css("padding-bottom",this.paddingListElement),clone.remove(),this.bindEvents(),this.listenForActions()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("manifestsPanelVisible.set",function(_,stateValue){_this.onPanelVisible(_,stateValue)}),_this.eventEmitter.subscribe("manifestReceived",function(event,newManifest){_this.onManifestReceived(event,newManifest)}),_this.eventEmitter.subscribe("collectionReceived",function(event,newCollection,parentUri,parentNodeId){_this.onCollectionReceived(event,newCollection,parentUri,parentNodeId)}),_this.eventEmitter.subscribe("collectionNotReceived",function(event,parentUri,parentNodeId){_this.onCollectionNotReceived(event,parentUri,parentNodeId)}),_this.eventEmitter.subscribe("ADD_MANIFEST_FROM_URL",function(event,url){-1==_this.userManifests.indexOf(url)&&_this.userManifests.push(url),_this.treeElement.jstree("deselect_all"),_this.treeElement.jstree("select_node","user")}),_this.eventEmitter.subscribe("ADD_COLLECTION_FROM_URL",function(event,url,source){_this.addCollectionFromUrl(url,null,!0)}),_this.eventEmitter.subscribe("ADD_OBJECT_FROM_URL",function(event,url,source){_this.addObjectFromUrl(url,source,!0)})},bindEvents:function(){var _this=this;this.element.find("form#url-load-form").on("submit",function(event){event.preventDefault(),_this.addObjectUrl(jQuery(this).find("input").val())}),this.element.find(".remove-object-option").on("click",function(event){_this.togglePanel(event)}),this.element.find("#manifest-search").on("keyup input",function(event){_this.filterManifests(this.value)}),this.element.find("#manifest-search-form").on("submit",function(event){event.preventDefault()}),jQuery(window).resize($.throttle(function(){_this.resizePanel()},50,!0))},hide:function(){jQuery(this.element).hide({effect:"fade",duration:160,easing:"easeOutCubic"})},show:function(){jQuery(this.element).show({effect:"fade",duration:160,easing:"easeInCubic"})},addManifestUrl:function(url){this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[url,"(Added from URL)"])},addObjectUrl:function(url){this.eventEmitter.publish("ADD_OBJECT_FROM_URL",[url,"(Added from URL)"])},togglePanel:function(event){this.eventEmitter.publish("TOGGLE_LOAD_WINDOW")},filterManifests:function(value){value.length>0?this.element.find(".items-listing li").show().filter(function(){return-1===jQuery(this).text().toLowerCase().indexOf(value.toLowerCase())}).hide():this.element.find(".items-listing li").show()},resizePanel:function(){var clone=this.element.clone().css("visibility","hidden").css("display","block").appendTo(this.appendTo);this.resultsWidth=clone.find(".member-select-results").outerWidth(),clone.remove(),this.eventEmitter.publish("manifestPanelWidthChanged",this.resultsWidth)},onPanelVisible:function(_,stateValue){stateValue?this.show():this.hide()},onManifestReceived:function(event,newManifest){-1!=this.expectedThings.indexOf(newManifest.uri)&&(this.manifestListItems.push(new $.ManifestListItem({manifest:newManifest,resultsWidth:this.resultsWidth,state:this.state,eventEmitter:this.eventEmitter,forcedIndex:this.expectedThings.indexOf(newManifest.uri),appendTo:this.manifestListElement})),this.element.find("#manifest-search").keyup())},onCollectionReceived:function(event,newCollection,uri,parentNodeId){void 0===this.treeQueue?parentNodeId?this.updateCollectionNode(parentNodeId,newCollection):this.addCollectionNode(parentNodeId,newCollection):this.treeQueue.push([event,newCollection,uri,parentNodeId])},onCollectionNotReceived:function(event,uri,parentNodeId){if(void 0===this.treeQueue){var _this=this;jQuery.each(this.uriToNodeId[uri],function(_,nodeId){_this.treeElement.jstree("set_icon",nodeId,"fa fa-ban"),_this.treeElement.jstree("disable_node",nodeId)})}else this.treeQueue.push([event,uri,parentNodeId])},clearManifestItems:function(){this.manifestListItems=[],this.manifestListElement.html("")},registerNodeIdUriPair:function(nodeId,uri){this.nodeIdToUri[nodeId]=uri,this.uriToNodeId[uri]?this.uriToNodeId[uri].push(nodeId):this.uriToNodeId[uri]=[nodeId]},changeNode:function(node){var _this=this;switch(this.clearManifestItems(),node.id){case"preload":_this.expectedThings=_this.preloadedManifests;break;case"user":_this.expectedThings=_this.userManifests;break;default:_this.expectedThings=_this.nodeManifests[node.id]}jQuery.each(_this.expectedThings,function(_,expectedThing){_this.addManifestFromUrl(expectedThing)}),this.element.find("#manifest-search").keyup()},expandNode:function(node){var _this=this;jQuery.each(_this.nodeCollections[node.id],function(_,uri){_this.updateCollectionFromUrl(uri,node.id)})},addObjectFromUrl:function(url,source){var _this=this,object=_this.state.getStateProperty("manifests")[url];if(object){if(object.jsonLd)switch(object.jsonLd["@type"]){case"sc:Collection":_this.eventEmitter.publish("ADD_COLLECTION_FROM_URL",[url,source]);break;case"sc:Manifest":_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[url,source])}}else jQuery.ajax({url:url,dataType:"json",type:"GET",success:function(data){switch(data["@type"]){case"sc:Collection":object=new $.Collection(url,source,data),_this.eventEmitter.publish("manifestQueued",object,""),_this.eventEmitter.publish("ADD_COLLECTION_FROM_URL",[url,source]);break;case"sc:Manifest":object=new $.Manifest(url,source,data),_this.eventEmitter.publish("manifestQueued",object,""),_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[url,source])}}})},addManifestFromUrl:function(url){var manifest,_this=this;_this.state.getStateProperty("manifests")[url]?(manifest=_this.state.getStateProperty("manifests")[url]).jsonLd&&_this.manifestListItems.push(new $.ManifestListItem({manifest:manifest,resultsWidth:_this.resultsWidth,state:_this.state,eventEmitter:_this.eventEmitter,forcedIndex:_this.expectedThings.indexOf(url),appendTo:_this.manifestListElement})):(manifest=new $.Manifest(url,""),_this.eventEmitter.publish("manifestQueued",manifest,""),manifest.request.done(function(){_this.eventEmitter.publish("manifestReceived",manifest)}))},addCollectionFromUrl:function(url,nodeId,jumpToIt){var collection,_this=this;if(!nodeId){if(_this.topCollectionsUris[url])return;_this.topCollectionsUris[url]=!0}if(void 0!==_this.state.getStateProperty("manifests")[url]){if((collection=_this.state.getStateProperty("manifests")[url]).jsonLd){var newNode=_this.addCollectionNode(nodeId,collection);jumpToIt&&(_this.treeElement.jstree("deselect_all"),_this.treeElement.jstree("select_node",newNode),collection.getCollectionUris().length>0&&_this.treeElement.jstree("open_node",newNode))}}else collection=new $.Collection(url,""),_this.eventEmitter.publish("manifestQueued",collection,""),collection.request.done(function(){_this.eventEmitter.publish("collectionReceived",[collection,url,nodeId||null])}),collection.request.fail(function(){_this.eventEmitter.publish("collectionNotReceived",[url,nodeId||null])})},updateCollectionFromUrl:function(url,nodeId){var collection,_this=this;void 0!==_this.state.getStateProperty("manifests")[url]?(collection=_this.state.getStateProperty("manifests")[url]).jsonLd&&_this.updateCollectionNode(nodeId,collection):(collection=new $.Collection(url,""),_this.eventEmitter.publish("manifestQueued",collection,""),collection.request.done(function(){_this.eventEmitter.publish("collectionReceived",[collection,url,nodeId||null])}),collection.request.fail(function(){_this.eventEmitter.publish("collectionNotReceived",[url,nodeId||null])}))},addCollectionNode:function(nodeId,collection,unexpanded){var _this=this,subcollectionBlocks=collection.getCollectionBlocks(),newNodeId=_this.treeElement.jstree("create_node",nodeId||null,{text:collection.jsonLd.label,icon:unexpanded?"fa fa-spinner fa-pulse":"fa fa-folder",children:[]},"last");return unexpanded&&_this.treeElement.jstree("disable_node",newNodeId),_this.registerNodeIdUriPair(newNodeId,collection.jsonLd["@id"]),_this.nodeCollections[newNodeId]=collection.getCollectionUris(),_this.nodeManifests[newNodeId]=collection.getManifestUris(),_this.nodeChildren[newNodeId]=[],unexpanded?_this.unexpandedNodes[newNodeId]=!0:jQuery.each(subcollectionBlocks,function(i,v){var nid=_this.treeElement.jstree("create_node",newNodeId,{text:v.label,icon:"fa fa-spinner fa-pulse",children:[]},"last");_this.registerNodeIdUriPair(nid,v["@id"]),_this.unexpandedNodes[nid]=!0,_this.nodeChildren[newNodeId].push(nid),_this.treeElement.jstree("disable_node",nid)}),newNodeId},updateCollectionNode:function(nodeId,collection){var _this=this,atId=collection.uri,collectionBlocks=collection.getCollectionBlocks(),collectionUris=collection.getCollectionUris(),manifestUris=collection.getManifestUris();jQuery.each(_this.nodeChildren[nodeId],function(_,n){_this.nodeIdToUri[n]==atId&&_this.unexpandedNodes[n]&&(_this.nodeCollections[n]=collectionUris,_this.nodeManifests[n]=manifestUris,_this.nodeChildren[n]=[],jQuery.each(collectionBlocks,function(i,v){var nn=_this.addCollectionNode(n,new $.Collection(v["@id"],null,v),!0);_this.nodeChildren[n].push(nn),_this.unexpandedNodes[nn]=!0}),delete _this.unexpandedNodes[n],_this.treeElement.jstree("set_icon",n,"fa fa-folder"),_this.treeElement.jstree("enable_node",n))})},template:$.Handlebars.compile(['<div id="manifest-select-menu">','<div class="container">','<div class="manifest-panel-controls">','<a class="remove-object-option"><i class="fa fa-times fa-lg fa-fw"></i>{{t "close"}}</a>','<div id="load-controls">',"{{#if showURLBox}}",'<form action="" id="url-load-form">','<label for="url-loader">{{t "addNewObject"}}:</label>','<input type="text" id="url-loader" name="url-load" placeholder="https://...">','<input type="submit" value="{{t "load"}}">',"</form>","{{/if}}",'<form action="" id="manifest-search-form">','<label for="manifest-search">{{t "filterObjects"}}:</label>','<input id="manifest-search" type="text" name="manifest-filter">',"</form>","</div>","</div>",'<div id="collection-tree">',"</div>",'<div class="member-select-results">','<ul class="items-listing">',"</ul>","</div>","</div>","</div>"].join(""))}}(Mirador),function($){$.MainMenu=function(options){jQuery.extend(!0,this,{element:null,mainMenuHeight:null,mainMenuWidth:null,windowOptionsMenu:null,loadWindow:null,clearLocalStorage:"",viewerCls:"mirador-viewer",mainMenuBarCls:"mirador-main-menu-bar",mainMenuCls:"mirador-main-menu",windowOptionsMenuCls:"mirador-window-options-menu",clearLocalStorageCls:"clear-local-storage",clearLocalStorageDialogCls:"mirador-main-menu-clear-local-storage",collectionsListingCls:"mirador-listing-collections",state:null,eventEmitter:null},options),this.element=this.element||jQuery("<div/>"),this.init()},$.MainMenu.prototype={init:function(){this.element.addClass(this.mainMenuBarCls).appendTo(this.appendTo),this.element.append(this.template({mainMenuCls:this.mainMenuCls,showBookmark:this.state.getStateProperty("mainMenuSettings").buttons.bookmark,showLayout:this.state.getStateProperty("mainMenuSettings").buttons.layout,showOptions:this.state.getStateProperty("mainMenuSettings").buttons.options,showFullScreenViewer:this.state.getStateProperty("mainMenuSettings").buttons.fullScreenViewer,userButtons:this.state.getStateProperty("mainMenuSettings").userButtons,userLogo:this.state.getStateProperty("mainMenuSettings").userLogo})),this.element.find(".mainmenu-button").each(function(){jQuery(this).qtip({content:{text:jQuery(this).attr("title")},position:{my:"top center",at:"bottom center"},style:{classes:"qtip-dark qtip-shadow qtip-rounded"}})}),this.listenForActions(),this.bindEvents()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("MAINMENU_FULLSCREEN_BUTTON",function(event){var fullScreenButton=_this.element.find(".fullscreen-viewer span");fullScreenButton.hasClass("fa-expand")?fullScreenButton.removeClass("fa-expand").addClass("fa-compress"):fullScreenButton.removeClass("fa-compress").addClass("fa-expand")})},bindEvents:function(){var _this=this;this.element.find(".change-layout").on("click",function(){_this.eventEmitter.publish("TOGGLE_WORKSPACE_PANEL"),_this.element.find(".bookmark-workspace").removeClass("active"),jQuery(this).hasClass("active")?jQuery(this).removeClass("active"):jQuery(this).addClass("active")}),this.element.find(".bookmark-workspace").on("click",function(){_this.eventEmitter.publish("TOGGLE_BOOKMARK_PANEL"),_this.element.find(".change-layout").removeClass("active"),jQuery(this).hasClass("active")?jQuery(this).removeClass("active"):jQuery(this).addClass("active")}),this.element.find(".window-options").on("click",function(){}),this.element.find(".fullscreen-viewer").on("click",function(){_this.eventEmitter.publish("TOGGLE_FULLSCREEN")})},template:$.Handlebars.compile(["{{#if userLogo}}",'<ul class="user-logo {{mainMenuCls}}">',"{{userlogo userLogo}}","</ul>","{{/if}}",'<ul class="{{mainMenuCls}}">',"{{#if showBookmark}}","<li>",'<a href="javascript:;" class="bookmark-workspace mainmenu-button" title="{{t "bookmarkTooltip"}}" aria-label="{{t "bookmarkTooltip"}}">','<span class="fa fa-bookmark fa-lg fa-fw"></span> {{t "bookmark"}}',"</a>","</li>","{{/if}}","{{#if showLayout}}","<li>",'<a href="javascript:;" class="change-layout mainmenu-button" title="{{t "changeLayoutTooltip"}}" aria-label="{{t "changeLayoutTooltip"}}">','<span class="fa fa-th-large fa-lg fa-fw"></span> {{t "changeLayout"}}',"</a>","</li>","{{/if}}","{{#if showFullScreenViewer}}","<li>",'<a href="javascript:;" class="fullscreen-viewer mainmenu-button" title="{{t "fullScreenTooltip"}}" aria-label="{{t "fullScreenTooltip"}}">','<span class="fa fa-expand fa-lg fa-fw"></span> {{t "fullScreen"}}',"</a>","</li>","{{/if}}","</ul>","{{#if userButtons}}","{{userbtns userButtons}}","{{/if}}"].join(""))};var processUserButtons=function(btns){for(var output=[],btns_len=btns.length,i=0;i<btns_len;i++)output.push(processUserBtn(btns[i]));return output},processUserBtn=function(btn){var $sub_ul,$li=jQuery("<li>"),$a=jQuery("<a>");try{if(btn.li_attributes&&$li.attr(btn.li_attributes),!btn.label)throw"userButtons must have labels";return $a.text(btn.label),btn.iconClass&&$a.prepend('<span class="'+btn.iconClass+'"></span> '),btn.attributes&&$a.attr(btn.attributes),$li.append($a),btn.sublist&&($sub_ul=jQuery("<ul>"),btn.ul_attributes&&$sub_ul.attr(btn.ul_attributes),$sub_ul.append(processUserButtons(btn.sublist)),$li.append($sub_ul)),$li}catch(err){return console&&console.log&&console.log(err),jQuery()}};$.Handlebars.registerHelper("userbtns",function(userButtons){return new $.Handlebars.SafeString(jQuery('<ul class="user-buttons '+this.mainMenuCls+'"></ul>').append(processUserButtons(userButtons)).get(0).outerHTML)}),$.Handlebars.registerHelper("userlogo",function(userLogo){return new $.Handlebars.SafeString(processUserBtn(userLogo).get(0).outerHTML)})}(Mirador),function($){$.ManifestListItem=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,manifest:null,loadStatus:null,thumbHeight:80,urlHeight:150,resultsWidth:0,maxPreviewImagesWidth:0,repoWidth:80,metadataWidth:450,margin:15,remainingWidth:20,imagesTotalWidth:0,tplData:null,allImages:[],remaining:0,forcedIndex:null,state:null,eventEmitter:null},options),this.init()},$.ManifestListItem.prototype={init:function(){var _this=this;if(this.maxPreviewImagesWidth=this.resultsWidth-(this.repoWidth+this.margin+this.metadataWidth+this.margin+this.remainingWidth),this.maxPreviewImagesWidth=.95*this.maxPreviewImagesWidth,$.Handlebars.registerHelper("pluralize",function(count,singular,plural){return 1===count?singular:plural}),this.fetchTplData(this.manifestId),null!==this.forcedIndex&&(this.tplData.index=this.forcedIndex),_this.state.getStateProperty("preserveManifestOrder"))if(0===this.appendTo.children().length)this.element=jQuery(this.template(this.tplData)).prependTo(this.appendTo).hide().fadeIn("slow");else{var liList=_this.appendTo.find("li");jQuery.each(liList,function(index,item){var prev=parseFloat(jQuery(item).attr("data-index-number")),next=parseFloat(jQuery(liList[index+1]).attr("data-index-number")),current=_this.tplData.index;return current<=prev&&(next>current||isNaN(next))?(_this.element=jQuery(_this.template(_this.tplData)).insertBefore(jQuery(item)).hide().fadeIn("slow"),!1):current>prev&&(current<next||isNaN(next))?(_this.element=jQuery(_this.template(_this.tplData)).insertAfter(jQuery(item)).hide().fadeIn("slow"),!1):void 0})}else this.element=jQuery(this.template(this.tplData)).prependTo(this.appendTo).hide().fadeIn("slow");this.bindEvents(),this.listenForActions()},fetchTplData:function(){var _this=this,location=_this.manifest.location,manifest=_this.manifest.jsonLd;this.tplData={label:$.JsonLd.getTextValue(manifest.label),repository:location,canvasCount:manifest.sequences[0].canvases.length,images:[],index:_this.state.getManifestIndex(manifest["@id"])},this.tplData.repoImage=function(){_this.tplData.repository;if(manifest.logo){if("string"==typeof manifest.logo)return manifest.logo;if(void 0!==manifest.logo["@id"])return manifest.logo["@id"]}return""}();for(var i=0;i<manifest.sequences[0].canvases.length;i++){var canvas=manifest.sequences[0].canvases[i];if(0!==canvas.width){var aspectRatio=canvas.height/canvas.width,width=_this.thumbHeight/aspectRatio;url=_this.manifest.getThumbnailForCanvas(canvas,width),_this.allImages.push({url:url,width:width,height:_this.thumbHeight,id:canvas["@id"],index:i})}}jQuery.each(_this.allImages,function(index,value){var width=value.width;if(_this.imagesTotalWidth+=width+_this.margin,_this.imagesTotalWidth>=_this.maxPreviewImagesWidth)return value.width>_this.maxPreviewImagesWidth&&_this.tplData.images.push(value),_this.imagesTotalWidth-=width+_this.margin,!1;_this.tplData.images.push(value)}),_this.remaining=this.tplData.remaining=function(){var remaining=_this.allImages.length-_this.tplData.images.length;if(remaining>0)return remaining}()},render:function(){},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("manifestPanelWidthChanged",function(event,newWidth){_this.updateDisplay(newWidth)})},bindEvents:function(){var _this=this;this.element.find("img").on("load",function(){jQuery(this).hide().fadeIn(600)}),this.element.on("click",function(){var windowConfig={manifest:_this.manifest,canvasID:null,viewType:"ThumbnailsView"};_this.eventEmitter.publish("ADD_WINDOW",windowConfig)}),this.element.find(".preview-image").on("click",function(e){e.stopPropagation();var windowConfig={manifest:_this.manifest,canvasID:jQuery(this).attr("data-image-id"),viewType:_this.state.getStateProperty("windowSettings").viewType};_this.eventEmitter.publish("ADD_WINDOW",windowConfig)})},updateDisplay:function(newWidth){var newMaxPreviewWidth=newWidth-(this.repoWidth+this.margin+this.metadataWidth+this.margin+this.remainingWidth),image=null;if((newMaxPreviewWidth*=.95)<this.maxPreviewImagesWidth){for(;this.imagesTotalWidth>=newMaxPreviewWidth&&(image=this.tplData.images.pop());)this.imagesTotalWidth-=image.width+this.margin,this.element.find('img[data-image-id="'+image.id+'"]').remove();0===this.remaining&&this.allImages.length-this.tplData.images.length>0&&this.element.find(".preview-images").after('<i class="fa fa fa-ellipsis-h remaining"></i>'),this.remaining=this.allImages.length-this.tplData.images.length}else if(newMaxPreviewWidth>this.maxPreviewImagesWidth){var currentLastImage=this.tplData.images[this.tplData.images.length-1],index=currentLastImage?currentLastImage.index+1:0;if(image=this.allImages[index]){for(;this.imagesTotalWidth+image.width+this.margin<newMaxPreviewWidth&&(this.tplData.images.push(image),this.imagesTotalWidth+=image.width+this.margin,this.element.find(".preview-images").append('<img src="'+image.url+'" width="'+image.width+'" height="'+image.height+'" class="preview-image flash" data-image-id="'+image.id+'">'),index++,image=this.allImages[index]););this.remaining>0&&this.allImages.length-this.tplData.images.length==0&&this.element.find(".remaining").remove(),this.remaining=this.allImages.length-this.tplData.images.length}}this.maxPreviewImagesWidth=newMaxPreviewWidth,this.eventEmitter.publish("manifestListItemRendered")},hide:function(){},show:function(){},template:$.Handlebars.compile(["<li data-index-number={{index}}>",'<div class="repo-image">',"{{#if repoImage}}",'<img src="{{repoImage}}" alt="repoImg">',"{{else}}",'<span class="default-logo"></span>',"{{/if}}","</div>",'<div class="select-metadata">','<div class="manifest-title">','<h3 title="{{{label}}}">{{{label}}}</h3>',"</div>",'<div class="item-info">','<div class="item-info-row">',"{{#if repository}}",'<div class="repo-label">{{repository}}</div>',"{{/if}}",'<div class="canvas-count">{{canvasCount}} {{pluralize canvasCount (t "item") (t "items")}}</div>',"</div>","</div>","</div>",'<div class="preview-thumb">','<div class="preview-images">',"{{#each images}}",'<img src="{{url}}" width="{{width}}" height="{{height}}" class="preview-image flash" data-image-id="{{id}}">',"{{/each}}","</div>","{{#if remaining}}",'<i class="fa fa fa-ellipsis-h remaining"></i>',"{{/if}}","</div>","</li>"].join(""))}}(Mirador),function($){$.ManifestsPanel=function(options){jQuery.extend(!0,this,{element:null,listItems:null,appendTo:null,manifestListItems:[],manifestListElement:null,manifestLoadStatusIndicator:null,resultsWidth:0,state:null,eventEmitter:null},options);this.init()},$.ManifestsPanel.prototype={init:function(){this.element=jQuery(this.template({showURLBox:this.state.getStateProperty("showAddFromURLBox")})).appendTo(this.appendTo),this.manifestListElement=this.element.find("ul");var clone=this.element.clone().css("visibility","hidden").css("display","block").appendTo(this.appendTo);this.resultsWidth=clone.find(".select-results").outerWidth(),this.controlsHeight=clone.find(".manifest-panel-controls").outerHeight(),this.paddingListElement=this.controlsHeight,this.manifestListElement.css("padding-bottom",this.paddingListElement),clone.remove(),this.bindEvents(),this.listenForActions()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("manifestsPanelVisible.set",function(_,stateValue){_this.onPanelVisible(_,stateValue)}),_this.eventEmitter.subscribe("manifestReceived",function(event,newManifest){_this.onManifestReceived(event,newManifest)}),_this.eventEmitter.subscribe("collectionReceived",function(event,newCollection){_this.onCollectionReceived(event,newCollection)})},bindEvents:function(){var _this=this;this.element.find("form#url-load-form").on("submit",function(event){event.preventDefault(),_this.addManifestUrl(jQuery(this).find("input").val())}),this.element.find(".remove-object-option").on("click",function(event){_this.togglePanel(event)}),this.element.find("#manifest-search").on("keyup input",function(event){_this.filterManifests(this.value)}),this.element.find("#manifest-search-form").on("submit",function(event){event.preventDefault()}),jQuery(window).resize($.throttle(function(){_this.resizePanel()},50,!0))},hide:function(){jQuery(this.element).hide({effect:"fade",duration:160,easing:"easeOutCubic"})},show:function(){jQuery(this.element).show({effect:"fade",duration:160,easing:"easeInCubic"})},addManifestUrl:function(url){this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[url,"(Added from URL)"])},togglePanel:function(event){this.eventEmitter.publish("TOGGLE_LOAD_WINDOW")},filterManifests:function(value){value.length>0?this.element.find(".items-listing li").show().filter(function(){return-1===jQuery(this).text().toLowerCase().indexOf(value.toLowerCase())}).hide():this.element.find(".items-listing li").show()},resizePanel:function(){var clone=this.element.clone().css("visibility","hidden").css("display","block").appendTo(this.appendTo);this.resultsWidth=clone.find(".select-results").outerWidth(),clone.remove(),this.eventEmitter.publish("manifestPanelWidthChanged",this.resultsWidth)},onPanelVisible:function(_,stateValue){stateValue?this.show():this.hide()},onManifestReceived:function(event,newManifest){this.manifestListItems.push(new $.ManifestListItem({manifest:newManifest,resultsWidth:this.resultsWidth,state:this.state,eventEmitter:this.eventEmitter,appendTo:this.manifestListElement})),this.element.find("#manifest-search").keyup()},onCollectionReceived:function(event,newCollection){var _this=this;jQuery.each(newCollection.getManifestUris(),function(_,v){_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[v,newCollection.location])})},template:$.Handlebars.compile(['<div id="manifest-select-menu">','<div class="container">','<div class="manifest-panel-controls">','<a class="remove-object-option"><i class="fa fa-times fa-lg fa-fw"></i>{{t "close"}}</a>','<div id="load-controls">',"{{#if showURLBox}}",'<form action="" id="url-load-form">','<label for="url-loader">{{t "addNewObject"}}:</label>','<input type="text" id="url-loader" name="url-load" placeholder="https://...">','<input type="submit" value="{{t "load"}}">',"</form>","{{/if}}",'<form action="" id="manifest-search-form">','<label for="manifest-search">{{t "filterObjects"}}:</label>','<input id="manifest-search" type="text" name="manifest-filter">',"</form>","</div>","</div>",'<div class="select-results">','<ul class="items-listing">',"</ul>","</div>","</div>","</div>"].join(""))}}(Mirador),function($){$.WorkspacePanel=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,workspace:null,state:null,eventEmitter:null},options),this.init()},$.WorkspacePanel.prototype={init:function(){var templateData={rows:$.layoutDescriptionFromGridString(this.state.getStateProperty("workspacePanelSettings").maxColumns+"x"+this.state.getStateProperty("workspacePanelSettings").maxRows).children.map(function(column,rowIndex){return column.columns=column.children.map(function(row,columnIndex){return row.gridString=rowIndex+1+"x"+(columnIndex+1),row}),column})};this.element=jQuery(this.template(templateData)).appendTo(this.appendTo);var backgroundImage=this.state.getStateProperty("buildPath")+this.state.getStateProperty("imagesPath")+"debut_dark.png";this.element.css("background-image","url("+backgroundImage+")").css("background-repeat","repeat"),this.bindEvents(),this.listenForActions()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("workspacePanelVisible.set",function(_,stateValue){_this.onPanelVisible(_,stateValue)})},bindEvents:function(){var _this=this;_this.element.find(".grid-item").on("click",function(){var gridString=jQuery(this).data("gridstring");_this.select(gridString)}),_this.element.find(".grid-item").on("mouseover",function(){var gridString=jQuery(this).data("gridstring");_this.hover(gridString)}),_this.element.find(".select-grid").on("mouseout",function(){_this.reset()})},select:function(gridString){var layoutDescription=$.layoutDescriptionFromGridString(gridString);this.eventEmitter.publish("RESET_WORKSPACE_LAYOUT",{layoutDescription:layoutDescription}),this.eventEmitter.publish("TOGGLE_WORKSPACE_PANEL")},hover:function(gridString){var highestRow=gridString.charAt(0),highestColumn=gridString.charAt(2),gridItems=this.element.find(".grid-item");gridItems.removeClass("hovered"),gridItems.filter(function(index){var gridString=jQuery(this).data("gridstring");return gridString.charAt(0)<=highestRow&&gridString.charAt(2)<=highestColumn}).addClass("hovered"),this.element.find(".grid-instructions").hide(),this.element.find(".grid-text").text(gridString).show()},reset:function(){this.element.find(".grid-item").removeClass("hovered"),this.element.find(".grid-instructions").show(),this.element.find(".grid-text").hide()},hide:function(){jQuery(this.element).hide({effect:"fade",duration:160,easing:"easeOutCubic"})},show:function(){jQuery(this.element).show({effect:"fade",duration:160,easing:"easeInCubic",complete:function(){jQuery(this).css("display","block")}})},onPanelVisible:function(_,stateValue){stateValue?this.show():this.hide()},template:$.Handlebars.compile(['<div id="workspace-select-menu">','<h1>{{t "changeLayout"}}</h1>','<h3 class="grid-text"></h3>','<h3 class="grid-instructions">{{t "selectGrid"}}</h3>','<div class="select-grid">',"{{#each rows}}",'<div class="grid-row">',"{{#each columns}}",'<a class="grid-item" data-gridString="{{gridString}}">','<div class="grid-icon"></div>',"</a>","{{/each}}","</div>","{{/each}}","</div>","</div>"].join(""))}}(Mirador),function($){$.Collection=function(collectionUri,location,collectionContent){collectionContent?(jQuery.extend(!0,this,{jsonLd:null,location:location,uri:collectionUri,request:null}),this.initFromCollectionContent(collectionContent)):(jQuery.extend(!0,this,{jsonLd:null,location:location,uri:collectionUri,request:null}),this.init(collectionUri))},$.Collection.prototype={init:function(collectionUri){var _this=this;this.request=jQuery.ajax({url:collectionUri,dataType:"json",async:!0}),this.request.done(function(jsonLd){_this.jsonLd=jsonLd})},initFromCollectionContent:function(collectionContent){var _this=this;this.request=jQuery.Deferred(),this.request.done(function(jsonLd){_this.jsonLd=jsonLd}),_this.request.resolve(collectionContent)},getVersion:function(){return{"http://www.shared-canvas.org/ns/context.json":"1","http://iiif.io/api/presentation/1/context.json":"1","http://iiif.io/api/presentation/2/context.json":"2","http://iiif.io/api/presentation/2.1/context.json":"2.1"}[this.jsonLd["@context"]]},getManifestUris:function(){return this.jsonLd.manifests?jQuery.map(this.jsonLd.manifests,function(v,_){return v["@id"]}):this.jsonLd.members?jQuery.map(this.jsonLd.members,function(v,_){if("sc:Manifest"===v["@type"])return v["@id"]}):[]},getManifestBlocks:function(){return this.jsonLd.manifests?this.jsonLd.manifests:this.jsonLd.members?jQuery.map(this.jsonLd.members,function(v,_){if("sc:Manifest"===v["@type"])return v}):[]},getCollectionUris:function(){return this.jsonLd.collections?jQuery.map(this.jsonLd.collections,function(v,_){return v["@id"]}):this.jsonLd.members?jQuery.map(this.jsonLd.members,function(v,_){if("sc:Collection"===v["@type"])return v["@id"]}):[]},getCollectionBlocks:function(){return this.jsonLd.collections?this.jsonLd.collections:this.jsonLd.members?jQuery.map(this.jsonLd.members,function(v,_){if("sc:Collection"===v["@type"])return v}):[]}}}(Mirador),function($){$.Manifest=function(manifestUri,location,manifestContent){manifestContent?(jQuery.extend(!0,this,{jsonLd:null,location:location,uri:manifestUri,request:null}),this.initFromManifestContent(manifestContent)):-1!==manifestUri.indexOf("info.json")?(jQuery.extend(!0,this,{jsonLd:null,location:location,uri:manifestUri,request:null}),this.initFromInfoJson(manifestUri)):(jQuery.extend(!0,this,{jsonLd:null,location:location,uri:manifestUri,request:null}),this.init(manifestUri))},$.Manifest.prototype={init:function(manifestUri){var _this=this;this.request=jQuery.ajax({url:manifestUri,dataType:"json",async:!0}),this.request.done(function(jsonLd){_this.jsonLd=jsonLd})},buildCanvasMap:function(){var _this=this;this.canvasMap={},this.getCanvases()&&this.getCanvases().forEach(function(canvas){_this.canvasMap[canvas["@id"]]=canvas})},initFromInfoJson:function(infoJsonUrl){var _this=this;this.request=jQuery.ajax({url:infoJsonUrl,dataType:"json",async:!0}),this.request.done(function(jsonLd){_this.jsonLd=_this.generateInfoWrapper(jsonLd)})},initFromManifestContent:function(manifestContent){var _this=this;this.request=jQuery.Deferred(),this.request.done(function(jsonLd){_this.jsonLd=jsonLd}),_this.request.resolve(manifestContent)},getThumbnailForCanvas:function(canvas,width){var service,thumbnailUrl,version="1.1",compliance=-1;if(width=parseInt(width,10),canvas.hasOwnProperty("thumbnail"))"string"==typeof canvas.thumbnail?thumbnailUrl=canvas.thumbnail:canvas.thumbnail.hasOwnProperty("service")?((service=canvas.thumbnail.service).hasOwnProperty("profile")&&(compliance=$.Iiif.getComplianceLevelFromProfile(service.profile)),0===compliance?thumbnailUrl=canvas.thumbnail["@id"]:(service.hasOwnProperty("@context")&&(version=$.Iiif.getVersionFromContext(service["@context"])),thumbnailUrl=$.Iiif.makeUriWithWidth(service["@id"],width,version))):thumbnailUrl=canvas.thumbnail["@id"];else{var resource=canvas.images[0].resource;(service=resource.default?resource.default.service:resource.service).hasOwnProperty("@context")&&(version=$.Iiif.getVersionFromContext(service["@context"])),thumbnailUrl=$.Iiif.makeUriWithWidth(service["@id"],width,version)}return thumbnailUrl},getVersion:function(){return{"http://www.shared-canvas.org/ns/context.json":"1","http://iiif.io/api/presentation/1/context.json":"1","http://iiif.io/api/presentation/2/context.json":"2","http://iiif.io/api/presentation/2.1/context.json":"2.1"}[this.jsonLd["@context"]]},getCanvases:function(){return this.jsonLd.sequences&&this.jsonLd.sequences[0].canvases},getAnnotationsListUrls:function(canvasId){var canvas=jQuery.grep(this.getCanvases(),function(canvas,index){return canvas["@id"]===canvasId})[0],annotationsListUrls=[];if(canvas&&canvas.otherContent)for(var i=0;i<canvas.otherContent.length;i++)annotationsListUrls.push(canvas.otherContent[i]["@id"]);return annotationsListUrls},getStructures:function(){return this.jsonLd.structures},generateInfoWrapper:function(infoJson){return{"@context":"http://www.shared-canvas.org/ns/context.json","@id":infoJson["@id"],"@type":"sc:Manifest",label:infoJson["@id"].split("/")[infoJson["@id"].split("/").length-1],sequences:[{"@id":infoJson["@id"]+"/sequence/1","@type":"sc:Sequence",canvases:[{"@id":infoJson["@id"]+"/sequence/1/canvas/1","@type":"sc:Canvas",width:infoJson.width,height:infoJson.height,images:[{"@id":infoJson["@id"]+"/sequence/1/canvas/1/image/1","@type":"sc:image",motivation:"sc:painting",resource:{"@id":infoJson,"@type":"dctypes:Image",format:"image/jpeg",height:infoJson.height,width:infoJson.width,service:{"@id":infoJson["@id"],"@context":infoJson["@context"],profile:infoJson.profile}}}]}]}]}},getSearchWithinService:function(){var serviceProperty=this.jsonLd.service,service=[];if(void 0===serviceProperty)service=null;else if(serviceProperty.constructor===Array)for(var i=0;i<serviceProperty.length;i++)"http://iiif.io/api/search/0/context.json"!==serviceProperty[i]["@context"]&&"http://iiif.io/api/search/1/context.json"!==serviceProperty[i]["@context"]||service.push(serviceProperty[i]);else"http://iiif.io/api/search/0/context.json"===this.jsonLd.service["@context"]||"http://iiif.io/api/search/1/context.json"===serviceProperty["@context"]?service.push(this.jsonLd.service):service=null;return service},getCanvasLabel:function(canvasId){if(console.assert(canvasId&&""!==canvasId,"No canvasId was specified."),this.canvasMap&&canvasId.indexOf("#")>=0){var canvas=this.canvasMap[canvasId.split("#")[0]];return canvas?canvas.label:void 0}},getViewingDirection:function(){return this.jsonLd.viewingDirection||this.jsonLd.sequences[0].viewingDirection}}}(Mirador),function($){function PaperItem(item){this.item=item}function Group(paperScope,opts){var item=new paperScope.Group(opts);PaperItem.call(this,item)}function PointText(paperScope,opts){var text=new paperScope.PointText(opts);PaperItem.call(this,text)}function PointTextIcon(paperScope,opts){this.paperScope=paperScope,opts.justification="center",opts.font="FontAwesome",this.content=opts.content,PointText.call(this,paperScope,opts),this.rasterMask.addData("self",this)}function DeleteActionIcon(paperScope,opts){this.paperScope=paperScope,opts.fillColor=opts.fillColor||"black",opts.fontSize=opts.size||24/paperScope.view.zoom,opts.content="",this.rasterMask=new Icon(paperScope,{name:opts.name.replace("delete","Delete_mask"),size:new paperScope.Size(opts.fontSize,opts.fontSize)}),PointTextIcon.call(this,paperScope,opts)}function RotationIcon(paperScope,opts){this.paperScope=paperScope,opts.justification="center",opts.fillColor=opts.fillColor||"black",opts.fontSize=opts.size||16/paperScope.view.zoom,opts.content="",this.rasterMask=new Icon(paperScope,{name:opts.name.replace("rotation","Rotation_mask"),size:new paperScope.Size(opts.fontSize,opts.fontSize)}),PointTextIcon.call(this,paperScope,opts)}$.AnnotationUtils=function(){},PaperItem.prototype={getItem:function(){return this.item},translateByXY:function(x,y){this.item.position.x+=x,this.item.position.y+=y},translateByPoint:function(point){this.item.position=this.item.position.add(point)},setOnMouseDownListener:function(callback){this.mouseDown=callback},onMouseDown:function(){this.mouseDown.call(this,this.item)},remove:function(){this.item.remove()},rotate:function(angle,pivot){pivot?this.item.rotate(angle,pivot):this.item.rotate(angle)},setPosition:function(point){this.item.position=point},getWidth:function(){return this.item.width},getHeight:function(){return this.item.height},addData:function(key,data){this.item.data[key]=data},getData:function(key){return this.item.data[key]},resize:function(size){this.item.size=size}},Group.prototype=Object.create(PaperItem.prototype,{}),Group.constructor=Group;var Icon=function(paperScope,opts){this.paperScope=paperScope;var item=new paperScope.Raster(opts);PaperItem.call(this,item),opts&&opts.onLoad&&(this.item.onLoad=opts.onLoad)};Icon.prototype=Object.create(PaperItem.prototype,{}),Icon.constructor=Icon,(PointText.prototype=Object.create(PaperItem.prototype)).resize=function(newSize){this.item.fontSize=newSize},PointText.constructor=PointText,(PointTextIcon.prototype=Object.create(PointText.prototype,{})).setPosition=function(point){this.rasterMask.setPosition(point),PointText.prototype.setPosition.call(this,point)},PointTextIcon.prototype.rotate=function(angle,pivot){this.rasterMask.rotate(angle,pivot),PointText.prototype.rotate.call(this,angle,pivot)},PointTextIcon.prototype.translateByPoint=function(point){this.rasterMask.translateByPoint(point),PointText.prototype.translateByPoint.call(this,point)},PointTextIcon.prototype.translateByXY=function(x,y){this.rasterMask.translateByXY(x,y),PointText.prototype.translateByXY.call(this,x,y)},PointTextIcon.prototype.remove=function(){this.rasterMask.remove(),PointText.prototype.remove.call(this)},PointTextIcon.prototype.resize=function(size){this.rasterMask.resize(new this.paperScope.Size(size,size)),PointText.prototype.resize.call(this,size)},PointTextIcon.prototype.getMask=function(){return this.rasterMask},PointTextIcon.prototype.constructor=PointTextIcon,(DeleteActionIcon.prototype=Object.create(PointTextIcon.prototype,{})).setOnMouseDownListener=function(overlay){this.mouseDown=function(){overlay.eventEmitter.publish("deleteShape."+overlay.windowId,[this.getData("parent")]),overlay.mode="delete"}},(RotationIcon.prototype=Object.create(PointTextIcon.prototype,{})).setOnMouseDownListener=function(overlay){this.mouseDown=function(){overlay.mode="rotate"}},$.AnnotationUtils.prototype={Icon:Icon,PointText:PointText,DeleteActionIcon:DeleteActionIcon,RotationIcon:RotationIcon,Group:Group}}(Mirador),function($){$.AnnotationTooltip=function(options){jQuery.extend(this,{targetElement:null,annotations:[],windowId:"",eventEmitter:null},options),this.init()},$.AnnotationTooltip.prototype={init:function(){this.editor=$[this.state.currentConfig.annotationBodyEditor.module],this.editorOptions=this.state.currentConfig.annotationBodyEditor.options,this.activeEditor=null,this.activeEditorTip=null,this.inEditOrCreateMode=!1},showEditor:function(params){var _this=this;if(!_this.activeEditor){var editorContainer=_this.editorTemplate({id:jQuery.isEmptyObject(params.annotation)?"":params.annotation["@id"],windowId:_this.windowId}),selector="#annotation-editor-"+_this.windowId;_this.activeEditor=new _this.editor(jQuery.extend({},_this.editorOptions,{annotation:params.annotation,windowId:_this.windowId})),_this.activeEditorTip=_this.targetElement.qtip({content:{text:editorContainer},position:{my:"center",at:"center",container:_this.targetElement,viewport:_this.targetElement},style:{classes:"qtip-bootstrap qtip"+_this.windowId},show:{event:!1},hide:{fixed:!0,delay:300,event:!1},events:{render:function(event,api){_this.eventEmitter.publish("disableTooltips."+_this.windowId),api.elements.tooltip.draggable(),jQuery(selector).on("submit",function(event){event.preventDefault(),jQuery(selector+" a.save").click()}),jQuery(selector+" a.cancel").on("click",function(event){event.preventDefault();_this.eventEmitter.publish("onAnnotationCreatedCanceled."+_this.windowId,[function(){api.destroy()},!_this.activeEditor.isDirty()])}),jQuery(selector+" a.save").on("click",function(event){if(event.preventDefault(),params.onSaveClickCheck()){var annotation=_this.activeEditor.createAnnotation();params.onAnnotationCreated&&params.onAnnotationCreated(annotation),api.destroy(),_this.activeEditor=null,_this.activeEditorTip=null}}),_this.activeEditor.show(selector),_this.eventEmitter.publish("annotationEditorAvailable."+_this.windowId)}}}),_this.activeEditorTip.qtip("show")}},initializeViewerUpgradableToEditor:function(params){var _this=this;_this.activeEditorTip=jQuery(_this.targetElement).qtip({overwrite:!0,content:{text:""},position:{target:"mouse",my:"bottom left",at:"top right",adjust:{mouse:!1,method:"shift"},container:params.container,viewport:params.viewport},style:{classes:"qtip-bootstrap qtip-viewer",tip:!1},show:{event:!1},hide:{fixed:!0,delay:300,event:!1},events:{show:function(event,api){params.onTooltipShown&&params.onTooltipShown(event,api),api.cache.hidden=!1},hidden:function(event,api){params.onTooltipHidden&&params.onTooltipHidden(event,api),_this.removeAllEvents(api,params),api.cache.hidden=!0},visible:function(event,api){},move:function(event,api){}}});var api=jQuery(_this.targetElement).qtip("api");api.cache.annotations=[],api.cache.hidden=!0,api.cache.params=params},removeAllEvents:function(api,viewerParams){var editorSelector="#annotation-editor-"+this.windowId,viewerSelector="#annotation-viewer-"+this.windowId;jQuery(viewerSelector+" a.delete").off("click"),jQuery(viewerSelector+" a.edit").off("click"),jQuery(editorSelector+" a.save").off("click"),jQuery(editorSelector+" a.cancel").off("click")},addViewerEvents:function(api,viewerParams){var _this=this,selector="#annotation-viewer-"+_this.windowId;jQuery(selector+" a.delete").on("click",function(event){event.preventDefault();var elem=this;new $.DialogBuilder(viewerParams.container).dialog({message:i18next.t("deleteAnnotation"),closeButton:!1,buttons:{no:{label:i18next.t("no"),className:"btn-default",callback:function(){}},yes:{label:i18next.t("yes"),className:"btn-primary",callback:function(){var display=jQuery(elem).parents(".annotation-display"),id=display.attr("data-anno-id");_this.eventEmitter.publish("onAnnotationDeleted."+_this.windowId,[id,function(){_this.removeAllEvents(),api.hide(),display.remove()}])}}}})}),jQuery(selector+" a.edit").on("click",function(event){event.preventDefault();var id=jQuery(this).parents(".annotation-display").attr("data-anno-id"),oaAnno=viewerParams.getAnnoFromRegion(id)[0];_this.state.getStateProperty("availableExternalCommentsPanel")?(_this.eventEmitter.publish("annotationInEditMode."+_this.windowId,[oaAnno]),_this.removeAllEvents(viewerParams),api.destroy(),jQuery(api.tooltip).remove()):(_this.freezeQtip(api,oaAnno,viewerParams),_this.removeAllEvents(api,viewerParams),_this.addEditorEvents(api,viewerParams)),_this.eventEmitter.publish("SET_ANNOTATION_EDITING."+_this.windowId,{annotationId:id,isEditable:!0,tooltip:_this}),_this.eventEmitter.publish("modeChange."+_this.windowId,"editingAnnotation")})},addEditorEvents:function(api,viewerParams){var _this=this,selector="#annotation-editor-"+_this.windowId;jQuery(selector).on("submit",function(event){event.preventDefault(),jQuery(selector+" a.save").click()}),jQuery(selector+" a.save").on("click",function(event){event.preventDefault();var id=jQuery(this).parents(".annotation-editor").attr("data-anno-id"),oaAnno=viewerParams.getAnnoFromRegion(id)[0];_this.activeEditor.updateAnnotation(oaAnno),_this.eventEmitter.publish("annotationEditSave."+_this.windowId,[oaAnno])}),jQuery(selector+" a.cancel").on("click",function(event){event.preventDefault();var id=jQuery(this).parents(".annotation-editor").attr("data-anno-id"),oaAnno=viewerParams.getAnnoFromRegion(id)[0];_this.removeAllEvents(),_this.unFreezeQtip(api,oaAnno,viewerParams),_this.eventEmitter.publish("annotationEditCancel."+_this.windowId,[id])})},showViewer:function(params){var api=jQuery(this.targetElement).qtip("api");if(api&&(!params.shouldDisplayTooltip||params.shouldDisplayTooltip(api)))if(0===params.annotations.length)api.cache.hidden||(api.disable(!1),api.hide(params.triggerEvent),api.cache.annotations=[],api.cache.hidden=!0,api.disable(!0));else{var oldAnnotations=api.cache.annotations,isTheSame=oldAnnotations.length==params.annotations.length;if(isTheSame)for(var i=0;i<params.annotations.length;i++)if(oldAnnotations[i]!=params.annotations[i]){isTheSame=!1;break}!api.cache.hidden&&isTheSame||(api.disable(!1),this.setTooltipContent(params.annotations),api.cache.origin=params.triggerEvent,api.reposition(params.triggerEvent,!0),api.show(params.triggerEvent),api.cache.annotations=params.annotations,api.cache.hidden=!1,this.removeAllEvents(),this.addViewerEvents(api,api.cache.params))}},setTooltipContent:function(annotations){var api=jQuery(this.targetElement).qtip("api");api&&(api.set({"content.text":this.getViewerContent(annotations)}),this.eventEmitter.publish("tooltipViewerSet."+this.windowId))},getViewerContent:function(annotations){var annoText,tags=[],htmlAnnotations=[];jQuery.each(annotations,function(index,annotation){tags=[],jQuery.isArray(annotation.resource)?jQuery.each(annotation.resource,function(index,value){"oa:Tag"===value["@type"]?tags.push(value.chars):annoText=value.chars}):annoText=annotation.resource.chars;var username="";annotation.annotatedBy&&annotation.annotatedBy.name&&(username=annotation.annotatedBy.name);var showUpdate=!1;"manifest"!==annotation.endpoint&&(showUpdate=annotation.endpoint.userAuthorize("update",annotation));var showDelete=!1;"manifest"!==annotation.endpoint&&(showDelete=annotation.endpoint.userAuthorize("delete",annotation)),htmlAnnotations.push({annoText:$.sanitizeHtml(annoText),tags:tags,id:annotation["@id"],username:username,showUpdate:showUpdate,showDelete:showDelete})});return this.viewerTemplate({annotations:htmlAnnotations,windowId:this.windowId})},freezeQtip:function(api,oaAnno,viewerParams){if(this.inEditOrCreateMode)throw"AnnotationTooltip already in edit mode";this.inEditOrCreateMode=!0,this.eventEmitter.publish("disableRectTool."+this.windowId);var editorContainer=this.editorTemplate({id:jQuery.isEmptyObject(oaAnno)?"":oaAnno["@id"],windowId:this.windowId});api.set({"content.text":editorContainer,"hide.event":!1}),this.activeEditor=new this.editor(jQuery.extend({},this.editorOptions,{annotation:oaAnno,windowId:this.windowId})),this.activeEditor.show("form#annotation-editor-"+this.windowId),this.eventEmitter.publish("annotationEditorAvailable."+this.windowId),jQuery(api.elements.tooltip).removeClass("qtip-viewer"),api.elements.tooltip.draggable(),viewerParams.onEnterEditMode&&viewerParams.onEnterEditMode(api,oaAnno)},unFreezeQtip:function(api,oaAnno,viewerParams){if(!this.inEditOrCreateMode)throw"AnnotationTooltip not in edit mode";this.inEditOrCreateMode=!1,this.eventEmitter.publish("enableRectTool."+this.windowId),api.set({"content.text":this.getViewerContent([oaAnno]),"hide.event":"mouseleave"}).hide(),jQuery(api.elements.tooltip).addClass("qtip-viewer"),viewerParams.onExitEditMode&&viewerParams.onExitEditMode(api,oaAnno)},editorTemplate:$.Handlebars.compile(['<form id="annotation-editor-{{windowId}}" class="annotation-editor annotation-tooltip" {{#if id}}data-anno-id="{{id}}"{{/if}}>',"<div>",'<div class="button-container">','<a href="#cancel" class="cancel"><i class="fa fa-times-circle-o fa-fw"></i>{{t "cancel"}}</a>','<a href="#save" class="save"><i class="fa fa-database fa-fw"></i>{{t "save"}}</a>',"</div>","</div>","</form>"].join("")),viewerTemplate:$.Handlebars.compile(['<div class="all-annotations" id="annotation-viewer-{{windowId}}">',"{{#each annotations}}",'<div class="annotation-display annotation-tooltip" data-anno-id="{{id}}">','<div class="button-container">','{{#if showUpdate}}<a href="#edit" class="edit"><i class="fa fa-pencil-square-o fa-fw"></i>{{t "edit"}}</a>{{/if}}','{{#if showDelete}}<a href="#delete" class="delete"><i class="fa fa-trash-o fa-fw"></i>{{t "delete"}}</a>{{/if}}',"</div>",'<div class="text-viewer">','{{#if username}}<p class="user">{{username}}:</p>{{/if}}',"<p>{{{annoText}}}</p>","</div>",'<div id="tags-viewer-{{windowId}}" class="tags-viewer">',"{{#each tags}}",'<span class="tag">{{this}}</span>',"{{/each}}","</div>","</div>","{{/each}}","</div>"].join(""))}}(Mirador),function($){$.CatchEndpoint=function(options){jQuery.extend(this,{token:null,prefix:null,params:"",dfd:null,context_id:"None",collection_id:"None",userid:"test@mirador.org",username:"mirador-test",annotationsList:[],annotationsListCatch:null,windowID:null,eventEmitter:null},options),this.init()},$.CatchEndpoint.prototype={init:function(){this.catchOptions={user:{id:this.userid,name:this.username},permissions:{read:[],update:[this.userid],delete:[this.userid],admin:[this.userid]}}},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value},search:function(options,successCallback,errorCallback){var _this=this;this.annotationsList=[],jQuery.ajax({url:this.prefix+"/search"+this.params,type:"GET",dataType:"json",headers:{"x-annotator-auth-token":this.token},data:{uri:options.uri,userid:options.userid?options.userid:void 0,username:options.username?options.username:void 0,text:options.text?options.text:void 0,tag:options.tag?options.tag:void 0,parentid:options.parentid?options.parentid:void 0,contextId:_this.context_id,collectionId:_this.collection_id,media:options.media?options.media:"image",limit:options.limit?options.limit:-1},contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback?successCallback(data):(_this.annotationsListCatch=data.rows,jQuery.each(_this.annotationsListCatch,function(index,value){_this.annotationsList.push(_this.getAnnotationInOA(value))}),_this.dfd.resolve(!0),_this.eventEmitter.publish("catchAnnotationsLoaded."+_this.windowID,_this.annotationsListCatch))},error:function(){"function"==typeof errorCallback?errorCallback():console.log("There was an error searching this endpoint")}})},deleteAnnotation:function(annotationID,successCallback,errorCallback){var _this=this;jQuery.ajax({url:this.prefix+"/destroy/"+annotationID+this.params,type:"DELETE",dataType:"json",headers:{"x-annotator-auth-token":this.token},contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback&&successCallback(),_this.eventEmitter.publish("catchAnnotationDeleted."+_this.windowID,annotationID)},error:function(){"function"==typeof errorCallback&&errorCallback()}})},update:function(oaAnnotation,successCallback,errorCallback){var _this=this;this.getAnnotationInEndpoint(oaAnnotation).forEach(function(annotation){var annotationID=annotation.id;jQuery.ajax({url:_this.prefix+"/update/"+annotationID+_this.params,type:"POST",dataType:"json",headers:{"x-annotator-auth-token":_this.token},data:JSON.stringify(annotation),contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback&&successCallback(_this.getAnnotationInOA(data)),_this.eventEmitter.publish("catchAnnotationUpdated."+_this.windowID,annotation)},error:function(){"function"==typeof errorCallback&&errorCallback()}})})},create:function(oaAnnotation,successCallback,errorCallback){var _this=this;this.getAnnotationInEndpoint(oaAnnotation).forEach(function(annotation){_this.createCatchAnnotation(annotation,successCallback,errorCallback)})},createCatchAnnotation:function(catchAnnotation,successCallback,errorCallback){var _this=this;jQuery.ajax({url:this.prefix+"/create"+this.params,type:"POST",dataType:"json",headers:{"x-annotator-auth-token":this.token},data:JSON.stringify(catchAnnotation),contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback&&successCallback(_this.getAnnotationInOA(data)),_this.eventEmitter.publish("catchAnnotationCreated."+_this.windowID,data)},error:function(){"function"==typeof errorCallback&&errorCallback()}})},userAuthorize:function(action,annotation){if(this.roles&&(-1!==this.roles.indexOf("Instructor")||-1!==this.roles.indexOf("Administrator")))return!0;if(annotation.permissions){var permissionUserIds=annotation.permissions[action]||[];return 0===permissionUserIds.length||-1!==permissionUserIds.indexOf(this.userid)}return!annotation.user||this.userid===annotation.user.userid},getAnnotationInOA:function(annotation){var id,on,annotatedBy,motivation=[],resource=[];if(id=annotation.id,annotation.tags.length>0&&(motivation.push("oa:tagging"),jQuery.each(annotation.tags,function(index,value){resource.push({"@type":"oa:Tag",chars:value})})),annotation.parent&&"0"!==annotation.parent)motivation.push("oa:replying"),on=annotation.parent;else{var value;motivation.push("oa:commenting"),jQuery.isArray(annotation.rangePosition)?on=annotation.rangePosition:"object"==typeof annotation.rangePosition?(value="xywh="+annotation.rangePosition.x+","+annotation.rangePosition.y+","+annotation.rangePosition.width+","+annotation.rangePosition.height,on={"@type":"oa:SpecificResource",full:annotation.uri,selector:{"@type":"oa:FragmentSelector",value:value}}):(value=annotation.rangePosition,on={"@type":"oa:SpecificResource",full:annotation.uri,selector:{"@type":"oa:SvgSelector",value:value}})}resource.push({"@type":"dctypes:Text",format:"text/html",chars:annotation.text}),annotatedBy={"@id":annotation.user.id,name:annotation.user.name};return{"@context":"http://iiif.io/api/presentation/2/context.json","@id":String(id),"@type":"oa:Annotation",motivation:motivation,resource:resource,on:on,annotatedBy:annotatedBy,annotatedAt:annotation.created,serializedAt:annotation.updated,permissions:annotation.permissions,endpoint:this}},getAnnotationInEndpoint:function(oaAnnotation){var _this=this,uris=[];oaAnnotation.on.forEach(function(value){-1===jQuery.inArray(value.full,uris)&&uris.push(value.full)});var annotations=[];return uris.forEach(function(uri){var text,annotation={},tags=[];oaAnnotation["@id"]&&(annotation.id=oaAnnotation["@id"]),annotation.media="image",jQuery.each(oaAnnotation.resource,function(index,value){"oa:Tag"===value["@type"]?tags.push(value.chars):"dctypes:Text"===value["@type"]&&(text=value.chars)}),annotation.tags=tags,annotation.text=text,annotation.uri=uri,annotation.contextId=_this.context_id,annotation.collectionId=_this.collection_id,annotation.rangePosition=oaAnnotation.on;var coordsArray=[];oaAnnotation.on.forEach(function(value){var xywh=value.selector.default.value.split("=")[1].split(",");coordsArray.push(xywh.map(function(i){return parseInt(i)}))});var left=coordsArray.map(function(i){return i[0]}),top=coordsArray.map(function(i){return i[1]}),right=coordsArray.map(function(i){return i[0]+i[2]}),bottom=coordsArray.map(function(i){return i[1]+i[3]}),newRect={x:Math.min.apply(null,left),y:Math.min.apply(null,top),width:Math.max.apply(null,right)-Math.min.apply(null,left),height:Math.max.apply(null,bottom)-Math.min.apply(null,top)},canvas=_this.imagesList[$.getImageIndexById(_this.imagesList,uri)],imageUrl=$.getThumbnailForCanvas(canvas,300);imageUrl=imageUrl.replace("full",newRect.x+","+newRect.y+","+newRect.width+","+newRect.height),annotation.thumb=imageUrl,annotation.bounds={x:newRect.x,y:newRect.y,width:newRect.width,height:newRect.height},annotation.updated=(new Date).toISOString(),oaAnnotation.annotatedAt?annotation.created=oaAnnotation.annotatedAt:annotation.created=annotation.updated,annotation.user={},oaAnnotation.annotatedBy?(annotation.user.name=oaAnnotation.annotatedBy.name,annotation.user.id=oaAnnotation.annotatedBy["@id"]):annotation.user=_this.catchOptions.user,annotation.permissions=_this.catchOptions.permissions,annotation.archived=!1,annotation.ranges=[],annotation.parent="0",annotations.push(annotation)}),annotations}}}(Mirador),function($){$.Endpoint=function(options){jQuery.extend(this,{dfd:null,annotationsList:[],windowID:null,eventEmitter:null},options),this.init()},$.Endpoint.prototype={init:function(){},search:function(options,successCallback,errorCallback){var _this=this;jQuery.ajax({url:"",type:"GET",dataType:"json",headers:{},data:{},contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback?successCallback(data):(jQuery.each(data,function(index,value){_this.annotationsList.push(_this.getAnnotationInOA(value))}),_this.dfd.resolve(!0))},error:function(){"function"==typeof errorCallback&&errorCallback()}})},deleteAnnotation:function(annotationID,successCallback,errorCallback){jQuery.ajax({url:"",type:"DELETE",dataType:"json",headers:{},contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback&&successCallback()},error:function(){"function"==typeof errorCallback&&errorCallback()}})},update:function(oaAnnotation,successCallback,errorCallback){this.getAnnotationInEndpoint(oaAnnotation);jQuery.ajax({url:"",type:"POST",dataType:"json",headers:{},data:"",contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback&&successCallback()},error:function(){"function"==typeof errorCallback&&errorCallback()}})},create:function(oaAnnotation,successCallback,errorCallback){var _this=this;jQuery.ajax({url:"",type:"POST",dataType:"json",headers:{},data:"",contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof successCallback&&successCallback(_this.getAnnotationInOA(data))},error:function(){"function"==typeof errorCallback&&errorCallback()}})},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value},getAnnotationInOA:function(annotation){},getAnnotationInEndpoint:function(oaAnnotation){}}}(Mirador),function($){$.LegacyOpenAnnotationStrategy=function(options){jQuery.extend(this,{},options),this.init()},$.LegacyOpenAnnotationStrategy.prototype={init:function(){},isThisType:function(annotation){return!(!annotation.on||"string"!=typeof annotation.on)&&-1!==annotation.on.indexOf("xywh=")},buildAnnotation:function(options){var oaAnno=options.annotation,win=options.window,bounds=options.overlay.draftPaths[0].bounds;return oaAnno.on=win.canvasID+"#xywh="+Math.round(bounds.x)+","+Math.round(bounds.y)+","+Math.round(bounds.width)+","+Math.round(bounds.height),oaAnno},parseRegion:function(annotation,osdRegionDrawTool){if(this.isThisType(annotation))return osdRegionDrawTool.parseRectangle(annotation.on,annotation)}}}(Mirador),function($){$.LocalStorageEndpoint=function(options){jQuery.extend(this,{token:null,prefix:null,dfd:null,annotationsList:[],windowID:null,eventEmitter:null},options),this.init()},$.LocalStorageEndpoint.prototype={init:function(){},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value},search:function(options,successCallback,errorCallback){var _this=this;this.annotationsList=[];try{_this.annotationsList=_this.getAnnotationList(options.uri),jQuery.each(_this.annotationsList,function(index,value){value.endpoint=_this}),"function"==typeof successCallback?successCallback(_this.annotationsList):_this.dfd.resolve(!0)}catch(e){"function"==typeof errorCallback?errorCallback():console.log("There was an error searching this endpoint")}},deleteAnnotation:function(annotationID,successCallback,errorCallback){var _this=this,keys=[];jQuery.each(_this.annotationsList[0].on,function(index,value){-1===jQuery.inArray(value.full,keys)&&keys.push(value.full)}),0===keys.length&&"function"==typeof errorCallback&&errorCallback(),jQuery.each(keys,function(index,key){try{_this.annotationsList=jQuery.grep(_this.annotationsList,function(value,index){return value["@id"]!==annotationID}),jQuery.each(_this.annotationsList,function(index,value){delete value.endpoint}),localStorage.setItem(key,JSON.stringify(_this.annotationsList)),jQuery.each(_this.annotationsList,function(index,value){value.endpoint=_this}),"function"==typeof successCallback&&successCallback()}catch(e){"function"==typeof errorCallback&&errorCallback()}})},update:function(oaAnnotation,successCallback,errorCallback){var _this=this,annotationID=oaAnnotation["@id"],keys=[];jQuery.each(oaAnnotation.on,function(index,value){-1===jQuery.inArray(value.full,keys)&&keys.push(value.full)}),0===keys.length&&"function"==typeof errorCallback&&errorCallback(),jQuery.each(keys,function(index,key){try{0===_this.annotationsList.length&&(_this.annotationsList=_this.getAnnotationList(key)),jQuery.each(_this.annotationsList,function(index,value){if(value["@id"]===annotationID)return _this.annotationsList[index]=oaAnnotation,!1}),jQuery.each(_this.annotationsList,function(index,value){delete value.endpoint}),localStorage.setItem(key,JSON.stringify(_this.annotationsList)),jQuery.each(_this.annotationsList,function(index,value){value.endpoint=_this}),"function"==typeof successCallback&&successCallback(oaAnnotation)}catch(e){"function"==typeof errorCallback&&errorCallback()}})},create:function(oaAnnotation,successCallback,errorCallback){var _this=this,keys=[];jQuery.each(oaAnnotation.on,function(index,value){-1===jQuery.inArray(value.full,keys)&&keys.push(value.full)}),0===keys.length&&"function"==typeof errorCallback&&errorCallback(),jQuery.each(keys,function(index,key){try{0===_this.annotationsList.length&&(_this.annotationsList=_this.getAnnotationList(key)),oaAnnotation["@id"]=$.genUUID(),_this.annotationsList.push(oaAnnotation),jQuery.each(_this.annotationsList,function(index,value){delete value.endpoint}),localStorage.setItem(key,JSON.stringify(_this.annotationsList)),jQuery.each(_this.annotationsList,function(index,value){value.endpoint=_this}),"function"==typeof successCallback&&successCallback(oaAnnotation)}catch(e){"function"==typeof errorCallback&&errorCallback()}})},getAnnotationList:function(key){var data=localStorage.getItem(key);return data?JSON.parse(data):[]},userAuthorize:function(action,annotation){return!0}}}(Mirador),function($){$.Mirador21Strategy=function(options){jQuery.extend(this,{},options),this.init()},$.Mirador21Strategy.prototype={init:function(){},isThisType:function(annotation){return!!(annotation.on&&"object"==typeof annotation.on&&annotation.on.selector&&"object"==typeof annotation.on.selector&&annotation.on.selector.value&&"string"==typeof annotation.on.selector.value&&"oa:SvgSelector"===annotation.on.selector["@type"])},buildAnnotation:function(options){var oaAnno=options.annotation,win=options.window,overlay=options.overlay,svg=overlay.getSVGString(overlay.draftPaths);return oaAnno.on={"@type":"oa:SpecificResource",full:win.canvasID,selector:{"@type":"oa:SvgSelector",value:svg},within:{"@id":win.loadedManifest,"@type":"sc:Manifest"}},oaAnno},parseRegion:function(annotation,osdRegionDrawTool){if(this.isThisType(annotation))return osdRegionDrawTool.svgOverlay.parseSVG(annotation.on.selector.value,annotation)}}}(Mirador),function($){$.MiradorDualStrategy=function(options){jQuery.extend(this,{},options),this.init()},$.MiradorDualStrategy.prototype={init:function(){},isThisType:function(annotation){return!!(annotation.on&&jQuery.isArray(annotation.on)&&annotation.on.length>0&&"object"==typeof annotation.on[0]&&annotation.on[0].selector&&"object"==typeof annotation.on[0].selector&&"oa:Choice"===annotation.on[0].selector["@type"]&&annotation.on[0].selector.default&&"object"==typeof annotation.on[0].selector.default&&annotation.on[0].selector.default.value&&"string"==typeof annotation.on[0].selector.default.value&&annotation.on[0].selector.item&&"object"==typeof annotation.on[0].selector.item&&annotation.on[0].selector.item.value&&"string"==typeof annotation.on[0].selector.item.value)&&(0===annotation.on[0].selector.default.value.indexOf("xywh=")&&0===annotation.on[0].selector.item.value.indexOf("<svg"))},buildAnnotation:function(options){var oaAnno=options.annotation,win=options.window,overlay=options.overlay;return oaAnno.on=[],jQuery.each(overlay.draftPaths,function(index,path){var svg=overlay.getSVGString([path]),bounds=path.bounds;oaAnno.on.push({"@type":"oa:SpecificResource",full:win.canvasID,selector:{"@type":"oa:Choice",default:{"@type":"oa:FragmentSelector",value:"xywh="+Math.round(bounds.x)+","+Math.round(bounds.y)+","+Math.round(bounds.width)+","+Math.round(bounds.height)},item:{"@type":"oa:SvgSelector",value:svg}},within:{"@id":win.loadedManifest,"@type":"sc:Manifest"}})}),oaAnno},parseRegion:function(annotation,osdRegionDrawTool){if(this.isThisType(annotation)){var regionArray=[];return jQuery.each(annotation.on,function(index,target){regionArray=regionArray.concat(osdRegionDrawTool.svgOverlay.parseSVG(target.selector.item.value,annotation))}),regionArray}}}}(Mirador),function($){$.MiradorLegacyStrategy=function(options){jQuery.extend(this,{},options),this.init()},$.MiradorLegacyStrategy.prototype={init:function(){},isThisType:function(annotation){return!!(annotation.on&&"object"==typeof annotation.on&&annotation.on.selector&&"object"==typeof annotation.on.selector&&annotation.on.selector.value&&"string"==typeof annotation.on.selector.value&&"oa:FragmentSelector"===annotation.on.selector["@type"])&&0===annotation.on.selector.value.indexOf("xywh=")},buildAnnotation:function(options){var oaAnno=options.annotation,win=options.window,bounds=options.overlay.draftPaths[0].bounds;return oaAnno.on={"@type":"oa:SpecificResource",full:win.canvasID,selector:{"@type":"oa:FragmentSelector",value:"xywh="+Math.round(bounds.x)+","+Math.round(bounds.y)+","+Math.round(bounds.width)+","+Math.round(bounds.height)}},oaAnno},parseRegion:function(annotation,osdRegionDrawTool){if(this.isThisType(annotation))return osdRegionDrawTool.parseRectangle(annotation.on.full+"#"+annotation.on.selector.value,annotation)}}}(Mirador),function($){$.OsdRegionDrawTool=function(options){jQuery.extend(this,{osdViewer:null,parent:null,osd:null,list:null,annotationsToShapesMap:{},eventEmitter:null},options),this.eventsSubscriptions=[],this.init()},$.OsdRegionDrawTool.prototype={init:function(){this.svgOverlay=this.osdViewer.svgOverlay(this.osdViewer.id,this.windowId,this.state,this.eventEmitter),this.svgOverlay.show(),this.svgOverlay.disable(),this.horizontallyFlipped=!1,this.listenForActions()},enterDisplayAnnotations:function(){this.svgOverlay.setMouseTool(),this.svgOverlay.inEditOrCreateMode?this.svgOverlay.checkToRemoveFocus():(this.exitEditMode(!0),this.render())},enterCreateAnnotation:function(){this.svgOverlay.inEditOrCreateMode?this.svgOverlay.checkToRemoveFocus():(this.osdViewer.setMouseNavEnabled(!1),this.svgOverlay.show(),this.svgOverlay.enable(),this.render())},enterCreateShape:function(){this.svgOverlay.inEditOrCreateMode?this.svgOverlay.checkToRemoveFocus():(this.osdViewer.setMouseNavEnabled(!1),this.svgOverlay.show(),this.svgOverlay.enable())},enterEditAnnotation:function(){this.osdViewer.setMouseNavEnabled(!1),this.svgOverlay.show(),this.svgOverlay.enableEdit()},enterDefault:function(){this.svgOverlay.removeMouseTool(),this.exitEditMode(!1)},exitEditMode:function(showAnnotations){this.osdViewer.setMouseNavEnabled(!0),this.svgOverlay.disable(),showAnnotations?this.svgOverlay.show():this.svgOverlay.hide()},render:function(){if(this.parent.mode===$.AnnotationsLayer.DISPLAY_ANNOTATIONS){this.svgOverlay.restoreEditedShapes(),this.svgOverlay.paperScope.activate(),this.svgOverlay.paperScope.project.clear();this.annotationsToShapesMap={};for(var strategies=[new $.Mirador21Strategy,new $.LegacyOpenAnnotationStrategy,new $.MiradorLegacyStrategy,new $.MiradorDualStrategy],i=0;i<this.list.length;i++){var annotation=this.list[i];try{var shapeArray=this.prepareShapeArray(annotation,strategies);shapeArray.length>0?(this.svgOverlay.restoreLastView(shapeArray),this.annotationsToShapesMap[annotation["@id"]]=shapeArray):console.log("ERROR couldn't find a strategy for "+annotation["@id"])}catch(e){console.log("ERROR OsdRegionDrawTool#render anno:",annotation,"error:",e)}}var windowElement=this.state.getWindowElement(this.windowId);this.annoTooltip=new $.AnnotationTooltip({targetElement:jQuery(this.osdViewer.element),state:this.state,eventEmitter:this.eventEmitter,windowId:this.windowId}),this.annoTooltip.initializeViewerUpgradableToEditor({container:windowElement,viewport:windowElement,getAnnoFromRegion:this.getAnnoFromRegion.bind(this)}),this.svgOverlay.paperScope.view.draw(),this.eventEmitter.publish("annotationsRendered."+this.windowId)}},prepareShapeArray:function(annotation,strategies){if("object"==typeof annotation&&annotation.on)for(var i=0;i<strategies.length;i++)if(strategies[i].isThisType(annotation))return shapeArray=strategies[i].parseRegion(annotation,this),shapeArray;return[]},parseRectangle:function(rectString,annotation){var shapeArray=rectString.split("=")[1].split(","),shape={x:parseInt(shapeArray[0]),y:parseInt(shapeArray[1]),width:parseInt(shapeArray[2]),height:parseInt(shapeArray[3])};return this.svgOverlay.createRectangle(shape,annotation)},showTooltipsFromMousePosition:function(event,location,absoluteLocation){var _this=this,originWindow=this.state.getWindowObjectById(this.windowId),currentCanvasModel=originWindow.canvases[originWindow.canvasID],hitOptions={fill:!0,stroke:!0,segments:!0},hoverColor=this.state.getStateProperty("drawingToolsSettings").hoverColor,annotations=[];this.horizontallyFlipped&&(location.x=currentCanvasModel.getBounds().width-location.x);for(var key in _this.annotationsToShapesMap)if(_this.annotationsToShapesMap.hasOwnProperty(key))for(var shapeArray=_this.annotationsToShapesMap[key],idx=0;idx<shapeArray.length;idx++){var shapeTool=this.svgOverlay.getTool(shapeArray[idx]),hoverWidth=shapeArray[idx].data.strokeWidth/this.svgOverlay.paperScope.view.zoom;if(shapeArray[idx].hitTest(location,hitOptions)){if(annotations.push(shapeArray[idx].data.annotation),shapeTool.onHover)for(var k=0;k<shapeArray.length;k++)shapeTool.onHover(!0,shapeArray[k],hoverWidth,hoverColor);break}shapeTool.onHover&&shapeTool.onHover(!1,shapeArray[idx],hoverWidth)}this.svgOverlay.paperScope.view.draw(),_this.annoTooltip.showViewer({annotations:annotations,triggerEvent:event,shouldDisplayTooltip:function(api){if(api.elements.tooltip){var cursorWithinTooltip=!0,leftSide=api.elements.tooltip.offset().left-_this.svgOverlay.hitOptions.tolerance,rightSide=api.elements.tooltip.offset().left+api.elements.tooltip.width()+_this.svgOverlay.hitOptions.tolerance;(absoluteLocation.x<leftSide||rightSide<absoluteLocation.x)&&(cursorWithinTooltip=!1);var topSide=api.elements.tooltip.offset().top-_this.svgOverlay.hitOptions.tolerance,bottomSide=api.elements.tooltip.offset().top+api.elements.tooltip.height()+_this.svgOverlay.hitOptions.tolerance;return(absoluteLocation.y<topSide||bottomSide<absoluteLocation.y)&&(cursorWithinTooltip=!1),!cursorWithinTooltip}return!0}})},listenForActions:function(){var _this=this;this._thisDestroy=function(){_this.destroy()},_this.osdViewer.addHandler("close",this._thisDestroy),this.eventsSubscriptions.push(this.eventEmitter.subscribe("DESTROY_EVENTS."+this.windowId,function(event){_this.destroy()})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("updateTooltips."+_this.windowId,function(event,location,absoluteLocation){_this.annoTooltip&&!_this.annoTooltip.inEditOrCreateMode&&_this.showTooltipsFromMousePosition(event,location,absoluteLocation)})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("removeTooltips."+_this.windowId,function(){jQuery(_this.osdViewer.element).qtip("destroy",!0)})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("disableTooltips."+_this.windowId,function(){_this.annoTooltip&&(_this.annoTooltip.inEditOrCreateMode=!0)})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("enableTooltips."+_this.windowId,function(){_this.annoTooltip&&(_this.annoTooltip.inEditOrCreateMode=!1),_this.svgOverlay.restoreDraftShapes()})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("SET_ANNOTATION_EDITING."+_this.windowId,function(event,options){jQuery.each(_this.annotationsToShapesMap,function(key,paths){key===options.annotationId?(options.isEditable?_this.eventEmitter.publish("SET_OVERLAY_TOOLTIP."+_this.windowId,{tooltip:options.tooltip,visible:!0,paths:paths}):_this.eventEmitter.publish("SET_OVERLAY_TOOLTIP."+_this.windowId,{tooltip:null,visible:!1,paths:[]}),jQuery.each(paths,function(index,path){path.data.editable=options.isEditable,options.isEditable?path.strokeWidth=(path.data.strokeWidth+5)/_this.svgOverlay.paperScope.view.zoom:path.strokeWidth=path.data.strokeWidth/_this.svgOverlay.paperScope.view.zoom;_this.svgOverlay.getTool(path).onHover(!1,path,path.strokeWidth)})):jQuery.each(paths,function(index,path){path.data.editable=!1})}),_this.svgOverlay.paperScope.view.draw()})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("refreshOverlay."+_this.windowId,function(event){_this.render()})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("enableManipulation",function(event,tool){"mirror"===tool&&(_this.horizontallyFlipped=!0)})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("disableManipulation",function(event,tool){"mirror"===tool&&(_this.horizontallyFlipped=!1)}))},getAnnoFromRegion:function(regionId){return this.list.filter(function(annotation){return annotation["@id"]===regionId})},destroy:function(){var _this=this;this.eventsSubscriptions.forEach(function(event){_this.eventEmitter.unsubscribe(event.name,event.handler)}),this.osdViewer.removeHandler("close",this._thisDestroy)}}}(Mirador),function($){$.Ellipse=function(options){jQuery.extend(this,{name:"Ellipse",logoClass:"radio_button_unchecked",idPrefix:"ellipse_",tooltip:"ellipseTooltip"},options),this.init()},$.Ellipse.prototype={init:function(){},createShape:function(initialPoint,overlay){overlay.mode="create";var segments=[],pixel=1/overlay.paperScope.view.zoom;segments.push(new overlay.paperScope.Point(initialPoint.x-2*pixel,initialPoint.y-2*pixel)),segments.push(new overlay.paperScope.Point(initialPoint.x-1*pixel,initialPoint.y-(Math.sqrt(2)+1)*pixel)),segments.push(new overlay.paperScope.Point(initialPoint.x-1*pixel,initialPoint.y-(Math.sqrt(2)+1)*pixel)),segments.push(new overlay.paperScope.Point(initialPoint.x-1*pixel,initialPoint.y-(Math.sqrt(2)+1)*pixel)),segments.push(new overlay.paperScope.Point(initialPoint.x,initialPoint.y-2*pixel)),segments.push(new overlay.paperScope.Point(initialPoint.x+(Math.sqrt(2)-1)*pixel,initialPoint.y-1*pixel)),segments.push(new overlay.paperScope.Point(initialPoint.x,initialPoint.y)),segments.push(new overlay.paperScope.Point(initialPoint.x-1*pixel,initialPoint.y+(Math.sqrt(2)-1)*pixel)),segments.push(new overlay.paperScope.Point(initialPoint.x-2*pixel,initialPoint.y)),segments.push(new overlay.paperScope.Point(initialPoint.x-(Math.sqrt(2)+1)*pixel,initialPoint.y-1*pixel));var shape=new overlay.paperScope.Path({segments:segments,name:overlay.getName(this)});return shape.dashArray=overlay.dashArray,shape.data.strokeWidth=overlay.strokeWidth,shape.strokeWidth=shape.data.strokeWidth/overlay.paperScope.view.zoom,shape.strokeColor=overlay.strokeColor,shape.fillColor=overlay.fillColor,shape.fillColor.alpha=overlay.fillColorAlpha,shape.closed=!0,shape.data.rotation=0,overlay.segment=shape.segments[6],this.updateSelection(!0,shape,overlay),shape},updateSelection:function(selected,item,overlay){if(-1!=item._name.toString().indexOf(this.idPrefix)){item.segments.length>10&&item.removeSegment(10),item.smooth({from:-7,to:1}),item.selected=selected,item.segments[2].selected=selected;var inHandle=item.segments[7].handleIn.clone();inHandle=inHandle.multiply(-1);var outHandle=item.segments[7].handleOut.clone();if(outHandle=outHandle.multiply(-1),item.segments[1].handleIn=inHandle,item.segments[1].handleOut=new overlay.paperScope.Point(0,0),item.segments[2].handleIn=new overlay.paperScope.Point(0,0),item.segments[2].handleOut=new overlay.paperScope.Point(0,0),item.segments[3].handleIn=new overlay.paperScope.Point(0,0),item.segments[3].handleOut=outHandle,selected){var point=item.segments[2].point.clone();point=point.add(item.segments[2].handleOut),item.contains(point)&&(item.segments[2].handleOut=item.segments[2].handleOut.rotate(180,item.segments[2])),item.data.deleteIcon||(item.data.deleteIcon=new overlay.annotationUtils.DeleteActionIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"delete",fillColor:item.selectedColor}),item.data.deleteIcon.addData("parent",item),item.data.deleteIcon.addData("pivot",item.segments[7].point),item.data.deleteIcon.addData("type","deleteIcon"),item.data.deleteIcon.addData("self",item.data.deleteIcon),item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.deleteIcon.setOnMouseDownListener(overlay)),item.data.rotationIcon||(item.data.rotationIcon=new overlay.annotationUtils.RotationIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"rotation",fillColor:item.selectedColor}),item.data.rotationIcon.addData("pivot",item.segments[3].point),item.data.rotationIcon.addData("type","rotationIcon"),item.data.rotationIcon.addData("self",item.data.rotationIcon),item.data.rotationIcon.addData("parent",item),item.data.rotationIcon.setPosition(item.data.rotationIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.rotationIcon.setOnMouseDownListener(overlay)),item.data.group||(item.data.group=new overlay.annotationUtils.Group(overlay.paperScope,[item,item.data.deleteIcon.getItem(),item.data.deleteIcon.getMask().getItem(),item.data.rotationIcon.getItem(),item.data.rotationIcon.getMask().getItem()])),item.contains(item.data.deleteIcon.getItem().position)&&(item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.deleteIcon.rotate(180,item.data.deleteIcon.getData("pivot")),item.data.deleteIcon.rotate(180)),item.contains(item.data.rotationIcon.getItem().position)&&(item.data.rotationIcon.setPosition(item.data.rotationIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.rotationIcon.rotate(180,item.data.rotationIcon.getData("pivot")),item.data.rotationIcon.rotate(180))}else item.data.group&&(item.data.group.remove(),item.data.group=null,overlay.paperScope.project.activeLayer.addChild(item)),item.data.deleteIcon&&(item.data.deleteIcon.remove(),item.data.deleteIcon=null),item.data.rotationIcon&&(item.data.rotationIcon.remove(),item.data.rotationIcon=null),item.segments[2].handleOut=new overlay.paperScope.Point(0,0)}},onResize:function(item,overlay){-1!==item._name.toString().indexOf(this.partOfPrefix)&&(-1!==item._name.toString().indexOf("delete")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.parent.data.rotation))),item.data.parent.contains(item.position)&&(item.data.self.rotate(180,item.data.self.getData("pivot")),item.data.self.rotate(180)),item.data.self.resize(24/overlay.paperScope.view.zoom)),-1!==item._name.toString().indexOf("rotation")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.parent.data.rotation))),item.data.parent.contains(item.position)&&(item.data.self.rotate(180,item.data.self.getData("pivot")),item.data.self.rotate(180)),item.data.self.resize(16/overlay.paperScope.view.zoom)))},onHover:function(activate,shape,hoverWidth,hoverColor){shape.strokeWidth=hoverWidth,activate&&!shape.data.hovered&&(shape.data.nonHoverStrokeColor=shape.strokeColor.clone(),shape.data.hovered=!0,shape.strokeColor=hoverColor),!activate&&shape.data.hovered&&(shape.strokeColor=shape.data.nonHoverStrokeColor.clone(),delete shape.data.nonHoverStrokeColor,delete shape.data.hovered)},onMouseUp:function(event,overlay){"create"==overlay.mode&&overlay.path?overlay.onDrawFinish():("translate"===overlay.mode||"deform"===overlay.mode&&overlay.path)&&overlay.onEditFinish()},translate:function(event,overlay){for(var i=0;i<overlay.path.segments.length;i++)overlay.path.segments[i].point.x+=event.delta.x,overlay.path.segments[i].point.y+=event.delta.y;overlay.path.data.rotationIcon.translateByXY(event.delta.x,event.delta.y),overlay.path.data.deleteIcon.translateByXY(event.delta.x,event.delta.y)},rotate:function(event,overlay){var center=overlay.path.position,rotation=Math.atan2(event.point.y-center.y+event.delta.y,event.point.x-center.x+event.delta.x)-Math.atan2(event.point.y-center.y,event.point.x-center.x);rotation*=180/Math.PI,overlay.path.data.group.rotate(rotation,overlay.path.position),overlay.path.data.deleteIcon.rotate(-rotation),overlay.path.data.rotationIcon.rotate(-rotation),overlay.path.data.rotation+=rotation},onMouseDrag:function(event,overlay){if("translate"!=overlay.mode)if("rotate"!==overlay.mode){if("create"==overlay.mode||"deform"==overlay.mode){for(var idx=-1,l=0;l<overlay.path.segments.length;l++)if(overlay.path.segments[l]==overlay.segment){idx=l;break}var translation=new overlay.paperScope.Point(event.delta.x,event.delta.y),rot=overlay.path.data.rotation;translation=translation.rotate(-rot);var translationX=new overlay.paperScope.Point(translation.x,0);translationX=translationX.rotate(rot);var translationY=new overlay.paperScope.Point(0,translation.y);translationY=translationY.rotate(rot),0!==idx&&4!==idx&&6!==idx&&8!==idx||(translationX=translationX.multiply(2/(1+Math.sqrt(.5))),translationY=translationY.multiply(2/(1+Math.sqrt(.5))));var moveTopSize=0===idx||1===idx||2===idx||3===idx||4===idx,moveBottomSize=6===idx||7===idx||8===idx,moveRightSize=4===idx||5===idx||6===idx,moveLeftSize=0===idx||8===idx||9===idx;if(moveTopSize){overlay.path.data.rotationIcon.translateByPoint(translationY),overlay.path.segments[1].point=overlay.path.segments[1].point.add(translationY),overlay.path.segments[2].point=overlay.path.segments[2].point.add(translationY),overlay.path.segments[3].point=overlay.path.segments[3].point.add(translationY);var trTop=translationY.clone();trTop=trTop.multiply((1+Math.sqrt(.5))/2),overlay.path.segments[0].point=overlay.path.segments[0].point.add(trTop),overlay.path.segments[4].point=overlay.path.segments[4].point.add(trTop),trTop=trTop.multiply((1-Math.sqrt(.5))/(1+Math.sqrt(.5))),overlay.path.segments[6].point=overlay.path.segments[6].point.add(trTop),overlay.path.segments[8].point=overlay.path.segments[8].point.add(trTop)}if(moveBottomSize){overlay.path.data.deleteIcon.translateByPoint(translationY),overlay.path.segments[7].point=overlay.path.segments[7].point.add(translationY);var trBottom=translationY.clone();trBottom=trBottom.multiply((1+Math.sqrt(.5))/2),overlay.path.segments[6].point=overlay.path.segments[6].point.add(trBottom),overlay.path.segments[8].point=overlay.path.segments[8].point.add(trBottom),trBottom=trBottom.multiply((1-Math.sqrt(.5))/(1+Math.sqrt(.5))),overlay.path.segments[0].point=overlay.path.segments[0].point.add(trBottom),overlay.path.segments[4].point=overlay.path.segments[4].point.add(trBottom)}if((moveTopSize||moveBottomSize)&&(translationY=translationY.multiply(.5),overlay.path.segments[5].point=overlay.path.segments[5].point.add(translationY),overlay.path.segments[9].point=overlay.path.segments[9].point.add(translationY)),moveRightSize){overlay.path.segments[5].point=overlay.path.segments[5].point.add(translationX);var trRight=translationX.clone();trRight=trRight.multiply((1+Math.sqrt(.5))/2),overlay.path.segments[4].point=overlay.path.segments[4].point.add(trRight),overlay.path.segments[6].point=overlay.path.segments[6].point.add(trRight),trRight=trRight.multiply((1-Math.sqrt(.5))/(1+Math.sqrt(.5))),overlay.path.segments[0].point=overlay.path.segments[0].point.add(trRight),overlay.path.segments[8].point=overlay.path.segments[8].point.add(trRight)}if(moveLeftSize){overlay.path.segments[9].point=overlay.path.segments[9].point.add(translationX);var trLeft=translationX.clone();trLeft=trLeft.multiply((1+Math.sqrt(.5))/2),overlay.path.segments[0].point=overlay.path.segments[0].point.add(trLeft),overlay.path.segments[8].point=overlay.path.segments[8].point.add(trLeft),trLeft=trLeft.multiply((1-Math.sqrt(.5))/(1+Math.sqrt(.5))),overlay.path.segments[4].point=overlay.path.segments[4].point.add(trLeft),overlay.path.segments[6].point=overlay.path.segments[6].point.add(trLeft)}(moveRightSize||moveLeftSize)&&(translationX=translationX.multiply(.5),overlay.path.data.rotationIcon.translateByPoint(translationX),overlay.path.data.deleteIcon.translateByPoint(translationX),overlay.path.segments[1].point=overlay.path.segments[1].point.add(translationX),overlay.path.segments[2].point=overlay.path.segments[2].point.add(translationX),overlay.path.segments[3].point=overlay.path.segments[3].point.add(translationX),overlay.path.segments[7].point=overlay.path.segments[7].point.add(translationX));var point=overlay.path.segments[2].point.clone();point=point.add(overlay.path.segments[2].handleOut),overlay.path.contains(point)&&(overlay.path.segments[2].handleOut=overlay.path.segments[2].handleOut.rotate(180,overlay.path.segments[2])),overlay.path.contains(overlay.path.data.deleteIcon.getItem().position)&&(overlay.path.data.deleteIcon.rotate(180,overlay.path.data.deleteIcon.getData("pivot")),overlay.path.data.deleteIcon.rotate(180)),overlay.path.contains(overlay.path.data.rotationIcon.getItem().position)&&(overlay.path.data.rotationIcon.rotate(180,overlay.path.data.rotationIcon.getData("pivot")),overlay.path.data.rotationIcon.rotate(180)),overlay.path.segments.length>10&&overlay.path.removeSegment(10),overlay.path.smooth({from:-7,to:1})}}else this.rotate(event,overlay);else this.translate(event,overlay)},onMouseMove:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);hitResult&&-1!==hitResult.item._name.toString().indexOf(this.idPrefix)&&!overlay.disabled&&overlay.hoveredPath&&-1!==hitResult.item._name.toString().indexOf(overlay.hoveredPath._name.toString())&&this.setCursor(hitResult,overlay)},setCursor:function(hitResult,overlay){"stroke"!==hitResult.type&&"handle-in"!==hitResult.type&&"handle-out"!==hitResult.type?"pixel"!==hitResult.type?hitResult.segment&&jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","move")},onMouseDown:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);if(hitResult&&-1!=hitResult.item._name.toString().indexOf(this.idPrefix)&&"deform"!=overlay.mode&&"translate"!=overlay.mode&&"create"!=overlay.mode){if(-1!==hitResult.item._name.toString().indexOf(this.partOfPrefix))return hitResult.item.data.self.onMouseDown(),void("rotate"===overlay.mode&&(overlay.path=hitResult.item.data.self.getItem().data.parent));"segment"===hitResult.type&&(overlay.mode="deform",overlay.segment=null,overlay.path=null,this.setCursor(hitResult,overlay)),"stroke"!==hitResult.type&&"handle-in"!==hitResult.type&&"handle-out"!==hitResult.type||(overlay.mode="translate",overlay.segment=null,overlay.path=null)}"translate"!==overlay.mode?"deform"!==overlay.mode?overlay.path=this.createShape(event.point,overlay):overlay.path?(overlay.segment=null,overlay.path=null,overlay.mode=""):(overlay.path=hitResult.item,overlay.segment=hitResult.segment):overlay.path?(overlay.segment=null,overlay.path=null,overlay.mode=""):overlay.path=hitResult.item},onDoubleClick:function(event,overlay){}}}(Mirador),function($){$.Freehand=function(options){jQuery.extend(this,{name:"Freehand",logoClass:"gesture",idPrefix:"smooth_path_",tooltip:"freehandTooltip"},options),this.init()},$.Freehand.prototype={init:function(){},createShape:function(initialPoint,overlay){overlay.mode="create";var shape=new overlay.paperScope.Path({segments:[initialPoint],dashArray:overlay.dashArray,strokeColor:overlay.strokeColor,name:overlay.getName(this)});return shape.data.strokeWidth=overlay.strokeWidth,shape.strokeWidth=shape.data.strokeWidth/overlay.paperScope.view.zoom,shape},updateSelection:function(selected,item,overlay){-1!==item._name.toString().indexOf(this.idPrefix)&&(item.selected=selected,selected?item.data.deleteIcon||(item.data.deleteIcon=new overlay.annotationUtils.DeleteActionIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"delete",fillColor:item.selectedColor}),item.data.deleteIcon.addData("pivot",new overlay.paperScope.Point(this.getPivotPointForDeleteIcon(item))),item.data.deleteIcon.addData("type","deleteIcon"),item.data.deleteIcon.addData("self",item.data.deleteIcon),item.data.deleteIcon.addData("parent",item),item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))),item.data.deleteIcon.setOnMouseDownListener(overlay)):item.data.deleteIcon&&(item.data.deleteIcon.remove(),item.data.deleteIcon=null))},onResize:function(item,overlay){-1!==item._name.toString().indexOf(this.partOfPrefix)&&-1!==item._name.toString().indexOf("delete")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))),item.data.self.resize(24/overlay.paperScope.view.zoom))},getPivotPointForDeleteIcon:function(item){for(var points=[],i=0;i<item.segments.length;i++)points.push(item.segments[i].point);return{x:this.getGeometricCenterOfPoints(points).x,y:this.getLowestPoint(points).y}},getLowestPoint:function(points){for(var lx=0,ly=0,i=0;i<points.length;i++)lx=Math.max(lx,points[i].x),ly=Math.max(ly,points[i].y);return{x:lx,y:ly}},getGeometricCenterOfPoints:function(points){for(var cx=0,cy=0,i=0;i<points.length;i++)cx+=points[i].x,cy+=points[i].y;return{x:cx/points.length,y:cy/points.length}},onHover:function(activate,shape,hoverWidth,hoverColor){shape.strokeWidth=hoverWidth,activate&&!shape.data.hovered&&(shape.data.nonHoverStrokeColor=shape.strokeColor.clone(),shape.data.hovered=!0,shape.strokeColor=hoverColor),!activate&&shape.data.hovered&&(shape.strokeColor=shape.data.nonHoverStrokeColor.clone(),delete shape.data.nonHoverStrokeColor,delete shape.data.hovered)},onMouseUp:function(event,overlay){"create"===overlay.mode&&overlay.path&&(overlay.path.simplify(),overlay.onDrawFinish())},onMouseDrag:function(event,overlay){if("deform"!==overlay.mode)"translate"!==overlay.mode?"create"===overlay.mode&&(overlay.path.add(event.point),overlay.path.data.deleteIcon&&(overlay.path.data.deleteIcon.addData("pivot",new overlay.paperScope.Point(this.getPivotPointForDeleteIcon(overlay.path))),overlay.path.data.deleteIcon.setPosition(overlay.path.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))))):overlay.path&&(overlay.path.position.x+=event.delta.x,overlay.path.position.y+=event.delta.y,overlay.path.data.deleteIcon&&overlay.path.data.deleteIcon.translateByXY(event.delta.x,event.delta.y));else if(overlay.segment){overlay.segment.point.x+=event.delta.x,overlay.segment.point.y+=event.delta.y,overlay.path.smooth();var path=overlay.segment.path;path.data.deleteIcon.addData("pivot",new overlay.paperScope.Point(this.getPivotPointForDeleteIcon(path))),path.data.deleteIcon.setPosition(path.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom)))}},onMouseMove:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);hitResult&&-1!==hitResult.item._name.toString().indexOf(this.idPrefix)&&!overlay.disabled&&overlay.hoveredPath&&-1!==hitResult.item._name.toString().indexOf(overlay.hoveredPath._name.toString())&&this.setCursor(hitResult,overlay)},setCursor:function(hitResult,overlay){"stroke"!==hitResult.type?"handle-in"!==hitResult.type&&"handle-out"!==hitResult.type&&"pixel"!==hitResult.type?hitResult.segment&&jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","move")},onMouseDown:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);if(hitResult&&-1!=hitResult.item._name.toString().indexOf(this.idPrefix)){if(-1!==hitResult.item._name.toString().indexOf(this.partOfPrefix))return void hitResult.item.data.self.onMouseDown();if("create"!==overlay.mode){if("stroke"===hitResult.type)return overlay.mode="translate",void(overlay.path=hitResult.item);if("segment"===hitResult.type||"handle-out"===hitResult.type||"handle-in"===hitResult.type)return event.modifiers.shift&&hitResult.item.segments.length>2?void hitResult.segment.remove():(overlay.mode="deform",overlay.segment=hitResult.segment,void(overlay.path=hitResult.item))}}else"create"!==overlay.mode&&(overlay.mode="");""!==overlay.mode||(overlay.path=this.createShape(event.point,overlay))},onDoubleClick:function(event,overlay){}}}(Mirador),function($){$.getTools=function(options){return this.svgOverlayTools?this.svgOverlayTools:(options.partOfPrefix="_partOf",this.svgOverlayTools=[new $.Rectangle(options),new $.Freehand(options),new $.Polygon(options),new $.Ellipse(options),new $.Pin(options)],this.svgOverlayTools)},OpenSeadragon.Viewer.prototype.svgOverlay=function(osdViewerId,windowId,state,eventEmitter){return new $.Overlay(this,osdViewerId,windowId,state,eventEmitter)};$.Overlay=function(viewer,osdViewerId,windowId,state,eventEmitter){var drawingToolsSettings=state.getStateProperty("drawingToolsSettings");this.drawingToolsSettings=drawingToolsSettings;var availableAnnotationDrawingTools=state.getStateProperty("availableAnnotationDrawingTools"),availableExternalCommentsPanel=state.getStateProperty("availableExternalCommentsPanel");jQuery.extend(this,{disabled:!0,inEditOrCreateMode:!1,osdViewerId:osdViewerId,windowId:windowId,commentPanel:null,mode:"",draftPaths:[],editedPaths:[],hoveredPath:null,path:null,segment:null,latestMouseDownTime:-1,doubleClickReactionTime:drawingToolsSettings.doubleClickReactionTime,availableAnnotationDrawingTools:availableAnnotationDrawingTools,availableExternalCommentsPanel:availableExternalCommentsPanel,dashArray:[],strokeWidth:1,fixedShapeSize:drawingToolsSettings.fixedShapeSize,selectedColor:drawingToolsSettings.selectedColor||"#004c66",shapeHandleSize:drawingToolsSettings.shapeHandleSize,partOfPrefix:"_partOf",hitOptions:{handles:!0,stroke:!0,segments:!0,tolerance:5}}),this.tools=$.getTools(drawingToolsSettings),this.currentTool=null,this.dashArray=[],this.strokeWidth=1,this.strokeColor=drawingToolsSettings.strokeColor,this.fillColor=drawingToolsSettings.fillColor,this.fillColorAlpha=drawingToolsSettings.fillColorAlpha,this.viewer=viewer,this.canvas=document.createElement("canvas"),jQuery(this.canvas).attr("tabindex","0").mousedown(function(){jQuery(this).focus()}),this.canvas.id="draw_canvas_"+this.windowId,this.viewer.canvas.appendChild(this.canvas);this.slotWindowElement=state.getWindowElement(this.windowId),this.state=state,this.eventEmitter=eventEmitter,this.eventsSubscriptions=[],this.horizontallyFlipped=!1,this.resize(),this.show(),this.init()},$.Overlay.prototype={init:function(){var _this=this;this.lastAngle=0,this.paperScope=new paper.PaperScope,this.paperScope.setup("draw_canvas_"+_this.windowId),this.paperScope.activate(),this.paperScope.project.options.handleSize=_this.state.getStateProperty("shapeHandleSize"),jQuery(_this.canvas).attr("keepalive","true"),this.annotationUtils=new $.AnnotationUtils,this.paperScope.view.onFrame=function(event){if(_this.paperScope.snapPoint&&(_this.paperScope.snapPoint.remove(),_this.paperScope.snapPoint=null),_this.path&&!_this.path.closed&&_this.cursorLocation&&_this.currentTool&&-1!=_this.currentTool.idPrefix.indexOf("rough_path_")){var distanceToFirst=_this.path.segments[0].point.getDistance(_this.cursorLocation);_this.path.segments.length>1&&distanceToFirst<_this.hitOptions.tolerance&&(_this.paperScope.snapPoint=new _this.paperScope.Path.Circle({name:"snapPoint",center:_this.path.segments[0].point,radius:_this.hitOptions.tolerance/_this.paperScope.view.zoom,fillColor:_this.path.strokeColor,strokeColor:_this.path.strokeColor,strokeWidth:_this.path.strokeWidth}))}},this.mouseToolKey="draw_canvas_"+_this.windowId,this.setMouseTool(),this.listenForActions()},setMouseTool:function(){this.removeMouseTool(),this.paperScope.activate(),this.mouseTool=new this.paperScope.Tool,this.mouseTool.overlay=this,this.mouseTool.onMouseUp=this.onMouseUp,this.mouseTool.onMouseDrag=this.onMouseDrag,this.mouseTool.onMouseMove=this.onMouseMove,this.mouseTool.onMouseDown=this.onMouseDown,this.mouseTool.onDoubleClick=this.onDoubleClick,this.mouseTool.onKeyDown=function(event){}},removeMouseTool:function(){this.mouseTool&&this.mouseTool.remove()},handleDeleteShapeEvent:function(event,shape){var _this=this;new $.DialogBuilder(this.slotWindowElement).dialog({message:i18next.t("deleteShape"),closeButton:!1,className:"mirador-dialog",buttons:{no:{label:i18next.t("no"),className:"btn-default",callback:function(){}},yes:{label:i18next.t("yes"),className:"btn-primary",callback:function(){_this.deleteShape(shape)}}}})},listenForActions:function(){var _this=this;this._thisResize=function(){_this.resize()},this._thisRotate=function(event){_this.rotate(event),_this.resize()},this.viewer.addHandler("animation",this._thisResize),this.viewer.addHandler("open",this._thisResize),this.viewer.addHandler("animation-finish",this._thisResize),this.viewer.addHandler("update-viewport",this._thisResize),this.viewer.addHandler("resize",this._thisResize),this.viewer.addHandler("rotate",this._thisRotate),this.viewer.addHandler("constrain",this._thisResize),this._thisDestroy=function(){_this.destroy()},this.viewer.addHandler("close",this._thisDestroy),this.eventsSubscriptions.push(this.eventEmitter.subscribe("DESTROY_EVENTS."+this.windowId,function(event){_this.destroy()})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("toggleDrawingTool."+_this.windowId,function(event,tool){if(!_this.disabled){_this.currentTool=null,_this.mode="";for(var i=0;i<_this.tools.length;i++)_this.tools[i].logoClass===tool&&(_this.currentTool=_this.tools[i])}}));this.eventsSubscriptions.push(_this.eventEmitter.subscribe("deleteShape."+_this.windowId,function(event,shape){_this.handleDeleteShapeEvent(event,shape)})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("changeBorderColor."+_this.windowId,function(event,color){_this.strokeColor=color,_this.hoveredPath&&(_this.hoveredPath.strokeColor=color,_this.paperScope.view.draw())})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("changeFillColor."+_this.windowId,function(event,color,alpha){_this.fillColor=color,0===alpha&&(alpha=1e-5),_this.fillColorAlpha=alpha,_this.hoveredPath&&_this.hoveredPath.closed&&(_this.hoveredPath.fillColor=color,_this.hoveredPath.fillColor.alpha=alpha,_this.paperScope.view.draw())})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("toggleBorderType."+_this.windowId,function(event,type){"solid"==type?(_this.dashArray=[],_this.strokeWidth=1):"thick"==type?(_this.dashArray=[],_this.strokeWidth=3):"thickest"==type?(_this.dashArray=[],_this.strokeWidth=6):"dashed"==type?(_this.dashArray=[5,5],_this.strokeWidth=1):"dotdashed"==type&&(_this.dashArray=[2,5,7,5],_this.strokeWidth=1),_this.hoveredPath&&(_this.hoveredPath.dashArray=_this.dashArray,_this.hoveredPath.strokeWidth=_this.strokeWidth,_this.paperScope.view.draw())})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("annotationEditSave."+_this.windowId,function(event,oaAnno){var onAnnotationSaved=jQuery.Deferred();if(_this.draftPaths.length){(new $.MiradorDualStrategy).buildAnnotation({annotation:oaAnno,window:_this.state.getWindowObjectById(_this.windowId),overlay:_this}),_this.eventEmitter.publish("annotationUpdated."+_this.windowId,[oaAnno]),onAnnotationSaved.resolve()}else new $.DialogBuilder(_this.slotWindowElement).dialog({message:i18next.t("editModalSaveAnnotationWithNoShapesMsg"),closeButton:!1,className:"mirador-dialog",buttons:{success:{label:i18next.t("editModalBtnSaveWithoutShapes"),className:"btn-success",callback:function(){oaAnno.on={"@type":"oa:SpecificResource",full:_this.state.getWindowObjectById(_this.windowId).canvasID},_this.eventEmitter.publish("annotationUpdated."+_this.windowId,[oaAnno]),onAnnotationSaved.resolve()}},danger:{label:i18next.t("editModalBtnDeleteAnnotation"),className:"btn-danger",callback:function(){_this.eventEmitter.publish("annotationDeleted."+_this.windowId,[oaAnno["@id"]]),onAnnotationSaved.resolve()}},main:{label:i18next.t("cancel"),className:"btn-default",callback:function(){onAnnotationSaved.reject()}}}});jQuery.when(onAnnotationSaved.promise()).then(function(){_this.eventEmitter.publish("annotationEditSaveSuccessful."+_this.windowId),_this.eventEmitter.publish("SET_ANNOTATION_EDITING."+_this.windowId,{annotationId:oaAnno["@id"],isEditable:!1,tooltip:_this}),_this.inEditOrCreateMode=!1,_this.eventEmitter.publish("SET_STATE_MACHINE_POINTER."+_this.windowId)},function(){})})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("annotationEditCancel."+_this.windowId,function(event,id){_this.eventEmitter.publish("SET_ANNOTATION_EDITING."+_this.windowId,{annotationId:id,isEditable:!1,tooltip:_this.annoTooltip}),_this.inEditOrCreateMode=!1,_this.eventEmitter.publish("SET_STATE_MACHINE_POINTER."+_this.windowId)})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("clearDraftPaths."+_this.windowId,function(){_this.clearDraftData()})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("onAnnotationCreated."+_this.windowId,function(event,oaAnno){for(var i=0;i<_this.draftPaths.length;i++)_this.draftPaths[i].data&&_this.draftPaths[i].data.newlyCreated&&(_this.draftPaths[i].strokeWidth=_this.draftPaths[i].data.strokeWidth,delete _this.draftPaths[i].data.newlyCreated,delete _this.draftPaths[i].data.newlyCreatedStrokeFactor);(new $.MiradorDualStrategy).buildAnnotation({annotation:oaAnno,window:_this.state.getWindowObjectById(_this.windowId),overlay:_this}),_this.eventEmitter.publish("annotationCreated."+_this.windowId,[oaAnno,function(){_this.inEditOrCreateMode=!1,_this.eventEmitter.publish("SET_STATE_MACHINE_POINTER."+_this.windowId),_this.eventEmitter.publish("enableTooltips."+_this.windowId),_this.clearDraftData(),_this.annoTooltip=null,_this.annoEditorVisible=!1}])})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("onAnnotationCreatedCanceled."+_this.windowId,function(event,cancelCallback,immediate){var cancel=function(){_this.inEditOrCreateMode=!1,_this.eventEmitter.publish("SET_STATE_MACHINE_POINTER."+_this.windowId),_this.clearDraftData(),_this.annoTooltip=null,_this.annoEditorVisible=!1};immediate?cancel():new $.DialogBuilder(_this.slotWindowElement).dialog({message:i18next.t("cancelAnnotation"),closeButton:!1,className:"mirador-dialog",buttons:{no:{label:i18next.t("no"),className:"btn-default",callback:function(){}},yes:{label:i18next.t("yes"),className:"btn-primary",callback:function(){cancel(),cancelCallback&&cancelCallback()}}}})})),this.eventsSubscriptions.push(_this.eventEmitter.subscribe("onAnnotationDeleted."+_this.windowId,function(event,id,callback){_this.inEditOrCreateMode=!1,_this.eventEmitter.publish("annotationDeleted."+_this.windowId,[id]),_this.eventEmitter.publish("SET_STATE_MACHINE_POINTER."+_this.windowId),callback&&callback()})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("SET_OVERLAY_TOOLTIP."+this.windowId,function(event,options){_this.annoTooltip=options.tooltip,_this.annoEditorVisible=options.visible,_this.draftPaths=options.paths})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("CANCEL_ACTIVE_ANNOTATIONS."+this.windowId,function(event){_this.clearDraftData(),_this.annoTooltip=null,_this.annoEditorVisible=!1})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("ANNOTATIONS_LIST_UPDATED",function(event,options){options.windowId&&_this.eventEmitter.publish("refreshOverlay."+_this.windowId)})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("enableManipulation",function(event,tool){"mirror"===tool&&(_this.horizontallyFlipped=!0)})),this.eventsSubscriptions.push(this.eventEmitter.subscribe("disableManipulation",function(event,tool){"mirror"===tool&&(_this.horizontallyFlipped=!1)}))},deleteShape:function(shape){for(var i=0;i<this.draftPaths.length;i++)if(this.draftPaths[i]._name.toString()===shape._name.toString()){this.draftPaths.splice(i,1);break}this.removeFocus(),shape.remove()},getMousePositionInImage:function(mousePosition){var originWindow=this.state.getWindowObjectById(this.windowId),currentCanvasModel=originWindow.canvases[originWindow.canvasID];return mousePosition.x<0&&(mousePosition.x=0),mousePosition.x>currentCanvasModel.getBounds().width&&(mousePosition.x=currentCanvasModel.getBounds().width),mousePosition.y<0&&(mousePosition.y=0),mousePosition.y>currentCanvasModel.getBounds().height&&(mousePosition.y=currentCanvasModel.getBounds().height),this.horizontallyFlipped&&(mousePosition.x=currentCanvasModel.getBounds().width-mousePosition.x),mousePosition},adjustDeltaForShape:function(lastPoint,currentPoint,delta,bounds){var originWindow=this.state.getWindowObjectById(this.windowId),currentCanvasModel=originWindow.canvases[originWindow.canvasID];return lastPoint.x<currentPoint.x?bounds.x+bounds.width>currentCanvasModel.getBounds().width&&(delta.x=currentCanvasModel.getBounds().width-(bounds.x+bounds.width)):bounds.x<0&&(delta.x=Math.abs(bounds.x)),this.horizontallyFlipped&&(delta.x=-delta.x),lastPoint.y<currentPoint.y?bounds.y+bounds.height>currentCanvasModel.getBounds().height&&(delta.y=currentCanvasModel.getBounds().height-(bounds.y+bounds.height)):bounds.y<0&&(delta.y=Math.abs(bounds.y)),delta},onMouseUp:function(event){this.overlay.disabled||(event.stopPropagation(),this.overlay.currentTool&&this.overlay.currentTool.onMouseUp(event,this.overlay))},onMouseDrag:function(event){if(this.overlay.disabled){var absolutePoint={x:event.event.clientX,y:event.event.clientY};this.overlay.eventEmitter.publish("updateTooltips."+this.overlay.windowId,[event.point,absolutePoint])}else if(event.stopPropagation(),this.overlay.currentTool){if("Freehand"===this.overlay.currentTool.name&&"create"===this.overlay.mode)event.point=this.overlay.getMousePositionInImage(event.point),event.delta=event.point-event.lastPoint;else if(this.overlay.path){var bounds=this.overlay.path.bounds;event.delta=this.overlay.adjustDeltaForShape(event.lastPoint,event.point,event.delta,bounds)}this.overlay.currentTool.onMouseDrag(event,this.overlay)}this.overlay.paperScope.view.draw()},onMouseMove:function(event){if(this.overlay.disabled){var absolutePoint={x:event.event.clientX,y:event.event.clientY};this.overlay.eventEmitter.publish("updateTooltips."+this.overlay.windowId,[event.point,absolutePoint])}else this.overlay.paperScope.project.hitTest(event.point,this.overlay.hitOptions)?this.overlay.eventEmitter.publish("POINTER_CURSOR."+this.overlay.windowId):this.overlay.currentTool&&!this.overlay.path?this.overlay.eventEmitter.publish("CROSSHAIR_CURSOR."+this.overlay.windowId):this.overlay.eventEmitter.publish("DEFAULT_CURSOR."+this.overlay.windowId),event.stopPropagation(),this.overlay.currentTool&&this.overlay.currentTool.onMouseMove(event,this.overlay);this.overlay.paperScope.view.draw()},onMouseDown:function(event){if(!this.overlay.disabled){event.stopPropagation();var time=(new Date).getTime();if(time-this.overlay.latestMouseDownTime<this.overlay.doubleClickReactionTime)this.overlay.latestMouseDownTime=time,this.onDoubleClick(event);else{this.overlay.latestMouseDownTime=time;var hitResult=this.overlay.paperScope.project.hitTest(event.point,this.overlay.hitOptions);if("create"!==this.overlay.mode&&""!==this.overlay.mode&&(this.overlay.mode="",this.overlay.currentTool=null),hitResult&&"create"!==this.overlay.mode){var overlayEditable=!1;if(void 0!==hitResult.item.data.editable&&(overlayEditable=hitResult.item.data.editable),-1!==hitResult.item._name.toString().indexOf(this.overlay.partOfPrefix)&&(overlayEditable=!0),!overlayEditable)return}if(hitResult&&(!this.overlay.currentTool||-1===hitResult.item._name.toString().indexOf(this.overlay.currentTool.idPrefix)&&""===this.overlay.mode)){var prefix=hitResult.item._name.toString();prefix=prefix.substring(0,prefix.indexOf("_")+1);var longPrefix=hitResult.item._name.toString().split("_");longPrefix=longPrefix[0]+"_"+longPrefix[1]+"_";for(var j=0;j<this.overlay.tools.length;j++)if(this.overlay.tools[j].idPrefix===prefix||this.overlay.tools[j].idPrefix===longPrefix){this.overlay.eventEmitter.publish("toggleDrawingTool."+this.overlay.windowId,this.overlay.tools[j].logoClass);break}}this.overlay.currentTool&&(this.overlay.eventEmitter.publish("HUD_REMOVE_CLASS."+this.overlay.windowId,[".hud-dropdown","hud-disabled"]),event.point=this.overlay.getMousePositionInImage(event.point),this.overlay.currentTool.onMouseDown(event,this.overlay))}this.overlay.hover(),this.overlay.paperScope.view.draw()}},onDoubleClick:function(event){event.stopPropagation(),this.overlay.currentTool&&this.overlay.currentTool.onDoubleClick(event,this.overlay)},fitFixedSizeShapes:function(shape){if(shape.data.fixedSize=!0,-1!=shape.name.toString().indexOf("pin_")){var scale=1/shape.bounds.width;scale*=this.fixedShapeSize/this.paperScope.view.zoom,shape.scale(scale,shape.segments[0].point)}},updateSelection:function(selected,item){if(item&&item._name){var shapeTool=this.getTool(item);shapeTool&&(item.selectedColor=this.selectedColor,shapeTool.updateSelection(selected,item,this))}},rotate:function(event){this.paperScope&&this.paperScope.view&&(this.paperScope.view._matrix.rotate(event.degrees-this.lastAngle,this.paperScope.view.center),this.lastAngle=event.degrees)},resize:function(){this.viewer.viewport.getBounds(!0);this.canvas.width=this.viewer.viewport.containerSize.x,this.canvas.height=this.viewer.viewport.containerSize.y;var transform="translate(0px,0px)";if(this.canvas.style.WebkitTransform=transform,this.canvas.style.msTransform=transform,this.canvas.style.transform=transform,this.canvas.style.marginLeft="0px",this.canvas.style.marginTop="0px",this.paperScope&&this.paperScope.view){this.paperScope.view.viewSize=new this.paperScope.Size(this.canvas.width,this.canvas.height),this.paperScope.view.zoom=this.canvas.width*this.viewer.viewport.getZoom(!0),this.paperScope.view.center=new this.paperScope.Size(this.viewer.viewport.getCenter(!0).x,this.viewer.viewport.getCenter(!0).y),this.paperScope.view.update(!0);for(var allItems=this.paperScope.project.getItems({name:/_/}),j=0;j<allItems.length;j++)allItems[j].data.fixedSize&&this.fitFixedSizeShapes(allItems[j]),this.getTool(allItems[j]).onResize&&this.getTool(allItems[j]).onResize(allItems[j],this),allItems[j].strokeWidth=allItems[j].data.strokeWidth/this.paperScope.view.zoom,allItems[j].style&&(allItems[j].style.strokeWidth=allItems[j].data.strokeWidth/this.paperScope.view.zoom)}},hover:function(){if(this.currentTool)if(!this.currentTool&&this.hoveredPath&&(this.updateSelection(!1,this.hoveredPath),this.hoveredPath=null),this.hoveredPath){if(-1===this.hoveredPath._name.toString().indexOf(this.currentTool.idPrefix)&&(this.updateSelection(!1,this.hoveredPath),this.hoveredPath=null),this.path&&-1!==this.path._name.toString().indexOf(this.currentTool.idPrefix)){if(this.currentTool.partOfPrefix&&-1!==this.path._name.toString().indexOf(this.currentTool.partOfPrefix))return;if(this.hoveredPath){if(this.hoveredPath._name.toString()===this.path._name.toString())return;this.updateSelection(!1,this.hoveredPath)}this.hoveredPath=this.path,this.updateSelection(!0,this.hoveredPath)}}else this.path&&-1!=this.path._name.toString().indexOf(this.currentTool.idPrefix)&&(this.hoveredPath=this.path,this.updateSelection(!0,this.hoveredPath))},removeFocus:function(){this.hoveredPath&&(this.updateSelection(!1,this.hoveredPath),this.hoveredPath=null),this.path&&(this.updateSelection(!1,this.path),this.path=null)},restoreEditedShapes:function(){this.editedPaths=[],this.removeFocus()},restoreDraftShapes:function(){this.clearDraftData(),this.removeFocus()},getTool:function(shape){for(var i=0;i<this.tools.length;i++)if(-1!==shape.name.toString().indexOf(this.tools[i].idPrefix))return this.tools[i]},replaceShape:function(shape,annotation){var shapeTool=this.getTool(shape);shapeTool&&shapeTool.SEGMENT_POINTS_COUNT&&shapeTool.SEGMENT_POINTS_COUNT!==shape.segments.length&&shapeTool.adaptSegments(shape,this);var cloned=new this.paperScope.Path({segments:shape.segments,name:shape.name});return cloned.data.strokeWidth=shape.data.strokeWidth||1,cloned.strokeWidth=cloned.data.strokeWidth/this.paperScope.view.zoom,cloned.strokeColor=shape.strokeColor,cloned.dashArray=shape.dashArray,shape.fillColor&&(cloned.fillColor=shape.fillColor,0===shape.fillColor.alpha&&(shape.fillColor.alpha=1e-5),shape.fillColor.alpha&&(cloned.fillColor.alpha=shape.fillColor.alpha)),cloned.closed=shape.closed,cloned.data.rotation=shape.data.rotation,cloned.data.fixedSize=shape.data.fixedSize,cloned.data.annotation=annotation,cloned.data.fixedSize&&this.fitFixedSizeShapes(cloned),shape.remove(),cloned},createRectangle:function(shape,annotation){var paperItems=[],rect=new $.Rectangle,initialPoint={x:shape.x,y:shape.y},currentMode=this.mode,currentPath=this.path,strokeWidth=this.strokeWidth,strokeColor=this.strokeColor,fillColor=this.fillColor,fillColorAlpha=this.fillColorAlpha||1e-5;this.strokeColor=this.state.getStateProperty("drawingToolsSettings").strokeColor,this.fillColor=this.state.getStateProperty("drawingToolsSettings").fillColor,this.fillColorAlpha=this.state.getStateProperty("drawingToolsSettings").fillColorAlpha||1e-5,this.mode="create",this.path=rect.createShape(initialPoint,this);var eventData={delta:{x:shape.width,y:shape.height}};return rect.onMouseDrag(eventData,this),paperItems.push(this.path),paperItems[0].data.annotation=annotation,this.updateSelection(!1,paperItems[0]),this.strokeColor=strokeColor,this.strokeWidth=strokeWidth,this.fillColor=fillColor,this.fillColorAlpha=fillColorAlpha,this.path=currentPath,this.mode=currentMode,paperItems},parseSVG:function(svg,annotation){var paperItems=[];if("parsererror"!=(new DOMParser).parseFromString(svg,"text/xml").documentElement.nodeName){var svgTag=this.paperScope.project.importSVG(svg),body=svgTag.removeChildren()[0];if(svgTag.remove(),"Group"==body.className){for(var items=body.removeChildren(),itemIdx=0;itemIdx<items.length;itemIdx++)paperItems.push(this.replaceShape(items[itemIdx],annotation));body.remove()}else paperItems.push(this.replaceShape(body,annotation));return this.paperScope.view.update(!0),paperItems}},restoreLastView:function(shapeArray){for(var i=0;i<this.editedPaths.length;i++)for(var idx=0;idx<shapeArray.length;idx++)shapeArray[idx].name==this.editedPaths[i].name&&(shapeArray[idx].segments=this.editedPaths[i].segments,shapeArray[idx].name=this.editedPaths[i].name,shapeArray[idx].strokeWidth=this.editedPaths[i].strokeWidth,shapeArray[idx].strokeColor=this.editedPaths[i].strokeColor,shapeArray[idx].dashArray=this.editedPaths[i].dashArray,this.editedPaths[i].fillColor&&(shapeArray[idx].fillColor=this.editedPaths[i].fillColor,this.editedPaths[i].fillColor.alpha&&(shapeArray[idx].fillColor.alpha=this.editedPaths[i].fillColor.alpha)),this.editedPaths[i].style&&(shapeArray[idx].style=this.editedPaths[i].style,shapeArray[idx].style.strokeWidth=shapeArray[idx].data.strokeWidth/this.paperScope.view.zoom),shapeArray[idx].closed=this.editedPaths[i].closed,shapeArray[idx].data.rotation=this.editedPaths[i].data.rotation,shapeArray[idx].data.fixedSize=this.editedPaths[i].data.fixedSize,shapeArray[idx].data.annotation=this.editedPaths[i].data.annotation,shapeArray[idx].data.fixedSize&&this.fitFixedSizeShapes(shapeArray[idx]))},deselectAll:function(){this.paperScope&&this.paperScope.view&&this.paperScope.project&&(this.paperScope.project.deselectAll(),this.paperScope.view.update(!0),this.destroyCommentPanel())},hide:function(){this.canvas.style.display="none",this.deselectAll()},show:function(){this.canvas.style.display="block"},checkToRemoveFocus:function(){this.currentTool="",this.inEditOrCreateMode&&this.path&&this.removeFocus()},disable:function(){this.disabled=!0,this.inEditOrCreateMode=!1,this.eventEmitter.publish("enableTooltips."+this.windowId),this.deselectAll()},enableEdit:function(){this.disabled=!1,this.inEditOrCreateMode=!0,this.eventEmitter.publish("disableTooltips."+this.windowId)},enable:function(){this.disabled=!1,this.eventEmitter.publish("disableTooltips."+this.windowId)},refresh:function(){this.paperScope.view.update(!0)},destroyCommentPanel:function(){this.eventEmitter.publish("removeTooltips."+this.windowId),jQuery(this.canvas).parents(".mirador-osd").qtip("destroy",!0),this.commentPanel=null},getName:function(tool){return tool.idPrefix+$.genUUID()},getSVGString:function(shapes){var svg="<svg xmlns='http://www.w3.org/2000/svg'>";if(shapes.length>1){svg+="<g>";for(var i=0;i<shapes.length;i++){this.updateSelection(!1,shapes[i]),shapes[i].data.fixedSize&&this.fitFixedSizeShapes(shapes[i]);var anno=shapes[i].data.annotation;shapes[i].data.annotation=null,svg+=shapes[i].exportSVG({asString:!0}),shapes[i].data.annotation=anno}svg+="</g>"}else{this.updateSelection(!1,shapes[0]),shapes[0].data.fixedSize&&this.fitFixedSizeShapes(shapes[0]);var annoSingle=shapes[0].data.annotation;shapes[0].data.annotation=null,svg+=shapes[0].exportSVG({asString:!0}),shapes[0].data.annotation=annoSingle}return svg+="</svg>"},onDrawFinish:function(){var shape=this.path;if(shape){this.inEditOrCreateMode=!0,this.hoveredPath&&this.updateSelection(!1,this.hoveredPath);var newlyCreatedStrokeFactor=this.drawingToolsSettings.newlyCreatedShapeStrokeWidthFactor||5;if(shape.data.newlyCreatedStrokeFactor=newlyCreatedStrokeFactor,shape.data.newlyCreated=!0,shape.strokeWidth=shape.data.strokeWidth*newlyCreatedStrokeFactor,this.hoveredPath=shape,this.segment=null,this.path=null,this.mode="",this.draftPaths.push(shape),shape.data.editable=!0,this.updateSelection(!0,this.hoveredPath),void 0!==this.annoTooltip&&this.annoTooltip||(this.annoTooltip=new $.AnnotationTooltip({targetElement:jQuery(this.canvas).parents(".mirador-osd"),state:this.state,eventEmitter:this.eventEmitter,windowId:this.windowId})),this.availableExternalCommentsPanel)this.eventEmitter.publish("annotationShapeCreated."+this.windowId,[this,shape]);else{var _this=this;void 0!==this.annoEditorVisible&&this.annoEditorVisible||(this.annoTooltip.showEditor({annotation:{},onSaveClickCheck:function(){return _this.draftPaths.length},onAnnotationCreated:function(oaAnno){_this.eventEmitter.publish("onAnnotationCreated."+_this.windowId,[oaAnno])}}),_this.annoEditorVisible=!0)}}},onEditFinish:function(){var _this=this;jQuery.each(this.draftPaths,function(index,value){_this.path.name===value.name&&(_this.draftPaths[index]=_this.path)})},clearDraftData:function(){for(var idx=0;idx<this.draftPaths.length;idx++)this.updateSelection(!1,this.draftPaths[idx]),this.draftPaths[idx].remove();this.draftPaths=[],this.path&&this.path.remove(),this.paperScope.view.update(!0),this.hoveredPath=null,this.segment=null,this.path=null,this.mode=""},destroy:function(){var _this=this;this.eventsSubscriptions.forEach(function(event){_this.eventEmitter.unsubscribe(event.name,event.handler)}),this.viewer.removeHandler("animation",this._thisResize),this.viewer.removeHandler("open",this._thisResize),this.viewer.removeHandler("animation-finish",this._thisResize),this.viewer.removeHandler("update-viewport",this._thisResize),this.viewer.removeHandler("resize",this._thisResize),this.viewer.removeHandler("rotate",this._thisResize),this.viewer.removeHandler("constrain",this._thisResize),this.viewer.removeHandler("close",this._thisDestroy)}}}(Mirador),function($){$.Pin=function(options){jQuery.extend(this,{name:"Pin",logoClass:"room",idPrefix:"pin_",tooltip:"pinTooltip"},options),this.init()},$.Pin.prototype={init:function(){},createShape:function(initialPoint,overlay){overlay.mode="create";var size=overlay.fixedShapeSize,pathData="";pathData+="M"+initialPoint.x+","+initialPoint.y,pathData+=" Q"+initialPoint.x+","+(initialPoint.y-size),pathData+=" "+(initialPoint.x+size)+","+(initialPoint.y-2*size),pathData+=" A"+size+","+size+" 0 1 0",pathData+=" "+(initialPoint.x-size)+","+(initialPoint.y-2*size),pathData+=" Q"+initialPoint.x+","+(initialPoint.y-size),pathData+=" "+initialPoint.x+","+initialPoint.y;var shape=new overlay.paperScope.Path(pathData);return shape.name=overlay.getName(this),shape.dashArray=overlay.dashArray,shape.data.strokeWidth=overlay.strokeWidth,shape.strokeWidth=shape.data.strokeWidth/overlay.paperScope.view.zoom,shape.strokeColor=overlay.strokeColor,shape.fillColor=overlay.fillColor,shape.fillColor.alpha=overlay.fillColorAlpha,shape.closed=!0,overlay.fitFixedSizeShapes(shape),shape},updateSelection:function(selected,item,overlay){-1!==item._name.toString().indexOf(this.idPrefix)&&(selected?(item.strokeColor=overlay.selectedColor,item.data.deleteIcon||(item.data.deleteIcon=new overlay.annotationUtils.DeleteActionIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"delete",fillColor:item.selectedColor}),item.data.deleteIcon.addData("pivot",item.segments[0].point),item.data.deleteIcon.addData("type","deleteIcon"),item.data.deleteIcon.addData("self",item.data.deleteIcon),item.data.deleteIcon.addData("parent",item),item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))),item.data.deleteIcon.setOnMouseDownListener(overlay))):(item.strokeColor=overlay.strokeColor,item.data.deleteIcon&&(item.data.deleteIcon.remove(),item.data.deleteIcon=null)))},onResize:function(item,overlay){-1!==item._name.toString().indexOf(this.partOfPrefix)&&item._name.toString().indexOf("delete")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))),item.data.self.resize(24/overlay.paperScope.view.zoom))},onHover:function(activate,shape,hoverWidth,hoverColor){shape.strokeWidth=hoverWidth,activate&&!shape.data.hovered&&(shape.data.nonHoverStrokeColor=shape.strokeColor.clone(),shape.data.hovered=!0,shape.strokeColor=hoverColor),!activate&&shape.data.hovered&&(shape.strokeColor=shape.data.nonHoverStrokeColor.clone(),delete shape.data.nonHoverStrokeColor,delete shape.data.hovered)},onMouseUp:function(event,overlay){},onMouseDrag:function(event,overlay){"translate"===overlay.mode&&overlay.path&&(overlay.path.position.x+=event.delta.x,overlay.path.position.y+=event.delta.y,overlay.path.data.deleteIcon&&overlay.path.data.deleteIcon.translateByXY(event.delta.x,event.delta.y))},onMouseMove:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);hitResult&&-1!==hitResult.item._name.toString().indexOf(this.idPrefix)&&!overlay.disabled&&overlay.hoveredPath&&-1!==hitResult.item._name.toString().indexOf(overlay.hoveredPath._name.toString())&&this.setCursor(hitResult,overlay)},setCursor:function(hitResult,overlay){"stroke"!==hitResult.type&&"handle-in"!==hitResult.type&&"handle-out"!==hitResult.type&&"segment"!==hitResult.type?"pixel"!==hitResult.type||jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","move")},onMouseDown:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);if(hitResult&&-1!=hitResult.item._name.toString().indexOf(this.idPrefix)){if(-1!==hitResult.item._name.toString().indexOf(this.partOfPrefix))return void hitResult.item.data.self.onMouseDown();"translate"!==overlay.mode&&(overlay.mode="translate",overlay.segment=null,overlay.path=null)}"translate"!==overlay.mode?(overlay.path=this.createShape(event.point,overlay),overlay.onDrawFinish()):overlay.path?(overlay.segment=null,overlay.path=null,overlay.mode=""):overlay.path=hitResult.item},onDoubleClick:function(event,overlay){}}}(Mirador),function($){$.Polygon=function(options){jQuery.extend(this,{name:"Polygon",logoClass:"timeline",idPrefix:"rough_path_",tooltip:"polygonTooltip"},options),this.init()},$.Polygon.prototype={init:function(){},createShape:function(initialPoint,overlay){overlay.mode="create";var shape=new overlay.paperScope.Path({segments:[initialPoint],dashArray:overlay.dashArray,strokeColor:overlay.strokeColor,name:overlay.getName(this)});return shape.data.strokeWidth=overlay.strokeWidth,shape.strokeWidth=shape.data.strokeWidth/overlay.paperScope.view.zoom,shape},updateSelection:function(selected,item,overlay){-1!=item._name.toString().indexOf(this.idPrefix)&&(item.selected=selected,selected?item.data.deleteIcon||"create"===overlay.mode||(item.data.deleteIcon=new overlay.annotationUtils.DeleteActionIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"delete",fillColor:item.selectedColor}),item.data.deleteIcon.addData("pivot",new overlay.paperScope.Point(this.getPivotPointForDeleteIcon(item))),item.data.deleteIcon.addData("type","deleteIcon"),item.data.deleteIcon.addData("self",item.data.deleteIcon),item.data.deleteIcon.addData("parent",item),item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))),item.data.deleteIcon.setOnMouseDownListener(overlay)):item.data.deleteIcon&&(item.data.deleteIcon.remove(),item.data.deleteIcon=null))},onResize:function(item,overlay){-1!==item._name.toString().indexOf(this.partOfPrefix)&&-1!==item._name.toString().indexOf("delete")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))),item.data.self.resize(24/overlay.paperScope.view.zoom))},getPivotPointForDeleteIcon:function(item){for(var points=[],i=0;i<item.segments.length;i++)points.push(item.segments[i].point);return{x:this.getGeometricCenterOfPoints(points).x,y:this.getLowestPoint(points).y}},getLowestPoint:function(points){for(var lx=0,ly=0,i=0;i<points.length;i++)lx=Math.max(lx,points[i].x),ly=Math.max(ly,points[i].y);return{x:lx,y:ly}},getGeometricCenterOfPoints:function(points){for(var cx=0,cy=0,i=0;i<points.length;i++)cx+=points[i].x,cy+=points[i].y;return{x:cx/points.length,y:cy/points.length}},onHover:function(activate,shape,hoverWidth,hoverColor){shape.strokeWidth=hoverWidth,activate&&!shape.data.hovered&&(shape.data.nonHoverStrokeColor=shape.strokeColor.clone(),shape.data.hovered=!0,shape.strokeColor=hoverColor),!activate&&shape.data.hovered&&(shape.strokeColor=shape.data.nonHoverStrokeColor.clone(),delete shape.data.nonHoverStrokeColor,delete shape.data.hovered)},onMouseUp:function(event,overlay){},onMouseDrag:function(event,overlay){if("deform"===overlay.mode&&overlay.segment){overlay.segment.point.x+=event.delta.x,overlay.segment.point.y+=event.delta.y;var path=overlay.segment.path;path.data.deleteIcon&&(path.data.deleteIcon.addData("pivot",new overlay.paperScope.Point(this.getPivotPointForDeleteIcon(path))),path.data.deleteIcon.setPosition(path.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom))))}else"translate"===overlay.mode&&overlay.path&&(overlay.path.position.x+=event.delta.x,overlay.path.position.y+=event.delta.y,overlay.path.data.deleteIcon&&overlay.path.data.deleteIcon.translateByXY(event.delta.x,event.delta.y))},onMouseMove:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);hitResult&&-1!==hitResult.item._name.toString().indexOf(this.idPrefix)&&!overlay.disabled&&overlay.hoveredPath&&-1!==hitResult.item._name.toString().indexOf(overlay.hoveredPath._name.toString())&&this.setCursor(hitResult,overlay)},setCursor:function(hitResult,overlay){"stroke"!==hitResult.type?"handle-in"!==hitResult.type&&"handle-out"!==hitResult.type&&"pixel"!==hitResult.type?hitResult.segment&&jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","move")},onMouseDown:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);if(hitResult&&-1!==hitResult.item._name.toString().indexOf(this.idPrefix)){if(-1!==hitResult.item._name.toString().indexOf(this.partOfPrefix))return void hitResult.item.data.self.onMouseDown();if("create"!==overlay.mode){if(overlay.path?document.body.style.cursor="default":(overlay.mode="edit",overlay.segment=null,overlay.path=null,document.body.style.cursor="move"),"stroke"===hitResult.type)return overlay.mode="translate",void(overlay.path=hitResult.item);if("segment"===hitResult.type)return event.modifiers.shift&&hitResult.item.segments.length>2?void hitResult.segment.remove():(overlay.mode="deform",overlay.segment=hitResult.segment,void(overlay.path=hitResult.item))}}else"create"!==overlay.mode&&(overlay.mode="");""!==overlay.mode?"create"!==overlay.mode||overlay.path.add(event.point):overlay.path=this.createShape(event.point,overlay)},onDoubleClick:function(event,overlay){"create"===overlay.mode&&overlay.path&&overlay.path.segments.length>1&&(overlay.path.segments[0].point.getDistance(overlay.path.segments[overlay.path.segments.length-1].point)*overlay.paperScope.view.zoom<overlay.hitOptions.tolerance&&(overlay.path.closed=!0,overlay.path.fillColor=overlay.fillColor,overlay.path.fillColor.alpha=overlay.fillColorAlpha,overlay.path.segments[overlay.path.segments.length-1].remove()),overlay.onDrawFinish())}}}(Mirador),function($){$.Rectangle=function(options){jQuery.extend(this,{name:"Rectangle",logoClass:"check_box_outline_blank",idPrefix:"rectangle_",tooltip:"rectangleTooltip"},options),this.init()},$.Rectangle.prototype={init:function(){this.SEGMENT_POINTS_COUNT=9},createShape:function(initialPoint,overlay){overlay.mode="create";var segments=this._createSegments(initialPoint,overlay),shape=new overlay.paperScope.Path({segments:segments,fullySelected:!0,name:overlay.getName(this)});return shape.dashArray=overlay.dashArray,shape.data.strokeWidth=overlay.strokeWidth,shape.strokeWidth=shape.data.strokeWidth/overlay.paperScope.view.zoom,shape.strokeColor=overlay.strokeColor,shape.fillColor=overlay.fillColor,shape.fillColor.alpha=overlay.fillColorAlpha,shape.closed=!0,shape.data.rotation=0,overlay.segment=shape.segments[5],this.updateSelection(!0,shape,overlay),shape},_createSegments:function(initialPoint,overlay){var segments=[];return segments.push(new overlay.paperScope.Point(initialPoint.x-2,initialPoint.y-2)),segments.push(new overlay.paperScope.Point(initialPoint.x-1,initialPoint.y-2)),segments.push(new overlay.paperScope.Point(initialPoint.x-1,initialPoint.y-2)),segments.push(new overlay.paperScope.Point(initialPoint.x,initialPoint.y-2)),segments.push(new overlay.paperScope.Point(initialPoint.x,initialPoint.y-1)),segments.push(new overlay.paperScope.Point(initialPoint.x,initialPoint.y)),segments.push(new overlay.paperScope.Point(initialPoint.x-1,initialPoint.y)),segments.push(new overlay.paperScope.Point(initialPoint.x-2,initialPoint.y)),segments.push(new overlay.paperScope.Point(initialPoint.x-2,initialPoint.y-1)),segments},updateSelection:function(selected,item,overlay){if(-1!=item._name.toString().indexOf(this.idPrefix)){if(-1!=item._name.toString().indexOf(this.partOfPrefix))return;if(item.selected=selected,selected){item.data.deleteIcon||(item.data.deleteIcon=new overlay.annotationUtils.DeleteActionIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"delete",fillColor:item.selectedColor}),item.data.deleteIcon.addData("pivot",item.segments[6].point),item.data.deleteIcon.addData("type","deleteIcon"),item.data.deleteIcon.addData("self",item.data.deleteIcon),item.data.deleteIcon.addData("parent",item),item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.deleteIcon.setOnMouseDownListener(overlay)),item.data.rotationIcon||(item.data.rotationIcon=new overlay.annotationUtils.RotationIcon(overlay.paperScope,{name:item.name+this.partOfPrefix+"rotation",fillColor:item.selectedColor}),item.data.rotationIcon.addData("pivot",item.segments[1].point),item.data.rotationIcon.addData("type","rotationIcon"),item.data.rotationIcon.addData("self",item.data.rotationIcon),item.data.rotationIcon.addData("parent",item),item.data.rotationIcon.setPosition(item.data.rotationIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.rotationIcon.setOnMouseDownListener(overlay)),item.data.group||(item.data.group=new overlay.annotationUtils.Group(overlay.paperScope,[item,item.data.deleteIcon.getItem(),item.data.deleteIcon.getMask().getItem(),item.data.rotationIcon.getItem(),item.data.rotationIcon.getMask().getItem()]));var point=item.segments[1].point.clone();point=point.add(item.segments[1].handleOut),item.contains(point)&&(item.segments[1].handleOut=item.segments[1].handleOut.rotate(180,item.segments[1])),item.contains(item.data.deleteIcon.getItem().position)&&(item.data.deleteIcon.setPosition(item.data.deleteIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.deleteIcon.rotate(180,item.data.deleteIcon.getData("pivot")),item.data.deleteIcon.rotate(180)),item.contains(item.data.rotationIcon.getItem().position)&&(item.data.rotationIcon.setPosition(item.data.rotationIcon.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.rotation))),item.data.rotationIcon.rotate(180,item.data.rotationIcon.getData("pivot")),item.data.rotationIcon.rotate(180)),item.segments[1].handleOut.selected=!1}else item.data.group&&(item.data.group.remove(),item.data.group=null,overlay.paperScope.project.activeLayer.addChild(item)),item.data.deleteIcon&&(item.data.deleteIcon.remove(),item.data.deleteIcon=null),item.data.rotationIcon&&(item.data.rotationIcon.remove(),item.data.rotationIcon=null),item.segments[1].handleOut=new overlay.paperScope.Point(0,0)}},onHover:function(activate,shape,hoverWidth,hoverColor){shape.strokeWidth=hoverWidth,activate&&!shape.data.hovered&&(shape.data.nonHoverStrokeColor=shape.strokeColor.clone(),shape.data.hovered=!0,shape.strokeColor=hoverColor),!activate&&shape.data.hovered&&(shape.strokeColor=shape.data.nonHoverStrokeColor.clone(),delete shape.data.nonHoverStrokeColorColor,delete shape.data.hovered)},adaptSegments:function(shape,overlay){var handleSegment=shape.segments[1].clone();shape.segments.splice(1,0,handleSegment)},onMouseUp:function(event,overlay){"create"===overlay.mode&&overlay.path?overlay.onDrawFinish():("translate"===overlay.mode||"deform"===overlay.mode&&overlay.path)&&overlay.onEditFinish()},translate:function(event,overlay){for(var i=0;i<overlay.path.segments.length;i++)overlay.path.segments[i].point.x+=event.delta.x,overlay.path.segments[i].point.y+=event.delta.y;overlay.path.data.rotationIcon.translateByXY(event.delta.x,event.delta.y),overlay.path.data.deleteIcon.translateByXY(event.delta.x,event.delta.y)},rotate:function(event,overlay){var center=overlay.path.position,rotation=Math.atan2(event.point.y-center.y+event.delta.y,event.point.x-center.x+event.delta.x)-Math.atan2(event.point.y-center.y,event.point.x-center.x);rotation*=180/Math.PI,overlay.path.data.group.rotate(rotation,overlay.path.position),overlay.path.data.deleteIcon.rotate(-rotation),overlay.path.data.rotationIcon.rotate(-rotation),overlay.path.data.rotation+=rotation},onMouseDrag:function(event,overlay){if("translate"!=overlay.mode)if("rotate"!==overlay.mode){if("create"==overlay.mode||"deform"==overlay.mode){for(var idx=-1,l=0;l<overlay.path.segments.length;l++)if(overlay.path.segments[l]==overlay.segment){idx=l;break}var translation=new overlay.paperScope.Point(event.delta.x,event.delta.y),rot=overlay.path.data.rotation;translation=translation.rotate(-rot);var translationX=new overlay.paperScope.Point(translation.x,0);translationX=translationX.rotate(rot);var translationY=new overlay.paperScope.Point(0,translation.y);translationY=translationY.rotate(rot);var moveTopSize=0===idx||1===idx||2===idx||3===idx,moveBottomSize=5===idx||6===idx||7===idx,moveRightSize=3===idx||4===idx||5===idx,moveLeftSize=0===idx||7===idx||8===idx;moveTopSize&&(overlay.path.data.rotationIcon.translateByPoint(translationY),overlay.path.segments[0].point=overlay.path.segments[0].point.add(translationY),overlay.path.segments[1].point=overlay.path.segments[1].point.add(translationY),overlay.path.segments[2].point=overlay.path.segments[2].point.add(translationY),overlay.path.segments[3].point=overlay.path.segments[3].point.add(translationY)),moveBottomSize&&(overlay.path.data.deleteIcon.translateByPoint(translationY),overlay.path.segments[5].point=overlay.path.segments[5].point.add(translationY),overlay.path.segments[6].point=overlay.path.segments[6].point.add(translationY),overlay.path.segments[7].point=overlay.path.segments[7].point.add(translationY)),(moveTopSize||moveBottomSize)&&(translationY=translationY.multiply(.5),overlay.path.segments[4].point=overlay.path.segments[4].point.add(translationY),overlay.path.segments[8].point=overlay.path.segments[8].point.add(translationY)),moveRightSize&&(overlay.path.segments[3].point=overlay.path.segments[3].point.add(translationX),overlay.path.segments[4].point=overlay.path.segments[4].point.add(translationX),overlay.path.segments[5].point=overlay.path.segments[5].point.add(translationX)),moveLeftSize&&(overlay.path.segments[0].point=overlay.path.segments[0].point.add(translationX),overlay.path.segments[7].point=overlay.path.segments[7].point.add(translationX),overlay.path.segments[8].point=overlay.path.segments[8].point.add(translationX)),(moveRightSize||moveLeftSize)&&(translationX=translationX.multiply(.5),overlay.path.data.rotationIcon.translateByPoint(translationX),overlay.path.data.deleteIcon.translateByPoint(translationX),overlay.path.segments[1].point=overlay.path.segments[1].point.add(translationX),overlay.path.segments[2].point=overlay.path.segments[2].point.add(translationX),overlay.path.segments[6].point=overlay.path.segments[6].point.add(translationX));var point=overlay.path.segments[1].point.clone();point=point.add(overlay.path.segments[1].handleOut),overlay.path.contains(point)&&(overlay.path.segments[1].handleOut=overlay.path.segments[1].handleOut.rotate(180,overlay.path.segments[1])),overlay.path.contains(overlay.path.data.deleteIcon.getItem().position)&&(overlay.path.data.deleteIcon.rotate(180,overlay.path.data.deleteIcon.getData("pivot")),overlay.path.data.deleteIcon.rotate(180)),overlay.path.contains(overlay.path.data.rotationIcon.getItem().position)&&(overlay.path.data.rotationIcon.rotate(180,overlay.path.data.rotationIcon.getData("pivot")),overlay.path.data.rotationIcon.rotate(180))}}else this.rotate(event,overlay);else this.translate(event,overlay)},onResize:function(item,overlay){-1!==item._name.toString().indexOf(this.partOfPrefix)&&(-1!==item._name.toString().indexOf("delete")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.parent.data.rotation))),item.data.parent.contains(item.position)&&(item.data.self.rotate(180,item.data.self.getData("pivot")),item.data.self.rotate(180)),item.data.self.resize(24/overlay.paperScope.view.zoom)),-1!==item._name.toString().indexOf("rotation")&&(item.data.self.setPosition(item.data.self.getData("pivot").add(new overlay.paperScope.Point(0,21/overlay.paperScope.view.zoom).rotate(item.data.parent.data.rotation))),item.data.parent.contains(item.position)&&(item.data.self.rotate(180,item.data.self.getData("pivot")),item.data.self.rotate(180)),item.data.self.resize(16/overlay.paperScope.view.zoom)))},onMouseMove:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);hitResult&&-1!==hitResult.item._name.toString().indexOf(this.idPrefix)&&!overlay.disabled&&overlay.hoveredPath&&-1!==hitResult.item._name.toString().indexOf(overlay.hoveredPath._name.toString())&&this.setCursor(hitResult,overlay)},setCursor:function(hitResult,overlay){"stroke"!==hitResult.type?"pixel"!==hitResult.type?hitResult.segment&&jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","pointer"):jQuery(overlay.viewer.canvas).css("cursor","move")},onMouseDown:function(event,overlay){var hitResult=overlay.paperScope.project.hitTest(event.point,overlay.hitOptions);if(hitResult&&-1!=hitResult.item._name.toString().indexOf(this.idPrefix)&&"deform"!==overlay.mode&&"translate"!==overlay.mode&&"create"!==overlay.mode){if(-1!==hitResult.item._name.toString().indexOf(this.partOfPrefix))return hitResult.item.data.self.onMouseDown(),void("rotate"===overlay.mode&&(overlay.path=hitResult.item.data.self.getItem().data.parent));"segment"===hitResult.type&&(overlay.mode="deform",overlay.segment=null,overlay.path=null,this.setCursor(hitResult,overlay)),"stroke"===hitResult.type&&(overlay.mode="translate",overlay.segment=null,overlay.path=null)}"translate"!==overlay.mode?"deform"!==overlay.mode?overlay.path=this.createShape(event.point,overlay):overlay.path?(overlay.segment=null,overlay.path=null,overlay.mode=""):(overlay.path=hitResult.item,overlay.segment=hitResult.segment):overlay.path?(overlay.segment=null,overlay.path=null,overlay.mode=""):overlay.path=hitResult.item},onDoubleClick:function(event,overlay){}}}(Mirador),function($){$.SimpleASEndpoint=function(options){jQuery.extend(this,{token:null,uri:null,url:options.url,dfd:null,annotationsList:[],idMapper:{}},options),this.init()},$.SimpleASEndpoint.prototype={init:function(){this.catchOptions={user:{id:this.userid,name:this.username},permissions:{read:[],update:[this.userid],delete:[this.userid],admin:[this.userid]}}},search:function(options,successCallback,errorCallback){var _this=this;this.annotationsList=[],jQuery.ajax({url:_this.url+"/search",cache:!1,type:"GET",dataType:"json",headers:{},data:{uri:options.uri,APIKey:_this.APIKey,media:"image",limit:1e4},contentType:"application/json; charset=utf-8",success:function(data){_this.annotationsList=data,jQuery.each(_this.annotationsList,function(index,value){value.fullId=value["@id"],value["@id"]=$.genUUID(),_this.idMapper[value["@id"]]=value.fullId,value.endpoint=_this,_this.fixOn(value)}),"function"==typeof successCallback?successCallback(data):_this.dfd.resolve(!0)},error:function(xhr,statusText,err){"function"==typeof errorCallback?errorCallback():(_this.dfd.reject(),console.log("The request for annotations has caused an error for endpoint: "+options.uri+" due to "+statusText))}})},fixOn:function(annotation){var oldOn;annotation&&annotation.on&&!jQuery.isArray(annotation.on)&&annotation.on.selector&&annotation.on.selector.default&&(oldOn=annotation.on,annotation.on=[oldOn])},deleteAnnotation:function(annotationID,returnSuccess,returnError){jQuery.ajax({url:this.url+"/destroy?uri="+encodeURIComponent(this.idMapper[annotationID])+"&APIKey="+this.APIKey,type:"DELETE",dataType:"json",headers:{},data:{uri:annotationID},contentType:"application/json; charset=utf-8",success:function(data){"function"==typeof returnSuccess&&returnSuccess()},error:function(xhr,statusText,err){"function"==typeof returnError?returnError():console.log("Failed to delete annotation "+annotationID+" due to "+statusText)}})},update:function(oaAnnotation,returnSuccess,returnError){var annotation=oaAnnotation,_this=this,shortId=annotation["@id"];annotation.fullId;annotation["@id"]=annotation.fullId,delete annotation.fullId,delete annotation.endpoint,jQuery.ajax({url:_this.url+"/update?APIKey="+_this.APIKey,type:"POST",dataType:"json",headers:{},data:JSON.stringify(annotation),contentType:"application/json; charset=utf-8",success:function(data){_this.fixOn(data),"function"==typeof returnSuccess&&returnSuccess(data)},error:function(xhr,statusText,err){"function"==typeof returnError?returnError():console.log("Failed to update annotation: "+oaAnnotation["@id"]+" due to "+statusText)}}),annotation.endpoint=_this,annotation.fullId=annotation["@id"],annotation["@id"]=shortId},create:function(oaAnnotation,returnSuccess,returnError){var annotation=oaAnnotation,_this=this;jQuery.ajax({url:_this.url+"/create?APIKey="+_this.APIKey,type:"POST",dataType:"json",headers:{},data:JSON.stringify(annotation),contentType:"application/json; charset=utf-8",success:function(data){data.fullId=data["@id"],data["@id"]=$.genUUID(),data.endpoint=_this,_this.idMapper[data["@id"]]=data.fullId,_this.fixOn(data),"function"==typeof returnSuccess&&returnSuccess(data)},error:function(xhr,statusText,err){"function"==typeof returnError?returnError():console.log("Failed to create annotation: "+oaAnnotation["@id"]+" due to "+statusText)}})},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value},userAuthorize:function(action,annotation){return!0}}}(Mirador),function($){$.TinyMCEAnnotationBodyEditor=function(options){jQuery.extend(this,{annotation:null,windowId:null,config:{plugins:"",toolbar:"",tags:[]}},options),this.init()},$.TinyMCEAnnotationBodyEditor.prototype={init:function(){var annoText="",selectedTags=[],tags=[];jQuery.isEmptyObject(this.annotation)||(jQuery.isArray(this.annotation.resource)?jQuery.each(this.annotation.resource,function(index,value){"oa:Tag"===value["@type"]?selectedTags.push(value.chars):annoText=value.chars}):annoText=this.annotation.resource.chars),(this.config.tags||[]).forEach(function(item){selectedTags.indexOf(item)<0&&tags.push(item)}),tags=tags.concat(selectedTags),this.editorMarkup=this.editorTemplate({content:annoText,selectedTags:selectedTags,tags:tags,windowId:this.windowId})},show:function(selector){this.editorContainer=jQuery(selector).prepend(this.editorMarkup),tinymce.init({selector:selector+" textarea",plugins:this.config.plugins,menubar:!1,statusbar:!1,toolbar_items_size:"small",toolbar:this.config.toolbar,default_link_target:"_blank",setup:function(editor){editor.on("init",function(args){tinymce.execCommand("mceFocus",!1,args.target.id),jQuery(".tags-editor").select2({tags:!0,placeholder:"Add tags here..."})})}})},isDirty:function(){return tinymce.activeEditor.isDirty()},createAnnotation:function(){var tags=this.editorContainer.find(".tags-editor").val(),resourceText=tinymce.activeEditor.getContent(),motivation=[],resource=[];return tags&&tags.length>0&&(motivation.push("oa:tagging"),jQuery.each(tags,function(index,value){resource.push({"@type":"oa:Tag",chars:value})})),motivation.push("oa:commenting"),resource.push({"@type":"dctypes:Text",format:"text/html",chars:resourceText}),{"@context":"http://iiif.io/api/presentation/2/context.json","@type":"oa:Annotation",motivation:motivation,resource:resource}},updateAnnotation:function(oaAnno){var selectedTags=this.editorContainer.find(".tags-editor").val(),resourceText=tinymce.activeEditor.getContent();oaAnno.motivation=jQuery.grep(oaAnno.motivation,function(value){return"oa:tagging"!==value}),oaAnno.resource=jQuery.grep(oaAnno.resource,function(value){return"oa:Tag"!==value["@type"]}),selectedTags.length>0&&(oaAnno.motivation.push("oa:tagging"),jQuery.each(selectedTags,function(index,value){oaAnno.resource.push({"@type":"oa:Tag",chars:value})})),jQuery.each(oaAnno.resource,function(index,value){"dctypes:Text"===value["@type"]&&(value.chars=resourceText)})},editorTemplate:$.Handlebars.compile(['<textarea class="text-editor" placeholder="{{t "comments"}}…">{{#if content}}{{content}}{{/if}}</textarea>','<select id="tags-editor-{{windowId}}" class="tags-editor" multiple="true">{{#each tags}}','<option value="{{this}}" {{#ifContains ../selectedTags this }}selected="selected"{{/ifContains}}>{{this}}</option>',"{{/each}}</select>"].join(""))},$.Handlebars.registerHelper("ifContains",function(array,value,options){return(array=array instanceof Array?array:[array]).indexOf(value)>-1?options.fn(this):""})}(Mirador),function($){$.Slot=function(options){jQuery.extend(!0,this,{workspaceSlotCls:"slot",slotID:null,layoutAddress:null,focused:null,appendTo:null,window:null,windowElement:null,state:null,eventEmitter:null},options),this.init()},$.Slot.prototype={init:function(){this.events=[],this.element=jQuery(this.template({workspaceSlotCls:this.workspaceSlotCls,slotID:this.slotId})),this.element.appendTo(this.appendTo),this.bindEvents(),this.listenForActions()},listenForActions:function(){var _this=this;this.events=[_this.eventEmitter.subscribe("slotRemoved",function(event,slot){_this.slotID===slot.slotID&&_this.clearSlot()}),_this.eventEmitter.subscribe("layoutChanged",function(event,layoutRoot){_this.window&&(_this.window.slotAddress=_this.layoutAddress,_this.eventEmitter.publish("windowSlotAddressUpdated",{id:_this.window.id,slotAddress:_this.window.slotAddress}))}),_this.eventEmitter.subscribe("HIDE_REMOVE_SLOT",function(event){_this.element.find(".remove-slot-option").hide(),_this.window&&_this.eventEmitter.publish("HIDE_REMOVE_OBJECT."+_this.window.id)}),_this.eventEmitter.subscribe("SHOW_REMOVE_SLOT",function(event){_this.element.find(".remove-slot-option").show(),_this.window&&_this.eventEmitter.publish("SHOW_REMOVE_OBJECT."+_this.window.id)}),_this.eventEmitter.subscribe("ADD_ITEM_FROM_WINDOW",function(event,id){_this.window&&_this.window.id===id&&_this.addItem()}),_this.eventEmitter.subscribe("REMOVE_SLOT_FROM_WINDOW",function(event,id){_this.window&&_this.window.id===id&&_this.eventEmitter.publish("REMOVE_NODE",_this)}),_this.eventEmitter.subscribe("SPLIT_RIGHT_FROM_WINDOW",function(event,id){_this.window&&_this.window.id===id&&_this.eventEmitter.publish("SPLIT_RIGHT",_this)}),_this.eventEmitter.subscribe("SPLIT_LEFT_FROM_WINDOW",function(event,id){_this.window&&_this.window.id===id&&_this.eventEmitter.publish("SPLIT_LEFT",_this)}),_this.eventEmitter.subscribe("SPLIT_DOWN_FROM_WINDOW",function(event,id){_this.window&&_this.window.id===id&&_this.eventEmitter.publish("SPLIT_DOWN",_this)}),_this.eventEmitter.subscribe("SPLIT_UP_FROM_WINDOW",function(event,id){_this.window&&_this.window.id===id&&_this.eventEmitter.publish("SPLIT_UP",_this)})]},bindEvents:function(){var _this=this,dropTarget=this.element.find(".dropMask");this.element.find(".addItemLink").on("click",function(){_this.addItem()}),this.element.find(".remove-slot-option").on("click",function(){_this.eventEmitter.publish("REMOVE_NODE",_this)}),this.element.on("dragover",function(e){e.preventDefault(),dropTarget.show()}),dropTarget.on("dragenter",function(e){e.preventDefault(),_this.element.addClass("draggedOver")}),dropTarget.on("dragleave",function(e){e.preventDefault(),_this.element.removeClass("draggedOver"),dropTarget.hide()}),this.element.on("drop",function(e){_this.dropItem(e)})},dropItem:function(e){var _this=this;e.preventDefault();var text_url=e.originalEvent.dataTransfer.getData("text/plain");text_url?_this.handleDrop(text_url):e.originalEvent.dataTransfer.items[0].getAsString(function(url){_this.handleDrop(url)})},handleDrop:function(url){var _this=this;url=url||text_url;var windowConfig,manifestUrl=$.getQueryParams(url).manifest||url,collectionUrl=$.getQueryParams(url).collection,canvasId=$.getQueryParams(url).canvas,imageInfoUrl=$.getQueryParams(url).image;void 0!==_this.state.getStateProperty("manifests")[manifestUrl]?(windowConfig={manifest:_this.state.getStateProperty("manifests")[manifestUrl],slotAddress:_this.getAddress()},canvasId&&(windowConfig.canvasID=canvasId,windowConfig.viewType="ImageView"),_this.eventEmitter.publish("ADD_WINDOW",windowConfig)):void 0!==imageInfoUrl?_this.state.getStateProperty("manifests")[imageInfoUrl]||_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[imageInfoUrl,"(Added from URL)"]):void 0!==collectionUrl?(jQuery.getJSON(collectionUrl).done(function(data,status,jqXHR){data.hasOwnProperty("manifests")?jQuery.each(data.manifests,function(ci,mfst){_this.state.getStateProperty("manifests")[imageInfoUrl]||_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[mfst["@id"],"(Added from URL)"])}):data.hasOwnProperty("members")&&jQuery.each(data.members,function(ci,mfst){_this.state.getStateProperty("manifests")[imageInfoUrl]||_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[mfst["@id"],"(Added from URL)"])})}),_this.addItem()):_this.state.getStateProperty("manifests")[imageInfoUrl]||_this.eventEmitter.publish("ADD_MANIFEST_FROM_URL",[manifestUrl,"(Added from URL)"]),_this.eventEmitter.subscribe("manifestReceived",function(event,manifest){var windowConfig;manifest.jsonLd["@id"]!==manifestUrl&&manifest.jsonLd["@id"]+"/info.json"!==imageInfoUrl||(windowConfig={manifest:manifest,slotAddress:_this.getAddress()},manifest.jsonLd["@id"]+"/info.json"===imageInfoUrl&&(canvasId=manifest.jsonLd.sequences[0].canvases[0]["@id"]),canvasId&&(windowConfig.canvasID=canvasId,windowConfig.viewType="ImageView"),_this.eventEmitter.publish("ADD_WINDOW",windowConfig))})},destroyEvents:function(){var _this=this;this.events.forEach(function(event){_this.eventEmitter.unsubscribe(event.name,event.handler)})},clearSlot:function(){this.destroyEvents(),this.window&&delete this.window},getAddress:function(){return this.layoutAddress},addItem:function(){this.focused=!0,this.eventEmitter.publish("ADD_SLOT_ITEM",this)},template:$.Handlebars.compile(['<div id="{{slotID}}" class="{{workspaceSlotCls}}">','<a class="remove-slot-option"><i class="fa fa-times fa-lg fa-fw"></i> {{t "close"}}</a>','<div class="slotIconContainer">','<h1 class="plus" role="presentation" aria-label="Add item using Link">',"<span>+</span>",'<div class="dropIcon">','<i class="fa fa-level-down"></i>',"</div>","</h1>",'<h1 class="addItemText">{{t "addItem"}}</h1>','<h1 class="dropMeMessage">{{t "dropToLoad"}}</h1>',"</div>",'<a class="addItemLink" role="button" aria-label="Add item"></a>','<a class="dropMask"></a>',"</div>"].join(""))}}(Mirador),function($){$.Window=function(options){jQuery.extend(this,{state:null,eventEmitter:null,element:null,scrollImageRatio:.9,canvasID:null,currentCanvasModel:null,focusImages:[],imagesList:null,canvasModels:null,annotationsList:[],endpoint:null,currentImageMode:"ImageView",imageModes:["ImageView","BookView"],originalImageModes:["ImageView","BookView"],focuses:["ThumbnailsView","ImageView","ScrollView","BookView"],focusModules:{ThumbnailsView:null,ImageView:null,ScrollView:null,BookView:null},focusOverlaysAvailable:{ThumbnailsView:{overlay:{MetadataView:!1},bottomPanel:{"":!1}},ImageView:{overlay:{MetadataView:!1},bottomPanel:{ThumbnailsView:!0}},ScrollView:{overlay:{MetadataView:!1},bottomPanel:{"":!1}},BookView:{overlay:{MetadataView:!1},bottomPanel:{ThumbnailsView:!0}}},windowOptions:null,sidePanel:null,annotationsAvailable:{ThumbnailsView:!1,ImageView:!0,ScrollView:!1,BookView:!1},bottomPanel:null,overlay:null,annoEndpointAvailable:!1,iconClasses:{ImageView:"fa fa-photo fa-lg fa-fw",BookView:"fa fa-columns fa-lg fa-fw",ScrollView:"fa fa-ellipsis-h fa-lg fa-fw",ThumbnailsView:"fa fa-th fa-lg fa-rotate-90 fa-fw"},userButtons:null},options),this.init(),this.bindAnnotationEvents()},$.Window.prototype={init:function(){var _this=this,manifest=_this.manifest.jsonLd,focusState=_this.viewType,templateData={};for(this.events=[];_this.annotationsList.length>0;)_this.annotationsList.pop();switch(_this.eventEmitter.unsubscribe("currentCanvasIDUpdated."+_this.id),_this.eventEmitter.publish("DESTROY_EVENTS."+_this.id),_this.removeBookView(),"right-to-left"==_this.manifest.getViewingDirection()?_this.vDirectionStatus="rtl":_this.vDirectionStatus="",this.imageModes=this.originalImageModes,this.imageModes=jQuery.map(this.imageModes,function(value,index){return-1===jQuery.inArray(value,_this.focuses)?null:value}),_this.imagesList=_this.manifest.getCanvases(),1===_this.imagesList.length&&(_this.bottomPanelVisible=!1),_this.canvasID||(_this.canvasID=_this.imagesList[0]["@id"]),_this.canvases=_this.buildCanvasesIndex(_this.manifest.getCanvases()),"rtl"==_this.vDirectionStatus?(_this.imagesListLtr=_this.imagesList.concat(),_this.imagesListRtl=_this.imagesList.concat(),_this.imagesListRtl.reverse()):(_this.imagesListRtl=[],_this.imagesListLtr=[]),this.annoEndpointAvailable=!jQuery.isEmptyObject(_this.state.getStateProperty("annotationEndpoint")),this.canvasControls.annotations.annotationLayer||(this.canvasControls.annotations.annotationCreation=!1,this.annoEndpointAvailable=!1,this.canvasControls.annotations.annotationState="off"),_this.getAnnotations(),this.canvasControls.imageManipulation.manipulationLayer&&(this.canvasControls.imageManipulation.manipulationLayer=!Object.keys(this.canvasControls.imageManipulation.controls).every(function(element,index,array){return!1===_this.canvasControls.imageManipulation.controls[element]})),_this.eventEmitter.publish("windowUpdated",{id:_this.id,annotationsAvailable:this.annotationsAvailable}),void 0===this.bottomPanelAvailable||this.bottomPanelAvailable||jQuery.each(this.focusOverlaysAvailable,function(key,value){_this.focusOverlaysAvailable[key].bottomPanel={"":!1}}),templateData.sidePanel=this.sidePanelAvailable,this.sidePanelAvailable&&(templateData.sidePanel=!Object.keys(this.sidePanelOptions).every(function(element,index,array){return!1===_this.sidePanelOptions[element]})),void 0===this.overlayAvailable||this.overlayAvailable?templateData.MetadataView=!0:jQuery.each(this.focusOverlaysAvailable,function(key,value){_this.focusOverlaysAvailable[key].overlay={"":!1}}),templateData.iconClasses={},jQuery.each(this.focuses,function(index,value){templateData[value]=!0,templateData.iconClasses[value]=_this.iconClasses[value]}),templateData.title=$.JsonLd.getTextValue(manifest.label),templateData.displayLayout=this.displayLayout,templateData.layoutOptions=this.layoutOptions,this.displayLayout&&(templateData.displayLayout=!Object.keys(this.layoutOptions).every(function(element,index,array){return!1===_this.layoutOptions[element]})),templateData.currentFocusClass=_this.iconClasses[_this.viewType],templateData.showFullScreen=_this.fullScreen,templateData.userButtons=_this.userButtons,_this.element=jQuery(this.template(templateData)).appendTo(_this.appendTo),this.element.find(".manifest-info .mirador-tooltip").each(function(){jQuery(this).qtip({content:{text:jQuery(this).attr("title")},position:{my:"top center",at:"bottom center",adjust:{method:"shift",y:-11},container:_this.element,viewport:!0},style:{classes:"qtip-dark qtip-shadow qtip-rounded"}})}),this.element.find(".manifest-info .window-manifest-title").qtip({content:{text:jQuery(this).attr("title")},position:{my:"top center",at:"bottom left",adjust:{method:"shift",x:20,y:1},container:_this.element,viewport:!0},style:{classes:"qtip-dark qtip-shadow qtip-rounded"}}),_this.eventEmitter.publish("WINDOW_ELEMENT_UPDATED",{windowId:_this.id,element:_this.element}),_this.clearViews(),_this.clearPanelsAndOverlay(),this.listenForActions(),_this.bindNavigation(),focusState){case"ThumbnailsView":_this.toggleThumbnails(_this.canvasID);break;case"ImageView":_this.toggleImageView(_this.canvasID);break;case"BookView":_this.toggleBookView(_this.canvasID);break;case"ScrollView":_this.toggleScrollView(_this.canvasID)}_this.state.getSlots().length<=1&&_this.element.find(".remove-object-option").hide(),this.bindEvents(),this.bottomPanelVisibility(this.bottomPanelVisible),this.sidePanelVisibility(this.sidePanelVisible,"0s"),this.events.push(this.eventEmitter.subscribe("windowRemoved",function(event,id){_this.id===id&&_this.destroy()}))},buildCanvasesIndex:function(canvases){var _this=this;return canvases.reduce(function(canvasesIndex,canvas,index){var canvasEmitter=new $.EventEmitter;canvasEmitter.on=canvasEmitter.subscribe.bind(canvasEmitter),canvasEmitter.off=canvasEmitter.unsubscribe.bind(canvasEmitter),canvasEmitter.emit=canvasEmitter.publish.bind(canvasEmitter),canvasEmitter.subscribe("image-status-updated",function(event,imageResource){_this.eventEmitter.publish("image-status-updated"+_this.id,imageResource)}),canvasEmitter.subscribe("image-needed",function(event,imageResource){_this.eventEmitter.publish("image-needed"+_this.id,imageResource)}),canvasEmitter.subscribe("image-show",function(event,imageResource){_this.eventEmitter.publish("image-show"+_this.id,imageResource)}),canvasEmitter.subscribe("image-hide",function(event,imageResource){_this.eventEmitter.publish("image-hide"+_this.id,imageResource)}),canvasEmitter.subscribe("image-removed",function(event,imageResource){_this.eventEmitter.publish("image-removed"+_this.id,imageResource)}),canvasEmitter.subscribe("image-opacity-updated",function(event,imageResource){_this.eventEmitter.publish("image-opacity-updated"+_this.id,imageResource)});var eventedCanvas=new iiifEventedCanvas({canvas:canvas,index:index,dispatcher:canvasEmitter});return canvasesIndex[canvas["@id"]]=eventedCanvas,canvasesIndex},{})},destroy:function(){var _this=this;this.events.forEach(function(event){_this.eventEmitter.unsubscribe(event.name,event.handler)}),this.element.remove()},update:function(options){jQuery.extend(this,options),this.windowOptions&&(this.windowOptions.osdBounds=null,this.windowOptions.zoomLevel=null),this.init()},removeBookView:function(){this.focuses=this.availableViews;var manifest=this.manifest.jsonLd;manifest.sequences[0].viewingHint&&"paged"!==manifest.sequences[0].viewingHint.toLowerCase()&&(this.focuses=jQuery.grep(this.focuses,function(value){return"BookView"!==value}))},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("bottomPanelSet."+_this.id,function(event,visible){var panel=_this.element.find(".bottomPanel");!0===visible?panel.css({transform:"translateY(0)"}):panel.css({transform:"translateY(100%)"})}),_this.events.push(_this.eventEmitter.subscribe("HIDE_REMOVE_OBJECT."+_this.id,function(event){_this.element.find(".remove-object-option").hide()})),_this.events.push(this.eventEmitter.subscribe("SHOW_REMOVE_OBJECT."+_this.id,function(event){_this.element.find(".remove-object-option").show()})),_this.events.push(_this.eventEmitter.subscribe("sidePanelStateUpdated."+this.id,function(event,state){state.open?(_this.element.find(".mirador-icon-toc").addClass("selected"),_this.element.find(".view-container").removeClass("maximised")):(_this.element.find(".mirador-icon-toc").removeClass("selected"),_this.element.find(".view-container").addClass("maximised"))})),_this.events.push(_this.eventEmitter.subscribe("sidePanelVisibilityByTab."+this.id,function(event,visible){_this.sidePanelVisibility(visible,"0s")})),_this.events.push(_this.eventEmitter.subscribe("SET_CURRENT_CANVAS_ID."+this.id,function(event,canvasID){"string"==typeof canvasID?_this.setCurrentCanvasID(canvasID):(_this.canvasID!==canvasID.canvasID&&_this.setCurrentCanvasID(canvasID.canvasID),_this.eventEmitter.publish("fitBounds."+_this.id,canvasID.bounds))})),_this.events.push(_this.eventEmitter.subscribe("REMOVE_CLASS."+this.id,function(event,className){_this.element.find(".view-container").removeClass(className)})),_this.events.push(_this.eventEmitter.subscribe("ADD_CLASS."+this.id,function(event,className){_this.element.find(".view-container").addClass(className)})),_this.events.push(_this.eventEmitter.subscribe("UPDATE_FOCUS_IMAGES."+this.id,function(event,images){_this.updateFocusImages(images.array)})),_this.events.push(_this.eventEmitter.subscribe("HIDE_ICON_TOC."+this.id,function(event){_this.element.find(".mirador-icon-toc").hide()})),_this.events.push(_this.eventEmitter.subscribe("SHOW_ICON_TOC."+this.id,function(event){_this.element.find(".mirador-icon-toc").show()})),_this.events.push(_this.eventEmitter.subscribe("SET_BOTTOM_PANEL_VISIBILITY."+this.id,function(event,visibility){void 0!==visibility&&null!==visibility?_this.bottomPanelVisibility(visibility):_this.bottomPanelVisibility(_this.bottomPanelVisible)})),_this.events.push(_this.eventEmitter.subscribe("TOGGLE_BOTTOM_PANEL_VISIBILITY."+this.id,function(event){var visible=!_this.bottomPanelVisible;_this.bottomPanelVisibility(visible)})),_this.events.push(_this.eventEmitter.subscribe("DISABLE_WINDOW_FULLSCREEN",function(event){_this.element.find(".mirador-osd-fullscreen").hide()})),_this.events.push(_this.eventEmitter.subscribe("ENABLE_WINDOW_FULLSCREEN",function(event){_this.element.find(".mirador-osd-fullscreen").show()}))},bindEvents:function(){var _this=this;jQuery(window).resize($.debounce(function(){if(_this.focusModules.ScrollView){var containerHeight=_this.element.find(".view-container").height(),triggerShow=!1;"ScrollView"===_this.viewType&&(triggerShow=!0),_this.focusModules.ScrollView.reloadImages(Math.floor(containerHeight*_this.scrollImageRatio),triggerShow)}},300)),this.element.find(".mirador-osd-fullscreen").on("click",function(){$.fullscreenElement()?$.exitFullscreen():$.enterFullscreen(_this.element[0])}),jQuery(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){_this.toggleFullScreen()})},bindAnnotationEvents:function(){var _this=this;_this.eventEmitter.subscribe("annotationCreated."+_this.id,function(event,oaAnno,eventCallback){var annoID;_this.endpoint.create(oaAnno,function(data){annoID=String(data["@id"]),_this.annotationsList.push(data),_this.eventEmitter.publish("ANNOTATIONS_LIST_UPDATED",{windowId:_this.id,annotationsList:_this.annotationsList}),eventCallback()},function(){console.log("There was an error saving this new annotation")})}),_this.eventEmitter.subscribe("annotationUpdated."+_this.id,function(event,oaAnno){_this.endpoint.update(oaAnno,function(data){jQuery.each(_this.annotationsList,function(index,value){if(value["@id"]===data["@id"])return _this.annotationsList[index]=data,!1}),_this.eventEmitter.publish("ANNOTATIONS_LIST_UPDATED",{windowId:_this.id,annotationsList:_this.annotationsList})},function(){console.log("There was an error updating this annotation")})}),_this.eventEmitter.subscribe("annotationDeleted."+_this.id,function(event,annoId){_this.endpoint.deleteAnnotation(annoId,function(){_this.annotationsList=jQuery.grep(_this.annotationsList,function(e){return e["@id"]!==annoId}),_this.eventEmitter.publish("removeOverlay."+_this.id,annoId),_this.eventEmitter.publish("ANNOTATIONS_LIST_UPDATED",{windowId:_this.id,annotationsList:_this.annotationsList})},function(){})}),_this.eventEmitter.subscribe("updateAnnotationList."+_this.id,function(event){for(;_this.annotationsList.length>0;)_this.annotationsList.pop();_this.getAnnotations()})},clearViews:function(){var _this=this;jQuery.each(_this.focusModules,function(key,value){_this.focusModules[key]=null})},clearPanelsAndOverlay:function(){this.sidePanel=null,this.bottomPanel=null,this.overlay=null},updatePanelsAndOverlay:function(state){var _this=this;jQuery.each(this.focusOverlaysAvailable[state],function(panelType,viewOptions){jQuery.each(viewOptions,function(view,displayed){""!==view&&null===_this[panelType]&&(_this[panelType]=new $[view]({manifest:_this.manifest,appendTo:_this.element.find("."+panelType),state:_this.state,eventEmitter:_this.eventEmitter,windowId:_this.id,panel:!0,canvasID:_this.canvasID,canvases:_this.canvases,imagesList:_this.imagesList,imagesListLtr:_this.imagesListLtr,imagesListRtl:_this.imagesListRtl,vDirectionStatus:_this.vDirectionStatus,thumbInfo:{thumbsHeight:80,listingCssCls:"panel-listing-thumbs",thumbnailCls:"panel-thumbnail-view"}})),displayed=_this.focusOverlaysAvailable[state][panelType][view],""!==view&&displayed&&_this.togglePanels(panelType,displayed,view,state),""===view&&_this[panelType]&&_this.togglePanels(panelType,displayed,view,state),""===view&&_this.adjustFocusSize(panelType,displayed)})})},updateSidePanel:function(){if(this.sidePanelAvailable){var tocTabAvailable=this.sidePanelOptions.tocTabAvailable,annotationsTabAvailable=this.sidePanelOptions.annotations,layersTabAvailable=this.sidePanelOptions.layersTabAvailable,searchTabAvailable=this.sidePanelOptions.searchTabAvailable,hasStructures=!0,structures=this.manifest.getStructures();structures&&0!==structures.length||(hasStructures=!1),null===this.sidePanel?this.sidePanel=new $.SidePanel({windowId:this.id,state:this.state,eventEmitter:this.eventEmitter,appendTo:this.element.find(".sidePanel"),manifest:this.manifest,canvasID:this.canvasID,canvases:this.canvases,layersTabAvailable:layersTabAvailable,tocTabAvailable:tocTabAvailable,searchTabAvailable:searchTabAvailable,annotationsTabAvailable:annotationsTabAvailable,hasStructures:hasStructures}):this.sidePanel.update("annotations",annotationsTabAvailable)}},get:function(prop,parent){return parent?this[parent][prop]:this[prop]},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value},togglePanels:function(panelType,panelState,viewType,focusState){this.focusOverlaysAvailable[focusState][panelType][viewType]=panelState,this[panelType].toggle(panelState),this.adjustFocusSize(panelType,panelState)},sidePanelVisibility:function(visible,transitionDuration){this.sidePanelVisible=visible;var tocIconElement=this.element.find(".mirador-icon-toc"),sidePanelElement=this.element.find(".sidePanel"),viewContainerElement=this.element.find(".view-container");sidePanelElement.css("transition-duration",transitionDuration),viewContainerElement.css("transition",transitionDuration),visible&&sidePanelElement.hasClass("minimized")?(tocIconElement.addClass("selected"),sidePanelElement.removeClass("minimized").width(280).css("border-right","1px solid lightgray"),viewContainerElement.css("margin-left",280)):visible||sidePanelElement.hasClass("minimized")||(tocIconElement.removeClass("selected"),viewContainerElement.css("margin-left",0),sidePanelElement.addClass("minimized").css("border","none").width(0)),this.eventEmitter.publish("windowUpdated",{id:this.id,sidePanelVisible:visible})},bottomPanelVisibility:function(visible){this.bottomPanelVisible=visible,this.eventEmitter.publish("bottomPanelSet."+this.id,visible),this.eventEmitter.publish("windowUpdated",{id:this.id,bottomPanelVisible:visible})},adjustFocusSize:function(panelType,panelState){"bottomPanel"===panelType?this.focusModules[this.viewType].adjustHeight("focus-max-height",panelState):"sidePanel"===panelType&&this.focusModules[this.viewType].adjustWidth("focus-max-width",panelState)},toggleMetadataOverlay:function(focusState){var currentState=this.focusOverlaysAvailable[focusState].overlay.MetadataView;currentState?this.element.find(".mirador-icon-metadata-view").removeClass("selected"):this.element.find(".mirador-icon-metadata-view").addClass("selected"),jQuery.each(this.focusOverlaysAvailable,function(focusType,options){focusState!==focusType&&(this.overlay.MetadataView=!currentState)}),this.togglePanels("overlay",!currentState,"MetadataView",focusState)},toggleFocus:function(focusState,imageMode){this.viewType=focusState,imageMode&&jQuery.inArray(imageMode,this.imageModes)>-1&&(this.currentImageMode=imageMode),jQuery.each(this.focusModules,function(focusKey,module){module&&focusState!==focusKey&&module.toggle(!1)}),this.focusModules[focusState].toggle(!0),this.updateManifestInfo(),this.updatePanelsAndOverlay(focusState),this.updateSidePanel(),this.eventEmitter.publish("focusUpdated"+this.id,focusState),this.eventEmitter.publish("windowUpdated",{id:this.id,viewType:this.viewType,canvasID:this.canvasID,imageMode:this.currentImageMode,loadedManifest:this.manifest.jsonLd["@id"],slotAddress:this.slotAddress,canvases:this.canvases})},toggleThumbnails:function(canvasID){if(this.canvasID=canvasID,null===this.focusModules.ThumbnailsView)this.focusModules.ThumbnailsView=new $.ThumbnailsView({manifest:this.manifest,appendTo:this.element.find(".view-container"),state:this.state,eventEmitter:this.eventEmitter,windowId:this.id,canvasID:this.canvasID,imagesList:this.imagesList,imagesListLtr:this.imagesListLtr,vDirectionStatus:this.vDirectionStatus});else{this.focusModules.ThumbnailsView.updateImage(canvasID)}this.toggleFocus("ThumbnailsView","")},toggleImageView:function(canvasID){this.canvasID=canvasID,null===this.focusModules.ImageView?this.focusModules.ImageView=new $.ImageView({manifest:this.manifest,appendTo:this.element.find(".view-container"),qtipElement:this.element,windowId:this.id,state:this.state,eventEmitter:this.eventEmitter,canvasID:canvasID,canvases:this.canvases,imagesList:this.imagesList,imagesListRtl:this.imagesListRtl,imagesListLtr:this.imagesListLtr,vDirectionStatus:this.vDirectionStatus,osdOptions:this.windowOptions,bottomPanelAvailable:this.bottomPanelAvailable,annoEndpointAvailable:this.annoEndpointAvailable,canvasControls:this.canvasControls,annotationState:this.canvasControls.annotations.annotationState}):this.focusModules.ImageView.updateImage(canvasID),this.toggleFocus("ImageView","ImageView")},toggleBookView:function(canvasID){if(this.canvasID=canvasID,null===this.focusModules.BookView)this.focusModules.BookView=new $.BookView({manifest:this.manifest,appendTo:this.element.find(".view-container"),windowId:this.id,state:this.state,eventEmitter:this.eventEmitter,canvasID:canvasID,imagesList:this.imagesList,imagesListRtl:this.imagesListRtl,imagesListLtr:this.imagesListLtr,vDirectionStatus:this.vDirectionStatus,osdOptions:this.windowOptions,bottomPanelAvailable:this.bottomPanelAvailable});else{this.focusModules.BookView.updateImage(canvasID)}this.toggleFocus("BookView","BookView")},toggleScrollView:function(canvasID){if("rtl"==this.vDirectionStatus&&(this.imagesList=this.imagesListRtl.concat()),this.canvasID=canvasID,null===this.focusModules.ScrollView){var containerHeight=this.element.find(".view-container").height();this.focusModules.ScrollView=new $.ScrollView({manifest:this.manifest,appendTo:this.element.find(".view-container"),state:this.state,eventEmitter:this.eventEmitter,windowId:this.id,canvasID:this.canvasID,imagesList:this.imagesList,imagesListLtr:this.imagesListLtr,vDirectionStatus:this.vDirectionStatus,thumbInfo:{thumbsHeight:Math.floor(containerHeight*this.scrollImageRatio),listingCssCls:"scroll-listing-thumbs",thumbnailCls:"scroll-view"}})}else{this.focusModules.ScrollView.updateImage(canvasID)}this.toggleFocus("ScrollView","")},updateFocusImages:function(imageList){this.focusImages=imageList,this.bottomPanel&&this.bottomPanel.updateFocusImages(this.focusImages)},setCurrentCanvasID:function(canvasID){for(this.canvasID=canvasID,this.eventEmitter.publish("removeTooltips."+this.id);this.annotationsList.length>0;)this.annotationsList.pop();switch(this.getAnnotations(),this.currentImageMode){case"ImageView":this.toggleImageView(this.canvasID);break;case"BookView":this.toggleBookView(this.canvasID)}this.eventEmitter.publish("currentCanvasIDUpdated."+this.id,canvasID)},replaceWindow:function(newSlotAddress,newElement){this.slotAddress=newSlotAddress,this.appendTo=newElement,this.update()},setCursorFrameStart:function(canvasID){},updateManifestInfo:function(){this.element.find(".mirador-icon-view-type > i:first").removeClass().addClass(this.iconClasses[this.viewType]),this.focusOverlaysAvailable[this.viewType].overlay.MetadataView&&this.element.find(".mirador-icon-metadata-view").addClass("selected")},getAnnotations:function(){var _this=this,urls=_this.manifest.getAnnotationsListUrls(_this.canvasID);if(0!==urls.length&&jQuery.each(urls,function(index,url){jQuery.getJSON(url,function(list){var annotations=list.resources;jQuery.each(annotations,function(index,value){void 0===value["@id"]&&(value["@id"]=$.genUUID()),value.endpoint="manifest"}),_this.annotationsList=_this.annotationsList.concat(annotations),_this.eventEmitter.publish("ANNOTATIONS_LIST_UPDATED",{windowId:_this.id,annotationsList:_this.annotationsList})})}),this.annoEndpointAvailable){var dfd=jQuery.Deferred(),module=_this.state.getStateProperty("annotationEndpoint").module,options=_this.state.getStateProperty("annotationEndpoint").options||{};options.name=_this.state.getStateProperty("annotationEndpoint").name,_this.endpoint&&null!==_this.endpoint?_this.endpoint.set("dfd",dfd):(options.dfd=dfd,options.windowID=_this.id,options.imagesList=_this.imagesList,options.eventEmitter=_this.eventEmitter,_this.endpoint=new $[module](options)),_this.endpoint.search({uri:_this.canvasID}),dfd.done(function(loaded){_this.annotationsList=_this.annotationsList.concat(_this.endpoint.annotationsList),_this.annotationsList=jQuery.grep(_this.annotationsList,function(value,index){return void 0!==value.on}),_this.eventEmitter.publish("ANNOTATIONS_LIST_UPDATED",{windowId:_this.id,annotationsList:_this.annotationsList})})}},toggleFullScreen:function(){OpenSeadragon.isFullScreen()?(this.element.find(".mirador-osd-fullscreen i").removeClass("fa-expand").addClass("fa-compress"),this.element.find(".mirador-osd-toggle-bottom-panel").hide(),this.eventEmitter.publish("SET_BOTTOM_PANEL_VISIBILITY."+this.id,!1)):(this.element.find(".mirador-osd-fullscreen i").removeClass("fa-compress").addClass("fa-expand"),this.element.find(".mirador-osd-toggle-bottom-panel").show(),this.eventEmitter.publish("SET_BOTTOM_PANEL_VISIBILITY."+this.id,!0))},bindNavigation:function(){var _this=this;this.element.find(".mirador-icon-view-type").on("mouseenter",function(){_this.element.find(".image-list").stop().slideFadeToggle(300)}).on("mouseleave",function(){_this.element.find(".image-list").stop().slideFadeToggle(300)}),this.element.find(".mirador-icon-window-menu").on("mouseenter",function(){_this.element.find(".slot-controls").stop().slideFadeToggle(300)}).on("mouseleave",function(){_this.element.find(".slot-controls").stop().slideFadeToggle(300)}),this.element.find(".single-image-option").on("click",function(){_this.toggleImageView(_this.canvasID)}),this.element.find(".book-option").on("click",function(){_this.toggleBookView(_this.canvasID)}),this.element.find(".scroll-option").on("click",function(){_this.toggleScrollView(_this.canvasID)}),this.element.find(".thumbnails-option").on("click",function(){_this.toggleThumbnails(_this.canvasID)}),this.element.find(".mirador-icon-metadata-view").on("click",function(){_this.toggleMetadataOverlay(_this.viewType)}),this.element.find(".mirador-icon-toc").on("click",function(){_this.sidePanelVisibility(!_this.sidePanelVisible,"0.3s")}),this.element.find(".new-object-option").on("click",function(){_this.eventEmitter.publish("ADD_ITEM_FROM_WINDOW",_this.id)}),this.element.find(".remove-object-option").on("click",function(){_this.eventEmitter.publish("REMOVE_SLOT_FROM_WINDOW",_this.id)}),this.element.find(".add-slot-right").on("click",function(){_this.eventEmitter.publish("SPLIT_RIGHT_FROM_WINDOW",_this.id)}),this.element.find(".add-slot-left").on("click",function(){_this.eventEmitter.publish("SPLIT_LEFT_FROM_WINDOW",_this.id)}),this.element.find(".add-slot-below").on("click",function(){_this.eventEmitter.publish("SPLIT_DOWN_FROM_WINDOW",_this.id)}),this.element.find(".add-slot-above").on("click",function(){_this.eventEmitter.publish("SPLIT_UP_FROM_WINDOW",_this.id)})},template:$.Handlebars.compile(['<div class="window">','<div class="manifest-info">','<div class="window-manifest-navigation">',"{{#if userButtons}}","{{windowuserbtns userButtons}}","{{/if}}",'<a href="javascript:;" class="mirador-btn mirador-icon-view-type" role="button" title="{{t "viewTypeTooltip"}}" aria-label="{{t "viewTypeTooltip"}}">','<i class="{{currentFocusClass}}"></i>','<i class="fa fa-caret-down"></i>','<ul class="dropdown image-list">',"{{#if ImageView}}",'<li class="single-image-option"><i class="{{iconClasses.ImageView}}"></i> {{t "imageView"}}</li>',"{{/if}}","{{#if BookView}}",'<li class="book-option"><i class="{{iconClasses.BookView}}"></i> {{t "bookView"}}</li>',"{{/if}}","{{#if ScrollView}}",'<li class="scroll-option"><i class="{{iconClasses.ScrollView}}"></i> {{t "scrollView"}}</li>',"{{/if}}","{{#if ThumbnailsView}}",'<li class="thumbnails-option"><i class="{{iconClasses.ThumbnailsView}}"></i> {{t "thumbnailsView"}}</li>',"{{/if}}","</ul>","</a>","{{#if MetadataView}}",'<a href="javascript:;" class="mirador-btn mirador-icon-metadata-view mirador-tooltip" role="button" title="{{t "metadataTooltip"}}" aria-label="{{t "metadataTooltip"}}">','<i class="fa fa-info-circle fa-lg fa-fw"></i>',"</a>","{{/if}}","{{#if showFullScreen}}",'<a class="mirador-btn mirador-osd-fullscreen mirador-tooltip" role="button" title="{{t "fullScreenWindowTooltip"}}" aria-label="{{t "fullScreenWindowTooltip"}}">','<i class="fa fa-lg fa-fw fa-expand"></i>',"</a>","{{/if}}","</div>","{{#if layoutOptions.close}}",'<a href="javascript:;" class="mirador-btn mirador-close-window remove-object-option mirador-tooltip" title="{{t "closeTooltip"}}" aria-label="{{t "closeTooltip"}}"><i class="fa fa-times fa-lg fa-fw"></i></a>',"{{/if}}","{{#if displayLayout}}",'<a href="javascript:;" class="mirador-btn mirador-icon-window-menu" title="{{t "changeLayoutTooltip"}}" aria-label="{{t "changeLayoutTooltip"}}"><i class="fa fa-th-large fa-lg fa-fw"></i><i class="fa fa-caret-down"></i>','<ul class="dropdown slot-controls">',"{{#if layoutOptions.newObject}}",'<li class="new-object-option"><i class="fa fa-refresh fa-lg fa-fw"></i> {{t "newObject"}}</li>','<hr class="menu-divider"/>',"{{/if}}","{{#if layoutOptions.slotRight}}",'<li class="add-slot-right"><i class="fa fa-arrow-circle-right fa-lg fa-fw"></i> {{t "addSlotRight"}}</li>',"{{/if}}","{{#if layoutOptions.slotLeft}}",'<li class="add-slot-left"><i class="fa fa-arrow-circle-left fa-lg fa-fw"></i> {{t "addSlotLeft"}}</li>',"{{/if}}","{{#if layoutOptions.slotAbove}}",'<li class="add-slot-above"><i class="fa fa-arrow-circle-up fa-lg fa-fw"></i> {{t "addSlotAbove"}}</li>',"{{/if}}","{{#if layoutOptions.slotBelow}}",'<li class="add-slot-below"><i class="fa fa-arrow-circle-down fa-lg fa-fw"></i> {{t "addSlotBelow"}}</li>',"{{/if}}","</ul>","</a>","{{/if}}","{{#if sidePanel}}",'<a href="javascript:;" class="mirador-btn mirador-icon-toc selected mirador-tooltip" title="{{t "sidePanelTooltip"}}" aria-label="{{t "sidePanelTooltip"}}"><i class="fa fa-bars fa-lg fa-fw"></i></a>',"{{/if}}",'<h3 class="window-manifest-title" title="{{{title}}}" aria-label="{{{title}}}">{{{title}}}</h3>',"</div>",'<div class="content-container">',"{{#if sidePanel}}",'<div class="sidePanel">',"</div>","{{/if}}",'<div class="overlay"></div>','<div class="view-container {{#unless sidePanel}}focus-max-width{{/unless}}">','<div class="bottomPanel">',"</div>","</div>","</div>","</div>"].join(""))};var processUserButton=function(button){var $a=jQuery("<a>"),$i=jQuery("<i>",{class:"fa fa-lg fa-fw"});try{if(!button.iconClass)throw"userButtons must have an iconClass";return button.attributes&&$a.attr(button.attributes),$a.addClass("mirador-btn"),$i.addClass(button.iconClass),$a.append($i),$a.get(0).outerHTML}catch(error){return console&&console.error&&console.error(error),""}};$.Handlebars.registerHelper("windowuserbtns",function(userButtons){return new $.Handlebars.SafeString(function(buttons){return buttons.map(function(button,index){return processUserButton(button)})}(userButtons).join(""))})}(Mirador),function($){$.AnnotationsLayer=function(options){jQuery.extend(!0,this,{annotationsList:null,viewer:null,drawTool:null,selected:null,hovered:null,windowId:null,mode:"default",element:null,eventEmitter:null},options),this.init()},$.AnnotationsLayer.DISPLAY_ANNOTATIONS="displayAnnotations",$.AnnotationsLayer.prototype={init:function(){this.eventEmitter.unsubscribe("modeChange."+this.windowId),this.eventEmitter.unsubscribe("slotLeave."+this.windowId),this.eventEmitter.unsubscribe("slotEnter."+this.windowId),this.createStateMachine(),this.createRenderer(),this.bindEvents(),this.listenForActions()},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("modeChange."+_this.windowId,function(event,modeName){_this.mode=modeName,_this.modeSwitch()}),_this.eventEmitter.subscribe("annotationListLoaded."+_this.windowId,function(event){_this.annotationsList=_this.state.getWindowAnnotationsList(_this.windowId),_this.updateRenderer()}),_this.eventEmitter.subscribe("slotLeave."+_this.windowId,function(event,eventData){"display"==_this.layerState.current&&(_this.layerState.defaultState(),_this.modeSwitch())}),_this.eventEmitter.subscribe("slotEnter."+_this.windowId,function(event,eventData){_this.element.showAnno&&"display"==_this.layerState.current&&(_this.layerState.defaultState(),_this.modeSwitch())})},bindEvents:function(){},createStateMachine:function(){var _this=this;this.layerState=StateMachine.create({events:[{name:"startup",from:"none",to:"default"},{name:"defaultState",from:["default","display","create","edit"],to:"default"},{name:"displayAnnotations",from:["default","display","create","edit","newShape"],to:"display"},{name:"createAnnotation",from:["default","display"],to:"create"},{name:"createShape",from:"edit",to:"newShape"},{name:"editAnnotation",from:["default","display","newShape"],to:"edit"}],callbacks:{onstartup:function(event){_this.drawTool.enterDefault()},ondefaultState:function(event){_this.drawTool.enterDefault()},ondisplayAnnotations:function(event){_this.drawTool.enterDisplayAnnotations()},oncreateAnnotation:function(event){_this.drawTool.enterCreateAnnotation()},oncreateShape:function(event){_this.drawTool.enterCreateShape()},oneditAnnotation:function(event){_this.drawTool.enterEditAnnotation()}}})},createRenderer:function(){this.drawTool=new $.OsdRegionDrawTool({osdViewer:this.viewer,parent:this,list:this.annotationsList,visible:!1,windowId:this.windowId,state:this.state,eventEmitter:this.eventEmitter}),this.layerState.startup()},updateRenderer:function(){this.drawTool.list=this.annotationsList},modeSwitch:function(){"displayAnnotations"===this.mode?this.layerState.displayAnnotations():"editingAnnotation"===this.mode?this.layerState.editAnnotation():"creatingAnnotation"===this.mode?"edit"!==this.layerState.current?this.layerState.createAnnotation():this.layerState.createShape():"default"===this.mode&&this.layerState.defaultState()}}}(Mirador),function($){$.AnnotationsTab=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,manifest:null,visible:null,state:null,eventEmitter:null},options),this.init()},$.AnnotationsTab.prototype={init:function(){this.windowId=this.windowId,this.localState({id:"annotationsTab",visible:this.visible,annotationLists:[],selectedList:null,empty:!0,focusedList:null},!0),this.listenForActions(),this.render(this.localState()),this.loadTabComponents(),this.bindEvents()},localState:function(state,initial){return arguments.length?(this.annoTabState=state,initial||this.eventEmitter.publish("annotationsTabStateUpdated."+this.windowId,this.annoTabState),this.annoTabState):this.annoTabState},loadTabComponents:function(){},tabStateUpdated:function(visible){localState=this.localState(),localState.visible=visible,this.localState(localState),visible?this.element.show():this.element.hide()},annotationListLoaded:function(){var annotationSources=[],localState=this.localState();jQuery.each(this.state.getWindowAnnotationsList(this.windowId),function(index,value){value.endpoint&&"string"==typeof value.endpoint?annotationSources.push(value.resource):value.resource&&(value.resource.endpoint&&"string"==typeof value.resource.endpoint?annotationSources.push(value.resource):annotationSources.push(value.resource[0]))}),annotationSources=annotationSources.filter(function(itm,i,annotationSources){return i==annotationSources.indexOf(itm)}),localState.annotationLists=annotationSources.map(function(annotationSource){return{annotationSource:annotationSource,layer:null,selected:annotationSource===localState.selectedList,focused:!1}}),localState.annotationLists.length&&(localState.empty=!1),this.localState(localState)},deselectList:function(listId){var localState=this.localState();localState.selectedList=null,localState.annotationLists.forEach(function(list){list.selected=!1}),this.localState(localState)},selectList:function(listId){var localState=this.localState();localState.selectedList=listId,localState.annotationLists.forEach(function(list){list.selected=list.annotationSource===listId}),this.localState(localState)},focusList:function(listId){var localState=this.localState();localState.focusedList=listId,localState.annotationLists.forEach(function(list){list.focused=list.annotationSource===listId}),this.localState(localState)},toggle:function(){},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("annotationsTabStateUpdated."+_this.windowId,function(_,data){_this.render(data)}),_this.eventEmitter.subscribe("tabStateUpdated."+_this.windowId,function(_,data){_this.tabStateUpdated("annotationsTab"==data.tabs[data.selectedTabIndex].options.id)}),_this.eventEmitter.subscribe("annotationListLoaded."+_this.windowId,function(_,data){_this.annotationListLoaded()}),_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,function(event){_this.eventEmitter.subscribe("annotationListLoaded."+_this.windowId,function(event){_this.annotationListLoaded()}),_this.selectList(_this.localState().selectedList)}),_this.eventEmitter.subscribe("listSelected."+_this.windowId,function(event,listId){_this.selectList(listId)}),_this.eventEmitter.subscribe("listDeselected."+_this.windowId,function(event,listId){_this.deselectList(listId)})},bindEvents:function(){this.element.find(".annotationListItem")},render:function(state){var templateData={annotationSources:state.annotationLists};this.element?(jQuery(this.appendTo).find(".annotationsPanel").remove(),this.element=jQuery(this.template(templateData)).appendTo(this.appendTo)):this.element=jQuery(this.template(templateData)).appendTo(this.appendTo),this.bindEvents(),state.visible?this.element.show():this.element.hide()},template:$.Handlebars.compile(['<div class="annotationsPanel">','<ul class="annotationSources">',"{{#each annotationSources}}",'<li class="annotationListItem" {{#if this.selected}}selected{{/if}} {{#if this.focused }}focused{{/if}}">','<span style="font-weight: bold">{{{this.annotationSource.label}}}</span>',"<br/>","<span>{{{this.annotationSource.chars}}}</span>","</li>","{{/each}}","</ul>","</div>"].join(""))}}(Mirador),function($){$.BookView=function(options){jQuery.extend(this,{currentImg:null,windowId:null,currentImgIndex:0,stitchList:[],canvasID:null,imagesList:[],imagesListRtl:[],element:null,focusImages:[],manifest:null,viewingDirection:"left-to-right",viewingHint:"paged",osd:null,osdCls:"mirador-osd",osdOptions:{osdBounds:null,zoomLevel:null},stitchTileMargin:10,eventEmitter:null},options),this.init()},$.BookView.prototype={init:function(){"rtl"==this.vDirectionStatus&&(this.imagesList=this.imagesListRtl.concat()),null!==this.canvasID&&(this.currentImgIndex=$.getImageIndexById(this.imagesList,this.canvasID)),this.osdOptions||(this.osdOptions={osdBounds:null,zoomLevel:null}),this.currentImg=this.imagesList[this.currentImgIndex],this.element=jQuery(this.template()).appendTo(this.appendTo),this.hud=new $.Hud({appendTo:this.element,bottomPanelAvailable:this.bottomPanelAvailable,windowId:this.windowId,annotationLayerAvailable:!1,showNextPrev:1!==this.imagesList.length,eventEmitter:this.eventEmitter,showAnno:!1,showImageControls:!1}),this.manifest.jsonLd.sequences[0].viewingDirection&&(this.viewingDirection=this.manifest.jsonLd.sequences[0].viewingDirection.toLowerCase()),this.manifest.jsonLd.sequences[0].viewingHint&&(this.viewingHint=this.manifest.jsonLd.sequences[0].viewingHint.toLowerCase()),this.stitchList=this.getStitchList(),this.createOpenSeadragonInstance(),this.bindEvents(),this.listenForActions(),void 0===this.bottomPanelAvailable||this.bottomPanelAvailable?this.eventEmitter.publish("SET_BOTTOM_PANEL_VISIBILITY."+this.windowId,null):this.eventEmitter.publish("SET_BOTTOM_PANEL_VISIBILITY."+this.windowId,!1)},template:$.Handlebars.compile(['<div class="book-view">',"</div>"].join("")),listenForActions:function(){var _this=this,firstCanvasId=_this.imagesList[0]["@id"],lastCanvasId=_this.imagesList[_this.imagesList.length-1]["@id"];_this.eventEmitter.subscribe("bottomPanelSet."+_this.windowId,function(event,visible){var dodgers=_this.element.find(".mirador-osd-toggle-bottom-panel, .mirador-pan-zoom-controls"),arrows=_this.element.find(".mirador-osd-next, .mirador-osd-previous");!0===visible?(dodgers.addClass("bottom-panel-open"),arrows.addClass("bottom-panel-open")):(dodgers.removeClass("bottom-panel-open"),arrows.removeClass("bottom-panel-open"))}),_this.eventEmitter.subscribe("fitBounds."+_this.windowId,function(event,bounds){var rect=_this.osd.viewport.imageToViewportRectangle(Number(bounds.x),Number(bounds.y),Number(bounds.width),Number(bounds.height));_this.osd.viewport.fitBoundsWithConstraints(rect,!1)}),_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,function(event,canvasId){canvasId===firstCanvasId?(_this.element.find(".mirador-osd-previous").hide(),_this.element.find(".mirador-osd-next").show()):canvasId===lastCanvasId?(_this.element.find(".mirador-osd-next").hide(),_this.element.find(".mirador-osd-previous").show()):(_this.element.find(".mirador-osd-next").show(),_this.element.find(".mirador-osd-previous").show())})},bindEvents:function(){var _this=this;this.element.find(".mirador-osd-next").on("click",function(){_this.next()}),this.element.find(".mirador-osd-previous").on("click",function(){_this.previous()}),this.element.find(".mirador-osd-go-home").on("click",function(){_this.osd.viewport.goHome()}),this.element.find(".mirador-osd-up").on("click",function(){var panBy=_this.getPanByValue();_this.osd.viewport.panBy(new OpenSeadragon.Point(0,-panBy.y)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-right").on("click",function(){var panBy=_this.getPanByValue();_this.osd.viewport.panBy(new OpenSeadragon.Point(panBy.x,0)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-down").on("click",function(){var panBy=_this.getPanByValue();_this.osd.viewport.panBy(new OpenSeadragon.Point(0,panBy.y)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-left").on("click",function(){var panBy=_this.getPanByValue();_this.osd.viewport.panBy(new OpenSeadragon.Point(-panBy.x,0)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-zoom-in").on("click",function(){var osd=_this.osd;osd.viewport&&(osd.viewport.zoomBy(osd.zoomPerClick/1),osd.viewport.applyConstraints())}),this.element.find(".mirador-osd-zoom-out").on("click",function(){var osd=_this.osd;osd.viewport&&(osd.viewport.zoomBy(1/osd.zoomPerClick),osd.viewport.applyConstraints())}),this.element.find(".mirador-osd-toggle-bottom-panel").on("click",function(){_this.eventEmitter.publish("TOGGLE_BOTTOM_PANEL_VISIBILITY."+_this.windowId)})},getPanByValue:function(){var bounds=this.osd.viewport.getBounds(!0);return{x:.5*bounds.width,y:.5*bounds.height}},setBounds:function(){this.osdOptions.osdBounds=this.osd.viewport.getBounds(!0),this.eventEmitter.publish("imageBoundsUpdated",{id:this.windowId,osdBounds:{x:this.osdOptions.osdBounds.x,y:this.osdOptions.osdBounds.y,width:this.osdOptions.osdBounds.width,height:this.osdOptions.osdBounds.height}})},toggle:function(stateValue){stateValue?this.show():this.hide()},hide:function(){jQuery(this.element).hide({effect:"fade",duration:300,easing:"easeOutCubic"})},show:function(){jQuery(this.element).show({effect:"fade",duration:300,easing:"easeInCubic",complete:function(){jQuery(this).css("display","block")}})},adjustWidth:function(className,hasClass){hasClass?this.eventEmitter.publish("REMOVE_CLASS."+this.windowId,className):this.eventEmitter.publish("ADD_CLASS."+this.windowId,className)},adjustHeight:function(className,hasClass){hasClass?this.element.removeClass(className):this.element.addClass(className)},updateImage:function(canvasID){this.canvasID=canvasID,this.currentImgIndex=$.getImageIndexById(this.imagesList,this.canvasID),this.currentImg=this.imagesList[this.currentImgIndex];var newList=this.getStitchList();this.stitchList.length==newList.length&&this.stitchList.every(function(element,index){return element===newList[index]})||(this.stitchList=newList,this.osdOptions={osdBounds:null,zoomLevel:null},this.osd.close(),this.createOpenSeadragonInstance())},createOpenSeadragonInstance:function(){var elemOsd,uniqueID=$.genUUID(),osdId="mirador-osd-"+uniqueID,tileSources=[],_this=this,toolbarID="osd-toolbar-"+uniqueID,dfd=jQuery.Deferred();this.element.find("."+this.osdCls).remove(),jQuery.each(this.stitchList,function(index,image){var infoJsonUrl=$.Iiif.getImageUrl(image)+"/info.json";jQuery.getJSON(infoJsonUrl).done(function(data,status,jqXHR){tileSources.splice(index,0,data),tileSources.length===_this.stitchList.length&&dfd.resolve()})}),dfd.done(function(){var aspectRatio=tileSources[0].height/tileSources[0].width;elemOsd=jQuery("<div/>").addClass(_this.osdCls).attr("id",osdId).appendTo(_this.element),_this.osd=$.OpenSeadragon({id:elemOsd.attr("id"),toolbarID:toolbarID}),_this.osd.addHandler("open",function(){_this.addLayer(tileSources.slice(1),aspectRatio);var addItemHandler=function(event){if(_this.osd.world.removeHandler("add-item",addItemHandler),_this.osdOptions.osdBounds){var rect=new OpenSeadragon.Rect(_this.osdOptions.osdBounds.x,_this.osdOptions.osdBounds.y,_this.osdOptions.osdBounds.width,_this.osdOptions.osdBounds.height);_this.osd.viewport.fitBounds(rect,!0)}else _this.osd.viewport.goHome(!0)};_this.boundsToFocusOnNextOpen&&(_this.eventEmitter.publish("fitBounds."+_this.windowId,_this.boundsToFocusOnNextOpen),_this.boundsToFocusOnNextOpen=null),_this.osd.world.addHandler("add-item",addItemHandler),_this.osd.addHandler("zoom",$.debounce(function(){_this.setBounds()},300)),_this.osd.addHandler("pan",$.debounce(function(){_this.setBounds()},300))}),_this.osd.open(tileSources[0],{opacity:1,x:0,y:0,width:1})})},addLayer:function(tileSources,aspectRatio){var _this=this;jQuery.each(tileSources,function(index,value){var newAR=value.height/value.width,options={tileSource:value,opacity:1,x:1.01,y:0,width:aspectRatio/newAR};_this.osd.addTiledImage(options)})},next:function(){var next;(next=this.currentImgIndex%2==0?this.currentImgIndex+1:this.currentImgIndex+2)<this.imagesList.length&&this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+this.windowId,this.imagesList[next]["@id"])},previous:function(){var prev;(prev=this.currentImgIndex%2==0?this.currentImgIndex-2:this.currentImgIndex-1)>=0&&this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+this.windowId,this.imagesList[prev]["@id"])},getStitchList:function(){var stitchList=[],leftIndex=[],rightIndex=[],topIndex=[],bottomIndex=[],_this=this;if(this.focusImages=[],"individuals"===this.viewingHint)stitchList=[this.currentImg];else if("paged"===this.viewingHint)if(0===this.currentImgIndex||this.currentImgIndex===this.imagesList.length-1)stitchList=[this.currentImg];else if(this.currentImgIndex%2==0)switch(this.viewingDirection){case"left-to-right":leftIndex[0]=this.currentImgIndex-1,stitchList=[this.imagesList[this.currentImgIndex-1],this.currentImg];break;case"right-to-left":rightIndex[0]=this.currentImgIndex-1,stitchList=[this.currentImg,this.imagesList[this.currentImgIndex-1]];break;case"top-to-bottom":topIndex[0]=this.currentImgIndex-1,stitchList=[this.imagesList[this.currentImgIndex-1],this.currentImg];break;case"bottom-to-top":bottomIndex[0]=this.currentImgIndex-1,stitchList=[this.currentImg,this.imagesList[this.currentImgIndex-1]]}else switch(this.viewingDirection){case"left-to-right":rightIndex[0]=this.currentImgIndex+1,stitchList=[this.currentImg,this.imagesList[this.currentImgIndex+1]];break;case"right-to-left":leftIndex[0]=this.currentImgIndex+1,stitchList=[this.imagesList[this.currentImgIndex+1],this.currentImg];break;case"top-to-bottom":bottomIndex[0]=this.currentImgIndex+1,stitchList=[this.currentImg,this.imagesList[this.currentImgIndex+1]];break;case"bottom-to-top":topIndex[0]=this.currentImgIndex+1,stitchList=[this.imagesList[this.currentImgIndex+1],this.currentImg]}else this.viewingHint;return jQuery.each(stitchList,function(index,image){_this.focusImages.push(image["@id"])}),_this.eventEmitter.publish("UPDATE_FOCUS_IMAGES."+this.windowId,{array:this.focusImages}),stitchList}}}(Mirador),function($){$.ContextControls=function(options){jQuery.extend(this,{element:null,container:null,mode:null,windowId:null,annoEndpointAvailable:!1,eventEmitter:null},options),this.init()},$.ContextControls.prototype={init:function(){var _this=this,showStrokeStyle=!1,showStrokeColor=!1,showFillColor=!1;this.availableAnnotationStylePickers.forEach(function(picker){"StrokeType"===picker&&(showStrokeStyle=!0),"FillColor"===picker&&(showFillColor=!0),"StrokeColor"===picker&&(showStrokeColor=!0)}),this.setBackground={solid:function(el){_this.setBackgroundImage(el,"border_type_1.png")},dashed:function(el){_this.setBackgroundImage(el,"border_type_2.png")},dotdashed:function(el){_this.setBackgroundImage(el,"border_type_3.png")},thick:function(el){_this.setBackgroundImage(el,"border_type_4.png")},thickest:function(el){_this.setBackgroundImage(el,"border_type_5.png")}};var annotationProperties=this.canvasControls.annotations;annotationProperties.annotationLayer&&this.annoEndpointAvailable&&(this.annotationElement=jQuery(this.annotationTemplate({tools:_this.availableAnnotationTools,showEdit:annotationProperties.annotationCreation,showStrokeStyle:showStrokeStyle,showStrokeColor:showStrokeColor,showFillColor:showFillColor,showRefresh:annotationProperties.annotationRefresh})).appendTo(this.container.find(".mirador-osd-annotation-controls")),this.annotationElement.hide(),this.setQtips(this.container.find(".mirador-osd-annotation-controls")),this.setBorderFillColorPickers()),showStrokeStyle&&this.addStrokeStylePicker(),this.canvasControls.imageManipulation.manipulationLayer&&(this.manipulationElement=jQuery(this.manipulationTemplate({filtersSupported:Modernizr.cssfilters,showRotate:this.canvasControls.imageManipulation.controls.rotate,showBrightness:this.canvasControls.imageManipulation.controls.brightness,showContrast:this.canvasControls.imageManipulation.controls.contrast,showSaturate:this.canvasControls.imageManipulation.controls.saturate,showGrayscale:this.canvasControls.imageManipulation.controls.grayscale,showInvert:this.canvasControls.imageManipulation.controls.invert,showMirror:this.canvasControls.imageManipulation.controls.mirror})).appendTo(this.container.find(".mirador-manipulation-controls")),this.setQtips(this.container.find(".mirador-manipulation-controls")),this.manipulationElement.hide()),this.bindEvents()},setQtips:function(element){var _this=this;element.find("a").each(function(){jQuery(this).qtip({content:{text:jQuery(this).attr("title")},position:{my:"bottom center",at:"top center",viewport:!0,container:_this.qtipElement},style:{classes:"qtip-dark qtip-shadow qtip-rounded"}})})},addColorPicker:function(selector,options){this.container.find(selector).spectrum(options)},getImagePath:function(imageName){return this.state.getStateProperty("buildPath")+this.state.getStateProperty("imagesPath")+imageName},setBackgroundImage:function(el,imageName){el.css("background-image","url("+this.getImagePath(imageName)+")")},removeBackgroundImage:function(el){el.css("background-image","")},addStrokeStylePicker:function(){this.setBackground.solid(this.container.find(".mirador-line-type .solid")),this.setBackground.thick(this.container.find(".mirador-line-type .thick")),this.setBackground.thickest(this.container.find(".mirador-line-type .thickest")),this.setBackground.dashed(this.container.find(".mirador-line-type .dashed")),this.setBackground.dotdashed(this.container.find(".mirador-line-type .dotdashed"))},setBorderFillColorPickers:function(){var _this=this,defaultBorderColor=_this.state.getStateProperty("drawingToolsSettings").strokeColor,defaultFillColor=_this.state.getStateProperty("drawingToolsSettings").fillColor,defaultAlpha=_this.state.getStateProperty("drawingToolsSettings").fillColorAlpha,colorObj=tinycolor(defaultFillColor);colorObj.setAlpha(defaultAlpha),this.addColorPicker(".borderColorPicker",{showInput:!0,showInitial:!1,showPalette:!0,showButtons:!1,showSelectionPalette:!0,hideAfterPaletteSelect:!0,appendTo:"parent",containerClassName:"borderColorPickerPop"+_this.windowId,preferredFormat:"rgb",hide:function(color){_this.eventEmitter.publish("changeBorderColor."+_this.windowId,color.toHexString()),jQuery(this).spectrum("set",color.toHexString())},move:function(color){_this.eventEmitter.publish("changeBorderColor."+_this.windowId,color.toHexString())},show:function(color){_this.setColorPickerInCanvas(".borderColorPicker")},maxSelectionSize:4,color:defaultBorderColor,palette:[[defaultBorderColor,"black","red","green"],["white","blue","magenta","yellow"]]}),_this.container.find(".borderColorPicker").next(".sp-replacer").prepend("<i class='material-icons'>border_color</i>"),_this.addColorPicker(".fillColorPicker",{showInput:!0,showInitial:!1,showAlpha:!0,showPalette:!0,showButtons:!1,showSelectionPalette:!0,appendTo:"parent",clickoutFiresChange:!0,containerClassName:"fillColorPickerPop"+_this.windowId,preferredFormat:"rgb",hide:function(color){_this.eventEmitter.publish("changeFillColor."+_this.windowId,[color.toHexString(),color.getAlpha()]),jQuery(this).spectrum("set",color)},move:function(color){_this.eventEmitter.publish("changeFillColor."+_this.windowId,[color.toHexString(),color.getAlpha()])},show:function(color){_this.setColorPickerInCanvas(".fillColorPicker")},maxSelectionSize:4,color:colorObj,palette:[[colorObj,"black","red","green"],["white","blue","magenta","yellow"]]}),_this.container.find(".fillColorPicker").next(".sp-replacer").prepend("<i class='material-icons'>format_color_fill</i>")},setColorPickerInCanvas:function(selector){var pickerContainer=this.container.find(selector).siblings(".sp-container").first(),pickerOffset=pickerContainer.offset(),windowWidth=this.state.windowsElements[this.windowId].width();pickerContainer.width()+pickerOffset.left>windowWidth&&pickerContainer.css("left",windowWidth-pickerContainer.outerWidth())},annotationShow:function(){this.annotationElement.fadeIn("150")},annotationHide:function(){this.annotationElement.fadeOut("150")},manipulationShow:function(){this.manipulationElement.fadeIn("150")},manipulationHide:function(){this.manipulationElement.fadeOut("150")},bindEvents:function(){var _this=this;this.container.find(".mirador-line-type").on("mouseenter",function(){if(jQuery(this).hasClass("hud-disabled"))return!1;_this.container.find(".type-list").stop().slideFadeToggle(300)}),this.container.find(".mirador-line-type").on("mouseleave",function(){if(jQuery(this).hasClass("hud-disabled"))return!1;_this.container.find(".type-list").stop().slideFadeToggle(300)}),this.container.find(".mirador-line-type").find("ul li").on("click",function(){if(jQuery(this).hasClass("hud-disabled"))return!1;var className=jQuery(this).find("i").attr("class").replace(/fa/,"").replace(/ /,"");_this.removeBackgroundImage(_this.container.find(".mirador-line-type .border-type-image")),_this.setBackground[className](_this.container.find(".mirador-line-type .border-type-image")),_this.eventEmitter.publish("toggleBorderType."+_this.windowId,className)})},annotationTemplate:$.Handlebars.compile(["{{#if showEdit}}",'<a class="mirador-osd-pointer-mode hud-control selected" title="{{t "pointerTooltip"}}">','<i class="fa fa-mouse-pointer"></i>',"</a>","{{#each tools}}",'<a class="mirador-osd-{{this.logoClass}}-mode hud-control mirador-osd-edit-mode" title="{{t this.tooltip}}">','<i class="material-icons">{{this.logoClass}}</i>',"</a>","{{/each}}","{{#if showStrokeStyle}}",'<a class="hud-control hud-dropdown hud-disabled mirador-line-type" aria-label="{{t "borderTypeTooltip"}}" title="{{t "borderTypeTooltip"}}">','<i class="material-icons mirador-border-icon">create</i>','<i class="border-type-image solid"></i>','<i class="fa fa-caret-down dropdown-icon"></i>','<ul class="dropdown type-list">','<li><i class="fa solid"></i> {{t "solid"}}</li>','<li><i class="fa thick"></i> {{t "thick"}}</li>','<li><i class="fa thickest"></i> {{t "thickest"}}</li>','<li><i class="fa dashed"></i> {{t "dashed"}}</li>','<li><i class="fa dotdashed"></i> {{t "dotDashed"}}</li>',"</ul>","</a>","{{/if}}","{{#if showStrokeColor}}",'<a class="hud-control hud-dropdown hud-disabled mirador-osd-color-picker" title="{{t "borderColorTooltip"}}">','<input type="text" class="borderColorPicker"/>',"</a>","{{/if}}","{{#if showFillColor}}",'<a class="hud-control hud-dropdown hud-disabled mirador-osd-color-picker" title="{{t "fillColorTooltip"}}">','<input type="text" class="fillColorPicker"/>',"</a>","{{/if}}","{{#if showRefresh}}",'<a class="hud-control mirador-osd-refresh-mode">','<i class="fa fa-lg fa-refresh"></i>',"</a>","{{/if}}","{{/if}}"].join("")),manipulationTemplate:$.Handlebars.compile(["{{#if showRotate}}",'<a class="hud-control mirador-osd-rotate-right" title="{{t "rotateRightTooltip"}}">','<i class="fa fa-lg fa-rotate-right"></i>',"</a>",'<a class="hud-control mirador-osd-rotate-left" title="{{t "rotateLeftTooltip"}}">','<i class="fa fa-lg fa-rotate-left"></i>',"</a>","{{/if}}","{{#if filtersSupported}}","{{#if showBrightness}}",'<a class="hud-control mirador-osd-brightness" title="{{t "brightnessTooltip"}}">','<i class="material-icons">wb_sunny</i>','<i class="fa fa-caret-down"></i>','<div class="mirador-osd-brightness-slider mirador-slider"/>',"</a>","{{/if}}","{{#if showContrast}}",'<a class="hud-control mirador-osd-contrast" title="{{t "contrastTooltip"}}">','<i class="material-icons">brightness_6</i>','<i class="fa fa-caret-down"></i>','<div class="mirador-osd-contrast-slider mirador-slider"/>',"</a>","{{/if}}","{{#if showSaturate}}",'<a class="hud-control mirador-osd-saturation" title="{{t "saturationTooltip"}}">','<i class="material-icons">gradient</i>','<i class="fa fa-caret-down"></i>','<div class="mirador-osd-saturation-slider mirador-slider"/>',"</a>","{{/if}}","{{#if showGrayscale}}",'<a class="hud-control mirador-osd-grayscale" title="{{t "grayscaleTooltip"}}">','<i class="material-icons">filter_b_and_w</i>',"</a>","{{/if}}","{{#if showInvert}}",'<a class="hud-control mirador-osd-invert" title="{{t "invertTooltip"}}">','<i class="material-icons">invert_colors</i>',"</a>","{{/if}}","{{#if showMirror}}",'<a class="hud-control mirador-osd-mirror" title="{{t "mirrorTooltip"}}">','<i class="material-icons">swap_horiz</i>',"</a>","{{/if}}",'<a class="hud-control mirador-osd-reset" title="{{t "resetTooltip"}}">','<i class="fa fa-lg fa-refresh"></i>',"</a>","{{/if}}"].join("")),editorTemplate:$.Handlebars.compile(['<div class="mirador-osd-context-controls hud-container">','<a class="mirador-osd-back hud-control" role="button">','<i class="fa fa-lg fa-arrow-left"></i>',"</a>",'<a class="mirador-osd-rect-tool hud-control" role ="buton">','<i class="fa fa-lg fa-pencil-square"></i>',"</a>",'<a class="mirador-osd-rect-tool hud-control" role="button">','<i class="fa fa-lg fa-ellipsis-h"></i>',"</a>",'<a class="mirador-osd-rect-tool hud-control" role="button">','<i class="fa fa-lg fa-gear"></i>',"</a>","</div>"].join(""))}}(Mirador),function($){$.Hud=function(options){jQuery.extend(this,{element:null,windowId:null,annoState:null,annoEndpointAvailable:!1,eventEmitter:null},options),this.init()},$.Hud.prototype={init:function(){this.createStateMachines();var showAnno=void 0!==this.showAnno?this.showAnno:this.canvasControls.annotations.annotationLayer,showImageControls=void 0!==this.showImageControls?this.showImageControls:this.canvasControls.imageManipulation.manipulationLayer;this.element=jQuery(this.template({showNextPrev:this.showNextPrev,showBottomPanel:void 0===this.bottomPanelAvailable||this.bottomPanelAvailable,showAnno:showAnno,showImageControls:showImageControls})).appendTo(this.appendTo),(showAnno||showImageControls)&&(this.contextControls=new $.ContextControls({element:null,container:this.element.find(".mirador-osd-context-controls"),qtipElement:this.qtipElement,mode:"displayAnnotations",windowId:this.windowId,canvasControls:this.canvasControls,annoEndpointAvailable:this.annoEndpointAvailable,availableAnnotationTools:this.availableAnnotationTools,availableAnnotationStylePickers:this.availableAnnotationStylePickers,state:this.state,eventEmitter:this.eventEmitter})),this.listenForActions(),this.bindEvents()},listenForActions:function(){var _this=this;this.eventEmitter.subscribe("DISABLE_TOOLTIPS_BY_CLASS."+this.windowId,function(event,className){_this.element.find(className).qtip("disable")}),this.eventEmitter.subscribe("ENABLE_TOOLTIPS_BY_CLASS."+this.windowId,function(event,className){_this.element.find(className).qtip("enable")}),this.eventEmitter.subscribe("SET_STATE_MACHINE_POINTER."+this.windowId,function(event){"none"===_this.annoState.current?_this.annoState.startup():"off"===_this.annoState.current?_this.annoState.displayOn():_this.annoState.choosePointer()})},bindEvents:function(){},createStateMachines:function(){var _this=this;this.annoState=StateMachine.create({events:[{name:"startup",from:"none",to:"off"},{name:"displayOn",from:"off",to:"pointer"},{name:"displayOff",from:["pointer","shape"],to:"off"},{name:"choosePointer",from:["pointer","shape"],to:"pointer"},{name:"chooseShape",from:"pointer",to:"shape"},{name:"changeShape",from:"shape",to:"shape"},{name:"refresh",from:"pointer",to:"pointer"},{name:"refresh",from:"shape",to:"shape"}],callbacks:{onstartup:function(event,from,to){_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,annotationState:to})},ondisplayOn:function(event,from,to){_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".mirador-osd-annotations-layer","selected"]),_this.annoEndpointAvailable&&_this.contextControls.annotationShow(),_this.eventEmitter.publish("modeChange."+_this.windowId,"displayAnnotations"),_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".mirador-osd-pointer-mode","selected"]),_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".hud-dropdown","hud-disabled"]),_this.eventEmitter.publish("DISABLE_TOOLTIPS_BY_CLASS."+_this.windowId,".hud-dropdown"),_this.eventEmitter.publish("DEFAULT_CURSOR."+_this.windowId),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,annotationState:to})},ondisplayOff:function(event,from,to){_this.annoEndpointAvailable&&(_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-edit-mode","selected"]),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-pointer-mode","selected"]),_this.eventEmitter.publish("CANCEL_ACTIVE_ANNOTATIONS."+_this.windowId),_this.contextControls.annotationHide()),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-annotations-layer","selected"]),_this.eventEmitter.publish("modeChange."+_this.windowId,"default"),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,annotationState:to})},onchoosePointer:function(event,from,to){_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-edit-mode","selected"]),_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".mirador-osd-pointer-mode","selected"]),_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".hud-dropdown","hud-disabled"]),_this.eventEmitter.publish("DISABLE_TOOLTIPS_BY_CLASS."+_this.windowId,".hud-dropdown"),_this.eventEmitter.publish("modeChange."+_this.windowId,"displayAnnotations"),_this.eventEmitter.publish("DEFAULT_CURSOR."+_this.windowId),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,annotationState:to})},onchooseShape:function(event,from,to,shape){_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-pointer-mode","selected"]),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-edit-mode","selected"]),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".hud-dropdown","hud-disabled"]),_this.eventEmitter.publish("ENABLE_TOOLTIPS_BY_CLASS."+_this.windowId,".hud-dropdown"),_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".mirador-osd-"+shape+"-mode","selected"]),_this.eventEmitter.publish("modeChange."+_this.windowId,"creatingAnnotation"),_this.eventEmitter.publish("CROSSHAIR_CURSOR."+_this.windowId),_this.eventEmitter.publish("toggleDrawingTool."+_this.windowId,shape),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,annotationState:to})},onchangeShape:function(event,from,to,shape){_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-pointer-mode","selected"]),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-osd-edit-mode","selected"]),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".hud-dropdown","hud-disabled"]),_this.eventEmitter.publish("ENABLE_TOOLTIPS_BY_CLASS."+_this.windowId,".hud-dropdown"),_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".mirador-osd-"+shape+"-mode","selected"]),_this.eventEmitter.publish("CROSSHAIR_CURSOR."+_this.windowId),_this.eventEmitter.publish("toggleDrawingTool."+_this.windowId,shape),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,annotationState:to})},onrefresh:function(event,from,to){}}}),this.manipulationState=StateMachine.create({events:[{name:"startup",from:"none",to:"manipulationOff"},{name:"displayOn",from:"manipulationOff",to:"manipulationOn"},{name:"displayOff",from:"manipulationOn",to:"manipulationOff"}],callbacks:{onstartup:function(event,from,to){_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,manipulationState:to})},ondisplayOn:function(event,from,to){_this.eventEmitter.publish("HUD_ADD_CLASS."+_this.windowId,[".mirador-manipulation-toggle","selected"]),_this.contextControls.manipulationShow(),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,manipulationState:to})},ondisplayOff:function(event,from,to){_this.contextControls.manipulationHide(),_this.eventEmitter.publish("HUD_REMOVE_CLASS."+_this.windowId,[".mirador-manipulation-toggle","selected"]),_this.eventEmitter.publish("windowUpdated",{id:_this.windowId,manipulationState:to})}}})},template:$.Handlebars.compile(['<div class="mirador-hud">',"{{#if showNextPrev}}",'<a class="mirador-osd-previous hud-control ">','<i class="fa fa-3x fa-chevron-left "></i>',"</a>","{{/if}}",'<div class="mirador-osd-context-controls hud-container">',"{{#if showAnno}}",'<div class="mirador-osd-annotation-controls">','<a class="mirador-osd-annotations-layer hud-control" role="button" title="{{t "annotationTooltip"}}" aria-label="{{t "annotationTooltip"}}">','<i class="fa fa-lg fa-comments"></i>',"</a>","</div>","{{/if}}","{{#if showImageControls}}",'<div class="mirador-manipulation-controls">','<a class="mirador-manipulation-toggle hud-control" role="button" title="{{t "imageManipulationTooltip"}}" aria-label="{{t "imageManipulationTooltip"}}">','<i class="material-icons">tune</i>',"</a>","</div>","{{/if}}","</div>","{{#if showNextPrev}}",'<a class="mirador-osd-next hud-control ">','<i class="fa fa-3x fa-chevron-right"></i>',"</a>","{{/if}}","{{#if showBottomPanel}}",'<a class="mirador-osd-toggle-bottom-panel hud-control" role="button" aria-label="Toggle Bottom Panel">','<i class="fa fa-2x fa-ellipsis-h"></i>',"</a>","{{/if}}",'<div class="mirador-pan-zoom-controls hud-control">','<a class="mirador-osd-up hud-control" role="button" aria-label="Move image up">','<i class="fa fa-chevron-circle-up"></i>',"</a>",'<a class="mirador-osd-right hud-control" role="button" aria-label="Move image right">','<i class="fa fa-chevron-circle-right"></i>',"</a>",'<a class="mirador-osd-down hud-control" role="button" aria-label="Move image down">','<i class="fa fa-chevron-circle-down"></i>',"</a>",'<a class="mirador-osd-left hud-control" role="button" aria-label="Move image left">','<i class="fa fa-chevron-circle-left"></i>',"</a>",'<a class="mirador-osd-zoom-in hud-control" role="button" aria-label="Zoom in">','<i class="fa fa-plus-circle"></i>',"</a>",'<a class="mirador-osd-zoom-out hud-control" role="button" aria-label="Zoom out">','<i class="fa fa-minus-circle"></i>',"</a>",'<a class="mirador-osd-go-home hud-control" role="button" aria-label="Reset image bounds">','<i class="fa fa-home"></i>',"</a>","</div>","</div>"].join(""))}}(Mirador),function($){$.ImageView=function(options){jQuery.extend(this,{currentImg:null,windowId:null,currentImgIndex:0,canvasID:null,canvases:null,imagesList:[],imagesListRtl:[],element:null,elemOsd:null,manifest:null,osd:null,osdOptions:{osdBounds:null,zoomLevel:null},osdCls:"mirador-osd",elemAnno:null,annoCls:"annotation-canvas",annotationsLayer:null,forceShowControls:!1,eventEmitter:null,vDirectionStatus:""},options),this.init()},$.ImageView.prototype={init:function(){this.horizontallyFlipped=!1,this.originalDragHandler=null,"rtl"==this.vDirectionStatus&&(this.imagesList=this.imagesListRtl.concat()),null!==this.canvasID&&(this.currentImgIndex=$.getImageIndexById(this.imagesList,this.canvasID)),this.osdOptions||(this.osdOptions={osdBounds:null,zoomLevel:null}),this.currentImg=this.imagesList[this.currentImgIndex],this.element=jQuery(this.template()).appendTo(this.appendTo),this.elemAnno=jQuery("<div/>").addClass(this.annoCls).appendTo(this.element),this.eventEmitter.publish("UPDATE_FOCUS_IMAGES."+this.windowId,{array:[this.canvasID]});var allTools=$.getTools(this.state.getStateProperty("drawingToolsSettings"));this.availableAnnotationTools=[];for(var i=0;i<this.state.getStateProperty("availableAnnotationDrawingTools").length;i++)for(var j=0;j<allTools.length;j++)if(this.state.getStateProperty("availableAnnotationDrawingTools")[i]==allTools[j].name){var values={};values.logoClass=allTools[j].logoClass,values.tooltip=allTools[j].tooltip,this.availableAnnotationTools.push(values)}this.hud=new $.Hud({appendTo:this.element,qtipElement:this.qtipElement,bottomPanelAvailable:this.bottomPanelAvailable,windowId:this.windowId,canvasControls:this.canvasControls,annoEndpointAvailable:this.annoEndpointAvailable,showNextPrev:1!==this.imagesList.length,availableAnnotationStylePickers:this.state.getStateProperty("availableAnnotationStylePickers"),availableAnnotationTools:this.availableAnnotationTools,state:this.state,eventEmitter:this.eventEmitter}),this.initialiseImageCanvas(),this.bindEvents(),this.listenForActions(),void 0===this.bottomPanelAvailable||this.bottomPanelAvailable?this.eventEmitter.publish("SET_BOTTOM_PANEL_VISIBILITY."+this.windowId,null):this.eventEmitter.publish("SET_BOTTOM_PANEL_VISIBILITY."+this.windowId,!1)},template:$.Handlebars.compile(['<div class="image-view">',"</div>"].join("")),listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("bottomPanelSet."+_this.windowId,function(event,visible){var dodgers=_this.element.find(".mirador-osd-toggle-bottom-panel, .mirador-pan-zoom-controls"),arrows=_this.element.find(".mirador-osd-next, .mirador-osd-previous");!0===visible?(dodgers.addClass("bottom-panel-open"),arrows.addClass("bottom-panel-open")):(dodgers.removeClass("bottom-panel-open"),arrows.removeClass("bottom-panel-open"))}),_this.eventEmitter.subscribe("fitBounds."+_this.windowId,function(event,bounds){var rect=new OpenSeadragon.Rect(bounds.x,bounds.y,bounds.width,bounds.height);_this.osd.viewport.fitBoundsWithConstraints(rect,!1)}),_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,_this.currentCanvasIDUpdated.bind(_this)),_this.eventEmitter.subscribe("image-needed"+_this.windowId,_this.loadImage.bind(_this)),_this.eventEmitter.subscribe("image-show"+_this.windowId,_this.showImage.bind(_this)),_this.eventEmitter.subscribe("image-hide"+_this.windowId,_this.hideImage.bind(_this)),_this.eventEmitter.subscribe("image-removed"+_this.windowId,_this.removeImage.bind(_this)),_this.eventEmitter.subscribe("image-opacity-updated"+_this.windowId,_this.updateImageOpacity.bind(_this)),_this.eventEmitter.subscribe("HUD_REMOVE_CLASS."+_this.windowId,function(event,elementSelector,className){_this.element.find(elementSelector).removeClass(className)}),_this.eventEmitter.subscribe("HUD_ADD_CLASS."+_this.windowId,function(event,elementSelector,className){_this.element.find(elementSelector).addClass(className)}),_this.eventEmitter.subscribe("HUD_FADE_IN."+_this.windowId,function(event,elementSelector,duration){_this.element.find(elementSelector).fadeIn(duration)}),_this.eventEmitter.subscribe("HUD_FADE_OUT."+_this.windowId,function(event,elementSelector,duration,complete){_this.element.find(elementSelector).fadeOut(duration,complete)}),_this.eventEmitter.subscribe("DEFAULT_CURSOR."+_this.windowId,function(event){jQuery(_this.osd.canvas).css("cursor","default")}),_this.eventEmitter.subscribe("CROSSHAIR_CURSOR."+_this.windowId,function(event){jQuery(_this.osd.canvas).css("cursor","crosshair")}),_this.eventEmitter.subscribe("POINTER_CURSOR."+_this.windowId,function(event){jQuery(_this.osd.canvas).css("cursor","pointer")})},bindEvents:function(){function setFilterCSS(){var filterCSS=jQuery.map(filterValues,function(value,key){return value}).join(" ");jQuery(_this.osd.drawer.canvas).css({filter:filterCSS,"-webkit-filter":filterCSS,"-moz-filter":filterCSS,"-o-filter":filterCSS,"-ms-filter":filterCSS})}function resetImageManipulationControls(){_this.osd&&_this.osd.viewport.setRotation(0),filterValues.brightness="brightness(100%)",_this.element.find(".mirador-osd-brightness-slider").slider("option","value",100),_this.element.find(".mirador-osd-brightness-slider").find(".percent").text("100%"),filterValues.contrast="contrast(100%)",_this.element.find(".mirador-osd-contrast-slider").slider("option","value",100),_this.element.find(".mirador-osd-contrast-slider").find(".percent").text("100%"),filterValues.saturate="saturate(100%)",_this.element.find(".mirador-osd-saturation-slider").slider("option","value",100),_this.element.find(".mirador-osd-saturation-slider").find(".percent").text("100%"),filterValues.grayscale="grayscale(0%)",_this.element.find(".mirador-osd-grayscale").removeClass("selected"),filterValues.invert="invert(0%)",_this.element.find(".mirador-osd-invert").removeClass("selected"),jQuery(_this.osd.canvas).removeClass("mirador-mirror"),_this.originalDragHandler&&(_this.osd.viewport.viewer.innerTracker.dragHandler=_this.originalDragHandler),setFilterCSS()}var _this=this;this.element.find(".mirador-osd-next").on("click",function(){_this.next()}),this.element.find(".mirador-osd-previous").on("click",function(){_this.previous()}),this.element.find(".mirador-osd-annotations-layer").on("click",function(){"none"===_this.hud.annoState.current&&_this.hud.annoState.startup(this),"off"===_this.hud.annoState.current?(_this.hud.annoState.displayOn(this),_this.annotationState="on"):(_this.forceShowControls=!1,_this.hud.annoState.displayOff(this),_this.annotationState="off")}),this.element.find(".mirador-manipulation-toggle").on("click",function(){"none"===_this.hud.manipulationState.current&&_this.hud.manipulationState.startup(this),"manipulationOff"===_this.hud.manipulationState.current?_this.hud.manipulationState.displayOn(this):_this.hud.manipulationState.displayOff(this)}),this.element.find(".mirador-osd-go-home").on("click",function(){_this.osd.viewport.goHome()}),this.element.find(".mirador-osd-up").on("click",function(){var panBy=_this.getPanByValue();_this.osd.viewport.panBy(new OpenSeadragon.Point(0,-panBy.y)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-right").on("click",function(){var panBy=_this.getPanByValue();_this.horizontallyFlipped?_this.osd.viewport.panBy(new OpenSeadragon.Point(-panBy.x,0)):_this.osd.viewport.panBy(new OpenSeadragon.Point(panBy.x,0)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-down").on("click",function(){var panBy=_this.getPanByValue();_this.osd.viewport.panBy(new OpenSeadragon.Point(0,panBy.y)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-left").on("click",function(){var panBy=_this.getPanByValue();_this.horizontallyFlipped?_this.osd.viewport.panBy(new OpenSeadragon.Point(panBy.x,0)):_this.osd.viewport.panBy(new OpenSeadragon.Point(-panBy.x,0)),_this.osd.viewport.applyConstraints()}),this.element.find(".mirador-osd-zoom-in").on("click",function(){var osd=_this.osd;osd.viewport&&(osd.viewport.zoomBy(osd.zoomPerClick/1),osd.viewport.applyConstraints())}),this.element.find(".mirador-osd-zoom-out").on("click",function(){var osd=_this.osd;osd.viewport&&(osd.viewport.zoomBy(1/osd.zoomPerClick),osd.viewport.applyConstraints())}),this.element.find(".mirador-osd-toggle-bottom-panel").on("click",function(){_this.eventEmitter.publish("TOGGLE_BOTTOM_PANEL_VISIBILITY."+_this.windowId)}),this.element.find(".mirador-osd-edit-mode").on("click",function(){var shape=jQuery(this).find(".material-icons").html();"pointer"===_this.hud.annoState.current?_this.hud.annoState.chooseShape(shape):_this.hud.annoState.changeShape(shape),_this.forceShowControls=!0,_this.element.find(".hud-control").stop(!0,!0).removeClass("hidden",_this.state.getStateProperty("fadeDuration"))}),this.element.find(".mirador-osd-pointer-mode").on("click",function(){"shape"===_this.hud.annoState.current&&(_this.hud.annoState.choosePointer(),_this.forceShowControls=!1)}),this.element.find(".mirador-osd-refresh-mode").on("click",function(){_this.eventEmitter.publish("updateAnnotationList."+_this.windowId)});var filterValues={brightness:"brightness(100%)",contrast:"contrast(100%)",saturate:"saturate(100%)",grayscale:"grayscale(0%)",invert:"invert(0%)"};this.element.find(".mirador-osd-rotate-right").on("click",function(){if(_this.osd){var currentRotation=_this.osd.viewport.getRotation();_this.osd.viewport.setRotation(currentRotation+90)}}),this.element.find(".mirador-osd-rotate-left").on("click",function(){if(_this.osd){var currentRotation=_this.osd.viewport.getRotation();_this.osd.viewport.setRotation(currentRotation-90)}}),this.element.find(".mirador-osd-brightness-slider").slider({orientation:"vertical",range:"min",min:0,max:200,value:100,create:function(event,ui){var v=jQuery(this).slider("value"),span=jQuery('<span class="percent">').text(v+"%");jQuery(this).find(".ui-slider-handle").append(span)},slide:function(event,ui){filterValues.brightness="brightness("+ui.value+"%)",setFilterCSS(),jQuery(this).find(".percent").text(ui.value+"%")}}).hide(),this.element.find(".mirador-osd-brightness").on("mouseenter",function(){_this.element.find(".mirador-osd-brightness-slider").stop(!0,!0).show()}).on("mouseleave",function(){_this.element.find(".mirador-osd-brightness-slider").stop(!0,!0).hide()}),this.element.find(".mirador-osd-contrast-slider").slider({orientation:"vertical",range:"min",min:0,max:200,value:100,create:function(event,ui){var v=jQuery(this).slider("value"),span=jQuery('<span class="percent">').text(v+"%");jQuery(this).find(".ui-slider-handle").append(span)},slide:function(event,ui){filterValues.contrast="contrast("+ui.value+"%)",setFilterCSS(),jQuery(this).find(".percent").text(ui.value+"%")}}).hide(),this.element.find(".mirador-osd-contrast").on("mouseenter",function(){_this.element.find(".mirador-osd-contrast-slider").stop(!0,!0).show()}).on("mouseleave",function(){_this.element.find(".mirador-osd-contrast-slider").stop(!0,!0).hide()}),this.element.find(".mirador-osd-saturation-slider").slider({orientation:"vertical",range:"min",min:0,max:200,value:100,create:function(event,ui){var v=jQuery(this).slider("value"),span=jQuery('<span class="percent">').text(v+"%");jQuery(this).find(".ui-slider-handle").append(span)},slide:function(event,ui){filterValues.saturate="saturate("+ui.value+"%)",setFilterCSS(),jQuery(this).find(".percent").text(ui.value+"%")}}).hide(),this.element.find(".mirador-osd-saturation").on("mouseenter",function(){_this.element.find(".mirador-osd-saturation-slider").stop(!0,!0).show()}).on("mouseleave",function(){_this.element.find(".mirador-osd-saturation-slider").stop(!0,!0).hide()}),this.element.find(".mirador-osd-grayscale").on("click",function(){jQuery(this).hasClass("selected")?(filterValues.grayscale="grayscale(0%)",jQuery(this).removeClass("selected")):(filterValues.grayscale="grayscale(100%)",jQuery(this).addClass("selected")),setFilterCSS()}),this.element.find(".mirador-osd-invert").on("click",function(){jQuery(this).hasClass("selected")?(filterValues.invert="invert(0%)",jQuery(this).removeClass("selected")):(filterValues.invert="invert(100%)",jQuery(this).addClass("selected")),setFilterCSS()}),this.element.find(".mirador-osd-mirror").on("click",function(){if(_this.originalDragHandler||(_this.originalDragHandler=_this.osd.viewport&&_this.osd.viewport.viewer.innerTracker.dragHandler),jQuery(this).hasClass("selected"))jQuery(_this.osd.canvas).removeClass("mirador-mirror"),jQuery(this).removeClass("selected"),_this.eventEmitter.publish("disableManipulation","mirror"),_this.osd.viewport&&(_this.osd.viewport.viewer.innerTracker.dragHandler=_this.originalDragHandler),_this.horizontallyFlipped=!1;else{if(jQuery(_this.osd.canvas).addClass("mirador-mirror"),jQuery(this).addClass("selected"),_this.eventEmitter.publish("enableManipulation","mirror"),_this.osd.viewport){var viewer=_this.osd.viewport.viewer;viewer.innerTracker.dragHandler=OpenSeadragon.delegate(viewer,function(event){event.delta.x=-event.delta.x,_this.originalDragHandler(event)})}_this.horizontallyFlipped=!0}}),this.element.find(".mirador-osd-reset").on("click",function(){resetImageManipulationControls()}),this.eventEmitter.subscribe("resetImageManipulationControls."+this.windowId,function(){resetImageManipulationControls()})},currentCanvasIDUpdated:function(event,canvasId){var firstCanvasId=this.imagesList[0]["@id"],lastCanvasId=this.imagesList[this.imagesList.length-1]["@id"];canvasId===firstCanvasId?(this.element.find(".mirador-osd-previous").hide(),this.element.find(".mirador-osd-next").show()):canvasId===lastCanvasId?(this.element.find(".mirador-osd-next").hide(),this.element.find(".mirador-osd-previous").show()):(this.element.find(".mirador-osd-next").show(),this.element.find(".mirador-osd-previous").show())},loadImage:function(event,imageResource){var _this=this;if("drawn"!==imageResource.status){imageResource.setStatus("requested");var bounds=imageResource.getGlobalBounds();_this.osd.addTiledImage({x:bounds.x,y:bounds.y,width:bounds.width,tileSource:imageResource.tileSource,opacity:imageResource.opacity,clip:imageResource.clipRegion,index:imageResource.zIndex,success:function(event){var tiledImage=event.item;imageResource.osdTiledImage=tiledImage,imageResource.setStatus("loaded"),_this.syncAllImageResourceProperties(imageResource);var tileDrawnHandler=function(event){event.tiledImage===tiledImage&&(imageResource.setStatus("drawn"),_this.osd.removeHandler("tile-drawn",tileDrawnHandler))};_this.osd.addHandler("tile-drawn",tileDrawnHandler)},error:function(event){imageResource.setStatus("failed")}})}},showImage:function(event,imageResource){"drawn"===imageResource.getStatus()&&this.updateImageOpacity(null,imageResource)},hideImage:function(event,imageResource){"drawn"===imageResource.getStatus()&&imageResource.osdTiledImage.setOpacity(0)},removeImage:function(){},updateImageOpacity:function(event,imageResource){imageResource.osdTiledImage&&imageResource.osdTiledImage.setOpacity(imageResource.opacity*imageResource.parent.getOpacity())},syncAllImageResourceProperties:function(imageResource){if(imageResource.osdTiledImage){var bounds=imageResource.getGlobalBounds();imageResource.osdTiledImage.setPosition({x:bounds.x,y:bounds.y},!0),imageResource.osdTiledImage.setWidth(bounds.width,!0),imageResource.osdTiledImage.setOpacity(imageResource.getOpacity()*imageResource.parent.getOpacity())}},getPanByValue:function(){var bounds=this.osd.viewport.getBounds(!0);return{x:.5*bounds.width,y:.5*bounds.height}},setBounds:function(){this.osdOptions.osdBounds=this.osd.viewport.getBounds(!0),this.eventEmitter.publish("imageBoundsUpdated",{id:this.windowId,osdBounds:{x:this.osdOptions.osdBounds.x,y:this.osdOptions.osdBounds.y,width:this.osdOptions.osdBounds.width,height:this.osdOptions.osdBounds.height}});var rectangle=this.osdOptions.osdBounds;this.eventEmitter.publish("imageRectangleUpdated",{id:this.windowId,osdBounds:{x:Math.round(rectangle.x),y:Math.round(rectangle.y),width:Math.round(rectangle.width),height:Math.round(rectangle.height)},warning:"Warning, image rectangle now based on canvas dimensions, not the constituent images."})},toggle:function(stateValue){stateValue?this.show():this.hide()},hide:function(){jQuery(this.element).hide({effect:"fade",duration:300,easing:"easeOutCubic"})},show:function(){jQuery(this.element).show({effect:"fade",duration:300,easing:"easeInCubic",complete:function(){jQuery(this).css("display","block")}})},adjustWidth:function(className,hasClass){hasClass?this.eventEmitter.publish("REMOVE_CLASS."+this.windowId,className):this.eventEmitter.publish("ADD_CLASS."+this.windowId,className)},adjustHeight:function(className,hasClass){hasClass?this.element.removeClass(className):this.element.addClass(className)},initialiseImageCanvas:function(){var _this=this,osdID="mirador-osd-"+$.genUUID(),canvasModel=_this.canvases[_this.canvasID];_this.elemOsd=jQuery("<div/>").addClass(_this.osdCls).attr("id",osdID).appendTo(_this.element),_this.osd=$.OpenSeadragon({id:osdID,uniqueID:osdID,preserveViewport:!0,blendTime:.1,alwaysBlend:!1,showNavigationControl:!1});var canvasBounds=canvasModel.getBounds(),rect=new OpenSeadragon.Rect(canvasBounds.x,canvasBounds.y,canvasBounds.width,canvasBounds.height);if(_this.osd.viewport.fitBounds(rect,!0),canvasModel.show(),canvasModel.getVisibleImages().forEach(function(imageResource){_this.loadImage(null,imageResource)}),_this.osd.addHandler("zoom",$.debounce(function(){var point={x:-1e7,y:-1e7};_this.eventEmitter.publish("updateTooltips."+_this.windowId,[point,point])},30)),_this.osd.addHandler("pan",$.debounce(function(){var point={x:-1e7,y:-1e7};_this.eventEmitter.publish("updateTooltips."+_this.windowId,[point,point])},30)),_this.eventEmitter.publish("osdOpen."+_this.windowId),_this.addAnnotationsLayer(_this.elemAnno),_this.osdOptions.osdBounds){var newBounds=new OpenSeadragon.Rect(_this.osdOptions.osdBounds.x,_this.osdOptions.osdBounds.y,_this.osdOptions.osdBounds.width,_this.osdOptions.osdBounds.height);_this.osd.viewport.fitBounds(newBounds,!0)}else _this.setBounds();var originalState=_this.hud.annoState.current,selected=_this.element.find(".mirador-osd-edit-mode.selected"),shape=null;selected&&(shape=selected.find(".material-icons").html()),"none"===originalState?_this.hud.annoState.startup():"off"===originalState||"off"===_this.annotationState||_this.hud.annoState.displayOff(),"pointer"===originalState||"on"===_this.annotationState?_this.hud.annoState.displayOn():"shape"===originalState&&(_this.hud.annoState.displayOn(),_this.hud.annoState.chooseShape(shape)),_this.osd.addHandler("zoom",$.debounce(function(){_this.setBounds()},500)),_this.osd.addHandler("pan",$.debounce(function(){_this.setBounds()},500))},addAnnotationsLayer:function(element){this.annotationsLayer=new $.AnnotationsLayer({state:this.state,annotationsList:this.state.getWindowAnnotationsList(this.windowId)||[],viewer:this.osd,windowId:this.windowId,element:element,eventEmitter:this.eventEmitter})},updateImage:function(canvasID){if(this.canvasID!==canvasID){this.canvases[this.canvasID].getVisibleImages().forEach(function(imageResource){imageResource.hide()}),this.canvasID=canvasID,this.currentImgIndex=$.getImageIndexById(this.imagesList,canvasID),this.currentImg=this.imagesList[this.currentImgIndex];var newCanvas=this.canvases[this.canvasID],canvasBounds=newCanvas.getBounds(),rect=new OpenSeadragon.Rect(canvasBounds.x,canvasBounds.y,canvasBounds.width,canvasBounds.height);this.osd.viewport.fitBounds(rect,!0),newCanvas.show(),this.osdOptions={osdBounds:null,zoomLevel:null},this.eventEmitter.publish("resetImageManipulationControls."+this.windowId)}this.eventEmitter.publish("UPDATE_FOCUS_IMAGES."+this.windowId,{array:[canvasID]})},next:function(){var next=this.currentImgIndex+1;next<this.imagesList.length&&this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+this.windowId,this.imagesList[next]["@id"])},previous:function(){var prev=this.currentImgIndex-1;prev>=0&&this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+this.windowId,this.imagesList[prev]["@id"])}}}(Mirador),function($){$.LayersTab=function(options){jQuery.extend(!0,this,{windowId:null,element:null,appendTo:null,manifest:null,visible:null,state:null,eventEmitter:null,canvasID:null,canvases:null},options),this.init()},$.LayersTab.prototype={init:function(){this.localState({id:"layersTab",visible:this.visible,active:!0,canvasID:this.canvasID,empty:!1},!0),this.render(this.localState()),this.bindEvents(),this.listenForActions()},localState:function(state,initial){return arguments.length?(this.layerTabState=state,initial||this.eventEmitter.publish("layersTabStateUpdated."+this.windowId,this.layerTabState),this.layerTabState):this.layerTabState},tabStateUpdated:function(visible){var localState=this.localState();localState.visible=visible,this.localState(localState)},canvasIdUpdated:function(event,canvasID){var localState=this.localState();localState.canvasID=canvasID,this.localState(localState)},imageFocusUpdated:function(focus){var localState=this.localState();localState.active="ImageView"===focus,this.localState(localState)},updateImageResourceStatus:function(event,imageResource){var _this=this;["loaded","requested","initialized","drawn"].forEach(function(statusString){_this.element.find('.layers-list-item[data-imageid="'+imageResource.id+'"]').removeClass(statusString)}),this.element.find('.layers-list-item[data-imageid="'+imageResource.id+'"]').addClass(imageResource.getStatus())},showImageResource:function(event,imageResource){this.element.find('.visibility-toggle[data-imageid="'+imageResource.id+'"]').prop("checked",!0),this.element.find('.opacity-slider[data-imageid="'+imageResource.id+'"]').prop("disabled",!1),this.element.find('.opacity-label[data-imageid="'+imageResource.id+'"]').removeClass("disabled").text("("+Math.ceil(100*imageResource.getOpacity())+")%")},hideImageResource:function(event,imageResource){this.element.find('.visibility-toggle[data-imageid="'+imageResource.id+'"]').prop("checked",!1),this.element.find('.opacity-slider[data-imageid="'+imageResource.id+'"]').prop("disabled",!0),this.element.find('.opacity-label[data-imageid="'+imageResource.id+'"]').addClass("disabled").text("("+i18next.t("disabledOpacityMessage")+")")},updateImageResourceOpacity:function(event,imageResource){this.element.find('.opacity-slider[data-imageid="'+imageResource.id+'"]').val(100*imageResource.getOpacity()),this.element.find('.opacity-label[data-imageid="'+imageResource.id+'"]').text("("+Math.ceil(100*imageResource.getOpacity())+")%")},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("layersTabStateUpdated."+_this.windowId,function(_,data){_this.render(data)}),_this.eventEmitter.subscribe("tabStateUpdated."+_this.windowId,function(_,data){var visible="layersTab"===data.tabs[data.selectedTabIndex].options.id;_this.tabStateUpdated(visible)}),_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,_this.canvasIdUpdated.bind(_this)),_this.eventEmitter.subscribe("image-status-updated"+_this.windowId,_this.updateImageResourceStatus.bind(_this)),_this.eventEmitter.subscribe("image-show"+_this.windowId,_this.showImageResource.bind(_this)),_this.eventEmitter.subscribe("image-hide"+_this.windowId,_this.hideImageResource.bind(_this)),_this.eventEmitter.subscribe("image-opacity-updated"+_this.windowId,_this.updateImageResourceOpacity.bind(_this)),_this.eventEmitter.subscribe("focusUpdated"+_this.windowId,function(event,focus){_this.imageFocusUpdated(focus)})},bindEvents:function(){var _this=this;this.element.find("img").on("load",function(event){jQuery(this).addClass("loaded"),jQuery(this).closest(".thumb-container").removeClass("awaiting-thumbnail")}),this.element.find("img").on("error",function(event){jQuery(this).addClass("failed"),jQuery(this).closest(".thumb-container").removeClass("awaiting-thumbnail"),jQuery(this).closest(".thumb-container").addClass("thumb-failed")}),this.element.on("input",".opacity-slider",function(event){_this.canvases[_this.localState().canvasID].getImageById(event.currentTarget.attributes["data-imageid"].nodeValue).setOpacity(event.currentTarget.value/100)}),this.element.on("change",".visibility-toggle",function(event){var eventedImageResource=_this.canvases[_this.localState().canvasID].getImageById(event.currentTarget.attributes["data-imageid"].nodeValue);event.currentTarget.checked?eventedImageResource.show():eventedImageResource.hide()})},render:function(state){var canvasModel=this.canvases[state.canvasID],templateData={active:state.active?"":"inactive",imagesFor:i18next.t("imagesFor"),hasLayers:canvasModel.images.length>0,canvasTitle:canvasModel.label,disabledLayersTabMessage:i18next.t("disabledLayersTabMessage"),layers:canvasModel.images.map(function(imageResource){return{visibleLabel:i18next.t("visibleLabel"),opacityLabel:i18next.t("opacityLabel"),disabledOpacityMessage:i18next.t("disabledOpacityMessage"),emptyTemplateMessage:i18next.t("emptyTemplateMessage"),imageId:imageResource.id,title:"No Label"===imageResource.label?i18next.t("noLabel"):imageResource.label,opacity:100*imageResource.getOpacity(),loadingStatus:imageResource.getStatus(),visibility:imageResource.getVisible(),url:imageResource.thumbUrl}})};this.element&&this.appendTo.find(".layersPanel").remove(),this.element=jQuery(this.template(templateData)).appendTo(this.appendTo),this.bindEvents(),state.visible?this.element.show():this.element.hide()},template:$.Handlebars.compile(['<div class="layersPanel {{active}}">',"<h3>{{imagesFor}} {{canvasTitle}}</h3>","{{#if hasLayers}}",'<ul class="layers-listing">',"{{#each layers}}",'<li class="layers-list-item {{loadingStatus}}" data-imageid="{{imageId}}">',"<h4>{{this.title}}</h4>",'<div class="thumb-container awaiting-thumbnail">','<img class="layer-thumb" src="{{url}}" alt="{{canvasTitle}} title="{{canvasTitle}}">','<span class="spinner"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i></span>','<span class="failed"><i class="fa fa-ban fa-3x fa-fw"></i></span>','<span class="thumb-failed"><i class="fa fa-picture-o fa-3x fa-fw"></i></span>',"</div>","<form>","<div>",'<input class="visibility-toggle" data-imageid="{{imageId}}" type=checkbox {{#if visibility}}checked{{/if}}>',"<label> {{this.visibleLabel}}</label>","</div>",'<label>{{this.opacityLabel}} <span class="opacity-label {{#unless visibility}}disabled{{/unless}}" data-imageid="{{imageId}}">',"{{#unless visibility}}({{this.dsabledOpacityLabel}}){{else}}({{opacity}})%{{/unless}}","</span></label>",'<input class="opacity-slider" data-imageid="{{imageId}}" type="range" min="0" max="100" step="2" value="{{opacity}}" {{#unless visibility}}disabled{{/unless}}>',"</form>","</li>","{{/each}}","</ul>","{{else}}","<h4>{{emptyTemplateMessage}}</h4>","{{/if}}",'<div class="disabled-overlay">',"<h3>{{disabledLayersTabMessage}}</h3>","</div>","</div>"].join(""))}}(Mirador),function($){$.MetadataView=function(options){jQuery.extend(this,{manifest:null,element:null,metadataTypes:null,metadataListingCls:"metadata-listing"},options),this.init()},$.MetadataView.prototype={init:function(){var _this=this,tplData={metadataListingCls:this.metadataListingCls};if(_this.manifest=_this.manifest.jsonLd,this.metadataTypes={},this.metadataTypes.details=_this.getMetadataDetails(_this.manifest),this.metadataTypes.rights=_this.getMetadataRights(_this.manifest),this.metadataTypes.links=_this.getMetadataLinks(_this.manifest),jQuery.each(this.metadataTypes,function(metadataKey,metadataValues){tplData[metadataKey]=[],jQuery.each(metadataValues,function(idx,itm){"object"==typeof itm.value&&(itm.value=_this.stringifyObject(itm.value)),"string"==typeof itm.value&&""!==itm.value&&tplData[metadataKey].push({identifier:itm.identifier||"",label:_this.extractLabelFromAttribute(itm.label),value:"links"===metadataKey?itm.value:_this.addLinksToUris(itm.value)})})}),_this.manifest.logo){var logo="";"string"==typeof _this.manifest.logo?logo=_this.manifest.logo:void 0!==_this.manifest.logo["@id"]&&(logo=_this.manifest.logo["@id"]),tplData.logo=logo}this.element=jQuery(this.template(tplData)).appendTo(this.appendTo),this.bindEvents()},stringifyObject:function(obj,nestingMargin){var str,_this=this,first=!0;if(obj instanceof RegExp)return"/"+obj.source+"/";if(void 0===nestingMargin&&(nestingMargin=0),obj instanceof Array)return str="[ ",jQuery.each(obj,function(i,item){str+=(0===i?"":", ")+_this.stringifyObject(item,nestingMargin+15)}),str+" ]";if("object"==typeof obj&&"sc:Collection"===obj["@type"]){var collectionUrl=obj["@id"];return'<a href="'+collectionUrl+'" target="_blank">'+(obj.label||collectionUrl)+"</a>"}if("object"==typeof obj){str='<div style="margin-left:'+nestingMargin+'px">';for(var i in obj)obj.hasOwnProperty(i)&&(str+=(first?"":"<br/>")+i+": "+_this.stringifyObject(obj[i],nestingMargin+15),first=!1);return str+"</div>"}return obj.toString()},stringifyRelated:function(obj){var str,next,label,format,_this=this;return obj instanceof Array?(str="",jQuery.each(obj,function(i,item){""!==(next=_this.stringifyRelated(item))&&(str+=(0===i?"":"<br/>")+next)}),str):"object"==typeof obj&&"@id"in obj?(label="label"in obj?obj.label:obj["@id"],format="format"in obj&&"text/html"!==obj.format?"("+obj.format+")":"",'<a href="'+obj["@id"]+'"  target="_blank">'+label+"</a> "+format):_this.addLinksToUris(obj.toString())},getMetadataDetails:function(jsonLd){var mdList=[{label:i18next.t("label"),value:"<b>"+($.JsonLd.getTextValue(jsonLd.label)||"")+"</b>"},{label:i18next.t("description"),value:$.JsonLd.getTextValue(jsonLd.description)||""}];return jsonLd.metadata&&(value="",label="",jQuery.each(jsonLd.metadata,function(index,item){label=$.JsonLd.getTextValue(item.label),value=$.JsonLd.getTextValue(item.value),mdList.push({label:label,value:value})})),mdList},getMetadataRights:function(jsonLd){return[{identifier:"license",label:i18next.t("license"),value:jsonLd.license||""},{identifier:"attribution",label:i18next.t("attribution"),value:$.JsonLd.getTextValue(jsonLd.attribution)||""}]},getMetadataLinks:function(jsonLd){return[{identifier:"related",label:i18next.t("related"),value:this.stringifyRelated(jsonLd.related||"")},{identifier:"seeAlso",label:i18next.t("seeAlso"),value:this.stringifyRelated(jsonLd.seeAlso||"")},{identifier:"manifest",label:i18next.t("manifest"),value:this.stringifyRelated(jsonLd["@id"]||"")},{identifier:"within",label:i18next.t("within"),value:this.getWithin(jsonLd.within||"")}]},getWithin:function(within){if("object"==typeof within&&"sc:Collection"===within["@type"]){var collectionUrl=within["@id"];return'<a href="'+collectionUrl+'" target="_blank">'+(within.label||collectionUrl)+"</a>"}return within instanceof Array?within.map(this.getWithin,this).join("<br/>"):this.stringifyObject(within)},extractLabelFromAttribute:function(attr){var label=attr;return label=label.replace(/^@/,""),label=label.replace(/\s{2,}/g," ")},bindEvents:function(){},toggle:function(stateValue){stateValue?this.show():this.hide()},show:function(){var element=jQuery(this.element);this.panel&&(element=element.parent()),element.show({effect:"slide",direction:"right",duration:300,easing:"swing"})},hide:function(){var element=jQuery(this.element);this.panel&&(element=element.parent()),element.hide({effect:"slide",direction:"right",duration:300,easing:"swing"})},addLinksToUris:function(text){var matches,parsedTextWithLinks,textWithLinks=text;return"string"==typeof text&&(-1===textWithLinks.indexOf("<a ")?(matches=text.match(/(http|ftp|https):\/\/[\w\-]+(\.[\w\-]+)+([\w.,@?\^=%&amp;:\/~+#\-]*[\w@?\^=%&amp;\/~+#\-])?/gi))&&jQuery.each(matches,function(index,match){textWithLinks=textWithLinks.replace(match,'<a href="'+match+'" target="_blank">'+match+"</a>")}):(parsedTextWithLinks=jQuery("<div />").append(textWithLinks),jQuery(parsedTextWithLinks[0]).find("a").attr("target","_blank"),textWithLinks=parsedTextWithLinks[0].innerHTML)),textWithLinks},template:$.Handlebars.compile(['<div class="sub-title">{{t "details"}}:</div>','<div class="{{metadataListingCls}}">',"{{#each details}}",'<div class="metadata-item"><div class="metadata-label">{{label}}:</div><div class="metadata-value">{{{value}}}</div></div>',"{{/each}}","</div>",'<div class="sub-title">{{t "rights"}}:</div>',"{{#if rights}}",'<div class="{{metadataListingCls}}">',"{{#each rights}}",'<div class="metadata-item {{identifier}}"><div class="metadata-label">{{label}}:</div><div class="metadata-value">{{{value}}}</div></div>',"{{/each}}","{{#if logo}}",'<div class="metadata-item"><div class="metadata-label">{{t "logo"}}:</div><img class="metadata-logo" src="{{logo}}"/></div>',"{{/if}}","</div>","{{else}}",'<div class="{{metadataListingCls}}">','<div class="metadata-item"><div class="metadata-label">{{t "rightsStatus"}}:</div><div class="metadata-value">{{t "unspecified"}}</div></div>',"</div>","{{/if}}","{{#if links}}",'<div class="sub-title">{{t "links"}}:</div>','<div class="{{metadataListingCls}}">',"{{#each links}}",'<div class="metadata-item {{identifier}}"><div class="metadata-label">{{label}}:</div><div class="metadata-value">{{{value}}}</div></div>',"{{/each}}","</dl>","{{/if}}"].join(""),{noEscape:!0})}}(Mirador),function($){$.ScrollView=function(options){jQuery.extend(this,{currentImgIndex:0,canvasID:null,focusImages:[],manifest:null,element:null,imagesList:[],appendTo:null,thumbInfo:{thumbsHeight:150,listingCssCls:"listing-thumbs",thumbnailCls:"thumbnail-view"},windowId:null,panel:!1,vDirectionStatus:"",lazyLoadingFactor:1.5},options),jQuery.extend($.ScrollView.prototype,$.ThumbnailsView.prototype),this.init(),"rtl"==this.vDirectionStatus&&jQuery(this.appendTo).find(".scroll-view").addClass("v-direction-rtl")}}(Mirador),function($){$.SearchTab=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,manifest:null,visible:null,canvasID:null,windowId:null,eventEmitter:null},options),this.init()},$.SearchTab.prototype={init:function(){this.windowId=this.windowId,this.localState({id:"searchTab",visible:this.visible},!0),this.listenForActions(),this.render(this.localState()),this.loadTabComponents()},localState:function(state,initial){return arguments.length?(this.searchTabState=state,initial||this.eventEmitter.publish("searchTabStateUpdated."+this.windowId,this.searchTabState),this.searchTabState):this.searchTabState},loadTabComponents:function(){},tabStateUpdated:function(data){"searchTab"===data.tabs[data.selectedTabIndex].options.id?this.element.show():this.element.hide()},toggle:function(){},listenForActions:function(){var _this=this;this.eventEmitter.subscribe("tabStateUpdated."+_this.windowId,function(_,data){_this.tabStateUpdated(data)})},displaySearchWithin:function(query_params,searchUrl){""!==query_params&&(this.searchObject=new $.SearchWithinResults({manifest:this.manifest,appendTo:this.element.find(".search-results-list"),panel:!0,canvasID:this.canvasID,windowId:this.windowId,imagesList:this.imagesList,thumbInfo:{thumbsHeight:80,listingCssCls:"panel-listing-thumbs",thumbnailCls:"panel-thumbnail-view"},query_params:query_params,searchService:searchUrl,eventEmitter:this.eventEmitter}))},bindEvents:function(){var _this=this;this.element.find(".js-perform-query").on("submit",function(event){event.preventDefault();var query=_this.element.find(".js-query").val(),motivation=_this.element.find(".js-motivation").val(),date=_this.element.find(".js-date").val(),user=_this.element.find(".js-user").val(),searchUrl=_this.element.find("#search-within-selector").val();_this.displaySearchWithin({q:query,motivation:motivation,date:date,user:user},searchUrl)}),this.element.find(".js-search-expand").on("click",function(event){event.preventDefault(),_this.element.find(".js-search-expanded").slideToggle("fast"),jQuery(this).text()===i18next.t("more")?jQuery(this).text(i18next.t("less")):jQuery(this).text()===i18next.t("less")&&jQuery(this).text(i18next.t("more"))})},render:function(state){var searchService=this.manifest.getSearchWithinService(),searchServiceIdArray=searchService&&searchService.map(function(data){return{url:data["@id"],label:data.label}});templateData={searchService:searchServiceIdArray},this.element?(this.appendTo.find(".search-results").remove(),this.element=jQuery(this.template(templateData)).appendTo(this.appendTo)):(this.element=jQuery(this.template(templateData)).appendTo(this.appendTo),this.bindEvents()),state.visible?this.element.show():this.element.hide()},template:$.Handlebars.compile(['<div class="search-results">',"{{#if searchService}}",'<label for="search-within-selector">{{t "searchLabelSelect"}}</label>','<select id="search-within-selector" style="width: 100%">',"{{#each searchService}}",'<option value="{{ url }}">{{#if label}}{{ label }}{{ else }} {{ url }}{{/if}}</option>',"{{/each}}","</select>",'<form id="search-within-form" class="js-perform-query">','<input class="js-query" type="text" placeholder="{{t "searchText"}}"/>','<input style="margin: 10px 0" type="submit" value="{{t "submit"}}"/>','<div style="margin-bottom: 5px"><a class="js-search-expand" href="#">{{t "more"}}</a></div>','<div class="js-search-expanded" style="display: none;">','<input class="js-motivation" type="text" placeholder="motivation"/>','<input class="js-date" type="text" placeholder="date"/>','<input class="js-user" type="text" placeholder="user"/>',"</div>","</form>",'<div class="search-results-list"></div>',"{{else}}",'{{t "searchNotAvailable"}}',"{{/if}}","</div>"].join(""))}}(Mirador),function($){$.SearchWithinResults=function(options){jQuery.extend(this,{manifest:null,element:null,metadataTypes:null,metadataListingCls:"metadata-listing",searchService:null,windowId:null,query_params:null,currentPage:1,eventEmitter:null},options),this.init()},$.SearchWithinResults.prototype={init:function(){this.registerHandlebars(),jQuery(this.appendTo).empty(),this.element=jQuery(this.template()).appendTo(this.appendTo),jQuery("<h3>Search results for: "+this.query_params.q+"</h3>").appendTo(this.appendTo.find(".search-results-messages")),this.doSearchFromQuery(this.query_params)},doSearchFromQuery:function(query_params){query_string="";for(var param in query_params)"q"===param?query_string+=param+"="+query_params[param]:query_params[param].length>0&&(query_string+="&"+param+"="+query_params[param]);var url=this.searchService+"?"+query_string;this.doSearchFromUrl(url)},doSearchFromUrl:function(url){var _this=this;this.element.find(".search-results-container").empty(),jQuery.ajax({url:url,dataType:"json",async:!0}).done(function(searchResults){searchResults.resources?(_this.displayResultCounts(searchResults),_this.processResults(searchResults)):jQuery(".search-results-count").html("<p>No results</p>")}).fail(function(){jQuery(".search-results-count").html("<p>No results</p>")}).always()},displayResultCounts:function(searchResults){var total=searchResults.within.total,startResultNumber=searchResults.startIndex+1,endResultNumber="";endResultNumber=searchResults.resources.constructor===Array?searchResults.startIndex+searchResults.resources.length:searchResults.startIndex+1,jQuery(".search-results-count").html("<p>Showing "+startResultNumber+" - "+endResultNumber+" out of "+total+"</p>")},processResults:function(searchResults){searchResults.hits?this.tplData=this.getHits(searchResults):this.tplData=this.getSearchAnnotations(searchResults),jQuery($.Handlebars.compile("{{> resultsList }}")(this.tplData)).appendTo(jQuery(this.element.find(".search-results-container"))),this.bindEvents(),this.setPager(searchResults)},needsPager:function(results){if(!results||!results.within||!results.resources)return!1;var total=results.within.total;return Array.isArray(results.resources)?results.resources.length<total:total>1},setPager:function(searchResults){var _this=this,pager=this.element.find(".search-results-pager");this.needsPager(searchResults)&&pager.pagination&&(this.onPageCount||(this.onPageCount=searchResults.resources.length),pager.pagination({items:searchResults.within.total,itemsOnPage:_this.onPageCount,currentPage:_this.currentPage,displayedPages:1,edges:1,ellipsePageSet:!1,cssStyle:"compact-theme",hrefTextPrefix:"",prevText:'<i class="fa fa-lg fa-angle-left"></i>',nextText:'<i class="fa fa-lg fa-angle-right"></i>',onPageClick:function(pageNumber,event){event.preventDefault(),pager.pagination("disable"),pageNumber==_this.currentPage-1?(_this.currentPage--,_this.doSearchFromUrl(searchResults.prev)):pageNumber==_this.currentPage+1?(_this.currentPage++,_this.doSearchFromUrl(searchResults.next)):1==pageNumber?(_this.doSearchFromUrl(searchResults.within.first),_this.currentPage=1):(_this.doSearchFromUrl(searchResults.within.last),_this.currentPage=parseInt(_this.element.find(".search-results-pager li:nth-last-child(2)").text()))}}),pager.pagination("enable"))},float2int:function(num){return 0|num},parseSearchAnnotation:function(annotation){var canvasid=annotation.on;"object"==typeof canvasid&&(canvasid=annotation.on["@id"]);var canvaslabel=this.getLabel(annotation),id_parts=this.splitBaseUrlAndCoordinates(canvasid);return{canvasid:id_parts.base,coordinates:id_parts.coords,canvaslabel:canvaslabel,resulttext:annotation.resource.chars}},getSearchAnnotations:function(searchResults){var _this=this;if(tplData=[],null!==searchResults.resources)return Array.isArray(searchResults.resources)?searchResults.resources.forEach(function(annotation){tplData.push(_this.parseSearchAnnotation(annotation))}):(annotation=searchResults.resources,tplData.push(_this.parseSearchAnnotation(annotation))),tplData},getHits:function(searchResults){var _this=this;return tplData=[],searchResults.hits.forEach(function(hit){var resultObject,resultObjects=[];hit.annotations.forEach(function(annotation){var resource=_this.getHitResources(searchResults,annotation)[0],canvasLabel=_this.getLabel(resource),canvasID=resource&&resource.on;"object"==typeof canvasID&&(canvasID=resource.on["@id"]);var canvasIDParts=_this.splitBaseUrlAndCoordinates(canvasID);resultObject={canvasid:canvasIDParts.base,coordinates:canvasIDParts.coords,canvaslabel:canvasLabel,hit:hit},resultObjects.push(resultObject)}),resultObjects&&(resultObject=resultObjects[0],resultObjects.length>1&&(resultObject.annotations=resultObjects),tplData.push(resultObject))}),tplData},getLabel:function(resource){var label;if(resource&&"object"==typeof resource)return resource.label?resource.label:resource.resource.label?resource.resource.label:resource.on&&"string"==typeof resource.on?(label=this.manifest.getCanvasLabel(resource.on))?"Canvas "+label:void 0:resource.on&&"object"==typeof resource.on&&(label=resource.on.label?resource.on.label:this.manifest.getCanvasLabel(resource.on["@id"]))?"Canvas "+label:void 0},getHitResources:function(searchResults,annotationid){return searchResults.resources.filter(function(resource){return resource["@id"]===annotationid})},splitBaseUrlAndCoordinates:function(url){var coordinates,base=url;if("string"==typeof url){var parts=url.split("#");base=parts[0],2===parts.length&&(coordinates=parts[1])}return{base:base,coords:coordinates}},bindEvents:function(){var _this=this;this.element.find(".js-show-canvas").on("click",function(event){event.stopPropagation();var canvasid=jQuery(this).attr("data-canvasid"),coordinates=jQuery(this).attr("data-coordinates"),xywh=coordinates&&coordinates.split("=")[1].split(",").map(Number),bounds=xywh&&{x:xywh[0],y:xywh[1],width:xywh[2],height:xywh[3]};jQuery(".result-wrapper,.result-wrapper *").css("background-color",""),jQuery(this).parent().css("background-color","lightyellow"),jQuery(this).is("a")&&jQuery(this).parent().next().css("background-color","lightyellow"),miniAnnotationList=[{"@id":"test","@type":"oa:Annotation",motivation:"sc:painting",resource:{"@type":"cnt:ContentAsText",chars:_this.query},on:canvasid+(coordinates?"#"+coordinates:"")}];var options={canvasID:canvasid,bounds:bounds};_this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+_this.windowId,options)})},registerHandlebars:function(){$.Handlebars.registerPartial("resultsList",["{{#each this}}",'<div class="result-wrapper">','<a class="search-result search-title js-show-canvas" data-canvasid="{{canvasid}}" data-coordinates="{{coordinates}}">',"{{canvaslabel}}","</a>","{{#if annotations}}","<div>","<em>Annotations</em>: ","{{#each annotations}}",'<a class="search-result search-annotation js-show-canvas" data-canvasid="{{canvasid}}" data-coordinates="{{coordinates}}">','<i class="fa fa-fw" aria-hidden="true"></i>',"</a>","{{/each}}","</div>","{{/if}}",'<div class="search-result result-paragraph js-show-canvas" data-canvasid="{{canvasid}}" data-coordinates="{{coordinates}}">',"{{#if hit.before}}","{{hit.before}} ","{{/if}}","{{#if hit.match}}",'<span class="highlight">{{hit.match}}</span>',"{{else}}","{{{resulttext}}}","{{/if}}","{{#if hit.after}}","{{ hit.after}}","{{/if}}","</div>","</div>","{{/each}}"].join(""))},template:$.Handlebars.compile(["<div>",'<div class="search-results-messages"></div>','<div class="search-results-count"></div>','<div class="search-results-pager"></div>','<div class="search-results-container">',"{{> resultsList }}","</div>","</div>"].join(""))}}(Mirador),function($){$.SidePanel=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,manifest:null,panelState:{},tocTabAvailable:null,annotationsTabAvailable:!1,layersTabAvailable:!1,searchTabAvailable:null,hasStructures:!1,state:null,eventEmitter:null},options),this.init()},$.SidePanel.prototype={init:function(){this.updateState({tabs:[{name:"toc",options:{available:this.tocTabAvailable,id:"tocTab",label:i18next.t("tabTitleIndex")}},{name:"annotations",options:{available:this.annotationsTabAvailable,id:"annotationsTab",label:"Anno."}},{name:"search",options:{available:this.searchTabAvailable,id:"searchTab",label:i18next.t("tabTitleSearch")}},{name:"layers",options:{available:this.layersTabAvailable,id:"layersTab",label:i18next.t("tabTitleLayers")}}],width:280,open:!0},!0),this.listenForActions(),this.render(this.updateState()),this.loadSidePanelComponents()},loadSidePanelComponents:function(){new $.Tabs({windowId:this.windowId,appendTo:this.appendTo,tabs:this.panelState.tabs,hasStructures:this.hasStructures,eventEmitter:this.eventEmitter}),this.tocTabAvailable&&new $.TableOfContents({structures:this.manifest.getStructures(),appendTo:this.element.find(".tabContentArea"),windowId:this.windowId,canvasID:this.canvasID,manifestVersion:this.manifest.getVersion(),eventEmitter:this.eventEmitter}),this.annotationsTabAvailable&&new $.AnnotationsTab({manifest:this.manifest,windowId:this.windowId,appendTo:this.element.find(".tabContentArea"),state:this.state,eventEmitter:this.eventEmitter}),this.searchTabAvailable&&new $.SearchTab({manifest:this.manifest,windowId:this.windowId,appendTo:this.element.find(".tabContentArea"),state:this.state,manifestVersion:this.manifest.getVersion(),eventEmitter:this.eventEmitter}),this.layersTabAvailable&&new $.LayersTab({manifest:this.manifest,windowId:this.windowId,appendTo:this.element.find(".tabContentArea"),canvasID:this.canvasID,canvases:this.canvases,state:this.state,eventEmitter:this.eventEmitter})},update:function(name,availability){var updatedState=this.panelState;jQuery.each(updatedState.tabs,function(index,value){value.name===name&&(value.options.available=availability)}),this.updateState(updatedState)},updateState:function(newState,initial){return arguments.length?(jQuery.extend(!0,this.panelState,newState),initial||this.eventEmitter.publish("sidePanelStateUpdated."+this.windowId,this.panelState),this.panelState):this.panelState},panelToggled:function(){var currentState=this.updateState(),open=!currentState.open;currentState.open=open,this.updateState(currentState)},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("sidePanelStateUpdated."+this.windowId,function(_,data){_this.render(data)}),_this.eventEmitter.subscribe("sidePanelResized",function(){}),_this.eventEmitter.subscribe("sidePanelToggled."+this.windowId,function(){_this.panelToggled()}),_this.eventEmitter.subscribe("annotationListLoaded."+_this.windowId,function(event){var windowObject=_this.state.getWindowObjectById(_this.windowId);windowObject.annotationsAvailable[windowObject.viewType]&&_this.state.getWindowAnnotationsList(_this.windowId).length>0&&_this.update("annotations",!0)}),_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,function(event,newCanvasId){_this.canvasID=newCanvasId})},render:function(renderingData){if(!this.element)return this.element=this.appendTo,void jQuery(this.template(renderingData)).appendTo(this.appendTo)},template:$.Handlebars.compile(['<div class="tabContentArea">','<ul class="tabGroup">',"</ul>","</div>"].join("")),toggle:function(enableSidePanel){enableSidePanel?(jQuery(this.appendTo).show({effect:"fade",duration:300,easing:"easeInCubic"}),this.eventEmitter.publish("REMOVE_CLASS."+this.windowId,"focus-max-width"),this.eventEmitter.publish("SHOW_ICON_TOC."+this.windowId)):(jQuery(this.appendTo).hide(),this.eventEmitter.publish("ADD_CLASS."+this.windowId,"focus-max-width"),this.eventEmitter.publish("HIDE_ICON_TOC."+this.windowId))}}}(Mirador),function($){$.WidgetStatusBar=function(options){jQuery.extend(!0,this,{},$.DEFAULT_SETTINGS,options)}}(Mirador),function($){$.Tabs=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,windowId:null,tabState:{},tabs:[],eventEmitter:null},options),this.init()},$.Tabs.prototype={init:function(){this.state({tabs:this.tabs,selectedTabIndex:0},!0),this.listenForActions(),this.render(this.state()),this.bindEvents()},state:function(state,initial){return arguments.length?(jQuery.extend(!0,this.tabState,state),initial||this.eventEmitter.publish("tabStateUpdated."+this.windowId,this.tabState),this.tabState):this.tabState},tabSelected:function(index){var state=this.state();state.selectedTabIndex=index,this.state(state)},getTemplateData:function(){return{annotationsTab:this.state().annotationsTab,tocTab:this.state().tocTab,searchTab:this.state().searchTab}},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("tabStateUpdated."+this.windowId,function(_,data){_this.render(data)}),_this.eventEmitter.subscribe("tabSelected."+this.windowId,function(_,data){_this.tabSelected(data)}),_this.eventEmitter.subscribe("tabFocused.",function(){})},bindEvents:function(){var _this=this;this.element.find(".tab").on("click",function(event){_this.eventEmitter.publish("tabSelected."+_this.windowId,jQuery(this).index())})},render:function(renderingData){if(!this.element){var tabs=jQuery.grep(renderingData.tabs,function(value,index){return value.options.available});return renderingData.tabs=tabs,1===renderingData.tabs.length&&("toc"!==renderingData.tabs[0].name||this.hasStructures||this.eventEmitter.publish("sidePanelVisibilityByTab."+this.windowId,!1),renderingData.tabs=[]),void(this.element=jQuery(this.template(renderingData)).prependTo(this.appendTo))}this.element.find(".tab").removeClass("selected");var tabClass="."+renderingData.tabs[renderingData.selectedTabIndex].options.id;this.element.find(tabClass).addClass("selected")},template:$.Handlebars.compile(['<ul class="tabGroup">',"{{#each tabs}}",'<li class="tab {{this.options.id}} {{#unless @index}}selected{{/unless}}" data-tabId="{{this.options.id}}">',"{{this.options.label}}","</li>","{{/each}}","</ul>"].join("")),toggle:function(){}}}(Mirador),function($){$.ThumbnailsView=function(options){jQuery.extend(this,{currentImgIndex:0,canvasID:null,focusImages:[],manifest:null,element:null,imagesList:[],imagesListLtr:[],vDirectionStatus:"",appendTo:null,thumbInfo:{thumbsHeight:150,listingCssCls:"listing-thumbs",thumbnailCls:"thumbnail-view"},defaultThumbHeight:150,windowId:null,panel:!1,lazyLoadingFactor:1.5,eventEmitter:null},options),this.init()},$.ThumbnailsView.prototype={init:function(){if(null!==this.canvasID&&(this.currentImgIndex=$.getImageIndexById(this.imagesList,this.canvasID)),"rtl"==this.vDirectionStatus&&(this.imagesList=this.imagesListLtr.concat()),this.loadContent(),"rtl"==this.vDirectionStatus){this.imagesList[0]["@id"];jQuery(this.appendTo).find(".panel-thumbnail-view").addClass("v-direction-rtl"),jQuery(this.appendTo).find(".thumbnail-view").find("li").each(function(){jQuery(this).addClass("thumbnail-rtl")})}this.bindEvents(),this.listenForActions()},loadContent:function(){var _this=this,tplData={defaultHeight:this.thumbInfo.thumbsHeight,listingCssCls:this.thumbInfo.listingCssCls,thumbnailCls:this.thumbInfo.thumbnailCls};tplData.thumbs=jQuery.map(this.imagesList,function(canvas,index){if(0===canvas.width)return{};var aspectRatio=canvas.height/canvas.width,width=_this.thumbInfo.thumbsHeight/aspectRatio;return{thumbUrl:$.getThumbnailForCanvas(canvas,width),title:$.JsonLd.getTextValue(canvas.label),id:canvas["@id"],width:width,highlight:_this.currentImgIndex===index?"highlight":""}}),this.element=jQuery(_this.template(tplData)).appendTo(this.appendTo)},updateImage:function(canvasId){this.currentImgIndex=$.getImageIndexById(this.imagesList,canvasId),this.element.find(".highlight").removeClass("highlight"),this.element.find("img[data-image-id='"+canvasId+"']").addClass("highlight"),this.element.find("img[data-image-id='"+canvasId+"']").parent().addClass("highlight")},updateFocusImages:function(focusList){var _this=this;this.element.find(".highlight").removeClass("highlight"),jQuery.each(focusList,function(index,canvasId){_this.element.find("img[data-image-id='"+canvasId+"']").addClass("highlight"),_this.element.find("img[data-image-id='"+canvasId+"']").parent().addClass("highlight")})},currentImageChanged:function(){var scrollPosition,target=this.element.find(".highlight"),windowObject=this.state.getWindowObjectById(this.windowId);target.position()&&(scrollPosition=windowObject&&"BookView"===windowObject.viewType?this.element.scrollLeft()+(target.position().left+(target.next().width()+target.outerWidth())/2)-this.element.width()/2:this.element.scrollLeft()+(target.position().left+target.width()/2)-this.element.width()/2),this.element.scrollTo(scrollPosition,900)},listenForActions:function(){var _this=this;_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,function(event){_this.currentImageChanged()}),_this.eventEmitter.subscribe("windowResize",$.debounce(function(){_this.loadImages()},100))},bindEvents:function(){var _this=this;_this.element.find("img").on("load",function(){jQuery(this).hide().fadeIn(750,function(){jQuery(this).css("display","block")})}),jQuery(_this.element).scroll(function(){_this.loadImages()}),_this.element.find(".thumbnail-image").on("click",function(){var canvasID=jQuery(this).attr("data-image-id");_this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+_this.windowId,canvasID)})},toggle:function(stateValue){stateValue?this.show():this.hide()},loadImages:function(){var _this=this;jQuery.each(_this.element.find("img"),function(key,value){if($.isOnScreen(value,_this.lazyLoadingFactor)&&!jQuery(value).attr("src")){var url=jQuery(value).attr("data");_this.loadImage(value,url)}})},loadImage:function(imageElement,url){$.createImagePromise(url).done(function(image){jQuery(imageElement).attr("src",image)})},reloadImages:function(newThumbHeight,triggerShow){var _this=this;this.thumbInfo.thumbsHeight=newThumbHeight,jQuery.each(this.imagesList,function(index,image){var aspectRatio=image.height/image.width,width=_this.thumbInfo.thumbsHeight/aspectRatio,newThumbURL=$.getThumbnailForCanvas(image,width),id=image["@id"];_this.element.find('img[data-image-id="'+id+'"]').attr("data",newThumbURL).attr("height",_this.thumbInfo.thumbsHeight).attr("width",width).attr("src","")}),triggerShow&&this.show()},template:$.Handlebars.compile(['<div class="{{thumbnailCls}}">','<ul class="{{listingCssCls}}" role="list" aria-label="Thumbnails">',"{{#thumbs}}",'<li class="{{highlight}}" role="listitem" aria-label="Thumbnail">','<img class="thumbnail-image {{highlight}}" title="{{title}}" data-image-id="{{id}}" src="" data="{{thumbUrl}}" height="{{../defaultHeight}}" width="{{width}}">','<div class="thumb-label">{{title}}</div>',"</li>","{{/thumbs}}","</ul>","</div>"].join("")),hide:function(){var element=jQuery(this.element);this.panel&&(element=element.parent()),element.hide({effect:"fade",duration:300,easing:"easeOutCubic"})},show:function(){var element=jQuery(this.element);this.panel&&(element=element.parent());var _this=this;element.show({effect:"fade",duration:300,easing:"easeInCubic",complete:function(){jQuery(this).css("display","block"),_this.loadImages()}})},adjustWidth:function(className,hasClass){hasClass?this.eventEmitter.publish("REMOVE_CLASS."+this.windowId,className):this.eventEmitter.publish("ADD_CLASS."+this.windowId,className)},adjustHeight:function(className,hasClass){hasClass?this.element.removeClass(className):this.element.addClass(className)}}}(Mirador),function($){$.TableOfContents=function(options){jQuery.extend(!0,this,{element:null,appendTo:null,windowId:null,structures:[],manifestVersion:null,previousSelectedElements:[],selectedElements:[],previousOpenElements:[],openElements:[],hoveredElement:[],selectContext:null,tocData:{},active:null,eventEmitter:null},options),this.init();var self=this;window.render=function(){self.render()}},$.TableOfContents.prototype={init:function(){this.structures&&0!==this.structures.length?(this.element=jQuery(this.template({ranges:this.getTplData()})).appendTo(this.appendTo),this.tocData=this.initTocData(),this.setSelectedElements($.getRangeIDByCanvasID(this.structures,this.canvasID)),this.element.find(".has-child ul").hide(),this.render()):this.element=jQuery(this.emptyTemplate()).appendTo(this.appendTo),this.bindEvents()},tabStateUpdated:function(data){"tocTab"===data.tabs[data.selectedTabIndex].options.id?this.element.show():this.element.hide()},getTplData:function(){var ranges;this.structures.map(function(structure){return structure.id=structure["@id"],structure});switch(this.manifestVersion){case"1":ranges=this.extractV1RangeTrees(this.structures);break;case"2":ranges=this.extractV2RangeTrees(this.structures)}return ranges.length<2&&ranges[0].children&&(ranges=ranges[0].children),ranges},initTocData:function(){var _this=this,tocData={};return _this.structures.forEach(function(structure){var attrString='[data-rangeid="'+structure["@id"]+'"]';tocData[structure["@id"]]={element:_this.element.find(attrString).closest("li")}}),tocData},extractV1RangeTrees:function(rangeList){function unflatten(flatRanges,parent,tree){tree=void 0!==tree?tree:[],parent=void 0!==parent?parent:{"@id":"root",label:"Table of Contents"};var children=jQuery.grep(flatRanges,function(child){return child.within||(child.within="root"),child.within==parent["@id"]});return children.length&&("root"===parent["@id"]?(children.forEach(function(child){child.level=0}),tree=children):(children.forEach(function(child){child.level=parent.level+1}),parent.children=children),jQuery.each(children,function(index,child){unflatten(flatRanges,child)})),tree}return unflatten(rangeList)},extractV2RangeTrees:function(rangeList){function unflatten(flatRanges,parent,tree){tree=void 0!==tree?tree:[];var children=[];if((parent=void 0!==parent?parent:{"@id":"root",label:"Table of Contents"}).ranges)jQuery.each(parent.ranges,function(index,id){id="object"==typeof id?id["@id"]:id;var child=jQuery.grep(flatRanges,function(range,index){if(range["@id"]===id)return range})[0];child&&children.push(child)});else if("root"===parent["@id"]){var top=jQuery.grep(flatRanges,function(range,index){if(range.hasOwnProperty("viewingHint")&&"top"===range.viewingHint)return range})[0];top&&children.push(top),0===children.length&&(jQuery.each(flatRanges,function(index,range){if(range.ranges)return children.push(range),!1}),0===children.length&&children.push({ranges:flatRanges}))}return children.length&&("root"===parent["@id"]?(children.forEach(function(child){child.level=0}),tree=children):(children.forEach(function(child){child.level=parent.level+1}),parent.children=children),jQuery.each(children,function(index,child){unflatten(flatRanges,child)})),tree}return unflatten(rangeList)},render:function(){var _this=this,toDeselect=_this.previousSelectedElements.map(function(rangeID){return _this.tocData[rangeID].element}),toSelect=_this.selectedElements.map(function(rangeID){return _this.tocData[rangeID].element}),toOpen=_this.openElements.filter(function(rangeID){return-1===jQuery.inArray(rangeID,_this.previousOpenElements)}).map(function(rangeID){return _this.tocData[rangeID].element}),toClose=_this.previousOpenElements.filter(function(rangeID){return-1===jQuery.inArray(rangeID,_this.openElements)}).map(function(rangeID){return _this.tocData[rangeID].element});_this.previousSelectedElements!==_this.selectedElements?(toDeselect.forEach(function(element){element.removeClass("selected")}),toSelect.forEach(function(element){element.addClass("selected")}),toClose.forEach(function(element){element.removeClass("open"),element.find("ul:first").slideFadeToggle()}),toOpen.forEach(function(element){element.addClass("open").find("ul:first").slideFadeToggle()})):(toOpen.forEach(function(element){element.addClass("open").find("ul:first").slideFadeToggle()}),toClose.forEach(function(element){element.removeClass("open").find("ul:first").slideFadeToggle()}))},bindEvents:function(){var _this=this;_this.eventEmitter.subscribe("tabStateUpdated."+_this.windowId,function(_,data){_this.tabStateUpdated(data)}),_this.eventEmitter.subscribe("currentCanvasIDUpdated."+_this.windowId,function(event,canvasID){_this.structures&&(_this.setSelectedElements($.getRangeIDByCanvasID(_this.structures,canvasID)),_this.render())}),_this.element.find(".toc-link").on("click",function(event){event.stopPropagation();var rangeID=jQuery(this).data().rangeid,canvasID=jQuery.grep(_this.structures,function(item){return item["@id"]==rangeID})[0].canvases[0];_this.eventEmitter.publish("SET_CURRENT_CANVAS_ID."+_this.windowId,canvasID)}),_this.element.find(".toc-caret").on("click",function(event){event.stopPropagation();var rangeID=jQuery(this).parent().data().rangeid;_this.setOpenItem(rangeID),_this.render()})},setActive:function(active){this.active=active},setOpenItem:function(rangeID){var _this=this,alreadyOpen=-1!==jQuery.inArray(rangeID,_this.openElements);_this.previousOpenElements=_this.openElements,_this.openElements=alreadyOpen?_this.openElements.filter(function(elementID){return elementID!==rangeID}):_this.openElements.map(function(elementID){return elementID}).concat([rangeID])},setSelectedElements:function(rangeIDs){var _this=this;_this.previousSelectedElements=_this.selectedElements,_this.selectedElements=rangeIDs,_this.previousOpenElements=_this.openElements,_this.openElements=_this.openElements.filter(function(openElementID){return-1===jQuery.inArray(openElementID,_this.previousSelectedElements)}).concat(rangeIDs).filter(function(openElementID,index,openElements){return index===openElements.indexOf(openElementID)})},emptyTemplate:$.Handlebars.compile(['<ul class="toc">','<li class="leaf-item open">','<h2><span>{{t "noIndex"}}</span></h2>',"</ul>"].join("")),template:function(tplData){var previousTemplate,template=$.Handlebars.compile(['<ul class="toc">',"{{#nestedRangeLevel ranges}}",'<li class="{{#if children}}has-child{{else}}leaf-item{{/if}}">',"{{{tocLevel id label level children}}}","{{#if children}}","<ul>","{{{nestedRangeLevel children}}}","</ul>","{{/if}}","<li>","{{/nestedRangeLevel}}","</ul>"].join(""));return $.Handlebars.registerHelper("nestedRangeLevel",function(children,options){var out="";return void 0!==options.fn&&(previousTemplate=options.fn),children.forEach(function(child){child.label=$.JsonLd.getTextValue(child.label),out+=previousTemplate(child)}),out}),$.Handlebars.registerHelper("tocLevel",function(id,label,level,children){return"<h"+(level+1)+'><a class="toc-link" data-rangeID="'+id+'"><i class="fa fa-caret-right toc-caret"></i><i class="fa fa-certificate star"></i><span>'+label+"</span></a></h"+(level+1)+">"}),template(tplData)},hide:function(){jQuery(this.appendTo).hide(),this.eventEmitter.publish("ADD_CLASS."+this.windowId,"focus-max-width")},show:function(){jQuery(this.appendTo).show({effect:"fade",duration:300,easing:"easeInCubic"}),this.eventEmitter.publish("REMOVE_CLASS."+this.windowId,"focus-max-width")}}}(Mirador),function($){$.DialogBuilder=function(container){this.container=container||jQuery(".window"),bootbox.setDefaults({container:this.container})},$.DialogBuilder.prototype={confirm:function(message,callback){return this._attachEvents(bootbox.confirm(message,callback))},dialog:function(opts){this._attachEvents(bootbox.dialog(opts))},_attachEvents:function(el){var _this=this;el.init(function(){jQuery(el).css("z-index",2e4),jQuery(".modal-backdrop").prependTo(_this.container).css("z-index",2e4)}),jQuery(el).on("hidden.bs.modal",function(){jQuery(".modal-backdrop").remove()})}}}(Mirador),function($){$.EventEmitter=function(config){jQuery.extend(!0,this,{debug:$.EventEmitter.debug,trace:$.EventEmitter.trace,debugExclude:$.EventEmitter.excludePatterns},config),this.emitterId=$.EventEmitter.nextId(),this.debug&&(this.logger=new $.EventEmitter.Logger({trace:this.trace,debugExclude:this.debugExclude}))},$.EventEmitter.id=0,$.EventEmitter.nextId=function(){return $.EventEmitter.id++,$.EventEmitter.id},$.EventEmitter.debug=!1,$.EventEmitter.trace=!1,$.EventEmitter.excludePatterns=[],$.EventEmitter.Logger=function(options){this.trace=options.trace,this.debugExclude=options.debugExclude,this.scaffoldMap={}},$.EventEmitter.Logger.prototype={log:function(){this.trace?console.trace.apply(console,arguments):console.log.apply(console,arguments)},exclude:function(str){for(var patterns=this.debugExclude,i=0;i<patterns.length;++i)if(str.match(patterns[i]))return!0;return!1},scaffoldHandler:function(eventId,handler){var _this=this,scaffold=function(){_this.log("EventEmitter:handler:",eventId,handler,Array.prototype.slice.call(arguments)),handler.apply(null,arguments)};return this.scaffoldMap[handler]=scaffold,scaffold},unscaffold:function(handler){var scaffold=this.scaffoldMap[handler];return delete this.scaffoldMap[handler],scaffold}},["subscribe","unsubscribe","publish"].forEach(function(action){$.EventEmitter.prototype[action]=function(){var event,args=Array.prototype.slice.call(arguments),eventId=args[0],globalEventId=this.emitterId.toString()+"::"+eventId,logging=this.logger&&!this.logger.exclude(globalEventId);if("subscribe"===action&&(event={name:eventId,handler:args[1]},logging&&(args[1]=this.logger.scaffoldHandler(globalEventId,args[1]))),"unsubscribe"===action&&logging&&(args[1]=this.logger.unscaffold(args[1])),args[0]=globalEventId,logging&&this.logger.log("EventEmitter:"+action+":",args),jQuery[action].apply(jQuery,args),event)return event}})}(Mirador),Mirador.Iiif={getImageUrl:function(image){if(!image.images[0].resource.service)return id=image.images[0].resource.default.service["@id"],id=id.replace(/\/$/,"");var id=image.images[0].resource.service["@id"];return id=id.replace(/\/$/,"")},getVersionFromContext:function(context){return context instanceof Array&&(context=context.filter(function(ctx){return"string"==typeof ctx&&0===ctx.indexOf("http://iiif.io")})[0]),"http://iiif.io/api/image/2/context.json"==context?"2.0":"1.1"},getComplianceLevelFromProfile:function(profile){var compliance=-1,complianceString=null;if(profile)switch("string"==typeof profile?complianceString=profile:"object"==typeof profile&&(complianceString=profile[0]),complianceString){case"http://iiif.io/api/image/2/level0.json":compliance=0;break;case"http://iiif.io/api/image/2/level1.json":compliance=1;break;case"http://iiif.io/api/image/2/level2.json":compliance=2}return compliance},makeUriWithWidth:function(uri,width,version){return uri=uri.replace(/\/$/,""),"1"==version[0]?uri+"/full/"+width+",/0/native.jpg":uri+"/full/"+width+",/0/default.jpg"},getImageHostUrl:function(json){var regex,matches=[];return json.hasOwnProperty("image_host")||(json.image_host=json.tilesUrl||json["@id"]||"",json.hasOwnProperty("identifier")?(regex=new RegExp("/?"+json.identifier+"/?$","i"),json.image_host=json.image_host.replace(regex,"")):(matches=(regex=new RegExp("(.*)/(.*)$")).exec(json.image_host))&&matches.length>1&&(json.image_host=matches[1],json.identifier=matches[2])),json.image_host}},function($){function initSettings(method,host,port,ssl,requestBody){var ajaxSettings={type:method,url:function(host,port,ssl,body){var proto="http";port=port||"80",ssl&&(proto="https",port=port||"443"),host=host||"jsonblob.com";var path=JSONBLOB_API_ENDPOINT;return("string"==typeof body||body instanceof String)&&(path+="/"+body),proto+"://"+host+":"+port+path}(host,port,ssl,requestBody),contentType:"application/json; charset=UTF-8",accept:"application/json",dataType:"json",processData:!1};return"string"==typeof requestBody||requestBody instanceof String||(ajaxSettings.data=JSON.stringify(requestBody)),ajaxSettings}var JSONBLOB_API_ENDPOINT="/api/jsonBlob";$.JSONBlobAPI=function(options){this.options=options},$.JSONBlobAPI.prototype={readSync:function(blobId){return function(method,host,port,ssl,requestBody){var result,settings=initSettings(method,host,port,ssl,requestBody);return settings.async=!1,settings.success=function(data,textStatus,request){result=data},jQuery.ajax(settings),result}("GET",this.options.host,this.options.port,this.options.ssl,blobId)},save:function(blob){var deferred=jQuery.Deferred();return function(method,host,port,ssl,requestBody,cb){var settings=initSettings(method,host,port,ssl,requestBody);settings.success=cb,jQuery.ajax(settings)}("POST",this.options.host,this.options.port,this.options.ssl,blob,function(data,textStatus,request){var blobid=request.getResponseHeader("X-Jsonblob");deferred.resolve(blobid)}),deferred.promise()}}}(Mirador),function($){$.JsonLd={getTextValue:function(propertyValue,language){var languages=i18next.languages||["en"];if("string"==typeof language?languages=[language].concat(languages):Array.isArray(language)&&(languages=language.concat(languages)),void 0===propertyValue||null===propertyValue)return"";if("string"==typeof propertyValue)return $.sanitizeHtml(propertyValue);if(Array.isArray(propertyValue)){var displayLanguage=function(languages,items){var itemLanguages=items.map(function(itm){return"string"==typeof itm?null:itm["@language"]}),bestLanguageMatch=null;return jQuery.each(languages,function(idx,lang){if(null!==bestLanguageMatch)return!1;-1!==itemLanguages.indexOf(lang)&&(bestLanguageMatch=lang)}),null===bestLanguageMatch&&-1===itemLanguages.indexOf(null)&&(bestLanguageMatch=itemLanguages[0]),bestLanguageMatch}(languages,propertyValue),text="";return jQuery.each(propertyValue,function(idx,item){var textToAdd="";"string"==typeof item&&null===displayLanguage?textToAdd=item:item["@language"]===displayLanguage&&(textToAdd=item["@value"]),""!==textToAdd&&""!==text&&(text+="<br/>"),text+=textToAdd}),$.sanitizeHtml(text)}return $.sanitizeHtml(propertyValue["@value"])}}}(Mirador),function($){$.LocalJSONBlobAPI=function(opts){this.options={storage:window.localStorage},jQuery.extend(this.options,opts)},$.LocalJSONBlobAPI.prototype={readSync:function(blobId){return JSON.parse(this.options.storage.getItem(blobId))},save:function(blob){var deferred=jQuery.Deferred(),uuid=function(){var d=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"===c?r:3&r|8).toString(16)})}();return this.options.storage.setItem("BM-"+uuid,JSON.stringify(blob)),deferred.resolve("BM-"+uuid),deferred.promise()}}}(Mirador),Mirador.OpenSeadragon=function(options){return OpenSeadragon(jQuery.extend({preserveViewport:!0,visibilityRatio:1,minZoomLevel:0,defaultZoomLevel:0,blendTime:.1,alwaysBlend:!1,showNavigationControl:!1},options))},function($){$.SaveController=function(config){function index(previousValue,currentValue,currentIndex){var newObj={};return newObj[currentValue]=previousValue,newObj}function iterateStringify(object){for(var property in object)object.hasOwnProperty(property)&&(object[property]instanceof Array?object[property]=JSON.stringify(object[property]):"object"==typeof object[property]&&iterateStringify(object[property]))}function iterateParse(object){for(var property in object)object.hasOwnProperty(property)&&("string"==typeof object[property]&&"["===object[property][0]?object[property]=JSON.parse(object[property]):"object"==typeof object[property]&&iterateParse(object[property]))}jQuery.extend(!0,this,{currentConfig:null,originalConfig:null,shareEndpoint:null,historySize:null,sessionID:null,slots:[],eventEmitter:null}),config.availableAnnotationDrawingTools&&(config.availableAnnotationDrawingTools=jQuery.grep(config.availableAnnotationDrawingTools,function(element,index){return jQuery.inArray(element,$.DEFAULT_SETTINGS.availableAnnotationDrawingTools)>=0})),config.mainMenuSettings&&!config.mainMenuSettings.buttons&&(config.mainMenuSettings.buttons={}),jQuery.each(config,function(key,value){if("string"==typeof key&&-1!==key.indexOf(".")){var object=key.split(".").reverse().reduce(index,value);delete config[key],jQuery.extend(!0,config,object)}}),iterateStringify(config);var newConfig=jQuery.extend(!0,{},$.DEFAULT_SETTINGS,config);iterateParse(newConfig),this.init(newConfig)},$.SaveController.prototype={init:function(config){if(this.eventEmitter=config.eventEmitter,!1===config.saveSession)return this.currentConfig=config,this.bindEvents(),!1;saveModule=config.jsonStorageEndpoint.module,saveOptions=config.jsonStorageEndpoint.options,this.storageModule=new $[saveModule](saveOptions);var sessionID=window.location.hash.substring(1);if(this.sessionID=sessionID||$.genUUID(),localStorage.getItem(this.sessionID))this.currentConfig=JSON.parse(localStorage.getItem(sessionID));else{var paramURL=window.location.search.substring(1);if(paramURL){var jsonblob=paramURL.split("=")[1];this.currentConfig=this.storageModule.readSync(jsonblob)||config}else this.currentConfig=config}this.currentConfig.windowObjects=jQuery.map(this.currentConfig.windowObjects,function(value,index){return 0===Object.keys(value).length?null:value}),this.currentConfig.windowObjects&&jQuery.each(this.currentConfig.windowObjects,function(index,window){window.id||(window.id=$.genUUID())});var cleanURL=window.location.href.replace(window.location.search,"");window.location.hash?history.replaceState(this.currentConfig,"Mirador Session",cleanURL):history.replaceState(this.currentConfig,"Mirador Session",cleanURL+"#"+this.sessionID),this.bindEvents()},getWindowObjectById:function(windowId){var returnObject=null;return jQuery.each(this.currentConfig.windowObjects,function(index,window){if(window.id===windowId)return returnObject=window,!1}),returnObject},getWindowAnnotationsList:function(windowId){return this.windowsAnnotationsLists?this.windowsAnnotationsLists[windowId]:null},getSlots:function(){return this.slots},getWindowElement:function(windowId){return this.windowsElements?this.windowsElements[windowId]:null},getStateProperty:function(prop){return this.get(prop,"currentConfig")},getManifestIndex:function(manifestUri){var manifestIndex=-1;return jQuery.each(this.currentConfig.data,function(index,dataObj){if(dataObj.manifestUri===manifestUri)return manifestIndex=index,!1}),manifestIndex},get:function(prop,parent){return parent?this[parent][prop]:this[prop]},set:function(prop,value,options){options?this[options.parent][prop]=value:this[prop]=value,this.currentConfig.saveSession&&this.save(),this.eventEmitter.publish("saveControllerConfigUpdated")},bindEvents:function(){var _this=this;_this.eventEmitter.subscribe("manifestsPanelVisible.set",function(event,manifestPanelVisible){_this.set("manifestPanelVisible",manifestPanelVisible,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("windowUpdated",function(event,options){var windowObjects=_this.currentConfig.windowObjects;windowObjects&&windowObjects.length>0?jQuery.each(windowObjects,function(index,window){window.id===options.id&&jQuery.extend(windowObjects[index],options)}):windowObjects=[options],_this.set("windowObjects",windowObjects,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("imageBoundsUpdated",function(event,options){var windowObjects=_this.currentConfig.windowObjects;windowObjects&&windowObjects.length>0&&jQuery.each(windowObjects,function(index,window){window.id===options.id&&(windowObjects[index].windowOptions||(windowObjects[index].windowOptions={}),windowObjects[index].windowOptions.osdBounds=options.osdBounds)}),_this.set("windowObjects",windowObjects,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("ANNOTATIONS_LIST_UPDATED",function(event,options){_this.windowsAnnotationsLists||(_this.windowsAnnotationsLists={}),_this.windowsAnnotationsLists[options.windowId]=options.annotationsList,_this.eventEmitter.publish("annotationListLoaded."+options.windowId)}),_this.eventEmitter.subscribe("WINDOW_ELEMENT_UPDATED",function(event,options){_this.windowsElements||(_this.windowsElements={}),_this.windowsElements[options.windowId]=options.element}),_this.eventEmitter.subscribe("windowSlotAddressUpdated",function(event,options){var windowObjects=_this.currentConfig.windowObjects;windowObjects&&windowObjects.length>0?jQuery.each(windowObjects,function(index,window){window.id===options.id&&jQuery.extend(windowObjects[index],options)}):windowObjects=[options],_this.set("windowObjects",windowObjects,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("manifestQueued",function(event,manifestObject,repository){var data=_this.currentConfig.data,objectInConfig=!1,url=manifestObject.uri;jQuery.each(data,function(index,manifestObject){manifestObject.manifestUri===url&&(objectInConfig=!0)}),objectInConfig||(data.push({manifestUri:url,location:repository}),_this.set("data",data,{parent:"currentConfig"}));var manifests=_this.currentConfig.manifests;manifests[url]=manifestObject,_this.set("manifests",manifests,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("slotsUpdated",function(event,options){_this.slots=options.slots}),_this.eventEmitter.subscribe("layoutChanged",function(event,layoutDescription){var serialisedLayout=JSON.stringify(layoutDescription,function(key,value){if("parent"!==key)return value});_this.set("layout",serialisedLayout,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("windowSlotAdded",function(event,options){var windowObjects=_this.currentConfig.windowObjects;0===jQuery.grep(windowObjects,function(windowObj){return windowObj.id===options.id}).length&&(windowObjects.push({id:options.id,slotAddress:options.slotAddress}),_this.set("windowObjects",windowObjects,{parent:"currentConfig"}))}),_this.eventEmitter.subscribe("windowsRemoved",function(event){_this.set("windowObjects",[],{parent:"currentConfig"})}),_this.eventEmitter.subscribe("windowRemoved",function(event,windowID){var windowObjects=jQuery.grep(_this.currentConfig.windowObjects,function(window,index){return window.id!==windowID});_this.set("windowObjects",windowObjects,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("DELETE_FROM_CONFIG",function(event,options){var windowObjects=jQuery.grep(_this.currentConfig.windowObjects,function(window,index){return window.loadedManifest!==options.loadedManifest||window.id});_this.set("windowObjects",windowObjects,{parent:"currentConfig"})}),_this.eventEmitter.subscribe("etc...",function(junk){})},cleanup:function(obj){function cloner(obj){if(null===obj||"object"!=typeof obj)return obj;if(-1===clonedSet.indexOf(obj)){clonedSet.push(obj);var temp=Array.isArray(obj)?[]:{};for(var key in obj)obj.hasOwnProperty(key)&&(temp[key]=cloner(obj[key]));return temp}}var clonedSet=[];return cloner(obj)},save:function(){localStorage.setItem(this.sessionID,JSON.stringify(this.cleanup(this.currentConfig)))}}}(Mirador),function($){$.trimString=function(str){return str.replace(/^\s+|\s+$/g,"")},$.getImageIndexById=function(imagesList,id){var imgIndex=0;return jQuery.each(imagesList,function(index,img){$.trimString(img["@id"])===$.trimString(id)&&(imgIndex=index)}),imgIndex},$.getThumbnailForCanvas=function(canvas,width){var service,thumbnailUrl,version="1.1",compliance=-1;if(width=parseInt(width,10),canvas.hasOwnProperty("thumbnail"))"string"==typeof canvas.thumbnail?thumbnailUrl=canvas.thumbnail:canvas.thumbnail.hasOwnProperty("service")?((service=canvas.thumbnail.service).hasOwnProperty("profile")&&(compliance=$.Iiif.getComplianceLevelFromProfile(service.profile)),0===compliance?thumbnailUrl=canvas.thumbnail["@id"]:(service.hasOwnProperty("@context")&&(version=$.Iiif.getVersionFromContext(service["@context"])),thumbnailUrl=$.Iiif.makeUriWithWidth(service["@id"],width,version))):thumbnailUrl=canvas.thumbnail["@id"];else{var resource=canvas.images[0].resource;(service=resource.default?resource.default.service:resource.service).hasOwnProperty("@context")&&(version=$.Iiif.getVersionFromContext(service["@context"])),thumbnailUrl=$.Iiif.makeUriWithWidth(service["@id"],width,version)}return thumbnailUrl},$.getQueryParams=function(url){var assoc={},decode=function(s){return decodeURIComponent(s.replace(/\+/g," "))},queryString=url.split("?")[1];if(void 0===queryString)return{};var keyValues=queryString.split("&");for(var i in keyValues){var key=keyValues[i].split("=");key.length>1&&(assoc[decode(key[0])]=decode(key[1]))}return assoc},$.genUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})},jQuery.fn.slideFadeToggle=function(speed,easing,callback){return this.animate({opacity:"toggle",height:"toggle"},speed,easing,callback)},$.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;void 0!==options&&(options={});var later=function(){previous=!1===options.leading?0:new Date,timeout=null,result=func.apply(context,args)};return function(){var now=new Date;previous||!1!==options.leading||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args)):timeout||!1===options.trailing||(timeout=setTimeout(later,remaining)),result}},$.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;return function(){context=this,args=arguments,timestamp=new Date;var later=function(){var last=new Date-timestamp;last<wait?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args)))},callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args)),result}},$.isOnScreen=function(elem,outsideViewportFactor){var factor=1;outsideViewportFactor&&(factor=outsideViewportFactor);var win=jQuery(window),viewport={top:win.scrollTop()*factor,left:win.scrollLeft()*factor};viewport.bottom=(viewport.top+win.outerHeight())*factor,viewport.right=(viewport.left+win.outerWidth())*factor;var el=jQuery(elem),bounds=el.offset();return bounds.bottom=bounds.top+el.height(),bounds.right=bounds.left+el.width(),!(viewport.right<bounds.left||viewport.left>bounds.right||viewport.bottom<bounds.top||viewport.top>bounds.bottom)},$.getRangeIDByCanvasID=function(structures,canvasID){var ranges=jQuery.grep(structures,function(range){return jQuery.inArray(canvasID,range.canvases)>-1});return jQuery.map(ranges,function(range){return range["@id"]})},$.layoutDescriptionFromGridString=function(gridString){var columns=parseInt(gridString.substring(gridString.indexOf("x")+1,gridString.length),10),rowsPerColumn=parseInt(gridString.substring(0,gridString.indexOf("x")),10),layoutDescription={type:"row"};if("1x1"===gridString)return layoutDescription;layoutDescription.children=[];for(var i=0,c=columns;i<c;i++){var column={type:"column"};if(rowsPerColumn>1){column.children=[];for(var j=0,r=rowsPerColumn;j<r;j++)column.children.push({type:"row"})}layoutDescription.children.push(column)}return layoutDescription},$.createImagePromise=function(imageUrl){var img=new Image,dfd=jQuery.Deferred();return img.onload=function(){dfd.resolve(img.src)},img.onerror=function(){dfd.reject(img.src)},dfd.fail(function(){console.log("image failed to load: "+img.src)}),img.src=imageUrl,dfd.promise()},$.enterFullscreen=function(el){el.requestFullscreen?el.requestFullscreen():el.mozRequestFullScreen?el.mozRequestFullScreen():el.webkitRequestFullscreen?el.webkitRequestFullscreen():el.msRequestFullscreen&&el.msRequestFullscreen()},$.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},$.isFullscreen=function(){return $.fullscreenElement().length>0},$.fullscreenElement=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement},$.sanitizeHtml=function(dirty){return sanitizeHtml(dirty,{allowedTags:["a","b","br","i","img","p","span","strong","em","ul","ol","li"],allowedAttributes:{a:["href","target"],img:["src","alt"],p:["dir"]}})}}(Mirador);
//# sourceMappingURL=mirador.min.js.map